/*! For license information please see index-DOJHP7J4.js.LICENSE.txt */
const __vite__mapDeps=(e,t=__vite__mapDeps,n=t.f||(t.f=["./index-CnwgenbU.js","./matrix-sdk-crypto-wasm-D9e1T4vy.js","./polyfill-force-DxJcBG4e.js","./index-DgskObdj.js","./polyfill-force-DmQV3-w7.js"]))=>e.map((e=>n[e]));try{let e=typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{},t=(new e.Error).stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]="4d2a1fe7-9e8a-40ae-a391-34f35a253ab2",e._sentryDebugIdIdentifier="sentry-dbid-4d2a1fe7-9e8a-40ae-a391-34f35a253ab2")}catch{}function $re(e,t){for(var n=0;n<t.length;n++){const r=t[n];if("string"!=typeof r&&!Array.isArray(r))for(const t in r)if("default"!==t&&!(t in e)){const n=Object.getOwnPropertyDescriptor(r,t);n&&Object.defineProperty(e,t,n.get?n:{enumerable:!0,get:()=>r[t]})}}return Object.freeze(Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}))}(typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{}).SENTRY_RELEASE={id:"embedded-v0.10.0"};!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver((e=>{for(const n of e)if("childList"===n.type)for(const e of n.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)})).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();var HKe=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Ko(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function BKe(e){if(Object.prototype.hasOwnProperty.call(e,"__esModule"))return e;var t=e.default;if("function"==typeof t){var n=function e(){return this instanceof e?Reflect.construct(t,arguments,this.constructor):t.apply(this,arguments)};n.prototype=t.prototype}else n={};return Object.defineProperty(n,"__esModule",{value:!0}),Object.keys(e).forEach((function(t){var r=Object.getOwnPropertyDescriptor(e,t);Object.defineProperty(n,t,r.get?r:{enumerable:!0,get:function(){return e[t]}})})),n}var $A,HA,BA,VA,UT={exports:{}},$m={},FT={exports:{}},_t={};function Hre(){if($A)return _t;$A=1;var e=Symbol.for("react.element"),t=Symbol.for("react.portal"),n=Symbol.for("react.fragment"),r=Symbol.for("react.strict_mode"),i=Symbol.for("react.profiler"),o=Symbol.for("react.provider"),s=Symbol.for("react.context"),a=Symbol.for("react.forward_ref"),l=Symbol.for("react.suspense"),c=Symbol.for("react.memo"),u=Symbol.for("react.lazy"),d=Symbol.iterator;var h={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},p=Object.assign,f={};function m(e,t,n){this.props=e,this.context=t,this.refs=f,this.updater=n||h}function v(){}function g(e,t,n){this.props=e,this.context=t,this.refs=f,this.updater=n||h}m.prototype.isReactComponent={},m.prototype.setState=function(e,t){if("object"!=typeof e&&"function"!=typeof e&&null!=e)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")},m.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")},v.prototype=m.prototype;var y=g.prototype=new v;y.constructor=g,p(y,m.prototype),y.isPureReactComponent=!0;var b=Array.isArray,_=Object.prototype.hasOwnProperty,w={current:null},E={key:!0,ref:!0,__self:!0,__source:!0};function S(t,n,r){var i,o={},s=null,a=null;if(null!=n)for(i in void 0!==n.ref&&(a=n.ref),void 0!==n.key&&(s=""+n.key),n)_.call(n,i)&&!E.hasOwnProperty(i)&&(o[i]=n[i]);var l=arguments.length-2;if(1===l)o.children=r;else if(1<l){for(var c=Array(l),u=0;u<l;u++)c[u]=arguments[u+2];o.children=c}if(t&&t.defaultProps)for(i in l=t.defaultProps)void 0===o[i]&&(o[i]=l[i]);return{$$typeof:e,type:t,key:s,ref:a,props:o,_owner:w.current}}function C(t){return"object"==typeof t&&null!==t&&t.$$typeof===e}var k=/\/+/g;function T(e,t){return"object"==typeof e&&null!==e&&null!=e.key?function(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,(function(e){return t[e]}))}(""+e.key):t.toString(36)}function I(n,r,i,o,s){var a=typeof n;("undefined"===a||"boolean"===a)&&(n=null);var l=!1;if(null===n)l=!0;else switch(a){case"string":case"number":l=!0;break;case"object":switch(n.$$typeof){case e:case t:l=!0}}if(l)return s=s(l=n),n=""===o?"."+T(l,0):o,b(s)?(i="",null!=n&&(i=n.replace(k,"$&/")+"/"),I(s,r,i,"",(function(e){return e}))):null!=s&&(C(s)&&(s=function(t,n){return{$$typeof:e,type:t.type,key:n,ref:t.ref,props:t.props,_owner:t._owner}}(s,i+(!s.key||l&&l.key===s.key?"":(""+s.key).replace(k,"$&/")+"/")+n)),r.push(s)),1;if(l=0,o=""===o?".":o+":",b(n))for(var c=0;c<n.length;c++){var u=o+T(a=n[c],c);l+=I(a,r,i,u,s)}else if(u=function(e){return null===e||"object"!=typeof e?null:"function"==typeof(e=d&&e[d]||e["@@iterator"])?e:null}(n),"function"==typeof u)for(n=u.call(n),c=0;!(a=n.next()).done;)l+=I(a=a.value,r,i,u=o+T(a,c++),s);else if("object"===a)throw r=String(n),Error("Objects are not valid as a React child (found: "+("[object Object]"===r?"object with keys {"+Object.keys(n).join(", ")+"}":r)+"). If you meant to render a collection of children, use an array instead.");return l}function R(e,t,n){if(null==e)return e;var r=[],i=0;return I(e,r,"","",(function(e){return t.call(n,e,i++)})),r}function x(e){if(-1===e._status){var t=e._result;(t=t()).then((function(t){(0===e._status||-1===e._status)&&(e._status=1,e._result=t)}),(function(t){(0===e._status||-1===e._status)&&(e._status=2,e._result=t)})),-1===e._status&&(e._status=0,e._result=t)}if(1===e._status)return e._result.default;throw e._result}var L={current:null},P={transition:null},O={ReactCurrentDispatcher:L,ReactCurrentBatchConfig:P,ReactCurrentOwner:w};function A(){throw Error("act(...) is not supported in production builds of React.")}return _t.Children={map:R,forEach:function(e,t,n){R(e,(function(){t.apply(this,arguments)}),n)},count:function(e){var t=0;return R(e,(function(){t++})),t},toArray:function(e){return R(e,(function(e){return e}))||[]},only:function(e){if(!C(e))throw Error("React.Children.only expected to receive a single React element child.");return e}},_t.Component=m,_t.Fragment=n,_t.Profiler=i,_t.PureComponent=g,_t.StrictMode=r,_t.Suspense=l,_t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=O,_t.act=A,_t.cloneElement=function(t,n,r){if(null==t)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+t+".");var i=p({},t.props),o=t.key,s=t.ref,a=t._owner;if(null!=n){if(void 0!==n.ref&&(s=n.ref,a=w.current),void 0!==n.key&&(o=""+n.key),t.type&&t.type.defaultProps)var l=t.type.defaultProps;for(c in n)_.call(n,c)&&!E.hasOwnProperty(c)&&(i[c]=void 0===n[c]&&void 0!==l?l[c]:n[c])}var c=arguments.length-2;if(1===c)i.children=r;else if(1<c){l=Array(c);for(var u=0;u<c;u++)l[u]=arguments[u+2];i.children=l}return{$$typeof:e,type:t.type,key:o,ref:s,props:i,_owner:a}},_t.createContext=function(e){return(e={$$typeof:s,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null}).Provider={$$typeof:o,_context:e},e.Consumer=e},_t.createElement=S,_t.createFactory=function(e){var t=S.bind(null,e);return t.type=e,t},_t.createRef=function(){return{current:null}},_t.forwardRef=function(e){return{$$typeof:a,render:e}},_t.isValidElement=C,_t.lazy=function(e){return{$$typeof:u,_payload:{_status:-1,_result:e},_init:x}},_t.memo=function(e,t){return{$$typeof:c,type:e,compare:void 0===t?null:t}},_t.startTransition=function(e){var t=P.transition;P.transition={};try{e()}finally{P.transition=t}},_t.unstable_act=A,_t.useCallback=function(e,t){return L.current.useCallback(e,t)},_t.useContext=function(e){return L.current.useContext(e)},_t.useDebugValue=function(){},_t.useDeferredValue=function(e){return L.current.useDeferredValue(e)},_t.useEffect=function(e,t){return L.current.useEffect(e,t)},_t.useId=function(){return L.current.useId()},_t.useImperativeHandle=function(e,t,n){return L.current.useImperativeHandle(e,t,n)},_t.useInsertionEffect=function(e,t){return L.current.useInsertionEffect(e,t)},_t.useLayoutEffect=function(e,t){return L.current.useLayoutEffect(e,t)},_t.useMemo=function(e,t){return L.current.useMemo(e,t)},_t.useReducer=function(e,t,n){return L.current.useReducer(e,t,n)},_t.useRef=function(e){return L.current.useRef(e)},_t.useState=function(e){return L.current.useState(e)},_t.useSyncExternalStore=function(e,t,n){return L.current.useSyncExternalStore(e,t,n)},_t.useTransition=function(){return L.current.useTransition()},_t.version="18.3.1",_t}function IP(){return HA||(HA=1,FT.exports=Hre()),FT.exports}function Bre(){if(BA)return $m;BA=1;var e=IP(),t=Symbol.for("react.element"),n=Symbol.for("react.fragment"),r=Object.prototype.hasOwnProperty,i=e.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,o={key:!0,ref:!0,__self:!0,__source:!0};function s(e,n,s){var a,l={},c=null,u=null;for(a in void 0!==s&&(c=""+s),void 0!==n.key&&(c=""+n.key),void 0!==n.ref&&(u=n.ref),n)r.call(n,a)&&!o.hasOwnProperty(a)&&(l[a]=n[a]);if(e&&e.defaultProps)for(a in n=e.defaultProps)void 0===l[a]&&(l[a]=n[a]);return{$$typeof:t,type:e,key:c,ref:u,props:l,_owner:i.current}}return $m.Fragment=n,$m.jsx=s,$m.jsxs=s,$m}function Vre(){return VA||(VA=1,UT.exports=Bre()),UT.exports}var E=Vre();function qA(e,t,n,r,i,o,s){try{var a=e[o](s),l=a.value}catch(e){return void n(e)}a.done?t(l):Promise.resolve(l).then(r,i)}function U(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var o=e.apply(t,n);function s(e){qA(o,r,i,s,a,"next",e)}function a(e){qA(o,r,i,s,a,"throw",e)}s(void 0)}))}}function Sv(e){return(Sv="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function qre(e,t){if("object"!=Sv(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t);if("object"!=Sv(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}function Kre(e){var t=qre(e,"string");return"symbol"==Sv(t)?t:t+""}function L(e,t,n){return(t=Kre(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const Gre="l",Wre="rn",zre={0:"O",1:"l","֭":"֖","֮":"֘","֨":"֙","֤":"֚","᪴":"ۛ","⃛":"ۛ","ؙ":"̓","ࣳ":"̓","̓":"̓","̕":"̓","ُ":"̓","ٝ":"̔","֜":"́","֝":"́","ؘ":"́","݇":"́","́":"́","॔":"́","َ":"́","̀":"̀","॓":"̀","̌":"̆","꙼":"̆","٘":"̆","ٚ":"̆","ͮ":"̆","ۨ":"̆̇","̐":"̆̇","ँ":"̆̇","ঁ":"̆̇","ઁ":"̆̇","ଁ":"̆̇","ఀ":"̆̇","ಁ":"̆̇","ഁ":"̆̇","𑒿":"̆̇","᳐":"̂","̑":"̂","ٛ":"̂","߮":"̂","꛰":"̂","֯":"̊","۟":"̊","៓":"̊","゚":"̊","ْ":"̊","ஂ":"̊","ံ":"̊","ំ":"̊","𑌀":"̊","ํ":"̊","ໍ":"̊","ͦ":"̊","ⷪ":"̊","࣫":"̈","߳":"̈","ً":"̋","ࣰ":"̋","͂":"̃","ٓ":"̃","ׄ":"̇","۬":"̇","݀":"̇","࣪":"̇","݁":"̇","͘":"̇","ֹ":"̇","ֺ":"̇","ׂ":"̇","ׁ":"̇","߭":"̇","ं":"̇","ਂ":"̇","ં":"̇","்":"̇","̷":"̸","᪷":"̨","̢":"̨","ͅ":"̨","᳒":"̄","̅":"̄","ٙ":"̄","߫":"̄","꛱":"̄","᳚":"̎","ٗ":"̒","͗":"͐","ࣿ":"͐","ࣸ":"͐","ऀ":"͒","᳭":"̖","᳜":"̩","ٖ":"̩","᳕":"̫","͇":"̳","ࣹ":"͔","ࣺ":"͕",゛:"ﾞ",゜:"ﾟ","̶":"̵","〬":"̉","ׅ":"̣","࣭":"̣","᳝":"̣","ִ":"̣","ٜ":"̣","़":"̣","়":"̣","਼":"̣","઼":"̣","଼":"̣","𑇊":"̣","𑓃":"̣","𐨺":"̣","࣮":"̤","᳞":"̤","༷":"̥","〭":"̥","̧":"̦","̡":"̦","̹":"̦","᳙":"̭","᳘":"̮","॒":"̱","̠":"̱","ࣱ":"ٌ","ࣨ":"ٌ","ࣥ":"ٌ",ﱞ:"ﹲّ","ࣲ":"ٍ",ﱟ:"ﹴّ",ﳲ:"ﹷّ",ﱠ:"ﹶّ",ﳳ:"ﹹّ",ﱡ:"ﹸّ","ؚ":"ِ","̗":"ِ",ﳴ:"ﹻّ",ﱢ:"ﹺّ",ﱣ:"ﹼٰ","ٟ":"ٕ","̍":"ٰ","݂":"ܼ","ਃ":"ঃ","ః":"ঃ","ಃ":"ঃ","ഃ":"ঃ","ඃ":"ঃ","း":"ঃ","𑓁":"ঃ","់":"่","່":"่","້":"้","໊":"๊","໋":"๋","꙯":"⃩","\u2028":" ","\u2029":" "," ":" "," ":" "," ":" "," ":" "," ":" "," ":" "," ":" "," ":" "," ":" "," ":" "," ":" "," ":" "," ":" "," ":" "," ":" ",ߺ:"_","﹍":"_","﹎":"_","﹏":"_","‐":"-","‑":"-","‒":"-","–":"-","﹘":"-","۔":"-","⁃":"-","˗":"-","−":"-","➖":"-",Ⲻ:"-","⨩":"-̓","⸚":"-̈","﬩":"-̇","∸":"-̇","⨪":"-̣","꓾":"-.","～":"〜","؍":",","٫":",","‚":",","¸":",",ꓹ:",","⸲":"،","٬":"،",";":";","⸵":"؛","ः":":","ઃ":":","：":":","։":":","܃":":","܄":":","᛬":":","︰":":","᠃":":","᠉":":","⁚":":","׃":":","˸":":","꞉":":","∶":":",ː:":",ꓽ:":","⩴":"::=","⧴":":→","！":"!",ǃ:"!",ⵑ:"!","‼":"!!","⁉":"!?",ʔ:"?",Ɂ:"?",ॽ:"?",Ꭾ:"?",ꛫ:"?","⁈":"?!","⁇":"??","⸮":"؟","𝅭":".","․":".","܁":".","܂":".","꘎":".","𐩐":".","٠":".","۰":".",ꓸ:".",ꓻ:".,","‥":"..",ꓺ:"..","…":"...","꛴":"꛳꛳","・":"·","･":"·","᛫":"·","·":"·","⸱":"·","𐄁":"·","•":"·","‧":"·","∙":"·","⋅":"·",ꞏ:"·",ᐧ:"·","⋯":"···",ⵈ:"···",ᑄ:"·<","⋗":"·>",ᐷ:"·>",ᑀ:"·>",ᔯ:"·4",ᑾ:"·b",ᒀ:"·ḃ",ᑺ:"·d",ᒘ:"·J",ᒶ:"·L",ᑶ:"·P",ᑗ:"·U",ᐺ:"·V",ᐼ:"·Ʌ",ᒮ:"·Γ",ᐎ:"·Δ",ᑙ:"·Ո",ᐌ:"·ᐁ",ᐐ:"·ᐄ",ᐒ:"·ᐅ",ᐔ:"·ᐆ",ᐗ:"·ᐊ",ᐙ:"·ᐋ",ᐾ:"·ᐲ",ᑂ:"·ᐴ",ᑆ:"·ᐹ",ᑛ:"·ᑏ",ᑔ:"·ᑐ",ᑝ:"·ᑐ",ᑟ:"·ᑑ",ᑡ:"·ᑕ",ᑣ:"·ᑖ",ᑴ:"·ᑫ",ᑸ:"·ᑮ",ᑼ:"·ᑰ",ᒒ:"·ᒉ",ᒔ:"·ᒋ",ᒖ:"·ᒌ",ᒚ:"·ᒎ",ᒜ:"·ᒐ",ᒞ:"·ᒑ",ᒬ:"·ᒣ",ᒰ:"·ᒦ",ᒲ:"·ᒧ",ᒴ:"·ᒨ",ᒸ:"·ᒫ",ᓉ:"·ᓀ",ᣆ:"·ᓂ",ᣈ:"·ᓃ",ᣊ:"·ᓄ",ᣌ:"·ᓅ",ᓋ:"·ᓇ",ᓍ:"·ᓈ",ᓜ:"·ᓓ",ᓞ:"·ᓕ",ᓠ:"·ᓖ",ᓢ:"·ᓗ",ᓤ:"·ᓘ",ᓦ:"·ᓚ",ᓨ:"·ᓛ",ᓶ:"·ᓭ",ᓸ:"·ᓯ",ᓺ:"·ᓰ",ᓼ:"·ᓱ",ᓾ:"·ᓲ",ᔀ:"·ᓴ",ᔂ:"·ᓵ",ᔗ:"·ᔐ",ᔙ:"·ᔑ",ᔛ:"·ᔒ",ᔝ:"·ᔓ",ᔟ:"·ᔔ",ᔡ:"·ᔕ",ᔣ:"·ᔖ",ᔱ:"·ᔨ",ᔳ:"·ᔩ",ᔵ:"·ᔪ",ᔷ:"·ᔫ",ᔹ:"·ᔭ",ᔻ:"·ᔮ",ᣎ:"·ᕃ",ᣏ:"·ᕆ",ᣐ:"·ᕇ",ᣑ:"·ᕈ",ᣒ:"·ᕉ",ᣓ:"·ᕋ",ᕎ:"·ᕌ",ᕛ:"·ᕚ",ᕨ:"·ᕧ",ᢳ:"·ᢱ",ᢶ:"·ᢴ",ᢹ:"·ᢸ",ᣂ:"·ᣀ","꠰":"।","॥":"।।","᰼":"᰻᰻","။":"၊၊","᪩":"᪨᪨","᪫":"᪪᪨","᭟":"᭞᭞","𐩗":"𐩖𐩖","𑑌":"𑑋𑑋","𑙂":"𑙁𑙁","𑱂":"𑱁𑱁","᱿":"᱾᱾","՝":"'","＇":"'","‘":"'","’":"'","‛":"'","′":"'","‵":"'","՚":"'","׳":"'","`":"'","`":"'","｀":"'","´":"'","΄":"'","´":"'","᾽":"'","᾿":"'","῾":"'",ʹ:"'",ʹ:"'",ˈ:"'",ˊ:"'",ˋ:"'","˴":"'",ʻ:"'",ʽ:"'",ʼ:"'",ʾ:"'",ꞌ:"'",י:"'",ߴ:"'",ߵ:"'",ᑊ:"'",ᛌ:"'","𖽑":"'","𖽒":"'","᳓":"''",'"':"''","＂":"''","“":"''","”":"''","‟":"''","″":"''","‶":"''","〃":"''","״":"''","˝":"''",ʺ:"''","˶":"''",ˮ:"''",ײ:"''","‴":"'''","‷":"'''","⁗":"''''",Ɓ:"'B",Ɗ:"'D",ŉ:"'n",Ƥ:"'P",Ƭ:"'T",Ƴ:"'Y","［":"(","❨":"(","❲":"(","〔":"(","﴾":"(","⸨":"((","㈠":"(ー)","⑵":"(2)","⒇":"(2O)","⑶":"(3)","⑷":"(4)","⑸":"(5)","⑹":"(6)","⑺":"(7)","⑻":"(8)","⑼":"(9)","⒜":"(a)","🄐":"(A)","⒝":"(b)","🄑":"(B)","⒞":"(c)","🄒":"(C)","⒟":"(d)","🄓":"(D)","⒠":"(e)","🄔":"(E)","⒡":"(f)","🄕":"(F)","⒢":"(g)","🄖":"(G)","⒣":"(h)","🄗":"(H)","⒤":"(i)","⒥":"(j)","🄙":"(J)","⒦":"(k)","🄚":"(K)","⑴":"(l)","🄘":"(l)","⒧":"(l)","🄛":"(L)","⑿":"(l2)","⒀":"(l3)","⒁":"(l4)","⒂":"(l5)","⒃":"(l6)","⒄":"(l7)","⒅":"(l8)","⒆":"(l9)","⑾":"(ll)","⑽":"(lO)","🄜":"(M)","⒩":"(n)","🄝":"(N)","⒪":"(o)","🄞":"(O)","⒫":"(p)","🄟":"(P)","⒬":"(q)","🄠":"(Q)","⒭":"(r)","🄡":"(R)","⒨":"(rn)","⒮":"(s)","🄢":"(S)","🄪":"(S)","⒯":"(t)","🄣":"(T)","⒰":"(u)","🄤":"(U)","⒱":"(v)","🄥":"(V)","⒲":"(w)","🄦":"(W)","⒳":"(x)","🄧":"(X)","⒴":"(y)","🄨":"(Y)","⒵":"(z)","🄩":"(Z)","㈀":"(ᄀ)","㈎":"(가)","㈁":"(ᄂ)","㈏":"(나)","㈂":"(ᄃ)","㈐":"(다)","㈃":"(ᄅ)","㈑":"(라)","㈄":"(ᄆ)","㈒":"(마)","㈅":"(ᄇ)","㈓":"(바)","㈆":"(ᄉ)","㈔":"(사)","㈇":"(ᄋ)","㈕":"(아)","㈝":"(오전)","㈞":"(오후)","㈈":"(ᄌ)","㈖":"(자)","㈜":"(주)","㈉":"(ᄎ)","㈗":"(차)","㈊":"(ᄏ)","㈘":"(카)","㈋":"(ᄐ)","㈙":"(타)","㈌":"(ᄑ)","㈚":"(파)","㈍":"(ᄒ)","㈛":"(하)","㈦":"(七)","㈢":"(三)","🉁":"(三)","㈨":"(九)","㈡":"(二)","🉂":"(二)","㈤":"(五)","㈹":"(代)","㈽":"(企)","㉁":"(休)","㈧":"(八)","㈥":"(六)","㈸":"(労)","🉇":"(勝)","㈩":"(十)","㈿":"(協)","㈴":"(名)","㈺":"(呼)","㈣":"(四)","㈯":"(土)","㈻":"(学)","🉃":"(安)","🉅":"(打)","🉈":"(敗)","㈰":"(日)","㈪":"(月)","㈲":"(有)","㈭":"(木)","🉀":"(本)","㈱":"(株)","㈬":"(水)","㈫":"(火)","🉄":"(点)","㈵":"(特)","🉆":"(盗)","㈼":"(監)","㈳":"(社)","㈷":"(祝)","㉀":"(祭)","㉂":"(自)","㉃":"(至)","㈶":"(財)","㈾":"(資)","㈮":"(金)","］":")","❩":")","❳":")","〕":")","﴿":")","⸩":"))","❴":"{","𝄔":"{","❵":"}","〚":"⟦","〛":"⟧","⟨":"❬","〈":"❬","〈":"❬","㇛":"❬",く:"❬",𡿨:"❬","⟩":"❭","〉":"❭","〉":"❭","＾":"︿","⸿":"¶","⁎":"*","٭":"*","∗":"*",𐌟:"*","᜵":"/","⁁":"/","∕":"/","⁄":"/","╱":"/","⟋":"/","⧸":"/","𝈺":"/","㇓":"/",〳:"/",Ⳇ:"/",ノ:"/",丿:"/","⼃":"/","⧶":"/̄","⫽":"//","⫻":"///","＼":"\\","﹨":"\\","∖":"\\","⟍":"\\","⧵":"\\","⧹":"\\","𝈏":"\\","𝈻":"\\","㇔":"\\",丶:"\\","⼂":"\\","⳹":"\\\\","⑊":"\\\\","⟈":"\\ᑕ",ꝸ:"&","૰":"॰","𑂻":"॰","𑇇":"॰","⚬":"॰","𑇛":"꣼","៙":"๏","៕":"๚","៚":"๛","༌":"་","༎":"།།","˄":"^",ˆ:"^","꙾":"ˇ","˘":"ˇ","‾":"ˉ","﹉":"ˉ","﹊":"ˉ","﹋":"ˉ","﹌":"ˉ","¯":"ˉ","￣":"ˉ","▔":"ˉ",ъ:"ˉb",ꙑ:"ˉbi","͵":"ˏ","˻":"˪","꜖":"˪","꜔":"˫","。":"˳","⸰":"°","˚":"°","∘":"°","○":"°","◦":"°","⍜":"°̲","⍤":"°̈","℃":"°C","℉":"°F","௵":"௳","༛":"༚༚","༟":"༚༝","࿎":"༝༚","༞":"༝༝","Ⓒ":"©","Ⓡ":"®","Ⓟ":"℗","𝈛":"⅄","⯬":"↞","⯭":"↟","⯮":"↠","⯯":"↡","↵":"↲","⥥":"⇃⇂","⥯":"⇃ᛚ","𝛛":"∂","𝜕":"∂","𝝏":"∂","𝞉":"∂","𝟃":"∂","𞣌":"∂","𞣍":"∂̵",ð:"∂̵","⌀":"∅","𝛁":"∇","𝛻":"∇","𝜵":"∇","𝝯":"∇","𝞩":"∇",𑢨:"∇","⍢":"∇̈","⍫":"∇̴","█":"∎","■":"∎","⨿":"∐","᛭":"+","➕":"+",𐊛:"+","⨣":"+̂","⨢":"+̊","⨤":"+̃","∔":"+̇","⨥":"+̣","⨦":"+̰","⨧":"+₂","➗":"÷","‹":"<","❮":"<","˂":"<","𝈶":"<",ᐸ:"<",ᚲ:"<","⋖":"<·",Ⲵ:"<·",ᑅ:"<·","≪":"<<","⋘":"<<<","᐀":"=","⹀":"=","゠":"=","꓿":"=","≚":"=̆","≙":"=̂","≗":"=̊","≐":"=̇","≑":"=̣̇","⩮":"=⃰","⩵":"==","⩶":"===","≞":"=ͫ","›":">","❯":">","˃":">","𝈷":">",ᐳ:">",𖼿:">",ᑁ:">·","⪥":"><","≫":">>","⨠":">>","⋙":">>>","⁓":"~","˜":"~","῀":"~","∼":"~","⍨":"~̈","⸞":"~̇","⩪":"~̇","⸟":"~̣","𞣈":"∠","⋀":"∧","∯":"∮∮","∰":"∮∮∮","⸫":"∴","⸪":"∵","⸬":"∷","𑇞":"≈","♎":"≏","🝞":"≏","≣":"≡","⨃":"⊍","⨄":"⊎","𝈸":"⊏","𝈹":"⊐","⨅":"⊓","⨆":"⊔","⨂":"⊗","⍟":"⊛","🝱":"⊠","🝕":"⊡","◁":"⊲","▷":"⊳","⍣":"⋆̈","︴":"⌇","◠":"⌒","⨽":"⌙","⌥":"⌤","⧇":"⌻","◎":"⌾","⦾":"⌾","⧅":"⍂","⦰":"⍉","⏃":"⍋","⏂":"⍎","⏁":"⍕","⏆":"⍭","☸":"⎈","︵":"⏜","︶":"⏝","︷":"⏞","︸":"⏟","︹":"⏠","︺":"⏡","▱":"⏥","⏼":"⏻","︱":"│","｜":"│","┃":"│","┏":"┌","┣":"├","▐":"▌","▗":"▖","▝":"▘","☐":"□","￭":"▪","▸":"▶","►":"▶","⳩":"☧","🜊":"☩","🌒":"☽","🌙":"☽","⏾":"☾","🌘":"☾","⧙":"⦚","🜺":"⧟","⨾":"⨟","𐆠":"⳨","♩":"𝅘𝅥","♪":"𝅘𝅥𝅮","⓪":"🄍","↺":"🄎","˙":"ॱ",ൎ:"ॱ","－":"ー","—":"ー","―":"ー","─":"ー","━":"ー","㇐":"ー",ꟷ:"ー",ᅳ:"ー",ㅡ:"ー",一:"ー","⼀":"ー",ᆖ:"ーー",ힹ:"ーᅡ",ힺ:"ーᅥ",ힻ:"ーᅥ丨",ힼ:"ーᅩ",ᆕ:"ーᅮ",ᅴ:"ー丨",ㅢ:"ー丨",ᆗ:"ー丨ᅮ","🄏":"$⃠","₤":"£","〒":"₸","〶":"₸","᭜":"᭐","꧆":"꧐","𑓑":"১","೧":"౧",ၥ:"၁","①":"➀","⑩":"➉","⏨":"₁₀","𝟐":"2","𝟚":"2","𝟤":"2","𝟮":"2","𝟸":"2","🯲":"2",Ꝛ:"2",Ƨ:"2",Ϩ:"2",Ꙅ:"2",ᒿ:"2",ꛯ:"2",ꧏ:"٢","۲":"٢","૨":"२","𑓒":"২","೨":"౨","②":"➁",ƻ:"2̵","🄃":"2,","⒉":"2.","㏵":"22日","㍮":"22点","㏶":"23日","㍯":"23点","㏷":"24日","㍰":"24点","㏸":"25日","㏹":"26日","㏺":"27日","㏻":"28日","㏼":"29日","㏴":"2l日","㍭":"2l点","⒛":"2O.","㏳":"2O日","㍬":"2O点","෩":"෨ා","෯":"෨ී","㏡":"2日","㋁":"2月","㍚":"2点","𝈆":"3","𝟑":"3","𝟛":"3","𝟥":"3","𝟯":"3","𝟹":"3","🯳":"3",Ɜ:"3",Ȝ:"3",Ʒ:"3",Ꝫ:"3",Ⳍ:"3",З:"3",Ӡ:"3",𖼻:"3",𑣊:"3","۳":"٣","𞣉":"٣","૩":"३","③":"➂",Ҙ:"3̦","🄄":"3,","⒊":"3.","㏾":"3l日","㏽":"3O日","㏢":"3日","㋂":"3月","㍛":"3点","𝟒":"4","𝟜":"4","𝟦":"4","𝟰":"4","𝟺":"4","🯴":"4",Ꮞ:"4",𑢯:"4","۴":"٤","૪":"४","④":"➃","🄅":"4,","⒋":"4.",ᔰ:"4·","㏣":"4日","㋃":"4月","㍜":"4点","𝟓":"5","𝟝":"5","𝟧":"5","𝟱":"5","𝟻":"5","🯵":"5",Ƽ:"5",𑢻:"5","⑤":"➄","🄆":"5,","⒌":"5.","㏤":"5日","㋄":"5月","㍝":"5点","𝟔":"6","𝟞":"6","𝟨":"6","𝟲":"6","𝟼":"6","🯶":"6",Ⳓ:"6",б:"6",Ꮾ:"6",𑣕:"6","۶":"٦","𑓖":"৬","⑥":"➅","🄇":"6,","⒍":"6.","㏥":"6日","㋅":"6月","㍞":"6点","𝈒":"7","𝟕":"7","𝟟":"7","𝟩":"7","𝟳":"7","𝟽":"7","🯷":"7","𐓒":"7",𑣆:"7","⑦":"➆","🄈":"7,","⒎":"7.","㏦":"7日","㋆":"7月","㍟":"7点","ଃ":"8","৪":"8","੪":"8","𞣋":"8","𝟖":"8","𝟠":"8","𝟪":"8","𝟴":"8","𝟾":"8","🯸":"8",ȣ:"8",Ȣ:"8",𐌚:"8","૮":"८","⑧":"➇","🄉":"8,","⒏":"8.","㏧":"8日","㋇":"8月","㍠":"8点","੧":"9","୨":"9","৭":"9","൭":"9","𝟗":"9","𝟡":"9","𝟫":"9","𝟵":"9","𝟿":"9","🯹":"9",Ꝯ:"9",Ⳋ:"9",𑣌:"9",𑢬:"9",𑣖:"9","१":"٩","𑣤":"٩","۹":"٩","೯":"౯","⑨":"➈","🄊":"9,","⒐":"9.","㏨":"9日","㋈":"9月","㍡":"9点","⍺":"a",ａ:"a",𝐚:"a",𝑎:"a",𝒂:"a",𝒶:"a",𝓪:"a",𝔞:"a",𝕒:"a",𝖆:"a",𝖺:"a",𝗮:"a",𝘢:"a",𝙖:"a",𝚊:"a",ɑ:"a",α:"a",𝛂:"a",𝛼:"a",𝜶:"a",𝝰:"a",𝞪:"a",а:"a","ⷶ":"ͣ",Ａ:"A",𝐀:"A",𝐴:"A",𝑨:"A",𝒜:"A",𝓐:"A",𝔄:"A",𝔸:"A",𝕬:"A",𝖠:"A",𝗔:"A",𝘈:"A",𝘼:"A",𝙰:"A",Α:"A",𝚨:"A",𝛢:"A",𝜜:"A",𝝖:"A",𝞐:"A",А:"A",Ꭺ:"A",ᗅ:"A",ꓮ:"A",𖽀:"A",𐊠:"A","⍶":"a̲",ǎ:"ă",Ǎ:"Ă",ȧ:"å",Ȧ:"Å",ẚ:"ả","℀":"a/c","℁":"a/s",ꜳ:"aa",Ꜳ:"AA",æ:"ae",ӕ:"ae",Æ:"AE",Ӕ:"AE",ꜵ:"ao",Ꜵ:"AO","🜇":"AR",ꜷ:"au",Ꜷ:"AU",ꜹ:"av",ꜻ:"av",Ꜹ:"AV",Ꜻ:"AV",ꜽ:"ay",Ꜽ:"AY",ꭺ:"ᴀ","∀":"Ɐ","𝈗":"Ɐ",ᗄ:"Ɐ",ꓯ:"Ɐ",𐐟:"Ɒ",𝐛:"b",𝑏:"b",𝒃:"b",𝒷:"b",𝓫:"b",𝔟:"b",𝕓:"b",𝖇:"b",𝖻:"b",𝗯:"b",𝘣:"b",𝙗:"b",𝚋:"b",Ƅ:"b",Ь:"b",Ꮟ:"b",ᑲ:"b",ᖯ:"b",Ｂ:"B",ℬ:"B",𝐁:"B",𝐵:"B",𝑩:"B",𝓑:"B",𝔅:"B",𝔹:"B",𝕭:"B",𝖡:"B",𝗕:"B",𝘉:"B",𝘽:"B",𝙱:"B",Ꞵ:"B",Β:"B",𝚩:"B",𝛣:"B",𝜝:"B",𝝗:"B",𝞑:"B",В:"B",Ᏼ:"B",ᗷ:"B",ꓐ:"B",𐊂:"B",𐊡:"B",𐌁:"B",ɓ:"b̔",ᑳ:"ḃ",ƃ:"b̄",Ƃ:"b̄",Б:"b̄",ƀ:"b̵",ҍ:"b̵",Ҍ:"b̵",ѣ:"b̵",Ѣ:"b̵",ᑿ:"b·",ᒁ:"ḃ·",ᒈ:"b'",Ы:"bl",в:"ʙ",ᏼ:"ʙ",ｃ:"c",ⅽ:"c",𝐜:"c",𝑐:"c",𝒄:"c",𝒸:"c",𝓬:"c",𝔠:"c",𝕔:"c",𝖈:"c",𝖼:"c",𝗰:"c",𝘤:"c",𝙘:"c",𝚌:"c",ᴄ:"c",ϲ:"c",ⲥ:"c",с:"c",ꮯ:"c",𐐽:"c","ⷭ":"ͨ","🝌":"C","𑣲":"C","𑣩":"C",Ｃ:"C",Ⅽ:"C",ℂ:"C",ℭ:"C",𝐂:"C",𝐶:"C",𝑪:"C",𝒞:"C",𝓒:"C",𝕮:"C",𝖢:"C",𝗖:"C",𝘊:"C",𝘾:"C",𝙲:"C",Ϲ:"C",Ⲥ:"C",С:"C",Ꮯ:"C",ꓚ:"C",𐊢:"C",𐌂:"C",𐐕:"C",𐔜:"C","¢":"c̸",ȼ:"c̸","₡":"C⃫","🅮":"C⃠",ç:"c̦",ҫ:"c̦",Ç:"C̦",Ҫ:"C̦",Ƈ:"C'","℅":"c/o","℆":"c/u","🅭":"㏄\t⃝","⋴":"ꞓ",ɛ:"ꞓ",ε:"ꞓ",ϵ:"ꞓ",𝛆:"ꞓ",𝛜:"ꞓ",𝜀:"ꞓ",𝜖:"ꞓ",𝜺:"ꞓ",𝝐:"ꞓ",𝝴:"ꞓ",𝞊:"ꞓ",𝞮:"ꞓ",𝟄:"ꞓ",ⲉ:"ꞓ",є:"ꞓ",ԑ:"ꞓ",ꮛ:"ꞓ",𑣎:"ꞓ",𐐩:"ꞓ","€":"Ꞓ",Ⲉ:"Ꞓ",Є:"Ꞓ","⍷":"ꞓ̲",ͽ:"ꜿ",Ͽ:"Ꜿ",ⅾ:"d",ⅆ:"d",𝐝:"d",𝑑:"d",𝒅:"d",𝒹:"d",𝓭:"d",𝔡:"d",𝕕:"d",𝖉:"d",𝖽:"d",𝗱:"d",𝘥:"d",𝙙:"d",𝚍:"d",ԁ:"d",Ꮷ:"d",ᑯ:"d",ꓒ:"d",Ⅾ:"D",ⅅ:"D",𝐃:"D",𝐷:"D",𝑫:"D",𝒟:"D",𝓓:"D",𝔇:"D",𝔻:"D",𝕯:"D",𝖣:"D",𝗗:"D",𝘋:"D",𝘿:"D",𝙳:"D",Ꭰ:"D",ᗞ:"D",ᗪ:"D",ꓓ:"D",ɗ:"d̔",ɖ:"d̨",ƌ:"d̄",đ:"d̵",Đ:"D̵",Ð:"D̵",Ɖ:"D̵","₫":"ḏ̵",ꝺ:"Ꝺ",ᑻ:"d·",ᒇ:"d'",ʤ:"dȝ",ǳ:"dz",ʣ:"dz",ǲ:"Dz",Ǳ:"DZ",ǆ:"dž",ǅ:"Dž",Ǆ:"DŽ",ʥ:"dʑ",ꭰ:"ᴅ","⸹":"ẟ",δ:"ẟ",𝛅:"ẟ",𝛿:"ẟ",𝜹:"ẟ",𝝳:"ẟ",𝞭:"ẟ",ծ:"ẟ",ᕷ:"ẟ",℮:"e",ｅ:"e",ℯ:"e",ⅇ:"e",𝐞:"e",𝑒:"e",𝒆:"e",𝓮:"e",𝔢:"e",𝕖:"e",𝖊:"e",𝖾:"e",𝗲:"e",𝘦:"e",𝙚:"e",𝚎:"e",ꬲ:"e",е:"e",ҽ:"e","ⷷ":"ͤ","⋿":"E",Ｅ:"E",ℰ:"E",𝐄:"E",𝐸:"E",𝑬:"E",𝓔:"E",𝔈:"E",𝔼:"E",𝕰:"E",𝖤:"E",𝗘:"E",𝘌:"E",𝙀:"E",𝙴:"E",Ε:"E",𝚬:"E",𝛦:"E",𝜠:"E",𝝚:"E",𝞔:"E",Е:"E",ⴹ:"E",Ꭼ:"E",ꓰ:"E",𑢦:"E",𑢮:"E",𐊆:"E",ě:"ĕ",Ě:"Ĕ",ɇ:"e̸",Ɇ:"E̸",ҿ:"ę",ꭼ:"ᴇ",ə:"ǝ",ә:"ǝ","∃":"Ǝ",ⴺ:"Ǝ",ꓱ:"Ǝ",ɚ:"ǝ˞",ᴔ:"ǝo",ꭁ:"ǝo̸",ꭂ:"ǝo̵",Ә:"Ə","𝈡":"Ɛ",ℇ:"Ɛ",Ԑ:"Ɛ",Ꮛ:"Ɛ",𖼭:"Ɛ",𐐁:"Ɛ",ᶟ:"ᵋ",ᴈ:"ɜ",з:"ɜ",ҙ:"ɜ̦",𐑂:"ɞ",ꞝ:"ʚ",𐐪:"ʚ",𝐟:"f",𝑓:"f",𝒇:"f",𝒻:"f",𝓯:"f",𝔣:"f",𝕗:"f",𝖋:"f",𝖿:"f",𝗳:"f",𝘧:"f",𝙛:"f",𝚏:"f",ꬵ:"f",ꞙ:"f",ſ:"f",ẝ:"f",ք:"f","𝈓":"F",ℱ:"F",𝐅:"F",𝐹:"F",𝑭:"F",𝓕:"F",𝔉:"F",𝔽:"F",𝕱:"F",𝖥:"F",𝗙:"F",𝘍:"F",𝙁:"F",𝙵:"F",Ꞙ:"F",Ϝ:"F",𝟊:"F",ᖴ:"F",ꓝ:"F",𑣂:"F",𑢢:"F",𐊇:"F",𐊥:"F",𐔥:"F",ƒ:"f̦",Ƒ:"F̦",ᵮ:"f̴","℻":"FAX",ﬀ:"ff",ﬃ:"ffi",ﬄ:"ffl",ﬁ:"fi",ﬂ:"fl",ʩ:"fŋ",ᖵ:"Ⅎ",ꓞ:"Ⅎ","𝈰":"ꟻ",ᖷ:"ꟻ",ｇ:"g",ℊ:"g",𝐠:"g",𝑔:"g",𝒈:"g",𝓰:"g",𝔤:"g",𝕘:"g",𝖌:"g",𝗀:"g",𝗴:"g",𝘨:"g",𝙜:"g",𝚐:"g",ɡ:"g",ᶃ:"g",ƍ:"g",ց:"g",𝐆:"G",𝐺:"G",𝑮:"G",𝒢:"G",𝓖:"G",𝔊:"G",𝔾:"G",𝕲:"G",𝖦:"G",𝗚:"G",𝘎:"G",𝙂:"G",𝙶:"G",Ԍ:"G",Ꮐ:"G",Ᏻ:"G",ꓖ:"G",ᶢ:"ᵍ",ɠ:"g̔",ǧ:"ğ",Ǧ:"Ğ",ǵ:"ģ",ǥ:"g̵",Ǥ:"G̵",Ɠ:"G'",ԍ:"ɢ",ꮐ:"ɢ",ᏻ:"ɢ",ｈ:"h",ℎ:"h",𝐡:"h",𝒉:"h",𝒽:"h",𝓱:"h",𝔥:"h",𝕙:"h",𝖍:"h",𝗁:"h",𝗵:"h",𝘩:"h",𝙝:"h",𝚑:"h",һ:"h",հ:"h",Ꮒ:"h",Ｈ:"H",ℋ:"H",ℌ:"H",ℍ:"H",𝐇:"H",𝐻:"H",𝑯:"H",𝓗:"H",𝕳:"H",𝖧:"H",𝗛:"H",𝘏:"H",𝙃:"H",𝙷:"H",Η:"H",𝚮:"H",𝛨:"H",𝜢:"H",𝝜:"H",𝞖:"H",Ⲏ:"H",Н:"H",Ꮋ:"H",ᕼ:"H",ꓧ:"H",𐋏:"H",ᵸ:"ᴴ",ɦ:"h̔",ꚕ:"h̔",Ᏺ:"h̔",Ⱨ:"H̩",Ң:"H̩",ħ:"h̵",ℏ:"h̵",ћ:"h̵",Ħ:"H̵",Ӊ:"H̦",Ӈ:"H̦",н:"ʜ",ꮋ:"ʜ",ң:"ʜ̩",ӊ:"ʜ̦",ӈ:"ʜ̦",Ԋ:"Ƕ",ꮀ:"ⱶ",Ͱ:"Ⱶ",Ꭸ:"Ⱶ",Ꮀ:"Ⱶ",ꚱ:"Ⱶ",ꞕ:"ꜧ","˛":"i","⍳":"i",ｉ:"i",ⅰ:"i",ℹ:"i",ⅈ:"i",𝐢:"i",𝑖:"i",𝒊:"i",𝒾:"i",𝓲:"i",𝔦:"i",𝕚:"i",𝖎:"i",𝗂:"i",𝗶:"i",𝘪:"i",𝙞:"i",𝚒:"i",ı:"i",𝚤:"i",ɪ:"i",ɩ:"i",ι:"i",ι:"i",ͺ:"i",𝛊:"i",𝜄:"i",𝜾:"i",𝝸:"i",𝞲:"i",і:"i",ꙇ:"i",ӏ:"i",ꭵ:"i",Ꭵ:"i",𑣃:"i","ⓛ":"Ⓘ","⍸":"i̲",ǐ:"ĭ",Ǐ:"Ĭ",ɨ:"i̵",ᵻ:"i̵",ᵼ:"i̵",ⅱ:"ii",ⅲ:"iii",ĳ:"ij",ⅳ:"iv",ⅸ:"ix",ｊ:"j",ⅉ:"j",𝐣:"j",𝑗:"j",𝒋:"j",𝒿:"j",𝓳:"j",𝔧:"j",𝕛:"j",𝖏:"j",𝗃:"j",𝗷:"j",𝘫:"j",𝙟:"j",𝚓:"j",ϳ:"j",ј:"j",Ｊ:"J",𝐉:"J",𝐽:"J",𝑱:"J",𝒥:"J",𝓙:"J",𝔍:"J",𝕁:"J",𝕵:"J",𝖩:"J",𝗝:"J",𝘑:"J",𝙅:"J",𝙹:"J",Ʝ:"J",Ϳ:"J",Ј:"J",Ꭻ:"J",ᒍ:"J",ꓙ:"J",ɉ:"j̵",Ɉ:"J̵",ᒙ:"J·",𝚥:"ȷ",յ:"ȷ",ꭻ:"ᴊ",𝐤:"k",𝑘:"k",𝒌:"k",𝓀:"k",𝓴:"k",𝔨:"k",𝕜:"k",𝖐:"k",𝗄:"k",𝗸:"k",𝘬:"k",𝙠:"k",𝚔:"k",K:"K",Ｋ:"K",𝐊:"K",𝐾:"K",𝑲:"K",𝒦:"K",𝓚:"K",𝔎:"K",𝕂:"K",𝕶:"K",𝖪:"K",𝗞:"K",𝘒:"K",𝙆:"K",𝙺:"K",Κ:"K",𝚱:"K",𝛫:"K",𝜥:"K",𝝟:"K",𝞙:"K",Ⲕ:"K",К:"K",Ꮶ:"K",ᛕ:"K",ꓗ:"K",𐔘:"K",ƙ:"k̔",Ⱪ:"K̩",Қ:"K̩","₭":"K̵",Ꝁ:"K̵",Ҟ:"K̵",Ƙ:"K'","׀":"l","|":"l","∣":"l","⏽":"l","￨":"l","١":"l","۱":"l","𐌠":"l","𞣇":"l","𝟏":"l","𝟙":"l","𝟣":"l","𝟭":"l","𝟷":"l","🯱":"l",I:"l",Ｉ:"l",Ⅰ:"l",ℐ:"l",ℑ:"l",𝐈:"l",𝐼:"l",𝑰:"l",𝓘:"l",𝕀:"l",𝕴:"l",𝖨:"l",𝗜:"l",𝘐:"l",𝙄:"l",𝙸:"l",Ɩ:"l",ｌ:"l",ⅼ:"l",ℓ:"l",𝐥:"l",𝑙:"l",𝒍:"l",𝓁:"l",𝓵:"l",𝔩:"l",𝕝:"l",𝖑:"l",𝗅:"l",𝗹:"l",𝘭:"l",𝙡:"l",𝚕:"l",ǀ:"l",Ι:"l",𝚰:"l",𝛪:"l",𝜤:"l",𝝞:"l",𝞘:"l",Ⲓ:"l",І:"l",Ӏ:"l",ו:"l",ן:"l",ا:"l",𞸀:"l",𞺀:"l",ﺎ:"l",ﺍ:"l",ߊ:"l",ⵏ:"l",ᛁ:"l",ꓲ:"l",𖼨:"l",𐊊:"l",𐌉:"l","𝈪":"L",Ⅼ:"L",ℒ:"L",𝐋:"L",𝐿:"L",𝑳:"L",𝓛:"L",𝔏:"L",𝕃:"L",𝕷:"L",𝖫:"L",𝗟:"L",𝘓:"L",𝙇:"L",𝙻:"L",Ⳑ:"L",Ꮮ:"L",ᒪ:"L",ꓡ:"L",𖼖:"L",𑢣:"L",𑢲:"L",𐐛:"L",𐔦:"L",ﴼ:"l̋",ﴽ:"l̋",ł:"l̸",Ł:"L̸",ɭ:"l̨",Ɨ:"l̵",ƚ:"l̵",ɫ:"l̴",إ:"lٕ",ﺈ:"lٕ",ﺇ:"lٕ",ٳ:"lٕ",ŀ:"l·",Ŀ:"l·",ᒷ:"l·","🄂":"l,","⒈":"l.",ױ:"l'","⒓":"l2.","㏫":"l2日","㋋":"l2月","㍤":"l2点","⒔":"l3.","㏬":"l3日","㍥":"l3点","⒕":"l4.","㏭":"l4日","㍦":"l4点","⒖":"l5.","㏮":"l5日","㍧":"l5点","⒗":"l6.","㏯":"l6日","㍨":"l6点","⒘":"l7.","㏰":"l7日","㍩":"l7点","⒙":"l8.","㏱":"l8日","㍪":"l8点","⒚":"l9.","㏲":"l9日","㍫":"l9点",ǉ:"lj",Ĳ:"lJ",ǈ:"Lj",Ǉ:"LJ","‖":"ll","∥":"ll",Ⅱ:"ll",ǁ:"ll",װ:"ll","𐆙":"l̵l̵","⒒":"ll.",Ⅲ:"lll","𐆘":"l̵l̵S̵","㏪":"ll日","㋊":"ll月","㍣":"ll点",Ю:"lO","⒑":"lO.","㏩":"lO日","㋉":"lO月","㍢":"lO点",ʪ:"ls","₶":"lt",Ⅳ:"lV",Ⅸ:"lX",ɮ:"lȝ",ʫ:"lz",أ:"lٴ",ﺄ:"lٴ",ﺃ:"lٴ",ٲ:"lٴ",ٵ:"lٴ",ﷳ:"lكبر",ﷲ:"lللّٰo","㏠":"l日","㋀":"l月","㍙":"l点",ⳑ:"ʟ",ꮮ:"ʟ",𐑃:"ʟ",Ｍ:"M",Ⅿ:"M",ℳ:"M",𝐌:"M",𝑀:"M",𝑴:"M",𝓜:"M",𝔐:"M",𝕄:"M",𝕸:"M",𝖬:"M",𝗠:"M",𝘔:"M",𝙈:"M",𝙼:"M",Μ:"M",𝚳:"M",𝛭:"M",𝜧:"M",𝝡:"M",𝞛:"M",Ϻ:"M",Ⲙ:"M",М:"M",Ꮇ:"M",ᗰ:"M",ᛖ:"M",ꓟ:"M",𐊰:"M",𐌑:"M",Ӎ:"M̦","🝫":"MB","ⷨ":"ᷟ",𝐧:"n",𝑛:"n",𝒏:"n",𝓃:"n",𝓷:"n",𝔫:"n",𝕟:"n",𝖓:"n",𝗇:"n",𝗻:"n",𝘯:"n",𝙣:"n",𝚗:"n",ո:"n",ռ:"n",Ｎ:"N",ℕ:"N",𝐍:"N",𝑁:"N",𝑵:"N",𝒩:"N",𝓝:"N",𝔑:"N",𝕹:"N",𝖭:"N",𝗡:"N",𝘕:"N",𝙉:"N",𝙽:"N",Ν:"N",𝚴:"N",𝛮:"N",𝜨:"N",𝝢:"N",𝞜:"N",Ⲛ:"N",ꓠ:"N",𐔓:"N","𐆎":"N̊",ɳ:"n̨",ƞ:"n̩",η:"n̩",𝛈:"n̩",𝜂:"n̩",𝜼:"n̩",𝝶:"n̩",𝞰:"n̩",Ɲ:"N̦",ᵰ:"n̴",ǌ:"nj",ǋ:"Nj",Ǌ:"NJ","№":"No",ͷ:"ᴎ",и:"ᴎ",𐑍:"ᴎ",ņ:"ɲ","ం":"o","ಂ":"o","ം":"o","ං":"o","०":"o","੦":"o","૦":"o","௦":"o","౦":"o","೦":"o","൦":"o","๐":"o","໐":"o","၀":"o","٥":"o","۵":"o",ｏ:"o",ℴ:"o",𝐨:"o",𝑜:"o",𝒐:"o",𝓸:"o",𝔬:"o",𝕠:"o",𝖔:"o",𝗈:"o",𝗼:"o",𝘰:"o",𝙤:"o",𝚘:"o",ᴏ:"o",ᴑ:"o",ꬽ:"o",ο:"o",𝛐:"o",𝜊:"o",𝝄:"o",𝝾:"o",𝞸:"o",σ:"o",𝛔:"o",𝜎:"o",𝝈:"o",𝞂:"o",𝞼:"o",ⲟ:"o",о:"o",ჿ:"o",օ:"o",ס:"o",ه:"o",𞸤:"o",𞹤:"o",𞺄:"o",ﻫ:"o",ﻬ:"o",ﻪ:"o",ﻩ:"o",ھ:"o",ﮬ:"o",ﮭ:"o",ﮫ:"o",ﮪ:"o",ہ:"o",ﮨ:"o",ﮩ:"o",ﮧ:"o",ﮦ:"o",ە:"o",ഠ:"o",ဝ:"o","𐓪":"o",𑣈:"o",𑣗:"o",𐐬:"o","߀":"O","০":"O","୦":"O",〇:"O","𑓐":"O","𑣠":"O","𝟎":"O","𝟘":"O","𝟢":"O","𝟬":"O","𝟶":"O","🯰":"O",Ｏ:"O",𝐎:"O",𝑂:"O",𝑶:"O",𝒪:"O",𝓞:"O",𝔒:"O",𝕆:"O",𝕺:"O",𝖮:"O",𝗢:"O",𝘖:"O",𝙊:"O",𝙾:"O",Ο:"O",𝚶:"O",𝛰:"O",𝜪:"O",𝝤:"O",𝞞:"O",Ⲟ:"O",О:"O",Օ:"O",ⵔ:"O",ዐ:"O",ଠ:"O","𐓂":"O",ꓳ:"O",𑢵:"O",𐊒:"O",𐊫:"O",𐐄:"O",𐔖:"O","⁰":"º",ᵒ:"º",ǒ:"ŏ",Ǒ:"Ŏ",ۿ:"ô",Ő:"Ö",ø:"o̸",ꬾ:"o̸",Ø:"O̸",ⵁ:"O̸",Ǿ:"Ó̸",ɵ:"o̵",ꝋ:"o̵",ө:"o̵",ѳ:"o̵",ꮎ:"o̵",ꮻ:"o̵","⊖":"O̵","⊝":"O̵","⍬":"O̵","𝈚":"O̵","🜔":"O̵",Ɵ:"O̵",Ꝋ:"O̵",θ:"O̵",ϑ:"O̵",𝛉:"O̵",𝛝:"O̵",𝜃:"O̵",𝜗:"O̵",𝜽:"O̵",𝝑:"O̵",𝝷:"O̵",𝞋:"O̵",𝞱:"O̵",𝟅:"O̵",Θ:"O̵",ϴ:"O̵",𝚯:"O̵",𝚹:"O̵",𝛩:"O̵",𝛳:"O̵",𝜣:"O̵",𝜭:"O̵",𝝝:"O̵",𝝧:"O̵",𝞗:"O̵",𝞡:"O̵",Ө:"O̵",Ѳ:"O̵",ⴱ:"O̵",Ꮎ:"O̵",Ꮻ:"O̵",ꭴ:"ơ",ﳙ:"oٰ","🄁":"O,","🄀":"O.",ơ:"o'",Ơ:"O'",Ꭴ:"O'","%":"º/₀","٪":"º/₀","⁒":"º/₀","‰":"º/₀₀","؉":"º/₀₀","‱":"º/₀₀₀","؊":"º/₀₀₀",œ:"oe",Œ:"OE",ɶ:"oᴇ","∞":"oo",ꝏ:"oo",ꚙ:"oo",Ꝏ:"OO",Ꚙ:"OO",ﳗ:"oج",ﱑ:"oج",ﳘ:"oم",ﱒ:"oم",ﶓ:"oمج",ﶔ:"oمم",ﱓ:"oى",ﱔ:"oى",ൟ:"oരo",တ:"oာ","㍘":"O点",ↄ:"ɔ",ᴐ:"ɔ",ͻ:"ɔ",𐑋:"ɔ",Ↄ:"Ɔ",Ͻ:"Ɔ",ꓛ:"Ɔ",𐐣:"Ɔ",ꬿ:"ɔ̸",ꭢ:"ɔe",𐐿:"ɷ","⍴":"p",ｐ:"p",𝐩:"p",𝑝:"p",𝒑:"p",𝓅:"p",𝓹:"p",𝔭:"p",𝕡:"p",𝖕:"p",𝗉:"p",𝗽:"p",𝘱:"p",𝙥:"p",𝚙:"p",ρ:"p",ϱ:"p",𝛒:"p",𝛠:"p",𝜌:"p",𝜚:"p",𝝆:"p",𝝔:"p",𝞀:"p",𝞎:"p",𝞺:"p",𝟈:"p",ⲣ:"p",р:"p",Ｐ:"P",ℙ:"P",𝐏:"P",𝑃:"P",𝑷:"P",𝒫:"P",𝓟:"P",𝔓:"P",𝕻:"P",𝖯:"P",𝗣:"P",𝘗:"P",𝙋:"P",𝙿:"P",Ρ:"P",𝚸:"P",𝛲:"P",𝜬:"P",𝝦:"P",𝞠:"P",Ⲣ:"P",Р:"P",Ꮲ:"P",ᑭ:"P",ꓑ:"P",𐊕:"P",ƥ:"p̔",ᵽ:"p̵",ᑷ:"p·",ᒆ:"P'",ᴩ:"ᴘ",ꮲ:"ᴘ",φ:"ɸ",ϕ:"ɸ",𝛗:"ɸ",𝛟:"ɸ",𝜑:"ɸ",𝜙:"ɸ",𝝋:"ɸ",𝝓:"ɸ",𝞅:"ɸ",𝞍:"ɸ",𝞿:"ɸ",𝟇:"ɸ",ⲫ:"ɸ",ф:"ɸ",𝐪:"q",𝑞:"q",𝒒:"q",𝓆:"q",𝓺:"q",𝔮:"q",𝕢:"q",𝖖:"q",𝗊:"q",𝗾:"q",𝘲:"q",𝙦:"q",𝚚:"q",ԛ:"q",գ:"q",զ:"q",ℚ:"Q",𝐐:"Q",𝑄:"Q",𝑸:"Q",𝒬:"Q",𝓠:"Q",𝔔:"Q",𝕼:"Q",𝖰:"Q",𝗤:"Q",𝘘:"Q",𝙌:"Q",𝚀:"Q",ⵕ:"Q",ʠ:"q̔","🜀":"QE",ᶐ:"ɋ",ᴋ:"ĸ",κ:"ĸ",ϰ:"ĸ",𝛋:"ĸ",𝛞:"ĸ",𝜅:"ĸ",𝜘:"ĸ",𝜿:"ĸ",𝝒:"ĸ",𝝹:"ĸ",𝞌:"ĸ",𝞳:"ĸ",𝟆:"ĸ",ⲕ:"ĸ",к:"ĸ",ꮶ:"ĸ",қ:"ĸ̩",ҟ:"ĸ̵",𝐫:"r",𝑟:"r",𝒓:"r",𝓇:"r",𝓻:"r",𝔯:"r",𝕣:"r",𝖗:"r",𝗋:"r",𝗿:"r",𝘳:"r",𝙧:"r",𝚛:"r",ꭇ:"r",ꭈ:"r",ᴦ:"r",ⲅ:"r",г:"r",ꮁ:"r","𝈖":"R",ℛ:"R",ℜ:"R",ℝ:"R",𝐑:"R",𝑅:"R",𝑹:"R",𝓡:"R",𝕽:"R",𝖱:"R",𝗥:"R",𝘙:"R",𝙍:"R",𝚁:"R",Ʀ:"R",Ꭱ:"R",Ꮢ:"R","𐒴":"R",ᖇ:"R",ꓣ:"R",𖼵:"R",ɽ:"r̨",ɼ:"r̩",ɍ:"r̵",ғ:"r̵",ᵲ:"r̴",ґ:"r'","𑣣":"rn",m:Wre,ⅿ:"rn",𝐦:"rn",𝑚:"rn",𝒎:"rn",𝓂:"rn",𝓶:"rn",𝔪:"rn",𝕞:"rn",𝖒:"rn",𝗆:"rn",𝗺:"rn",𝘮:"rn",𝙢:"rn",𝚖:"rn",𑜀:"rn","₥":"rn̸",ɱ:"rn̦",ᵯ:"rn̴","₨":"Rs",ꭱ:"ʀ",ꮢ:"ʀ",я:"ᴙ",ᵳ:"ɾ̴","℩":"ɿ",ｓ:"s",𝐬:"s",𝑠:"s",𝒔:"s",𝓈:"s",𝓼:"s",𝔰:"s",𝕤:"s",𝖘:"s",𝗌:"s",𝘀:"s",𝘴:"s",𝙨:"s",𝚜:"s",ꜱ:"s",ƽ:"s",ѕ:"s",ꮪ:"s",𑣁:"s",𐑈:"s",Ｓ:"S",𝐒:"S",𝑆:"S",𝑺:"S",𝒮:"S",𝓢:"S",𝔖:"S",𝕊:"S",𝕾:"S",𝖲:"S",𝗦:"S",𝘚:"S",𝙎:"S",𝚂:"S",Ѕ:"S",Տ:"S",Ꮥ:"S",Ꮪ:"S",ꓢ:"S",𖼺:"S",𐊖:"S",𐐠:"S",ʂ:"s̨",ᵴ:"s̴",ꞵ:"ß",β:"ß",ϐ:"ß",𝛃:"ß",𝛽:"ß",𝜷:"ß",𝝱:"ß",𝞫:"ß",Ᏸ:"ß","🝜":"sss",ﬆ:"st","∫":"ʃ",ꭍ:"ʃ","∑":"Ʃ","⅀":"Ʃ",Σ:"Ʃ",𝚺:"Ʃ",𝛴:"Ʃ",𝜮:"Ʃ",𝝨:"Ʃ",𝞢:"Ʃ",ⵉ:"Ʃ","∬":"ʃʃ","∭":"ʃʃʃ","⨌":"ʃʃʃʃ",𝐭:"t",𝑡:"t",𝒕:"t",𝓉:"t",𝓽:"t",𝔱:"t",𝕥:"t",𝖙:"t",𝗍:"t",𝘁:"t",𝘵:"t",𝙩:"t",𝚝:"t","⊤":"T","⟙":"T","🝨":"T",Ｔ:"T",𝐓:"T",𝑇:"T",𝑻:"T",𝒯:"T",𝓣:"T",𝔗:"T",𝕋:"T",𝕿:"T",𝖳:"T",𝗧:"T",𝘛:"T",𝙏:"T",𝚃:"T",Τ:"T",𝚻:"T",𝛵:"T",𝜯:"T",𝝩:"T",𝞣:"T",Ⲧ:"T",Т:"T",Ꭲ:"T",ꓔ:"T",𖼊:"T",𑢼:"T",𐊗:"T",𐊱:"T",𐌕:"T",ƭ:"t̔","⍡":"T̈",Ⱦ:"T̸",Ț:"Ţ",Ʈ:"T̨",Ҭ:"T̩","₮":"T⃫",ŧ:"t̵",Ŧ:"T̵",ᵵ:"t̴",Ⴀ:"Ꞇ",Ꜩ:"T3",ʨ:"tɕ","℡":"TEL",ꝷ:"tf",ʦ:"ts",ʧ:"tʃ",ꜩ:"tȝ",τ:"ᴛ",𝛕:"ᴛ",𝜏:"ᴛ",𝝉:"ᴛ",𝞃:"ᴛ",𝞽:"ᴛ",т:"ᴛ",ꭲ:"ᴛ",ҭ:"ᴛ̩",ţ:"ƫ",ț:"ƫ",Ꮏ:"ƫ",𝐮:"u",𝑢:"u",𝒖:"u",𝓊:"u",𝓾:"u",𝔲:"u",𝕦:"u",𝖚:"u",𝗎:"u",𝘂:"u",𝘶:"u",𝙪:"u",𝚞:"u",ꞟ:"u",ᴜ:"u",ꭎ:"u",ꭒ:"u",ʋ:"u",υ:"u",𝛖:"u",𝜐:"u",𝝊:"u",𝞄:"u",𝞾:"u",ս:"u","𐓶":"u",𑣘:"u","∪":"U","⋃":"U",𝐔:"U",𝑈:"U",𝑼:"U",𝒰:"U",𝓤:"U",𝔘:"U",𝕌:"U",𝖀:"U",𝖴:"U",𝗨:"U",𝘜:"U",𝙐:"U",𝚄:"U",Ս:"U",ሀ:"U","𐓎":"U",ᑌ:"U",ꓴ:"U",𖽂:"U",𑢸:"U",ǔ:"ŭ",Ǔ:"Ŭ",ᵾ:"u̵",ꮜ:"u̵",Ʉ:"U̵",Ꮜ:"U̵",ᑘ:"U·",ᑧ:"U'",ᵫ:"ue",ꭣ:"uo",ṃ:"ꭑ",պ:"ɰ",ሣ:"ɰ","℧":"Ʊ",ᘮ:"Ʊ",ᘴ:"Ʊ",ᵿ:"ʊ̵","∨":"v","⋁":"v",ｖ:"v",ⅴ:"v",𝐯:"v",𝑣:"v",𝒗:"v",𝓋:"v",𝓿:"v",𝔳:"v",𝕧:"v",𝖛:"v",𝗏:"v",𝘃:"v",𝘷:"v",𝙫:"v",𝚟:"v",ᴠ:"v",ν:"v",𝛎:"v",𝜈:"v",𝝂:"v",𝝼:"v",𝞶:"v",ѵ:"v",ט:"v",𑜆:"v",ꮩ:"v",𑣀:"v","𝈍":"V","٧":"V","۷":"V",Ⅴ:"V",𝐕:"V",𝑉:"V",𝑽:"V",𝒱:"V",𝓥:"V",𝔙:"V",𝕍:"V",𝖁:"V",𝖵:"V",𝗩:"V",𝘝:"V",𝙑:"V",𝚅:"V",Ѵ:"V",ⴸ:"V",Ꮩ:"V",ᐯ:"V",ꛟ:"V",ꓦ:"V",𖼈:"V",𑢠:"V",𐔝:"V","𐆗":"V̵",ᐻ:"V·","🝬":"VB",ⅵ:"vi",ⅶ:"vii",ⅷ:"viii",Ⅵ:"Vl",Ⅶ:"Vll",Ⅷ:"Vlll","🜈":"Vᷤ",ᴧ:"ʌ","𐓘":"ʌ","٨":"Ʌ","۸":"Ʌ",Λ:"Ʌ",𝚲:"Ʌ",𝛬:"Ʌ",𝜦:"Ʌ",𝝠:"Ʌ",𝞚:"Ʌ",Л:"Ʌ",ⴷ:"Ʌ","𐒰":"Ʌ",ᐱ:"Ʌ",ꛎ:"Ʌ",ꓥ:"Ʌ",𖼽:"Ʌ",𐊍:"Ʌ",Ӆ:"Ʌ̦",ᐽ:"Ʌ·",ɯ:"w",𝐰:"w",𝑤:"w",𝒘:"w",𝓌:"w",𝔀:"w",𝔴:"w",𝕨:"w",𝖜:"w",𝗐:"w",𝘄:"w",𝘸:"w",𝙬:"w",𝚠:"w",ᴡ:"w",ѡ:"w",ԝ:"w",ա:"w",𑜊:"w",𑜎:"w",𑜏:"w",ꮃ:"w","𑣯":"W","𑣦":"W",𝐖:"W",𝑊:"W",𝑾:"W",𝒲:"W",𝓦:"W",𝔚:"W",𝕎:"W",𝖂:"W",𝖶:"W",𝗪:"W",𝘞:"W",𝙒:"W",𝚆:"W",Ԝ:"W",Ꮃ:"W",Ꮤ:"W",ꓪ:"W",ѽ:"w҆҇",𑓅:"ẇ","₩":"W̵",ꝡ:"w̦",ᴍ:"ʍ",м:"ʍ",ꮇ:"ʍ",ӎ:"ʍ̦","᙮":"x","×":"x","⤫":"x","⤬":"x","⨯":"x",ｘ:"x",ⅹ:"x",𝐱:"x",𝑥:"x",𝒙:"x",𝓍:"x",𝔁:"x",𝔵:"x",𝕩:"x",𝖝:"x",𝗑:"x",𝘅:"x",𝘹:"x",𝙭:"x",𝚡:"x",х:"x",ᕁ:"x",ᕽ:"x","ⷯ":"ͯ","᙭":"X","╳":"X","𐌢":"X","𑣬":"X",Ｘ:"X",Ⅹ:"X",𝐗:"X",𝑋:"X",𝑿:"X",𝒳:"X",𝓧:"X",𝔛:"X",𝕏:"X",𝖃:"X",𝖷:"X",𝗫:"X",𝘟:"X",𝙓:"X",𝚇:"X",Ꭓ:"X",Χ:"X",𝚾:"X",𝛸:"X",𝜲:"X",𝝬:"X",𝞦:"X",Ⲭ:"X",Х:"X",ⵝ:"X",ᚷ:"X",ꓫ:"X",𐊐:"X",𐊴:"X",𐌗:"X",𐔧:"X","⨰":"ẋ",Ҳ:"X̩","𐆖":"X̵",ⅺ:"xi",ⅻ:"xii",Ⅺ:"Xl",Ⅻ:"Xll",ɣ:"y",ᶌ:"y",ｙ:"y",𝐲:"y",𝑦:"y",𝒚:"y",𝓎:"y",𝔂:"y",𝔶:"y",𝕪:"y",𝖞:"y",𝗒:"y",𝘆:"y",𝘺:"y",𝙮:"y",𝚢:"y",ʏ:"y",ỿ:"y",ꭚ:"y",γ:"y",ℽ:"y",𝛄:"y",𝛾:"y",𝜸:"y",𝝲:"y",𝞬:"y",у:"y",ү:"y",ყ:"y",𑣜:"y",Ｙ:"Y",𝐘:"Y",𝑌:"Y",𝒀:"Y",𝒴:"Y",𝓨:"Y",𝔜:"Y",𝕐:"Y",𝖄:"Y",𝖸:"Y",𝗬:"Y",𝘠:"Y",𝙔:"Y",𝚈:"Y",Υ:"Y",ϒ:"Y",𝚼:"Y",𝛶:"Y",𝜰:"Y",𝝪:"Y",𝞤:"Y",Ⲩ:"Y",У:"Y",Ү:"Y",Ꭹ:"Y",Ꮍ:"Y",ꓬ:"Y",𖽃:"Y",𑢤:"Y",𐊲:"Y",ƴ:"y̔",ɏ:"y̵",ұ:"y̵","¥":"Y̵",Ɏ:"Y̵",Ұ:"Y̵",ʒ:"ȝ",ꝫ:"ȝ",ⳍ:"ȝ",ӡ:"ȝ",ჳ:"ȝ",𝐳:"z",𝑧:"z",𝒛:"z",𝓏:"z",𝔃:"z",𝔷:"z",𝕫:"z",𝖟:"z",𝗓:"z",𝘇:"z",𝘻:"z",𝙯:"z",𝚣:"z",ᴢ:"z",ꮓ:"z",𑣄:"z","𐋵":"Z","𑣥":"Z",Ｚ:"Z",ℤ:"Z",ℨ:"Z",𝐙:"Z",𝑍:"Z",𝒁:"Z",𝒵:"Z",𝓩:"Z",𝖅:"Z",𝖹:"Z",𝗭:"Z",𝘡:"Z",𝙕:"Z",𝚉:"Z",Ζ:"Z",𝚭:"Z",𝛧:"Z",𝜡:"Z",𝝛:"Z",𝞕:"Z",Ꮓ:"Z",ꓜ:"Z",𑢩:"Z",ʐ:"z̨",ƶ:"z̵",Ƶ:"Z̵",ȥ:"z̦",Ȥ:"Z̦",ᵶ:"z̴",ƿ:"þ",ϸ:"þ",Ϸ:"Þ","𐓄":"Þ","⁹":"ꝰ",ᴤ:"ƨ",ϩ:"ƨ",ꙅ:"ƨ",ь:"ƅ",ꮟ:"ƅ",ы:"ƅi",ꭾ:"ɂ",ˤ:"ˁ",ꛍ:"ʡ","⊙":"ʘ","☉":"ʘ","⨀":"ʘ",Ꙩ:"ʘ",ⵙ:"ʘ","𐓃":"ʘ",ℾ:"Γ",𝚪:"Γ",𝛤:"Γ",𝜞:"Γ",𝝘:"Γ",𝞒:"Γ",Ⲅ:"Γ",Г:"Γ",Ꮁ:"Γ",ᒥ:"Γ",𖼇:"Γ",Ғ:"Γ̵",ᒯ:"Γ·",Ґ:"Γ'","∆":"Δ","△":"Δ","🜂":"Δ",𝚫:"Δ",𝛥:"Δ",𝜟:"Δ",𝝙:"Δ",𝞓:"Δ",Ⲇ:"Δ",ⵠ:"Δ",ᐃ:"Δ",𖼚:"Δ",𐊅:"Δ",𐊣:"Δ","⍙":"Δ̲",ᐏ:"Δ·",ᐬ:"Δᐠ",𝟋:"ϝ",𝛇:"ζ",𝜁:"ζ",𝜻:"ζ",𝝵:"ζ",𝞯:"ζ",ⳤ:"ϗ",𝛌:"λ",𝜆:"λ",𝝀:"λ",𝝺:"λ",𝞴:"λ",Ⲗ:"λ","𐓛":"λ",µ:"μ",𝛍:"μ",𝜇:"μ",𝝁:"μ",𝝻:"μ",𝞵:"μ",𝛏:"ξ",𝜉:"ξ",𝝃:"ξ",𝝽:"ξ",𝞷:"ξ",𝚵:"Ξ",𝛯:"Ξ",𝜩:"Ξ",𝝣:"Ξ",𝞝:"Ξ",ϖ:"π",ℼ:"π",𝛑:"π",𝛡:"π",𝜋:"π",𝜛:"π",𝝅:"π",𝝕:"π",𝝿:"π",𝞏:"π",𝞹:"π",𝟉:"π",ᴨ:"π",п:"π","∏":"Π",ℿ:"Π",𝚷:"Π",𝛱:"Π",𝜫:"Π",𝝥:"Π",𝞟:"Π",Ⲡ:"Π",П:"Π",ꛛ:"Π",𐊭:"Ϙ",𐌒:"Ϙ",ϛ:"ς",𝛓:"ς",𝜍:"ς",𝝇:"ς",𝞁:"ς",𝞻:"ς",𝚽:"Φ",𝛷:"Φ",𝜱:"Φ",𝝫:"Φ",𝞥:"Φ",Ⲫ:"Φ",Ф:"Φ",Փ:"Φ",ቀ:"Φ",ᛰ:"Φ",𐊳:"Φ",ꭓ:"χ",ꭕ:"χ",𝛘:"χ",𝜒:"χ",𝝌:"χ",𝞆:"χ",𝟀:"χ",ⲭ:"χ",𝛙:"ψ",𝜓:"ψ",𝝍:"ψ",𝞇:"ψ",𝟁:"ψ",ѱ:"ψ","𐓹":"ψ",𝚿:"Ψ",𝛹:"Ψ",𝜳:"Ψ",𝝭:"Ψ",𝞧:"Ψ",Ⲯ:"Ψ",Ѱ:"Ψ","𐓑":"Ψ",ᛘ:"Ψ",𐊵:"Ψ","⍵":"ω",ꞷ:"ω",𝛚:"ω",𝜔:"ω",𝝎:"ω",𝞈:"ω",𝟂:"ω",ⲱ:"ω",ꙍ:"ω",Ω:"Ω",𝛀:"Ω",𝛺:"Ω",𝜴:"Ω",𝝮:"Ω",𝞨:"Ω",ᘯ:"Ω",ᘵ:"Ω",𐊶:"Ω","⍹":"ω̲",ώ:"ῴ","☰":"Ⲷ",Ⳝ:"Ϭ",җ:"ж̩",Җ:"Ж̩","𝈋":"И",Ͷ:"И",ꚡ:"И",𐐥:"И",Й:"Ѝ",Ҋ:"Ѝ̦",ѝ:"й",ҋ:"й̦","𐒼":"Ӄ",ᴫ:"л",ӆ:"л̦",ꭠ:"љ","𐓫":"ꙩ","ᷮ":"ⷬ","𐓍":"Ћ","𝈂":"Ӿ","𝈢":"Ѡ",Ꮗ:"Ѡ",ᗯ:"Ѡ",Ѽ:"Ѡ҆҇",ᣭ:"Ѡ·",Ꞷ:"Ꙍ",ӌ:"ҷ",Ӌ:"Ҷ",Ҿ:"Ҽ̨",ⲽ:"ш",Ⲽ:"Ш",Ꙑ:"Ъl","℈":"Э","🜁":"Ꙙ",𖼜:"Ꙙ",ꦒ:"ⰿ",և:"եւ",ኔ:"ձ",ﬔ:"մե",ﬕ:"մի",ﬗ:"մխ",ﬓ:"մն","∩":"Ո","⋂":"Ո","𝉅":"Ո",በ:"Ո",ᑎ:"Ո",ꓵ:"Ո",ᑚ:"Ո·",ᑨ:"Ո'",ﬖ:"վն","₽":"Ք","˓":"ՙ",ʿ:"ՙ",ℵ:"א",ﬡ:"א",אָ:"אַ",אּ:"אַ",ﭏ:"אל",ℶ:"ב",ℷ:"ג",ℸ:"ד",ﬢ:"ד",ﬣ:"ה",יּ:"יִ",ﬤ:"כ",ﬥ:"ל",ﬦ:"ם",ﬠ:"ע",ﬧ:"ר",שׂ:"שׁ",שּ:"שׁ",שּׂ:"שּׁ",ﬨ:"ת",ﺀ:"ء","۽":"ء͈",ﺂ:"آ",ﺁ:"آ",ﭑ:"ٱ",ﭐ:"ٱ",𞸁:"ب",𞸡:"ب",𞹡:"ب",𞺁:"ب",𞺡:"ب",ﺑ:"ب",ﺒ:"ب",ﺐ:"ب",ﺏ:"ب",ݑ:"بۛ","ࢶ":"بۢ",ࢡ:"بٔ",ﲠ:"بo",ﳢ:"بo",ﲜ:"بج",ﰅ:"بج",ﲝ:"بح",ﰆ:"بح",ﷂ:"بحى",ﲞ:"بخ",ﰇ:"بخ",ﳒ:"بخ",ﱋ:"بخ",ﶞ:"بخى",ﱪ:"بر",ﱫ:"بز",ﲟ:"بم",ﳡ:"بم",ﱬ:"بم",ﰈ:"بم",ﱭ:"بن",ﱮ:"بى",ﰉ:"بى",ﱯ:"بى",ﰊ:"بى",ﭔ:"ٻ",ﭕ:"ٻ",ﭓ:"ٻ",ﭒ:"ٻ",ې:"ٻ",ﯦ:"ٻ",ﯧ:"ٻ",ﯥ:"ٻ",ﯤ:"ٻ",ﭜ:"ڀ",ﭝ:"ڀ",ﭛ:"ڀ",ﭚ:"ڀ",ࢩ:"ݔ",ݧ:"ݔ","⍥":"ة",ö:"ة",ﺔ:"ة",ﺓ:"ة",ۃ:"ة",𞸕:"ت",𞸵:"ت",𞹵:"ت",𞺕:"ت",𞺵:"ت",ﺗ:"ت",ﺘ:"ت",ﺖ:"ت",ﺕ:"ت",ﲥ:"تo",ﳤ:"تo",ﲡ:"تج",ﰋ:"تج",ﵐ:"تجم",ﶠ:"تجى",ﶟ:"تجى",ﲢ:"تح",ﰌ:"تح",ﵒ:"تحج",ﵑ:"تحج",ﵓ:"تحم",ﲣ:"تخ",ﰍ:"تخ",ﵔ:"تخم",ﶢ:"تخى",ﶡ:"تخى",ﱰ:"تر",ﱱ:"تز",ﲤ:"تم",ﳣ:"تم",ﱲ:"تم",ﰎ:"تم",ﵕ:"تمج",ﵖ:"تمح",ﵗ:"تمخ",ﶤ:"تمى",ﶣ:"تمى",ﱳ:"تن",ﱴ:"تى",ﰏ:"تى",ﱵ:"تى",ﰐ:"تى",ﭠ:"ٺ",ﭡ:"ٺ",ﭟ:"ٺ",ﭞ:"ٺ",ﭤ:"ٿ",ﭥ:"ٿ",ﭣ:"ٿ",ﭢ:"ٿ",𞸂:"ج",𞸢:"ج",𞹂:"ج",𞹢:"ج",𞺂:"ج",𞺢:"ج",ﺟ:"ج",ﺠ:"ج",ﺞ:"ج",ﺝ:"ج",ﲧ:"جح",ﰕ:"جح",ﶦ:"جحى",ﶾ:"جحى",ﷻ:"جل جلlلo",ﲨ:"جم",ﰖ:"جم",ﵙ:"جمح",ﵘ:"جمح",ﶧ:"جمى",ﶥ:"جمى",ﴝ:"جى",ﴁ:"جى",ﴞ:"جى",ﴂ:"جى",ﭸ:"ڃ",ﭹ:"ڃ",ﭷ:"ڃ",ﭶ:"ڃ",ﭴ:"ڄ",ﭵ:"ڄ",ﭳ:"ڄ",ﭲ:"ڄ",ﭼ:"چ",ﭽ:"چ",ﭻ:"چ",ﭺ:"چ",ﮀ:"ڇ",ﮁ:"ڇ",ﭿ:"ڇ",ﭾ:"ڇ",𞸇:"ح",𞸧:"ح",𞹇:"ح",𞹧:"ح",𞺇:"ح",𞺧:"ح",ﺣ:"ح",ﺤ:"ح",ﺢ:"ح",ﺡ:"ح",څ:"حۛ",ځ:"حٔ",ݲ:"حٔ",ﲩ:"حج",ﰗ:"حج",ﶿ:"حجى",ﲪ:"حم",ﰘ:"حم",ﵛ:"حمى",ﵚ:"حمى",ﴛ:"حى",ﳿ:"حى",ﴜ:"حى",ﴀ:"حى",𞸗:"خ",𞸷:"خ",𞹗:"خ",𞹷:"خ",𞺗:"خ",𞺷:"خ",ﺧ:"خ",ﺨ:"خ",ﺦ:"خ",ﺥ:"خ",ﲫ:"خج",ﰙ:"خج",ﰚ:"خح",ﲬ:"خم",ﰛ:"خم",ﴟ:"خى",ﴃ:"خى",ﴠ:"خى",ﴄ:"خى","𐋡":"د",𞸃:"د",𞺃:"د",𞺣:"د",ﺪ:"د",ﺩ:"د",ڈ:"دؕ",ﮉ:"دؕ",ﮈ:"دؕ",ڎ:"دۛ",ﮇ:"دۛ",ﮆ:"دۛ",ۮ:"د̂",ࢮ:"د̤̣",𞸘:"ذ",𞺘:"ذ",𞺸:"ذ",ﺬ:"ذ",ﺫ:"ذ",ﱛ:"ذٰ",ڋ:"ڊؕ",ﮅ:"ڌ",ﮄ:"ڌ",ﮃ:"ڍ",ﮂ:"ڍ",𞸓:"ر",𞺓:"ر",𞺳:"ر",ﺮ:"ر",ﺭ:"ر",ڑ:"رؕ",ﮍ:"رؕ",ﮌ:"رؕ",ژ:"رۛ",ﮋ:"رۛ",ﮊ:"رۛ",ڒ:"ر̆","ࢹ":"ر̆̇",ۯ:"ر̂",ݬ:"رٔ",ﱜ:"رٰ",ﷶ:"رسول","﷼":"رىlل",𞸆:"ز",𞺆:"ز",𞺦:"ز",ﺰ:"ز",ﺯ:"ز",ࢲ:"ز̂",ݱ:"ڗؕ",𞸎:"س",𞸮:"س",𞹎:"س",𞹮:"س",𞺎:"س",𞺮:"س",ﺳ:"س",ﺴ:"س",ﺲ:"س",ﺱ:"س",ش:"سۛ",𞸔:"سۛ",𞸴:"سۛ",𞹔:"سۛ",𞹴:"سۛ",𞺔:"سۛ",𞺴:"سۛ",ﺷ:"سۛ",ﺸ:"سۛ",ﺶ:"سۛ",ﺵ:"سۛ",ݾ:"س̂",ﴱ:"سo",ﳨ:"سo",ﴲ:"سۛo",ﳪ:"سۛo",ﲭ:"سج",ﴴ:"سج",ﰜ:"سج",ﴭ:"سۛج",ﴷ:"سۛج",ﴥ:"سۛج",ﴉ:"سۛج",ﵝ:"سجح",ﵞ:"سجى",ﵩ:"سۛجى",ﲮ:"سح",ﴵ:"سح",ﰝ:"سح",ﴮ:"سۛح",ﴸ:"سۛح",ﴦ:"سۛح",ﴊ:"سۛح",ﵜ:"سحج",ﵨ:"سۛحم",ﵧ:"سۛحم",ﶪ:"سۛحى",ﲯ:"سخ",ﴶ:"سخ",ﰞ:"سخ",ﴯ:"سۛخ",ﴹ:"سۛخ",ﴧ:"سۛخ",ﴋ:"سۛخ",ﶨ:"سخى",ﷆ:"سخى",ﴪ:"سر",ﴎ:"سر",ﴩ:"سۛر",ﴍ:"سۛر",ﲰ:"سم",ﳧ:"سم",ﰟ:"سم",ﴰ:"سۛم",ﳩ:"سۛم",ﴨ:"سۛم",ﴌ:"سۛم",ﵡ:"سمج",ﵠ:"سمح",ﵟ:"سمح",ﵫ:"سۛمخ",ﵪ:"سۛمخ",ﵣ:"سمم",ﵢ:"سمم",ﵭ:"سۛمم",ﵬ:"سۛمم",ﴗ:"سى",ﳻ:"سى",ﴘ:"سى",ﳼ:"سى",ﴙ:"سۛى",ﳽ:"سۛى",ﴚ:"سۛى",ﳾ:"سۛى","𐋲":"ص",𞸑:"ص",𞸱:"ص",𞹑:"ص",𞹱:"ص",𞺑:"ص",𞺱:"ص",ﺻ:"ص",ﺼ:"ص",ﺺ:"ص",ﺹ:"ص",ڞ:"صۛ",ࢯ:"ص̤̣",ﲱ:"صح",ﰠ:"صح",ﵥ:"صحح",ﵤ:"صحح",ﶩ:"صحى",ﲲ:"صخ",ﴫ:"صر",ﴏ:"صر",ﷵ:"صلعم",ﷹ:"صلى",ﷰ:"صلى",ﷺ:"صلى lللo علىo وسلم",ﲳ:"صم",ﰡ:"صم",ﷅ:"صمم",ﵦ:"صمم",ﴡ:"صى",ﴅ:"صى",ﴢ:"صى",ﴆ:"صى",𞸙:"ض",𞸹:"ض",𞹙:"ض",𞹹:"ض",𞺙:"ض",𞺹:"ض",ﺿ:"ض",ﻀ:"ض",ﺾ:"ض",ﺽ:"ض",ﲴ:"ضج",ﰢ:"ضج",ﲵ:"ضح",ﰣ:"ضح",ﵮ:"ضحى",ﶫ:"ضحى",ﲶ:"ضخ",ﰤ:"ضخ",ﵰ:"ضخم",ﵯ:"ضخم",ﴬ:"ضر",ﴐ:"ضر",ﲷ:"ضم",ﰥ:"ضم",ﴣ:"ضى",ﴇ:"ضى",ﴤ:"ضى",ﴈ:"ضى","𐋨":"ط",𞸈:"ط",𞹨:"ط",𞺈:"ط",𞺨:"ط",ﻃ:"ط",ﻄ:"ط",ﻂ:"ط",ﻁ:"ط",ڟ:"طۛ",ﲸ:"طح",ﰦ:"طح",ﴳ:"طم",ﴺ:"طم",ﰧ:"طم",ﵲ:"طمح",ﵱ:"طمح",ﵳ:"طمم",ﵴ:"طمى",ﴑ:"طى",ﳵ:"طى",ﴒ:"طى",ﳶ:"طى",𞸚:"ظ",𞹺:"ظ",𞺚:"ظ",𞺺:"ظ",ﻇ:"ظ",ﻈ:"ظ",ﻆ:"ظ",ﻅ:"ظ",ﲹ:"ظم",ﴻ:"ظم",ﰨ:"ظم","؏":"ع",𞸏:"ع",𞸯:"ع",𞹏:"ع",𞹯:"ع",𞺏:"ع",𞺯:"ع",ﻋ:"ع",ﻌ:"ع",ﻊ:"ع",ﻉ:"ع",ﲺ:"عج",ﰩ:"عج",ﷄ:"عجم",ﵵ:"عجم",ﷷ:"علىo",ﲻ:"عم",ﰪ:"عم",ﵷ:"عمم",ﵶ:"عمم",ﵸ:"عمى",ﶶ:"عمى",ﴓ:"عى",ﳷ:"عى",ﴔ:"عى",ﳸ:"عى",𞸛:"غ",𞸻:"غ",𞹛:"غ",𞹻:"غ",𞺛:"غ",𞺻:"غ",ﻏ:"غ",ﻐ:"غ",ﻎ:"غ",ﻍ:"غ",ﲼ:"غج",ﰫ:"غج",ﲽ:"غم",ﰬ:"غم",ﵹ:"غمم",ﵻ:"غمى",ﵺ:"غمى",ﴕ:"غى",ﳹ:"غى",ﴖ:"غى",ﳺ:"غى",𞸐:"ف",𞸰:"ف",𞹰:"ف",𞺐:"ف",𞺰:"ف",ﻓ:"ف",ﻔ:"ف",ﻒ:"ف",ﻑ:"ف",ڧ:"ف",ﲾ:"فج",ﰭ:"فج",ﲿ:"فح",ﰮ:"فح",ﳀ:"فخ",ﰯ:"فخ",ﵽ:"فخم",ﵼ:"فخم",ﳁ:"فم",ﰰ:"فم",ﷁ:"فمى",ﱼ:"فى",ﰱ:"فى",ﱽ:"فى",ﰲ:"فى",𞸞:"ڡ",𞹾:"ڡ","ࢻ":"ڡ",ٯ:"ڡ",𞸟:"ڡ",𞹟:"ڡ","ࢼ":"ڡ",ڤ:"ڡۛ",ﭬ:"ڡۛ",ﭭ:"ڡۛ",ﭫ:"ڡۛ",ﭪ:"ڡۛ",ڨ:"ڡۛ",ࢤ:"ڢۛ",ﭰ:"ڦ",ﭱ:"ڦ",ﭯ:"ڦ",ﭮ:"ڦ",𞸒:"ق",𞸲:"ق",𞹒:"ق",𞹲:"ق",𞺒:"ق",𞺲:"ق",ﻗ:"ق",ﻘ:"ق",ﻖ:"ق",ﻕ:"ق",ﳂ:"قح",ﰳ:"قح",ﷱ:"قلى",ﳃ:"قم",ﰴ:"قم",ﶴ:"قمح",ﵾ:"قمح",ﵿ:"قمم",ﶲ:"قمى",ﱾ:"قى",ﰵ:"قى",ﱿ:"قى",ﰶ:"قى",𞸊:"ك",𞸪:"ك",𞹪:"ك",ﻛ:"ك",ﻜ:"ك",ﻚ:"ك",ﻙ:"ك",ک:"ك",ﮐ:"ك",ﮑ:"ك",ﮏ:"ك",ﮎ:"ك",ڪ:"ك",ڭ:"كۛ",ﯕ:"كۛ",ﯖ:"كۛ",ﯔ:"كۛ",ﯓ:"كۛ",ݣ:"كۛ",ﲀ:"كl",ﰷ:"كl",ﳄ:"كج",ﰸ:"كج",ﳅ:"كح",ﰹ:"كح",ﳆ:"كخ",ﰺ:"كخ",ﳇ:"كل",ﳫ:"كل",ﲁ:"كل",ﰻ:"كل",ﳈ:"كم",ﳬ:"كم",ﲂ:"كم",ﰼ:"كم",ﷃ:"كمم",ﶻ:"كمم",ﶷ:"كمى",ﲃ:"كى",ﰽ:"كى",ﲄ:"كى",ﰾ:"كى",ݢ:"ڬ",ﮔ:"گ",ﮕ:"گ",ﮓ:"گ",ﮒ:"گ",ࢰ:"گ",ڴ:"گۛ",ﮜ:"ڱ",ﮝ:"ڱ",ﮛ:"ڱ",ﮚ:"ڱ",ﮘ:"ڳ",ﮙ:"ڳ",ﮗ:"ڳ",ﮖ:"ڳ",𞸋:"ل",𞸫:"ل",𞹋:"ل",𞺋:"ل",𞺫:"ل",ﻟ:"ل",ﻠ:"ل",ﻞ:"ل",ﻝ:"ل",ڷ:"لۛ",ڵ:"ل̆",ﻼ:"لl",ﻻ:"لl",ﻺ:"لlٕ",ﻹ:"لlٕ",ﻸ:"لlٴ",ﻷ:"لlٴ",ﳍ:"لo",ﻶ:"لآ",ﻵ:"لآ",ﳉ:"لج",ﰿ:"لج",ﶃ:"لجج",ﶄ:"لجج",ﶺ:"لجم",ﶼ:"لجم",ﶬ:"لجى",ﳊ:"لح",ﱀ:"لح",ﶵ:"لحم",ﶀ:"لحم",ﶂ:"لحى",ﶁ:"لحى",ﳋ:"لخ",ﱁ:"لخ",ﶆ:"لخم",ﶅ:"لخم",ﳌ:"لم",ﳭ:"لم",ﲅ:"لم",ﱂ:"لم",ﶈ:"لمح",ﶇ:"لمح",ﶭ:"لمى",ﲆ:"لى",ﱃ:"لى",ﲇ:"لى",ﱄ:"لى",𞸌:"م",𞸬:"م",𞹬:"م",𞺌:"م",𞺬:"م",ﻣ:"م",ﻤ:"م",ﻢ:"م",ﻡ:"م",ࢧ:"مۛ","۾":"م͈",ﲈ:"مl",ﳎ:"مج",ﱅ:"مج",ﶌ:"مجح",ﶒ:"مجخ",ﶍ:"مجم",ﷀ:"مجى",ﳏ:"مح",ﱆ:"مح",ﶉ:"محج",ﶊ:"محم",ﷴ:"محمد",ﶋ:"محى",ﳐ:"مخ",ﱇ:"مخ",ﶎ:"مخج",ﶏ:"مخم",ﶹ:"مخى",ﳑ:"مم",ﲉ:"مم",ﱈ:"مم",ﶱ:"ممى",ﱉ:"مى",ﱊ:"مى",𞸍:"ن",𞸭:"ن",𞹍:"ن",𞹭:"ن",𞺍:"ن",𞺭:"ن",ﻧ:"ن",ﻨ:"ن",ﻦ:"ن",ﻥ:"ن",ݨ:"نؕ",ݩ:"ن̆",ﳖ:"نo",ﳯ:"نo",ﶸ:"نجح",ﶽ:"نجح",ﶘ:"نجم",ﶗ:"نجم",ﶙ:"نجى",ﷇ:"نجى",ﳓ:"نح",ﱌ:"نح",ﶕ:"نحم",ﶖ:"نحى",ﶳ:"نحى",ﳔ:"نخ",ﱍ:"نخ",ﲊ:"نر",ﲋ:"نز",ﳕ:"نم",ﳮ:"نم",ﲌ:"نم",ﱎ:"نم",ﶛ:"نمى",ﶚ:"نمى",ﲍ:"نن",ﲎ:"نى",ﱏ:"نى",ﲏ:"نى",ﱐ:"نى",ۂ:"ۀ",ﮥ:"ۀ",ﮤ:"ۀ","𐋤":"و",𞸅:"و",𞺅:"و",𞺥:"و",ﻮ:"و",ﻭ:"و",ࢱ:"و",ۋ:"وۛ",ﯟ:"وۛ",ﯞ:"وۛ",ۇ:"و̓",ﯘ:"و̓",ﯗ:"و̓",ۆ:"و̆",ﯚ:"و̆",ﯙ:"و̆",ۉ:"و̂",ﯣ:"و̂",ﯢ:"و̂",ۈ:"وٰ",ﯜ:"وٰ",ﯛ:"وٰ",ؤ:"وٴ",ﺆ:"وٴ",ﺅ:"وٴ",ٶ:"وٴ",ٷ:"و̓ٴ",ﯝ:"و̓ٴ",ﷸ:"وسلم",ﯡ:"ۅ",ﯠ:"ۅ",ٮ:"ى",𞸜:"ى",𞹼:"ى",ں:"ى",𞸝:"ى",𞹝:"ى",ﮟ:"ى",ﮞ:"ى","ࢽ":"ى",ﯨ:"ى",ﯩ:"ى",ﻰ:"ى",ﻯ:"ى",ي:"ى",𞸉:"ى",𞸩:"ى",𞹉:"ى",𞹩:"ى",𞺉:"ى",𞺩:"ى",ﻳ:"ى",ﻴ:"ى",ﻲ:"ى",ﻱ:"ى",ی:"ى",ﯾ:"ى",ﯿ:"ى",ﯽ:"ى",ﯼ:"ى",ے:"ى",ﮯ:"ى",ﮮ:"ى",ٹ:"ىؕ",ﭨ:"ىؕ",ﭩ:"ىؕ",ﭧ:"ىؕ",ﭦ:"ىؕ",ڻ:"ىؕ",ﮢ:"ىؕ",ﮣ:"ىؕ",ﮡ:"ىؕ",ﮠ:"ىؕ",پ:"ىۛ",ﭘ:"ىۛ",ﭙ:"ىۛ",ﭗ:"ىۛ",ﭖ:"ىۛ",ث:"ىۛ",𞸖:"ىۛ",𞸶:"ىۛ",𞹶:"ىۛ",𞺖:"ىۛ",𞺶:"ىۛ",ﺛ:"ىۛ",ﺜ:"ىۛ",ﺚ:"ىۛ",ﺙ:"ىۛ",ڽ:"ىۛ",ۑ:"ىۛ",ؿ:"ىۛ","ࢷ":"ىۛۢ",ݖ:"ى̆",ێ:"ى̆","ࢺ":"ى̆̇",ؽ:"ى̂",ࢨ:"ىٔ",ﲐ:"ىٰ",ﱝ:"ىٰ",ﳞ:"ىo",ﳱ:"ىo",ﳦ:"ىۛo",ئ:"ىٴ",ﺋ:"ىٴ",ﺌ:"ىٴ",ﺊ:"ىٴ",ﺉ:"ىٴ",ٸ:"ىٴ",ﯫ:"ىٴl",ﯪ:"ىٴl",ﲛ:"ىٴo",ﳠ:"ىٴo",ﯭ:"ىٴo",ﯬ:"ىٴo",ﯸ:"ىٴٻ",ﯷ:"ىٴٻ",ﯶ:"ىٴٻ",ﲗ:"ىٴج",ﰀ:"ىٴج",ﲘ:"ىٴح",ﰁ:"ىٴح",ﲙ:"ىٴخ",ﱤ:"ىٴر",ﱥ:"ىٴز",ﲚ:"ىٴم",ﳟ:"ىٴم",ﱦ:"ىٴم",ﰂ:"ىٴم",ﱧ:"ىٴن",ﯯ:"ىٴو",ﯮ:"ىٴو",ﯱ:"ىٴو̓",ﯰ:"ىٴو̓",ﯳ:"ىٴو̆",ﯲ:"ىٴو̆",ﯵ:"ىٴوٰ",ﯴ:"ىٴوٰ",ﯻ:"ىٴى",ﯺ:"ىٴى",ﱨ:"ىٴى",ﯹ:"ىٴى",ﰃ:"ىٴى",ﱩ:"ىٴى",ﰄ:"ىٴى",ﳚ:"ىج",ﱕ:"ىج",ﰑ:"ىۛج",ﶯ:"ىجى",ﳛ:"ىح",ﱖ:"ىح",ﶮ:"ىحى",ﳜ:"ىخ",ﱗ:"ىخ",ﲑ:"ىر",ﱶ:"ىۛر",ﲒ:"ىز",ﱷ:"ىۛز",ﳝ:"ىم",ﳰ:"ىم",ﲓ:"ىم",ﱘ:"ىم",ﲦ:"ىۛم",ﳥ:"ىۛم",ﱸ:"ىۛم",ﰒ:"ىۛم",ﶝ:"ىمم",ﶜ:"ىمم",ﶰ:"ىمى",ﲔ:"ىن",ﱹ:"ىۛن",ﲕ:"ىى",ﱙ:"ىى",ﲖ:"ىى",ﱚ:"ىى",ﱺ:"ىۛى",ﰓ:"ىۛى",ﱻ:"ىۛى",ﰔ:"ىۛى",ﮱ:"ۓ",ﮰ:"ۓ",𐊸:"ⵀ","⁞":"ⵂ","⸽":"ⵂ","⦙":"ⵂ","︙":"ⵗ","⁝":"ⵗ","⋮":"ⵗ",Մ:"ሆ",Ռ:"ቡ",Ի:"ኮ",Պ:"ጣ",आ:"अा",ऒ:"अाॆ",ओ:"अाे",औ:"अाै",ऄ:"अॆ",ऑ:"अॉ",ऍ:"एॅ",ऎ:"एॆ",ऐ:"एे",ई:"र्इ",ઽ:"ऽ",𑇜:"ꣻ","𑇋":"ऺ","ુ":"ु","ૂ":"ू","ੋ":"ॆ","੍":"्","્":"्",আ:"অা",ৠ:"ঋৃ",ৡ:"ঋৃ",𑒒:"ঘ",𑒔:"চ",𑒖:"জ",𑒘:"ঞ",𑒙:"ট",𑒛:"ড",𑒪:"ণ",𑒞:"ত",𑒟:"থ",𑒠:"দ",𑒡:"ধ",𑒢:"ন",𑒣:"প",𑒩:"ব",𑒧:"ম",𑒨:"য",𑒫:"র",𑒝:"ল",𑒭:"ষ",𑒮:"স",𑓄:"ঽ","𑒰":"া","𑒱":"ি","𑒹":"ে","𑒼":"ো","𑒾":"ৌ","𑓂":"্","𑒽":"ৗ",ਉ:"ੳੁ",ਊ:"ੳੂ",ਆ:"ਅਾ",ਐ:"ਅੈ",ਔ:"ਅੌ",ਇ:"ੲਿ",ਈ:"ੲੀ",ਏ:"ੲੇ",આ:"અા",ઑ:"અાૅ",ઓ:"અાે",ઔ:"અાૈ",ઍ:"અૅ",એ:"અે",ઐ:"અૈ",ଆ:"ଅା","௮":"அ",ர:"ஈ","ா":"ஈ","௫":"ஈு","௨":"உ",ഉ:"உ",ஊ:"உள",ഊ:"உൗ","௭":"எ","௷":"எவ",ஜ:"ஐ",ജ:"ஐ","௧":"க","௪":"ச","௬":"சு","௲":"சூ",ഺ:"டி",ണ:"ண","௺":"நீ","௴":"மீ","௰":"ய",ഴ:"ழ","ௗ":"ள","ை":"ன",ശ:"ஶ","௸":"ஷ","ി":"ி","ീ":"ி","ொ":"ெஈ","ௌ":"ெள","ோ":"ேஈ",ಅ:"అ",ಆ:"ఆ",ಇ:"ఇ",ౠ:"ఋా",ౡ:"ఌా",ಒ:"ఒ",ఔ:"ఒౌ",ಔ:"ఒౌ",ఓ:"ఒౕ",ಓ:"ఒౕ",ಜ:"జ",ಞ:"ఞ",ఢ:"డ̣",ಣ:"ణ",థ:"ధּ",భ:"బ̣",ಯ:"య",ఠ:"రּ",ಱ:"ఱ",ಲ:"ల",ష:"వ̣",హ:"వా",మ:"వు","ూ":"ుా","ౄ":"ృా",ೡ:"ಌಾ",ഈ:"ഇൗ",ഐ:"എെ",ഓ:"ഒാ",ഔ:"ഒൗ",ൡ:"ഞ","൫":"ദ്ര","൹":"നു",ഌ:"നു",ങ:"നു","൯":"ന്",ൻ:"ന്","൬":"ന്ന","൚":"ന്മ",റ:"ര","൪":"ര്",ർ:"ര്","൮":"വ്ര","൶":"ഹ്മ","ൂ":"ു","ൃ":"ു","ൈ":"െെ","෪":"ජ","෫":"ද","𑐓":"𑐴𑑂𑐒","𑐙":"𑐴𑑂𑐘","𑐤":"𑐴𑑂𑐣","𑐪":"𑐴𑑂𑐩","𑐭":"𑐴𑑂𑐬","𑐯":"𑐴𑑂𑐮",𑗘:"𑖂",𑗙:"𑖂",𑗚:"𑖃",𑗛:"𑖄","𑗜":"𑖲","𑗝":"𑖳",ฃ:"ข",ด:"ค",ต:"ค",ม:"ฆ",ຈ:"จ",ซ:"ช",ฏ:"ฎ",ท:"ฑ",ບ:"บ",ປ:"ป",ຝ:"ฝ",ພ:"พ",ຟ:"ฟ",ฦ:"ภ",ຍ:"ย","។":"ฯ",ๅ:"า",ำ:"̊า","ិ":"ิ","ី":"ี","ឹ":"ึ","ឺ":"ื","ຸ":"ุ","ູ":"ู",แ:"เเ",ໜ:"ຫນ",ໝ:"ຫມ",ຳ:"̊າ","༂":"འུྂཿ","༃":"འུྂ༔",ཪ:"ར",ༀ:"ཨོཾ","ཷ":"ྲཱྀ","ཹ":"ླཱྀ","𑲲":"𑲪",ႁ:"ဂှ",က:"ဂာ",ၰ:"ဃှ",ၦ:"ပှ",ဟ:"ပာ",ၯ:"ပာှ",ၾ:"ၽှ",ဩ:"သြ",ဪ:"သြော်","႞":"ႃ̊",ឣ:"អ","᧐":"ᦞ","᧑":"ᦱ","᪀":"ᩅ","᪐":"ᩅ","꩓":"ꨁ","꩖":"ꨣ","᭒":"ᬍ","᭓":"ᬑ","᭘":"ᬨ",ꦣ:"ꦝ",ᢖ:"ᡜ",ᡕ:"ᠵ",ῶ:"Ꮿ",ᐍ:"ᐁ·",ᐫ:"ᐁᐠ",ᐑ:"ᐄ·",ᐓ:"ᐅ·",ᐭ:"ᐅᐠ",ᐕ:"ᐆ·",ᐘ:"ᐊ·",ᐮ:"ᐊᐠ",ᐚ:"ᐋ·",ᣝ:"ᐞᣟ",ᓑ:"ᐡ",ᕀ:"ᐩ",ᐿ:"ᐲ·",ᑃ:"ᐴ·","⍩":"ᐵ",ᑇ:"ᐹ·",ᑜ:"ᑏ·","⸧":"ᑐ","⊃":"ᑐ",ᑞ:"ᑐ·",ᑩ:"ᑐ'","⟉":"ᑐ/","⫗":"ᑐᑕ",ᑠ:"ᑑ·","⸦":"ᑕ","⊂":"ᑕ",ᑢ:"ᑕ·",ᑪ:"ᑕ'",ᑤ:"ᑖ·",ᑵ:"ᑫ·",ᒅ:"ᑫ'",ᑹ:"ᑮ·",ᑽ:"ᑰ·",ᘃ:"ᒉ",ᒓ:"ᒉ·",ᒕ:"ᒋ·",ᒗ:"ᒌ·",ᒛ:"ᒎ·",ᘂ:"ᒐ",ᒝ:"ᒐ·",ᒟ:"ᒑ·",ᒭ:"ᒣ·",ᒱ:"ᒦ·",ᒳ:"ᒧ·",ᒵ:"ᒨ·",ᒹ:"ᒫ·",ᓊ:"ᓀ·",ᣇ:"ᓂ·",ᣉ:"ᓃ·",ᣋ:"ᓄ·",ᣍ:"ᓅ·",ᓌ:"ᓇ·",ᓎ:"ᓈ·",ᘄ:"ᓓ",ᓝ:"ᓓ·",ᓟ:"ᓕ·",ᓡ:"ᓖ·",ᓣ:"ᓗ·",ᓥ:"ᓘ·",ᘇ:"ᓚ",ᓧ:"ᓚ·",ᓩ:"ᓛ·",ᓷ:"ᓭ·",ᓹ:"ᓯ·",ᓻ:"ᓰ·",ᓽ:"ᓱ·",ᓿ:"ᓲ·",ᔁ:"ᓴ·",ᔃ:"ᓵ·",ᔌ:"ᔋ<",ᔎ:"ᔋb",ᔍ:"ᔋᑕ",ᔏ:"ᔋᒐ",ᔘ:"ᔐ·",ᔚ:"ᔑ·",ᔜ:"ᔒ·",ᔞ:"ᔓ·",ᔠ:"ᔔ·",ᔢ:"ᔕ·",ᔤ:"ᔖ·",ᔲ:"ᔨ·",ᔴ:"ᔩ·",ᔶ:"ᔪ·",ᔸ:"ᔫ·",ᔺ:"ᔭ·",ᔼ:"ᔮ·",ᘢ:"ᕃ",ᣠ:"ᕃ·",ᘣ:"ᕆ",ᘤ:"ᕊ",ᕏ:"ᕌ·",ᖃ:"ᕐb",ᖄ:"ᕐḃ",ᖁ:"ᕐd",ᕿ:"ᕐP",ᙯ:"ᕐᑫ",ᕾ:"ᕐᑬ",ᖀ:"ᕐᑮ",ᖂ:"ᕐᑰ",ᖅ:"ᕐᒃ",ᕜ:"ᕚ·",ᣣ:"ᕞ·",ᣤ:"ᕦ·",ᕩ:"ᕧ·",ᣥ:"ᕫ·",ᣨ:"ᖆ·",ᖑ:"ᖕJ",ᙰ:"ᖕᒉ",ᖎ:"ᖕᒊ",ᖏ:"ᖕᒋ",ᖐ:"ᖕᒌ",ᖒ:"ᖕᒎ",ᖓ:"ᖕᒐ",ᖔ:"ᖕᒑ",ᙳ:"ᖖJ",ᙱ:"ᖖᒋ",ᙲ:"ᖖᒌ",ᙴ:"ᖖᒎ",ᙵ:"ᖖᒐ",ᙶ:"ᖖᒑ",ᣪ:"ᖗ·",ᙷ:"ᖧ·",ᙸ:"ᖨ·",ᙹ:"ᖩ·",ᙺ:"ᖪ·",ᙻ:"ᖫ·",ᙼ:"ᖬ·",ᙽ:"ᖭ·","⪫":"ᗒ","⪪":"ᗕ",ꓷ:"ᗡ",ᣰ:"ᗴ·",ᣲ:"ᘛ·",ᶻ:"ᙆ",ꓭ:"ᙠ",ᶺ:"ᣔ",ᴾ:"ᣖ",ᣜ:"ᣟᐞ",ˡ:"ᣳ",ʳ:"ᣴ",ˢ:"ᣵ",ᣛ:"ᣵ",ꚰ:"ᚹ",ᛡ:"ᚼ","⍿":"ᚽ",ᛂ:"ᚽ","𝈿":"ᛋ","↑":"ᛏ","↿":"ᛐ","⥮":"ᛐ⇂","⥣":"ᛐᛚ",ⵣ:"ᛯ","↾":"ᛚ","⨡":"ᛚ","⋄":"ᛜ","◇":"ᛜ","◊":"ᛜ","♢":"ᛜ","🝔":"ᛜ",𑢷:"ᛜ",𐊔:"ᛜ","⍚":"ᛜ̲","⋈":"ᛞ","⨝":"ᛞ","𐓐":"ᛦ","↕":"ᛨ","𐳼":"𐲂","𐳺":"𐲥",ㄱ:"ᄀ",ᆨ:"ᄀ",ᄁ:"ᄀᄀ",ㄲ:"ᄀᄀ",ᆩ:"ᄀᄀ",ᇺ:"ᄀᄂ",ᅚ:"ᄀᄃ",ᇃ:"ᄀᄅ",ᇻ:"ᄀᄇ",ᆪ:"ᄀᄉ",ㄳ:"ᄀᄉ",ᇄ:"ᄀᄉᄀ",ᇼ:"ᄀᄎ",ᇽ:"ᄀᄏ",ᇾ:"ᄀᄒ",ㄴ:"ᄂ",ᆫ:"ᄂ",ᄓ:"ᄂᄀ",ᇅ:"ᄂᄀ",ᄔ:"ᄂᄂ",ㅥ:"ᄂᄂ",ᇿ:"ᄂᄂ",ᄕ:"ᄂᄃ",ㅦ:"ᄂᄃ",ᇆ:"ᄂᄃ",ퟋ:"ᄂᄅ",ᄖ:"ᄂᄇ",ᅛ:"ᄂᄉ",ᇇ:"ᄂᄉ",ㅧ:"ᄂᄉ",ᅜ:"ᄂᄌ",ᆬ:"ᄂᄌ",ㄵ:"ᄂᄌ",ퟌ:"ᄂᄎ",ᇉ:"ᄂᄐ",ᅝ:"ᄂᄒ",ᆭ:"ᄂᄒ",ㄶ:"ᄂᄒ",ᇈ:"ᄂᅀ",ㅨ:"ᄂᅀ",ㄷ:"ᄃ",ᆮ:"ᄃ",ᄗ:"ᄃᄀ",ᇊ:"ᄃᄀ",ᄄ:"ᄃᄃ",ㄸ:"ᄃᄃ",ퟍ:"ᄃᄃ",ퟎ:"ᄃᄃᄇ",ᅞ:"ᄃᄅ",ᇋ:"ᄃᄅ",ꥠ:"ᄃᄆ",ꥡ:"ᄃᄇ",ퟏ:"ᄃᄇ",ꥢ:"ᄃᄉ",ퟐ:"ᄃᄉ",ퟑ:"ᄃᄉᄀ",ꥣ:"ᄃᄌ",ퟒ:"ᄃᄌ",ퟓ:"ᄃᄎ",ퟔ:"ᄃᄐ",ㄹ:"ᄅ",ᆯ:"ᄅ",ꥤ:"ᄅᄀ",ᆰ:"ᄅᄀ",ㄺ:"ᄅᄀ",ꥥ:"ᄅᄀᄀ",ퟕ:"ᄅᄀᄀ",ᇌ:"ᄅᄀᄉ",ㅩ:"ᄅᄀᄉ",ퟖ:"ᄅᄀᄒ",ᄘ:"ᄅᄂ",ᇍ:"ᄅᄂ",ꥦ:"ᄅᄃ",ᇎ:"ᄅᄃ",ㅪ:"ᄅᄃ",ꥧ:"ᄅᄃᄃ",ᇏ:"ᄅᄃᄒ",ᄙ:"ᄅᄅ",ᇐ:"ᄅᄅ",ퟗ:"ᄅᄅᄏ",ꥨ:"ᄅᄆ",ᆱ:"ᄅᄆ",ㄻ:"ᄅᄆ",ᇑ:"ᄅᄆᄀ",ᇒ:"ᄅᄆᄉ",ퟘ:"ᄅᄆᄒ",ꥩ:"ᄅᄇ",ᆲ:"ᄅᄇ",ㄼ:"ᄅᄇ",ퟙ:"ᄅᄇᄃ",ꥪ:"ᄅᄇᄇ",ᇓ:"ᄅᄇᄉ",ㅫ:"ᄅᄇᄉ",ꥫ:"ᄅᄇᄋ",ᇕ:"ᄅᄇᄋ",ퟚ:"ᄅᄇᄑ",ᇔ:"ᄅᄇᄒ",ꥬ:"ᄅᄉ",ᆳ:"ᄅᄉ",ㄽ:"ᄅᄉ",ᇖ:"ᄅᄉᄉ",ᄛ:"ᄅᄋ",ퟝ:"ᄅᄋ",ꥭ:"ᄅᄌ",ꥮ:"ᄅᄏ",ᇘ:"ᄅᄏ",ᆴ:"ᄅᄐ",ㄾ:"ᄅᄐ",ᆵ:"ᄅᄑ",ㄿ:"ᄅᄑ",ᄚ:"ᄅᄒ",ㅀ:"ᄅᄒ",ᄻ:"ᄅᄒ",ᆶ:"ᄅᄒ",ퟲ:"ᄅᄒ",ᇗ:"ᄅᅀ",ㅬ:"ᄅᅀ",ퟛ:"ᄅᅌ",ᇙ:"ᄅᅙ",ㅭ:"ᄅᅙ",ퟜ:"ᄅᅙᄒ",ㅁ:"ᄆ",ᆷ:"ᄆ",ꥯ:"ᄆᄀ",ᇚ:"ᄆᄀ",ퟞ:"ᄆᄂ",ퟟ:"ᄆᄂᄂ",ꥰ:"ᄆᄃ",ᇛ:"ᄆᄅ",ퟠ:"ᄆᄆ",ᄜ:"ᄆᄇ",ㅮ:"ᄆᄇ",ᇜ:"ᄆᄇ",ퟡ:"ᄆᄇᄉ",ꥱ:"ᄆᄉ",ᇝ:"ᄆᄉ",ㅯ:"ᄆᄉ",ᇞ:"ᄆᄉᄉ",ᄝ:"ᄆᄋ",ㅱ:"ᄆᄋ",ᇢ:"ᄆᄋ",ퟢ:"ᄆᄌ",ᇠ:"ᄆᄎ",ᇡ:"ᄆᄒ",ᇟ:"ᄆᅀ",ㅰ:"ᄆᅀ",ㅂ:"ᄇ",ᆸ:"ᄇ",ᄞ:"ᄇᄀ",ㅲ:"ᄇᄀ",ᄟ:"ᄇᄂ",ᄠ:"ᄇᄃ",ㅳ:"ᄇᄃ",ퟣ:"ᄇᄃ",ᇣ:"ᄇᄅ",ퟤ:"ᄇᄅᄑ",ퟥ:"ᄇᄆ",ᄈ:"ᄇᄇ",ㅃ:"ᄇᄇ",ퟦ:"ᄇᄇ",ᄬ:"ᄇᄇᄋ",ㅹ:"ᄇᄇᄋ",ᄡ:"ᄇᄉ",ㅄ:"ᄇᄉ",ᆹ:"ᄇᄉ",ᄢ:"ᄇᄉᄀ",ㅴ:"ᄇᄉᄀ",ᄣ:"ᄇᄉᄃ",ㅵ:"ᄇᄉᄃ",ퟧ:"ᄇᄉᄃ",ᄤ:"ᄇᄉᄇ",ᄥ:"ᄇᄉᄉ",ᄦ:"ᄇᄉᄌ",ꥲ:"ᄇᄉᄐ",ᄫ:"ᄇᄋ",ㅸ:"ᄇᄋ",ᇦ:"ᄇᄋ",ᄧ:"ᄇᄌ",ㅶ:"ᄇᄌ",ퟨ:"ᄇᄌ",ᄨ:"ᄇᄎ",ퟩ:"ᄇᄎ",ꥳ:"ᄇᄏ",ᄩ:"ᄇᄐ",ㅷ:"ᄇᄐ",ᄪ:"ᄇᄑ",ᇤ:"ᄇᄑ",ꥴ:"ᄇᄒ",ᇥ:"ᄇᄒ",ㅅ:"ᄉ",ᆺ:"ᄉ",ᄭ:"ᄉᄀ",ㅺ:"ᄉᄀ",ᇧ:"ᄉᄀ",ᄮ:"ᄉᄂ",ㅻ:"ᄉᄂ",ᄯ:"ᄉᄃ",ㅼ:"ᄉᄃ",ᇨ:"ᄉᄃ",ᄰ:"ᄉᄅ",ᇩ:"ᄉᄅ",ᄱ:"ᄉᄆ",ퟪ:"ᄉᄆ",ᄲ:"ᄉᄇ",ㅽ:"ᄉᄇ",ᇪ:"ᄉᄇ",ᄳ:"ᄉᄇᄀ",ퟫ:"ᄉᄇᄋ",ᄊ:"ᄉᄉ",ㅆ:"ᄉᄉ",ᆻ:"ᄉᄉ",ퟬ:"ᄉᄉᄀ",ퟭ:"ᄉᄉᄃ",ꥵ:"ᄉᄉᄇ",ᄴ:"ᄉᄉᄉ",ᄵ:"ᄉᄋ",ᄶ:"ᄉᄌ",ㅾ:"ᄉᄌ",ퟯ:"ᄉᄌ",ᄷ:"ᄉᄎ",ퟰ:"ᄉᄎ",ᄸ:"ᄉᄏ",ᄹ:"ᄉᄐ",ퟱ:"ᄉᄐ",ᄺ:"ᄉᄑ",ퟮ:"ᄉᅀ",ㅇ:"ᄋ",ᆼ:"ᄋ",ᅁ:"ᄋᄀ",ᇬ:"ᄋᄀ",ᇭ:"ᄋᄀᄀ",ᅂ:"ᄋᄃ",ꥶ:"ᄋᄅ",ᅃ:"ᄋᄆ",ᅄ:"ᄋᄇ",ᅅ:"ᄋᄉ",ᇱ:"ᄋᄉ",ㆂ:"ᄋᄉ",ᅇ:"ᄋᄋ",ㆀ:"ᄋᄋ",ᇮ:"ᄋᄋ",ᅈ:"ᄋᄌ",ᅉ:"ᄋᄎ",ᇯ:"ᄋᄏ",ᅊ:"ᄋᄐ",ᅋ:"ᄋᄑ",ꥷ:"ᄋᄒ",ᅆ:"ᄋᅀ",ᇲ:"ᄋᅀ",ㆃ:"ᄋᅀ",ㅈ:"ᄌ",ᆽ:"ᄌ",ퟷ:"ᄌᄇ",ퟸ:"ᄌᄇᄇ",ᅍ:"ᄌᄋ",ᄍ:"ᄌᄌ",ㅉ:"ᄌᄌ",ퟹ:"ᄌᄌ",ꥸ:"ᄌᄌᄒ",ㅊ:"ᄎ",ᆾ:"ᄎ",ᅒ:"ᄎᄏ",ᅓ:"ᄎᄒ",ㅋ:"ᄏ",ᆿ:"ᄏ",ㅌ:"ᄐ",ᇀ:"ᄐ",ꥹ:"ᄐᄐ",ㅍ:"ᄑ",ᇁ:"ᄑ",ᅖ:"ᄑᄇ",ᇳ:"ᄑᄇ",ퟺ:"ᄑᄉ",ᅗ:"ᄑᄋ",ㆄ:"ᄑᄋ",ᇴ:"ᄑᄋ",ퟻ:"ᄑᄐ",ꥺ:"ᄑᄒ",ㅎ:"ᄒ",ᇂ:"ᄒ",ᇵ:"ᄒᄂ",ᇶ:"ᄒᄅ",ᇷ:"ᄒᄆ",ᇸ:"ᄒᄇ",ꥻ:"ᄒᄉ",ᅘ:"ᄒᄒ",ㆅ:"ᄒᄒ",ᄽ:"ᄼᄼ",ᄿ:"ᄾᄾ",ㅿ:"ᅀ",ᇫ:"ᅀ",ퟳ:"ᅀᄇ",ퟴ:"ᅀᄇᄋ",ㆁ:"ᅌ",ᇰ:"ᅌ",ퟵ:"ᅌᄆ",ퟶ:"ᅌᄒ",ᅏ:"ᅎᅎ",ᅑ:"ᅐᅐ",ㆆ:"ᅙ",ᇹ:"ᅙ",ꥼ:"ᅙᅙ",ㅤ:"ᅠ",ㅏ:"ᅡ",ᆣ:"ᅡー",ᅶ:"ᅡᅩ",ᅷ:"ᅡᅮ",ᅢ:"ᅡ丨",ㅐ:"ᅡ丨",ㅑ:"ᅣ",ᅸ:"ᅣᅩ",ᅹ:"ᅣᅭ",ᆤ:"ᅣᅮ",ᅤ:"ᅣ丨",ㅒ:"ᅣ丨",ㅓ:"ᅥ",ᅼ:"ᅥー",ᅺ:"ᅥᅩ",ᅻ:"ᅥᅮ",ᅦ:"ᅥ丨",ㅔ:"ᅥ丨",ㅕ:"ᅧ",ᆥ:"ᅧᅣ",ᅽ:"ᅧᅩ",ᅾ:"ᅧᅮ",ᅨ:"ᅧ丨",ㅖ:"ᅧ丨",ㅗ:"ᅩ",ᅪ:"ᅩᅡ",ㅘ:"ᅩᅡ",ᅫ:"ᅩᅡ丨",ㅙ:"ᅩᅡ丨",ᆦ:"ᅩᅣ",ᆧ:"ᅩᅣ丨",ᅿ:"ᅩᅥ",ᆀ:"ᅩᅥ丨",ힰ:"ᅩᅧ",ᆁ:"ᅩᅧ丨",ᆂ:"ᅩᅩ",ힱ:"ᅩᅩ丨",ᆃ:"ᅩᅮ",ᅬ:"ᅩ丨",ㅚ:"ᅩ丨",ㅛ:"ᅭ",ힲ:"ᅭᅡ",ힳ:"ᅭᅡ丨",ᆄ:"ᅭᅣ",ㆇ:"ᅭᅣ",ᆆ:"ᅭᅣ",ᆅ:"ᅭᅣ丨",ㆈ:"ᅭᅣ丨",ힴ:"ᅭᅥ",ᆇ:"ᅭᅩ",ᆈ:"ᅭ丨",ㆉ:"ᅭ丨",ㅜ:"ᅮ",ᆉ:"ᅮᅡ",ᆊ:"ᅮᅡ丨",ᅯ:"ᅮᅥ",ㅝ:"ᅮᅥ",ᆋ:"ᅮᅥー",ᅰ:"ᅮᅥ丨",ㅞ:"ᅮᅥ丨",ힵ:"ᅮᅧ",ᆌ:"ᅮᅧ丨",ᆍ:"ᅮᅮ",ᅱ:"ᅮ丨",ㅟ:"ᅮ丨",ힶ:"ᅮ丨丨",ㅠ:"ᅲ",ᆎ:"ᅲᅡ",ힷ:"ᅲᅡ丨",ᆏ:"ᅲᅥ",ᆐ:"ᅲᅥ丨",ᆑ:"ᅲᅧ",ㆊ:"ᅲᅧ",ᆒ:"ᅲᅧ丨",ㆋ:"ᅲᅧ丨",ힸ:"ᅲᅩ",ᆓ:"ᅲᅮ",ᆔ:"ᅲ丨",ㆌ:"ᅲ丨",ㆍ:"ᆞ",ퟅ:"ᆞᅡ",ᆟ:"ᆞᅥ",ퟆ:"ᆞᅥ丨",ᆠ:"ᆞᅮ",ᆢ:"ᆞᆞ",ᆡ:"ᆞ丨",ㆎ:"ᆞ丨",ヘ:"へ","⍁":"〼","⧄":"〼","꒞":"ꁊ","꒬":"ꁐ","꒜":"ꃀ","꒨":"ꄲ","꒿":"ꉙ","꒾":"ꊱ","꒔":"ꋍ","꓀":"ꎫ","꓂":"ꎵ","꒺":"ꎿ","꒰":"ꏂ","꒧":"ꑘ","⊥":"ꓕ","⟂":"ꓕ","𝈜":"ꓕ",Ʇ:"ꓕ",Ꞟ:"ꓤ","⅁":"ꓨ","⅂":"ꓶ","𝈕":"ꓶ","𝈫":"ꓶ",𖼦:"ꓶ",𐐑:"ꓶ","⅃":"𖼀",𑫦:"𑫥𑫯",𑫨:"𑫥𑫥",𑫩:"𑫥𑫥𑫯",𑫪:"𑫥𑫥𑫰",𑫧:"𑫥𑫰",𑫴:"𑫳𑫯",𑫶:"𑫳𑫳",𑫷:"𑫳𑫳𑫯",𑫸:"𑫳𑫳𑫰",𑫵:"𑫳𑫰",𑫬:"𑫫𑫯",𑫭:"𑫫𑫫",𑫮:"𑫫𑫫𑫯","⊕":"𐊨","⨁":"𐊨","🜨":"𐊨",Ꚛ:"𐊨","▽":"𐊼","𝈔":"𐊼","🜄":"𐊼","⧖":"𐋀",ꞛ:"𐐺",Ꞛ:"𐐒","𐒠":"𐒆",𐏑:"𐎂",𐏓:"𐎓",𒀸:"𐎚","☥":"𐦞",𓋹:"𐦞",〹:"卄",不:"不",丽:"丽",並:"並","⎜":"丨","⎟":"丨","⎢":"丨","⎥":"丨","⎪":"丨","⎮":"丨","㇑":"丨",ᅵ:"丨",ㅣ:"丨","⼁":"丨",ᆜ:"丨ー",ᆘ:"丨ᅡ",ᆙ:"丨ᅣ",ힽ:"丨ᅣᅩ",ힾ:"丨ᅣ丨",ힿ:"丨ᅧ",ퟀ:"丨ᅧ丨",ᆚ:"丨ᅩ",ퟁ:"丨ᅩ丨",ퟂ:"丨ᅭ",ᆛ:"丨ᅮ",ퟃ:"丨ᅲ",ᆝ:"丨ᆞ",ퟄ:"丨丨",串:"串",丸:"丸",丹:"丹",乁:"乁","㇠":"乙","⼄":"乙","㇟":"乚","⺃":"乚","㇖":"乛","⺂":"乛","⻲":"亀",亂:"亂","㇚":"亅","⼅":"亅",了:"了",ニ:"二","⼆":"二",𠄢:"𠄢","⼇":"亠",亮:"亮","⼈":"人",イ:"亻","⺅":"亻",什:"什",仌:"仌",令:"令",你:"你",倂:"併",倂:"併",侀:"侀",來:"來",例:"例",侮:"侮",侮:"侮",侻:"侻",便:"便",值:"値",倫:"倫",偺:"偺",備:"備",像:"像",僚:"僚",僧:"僧",僧:"僧",㒞:"㒞","⼉":"儿",兀:"兀","⺎":"兀",充:"充",免:"免",免:"免",兔:"兔",兤:"兤","⼊":"入",內:"內",全:"全",兩:"兩",ハ:"八","⼋":"八",六:"六",具:"具",𠔜:"𠔜",𠔥:"𠔥",冀:"冀",㒹:"㒹","⼌":"冂",再:"再",𠕋:"𠕋",冒:"冒",冕:"冕",㒻:"㒻",最:"最","⼍":"冖",冗:"冗",冤:"冤","⼎":"冫",冬:"冬",况:"况",况:"况",冷:"冷",凉:"凉",凌:"凌",凜:"凜",凞:"凞","⼏":"几",𠘺:"𠘺",凵:"凵","⼐":"凵","⼑":"刀","⺉":"刂",刃:"刃",切:"切",切:"切",列:"列",利:"利",㓟:"㓟",刺:"刺",刻:"刻",剆:"剆",割:"割",剷:"剷",劉:"劉",𠠄:"𠠄",カ:"力",力:"力","⼒":"力",劣:"劣",㔕:"㔕",劳:"劳",勇:"勇",勇:"勇",勉:"勉",勉:"勉",勒:"勒",勞:"勞",勤:"勤",勤:"勤",勵:"勵","⼓":"勹",勺:"勺",勺:"勺",包:"包",匆:"匆",𠣞:"𠣞","⼔":"匕",北:"北",北:"北","⼕":"匚","⼖":"匸",匿:"匿","⼗":"十",〸:"十",〺:"卅",卉:"卉","࿖":"卍","࿕":"卐",卑:"卑",卑:"卑",博:"博",ト:"卜","⼘":"卜","⼙":"卩","⺋":"㔾",即:"即",卵:"卵",卽:"卽",卿:"卿",卿:"卿",卿:"卿","⼚":"厂",𠨬:"𠨬","⼛":"厶",參:"參","⼜":"又",及:"及",叟:"叟",𠭣:"𠭣",ロ:"口","⼝":"口",囗:"口","⼞":"口",句:"句",叫:"叫",叱:"叱",吆:"吆",吏:"吏",吝:"吝",吸:"吸",呂:"呂",呈:"呈",周:"周",咞:"咞",咢:"咢",咽:"咽",䎛:"㖈",哶:"哶",唐:"唐",啓:"啓",啟:"啓",啕:"啕",啣:"啣",善:"善",善:"善",喇:"喇",喙:"喙",喙:"喙",喝:"喝",喝:"喝",喫:"喫",喳:"喳",嗀:"嗀",嗂:"嗂",嗢:"嗢",嘆:"嘆",嘆:"嘆",噑:"噑",噴:"噴",器:"器",囹:"囹",圖:"圖",圗:"圗","⼟":"土",士:"土","⼠":"土",型:"型",城:"城",㦳:"㘽",埴:"埴",堍:"堍",報:"報",堲:"堲",塀:"塀",塚:"塚",塚:"塚",塞:"塞",填:"塡",壿:"墫",墬:"墬",墳:"墳",壘:"壘",壟:"壟",𡓤:"𡓤",壮:"壮",売:"売",壷:"壷","⼡":"夂",夆:"夆","⼢":"夊",タ:"夕","⼣":"夕",多:"多",夢:"夢","⼤":"大",奄:"奄",奈:"奈",契:"契",奔:"奔",奢:"奢",女:"女","⼥":"女",𡚨:"𡚨",𡛪:"𡛪",姘:"姘",姬:"姬",娛:"娛",娧:"娧",婢:"婢",婦:"婦",嬀:"媯",㛮:"㛮",㛼:"㛼",媵:"媵",嬈:"嬈",嬨:"嬨",嬾:"嬾",嬾:"嬾","⼦":"子","⼧":"宀",宅:"宅",𡧈:"𡧈",寃:"寃",寘:"寘",寧:"寧",寧:"寧",寧:"寧",寮:"寮",寳:"寳",𡬘:"𡬘","⼨":"寸",寿:"寿",将:"将","⼩":"小",尢:"尢","⺐":"尢","⼪":"尢","⺏":"尣",㞁:"㞁","⼫":"尸",尿:"尿",屠:"屠",屢:"屢",層:"層",履:"履",屮:"屮",屮:"屮","⼬":"屮",𡴋:"𡴋","⼭":"山",峀:"峀",岍:"岍",𡷤:"𡷤",𡷦:"𡷦",崙:"崙",嵃:"嵃",嵐:"嵐",嵫:"嵫",嵮:"嵮",嵼:"嵼",嶲:"嶲",嶺:"嶺","⼮":"巛",巢:"巢",エ:"工","⼯":"工","⼰":"己","⺒":"巳",㠯:"㠯",巽:"巽","⼱":"巾",帲:"帡",帨:"帨",帽:"帽",幩:"幩",㡢:"㡢",𢆃:"𢆃","⼲":"干",年:"年",𢆟:"𢆟","⺓":"幺","⼳":"幺","⼴":"广",度:"度",㡼:"㡼",庰:"庰",庳:"庳",庶:"庶",廊:"廊",廊:"廊",廉:"廉",廒:"廒",廓:"廓",廙:"廙",廬:"廬","⼵":"廴",廾:"廾","⼶":"廾",𢌱:"𢌱",𢌱:"𢌱",弄:"弄","⼷":"弋","⼸":"弓",弢:"弢",弢:"弢","⼹":"彐","⺔":"彑",当:"当",㣇:"㣇","⼺":"彡",形:"形",彩:"彩",彫:"彫","⼻":"彳",律:"律",㣣:"㣣",徚:"徚",復:"復",徭:"徭","⼼":"心","⺖":"忄","⺗":"㣺",忍:"忍",志:"志",念:"念",忹:"忹",怒:"怒",怜:"怜",恵:"恵",㤜:"㤜",㤺:"㤺",悁:"悁",悔:"悔",悔:"悔",惇:"惇",惘:"惘",惡:"惡",𢛔:"𢛔",愈:"愈",慨:"慨",慄:"慄",慈:"慈",慌:"慌",慌:"慌",慎:"慎",慎:"慎",慠:"慠",慺:"慺",憎:"憎",憎:"憎",憎:"憎",憐:"憐",憤:"憤",憯:"憯",憲:"憲",𢡄:"𢡄",𢡊:"𢡊",懞:"懞",懲:"懲",懲:"懲",懲:"懲",懶:"懶",懶:"懶",戀:"戀","⼽":"戈",成:"成",戛:"戛",戮:"戮",戴:"戴","⼾":"戶",戸:"戶","⼿":"手","⺘":"扌",扝:"扝",抱:"抱",拉:"拉",拏:"拏",拓:"拓",拔:"拔",拼:"拼",拾:"拾",𢬌:"𢬌",挽:"挽",捐:"捐",捨:"捨",捻:"捻",掃:"掃",掠:"掠",掩:"掩",揄:"揄",揤:"揤",摒:"摒",𢯱:"𢯱",搜:"搜",搢:"搢",揅:"揅",摩:"摩",摷:"摷",摾:"摾",㨮:"㨮",搉:"㩁",撚:"撚",撝:"撝",擄:"擄",㩬:"㩬","⽀":"支","⽁":"攴","⺙":"攵",敏:"敏",敏:"敏",敖:"敖",敬:"敬",數:"數",𣀊:"𣀊","⽂":"文","⻫":"斉","⽃":"斗",料:"料","⽄":"斤","⽅":"方",旅:"旅","⽆":"无","⺛":"旡",既:"既",旣:"旣","⽇":"日",易:"易",曶:"㫚",㫤:"㫤",晉:"晉",晩:"晚",晴:"晴",晴:"晴",暑:"暑",暑:"暑",暈:"暈",㬈:"㬈",暜:"暜",暴:"暴",曆:"曆",㬙:"㬙",𣊸:"𣊸","⽈":"曰",更:"更",書:"書","⽉":"月",𣍟:"𣍟",肦:"朌",胐:"朏",胊:"朐",脁:"朓",胶:"㬵",朗:"朗",朗:"朗",朗:"朗",脧:"朘",望:"望",望:"望",幐:"㬺",䐠:"㬻",𣎓:"𣎓",膧:"朣",𣎜:"𣎜","⽊":"木",李:"李",杓:"杓",杖:"杖",杞:"杞",𣏃:"𣏃",柿:"杮",杻:"杻",枅:"枅",林:"林",㭉:"㭉",𣏕:"𣏕",柳:"柳",柺:"柺",栗:"栗",栟:"栟",桒:"桒",𣑭:"𣑭",梁:"梁",梅:"梅",梅:"梅",梎:"梎",梨:"梨",椔:"椔",楂:"楂",㮝:"㮝",㮝:"㮝",槩:"㮣",樧:"榝",榣:"榣",槪:"槪",樂:"樂",樂:"樂",樂:"樂",樓:"樓",𣚣:"𣚣",檨:"檨",櫓:"櫓",櫛:"櫛",欄:"欄",㰘:"㰘","⽋":"欠",次:"次",𣢧:"𣢧",歔:"歔",㱎:"㱎","⽌":"止","⻭":"歯",歲:"歲",歷:"歷",歹:"歹","⽍":"歹","⺞":"歺",殟:"殟",殮:"殮","⽎":"殳",殺:"殺",殺:"殺",殺:"殺",殻:"殻",𣪍:"𣪍","⽏":"毋","⺟":"母",𣫺:"𣫺","⽐":"比","⽑":"毛","⽒":"氏","⺠":"民","⽓":"气","⽔":"水","⺡":"氵","⺢":"氺",汎:"汎",汧:"汧",沈:"沈",沿:"沿",泌:"泌",泍:"泍",泥:"泥",𣲼:"𣲼",洛:"洛",洞:"洞",洴:"洴",派:"派",流:"流",流:"流",流:"流",洖:"洖",浩:"浩",浪:"浪",海:"海",海:"海",浸:"浸",涅:"涅",𣴞:"𣴞",淋:"淋",淚:"淚",淪:"淪",淹:"淹",渚:"渚",港:"港",湮:"湮",潙:"溈",滋:"滋",滋:"滋",溜:"溜",溺:"溺",滇:"滇",滑:"滑",滛:"滛",㴳:"㴳",漏:"漏",漢:"漢",漢:"漢",漣:"漣",𣻑:"𣻑",潮:"潮",𣽞:"𣽞",𣾎:"𣾎",濆:"濆",濫:"濫",濾:"濾",瀛:"瀛",瀞:"瀞",瀞:"瀞",瀹:"瀹",灊:"灊",㶖:"㶖","⽕":"火","⺣":"灬",灰:"灰",灷:"灷",災:"災",炙:"炙",炭:"炭",烈:"烈",烙:"烙",煮:"煮",煮:"煮",𤉣:"𤉣",煅:"煅",煉:"煉",𤋮:"𤋮",熜:"熜",燎:"燎",燐:"燐",𤎫:"𤎫",爐:"爐",爛:"爛",爨:"爨","⽖":"爪",爫:"爫","⺤":"爫",爵:"爵",爵:"爵","⽗":"父","⽘":"爻","⺦":"丬","⽙":"爿","⽚":"片",牐:"牐","⽛":"牙",𤘈:"𤘈","⽜":"牛",牢:"牢",犀:"犀",犕:"犕","⽝":"犬","⺨":"犭",犯:"犯",狀:"狀",𤜵:"𤜵",狼:"狼",猪:"猪",猪:"猪",𤠔:"𤠔",獵:"獵",獺:"獺","⽞":"玄",率:"率",率:"率","⽟":"玉",王:"王",㺬:"㺬",玥:"玥",玲:"玲",㺸:"㺸",㺸:"㺸",珞:"珞",琉:"琉",理:"理",琢:"琢",瑇:"瑇",瑜:"瑜",瑩:"瑩",瑱:"瑱",瑱:"瑱",璅:"璅",璉:"璉",璘:"璘",瓊:"瓊","⽠":"瓜","⽡":"瓦",㼛:"㼛",甆:"甆","⽢":"甘","⽣":"生",甤:"甤","⽤":"用","⽥":"田",画:"画",甾:"甾",𤰶:"𤰶",留:"留",略:"略",異:"異",異:"異",𤲒:"𤲒","⽦":"疋","⽧":"疒",痢:"痢",瘐:"瘐",瘟:"瘟",瘝:"瘝",療:"療",癩:"癩","⽨":"癶","⽩":"白",𤾡:"𤾡",𤾸:"𤾸","⽪":"皮","⽫":"皿",𥁄:"𥁄",㿼:"㿼",益:"益",益:"益",盛:"盛",盧:"盧",䀈:"䀈","⽬":"目",直:"直",直:"直",𥃲:"𥃲",𥃳:"𥃳",省:"省",䀘:"䀘",𥄙:"𥄙",眞:"眞",真:"真",真:"真",𥄳:"𥄳",着:"着",睊:"睊",睊:"睊",鿃:"䀹",䀹:"䀹",䀹:"䀹",晣:"䀿",䁆:"䁆",瞋:"瞋",𥉉:"𥉉",瞧:"瞧","⽭":"矛","⽮":"矢","⽯":"石",䂖:"䂖",𥐝:"𥐝",硏:"研",硎:"硎",硫:"硫",碌:"碌",碌:"碌",碑:"碑",磊:"磊",磌:"磌",磌:"磌",磻:"磻",䃣:"䃣",礪:"礪","⽰":"示","⺭":"礻",礼:"礼",社:"社",祈:"祈",祉:"祉",𥘦:"𥘦",祐:"祐",祖:"祖",祖:"祖",祝:"祝",神:"神",祥:"祥",視:"視",視:"視",祿:"祿",𥚚:"𥚚",禍:"禍",禎:"禎",福:"福",福:"福",𥛅:"𥛅",禮:"禮","⽱":"禸","⽲":"禾",秊:"秊",䄯:"䄯",秫:"秫",稜:"稜",穊:"穊",穀:"穀",穀:"穀",穏:"穏","⽳":"穴",突:"突",𥥼:"𥥼",窱:"窱",立:"立","⽴":"立","⻯":"竜",𥪧:"𥪧",𥪧:"𥪧",竮:"竮","⽵":"竹",笠:"笠",節:"節",節:"節",䈂:"䈂",𥮫:"𥮫",篆:"篆",䈧:"䈧",築:"築",𥲀:"𥲀",𥳐:"𥳐",簾:"簾",籠:"籠","⽶":"米",类:"类",粒:"粒",精:"精",糒:"糒",糖:"糖",糨:"糨",䊠:"䊠",糣:"糣",糧:"糧","⽷":"糸","⺯":"糹",𥾆:"𥾆",紀:"紀",紐:"紐",索:"索",累:"累",絶:"絕",絣:"絣",絛:"絛",綠:"綠",綾:"綾",緇:"緇",練:"練",練:"練",練:"練",縂:"縂",䌁:"䌁",縉:"縉",縷:"縷",繁:"繁",繅:"繅",𦇚:"𦇚",䌴:"䌴","⽸":"缶",𦈨:"𦈨",缾:"缾",𦉇:"𦉇","⽹":"网","⺫":"罒","⺲":"罒","⺱":"罓",䍙:"䍙",署:"署",𦋙:"𦋙",罹:"罹",罺:"罺",羅:"羅",𦌾:"𦌾","⽺":"羊",羕:"羕",羚:"羚",羽:"羽","⽻":"羽",翺:"翺",老:"老","⽼":"老","⺹":"耂",者:"者",者:"者",者:"者","⽽":"而",𦓚:"𦓚","⽾":"耒",𦔣:"𦔣","⽿":"耳",聆:"聆",聠:"聠",𦖨:"𦖨",聯:"聯",聰:"聰",聾:"聾","⾀":"聿","⺺":"肀","⾁":"肉",肋:"肋",肭:"肭",育:"育",䏕:"䏕",䏙:"䏙",腁:"胼",脃:"脃",脾:"脾",䐋:"䐋",朡:"朡",𦞧:"𦞧",𦞵:"𦞵",朦:"䑃",臘:"臘","⾂":"臣",臨:"臨","⾃":"自",臭:"臭","⾄":"至","⾅":"臼",舁:"舁",舁:"舁",舄:"舄","⾆":"舌",舘:"舘","⾇":"舛","⾈":"舟",䑫:"䑫","⾉":"艮",良:"良","⾊":"色","⾋":"艸",艹:"艹",艹:"艹","⺾":"艹","⺿":"艹","⻀":"艹",芋:"芋",芑:"芑",芝:"芝",花:"花",芳:"芳",芽:"芽",若:"若",若:"若",苦:"苦",𦬼:"𦬼",茶:"茶",荒:"荒",荣:"荣",茝:"茝",茣:"茣",莽:"莽",荓:"荓",菉:"菉",菊:"菊",菌:"菌",菜:"菜",菧:"菧",華:"華",菱:"菱",著:"著",著:"著",𦰶:"𦰶",莭:"莭",落:"落",葉:"葉",蔿:"蒍",𦳕:"𦳕",𦵫:"𦵫",蓮:"蓮",蓱:"蓱",蓳:"蓳",蓼:"蓼",蔖:"蔖",䔫:"䔫",蕤:"蕤",𦼬:"𦼬",藍:"藍",䕝:"䕝",𦾱:"𦾱",䕡:"䕡",藺:"藺",蘆:"蘆",䕫:"䕫",蘒:"蘒",蘭:"蘭",𧃒:"𧃒",虁:"蘷",蘿:"蘿","⾌":"虍","⻁":"虎",虐:"虐",虜:"虜",虜:"虜",虧:"虧",虩:"虩","⾍":"虫",蚩:"蚩",蚈:"蚈",蛢:"蛢",蜎:"蜎",蜨:"蜨",蝫:"蝫",蟡:"蟡",蝹:"蝹",蝹:"蝹",螆:"螆",䗗:"䗗",𧏊:"𧏊",螺:"螺",蠁:"蠁",䗹:"䗹",蠟:"蠟","⾎":"血",行:"行","⾏":"行",衠:"衠",衣:"衣","⾐":"衣","⻂":"衤",裂:"裂",𧙧:"𧙧",裏:"裏",裗:"裗",裞:"裞",裡:"裡",裸:"裸",裺:"裺",䘵:"䘵",褐:"褐",襁:"襁",襤:"襤","⾑":"襾","⻄":"西","⻃":"覀",覆:"覆",見:"見","⾒":"見",𧢮:"𧢮","⻅":"见","⾓":"角","⾔":"言",𧥦:"𧥦",詽:"訮",訞:"䚶",䚾:"䚾",䛇:"䛇",誠:"誠",說:"說",說:"說",調:"調",請:"請",諒:"諒",論:"論",諭:"諭",諭:"諭",諸:"諸",諸:"諸",諾:"諾",諾:"諾",謁:"謁",謁:"謁",謹:"謹",謹:"謹",識:"識",讀:"讀",讏:"讆",變:"變",變:"變","⻈":"讠","⾕":"谷","⾖":"豆",豈:"豈",豕:"豕","⾗":"豕",豣:"豜","⾘":"豸",𧲨:"𧲨","⾙":"貝",貫:"貫",賁:"賁",賂:"賂",賈:"賈",賓:"賓",贈:"贈",贈:"贈",贛:"贛","⻉":"贝","⾚":"赤","⾛":"走",起:"起",趆:"赿",𧻓:"𧻓",𧼯:"𧼯","⾜":"足",跋:"跋",趼:"趼",跺:"跥",路:"路",跰:"跰",躛:"躗","⾝":"身",車:"車","⾞":"車",軔:"軔",輧:"軿",輦:"輦",輪:"輪",輸:"輸",輸:"輸",輻:"輻",轢:"轢","⻋":"车","⾟":"辛",辞:"辞",辰:"辰","⾠":"辰","⾡":"辵",辶:"辶","⻌":"辶","⻍":"辶",巡:"巡",連:"連",逸:"逸",逸:"逸",遲:"遲",遼:"遼",𨗒:"𨗒",𨗭:"𨗭",邏:"邏","⾢":"邑",邔:"邔",郎:"郎",郞:"郎",郞:"郎",郱:"郱",都:"都",𨜮:"𨜮",鄑:"鄑",鄛:"鄛","⾣":"酉",酪:"酪",醙:"醙",醴:"醴","⾤":"釆",里:"里","⾥":"里",量:"量",金:"金","⾦":"金",鈴:"鈴",鈸:"鈸",鉶:"鉶",鋗:"鋗",鋘:"鋘",鉼:"鉼",錄:"錄",鍊:"鍊",鎮:"鎭",鏹:"鏹",鐕:"鐕",𨯺:"𨯺","⻐":"钅","⻑":"長","⾧":"長","⻒":"镸","⻓":"长","⾨":"門",開:"開",䦕:"䦕",閭:"閭",閷:"閷",𨵷:"𨵷","⻔":"门","⾩":"阜","⻏":"阝","⻖":"阝",阮:"阮",陋:"陋",降:"降",陵:"陵",陸:"陸",陼:"陼",隆:"隆",隣:"隣",䧦:"䧦","⾪":"隶",隷:"隷",隸:"隷",隸:"隷","⾫":"隹",雃:"雃",離:"離",難:"難",難:"難","⾬":"雨",零:"零",雷:"雷",霣:"霣",𩅅:"𩅅",露:"露",靈:"靈","⾭":"靑","⻘":"青",靖:"靖",靖:"靖",𩇟:"𩇟","⾮":"非","⾯":"面",𩈚:"𩈚","⾰":"革",䩮:"䩮",䩶:"䩶","⾱":"韋",韛:"韛",韠:"韠","⻙":"韦","⾲":"韭",𩐊:"𩐊","⾳":"音",響:"響",響:"響","⾴":"頁",䪲:"䪲",頋:"頋",頋:"頋",頋:"頋",領:"領",頩:"頩",𩒖:"𩒖",頻:"頻",頻:"頻",類:"類","⻚":"页","⾵":"風",𩖶:"𩖶","⻛":"风","⾶":"飛","⻜":"飞","⻝":"食","⾷":"食","⻟":"飠",飢:"飢",飯:"飯",飼:"飼",䬳:"䬳",館:"館",餩:"餩","⻠":"饣","⾸":"首","⾹":"香",馧:"馧","⾺":"馬",駂:"駂",駱:"駱",駾:"駾",驪:"驪","⻢":"马","⾻":"骨",䯎:"䯎","⾼":"高","⾽":"髟",𩬰:"𩬰",鬒:"鬒",鬒:"鬒","⾾":"鬥","⾿":"鬯","⿀":"鬲","⿁":"鬼","⻤":"鬼","⿂":"魚",魯:"魯",鱀:"鱀",鱗:"鱗","⻥":"鱼","⿃":"鳥",鳽:"鳽",䳎:"䳎",鵧:"鵧",䳭:"䳭",𪃎:"𪃎",鶴:"鶴",𪄅:"𪄅",䳸:"䳸",鷺:"鷺",𪈎:"𪈎",鸞:"鸞",鹃:"鹂","⿄":"鹵",鹿:"鹿","⿅":"鹿",𪊑:"𪊑",麗:"麗",麟:"麟","⿆":"麥","⻨":"麦",麻:"麻","⿇":"麻",𪎒:"𪎒","⿈":"黃","⻩":"黄","⿉":"黍",黎:"黎",䵖:"䵖","⿊":"黑",黒:"黑",墨:"墨",黹:"黹","⿋":"黹","⿌":"黽",鼅:"鼅",黾:"黾","⿍":"鼎",鼏:"鼏","⿎":"鼓",鼖:"鼖","⿏":"鼠",鼻:"鼻","⿐":"鼻",齃:"齃","⿑":"齊","⻬":"齐","⿒":"齒",𪘀:"𪘀","⻮":"齿",龍:"龍","⿓":"龍",龎:"龎","⻰":"龙",龜:"龜",龜:"龜",龜:"龜","⿔":"龜","⻳":"龟","⿕":"龠"};var $T,KA;function Yre(){if(KA)return $T;KA=1;var e=zre;var t=RegExp(Object.keys(e).map((function(e){return e.replace(/([.?*+^$[\]\\(){}|-])/g,"\\$1")})).join("|"),"g");function n(t){return e[t]}return $T=function(e){return e.replace(t,n)}}var Jre=Yre();const Xre=Ko(Jre);var BT,GA,WA,VT,zA,YA,Hm={exports:{}},HT={};function Zre(){if(GA)return BT;function e(e,t){"boolean"==typeof t&&(t={forever:t}),this._originalTimeouts=JSON.parse(JSON.stringify(e)),this._timeouts=e,this._options=t||{},this._maxRetryTime=t&&t.maxRetryTime||1/0,this._fn=null,this._errors=[],this._attempts=1,this._operationTimeout=null,this._operationTimeoutCb=null,this._timeout=null,this._operationStart=null,this._timer=null,this._options.forever&&(this._cachedTimeouts=this._timeouts.slice(0))}return GA=1,BT=e,e.prototype.reset=function(){this._attempts=1,this._timeouts=this._originalTimeouts.slice(0)},e.prototype.stop=function(){this._timeout&&clearTimeout(this._timeout),this._timer&&clearTimeout(this._timer),this._timeouts=[],this._cachedTimeouts=null},e.prototype.retry=function(e){if(this._timeout&&clearTimeout(this._timeout),!e)return!1;var t=(new Date).getTime();if(e&&t-this._operationStart>=this._maxRetryTime)return this._errors.push(e),this._errors.unshift(new Error("RetryOperation timeout occurred")),!1;this._errors.push(e);var n=this._timeouts.shift();if(void 0===n){if(!this._cachedTimeouts)return!1;this._errors.splice(0,this._errors.length-1),n=this._cachedTimeouts.slice(-1)}var r=this;return this._timer=setTimeout((function(){r._attempts++,r._operationTimeoutCb&&(r._timeout=setTimeout((function(){r._operationTimeoutCb(r._attempts)}),r._operationTimeout),r._options.unref&&r._timeout.unref()),r._fn(r._attempts)}),n),this._options.unref&&this._timer.unref(),!0},e.prototype.attempt=function(e,t){this._fn=e,t&&(t.timeout&&(this._operationTimeout=t.timeout),t.cb&&(this._operationTimeoutCb=t.cb));var n=this;this._operationTimeoutCb&&(this._timeout=setTimeout((function(){n._operationTimeoutCb()}),n._operationTimeout)),this._operationStart=(new Date).getTime(),this._fn(this._attempts)},e.prototype.try=function(e){console.log("Using RetryOperation.try() is deprecated"),this.attempt(e)},e.prototype.start=function(e){console.log("Using RetryOperation.start() is deprecated"),this.attempt(e)},e.prototype.start=e.prototype.try,e.prototype.errors=function(){return this._errors},e.prototype.attempts=function(){return this._attempts},e.prototype.mainError=function(){if(0===this._errors.length)return null;for(var e={},t=null,n=0,r=0;r<this._errors.length;r++){var i=this._errors[r],o=i.message,s=(e[o]||0)+1;e[o]=s,s>=n&&(t=i,n=s)}return t},BT}function Qre(){return WA||(WA=1,e=HT,t=Zre(),e.operation=function(n){var r=e.timeouts(n);return new t(r,{forever:n&&(n.forever||n.retries===1/0),unref:n&&n.unref,maxRetryTime:n&&n.maxRetryTime})},e.timeouts=function(e){if(e instanceof Array)return[].concat(e);var t={retries:10,factor:2,minTimeout:1e3,maxTimeout:1/0,randomize:!1};for(var n in e)t[n]=e[n];if(t.minTimeout>t.maxTimeout)throw new Error("minTimeout is greater than maxTimeout");for(var r=[],i=0;i<t.retries;i++)r.push(this.createTimeout(i,t));return e&&e.forever&&!r.length&&r.push(this.createTimeout(i,t)),r.sort((function(e,t){return e-t})),r},e.createTimeout=function(e,t){var n=t.randomize?Math.random()+1:1,r=Math.round(n*Math.max(t.minTimeout,1)*Math.pow(t.factor,e));return r=Math.min(r,t.maxTimeout)},e.wrap=function(t,n,r){if(n instanceof Array&&(r=n,n=null),!r)for(var i in r=[],t)"function"==typeof t[i]&&r.push(i);for(var o=0;o<r.length;o++){var s=r[o],a=t[s];t[s]=function(r){var i=e.operation(n),o=Array.prototype.slice.call(arguments,1),s=o.pop();o.push((function(e){i.retry(e)||(e&&(arguments[0]=i.mainError()),s.apply(this,arguments))})),i.attempt((function(){r.apply(t,o)}))}.bind(t,a),t[s].options=n}}),HT;var e,t}function eie(){return zA||(zA=1,VT=Qre()),VT}function tie(){if(YA)return Hm.exports;YA=1;const e=eie(),t=["Failed to fetch","NetworkError when attempting to fetch resource.","The Internet connection appears to be offline.","Network request failed"];class n extends Error{constructor(e){super(),e instanceof Error?(this.originalError=e,({message:e}=e)):(this.originalError=new Error(e),this.originalError.stack=this.stack),this.name="AbortError",this.message=e}}const r=(r,i)=>new Promise(((o,s)=>{i={onFailedAttempt:()=>{},retries:10,...i};const a=e.operation(i);a.attempt((async e=>{try{o(await r(e))}catch(r){if(!(r instanceof Error))return void s(new TypeError(`Non-error was thrown: "${r}". You should only throw errors.`));if(r instanceof n)a.stop(),s(r.originalError);else if(r instanceof TypeError&&!(e=>t.includes(e))(r.message))a.stop(),s(r);else{((e,t,n)=>{const r=n.retries-(t-1);e.attemptNumber=t,e.retriesLeft=r})(r,e,i);try{await i.onFailedAttempt(r)}catch(e){return void s(e)}a.retry(r)||s(a.mainError())}}}))}));return Hm.exports=r,Hm.exports.default=r,Hm.exports.AbortError=n,Hm.exports}var nie=tie();const d$=Ko(nie);let SE=class{constructor(e,t){if(this.stable=e,this.unstable=t,!this.unstable&&!this.stable)throw new Error("One of stable or unstable values must be supplied")}get name(){return this.stable?this.stable:this.unstable}get altName(){return this.stable?this.unstable:null}get names(){var e=[this.name],t=this.altName;return t&&e.push(t),e}matches(e){return this.name===e||this.altName===e}findIn(e){var t=void 0;return this.name&&(t=null==e?void 0:e[this.name]),!t&&this.altName&&(t=null==e?void 0:e[this.altName]),t}includedIn(e){var t=!1;return this.name&&(t=e.includes(this.name)),!t&&this.altName&&(t=e.includes(this.altName)),t}};class EE extends SE{constructor(){super(...arguments),L(this,"preferUnstable",!1)}setPreferUnstable(e){this.preferUnstable=e}get name(){return this.stable&&!this.preferUnstable?this.stable:this.unstable}}class Kn extends SE{constructor(e,t){if(super(e,t),!this.unstable)throw new Error("Unstable value must be supplied")}get name(){return this.unstable}get altName(){return this.stable}}var ip=function(e){return e.Self="m.self",e.Pin="m.pin",e}({}),by=new Kn("m.asset","org.matrix.msc3488.asset"),Eu=new Kn("m.ts","org.matrix.msc3488.ts"),Sy=new Kn("m.location","org.matrix.msc3488.location"),yi=function(e){return e.Read="m.read",e.FullyRead="m.fully_read",e.ReadPrivate="m.read.private",e}({}),Ey="main";function JA(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function XA(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?JA(Object(n),!0).forEach((function(t){L(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):JA(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var qT=new Map;function KT(e){return e instanceof String&&(e=e.toString()),qT.has(e)||qT.set(e,e),qT.get(e)}function JI(e,t){var n=t??new URLSearchParams,r=function(e){null!=o&&(Array.isArray(o)?o.forEach((t=>{n.append(e,String(t))})):n.append(e,String(o)))};for(var[i,o]of Object.entries(e))r(i);return n}function ZA(e,t,n){var r=XA(XA({},n),{},{[t]:n[e]});return delete r[e],r}function Ie(e,t){for(var n in t)if(t.hasOwnProperty(n)){var r=t[n];null!=r&&(e=e.replace(n,encodeURIComponent(r)))}return e}function Hb(e,t,n){var r;if(n){for(r=e.length-1;r>=0;r--)if(t(e[r],r,e))return e.splice(r,1),!0}else for(r=0;r<e.length;r++)if(t(e[r],r,e))return e.splice(r,1),!0;return!1}function f$(e,t){for(var n of t)if(!e.hasOwnProperty(n))throw new Error("Missing required key: "+n)}function wE(e){return JSON.parse(JSON.stringify(e))}function Md(e,t){if(e===t)return!0;if(typeof e!=typeof t)return!1;if("number"==typeof e&&isNaN(e)&&isNaN(t))return!0;if(null===e||null===t)return e===t;if(!(e instanceof Object)||e.constructor!==t.constructor||e.prototype!==t.prototype)return!1;if(e instanceof RegExp||e instanceof Date)return e.toString()===t.toString();if(Array.isArray(e)){if(e.length!==t.length)return!1;for(var n=0;n<e.length;n++)if(!Md(e[n],t[n]))return!1}else{for(var r in t)if(t.hasOwnProperty(r)!==e.hasOwnProperty(r))return!1;for(var i in e)if(t.hasOwnProperty(i)!==e.hasOwnProperty(i)||!Md(e[i],t[i]))return!1}return!0}function XI(e){if("object"!=typeof e||null==e||Array.isArray(e))return e;var t=[];for(var[n,r]of Object.entries(e))t.push([n,XI(r)]);return t.sort(((e,t)=>M_(e[0],t[0]))),t}function QA(e){return"number"==typeof e&&isFinite(e)}function zc(e){return"string"==typeof e?Xre(e.normalize("NFD").replace(iie,"")):""}function Bb(e){return"string"==typeof e?e.replace(/[\u202d-\u202e]/g,""):""}function rie(e){return zc(e.toLowerCase()).replace(/[\\'!"#$%&()*+,\-./:;<=>?@[\]^_`{|}~\u2000-\u206f\u2e00-\u2e7f]/g,"").toLowerCase()}var iie=/[\u2000-\u200F\u202A-\u202F\u0300-\u036F\uFEFF\u061C\u2800\u2062-\u2063\s]/g;function h$(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function p$(e){return h$(e).replace(/\\\*/g,".*").replace(/\?/g,".")}function GT(e){return null!=e&&e.endsWith("/")?e.slice(0,-1):e}function su(e,t){return new Promise((n=>{setTimeout(n,e,t)}))}function qKe(e,t,n){return ZI.apply(this,arguments)}function ZI(){return(ZI=U((function*(e,t,n){var r=Date.now();try{return yield n()}finally{var i=Date.now();e.debug("[Perf]: ".concat(t," took ").concat(i-r,"ms"))}}))).apply(this,arguments)}function sie(e,t,n){var r=Date.now();try{return n()}finally{var i=Date.now();e.debug("[Perf]: ".concat(t," took ").concat(i-r,"ms"))}}function m$(e){return null==e}function ou(){var e,t,n=new Promise(((n,r)=>{e=n,t=r}));return{resolve:e,reject:t,promise:n}}function yh(e,t){return QI.apply(this,arguments)}function QI(){return(QI=U((function*(e,t){for(var n of e)yield t(yield n)}))).apply(this,arguments)}function Uf(e){return Promise.resolve(e())}function oie(e){return d$((t=>e(t)),{forever:!0,factor:2,minTimeout:3e3,maxTimeout:15e3})}var au=(()=>{for(var e="",t=32;t<=126;t++)e+=String.fromCharCode(t);return e})();function e5(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:au;return e.padEnd(t,n[0])}function Ev(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:au,r=BigInt(n.length);if(e<=r)return null!==(t=n[Number(e)-1])&&void 0!==t?t:"";var i=e/r,o=Number(e%r)-1;return o<0&&(i-=BigInt(Math.abs(o)),o=Number(r)-1),Ev(i,n)+n[o]}function Vb(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:au,n=BigInt(t.length),r=BigInt(0),i=e.length-1,o=BigInt(0);i>=0;i--,o++){var s=e.charCodeAt(i)-t.charCodeAt(0);r+=BigInt(1+s)*n**o}return r}function aie(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:au,r=Math.max(e.length,t.length),i=Vb(e5(e,r,n),n),o=Vb(e5(t,r,n),n),s=(i+o)/BigInt(2);return s===i||s==o?Ev(s,n)+n[0]:Ev(s,n)}function Bm(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:au;return Ev(Vb(e,t)+BigInt(1),t)}function t5(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:au;return Ev(Vb(e,t)-BigInt(1),t)}function M_(e,t){return e<t?-1:e>t?1:0}function g$(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];for(var[r,i]of Object.entries(t))e[r]instanceof Object&&i?g$(e[r],i):null==i&&n||qb(e,r,i);return e}function n5(e){var t;return null!==(t=Eu.findIn(e.getContent()))&&void 0!==t?t:-1}function lie(e,t){return n5(t)-n5(e)}function kP(e){return[yi.Read,yi.ReadPrivate].includes(e)}function r5(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:(e,t)=>e===t;if(e.size!==t.size)return!1;for(var[r,i]of e){var o=t.get(r);if(void 0===o||!n(i,o))return!1}return!0}function v$(e){return e instanceof Map?pd(e):Array.isArray(e)?e.map((e=>v$(e))):e}function pd(e){var t=new Map;for(var[n,r]of e)t.set(n,v$(r));return Object.fromEntries(t.entries())}function Bg(e){return"__proto__"===e||"prototype"===e||"constructor"===e}function qb(e,t,n){if(Bg(t))throw new Error("Trying to modify prototype or constructor");e[t]=n}function Io(e){return!(Bg(e.room_id)||Bg(e.sender)||Bg(e.event_id))}class Sl extends Map{constructor(e){super(),this.createDefault=e}getOrCreate(e){return this.has(e)||this.set(e,this.createDefault()),this.get(e)}}var ek="migrationState",sp=function(e){return e[e.NOT_STARTED=0]="NOT_STARTED",e[e.INITIAL_DATA_MIGRATED=1]="INITIAL_DATA_MIGRATED",e[e.OLM_SESSIONS_MIGRATED=2]="OLM_SESSIONS_MIGRATED",e[e.MEGOLM_SESSIONS_MIGRATED=3]="MEGOLM_SESSIONS_MIGRATED",e[e.ROOM_SETTINGS_MIGRATED=4]="ROOM_SETTINGS_MIGRATED",e[e.INITIAL_OWN_KEY_QUERY_DONE=5]="INITIAL_OWN_KEY_QUERY_DONE",e}({}),op=50;function i5(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function s5(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i5(Object(n),!0).forEach((function(t){L(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i5(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function m1(e,t){return encodeURIComponent(e)+"/"+encodeURIComponent(t)}function cie(e){var t=e.split("/");return{senderKey:decodeURIComponent(t[0]),sessionId:decodeURIComponent(t[1])}}class CE{constructor(){L(this,"migrationState",sp.NOT_STARTED),L(this,"account",null),L(this,"crossSigningKeys",null),L(this,"privateKeys",{}),L(this,"sessions",{}),L(this,"inboundGroupSessions",{}),L(this,"inboundGroupSessionsWithheld",{}),L(this,"rooms",{}),L(this,"sessionsNeedingBackup",{})}containsData(){var e=this;return U((function*(){return null!==e.account}))()}startup(){var e=this;return U((function*(){return e}))()}deleteAllData(){return Promise.resolve()}getMigrationState(){var e=this;return U((function*(){return e.migrationState}))()}setMigrationState(e){var t=this;return U((function*(){t.migrationState=e}))()}getAccount(e,t){t(this.account)}storeAccount(e,t){this.account=t}getCrossSigningKeys(e,t){t(this.crossSigningKeys)}getSecretStorePrivateKey(e,t,n){t(this.privateKeys[n]||null)}storeSecretStorePrivateKey(e,t,n){this.privateKeys[t]=n}countEndToEndSessions(e,t){var n=0;for(var r of Object.values(this.sessions))n+=Object.keys(r).length;t(n)}getEndToEndSession(e,t,n,r){r((this.sessions[e]||{})[t]||null)}getEndToEndSessions(e,t,n){n(this.sessions[e]||{})}storeEndToEndSession(e,t,n,r){var i=this.sessions[e];void 0===i&&(i={},this.sessions[e]=i),qb(i,t,n)}getEndToEndSessionsBatch(){var e=this;return U((function*(){var t=[];for(var n of Object.values(e.sessions))for(var r of Object.values(n))if(t.push(r),t.length>=op)return t;return 0===t.length?null:t}))()}deleteEndToEndSessionsBatch(e){var t=this;return U((function*(){for(var{deviceKey:n,sessionId:r}of e){var i=t.sessions[n]||{};delete i[r],0===Object.keys(i).length&&delete t.sessions[n]}}))()}getEndToEndInboundGroupSession(e,t,n,r){var i=m1(e,t);r(this.inboundGroupSessions[i]||null,this.inboundGroupSessionsWithheld[i]||null)}storeEndToEndInboundGroupSession(e,t,n,r){var i=m1(e,t);this.inboundGroupSessions[i]=n}countEndToEndInboundGroupSessions(){var e=this;return U((function*(){return Object.keys(e.inboundGroupSessions).length}))()}getEndToEndInboundGroupSessionsBatch(){var e=this;return U((function*(){var t=[];for(var[n,r]of Object.entries(e.inboundGroupSessions))if(t.push(s5(s5({},cie(n)),{},{sessionData:r,needsBackup:n in e.sessionsNeedingBackup})),t.length>=op)return t;return 0===t.length?null:t}))()}deleteEndToEndInboundGroupSessionsBatch(e){var t=this;return U((function*(){for(var{senderKey:n,sessionId:r}of e){var i=m1(n,r);delete t.inboundGroupSessions[i]}}))()}getEndToEndRooms(e,t){t(this.rooms)}markSessionsNeedingBackup(e){for(var t of e){var n=m1(t.senderKey,t.sessionId);this.sessionsNeedingBackup[n]=!0}return Promise.resolve()}doTxn(e,t,n){return Promise.resolve(n(null))}}var uie=/^(?:(?:\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3})|(?:\[[\dA-Fa-f:.]{2,45}])|(?:[A-Za-z\d\-.]{1,255}))(?::\d{1,5})?$/;function die(e){var t=uie.exec(e);return(null==t?void 0:t[0])===e}var fie=/^[\w-]+$/;function hie(e){var t=fie.exec(e);return(null==t?void 0:t[0])===e}function TE(e,t,n,r,i){var o=arguments.length>5&&void 0!==arguments[5]&&arguments[5],s=arguments.length>6?arguments[6]:void 0,a=arguments.length>7?arguments[7]:void 0;if("string"!=typeof t||!t)return"";if(!t.startsWith("mxc://"))return o?t:"";var[l,c,...u]=t.slice(6).split("/");if(u.length>0||!die(l)||!hie(c))return"";a&&(s=!0);var d,h=!!n||!!r||!!i?"thumbnail":"download";d=a?"/_matrix/client/v1/media/".concat(h):"/_matrix/media/v3/".concat(h);var p=new URL("".concat(d,"/").concat(l,"/").concat(c),e);return n&&p.searchParams.set("width",Math.round(n).toString()),r&&p.searchParams.set("height",Math.round(r).toString()),i&&p.searchParams.set("method",i),"boolean"==typeof s&&p.searchParams.set("allow_redirect",JSON.stringify(s)),p.href}var o5,A_={exports:{}},pie=A_.exports;function mie(){return o5||(o5=1,t=pie,n=function(){var e=function(){},t="undefined",n=typeof window!==t&&typeof window.navigator!==t&&/Trident\/|MSIE /.test(window.navigator.userAgent),r=["trace","debug","info","warn","error"],i={},o=null;function s(e,t){var n=e[t];if("function"==typeof n.bind)return n.bind(e);try{return Function.prototype.bind.call(n,e)}catch{return function(){return Function.prototype.apply.apply(n,[e,arguments])}}}function a(){console.log&&(console.log.apply?console.log.apply(console,arguments):Function.prototype.apply.apply(console.log,[console,arguments])),console.trace&&console.trace()}function l(){for(var n=this.getLevel(),i=0;i<r.length;i++){var o=r[i];this[o]=i<n?e:this.methodFactory(o,n,this.name)}if(this.log=this.debug,typeof console===t&&n<this.levels.SILENT)return"No console available for logging"}function c(e){return function(){typeof console!==t&&(l.call(this),this[e].apply(this,arguments))}}function u(r,i,o){return function(r){return"debug"===r&&(r="log"),typeof console!==t&&("trace"===r&&n?a:void 0!==console[r]?s(console,r):void 0!==console.log?s(console,"log"):e)}(r)||c.apply(this,arguments)}function d(e,n){var s,a,c,d=this,h="loglevel";function p(){var e;if(typeof window!==t&&h){try{e=window.localStorage[h]}catch{}if(typeof e===t)try{var n=window.document.cookie,r=encodeURIComponent(h),i=n.indexOf(r+"=");-1!==i&&(e=/^([^;]+)/.exec(n.slice(i+r.length+1))[1])}catch{}return void 0===d.levels[e]&&(e=void 0),e}}function f(e){var t=e;if("string"==typeof t&&void 0!==d.levels[t.toUpperCase()]&&(t=d.levels[t.toUpperCase()]),"number"==typeof t&&t>=0&&t<=d.levels.SILENT)return t;throw new TypeError("log.setLevel() called with invalid level: "+e)}"string"==typeof e?h+=":"+e:"symbol"==typeof e&&(h=void 0),d.name=e,d.levels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5},d.methodFactory=n||u,d.getLevel=function(){return c??a??s},d.setLevel=function(e,n){return c=f(e),!1!==n&&function(e){var n=(r[e]||"silent").toUpperCase();if(typeof window!==t&&h){try{return void(window.localStorage[h]=n)}catch{}try{window.document.cookie=encodeURIComponent(h)+"="+n+";"}catch{}}}(c),l.call(d)},d.setDefaultLevel=function(e){a=f(e),p()||d.setLevel(e,!1)},d.resetLevel=function(){c=null,function(){if(typeof window!==t&&h){try{window.localStorage.removeItem(h)}catch{}try{window.document.cookie=encodeURIComponent(h)+"=; expires=Thu, 01 Jan 1970 00:00:00 UTC"}catch{}}}(),l.call(d)},d.enableAll=function(e){d.setLevel(d.levels.TRACE,e)},d.disableAll=function(e){d.setLevel(d.levels.SILENT,e)},d.rebuild=function(){if(o!==d&&(s=f(o.getLevel())),l.call(d),o===d)for(var e in i)i[e].rebuild()},s=f(o?o.getLevel():"WARN");var m=p();null!=m&&(c=f(m)),l.call(d)}(o=new d).getLogger=function(e){if("symbol"!=typeof e&&"string"!=typeof e||""===e)throw new TypeError("You must supply a name when creating a logger.");var t=i[e];return t||(t=i[e]=new d(e,o.methodFactory)),t};var h=typeof window!==t?window.log:void 0;return o.noConflict=function(){return typeof window!==t&&window.log===o&&(window.log=h),o},o.getLoggers=function(){return i},o.default=o,o},(e=A_).exports?e.exports=n():t.log=n()),A_.exports;var e,t,n}var gie=mie();const tk=Ko(gie);var vie="matrix";function y$(e){var t=vie+(void 0===e?"":"-".concat(e)),n=tk.getLogger(t);return void 0===n.getChild&&(n.prefix=e,n.getChild=t=>{var r=y$((e??"")+t);return r.methodFactory=n.methodFactory,r.rebuild(),r},n.setLevel(tk.levels.DEBUG,!1)),n}tk.methodFactory=function(e,t,n){return function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return this.prefix&&n.unshift(this.prefix),"error"===e||"warn"===e||"trace"===e||"info"===e||"debug"===e?console[e](...n):console.log(...n)}};var A=y$();class KKe{constructor(e,t){this.parent=e,L(this,"name",void 0),this.name=t+":"}trace(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this.parent.trace(this.name,...t)}debug(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this.parent.debug(this.name,...t)}info(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this.parent.info(this.name,...t)}warn(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this.parent.warn(this.name,...t)}error(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this.parent.error(this.name,...t)}}var a5,g1={exports:{}};function yie(){if(a5)return g1.exports;a5=1;var e,t="object"==typeof Reflect?Reflect:null,n=t&&"function"==typeof t.apply?t.apply:function(e,t,n){return Function.prototype.apply.call(e,t,n)};e=t&&"function"==typeof t.ownKeys?t.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)};var r=Number.isNaN||function(e){return e!=e};function i(){i.init.call(this)}g1.exports=i,g1.exports.once=function(e,t){return new Promise((function(n,r){function i(n){e.removeListener(t,o),r(n)}function o(){"function"==typeof e.removeListener&&e.removeListener("error",i),n([].slice.call(arguments))}f(e,t,o,{once:!0}),"error"!==t&&function(e,t,n){"function"==typeof e.on&&f(e,"error",t,n)}(e,i,{once:!0})}))},i.EventEmitter=i,i.prototype._events=void 0,i.prototype._eventsCount=0,i.prototype._maxListeners=void 0;var o=10;function s(e){if("function"!=typeof e)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e)}function a(e){return void 0===e._maxListeners?i.defaultMaxListeners:e._maxListeners}function l(e,t,n,r){var i,o,l;if(s(n),void 0===(o=e._events)?(o=e._events=Object.create(null),e._eventsCount=0):(void 0!==o.newListener&&(e.emit("newListener",t,n.listener?n.listener:n),o=e._events),l=o[t]),void 0===l)l=o[t]=n,++e._eventsCount;else if("function"==typeof l?l=o[t]=r?[n,l]:[l,n]:r?l.unshift(n):l.push(n),(i=a(e))>0&&l.length>i&&!l.warned){l.warned=!0;var c=new Error("Possible EventEmitter memory leak detected. "+l.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");c.name="MaxListenersExceededWarning",c.emitter=e,c.type=t,c.count=l.length,function(e){console&&console.warn&&console.warn(e)}(c)}return e}function c(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function u(e,t,n){var r={fired:!1,wrapFn:void 0,target:e,type:t,listener:n},i=c.bind(r);return i.listener=n,r.wrapFn=i,i}function d(e,t,n){var r=e._events;if(void 0===r)return[];var i=r[t];return void 0===i?[]:"function"==typeof i?n?[i.listener||i]:[i]:n?function(e){for(var t=new Array(e.length),n=0;n<t.length;++n)t[n]=e[n].listener||e[n];return t}(i):p(i,i.length)}function h(e){var t=this._events;if(void 0!==t){var n=t[e];if("function"==typeof n)return 1;if(void 0!==n)return n.length}return 0}function p(e,t){for(var n=new Array(t),r=0;r<t;++r)n[r]=e[r];return n}function f(e,t,n,r){if("function"==typeof e.on)r.once?e.once(t,n):e.on(t,n);else{if("function"!=typeof e.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof e);e.addEventListener(t,(function i(o){r.once&&e.removeEventListener(t,i),n(o)}))}}return Object.defineProperty(i,"defaultMaxListeners",{enumerable:!0,get:function(){return o},set:function(e){if("number"!=typeof e||e<0||r(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");o=e}}),i.init=function(){(void 0===this._events||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},i.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||r(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},i.prototype.getMaxListeners=function(){return a(this)},i.prototype.emit=function(e){for(var t=[],r=1;r<arguments.length;r++)t.push(arguments[r]);var i="error"===e,o=this._events;if(void 0!==o)i=i&&void 0===o.error;else if(!i)return!1;if(i){var s;if(t.length>0&&(s=t[0]),s instanceof Error)throw s;var a=new Error("Unhandled error."+(s?" ("+s.message+")":""));throw a.context=s,a}var l=o[e];if(void 0===l)return!1;if("function"==typeof l)n(l,this,t);else{var c=l.length,u=p(l,c);for(r=0;r<c;++r)n(u[r],this,t)}return!0},i.prototype.addListener=function(e,t){return l(this,e,t,!1)},i.prototype.on=i.prototype.addListener,i.prototype.prependListener=function(e,t){return l(this,e,t,!0)},i.prototype.once=function(e,t){return s(t),this.on(e,u(this,e,t)),this},i.prototype.prependOnceListener=function(e,t){return s(t),this.prependListener(e,u(this,e,t)),this},i.prototype.removeListener=function(e,t){var n,r,i,o,a;if(s(t),void 0===(r=this._events))return this;if(void 0===(n=r[e]))return this;if(n===t||n.listener===t)0==--this._eventsCount?this._events=Object.create(null):(delete r[e],r.removeListener&&this.emit("removeListener",e,n.listener||t));else if("function"!=typeof n){for(i=-1,o=n.length-1;o>=0;o--)if(n[o]===t||n[o].listener===t){a=n[o].listener,i=o;break}if(i<0)return this;0===i?n.shift():function(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}(n,i),1===n.length&&(r[e]=n[0]),void 0!==r.removeListener&&this.emit("removeListener",e,a||t)}return this},i.prototype.off=i.prototype.removeListener,i.prototype.removeAllListeners=function(e){var t,n,r;if(void 0===(n=this._events))return this;if(void 0===n.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==n[e]&&(0==--this._eventsCount?this._events=Object.create(null):delete n[e]),this;if(0===arguments.length){var i,o=Object.keys(n);for(r=0;r<o.length;++r)"removeListener"!==(i=o[r])&&this.removeAllListeners(i);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(t=n[e]))this.removeListener(e,t);else if(void 0!==t)for(r=t.length-1;r>=0;r--)this.removeListener(e,t[r]);return this},i.prototype.listeners=function(e){return d(this,e,!0)},i.prototype.rawListeners=function(e){return d(this,e,!1)},i.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):h.call(e,t)},i.prototype.listenerCount=h,i.prototype.eventNames=function(){return this._eventsCount>0?e(this._events):[]},g1.exports}var RE=yie();const xP=Ko(RE);var _$=function(e){return e.NewListener="newListener",e.RemoveListener="removeListener",e.Error="error",e}({});class En extends RE.EventEmitter{addListener(e,t){return super.addListener(e,t)}emit(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return super.emit(e,...n)}emitPromised(e){var t=arguments,n=this;return U((function*(){for(var r=t.length,i=new Array(r>1?r-1:0),o=1;o<r;o++)i[o-1]=t[o];var s=n.listeners(e);return Promise.allSettled(s.map((e=>e(...i)))).then((()=>s.length>0))}))()}listenerCount(e){return super.listenerCount(e)}listeners(e){return super.listeners(e)}off(e,t){return super.off(e,t)}on(e,t){return super.on(e,t)}once(e,t){return super.once(e,t)}prependListener(e,t){return super.prependListener(e,t)}prependOnceListener(e,t){return super.prependOnceListener(e,t)}removeAllListeners(e){return void 0===e?super.removeAllListeners():super.removeAllListeners(e)}removeListener(e,t){return super.removeListener(e,t)}rawListeners(e){return super.rawListeners(e)}}var ee=function(e){return e.RoomCanonicalAlias="m.room.canonical_alias",e.RoomCreate="m.room.create",e.RoomJoinRules="m.room.join_rules",e.RoomMember="m.room.member",e.RoomThirdPartyInvite="m.room.third_party_invite",e.RoomPowerLevels="m.room.power_levels",e.RoomName="m.room.name",e.RoomTopic="m.room.topic",e.RoomAvatar="m.room.avatar",e.RoomPinnedEvents="m.room.pinned_events",e.RoomEncryption="m.room.encryption",e.RoomHistoryVisibility="m.room.history_visibility",e.RoomGuestAccess="m.room.guest_access",e.RoomServerAcl="m.room.server_acl",e.RoomTombstone="m.room.tombstone",e.RoomPredecessor="org.matrix.msc3946.room_predecessor",e.PolicyRuleUser="m.policy.rule.user",e.PolicyRuleRoom="m.policy.rule.room",e.PolicyRuleServer="m.policy.rule.server",e.SpaceChild="m.space.child",e.SpaceParent="m.space.parent",e.RoomRedaction="m.room.redaction",e.RoomMessage="m.room.message",e.RoomMessageEncrypted="m.room.encrypted",e.Sticker="m.sticker",e.CallInvite="m.call.invite",e.CallCandidates="m.call.candidates",e.CallAnswer="m.call.answer",e.CallHangup="m.call.hangup",e.CallReject="m.call.reject",e.CallSelectAnswer="m.call.select_answer",e.CallNegotiate="m.call.negotiate",e.CallSDPStreamMetadataChanged="m.call.sdp_stream_metadata_changed",e.CallSDPStreamMetadataChangedPrefix="org.matrix.call.sdp_stream_metadata_changed",e.CallReplaces="m.call.replaces",e.CallAssertedIdentity="m.call.asserted_identity",e.CallAssertedIdentityPrefix="org.matrix.call.asserted_identity",e.CallEncryptionKeysPrefix="io.element.call.encryption_keys",e.KeyVerificationRequest="m.key.verification.request",e.KeyVerificationStart="m.key.verification.start",e.KeyVerificationCancel="m.key.verification.cancel",e.KeyVerificationMac="m.key.verification.mac",e.KeyVerificationDone="m.key.verification.done",e.KeyVerificationKey="m.key.verification.key",e.KeyVerificationAccept="m.key.verification.accept",e.KeyVerificationReady="m.key.verification.ready",e.RoomMessageFeedback="m.room.message.feedback",e.Reaction="m.reaction",e.PollStart="org.matrix.msc3381.poll.start",e.Typing="m.typing",e.Receipt="m.receipt",e.Presence="m.presence",e.FullyRead="m.fully_read",e.Tag="m.tag",e.SpaceOrder="org.matrix.msc3230.space_order",e.PushRules="m.push_rules",e.Direct="m.direct",e.IgnoredUserList="m.ignored_user_list",e.RoomKey="m.room_key",e.RoomKeyRequest="m.room_key_request",e.ForwardedRoomKey="m.forwarded_room_key",e.Dummy="m.dummy",e.SecretRequest="m.secret.request",e.SecretSend="m.secret.send",e.GroupCallPrefix="org.matrix.msc3401.call",e.GroupCallMemberPrefix="org.matrix.msc3401.call.member",e.CallNotify="org.matrix.msc4075.call.notify",e}({}),cn=function(e){return e.Annotation="m.annotation",e.Replace="m.replace",e.Reference="m.reference",e.Thread="m.thread",e}({}),Pa=function(e){return e.Text="m.text",e.Emote="m.emote",e.Notice="m.notice",e.Image="m.image",e.File="m.file",e.Audio="m.audio",e.Location="m.location",e.Video="m.video",e.KeyVerificationRequest="m.key.verification.request",e}({}),Kb="type",Ph=function(e){return e.Space="m.space",e.UnstableCall="org.matrix.msc3417.call",e.ElementVideo="io.element.video",e}({}),IE="org.matrix.msgid",nk=new Kn("m.room.purpose","org.matrix.msc3088.purpose"),rk=new Kn("m.enabled","org.matrix.msc3088.enabled"),ik=new Kn("m.data_tree","org.matrix.msc3089.data_tree"),b$=new Kn("m.leaf","org.matrix.msc3089.leaf"),fl=new Kn("m.branch","org.matrix.msc3089.branch"),S$=new Kn("m.room.marker","org.matrix.msc2716.marker"),sk=new Kn("with_rel_types","org.matrix.msc3912.with_relations"),E$=new Kn("io.element.functional_members","io.element.functional_members"),md=new Kn("m.visibility","org.matrix.msc3531.visibility"),ok=new Kn("enabled","org.matrix.msc3881.enabled"),_ie=new Kn("device_id","org.matrix.msc3881.device_id"),w$=new Kn("m.local_notification_settings","org.matrix.msc3890.local_notification_settings"),Gb=new Kn("thread_id","org.matrix.msc4023.thread_id"),C$=new SE("membership","io.element.msc4115.membership"),Ke=function(e){return e.Ban="ban",e.Invite="invite",e.Join="join",e.Knock="knock",e.Leave="leave",e}({}),Gi=function(e){return e.Membership="RoomMember.membership",e.Name="RoomMember.name",e.PowerLevel="RoomMember.powerLevel",e.Typing="RoomMember.typing",e}({});class wv extends En{constructor(e,t){super(),this.roomId=e,this.userId=t,L(this,"_isOutOfBand",!1),L(this,"modified",-1),L(this,"requestedProfileInfo",!1),L(this,"typing",!1),L(this,"name",void 0),L(this,"rawDisplayName",void 0),L(this,"powerLevel",0),L(this,"powerLevelNorm",0),L(this,"user",void 0),L(this,"membership",void 0),L(this,"disambiguate",!1),L(this,"events",{}),this.name=t,this.rawDisplayName=t,this.updateModifiedTime()}markOutOfBand(){this._isOutOfBand=!0}isOutOfBand(){return this._isOutOfBand}setMembershipEvent(e,t){var n,r,i=null!==(n=e.getDirectionalContent().displayname)&&void 0!==n?n:"";if(e.getType()===ee.RoomMember){this._isOutOfBand=!1,this.events.member=e;var o=this.membership;this.membership=e.getDirectionalContent().membership,void 0===this.membership&&A.trace("membership event with membership undefined (forwardLooking: ".concat(e.forwardLooking,")!"),e.getContent(),"prevcontent is ",e.getPrevContent()),this.disambiguate=Eie(this.userId,i,t);var s=this.name;this.name=wie(this.userId,i,this.disambiguate),this.rawDisplayName=Bb(null!==(r=e.getDirectionalContent().displayname)&&void 0!==r?r:""),(!this.rawDisplayName||!zc(this.rawDisplayName))&&(this.rawDisplayName=this.userId),o!==this.membership&&(this.updateModifiedTime(),this.emit(Gi.Membership,e,this,o)),s!==this.name&&(this.updateModifiedTime(),this.emit(Gi.Name,e,this,s))}}setPowerLevelEvent(e){if(e.getType()===ee.RoomPowerLevels&&""===e.getStateKey()){var t=e.getDirectionalContent(),n=t.users_default||0,r=t.users||{};Object.values(r).forEach((e=>{n=Math.max(n,e)}));var i=this.powerLevel,o=this.powerLevelNorm;void 0!==r[this.userId]&&Number.isInteger(r[this.userId])?this.powerLevel=r[this.userId]:void 0!==t.users_default?this.powerLevel=t.users_default:this.powerLevel=0,this.powerLevelNorm=0,n>0&&(this.powerLevelNorm=100*this.powerLevel/n),(i!==this.powerLevel||o!==this.powerLevelNorm)&&(this.updateModifiedTime(),this.emit(Gi.PowerLevel,e,this))}}setTypingEvent(e){if("m.typing"===e.getType()){var t=this.typing;this.typing=!1;var n=e.getContent().user_ids;Array.isArray(n)&&(-1!==n.indexOf(this.userId)&&(this.typing=!0),t!==this.typing&&(this.updateModifiedTime(),this.emit(Gi.Typing,e,this)))}}updateModifiedTime(){this.modified=Date.now()}getLastModifiedTime(){return this.modified}isKicked(){return this.membership===Ke.Leave&&void 0!==this.events.member&&this.events.member.getSender()!==this.events.member.getStateKey()}getDMInviter(){if(this.events.member){var e=this.events.member,t=e.getContent(),n=e.getSender();if(t.membership===Ke.Join&&(t=e.getPrevContent(),n=e.getUnsigned().prev_sender),t.membership===Ke.Invite&&t.is_direct)return n}}getAvatarUrl(e,t,n,r){var i=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],o=arguments.length>5?arguments[5]:void 0,s=arguments.length>6&&void 0!==arguments[6]&&arguments[6],a=this.getMxcAvatarUrl();return(a||i)&&TE(e,a,t,n,r,o,void 0,s)||null}getMxcAvatarUrl(){return this.events.member?this.events.member.getDirectionalContent().avatar_url:this.user?this.user.avatarUrl:void 0}}var bie=/@.+:.+/,Sie=/[\u200E\u200F\u202A-\u202F]/;function Eie(e,t,n){if(!t||t===e||!n)return!1;var r=zc(t);return!!r&&(!(!bie.test(r)&&!Sie.test(t))||!!n.getUserIdsWithDisplayName(t).some((t=>t!==e)))}function wie(e,t,n){return t&&t!==e?n?Bb(t)+" ("+e+")":zc(t)?Bb(t):e:e}var l5,WT={},Vm={},qm={};function T$(){if(l5)return qm;function e(e,n){var r=typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,n){if(e){if("string"==typeof e)return t(e,n);var r=Object.prototype.toString.call(e).slice(8,-1);if("Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return t(e,n)}}(e))||n){r&&(e=r);var i=0,o=function(){};return{s:o,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s,a=!0,l=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return a=e.done,e},e:function(e){l=!0,s=e},f:function(){try{!a&&null!=r.return&&r.return()}finally{if(l)throw s}}}}function t(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function n(e,t,n){return t&&function(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}l5=1,Object.defineProperty(qm,"__esModule",{value:!0}),qm.NamespacedMap=void 0;var r=function(){function t(n){if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t,n){t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n}(this,"internalMap",new Map),n){var r,i=e(n);try{for(i.s();!(r=i.n()).done;){var o=r.value;this.set(o[0],o[1])}}catch(e){i.e(e)}finally{i.f()}}}return n(t,[{key:"get",value:function(e){return e.name&&this.internalMap.has(e.name)?this.internalMap.get(e.name):e.altName&&this.internalMap.has(e.altName)?this.internalMap.get(e.altName):null}},{key:"set",value:function(e,t){e.name&&this.internalMap.set(e.name,t),e.altName&&this.internalMap.set(e.altName,t)}},{key:"has",value:function(e){return!!this.get(e)}},{key:"delete",value:function(e){e.name&&this.internalMap.delete(e.name),e.altName&&this.internalMap.delete(e.altName)}},{key:"hasNamespaced",value:function(e){return this.internalMap.has(e)}},{key:"getNamespaced",value:function(e){return this.internalMap.get(e)}}]),t}();return qm.NamespacedMap=r,qm}var c5,Km={};function Pp(){if(c5)return Km;function e(t){return(e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(t)}function t(t){var n=i();return function(){var r,i=s(t);if(n){var o=s(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return function(t,n){if(n&&("object"===e(n)||"function"==typeof n))return n;if(void 0!==n)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(t)}(this,r)}}function n(e){var t="function"==typeof Map?new Map:void 0;return n=function(e){if(null===e||!function(e){return-1!==Function.toString.call(e).indexOf("[native code]")}(e))return e;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(typeof t<"u"){if(t.has(e))return t.get(e);t.set(e,n)}function n(){return r(e,arguments,s(this).constructor)}return n.prototype=Object.create(e.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),o(n,e)},n(e)}function r(e,t,n){return(r=i()?Reflect.construct:function(e,t,n){var r=[null];r.push.apply(r,t);var i=new(Function.bind.apply(e,r));return n&&o(i,n.prototype),i}).apply(null,arguments)}function i(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch{return!1}}function o(e,t){return(o=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function s(e){return(s=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}c5=1,Object.defineProperty(Km,"__esModule",{value:!0}),Km.InvalidEventError=void 0;var a=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&o(e,t)}(r,e);var n=t(r);function r(e){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r),n.call(this,e)}return function(e){return Object.defineProperty(e,"prototype",{writable:!1}),e}(r)}(n(Error));return Km.InvalidEventError=a,Km}var u5,Ff={},Gm={},Wm={};function wy(){if(u5)return Wm;function e(e,t,n){return t&&function(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}u5=1,Object.defineProperty(Wm,"__esModule",{value:!0}),Wm.ExtensibleEvent=void 0;var t=function(){function t(e){(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,t),this.wireFormat=e}return e(t,[{key:"wireContent",get:function(){return this.wireFormat.content}}]),t}();return Wm.ExtensibleEvent=t,Wm}var d5,zm={};function R$(){if(d5)return zm;function e(e){return null!=e}return d5=1,Object.defineProperty(zm,"__esModule",{value:!0}),zm.isOptionalAString=function(t){return e(t)&&"string"==typeof t},zm.isProvided=e,zm}var f5,h5,cs={},zu={};function Lp(){if(f5)return zu;function e(t){return(e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(t)}function t(e,n){return(t=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,n)}function n(t){var n=function(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch{return!1}}();return function(){var i,o=r(t);if(n){var s=r(this).constructor;i=Reflect.construct(o,arguments,s)}else i=o.apply(this,arguments);return function(t,n){if(n&&("object"===e(n)||"function"==typeof n))return n;if(void 0!==n)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(t)}(this,i)}}function r(e){return(r=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t,n){return t&&function(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}f5=1,Object.defineProperty(zu,"__esModule",{value:!0}),zu.UnstableValue=zu.NamespacedValue=void 0;var s=function(){function e(t,n){if(i(this,e),this.stable=t,this.unstable=n,!this.unstable&&!this.stable)throw new Error("One of stable or unstable values must be supplied")}return o(e,[{key:"name",get:function(){return this.stable?this.stable:this.unstable}},{key:"altName",get:function(){return this.stable?this.unstable:null}},{key:"matches",value:function(e){return!!this.name&&this.name===e||!!this.altName&&this.altName===e}},{key:"findIn",value:function(e){var t;return this.name&&(t=null==e?void 0:e[this.name]),!t&&this.altName&&(t=null==e?void 0:e[this.altName]),t}},{key:"includedIn",value:function(e){var t=!1;return this.name&&(t=e.includes(this.name)),!t&&this.altName&&(t=e.includes(this.altName)),t}}]),e}();zu.NamespacedValue=s;var a=function(e){!function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(n&&n.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),n&&t(e,n)}(s,e);var r=n(s);function s(e,t){var n;if(i(this,s),!(n=r.call(this,e,t)).unstable)throw new Error("Unstable value must be supplied");return n}return o(s,[{key:"name",get:function(){return this.unstable}},{key:"altName",get:function(){return this.stable}}]),s}(s);return zu.UnstableValue=a,zu}function La(){if(h5)return cs;h5=1,Object.defineProperty(cs,"__esModule",{value:!0}),cs.M_TEXT=cs.M_NOTICE=cs.M_MESSAGE=cs.M_HTML=cs.M_EMOTE=void 0;var e=Lp(),t=new e.UnstableValue("m.message","org.matrix.msc1767.message");cs.M_MESSAGE=t;var n=new e.UnstableValue("m.text","org.matrix.msc1767.text");cs.M_TEXT=n;var r=new e.UnstableValue("m.html","org.matrix.msc1767.html");cs.M_HTML=r;var i=new e.UnstableValue("m.emote","org.matrix.msc1767.emote");cs.M_EMOTE=i;var o=new e.UnstableValue("m.notice","org.matrix.msc1767.notice");return cs.M_NOTICE=o,cs}var p5,m5,v1={};function zd(){if(p5)return v1;return p5=1,Object.defineProperty(v1,"__esModule",{value:!0}),v1.isEventTypeSame=function(e,t){if("string"==typeof e)return"string"==typeof t?t===e:t.matches(e);if("string"==typeof t)return e.matches(t);var n=t,r=e;return n.matches(r.name)||n.matches(r.altName)},v1}function Yd(){if(m5)return Gm;function e(t){return(e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(t)}m5=1,Object.defineProperty(Gm,"__esModule",{value:!0}),Gm.MessageEvent=void 0;var t=wy(),n=R$(),r=Pp(),i=La(),o=zd();function s(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function a(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?s(Object(n),!0).forEach((function(t){p(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):s(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function c(e,t){return(c=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function u(t){var n=function(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch{return!1}}();return function(){var r,i=h(t);if(n){var o=h(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return function(t,n){if(n&&("object"===e(n)||"function"==typeof n))return n;if(void 0!==n)throw new TypeError("Derived constructors may only return object or undefined");return d(t)}(this,r)}}function d(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function h(e){return(h=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function p(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var f=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&c(e,t)}(s,e);var t=u(s);function s(e){var o;(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,s),p(d(o=t.call(this,e)),"text",void 0),p(d(o),"html",void 0),p(d(o),"renderings",void 0);var a=i.M_MESSAGE.findIn(o.wireContent),l=i.M_TEXT.findIn(o.wireContent),c=i.M_HTML.findIn(o.wireContent);if((0,n.isProvided)(a)){if(!Array.isArray(a))throw new r.InvalidEventError("m.message contents must be an array");var u=a.find((function(e){return!(0,n.isProvided)(e.mimetype)||"text/plain"===e.mimetype})),h=a.find((function(e){return"text/html"===e.mimetype}));if(!u)throw new r.InvalidEventError("m.message is missing a plain text representation");o.text=u.body,o.html=null==h?void 0:h.body,o.renderings=a}else{if(!(0,n.isOptionalAString)(l))throw new r.InvalidEventError("Missing textual representation for event");o.text=l,o.html=c,o.renderings=[{body:l,mimetype:"text/plain"}],o.html&&o.renderings.push({body:o.html,mimetype:"text/html"})}return o}return function(e,t,n){t&&l(e.prototype,t),n&&l(e,n),Object.defineProperty(e,"prototype",{writable:!1})}(s,[{key:"isEmote",get:function(){return i.M_EMOTE.matches(this.wireFormat.type)||(0,n.isProvided)(i.M_EMOTE.findIn(this.wireFormat.content))}},{key:"isNotice",get:function(){return i.M_NOTICE.matches(this.wireFormat.type)||(0,n.isProvided)(i.M_NOTICE.findIn(this.wireFormat.content))}},{key:"isEquivalentTo",value:function(e){return(0,o.isEventTypeSame)(e,i.M_MESSAGE)}},{key:"serializeMMessageOnly",value:function(){var e=p({},i.M_MESSAGE.name,this.renderings);if(1===this.renderings.length){var t=this.renderings[0].mimetype;(void 0===t||"text/plain"===t)&&(e=p({},i.M_TEXT.name,this.renderings[0].body))}return e}},{key:"serialize",value:function(){var e;return{type:"m.room.message",content:a(a({},this.serializeMMessageOnly()),{},{body:this.text,msgtype:"m.text",format:this.html?"org.matrix.custom.html":void 0,formatted_body:null!==(e=this.html)&&void 0!==e?e:void 0})}}}],[{key:"from",value:function(e,t){var n;return new s({type:i.M_MESSAGE.name,content:(n={},p(n,i.M_TEXT.name,e),p(n,i.M_HTML.name,t),n)})}}]),s}(t.ExtensibleEvent);return Gm.MessageEvent=f,Gm}var g5,Ym={};function PP(){if(g5)return Ym;function e(t){return(e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(t)}g5=1,Object.defineProperty(Ym,"__esModule",{value:!0}),Ym.NoticeEvent=void 0;var t=Yd(),n=La(),r=zd();function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function s(){return s=typeof Reflect<"u"&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=c(e)););return e}(e,t);if(r){var i=Object.getOwnPropertyDescriptor(r,t);return i.get?i.get.call(arguments.length<3?e:n):i.value}},s.apply(this,arguments)}function a(e,t){return(a=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function l(t){var n=function(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch{return!1}}();return function(){var r,i=c(t);if(n){var o=c(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return function(t,n){if(n&&("object"===e(n)||"function"==typeof n))return n;if(void 0!==n)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(t)}(this,r)}}function c(e){return(c=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var u=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&a(e,t)}(u,e);var t=l(u);function u(e){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,u),t.call(this,e)}return function(e,t,n){t&&o(e.prototype,t),n&&o(e,n),Object.defineProperty(e,"prototype",{writable:!1})}(u,[{key:"isNotice",get:function(){return!0}},{key:"isEquivalentTo",value:function(e){return(0,r.isEventTypeSame)(e,n.M_NOTICE)||s(c(u.prototype),"isEquivalentTo",this).call(this,e)}},{key:"serialize",value:function(){var e=s(c(u.prototype),"serialize",this).call(this);return e.content.msgtype="m.notice",e}}],[{key:"from",value:function(e,t){var r;return new u({type:n.M_NOTICE.name,content:(r={},i(r,n.M_TEXT.name,e),i(r,n.M_HTML.name,t),r)})}}]),u}(t.MessageEvent);return Ym.NoticeEvent=u,Ym}var v5,y5,Jm={};function LP(){if(v5)return Jm;function e(t){return(e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(t)}v5=1,Object.defineProperty(Jm,"__esModule",{value:!0}),Jm.EmoteEvent=void 0;var t=Yd(),n=La(),r=zd();function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function s(){return s=typeof Reflect<"u"&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=c(e)););return e}(e,t);if(r){var i=Object.getOwnPropertyDescriptor(r,t);return i.get?i.get.call(arguments.length<3?e:n):i.value}},s.apply(this,arguments)}function a(e,t){return(a=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function l(t){var n=function(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch{return!1}}();return function(){var r,i=c(t);if(n){var o=c(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return function(t,n){if(n&&("object"===e(n)||"function"==typeof n))return n;if(void 0!==n)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(t)}(this,r)}}function c(e){return(c=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var u=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&a(e,t)}(u,e);var t=l(u);function u(e){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,u),t.call(this,e)}return function(e,t,n){t&&o(e.prototype,t),n&&o(e,n),Object.defineProperty(e,"prototype",{writable:!1})}(u,[{key:"isEmote",get:function(){return!0}},{key:"isEquivalentTo",value:function(e){return(0,r.isEventTypeSame)(e,n.M_EMOTE)||s(c(u.prototype),"isEquivalentTo",this).call(this,e)}},{key:"serialize",value:function(){var e=s(c(u.prototype),"serialize",this).call(this);return e.content.msgtype="m.emote",e}}],[{key:"from",value:function(e,t){var r;return new u({type:n.M_EMOTE.name,content:(r={},i(r,n.M_TEXT.name,e),i(r,n.M_HTML.name,t),r)})}}]),u}(t.MessageEvent);return Jm.EmoteEvent=u,Jm}function I$(){if(y5)return Ff;y5=1,Object.defineProperty(Ff,"__esModule",{value:!0}),Ff.LEGACY_M_ROOM_MESSAGE=void 0,Ff.parseMRoomMessage=function(r){var o,l,c;if(i.M_MESSAGE.findIn(r.content)||i.M_TEXT.findIn(r.content))return new e.MessageEvent(r);var u,d=null===(o=r.content)||void 0===o?void 0:o.msgtype,h=null===(l=r.content)||void 0===l?void 0:l.body,p="org.matrix.custom.html"===(null===(c=r.content)||void 0===c?void 0:c.format)?r.content.formatted_body:null;return"m.text"===d?new e.MessageEvent(s(s({},r),{},{content:s(s({},r.content),{},(u={},a(u,i.M_TEXT.name,h),a(u,i.M_HTML.name,p),u))})):"m.notice"===d?new t.NoticeEvent(s(s({},r),{},{content:s(s({},r.content),{},(f={},a(f,i.M_TEXT.name,h),a(f,i.M_HTML.name,p),f))})):"m.emote"===d?new n.EmoteEvent(s(s({},r),{},{content:s(s({},r.content),{},(m={},a(m,i.M_TEXT.name,h),a(m,i.M_HTML.name,p),m))})):null;var f,m};var e=Yd(),t=PP(),n=LP(),r=Lp(),i=La();function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function s(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var l=new r.NamespacedValue("m.room.message");return Ff.LEGACY_M_ROOM_MESSAGE=l,Ff}var _5,y1={};function k$(){if(_5)return y1;_5=1,Object.defineProperty(y1,"__esModule",{value:!0}),y1.parseMMessage=function(i){return t.M_EMOTE.matches(i.type)?new n.EmoteEvent(i):t.M_NOTICE.matches(i.type)?new r.NoticeEvent(i):new e.MessageEvent(i)};var e=Yd(),t=La(),n=LP(),r=PP();return y1}var b5,us={};function Op(){if(b5)return us;b5=1,Object.defineProperty(us,"__esModule",{value:!0}),us.M_POLL_START=us.M_POLL_RESPONSE=us.M_POLL_KIND_UNDISCLOSED=us.M_POLL_KIND_DISCLOSED=us.M_POLL_END=void 0;var e=Lp(),t=new e.UnstableValue("m.poll.disclosed","org.matrix.msc3381.poll.disclosed");us.M_POLL_KIND_DISCLOSED=t;var n=new e.UnstableValue("m.poll.undisclosed","org.matrix.msc3381.poll.undisclosed");us.M_POLL_KIND_UNDISCLOSED=n;var r=new e.UnstableValue("m.poll.start","org.matrix.msc3381.poll.start");us.M_POLL_START=r;var i=new e.UnstableValue("m.poll.response","org.matrix.msc3381.poll.response");us.M_POLL_RESPONSE=i;var o=new e.UnstableValue("m.poll.end","org.matrix.msc3381.poll.end");return us.M_POLL_END=o,us}var S5,_1={},Yu={};function x$(){if(S5)return Yu;function e(t){return(e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(t)}S5=1,Object.defineProperty(Yu,"__esModule",{value:!0}),Yu.PollStartEvent=Yu.PollAnswerSubevent=void 0;var t=Op(),n=Yd(),r=La(),i=Pp(),o=Lp(),s=zd(),a=wy();function l(e){return function(e){if(Array.isArray(e))return c(e)}(e)||function(e){if(typeof Symbol<"u"&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return c(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);if("Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return c(e,t)}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function c(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function u(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function d(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?u(Object(n),!0).forEach((function(t){_(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):u(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function h(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function p(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function f(e,t,n){return t&&p(e.prototype,t),n&&p(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function m(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&v(e,t)}function v(e,t){return(v=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function g(t){var n=function(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch{return!1}}();return function(){var r,i=b(t);if(n){var o=b(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return function(t,n){if(n&&("object"===e(n)||"function"==typeof n))return n;if(void 0!==n)throw new TypeError("Derived constructors may only return object or undefined");return y(t)}(this,r)}}function y(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function b(e){return(b=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var w=function(e){m(n,e);var t=g(n);function n(e){var r;h(this,n),_(y(r=t.call(this,e)),"id",void 0);var o=e.content.id;if(!o||"string"!=typeof o)throw new i.InvalidEventError("Answer ID must be a non-empty string");return r.id=o,r}return f(n,[{key:"serialize",value:function(){return{type:"org.matrix.sdk.poll.answer",content:d({id:this.id},this.serializeMMessageOnly())}}}],[{key:"from",value:function(e,t){return new n({type:"org.matrix.sdk.poll.answer",content:_({id:e},r.M_TEXT.name,t)})}}]),n}(n.MessageEvent);Yu.PollAnswerSubevent=w;var E=function(e){m(c,e);var a=g(c);function c(e){var r;h(this,c),_(y(r=a.call(this,e)),"question",void 0),_(y(r),"kind",void 0),_(y(r),"rawKind",void 0),_(y(r),"maxSelections",void 0),_(y(r),"answers",void 0);var o=t.M_POLL_START.findIn(r.wireContent);if(!o.question)throw new i.InvalidEventError("A question is required");if(r.question=new n.MessageEvent({type:"org.matrix.sdk.poll.question",content:o.question}),r.rawKind=o.kind,t.M_POLL_KIND_DISCLOSED.matches(r.rawKind)?r.kind=t.M_POLL_KIND_DISCLOSED:r.kind=t.M_POLL_KIND_UNDISCLOSED,r.maxSelections=Number.isFinite(o.max_selections)&&o.max_selections>0?o.max_selections:1,!Array.isArray(o.answers))throw new i.InvalidEventError("Poll answers must be an array");var s=o.answers.slice(0,20).map((function(e){return new w({type:"org.matrix.sdk.poll.answer",content:e})}));if(s.length<=0)throw new i.InvalidEventError("No answers available");return r.answers=s,r}return f(c,[{key:"isEquivalentTo",value:function(e){return(0,s.isEventTypeSame)(e,t.M_POLL_START)}},{key:"serialize",value:function(){var e;return{type:t.M_POLL_START.name,content:(e={},_(e,t.M_POLL_START.name,{question:this.question.serialize().content,kind:this.rawKind,max_selections:this.maxSelections,answers:this.answers.map((function(e){return e.serialize().content}))}),_(e,r.M_TEXT.name,"".concat(this.question.text,"\n").concat(this.answers.map((function(e,t){return"".concat(t+1,". ").concat(e.text)})).join("\n"))),e)}}}],[{key:"from",value:function(e,n,i){var s,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;return new c({type:t.M_POLL_START.name,content:(s={},_(s,r.M_TEXT.name,e),_(s,t.M_POLL_START.name,{question:_({},r.M_TEXT.name,e),kind:i instanceof o.NamespacedValue?i.name:i,max_selections:a,answers:n.map((function(e){return _({id:l(Array(16)).map((function(){return S.charAt(Math.floor(Math.random()*S.length))})).join("")},r.M_TEXT.name,e)}))}),s)})}}]),c}(a.ExtensibleEvent);Yu.PollStartEvent=E;var S="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789";return Yu}var E5,w5,Xm={},Zm={};function OP(){if(E5)return Zm;E5=1,Object.defineProperty(Zm,"__esModule",{value:!0}),Zm.REFERENCE_RELATION=void 0;var e=new(Lp().NamespacedValue)("m.reference");return Zm.REFERENCE_RELATION=e,Zm}function P$(){if(w5)return Xm;function e(t){return(e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(t)}w5=1,Object.defineProperty(Xm,"__esModule",{value:!0}),Xm.PollResponseEvent=void 0;var t=wy(),n=Op(),r=Pp(),i=OP(),o=zd();function s(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function a(e,t){return(a=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function l(t){var n=function(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch{return!1}}();return function(){var r,i=u(t);if(n){var o=u(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return function(t,n){if(n&&("object"===e(n)||"function"==typeof n))return n;if(void 0!==n)throw new TypeError("Derived constructors may only return object or undefined");return c(t)}(this,r)}}function c(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function u(e){return(u=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function d(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var h=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&a(e,t)}(u,e);var t=l(u);function u(e){var n;(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,u),d(c(n=t.call(this,e)),"internalAnswerIds",void 0),d(c(n),"internalSpoiled",void 0),d(c(n),"pollEventId",void 0);var o=n.wireContent["m.relates_to"];if(!i.REFERENCE_RELATION.matches(null==o?void 0:o.rel_type)||"string"!=typeof(null==o?void 0:o.event_id))throw new r.InvalidEventError("Relationship must be a reference to an event");return n.pollEventId=o.event_id,n.validateAgainst(null),n}return function(e,t,n){t&&s(e.prototype,t),n&&s(e,n),Object.defineProperty(e,"prototype",{writable:!1})}(u,[{key:"answerIds",get:function(){return this.internalAnswerIds}},{key:"spoiled",get:function(){return this.internalSpoiled}},{key:"validateAgainst",value:function(e){var t=n.M_POLL_RESPONSE.findIn(this.wireContent);if(!Array.isArray(null==t?void 0:t.answers))return this.internalSpoiled=!0,void(this.internalAnswerIds=[]);var r=t.answers;if(r.some((function(e){return"string"!=typeof e}))||0===r.length)return this.internalSpoiled=!0,void(this.internalAnswerIds=[]);if(e){if(r.some((function(t){return!e.answers.some((function(e){return e.id===t}))})))return this.internalSpoiled=!0,void(this.internalAnswerIds=[]);r=r.slice(0,e.maxSelections)}this.internalAnswerIds=r,this.internalSpoiled=!1}},{key:"isEquivalentTo",value:function(e){return(0,o.isEventTypeSame)(e,n.M_POLL_RESPONSE)}},{key:"serialize",value:function(){return{type:n.M_POLL_RESPONSE.name,content:d({"m.relates_to":{rel_type:i.REFERENCE_RELATION.name,event_id:this.pollEventId}},n.M_POLL_RESPONSE.name,{answers:this.spoiled?void 0:this.answerIds})}}}],[{key:"from",value:function(e,t){return new u({type:n.M_POLL_RESPONSE.name,content:d({"m.relates_to":{rel_type:i.REFERENCE_RELATION.name,event_id:t}},n.M_POLL_RESPONSE.name,{answers:e})})}}]),u}(t.ExtensibleEvent);return Xm.PollResponseEvent=h,Xm}var C5,T5,R5,Qm={};function L$(){if(C5)return Qm;function e(t){return(e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(t)}C5=1,Object.defineProperty(Qm,"__esModule",{value:!0}),Qm.PollEndEvent=void 0;var t=Op(),n=Pp(),r=OP(),i=Yd(),o=La(),s=zd();function a(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function l(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?a(Object(n),!0).forEach((function(t){f(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function c(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function u(e,t){return(u=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function d(t){var n=function(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch{return!1}}();return function(){var r,i=p(t);if(n){var o=p(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return function(t,n){if(n&&("object"===e(n)||"function"==typeof n))return n;if(void 0!==n)throw new TypeError("Derived constructors may only return object or undefined");return h(t)}(this,r)}}function h(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function p(e){return(p=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function f(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var m=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&u(e,t)}(p,e);var a=d(p);function p(e){var t;(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,p),f(h(t=a.call(this,e)),"pollEventId",void 0),f(h(t),"closingMessage",void 0);var o=t.wireContent["m.relates_to"];if(!r.REFERENCE_RELATION.matches(null==o?void 0:o.rel_type)||"string"!=typeof(null==o?void 0:o.event_id))throw new n.InvalidEventError("Relationship must be a reference to an event");return t.pollEventId=o.event_id,t.closingMessage=new i.MessageEvent(t.wireFormat),t}return function(e,t,n){t&&c(e.prototype,t),n&&c(e,n),Object.defineProperty(e,"prototype",{writable:!1})}(p,[{key:"isEquivalentTo",value:function(e){return(0,s.isEventTypeSame)(e,t.M_POLL_END)}},{key:"serialize",value:function(){return{type:t.M_POLL_END.name,content:l(f({"m.relates_to":{rel_type:r.REFERENCE_RELATION.name,event_id:this.pollEventId}},t.M_POLL_END.name,{}),this.closingMessage.serialize().content)}}}],[{key:"from",value:function(e,n){var i;return new p({type:t.M_POLL_END.name,content:(i={"m.relates_to":{rel_type:r.REFERENCE_RELATION.name,event_id:e}},f(i,t.M_POLL_END.name,{}),f(i,o.M_TEXT.name,n),i)})}}]),p}(wy().ExtensibleEvent);return Qm.PollEndEvent=m,Qm}function O$(){if(T5)return _1;T5=1,Object.defineProperty(_1,"__esModule",{value:!0}),_1.parseMPoll=function(i){return e.M_POLL_START.matches(i.type)?new t.PollStartEvent(i):e.M_POLL_RESPONSE.matches(i.type)?new n.PollResponseEvent(i):e.M_POLL_END.matches(i.type)?new r.PollEndEvent(i):null};var e=Op(),t=x$(),n=P$(),r=L$();return _1}function Cie(){if(R5)return Vm;R5=1,Object.defineProperty(Vm,"__esModule",{value:!0}),Vm.ExtensibleEvents=void 0;var e=T$(),t=Pp(),n=I$(),r=k$(),i=La(),o=Op(),s=O$();function a(e,t){var n=typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return l(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);if("Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return l(e,t)}}(e))||t){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,s=!0,a=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){a=!0,o=e},f:function(){try{!s&&null!=n.return&&n.return()}finally{if(a)throw o}}}}function l(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function c(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function u(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var d=function(){function l(){(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,l),u(this,"interpreters",new e.NamespacedMap([[n.LEGACY_M_ROOM_MESSAGE,n.parseMRoomMessage],[i.M_MESSAGE,r.parseMMessage],[i.M_EMOTE,r.parseMMessage],[i.M_NOTICE,r.parseMMessage],[o.M_POLL_START,s.parseMPoll],[o.M_POLL_RESPONSE,s.parseMPoll],[o.M_POLL_END,s.parseMPoll]])),u(this,"_unknownInterpretOrder",[i.M_MESSAGE])}return function(e,t,n){t&&c(e.prototype,t),n&&c(e,n),Object.defineProperty(e,"prototype",{writable:!1})}(l,[{key:"unknownInterpretOrder",get:function(){var e;return null!==(e=this._unknownInterpretOrder)&&void 0!==e?e:[]},set:function(e){this._unknownInterpretOrder=e}},{key:"registerInterpreter",value:function(e,t){this.interpreters.set(e,t)}},{key:"parse",value:function(e){try{if(this.interpreters.hasNamespaced(e.type))return this.interpreters.getNamespaced(e.type)(e);var n,r=a(this.unknownInterpretOrder);try{for(r.s();!(n=r.n()).done;){var i=n.value;if(this.interpreters.has(i)){var o=this.interpreters.get(i)(e);if(o)return o}}}catch(e){r.e(e)}finally{r.f()}return null}catch(e){if(e instanceof t.InvalidEventError)return null;throw e}}}],[{key:"defaultInstance",get:function(){return l._defaultInstance}},{key:"unknownInterpretOrder",get:function(){return l.defaultInstance.unknownInterpretOrder},set:function(e){l.defaultInstance.unknownInterpretOrder=e}},{key:"registerInterpreter",value:function(e,t){l.defaultInstance.registerInterpreter(e,t)}},{key:"parse",value:function(e){return l.defaultInstance.parse(e)}}]),l}();return Vm.ExtensibleEvents=d,u(d,"_defaultInstance",new d),Vm}var I5,zT={};function Tie(){return I5||(I5=1,Object.defineProperty(zT,"__esModule",{value:!0})),zT}var k5,x5,Ju={};function Rie(){if(k5)return Ju;k5=1,Object.defineProperty(Ju,"__esModule",{value:!0}),Ju.LegacyMsgType=void 0,Ju.isEventLike=function(t,r){var i=t.content;return r===e.Text?n.M_MESSAGE.matches(t.type)||"m.room.message"===t.type&&"m.text"===(null==i?void 0:i.msgtype):r===e.Emote?n.M_EMOTE.matches(t.type)||"m.room.message"===t.type&&"m.emote"===(null==i?void 0:i.msgtype):r===e.Notice&&(n.M_NOTICE.matches(t.type)||"m.room.message"===t.type&&"m.notice"===(null==i?void 0:i.msgtype))};var e,t,n=La();return Ju.LegacyMsgType=e,(t=e||(Ju.LegacyMsgType=e={})).Text="m.text",t.Notice="m.notice",t.Emote="m.emote",Ju}function Iie(){return x5||(x5=1,function(e){Object.defineProperty(e,"__esModule",{value:!0});var t=Cie();Object.keys(t).forEach((function(n){"default"===n||"__esModule"===n||n in e&&e[n]===t[n]||Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[n]}})}));var n=Tie();Object.keys(n).forEach((function(t){"default"===t||"__esModule"===t||t in e&&e[t]===n[t]||Object.defineProperty(e,t,{enumerable:!0,get:function(){return n[t]}})}));var r=Pp();Object.keys(r).forEach((function(t){"default"===t||"__esModule"===t||t in e&&e[t]===r[t]||Object.defineProperty(e,t,{enumerable:!0,get:function(){return r[t]}})}));var i=Lp();Object.keys(i).forEach((function(t){"default"===t||"__esModule"===t||t in e&&e[t]===i[t]||Object.defineProperty(e,t,{enumerable:!0,get:function(){return i[t]}})}));var o=T$();Object.keys(o).forEach((function(t){"default"===t||"__esModule"===t||t in e&&e[t]===o[t]||Object.defineProperty(e,t,{enumerable:!0,get:function(){return o[t]}})}));var s=R$();Object.keys(s).forEach((function(t){"default"===t||"__esModule"===t||t in e&&e[t]===s[t]||Object.defineProperty(e,t,{enumerable:!0,get:function(){return s[t]}})}));var a=Rie();Object.keys(a).forEach((function(t){"default"===t||"__esModule"===t||t in e&&e[t]===a[t]||Object.defineProperty(e,t,{enumerable:!0,get:function(){return a[t]}})}));var l=zd();Object.keys(l).forEach((function(t){"default"===t||"__esModule"===t||t in e&&e[t]===l[t]||Object.defineProperty(e,t,{enumerable:!0,get:function(){return l[t]}})}));var c=I$();Object.keys(c).forEach((function(t){"default"===t||"__esModule"===t||t in e&&e[t]===c[t]||Object.defineProperty(e,t,{enumerable:!0,get:function(){return c[t]}})}));var u=k$();Object.keys(u).forEach((function(t){"default"===t||"__esModule"===t||t in e&&e[t]===u[t]||Object.defineProperty(e,t,{enumerable:!0,get:function(){return u[t]}})}));var d=O$();Object.keys(d).forEach((function(t){"default"===t||"__esModule"===t||t in e&&e[t]===d[t]||Object.defineProperty(e,t,{enumerable:!0,get:function(){return d[t]}})}));var h=OP();Object.keys(h).forEach((function(t){"default"===t||"__esModule"===t||t in e&&e[t]===h[t]||Object.defineProperty(e,t,{enumerable:!0,get:function(){return h[t]}})}));var p=wy();Object.keys(p).forEach((function(t){"default"===t||"__esModule"===t||t in e&&e[t]===p[t]||Object.defineProperty(e,t,{enumerable:!0,get:function(){return p[t]}})}));var f=La();Object.keys(f).forEach((function(t){"default"===t||"__esModule"===t||t in e&&e[t]===f[t]||Object.defineProperty(e,t,{enumerable:!0,get:function(){return f[t]}})}));var m=Yd();Object.keys(m).forEach((function(t){"default"===t||"__esModule"===t||t in e&&e[t]===m[t]||Object.defineProperty(e,t,{enumerable:!0,get:function(){return m[t]}})}));var v=LP();Object.keys(v).forEach((function(t){"default"===t||"__esModule"===t||t in e&&e[t]===v[t]||Object.defineProperty(e,t,{enumerable:!0,get:function(){return v[t]}})}));var g=PP();Object.keys(g).forEach((function(t){"default"===t||"__esModule"===t||t in e&&e[t]===g[t]||Object.defineProperty(e,t,{enumerable:!0,get:function(){return g[t]}})}));var y=Op();Object.keys(y).forEach((function(t){"default"===t||"__esModule"===t||t in e&&e[t]===y[t]||Object.defineProperty(e,t,{enumerable:!0,get:function(){return y[t]}})}));var b=x$();Object.keys(b).forEach((function(t){"default"===t||"__esModule"===t||t in e&&e[t]===b[t]||Object.defineProperty(e,t,{enumerable:!0,get:function(){return b[t]}})}));var _=P$();Object.keys(_).forEach((function(t){"default"===t||"__esModule"===t||t in e&&e[t]===_[t]||Object.defineProperty(e,t,{enumerable:!0,get:function(){return _[t]}})}));var w=L$();Object.keys(w).forEach((function(t){"default"===t||"__esModule"===t||t in e&&e[t]===w[t]||Object.defineProperty(e,t,{enumerable:!0,get:function(){return w[t]}})}))}(WT)),WT}var rs=Iie();const kie="modulepreload",xie=function(e,t){return new URL(e,t).href},P5={},Cv=function(e,t,n){let r=Promise.resolve();if(t&&t.length>0){const e=document.getElementsByTagName("link"),i=document.querySelector("meta[property=csp-nonce]"),o=(null==i?void 0:i.nonce)||(null==i?void 0:i.getAttribute("nonce"));r=Promise.allSettled(t.map((t=>{if((t=xie(t,n))in P5)return;P5[t]=!0;const r=t.endsWith(".css"),i=r?'[rel="stylesheet"]':"";if(n)for(let n=e.length-1;n>=0;n--){const i=e[n];if(i.href===t&&(!r||"stylesheet"===i.rel))return}else if(document.querySelector(`link[href="${t}"]${i}`))return;const s=document.createElement("link");return s.rel=r?"stylesheet":kie,r||(s.as="script"),s.crossOrigin="",s.href=t,o&&s.setAttribute("nonce",o),document.head.appendChild(s),r?new Promise(((e,n)=>{s.addEventListener("load",e),s.addEventListener("error",(()=>n(new Error(`Unable to preload CSS for ${t}`))))})):void 0})))}function i(e){const t=new Event("vite:preloadError",{cancelable:!0});if(t.payload=e,window.dispatchEvent(t),!t.defaultPrevented)throw e}return r.then((t=>{for(const e of t||[])"rejected"===e.status&&i(e.reason);return e().catch(i)}))};function Pie(e,t){if(null==e)return{};var n={};for(var r in e)if({}.hasOwnProperty.call(e,r)){if(t.includes(r))continue;n[r]=e[r]}return n}function Lie(e,t){if(null==e)return{};var n,r,i=Pie(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.includes(n)||{}.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}var Kr=function(e){return e.DisplayName="User.displayName",e.AvatarUrl="User.avatarUrl",e.Presence="User.presence",e.CurrentlyActive="User.currentlyActive",e.LastPresenceTs="User.lastPresenceTs",e}({});class El extends En{constructor(e){super(),this.userId=e,L(this,"modified",-1),L(this,"displayName",void 0),L(this,"rawDisplayName",void 0),L(this,"avatarUrl",void 0),L(this,"presenceStatusMsg",void 0),L(this,"presence","offline"),L(this,"lastActiveAgo",0),L(this,"lastPresenceTs",0),L(this,"currentlyActive",!1),L(this,"events",{}),this.displayName=e,this.rawDisplayName=e,this.updateModifiedTime()}static createUser(e,t){var n=new El(e);return t.reEmitter.reEmit(n,[Kr.AvatarUrl,Kr.DisplayName,Kr.Presence,Kr.CurrentlyActive,Kr.LastPresenceTs]),n}setPresenceEvent(e){if("m.presence"===e.getType()){var t=null===this.events.presence;this.events.presence=e;var n=[];for(var r of((e.getContent().presence!==this.presence||t)&&n.push(Kr.Presence),e.getContent().avatar_url&&e.getContent().avatar_url!==this.avatarUrl&&n.push(Kr.AvatarUrl),e.getContent().displayname&&e.getContent().displayname!==this.displayName&&n.push(Kr.DisplayName),void 0!==e.getContent().currently_active&&e.getContent().currently_active!==this.currentlyActive&&n.push(Kr.CurrentlyActive),this.presence=e.getContent().presence,n.push(Kr.LastPresenceTs),e.getContent().status_msg&&(this.presenceStatusMsg=e.getContent().status_msg),e.getContent().displayname&&(this.displayName=e.getContent().displayname),e.getContent().avatar_url&&(this.avatarUrl=e.getContent().avatar_url),this.lastActiveAgo=e.getContent().last_active_ago,this.lastPresenceTs=Date.now(),this.currentlyActive=e.getContent().currently_active,this.updateModifiedTime(),n))this.emit(r,e,this)}}setDisplayName(e){var t=this.displayName;this.displayName=e,e!==t&&this.updateModifiedTime()}setRawDisplayName(e){this.rawDisplayName=e}setAvatarUrl(e){var t=this.avatarUrl;this.avatarUrl=e,e!==t&&this.updateModifiedTime()}updateModifiedTime(){this.modified=Date.now()}getLastModifiedTime(){return this.modified}getLastActiveTs(){return this.lastPresenceTs-this.lastActiveAgo}}var ht=function(e){return e.Backward="b",e.Forward="f",e}({});class Le{static setEventMetadata(e,t,n){e.setMetadata(t,n)}constructor(e){var t,n;this.eventTimelineSet=e,L(this,"roomId",void 0),L(this,"name",void 0),L(this,"events",[]),L(this,"baseIndex",0),L(this,"startState",void 0),L(this,"endState",void 0),L(this,"startToken",null),L(this,"endToken",null),L(this,"prevTimeline",null),L(this,"nextTimeline",null),L(this,"paginationRequests",{[ht.Backward]:null,[ht.Forward]:null}),this.roomId=null!==(t=null===(n=e.room)||void 0===n?void 0:n.roomId)&&void 0!==t?t:null,this.roomId&&(this.startState=new Lv(this.roomId),this.endState=new Lv(this.roomId)),this.paginationRequests={b:null,f:null},this.name=this.roomId+":"+(new Date).toISOString()}initialiseState(e){var t,n,{timelineWasEmpty:r}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(this.events.length>0)throw new Error("Cannot initialise state after events are added");null===(t=this.startState)||void 0===t||t.setStateEvents(e,{timelineWasEmpty:r}),null===(n=this.endState)||void 0===n||n.setStateEvents(e,{timelineWasEmpty:r})}forkLive(e){var t=this.getState(e),n=new Le(this.eventTimelineSet);return n.startState=null==t?void 0:t.clone(),n.endState=t,this.endState=null==t?void 0:t.clone(),n}fork(e){var t=this.getState(e),n=new Le(this.eventTimelineSet);return n.startState=null==t?void 0:t.clone(),n.endState=null==t?void 0:t.clone(),n}getRoomId(){return this.roomId}getFilter(){return this.eventTimelineSet.getFilter()}getTimelineSet(){return this.eventTimelineSet}getBaseIndex(){return this.baseIndex}getEvents(){return this.events}getState(e){if(e==Le.BACKWARDS)return this.startState;if(e==Le.FORWARDS)return this.endState;throw new Error("Invalid direction '"+e+"'")}getPaginationToken(e){return this.roomId?this.getState(e).paginationToken:e===ht.Backward?this.startToken:this.endToken}setPaginationToken(e,t){this.roomId?this.getState(t).paginationToken=e:t===ht.Backward?this.startToken=e:this.endToken=e}getNeighbouringTimeline(e){if(e==Le.BACKWARDS)return this.prevTimeline;if(e==Le.FORWARDS)return this.nextTimeline;throw new Error("Invalid direction '"+e+"'")}setNeighbouringTimeline(e,t){if(this.getNeighbouringTimeline(t))throw new Error("timeline already has a neighbouring timeline - cannot reset neighbour (direction: "+t+")");if(t==Le.BACKWARDS)this.prevTimeline=e;else{if(t!=Le.FORWARDS)throw new Error("Invalid direction '"+t+"'");this.nextTimeline=e}this.setPaginationToken(null,t)}addEvent(e,t){var{toStartOfTimeline:n,roomState:r,timelineWasEmpty:i,addToState:o}=t;r||(r=n?this.startState:this.endState);var s,a,l=this.getTimelineSet();l.room&&(Le.setEventMetadata(e,r,n),o&&e.isState()&&l.room.getUnfilteredTimelineSet()===l)&&(null===(s=r)||void 0===s||s.setStateEvents([e],{timelineWasEmpty:i}),(!e.sender||e.getType()===ee.RoomMember&&!n)&&Le.setEventMetadata(e,r,n));a=n?0:this.events.length,this.events.splice(a,0,e),n&&this.baseIndex++}insertEvent(e,t,n,r){var i=this.getTimelineSet();i.room&&(Le.setEventMetadata(e,n,!1),r&&e.isState()&&i.room.getUnfilteredTimelineSet()===i&&(n.setStateEvents([e],{}),(!e.sender||e.getType()===ee.RoomMember)&&Le.setEventMetadata(e,n,!1))),this.events.splice(t,0,e)}removeEvent(e){for(var t=this.events.length-1;t>=0;t--){var n=this.events[t];if(n.getId()==e)return this.events.splice(t,1),t<this.baseIndex&&this.baseIndex--,n}return null}toString(){return this.name}}L(Le,"BACKWARDS",ht.Backward),L(Le,"FORWARDS",ht.Forward);var dh,N_=function(e){return e.Add="Relations.add",e.Remove="Relations.remove",e.Redaction="Relations.redaction",e}({}),Oie=function(e,t){return[t,...arguments.length>2&&void 0!==arguments[2]?arguments[2]:[]].includes(e)};class MP extends En{constructor(e,t,n,r){var i,o;super(),i=this,this.relationType=e,this.eventType=t,this.altEventTypes=r,L(this,"relationEventIds",new Set),L(this,"relations",new Set),L(this,"annotationsByKey",{}),L(this,"annotationsBySender",{}),L(this,"sortedAnnotationsByKey",[]),L(this,"targetEvent",null),L(this,"creationEmitted",!1),L(this,"client",void 0),L(this,"onEventStatus",((e,t)=>{e.isSending()?t===et.CANCELLED&&(e.removeListener(Mt.Status,this.onEventStatus),this.removeEvent(e)):e.removeListener(Mt.Status,this.onEventStatus)})),L(this,"onBeforeRedaction",(o=U((function*(e){if(i.relations.has(e)){if(i.relations.delete(e),i.relationType===cn.Annotation)i.removeAnnotationFromAggregation(e);else if(i.relationType===cn.Replace&&i.targetEvent&&!i.targetEvent.isState()){var t=yield i.getLastReplacement();i.targetEvent.makeReplaced(t)}e.removeListener(Mt.BeforeRedaction,i.onBeforeRedaction),i.emit(N_.Redaction,e)}})),function(e){return o.apply(this,arguments)})),this.client=n instanceof xE?n.client:n}addEvent(e){var t=this;return U((function*(){if(!t.relationEventIds.has(e.getId())){var n=e.getRelation();if(!n)return void A.error("Event must have relation info");var r=n.rel_type,i=e.getType();if(t.relationType!==r||!Oie(i,t.eventType,t.altEventTypes))return void A.error("Event relation info doesn't match this container");if(e.isSending()&&e.on(Mt.Status,t.onEventStatus),t.relations.add(e),t.relationEventIds.add(e.getId()),t.relationType===cn.Annotation)t.addAnnotationToAggregation(e);else if(t.relationType===cn.Replace&&t.targetEvent&&!t.targetEvent.isState()){var o=yield t.getLastReplacement();t.targetEvent.makeReplaced(o)}e.on(Mt.BeforeRedaction,t.onBeforeRedaction),t.emit(N_.Add,e),t.maybeEmitCreated()}}))()}removeEvent(e){var t=this;return U((function*(){if(t.relations.has(e)){if(t.relations.delete(e),t.relationType===cn.Annotation)t.removeAnnotationFromAggregation(e);else if(t.relationType===cn.Replace&&t.targetEvent&&!t.targetEvent.isState()){var n=yield t.getLastReplacement();t.targetEvent.makeReplaced(n)}t.emit(N_.Remove,e)}}))()}getRelations(){return[...this.relations]}addAnnotationToAggregation(e){var t,{key:n}=null!==(t=e.getRelation())&&void 0!==t?t:{};if(n){var r=this.annotationsByKey[n];r||(r=this.annotationsByKey[n]=new Set,this.sortedAnnotationsByKey.push([n,r])),r.add(e),this.sortedAnnotationsByKey.sort(((e,t)=>{var n=e[1];return t[1].size-n.size}));var i=e.getSender(),o=this.annotationsBySender[i];o||(o=this.annotationsBySender[i]=new Set),o.add(e)}}removeAnnotationFromAggregation(e){var t,{key:n}=null!==(t=e.getRelation())&&void 0!==t?t:{};if(n){var r=this.annotationsByKey[n];r&&(r.delete(e),this.sortedAnnotationsByKey.sort(((e,t)=>{var n=e[1];return t[1].size-n.size})));var i=e.getSender(),o=this.annotationsBySender[i];o&&o.delete(e)}}getSortedAnnotationsByKey(){return this.relationType!==cn.Annotation?null:this.sortedAnnotationsByKey}getAnnotationsBySender(){return this.relationType!==cn.Annotation?null:this.annotationsBySender}getLastReplacement(){var e=this;return U((function*(){if(e.relationType!==cn.Replace||!e.targetEvent)return null;var t=e.targetEvent.getServerAggregatedRelation(cn.Replace),n=null==t?void 0:t.origin_server_ts,r=e.getRelations().reduce(((t,r)=>r.getSender()!==e.targetEvent.getSender()||n&&n>r.getTs()||t&&t.getTs()>r.getTs()?t:r),null);return null!=r&&r.shouldAttemptDecryption()&&e.client.getCrypto()?yield r.attemptDecryption(e.client.getCrypto()):null!=r&&r.isBeingDecrypted()&&(yield r.getDecryptionPromise()),r}))()}setTargetEvent(e){var t=this;return U((function*(){if(!t.targetEvent){if(t.targetEvent=e,t.relationType===cn.Replace&&!t.targetEvent.isState()){var n=yield t.getLastReplacement();n&&t.targetEvent.makeReplaced(n)}t.maybeEmitCreated()}}))()}maybeEmitCreated(){this.creationEmitted||!this.targetEvent||!this.relations.size||(this.creationEmitted=!0,this.targetEvent.emit(Mt.RelationsCreated,this.relationType,this.eventType))}}class M${constructor(e,t){this.client=e,this.room=t,L(this,"relations",new Map)}getChildEventsForEvent(e,t,n){var r;return null===(r=this.relations.get(e))||void 0===r||null===(r=r.get(t))||void 0===r?void 0:r.get(n)}getAllChildEventsForEvent(e){var t,n=null!==(t=this.relations.get(e))&&void 0!==t?t:new Map,r=[];for(var i of n.values())for(var o of i.values())r.push(...o.getRelations());return r}aggregateParentEvent(e){var t=this.relations.get(e.getId());if(t)for(var n of t.values())for(var r of n.values())r.setTargetEvent(e)}aggregateChildEvent(e,t){if(!e.isRedacted()&&e.status!==et.CANCELLED){var n=e.getRelation();if(n){var r=()=>{e.isDecryptionFailure()?e.once(Mt.Decrypted,r):this.aggregateChildEvent(e,t)};if(e.isBeingDecrypted()||e.shouldAttemptDecryption())return void e.once(Mt.Decrypted,r);var{event_id:i,rel_type:o}=n,s=e.getType(),a=this.relations.get(i);a||(a=new Map,this.relations.set(i,a));var l=a.get(o);l||(l=new Map,a.set(o,l));var c=l.get(s);if(!c){var u,d,h;c=new MP(o,s,this.client),l.set(s,c);var p=null!==(u=this.room)&&void 0!==u?u:null==t?void 0:t.room,f=null!==(d=null!==(h=null==t?void 0:t.findEventById(i))&&void 0!==h?h:null==p?void 0:p.findEventById(i))&&void 0!==d?d:null==p?void 0:p.getPendingEvent(i);f&&c.setTargetEvent(f)}c.addEvent(e)}}}}dh=A.log.bind(A);var Vg=function(e){return e.Ignore="ignore",e.Replace="replace",e}({});class _h extends En{constructor(e){var t,n,r,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=arguments.length>2?arguments[2]:void 0,s=arguments.length>3?arguments[3]:void 0,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;super(),this.room=e,this.thread=s,this.threadListType=a,L(this,"relations",void 0),L(this,"timelineSupport",void 0),L(this,"displayPendingEvents",void 0),L(this,"liveTimeline",void 0),L(this,"timelines",void 0),L(this,"_eventIdToTimeline",new Map),L(this,"filter",void 0),this.timelineSupport=!!i.timelineSupport,this.liveTimeline=new Le(this),this.displayPendingEvents=!1!==i.pendingEvents,this.timelines=[this.liveTimeline],this._eventIdToTimeline=new Map,this.filter=i.filter,this.relations=null!==(t=null===(n=this.room)||void 0===n?void 0:n.relations)&&void 0!==t?t:new M$(null!==(r=null==e?void 0:e.client)&&void 0!==r?r:o)}getTimelines(){return this.timelines}getFilter(){return this.filter}setFilter(e){this.filter=e}getPendingEvents(){return this.room&&this.displayPendingEvents?this.room.getPendingEvents():[]}getLiveTimeline(){return this.liveTimeline}setLiveTimeline(e){this.liveTimeline=e}eventIdToTimeline(e){return this._eventIdToTimeline.get(e)}replaceEventId(e,t){var n=this._eventIdToTimeline.get(e);n&&(this._eventIdToTimeline.delete(e),this._eventIdToTimeline.set(t,n))}resetLiveTimeline(e,t){var n=!this.timelineSupport||!t,r=this.liveTimeline,i=n?r.forkLive(Le.FORWARDS):r.fork(Le.FORWARDS);n?(this.timelines=[i],this._eventIdToTimeline=new Map):this.timelines.push(i),t&&r.setPaginationToken(t,Le.FORWARDS),i.setPaginationToken(e??null,Le.BACKWARDS),this.liveTimeline=i,this.emit(ke.TimelineReset,this.room,this,n)}getTimelineForEvent(e){if(null==e)return null;var t=this._eventIdToTimeline.get(e);return void 0===t?null:t}findEventById(e){var t=this.getTimelineForEvent(e);if(t)return t.getEvents().find((function(t){return t.getId()==e}))}addTimeline(){if(!this.timelineSupport)throw new Error("timeline support is disabled. Set the 'timelineSupport' parameter to true when creating MatrixClient to enable it.");var e=new Le(this);return this.timelines.push(e),e}addEventsToTimeline(e,t,n,r,i){if(!r)throw new Error("'timeline' not specified for EventTimelineSet.addEventsToTimeline");if(!t&&r==this.liveTimeline)throw new Error("EventTimelineSet.addEventsToTimeline cannot be used for adding events to the live timeline - use Room.addLiveEvents instead");if(!this.filter||(e=this.filter.filterRoomTimeline(e)).length){var o=t?Le.BACKWARDS:Le.FORWARDS,s=t?Le.FORWARDS:Le.BACKWARDS,a=!1,l=!1;for(var c of e){var u=c.getId(),d=this._eventIdToTimeline.get(u);if(d)if(l=!1,d!=r){var h=r.getNeighbouringTimeline(o);if(h)dh(d==h?"Event "+u+" in neighbouring timeline - switching to "+d:"Event "+u+" already in a different timeline "+d),r=d;else{A.info("Already have timeline for "+u+" - joining timeline "+r+" to "+d);var p=d===this.liveTimeline,f=r===this.liveTimeline,m=o===Le.BACKWARDS&&p,v=o===Le.FORWARDS&&f;m||v?(m&&A.warn("Refusing to set a preceding existingTimeLine on our timeline as the existingTimeLine is live ("+d+")"),v&&A.warn("Refusing to set our preceding timeline on a existingTimeLine as our timeline is live ("+r+")")):(r.setNeighbouringTimeline(d,o),d.setNeighbouringTimeline(r,s),r=d,a=!0)}}else dh("Event "+u+" already in timeline "+r);else this.addEventToTimeline(c,r,{toStartOfTimeline:t,addToState:n}),l=!0,a=!0}if(l||!a){if(o===Le.FORWARDS&&r===this.liveTimeline)return A.warn({lastEventWasNew:l,didUpdate:a}),void A.warn("Refusing to set forwards pagination token of live timeline "+"".concat(r," to ").concat(i));r.setPaginationToken(i??null,o)}}}addLiveEvent(e,t){var{duplicateStrategy:n,fromCache:r,roomState:i,timelineWasEmpty:o,addToState:s}=t;if(this.filter&&!this.filter.filterRoomTimeline([e]).length)return;var a=this._eventIdToTimeline.get(e.getId());if(a)if(n===Vg.Replace){dh("EventTimelineSet.addLiveEvent: replacing duplicate event "+e.getId());for(var l=a.getEvents(),c=0;c<l.length;c++)if(l[c].getId()===e.getId()){i||(i=a.getState(Le.FORWARDS)),Le.setEventMetadata(e,i,!1),l[c]=e;break}}else dh("EventTimelineSet.addLiveEvent: ignoring duplicate event "+e.getId());else this.addEventToTimeline(e,this.liveTimeline,{toStartOfTimeline:!1,fromCache:r,roomState:i,timelineWasEmpty:o,addToState:s})}addEventToTimeline(e,t,n){var r,{toStartOfTimeline:i,fromCache:o=!1,roomState:s,timelineWasEmpty:a,addToState:l}=n;if(t.getTimelineSet()!==this)throw new Error("EventTimelineSet.addEventToTimeline: Timeline=".concat(t.toString(),' does not belong " +\n                "in timelineSet(threadId=').concat(null===(r=this.thread)||void 0===r?void 0:r.id,")"));var c=e.getId();if(this.relations.aggregateParentEvent(e),this.relations.aggregateChildEvent(e,this),this.room&&!this.canContain(e)){var u,d="event=".concat(c);return e.threadRootId&&(d+="(belongs to thread=".concat(e.threadRootId,")")),void A.warn("EventTimelineSet.addEventToTimeline: Ignoring ".concat(d," that does not belong ")+"in timeline=".concat(t.toString()," timelineSet(threadId=").concat(null===(u=this.thread)||void 0===u?void 0:u.id,")"))}t.addEvent(e,{toStartOfTimeline:i,roomState:s,timelineWasEmpty:a,addToState:l}),this._eventIdToTimeline.set(c,t);var h={timeline:t,liveEvent:!i&&t==this.liveTimeline&&!o};this.emit(ke.Timeline,e,this.room,!!i,!1,h)}insertEventIntoTimeline(e,t,n,r){var i;if(t.getTimelineSet()!==this)throw new Error("EventTimelineSet.insertEventIntoTimeline: Timeline=".concat(t.toString(),' does not belong " +\n                "in timelineSet(threadId=').concat(null===(i=this.thread)||void 0===i?void 0:i.id,")"));var o=e.getId();if(this.relations.aggregateParentEvent(e),this.relations.aggregateChildEvent(e,this),this.room&&!this.canContain(e)){var s,a="event=".concat(o);return e.threadRootId&&(a+="(belongs to thread=".concat(e.threadRootId,")")),void A.warn("EventTimelineSet.insertEventIntoTimeline: Ignoring ".concat(a," that does not belong ")+"in timeline=".concat(t.toString()," timelineSet(threadId=").concat(null===(s=this.thread)||void 0===s?void 0:s.id,")"))}var l=e.relationEventId;if(l){for(var c=this.findEventById(l),u=t.getEvents(),d=void 0!==c?u.indexOf(c):0;d<u.length;d++){if(u[d].getTs()>e.getTs())break}t.insertEvent(e,d,n,r),this._eventIdToTimeline.set(o,t);var h={timeline:t,liveEvent:!1};this.emit(ke.Timeline,e,this.room,!1,!1,h)}else this.addEventToTimeline(e,t,{toStartOfTimeline:!1,fromCache:!1,timelineWasEmpty:!1,roomState:n,addToState:r})}handleRemoteEcho(e,t,n){var r=this._eventIdToTimeline.get(t);r?(this._eventIdToTimeline.delete(t),this._eventIdToTimeline.set(n,r)):(!this.filter||this.filter.filterRoomTimeline([e]).length)&&this.addEventToTimeline(e,this.liveTimeline,{toStartOfTimeline:!1,addToState:!1})}removeEvent(e){var t=this._eventIdToTimeline.get(e);if(!t)return null;var n=t.removeEvent(e);if(n){this._eventIdToTimeline.delete(e);var r={timeline:t};this.emit(ke.Timeline,n,this.room,void 0,!0,r)}return n}compareEventOrdering(e,t){if(e==t)return 0;var n=this._eventIdToTimeline.get(e),r=this._eventIdToTimeline.get(t);if(void 0===n||void 0===r)return null;if(n===r){for(var i=void 0,o=void 0,s=n.getEvents(),a=0;a<s.length&&(void 0===i||void 0===o);a++){var l=s[a].getId();l==e&&(i=a),l==t&&(o=a)}var c=i-o;return c<0?-1:c>0?1:0}for(var u=n;u;){if(u===r)return-1;u=u.getNeighbouringTimeline(Le.FORWARDS)}for(u=n;u;){if(u===r)return 1;u=u.getNeighbouringTimeline(Le.BACKWARDS)}return null}canContain(e){if(!this.room)throw new Error("Cannot call `EventTimelineSet::canContain without a `room` set. Set the room when creating the EventTimelineSet to call this method.");var t,{threadId:n,shouldLiveInRoom:r,shouldLiveInThread:i}=this.room.eventShouldLiveIn(e);if(this.thread)return this.thread.id===n;r||i||A.warn("EventTimelineSet:canContain event encountered which cannot be added to any timeline roomId=".concat(null===(t=this.room)||void 0===t?void 0:t.roomId," eventId=").concat(e.getId()," threadId=").concat(e.threadRootId));return r}}var et=function(e){return e.NOT_SENT="not_sent",e.ENCRYPTING="encrypting",e.SENDING="sending",e.QUEUED="queued",e.SENT="sent",e.CANCELLED="cancelled",e}({});class A${constructor(e,t){this.roomId=e}}class N${constructor(e){this.target=e,L(this,"reEmitters",new WeakMap)}reEmit(e,t){var n=this,r=this.reEmitters.get(e);r||(r=new Map,this.reEmitters.set(e,r));var i=function(t){if(r.has(t))return 1;var i=function(){if("error"!==t||0!==n.target.listenerCount("error")){for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];n.target.emit(t,...i,e)}};e.on(t,i),r.set(t,i)};for(var o of t)i(o)}stopReEmitting(e,t){var n=this.reEmitters.get(e);if(n){for(var r of t)e.off(r,n.get(r)),n.delete(r);0===n.size&&this.reEmitters.delete(e)}}}class Mp extends N${constructor(e){super(e)}reEmit(e,t){super.reEmit(e,t)}stopReEmitting(e,t){super.stopReEmitting(e,t)}}var Tv=new EE("unread_thread_notifications","org.matrix.msc3773.unread_thread_notifications");function Mie(e,t){if(t.endsWith("*")){var n=t.slice(0,-1);return e.slice(0,n.length)===n}return e===t}class L5{constructor(e,t){this.filterJson=e,this.userId=t}check(e){var t,n,r=(null===(t=e.getUnsigned())||void 0===t?void 0:t["m.relations"])||{},i=Object.keys(r),o=[];return this.userId&&null!=r&&null!==(n=r[Zt.name])&&void 0!==n&&n.current_user_participated&&o.push(this.userId),this.checkFields(e.getRoomId(),e.getSender(),e.getType(),!!e.getContent()&&void 0!==e.getContent().url,i,o)}toJSON(){return{types:this.filterJson.types||null,not_types:this.filterJson.not_types||[],rooms:this.filterJson.rooms||null,not_rooms:this.filterJson.not_rooms||[],senders:this.filterJson.senders||null,not_senders:this.filterJson.not_senders||[],contains_url:this.filterJson.contains_url||null,[Dh.name]:this.filterJson[Dh.name]||[],[jh.name]:this.filterJson[jh.name]||[]}}checkFields(e,t,n,r,i,o){var s={rooms:function(t){return e===t},senders:function(e){return t===e},types:function(e){return Mie(n,e)}};for(var a in s){var l=s[a],c="not_"+a,u=this.filterJson[c];if(null!=u&&u.some(l))return!1;var d=this.filterJson[a];if(d&&!d.some(l))return!1}var h=this.filterJson.contains_url;if(void 0!==h&&h!==r)return!1;var p=this.filterJson[jh.name];if(void 0!==p&&!this.arrayMatchesFilter(p,i))return!1;var f=this.filterJson[Dh.name];return!(void 0!==f&&!this.arrayMatchesFilter(f,o))}arrayMatchesFilter(e,t){return t.length>0&&e.every((e=>t.includes(e)))}filter(e){return e.filter(this.check,this)}limit(){return void 0!==this.filterJson.limit?this.filterJson.limit:10}}function O5(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function $f(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?O5(Object(n),!0).forEach((function(t){L(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):O5(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function YT(e,t,n){for(var r=t.split("."),i=e,o=0;o<r.length-1;o++)i[r[o]]||(i[r[o]]={}),i=i[r[o]];i[r[r.length-1]]=n}class Hi{static fromJson(e,t,n){var r=new Hi(e,t);return r.setDefinition(n),r}constructor(e,t){this.userId=e,this.filterId=t,L(this,"definition",{}),L(this,"roomFilter",void 0),L(this,"roomTimelineFilter",void 0)}getFilterId(){return this.filterId}getDefinition(){return this.definition}setDefinition(e){this.definition=e;var t=e.room,n={};t&&(t.rooms&&(n.rooms=t.rooms),t.rooms&&(n.not_rooms=t.not_rooms)),this.roomFilter=new L5(n,this.userId),this.roomTimelineFilter=new L5((null==t?void 0:t.timeline)||{},this.userId)}getRoomTimelineFilterComponent(){return this.roomTimelineFilter}filterRoomTimeline(e){return this.roomFilter&&(e=this.roomFilter.filter(e)),this.roomTimelineFilter&&(e=this.roomTimelineFilter.filter(e)),e}setTimelineLimit(e){YT(this.definition,"room.timeline.limit",e)}setUnreadThreadNotifications(e){var t,n;this.definition=$f($f({},this.definition),{},{room:$f($f({},null===(t=this.definition)||void 0===t?void 0:t.room),{},{timeline:$f($f({},null===(n=this.definition)||void 0===n||null===(n=n.room)||void 0===n?void 0:n.timeline),{},{[Tv.name]:e})})})}setLazyLoadMembers(e){YT(this.definition,"room.state.lazy_load_members",e)}setIncludeLeaveRooms(e){YT(this.definition,"room.include_leave",e)}}function Wb(e){return null!=e}L(Hi,"LAZY_LOADING_MESSAGES_FILTER",{lazy_load_members:!0});var Aie=new rs.UnstableValue("m.message","org.matrix.msc1767.message"),AP=new rs.UnstableValue("m.text","org.matrix.msc1767.text"),Nie=new rs.UnstableValue("m.html","org.matrix.msc1767.html"),D$=new rs.NamespacedValue("m.reference");function Die(e,t){if("string"==typeof e)return"string"==typeof t?t===e:t.matches(e);if("string"==typeof t)return e.matches(t);var n=t,r=e;return n.matches(r.name)||Wb(r.altName)&&n.matches(r.altName)}var NP=new Kn("m.topic","org.matrix.msc3765.topic");function M5(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function jie(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?M5(Object(n),!0).forEach((function(t){L(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):M5(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function j$(e,t){return{msgtype:Pa.Text,format:"org.matrix.custom.html",body:e,formatted_body:t}}function U$(e,t){return{msgtype:Pa.Notice,format:"org.matrix.custom.html",body:e,formatted_body:t}}function F$(e,t){return{msgtype:Pa.Emote,format:"org.matrix.custom.html",body:e,formatted_body:t}}function $$(e){return{msgtype:Pa.Text,body:e}}function H$(e){return{msgtype:Pa.Notice,body:e}}function B$(e){return{msgtype:Pa.Emote,body:e}}var V$=(e,t,n,r)=>{var i="at ".concat(new Date(n).toISOString());return[t===ip.Self?"User":void 0,"Location",r?'"'.concat(r,'"'):void 0,e,i].filter(Boolean).join(" ")},q$=(e,t,n,r,i)=>{var o=e??V$(t,i||ip.Self,n,r),s=n?{[Eu.name]:n}:{};return jie({msgtype:Pa.Location,body:o,geo_uri:t,[Sy.name]:{description:r,uri:t},[by.name]:{type:i||ip.Self},[AP.name]:o},s)},Uie=e=>{var t,n,r=Sy.findIn(e),i=by.findIn(e),o=Eu.findIn(e),s=AP.findIn(e),a=null!==(t=null==r?void 0:r.uri)&&void 0!==t?t:null==e?void 0:e.geo_uri,l=null==r?void 0:r.description,c=null!==(n=null==i?void 0:i.type)&&void 0!==n?n:ip.Self,u=s??e.body;return q$(u,a,o??void 0,l,c)},K$=(e,t)=>{var n=[];return Wb(e)&&n.push({body:e,mimetype:"text/plain"}),Wb(t)&&n.push({body:t,mimetype:"text/html"}),{topic:e,[NP.name]:n}},Fie=e=>{var t,n,r,i,o,s=NP.findIn(e);return Array.isArray(s)?{text:null!==(t=null!==(n=null==s||null===(r=s.find((e=>!Wb(e.mimetype)||"text/plain"===e.mimetype)))||void 0===r?void 0:r.body)&&void 0!==n?n:e.topic)&&void 0!==t?t:void 0,html:null==s||null===(i=s.find((e=>"text/html"===e.mimetype)))||void 0===i?void 0:i.body}:{text:null!==(o=e.topic)&&void 0!==o?o:void 0}},$ie=(e,t,n,r,i)=>({description:n,timeout:e,live:t,[Eu.name]:i||Date.now(),[by.name]:{type:r??ip.Self}}),G$=e=>{var t,{description:n,timeout:r,live:i}=e,o=null!==(t=Eu.findIn(e))&&void 0!==t?t:void 0,s=by.findIn(e);return{description:n,timeout:r,live:i,assetType:null==s?void 0:s.type,timestamp:o}},Hie=(e,t,n,r)=>({[Sy.name]:{description:r,uri:e},[Eu.name]:t,"m.relates_to":{rel_type:D$.name,event_id:n}}),ak=e=>{var t,n=Sy.findIn(e),r=null!==(t=Eu.findIn(e))&&void 0!==t?t:void 0;return{description:null==n?void 0:n.description,uri:null==n?void 0:n.uri,timestamp:r}};const Bie=Object.freeze(Object.defineProperty({__proto__:null,getTextForLocationEvent:V$,makeBeaconContent:Hie,makeBeaconInfoContent:$ie,makeEmoteMessage:B$,makeHtmlEmote:F$,makeHtmlMessage:j$,makeHtmlNotice:U$,makeLocationContent:q$,makeNotice:H$,makeTextMessage:$$,makeTopicContent:K$,parseBeaconContent:ak,parseBeaconInfoContent:G$,parseLocationEvent:Uie,parseTopicContent:Fie},Symbol.toStringTag,{value:"Module"}));var yn=function(e){return e.New="Beacon.new",e.Update="Beacon.update",e.LivenessChange="Beacon.LivenessChange",e.Destroy="Beacon.Destroy",e.LocationUpdate="Beacon.LocationUpdate",e}({}),lk=(e,t,n)=>n>=e&&e+t>=n,zb=e=>"".concat(e.getRoomId(),"_").concat(e.getStateKey());class W$ extends En{constructor(e){super(),this.rootEvent=e,L(this,"roomId",void 0),L(this,"_beaconInfo",void 0),L(this,"_isLive",void 0),L(this,"livenessWatchTimeout",void 0),L(this,"_latestLocationEvent",void 0),L(this,"clearLatestLocation",(()=>{this._latestLocationEvent=void 0,this.emit(yn.LocationUpdate,this.latestLocationState)})),this.roomId=this.rootEvent.getRoomId(),this.setBeaconInfo(this.rootEvent)}get isLive(){return!!this._isLive}get identifier(){return zb(this.rootEvent)}get beaconInfoId(){return this.rootEvent.getId()}get beaconInfoOwner(){return this.rootEvent.getStateKey()}get beaconInfoEventType(){return this.rootEvent.getType()}get beaconInfo(){return this._beaconInfo}get latestLocationState(){return this._latestLocationEvent&&ak(this._latestLocationEvent.getContent())}get latestLocationEvent(){return this._latestLocationEvent}update(e){if(zb(e)!==this.identifier)throw new Error("Invalid updating event");e.getTs()<this.rootEvent.getTs()||(this.rootEvent=e,this.setBeaconInfo(this.rootEvent),this.emit(yn.Update,e,this),this.clearLatestLocation())}destroy(){this.livenessWatchTimeout&&clearTimeout(this.livenessWatchTimeout),this._isLive=!1,this.emit(yn.Destroy,this.identifier)}monitorLiveness(){if(this.livenessWatchTimeout&&clearTimeout(this.livenessWatchTimeout),this.checkLiveness(),this.beaconInfo)if(this.isLive){var e=this.beaconInfo.timestamp+this.beaconInfo.timeout-Date.now();e>1&&(this.livenessWatchTimeout=setTimeout((()=>{this.monitorLiveness()}),e))}else this.beaconInfo.timestamp>Date.now()&&(this.livenessWatchTimeout=setTimeout((()=>{this.monitorLiveness()}),this.beaconInfo.timestamp-Date.now()))}addLocations(e){var t;if(this.isLive){var n=null===(t=e.filter((e=>{var t=e.getContent(),n=ak(t);if(!n.uri||!n.timestamp)return!1;var{timestamp:r}=n;return this._beaconInfo.timestamp&&lk(this._beaconInfo.timestamp,this._beaconInfo.timeout,r)&&(!this.latestLocationState||r>this.latestLocationState.timestamp)})).sort(lie))||void 0===t?void 0:t[0];n&&(this._latestLocationEvent=n,this.emit(yn.LocationUpdate,this.latestLocationState))}}setBeaconInfo(e){this._beaconInfo=G$(e.getContent()),this.checkLiveness()}checkLiveness(){var e=this.isLive;if(this.beaconInfo){var t=this.beaconInfo.timestamp>Date.now()?this.beaconInfo.timestamp-36e4:this.beaconInfo.timestamp;this._isLive=!!this._beaconInfo.live&&!!t&&lk(t,this._beaconInfo.timeout,Date.now()),e!==this.isLive&&this.emit(yn.LivenessChange,this.isLive,this)}}}function A5(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Vie(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?A5(Object(n),!0).forEach((function(t){L(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):A5(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function z$(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return new Ci({content:{[t.getId()]:{[n]:{[e]:Vie({ts:t.getTs()},!r&&{thread_id:up(t)})}}},type:ee.Receipt,room_id:t.getRoomId()})}var Hf=0,Bf=1;class Y$ extends En{constructor(){super(...arguments),L(this,"receipts",new Sl((()=>new Map))),L(this,"receiptCacheByEventId",new Map)}getReadReceiptForUserId(e){var t,n,r=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:yi.Read,[o,s]=null!==(t=null===(n=this.receipts.get(i))||void 0===n?void 0:n.get(e))&&void 0!==t?t:[null,null];return r?o:s??o}compareReceipts(e,t){var n;return null!==(n=this.getUnfilteredTimelineSet().compareEventOrdering(e.eventId,t.eventId))&&void 0!==n?n:e.data.ts-t.data.ts}getEventReadUpTo(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=this.getLatestReceipt(e,t);return n&&this.receiptPointsAtConsistentEvent(n)?n.eventId:null}receiptPointsAtConsistentEvent(e){var t,n=this.findEventById(e.eventId);if(!n)return!1;if(null===(t=e.data)||void 0===t||!t.thread_id)return!0;if(e.data.thread_id===Ey){if(Pv(n))return!0}else if(n.threadRootId===e.data.thread_id)return!0;return A.warn("Ignoring receipt because its thread_id (".concat(e.data.thread_id,") disagrees ")+"with the thread root (".concat(n.threadRootId,") of the referenced event ")+"(event ID = ".concat(e.eventId,")")),!1}getLatestReceipt(e,t){var n,r,i,o=this.getReadReceiptForUserId(e,t,yi.Read),s=this.getReadReceiptForUserId(e,t,yi.ReadPrivate);return null!=o&&o.eventId&&null!=s&&s.eventId&&(i=this.compareReceipts(o,s)),i?null!==(r=i<0?s:o)&&void 0!==r?r:null:null!==(n=s??o)&&void 0!==n?n:null}addReceiptToStructure(e,t,n,r,i){var o,s,a=this.receipts.getOrCreate(t),l=a.get(n);l||(l=[null,null],a.set(n,l));var c,u=l[Hf];i&&(u=null!==(c=l[Bf])&&void 0!==c?c:l[Hf]);var d={eventId:e,data:r};if(u&&this.compareReceipts(u,d)>=0)return;var h=i?l[Hf]:d,p=i?d:l[Bf],f=null;h&&p&&(f=this.getUnfilteredTimelineSet().compareEventOrdering(h.eventId,p.eventId));var m=null===f||f<0,v=null!==(o=l[Bf])&&void 0!==o?o:l[Hf];if(i&&m?l[Bf]=d:i||(l[Hf]=d,m||(l[Bf]=null)),v!==(null!==(s=l[Bf])&&void 0!==s?s:l[Hf])){if(v&&this.receiptCacheByEventId.get(v.eventId)){var g=v.eventId;this.receiptCacheByEventId.set(g,this.receiptCacheByEventId.get(g).filter((e=>e.type!==t||e.userId!==n))),this.receiptCacheByEventId.get(g).length<1&&this.receiptCacheByEventId.delete(g)}this.receiptCacheByEventId.get(e)||this.receiptCacheByEventId.set(e,[]),this.receiptCacheByEventId.get(e).push({userId:n,type:t,data:r})}}getReceiptsForEvent(e){return this.receiptCacheByEventId.get(e.getId())||[]}fixupNotifications(e){var t=this.getReadReceiptForUserId(e,!1),n=this.timeline[this.timeline.length-1];n&&(null==t?void 0:t.eventId)===n.getId()&&e===n.getSender()&&(this.setUnread(jt.Total,0),this.setUnread(jt.Highlight,0))}addLocalEchoReceipt(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this.addReceipt(z$(e,t,n,r),!0)}getUsersReadUpTo(e){return this.getReceiptsForEvent(e).filter((function(e){return kP(e.type)})).map((function(e){return e.userId}))}}var qie=new rs.UnstableValue("m.poll.disclosed","org.matrix.msc3381.poll.disclosed"),Kie=new rs.UnstableValue("m.poll.undisclosed","org.matrix.msc3381.poll.undisclosed"),Gie=new rs.UnstableValue("m.poll.start","org.matrix.msc3381.poll.start"),Rv=new rs.UnstableValue("m.poll.response","org.matrix.msc3381.poll.response"),Yb=new rs.UnstableValue("m.poll.end","org.matrix.msc3381.poll.end"),Oc=function(e){return e.New="Poll.new",e.End="Poll.end",e.Update="Poll.update",e.Responses="Poll.Responses",e.Destroy="Poll.Destroy",e.UndecryptableRelations="Poll.UndecryptableRelations",e}({}),N5=(e,t)=>({responseEvents:e.filter((e=>{if(!e.isDecryptionFailure())return Rv.matches(e.getType())&&e.getTs()<=t}))});class J$ extends En{constructor(e,t,n){if(super(),this.rootEvent=e,this.matrixClient=t,this.room=n,L(this,"roomId",void 0),L(this,"pollEvent",void 0),L(this,"_isFetchingResponses",!1),L(this,"relationsNextBatch",void 0),L(this,"responses",null),L(this,"endEvent",void 0),L(this,"undecryptableRelationEventIds",new Set),L(this,"countUndecryptableEvents",(e=>{var t=e.filter((e=>e.isDecryptionFailure())).map((e=>e.getId())),n=this.undecryptableRelationsCount;this.undecryptableRelationEventIds=new Set([...this.undecryptableRelationEventIds,...t]),this.undecryptableRelationsCount!==n&&this.emit(Oc.UndecryptableRelations,this.undecryptableRelationsCount)})),!this.rootEvent.getRoomId()||!this.rootEvent.getId())throw new Error("Invalid poll start event.");this.roomId=this.rootEvent.getRoomId(),this.pollEvent=this.rootEvent.unstableExtensibleEvent}get pollId(){return this.rootEvent.getId()}get endEventId(){var e;return null===(e=this.endEvent)||void 0===e?void 0:e.getId()}get isEnded(){return!!this.endEvent}get isFetchingResponses(){return this._isFetchingResponses}get undecryptableRelationsCount(){return this.undecryptableRelationEventIds.size}getResponses(){var e=this;return U((function*(){return e.responses||e.isFetchingResponses||(yield e.fetchResponses()),e.responses}))()}onNewRelation(e){var t;if(Yb.matches(e.getType())&&this.validateEndEvent(e)&&(this.endEvent=e,this.refilterResponsesOnEnd(),this.emit(Oc.End)),this.responses){var n=(null===(t=this.endEvent)||void 0===t?void 0:t.getTs())||Number.MAX_SAFE_INTEGER,{responseEvents:r}=N5([e],n);this.countUndecryptableEvents([e]),r.length&&(r.forEach((e=>{this.responses.addEvent(e)})),this.emit(Oc.Responses,this.responses))}}fetchResponses(){var e=this;return U((function*(){var t,n;e._isFetchingResponses=!0;var r=yield e.matrixClient.relations(e.roomId,e.rootEvent.getId(),"m.reference",void 0,{from:e.relationsNextBatch||void 0});yield Promise.all(r.events.map((t=>e.matrixClient.decryptEventIfNeeded(t))));var i=e.responses||new MP("m.reference",Rv.name,e.matrixClient,[Rv.altName]),o=r.events.find((e=>Yb.matches(e.getType())));e.validateEndEvent(o)&&(e.endEvent=o,e.refilterResponsesOnEnd(),e.emit(Oc.End));var s=(null===(t=e.endEvent)||void 0===t?void 0:t.getTs())||Number.MAX_SAFE_INTEGER,{responseEvents:a}=N5(r.events,s);a.forEach((e=>{i.addEvent(e)})),e.relationsNextBatch=null!==(n=r.nextBatch)&&void 0!==n?n:void 0,e.responses=i,e.countUndecryptableEvents(r.events),e.relationsNextBatch?e.fetchResponses():e._isFetchingResponses=!1,e.emit(Oc.Responses,e.responses)}))()}refilterResponsesOnEnd(){var e;if(this.responses){var t=(null===(e=this.endEvent)||void 0===e?void 0:e.getTs())||Number.MAX_SAFE_INTEGER;this.responses.getRelations().forEach((e=>{var n;e.getTs()>t&&(null===(n=this.responses)||void 0===n||n.removeEvent(e))})),this.emit(Oc.Responses,this.responses)}}validateEndEvent(e){if(!e||this.endEvent&&this.endEvent.getTs()<e.getTs())return!1;var t=this.room.currentState,n=e.getSender();return!!n&&(n===this.rootEvent.getSender()||t.maySendRedactionForEvent(this.rootEvent,n))}}var X$=e=>{var t=e.getType();return rs.M_POLL_START.matches(t)||Rv.matches(t)||Yb.matches(t)};class Wie{constructor(e){L(this,"room",void 0),L(this,"threadedReceipts",void 0),L(this,"unthreadedReceipts",void 0),L(this,"danglingReceipts",void 0),L(this,"onTimelineEvent",(e=>{var t=e.getId();if(t){var n=this.danglingReceipts.remove(t);null==n||n.forEach((e=>{e.receipt.thread_id?this.threadedReceipts.set(e.receipt.thread_id,e.eventId,e.receiptType,e.userId,e.receipt.ts,e.synthetic):this.unthreadedReceipts.set(t,e.receiptType,e.userId,e.receipt.ts,e.synthetic)}))}})),this.room=e,this.threadedReceipts=new Xie(e),this.unthreadedReceipts=new Z$(e),this.danglingReceipts=new Zie,e.on(ke.Timeline,this.onTimelineEvent)}add(e,t){for(var[n,r]of Object.entries(e))for(var[i,o]of Object.entries(r))for(var[s,a]of Object.entries(o)){this.room.findEventById(n)?a.thread_id?this.threadedReceipts.set(a.thread_id,n,i,s,a.ts,t):this.unthreadedReceipts.set(n,i,s,a.ts,t):this.danglingReceipts.add(new Yie(n,i,s,a,t))}}hasUserReadEvent(e,t){var n=this.unthreadedReceipts.get(e);if(n&&ck(n.eventId,t,this.room))return!0;var r=this.room.findEventById(t);if(!r)return A.warn("hasUserReadEvent event ID ".concat(t," not found in room ").concat(this.room.roomId,": this shouldn't happen!")),!1;var i=up(r),o=this.threadedReceipts.get(i,e);return!!(o&&ck(o.eventId,t,this.room)||this.userSentLatestEventInThread(i,e))}userSentLatestEventInThread(e,t){var n,r=e===Ey?this.room.getLiveTimeline().getEvents():null===(n=this.room.getThread(e))||void 0===n?void 0:n.timeline;return!!(r&&r.length>0&&r[r.length-1].getSender()===t)}}class zie{constructor(e,t,n){this.eventId=e,this.receiptType=t,this.ts=n}}class Yie{constructor(e,t,n,r,i){this.eventId=e,this.receiptType=t,this.userId=n,this.receipt=r,this.synthetic=i}}class Jie{constructor(e){L(this,"room",void 0),L(this,"real",void 0),L(this,"synthetic",void 0),this.room=e,this.real=void 0,this.synthetic=void 0}set(e,t){e?this.synthetic=t:this.real=t,this.synthetic&&this.real&&ck(this.real.eventId,this.synthetic.eventId,this.room)&&(this.synthetic=void 0)}get(){var e;return null!==(e=this.synthetic)&&void 0!==e?e:this.real}getByType(e){return e?this.synthetic:this.real}}class Z${constructor(e){L(this,"room",void 0),L(this,"data",void 0),this.room=e,this.data=new Map}set(e,t,n,r,i){var o=DP(this.data,n,(()=>new Jie(this.room))),s=o.getByType(i);s&&Qie(s.eventId,e,this.room)||o.set(i,new zie(e,t,r))}get(e){var t;return null===(t=this.data.get(e))||void 0===t?void 0:t.get()}}class Xie{constructor(e){L(this,"room",void 0),L(this,"data",void 0),this.room=e,this.data=new Map}set(e,t,n,r,i,o){DP(this.data,e,(()=>new Z$(this.room))).set(t,n,r,i,o)}get(e,t){var n;return null===(n=this.data.get(e))||void 0===n?void 0:n.get(t)}}class Zie{constructor(){L(this,"data",new Map)}add(e){DP(this.data,e.eventId,(()=>[])).push(e)}remove(e){var t=this.data.get(e);return this.data.delete(e),t}}function DP(e,t,n){var r=e.get(t);if(r)return r;var i=n();return e.set(t,i),i}function ck(e,t,n){var r=n.compareEventOrdering(e,t);return null!==r&&r>=0}function Qie(e,t,n){var r=n.compareEventOrdering(e,t);return null!==r&&r>0}function ese(e,t,n){var r=e.findEventById(t),i=e.findEventById(n);if(!r||!i)return null;var o=Pv(r),s=Pv(i);return o&&s?tse(e,t,n,r,i):nse(t,n,r,i)}function tse(e,t,n,r,i){var o=e.getUnfilteredTimelineSet(),s=o.compareEventOrdering(t,n);return null!==s?s:o.getTimelineForEvent(t)===o.getLiveTimeline()?1:o.getTimelineForEvent(n)===o.getLiveTimeline()?-1:Q$(r,i)}function nse(e,t,n,r){var i=up(n),o=up(r),s=n.getThread();return s&&i===o?s.timelineSet.compareEventOrdering(e,t):Q$(n,r)}function Q$(e,t){var n=e.getTs(),r=t.getTs();return n<r?-1:n>r?1:0}var ae=function(e){return e.Get="GET",e.Put="PUT",e.Post="POST",e.Delete="DELETE",e.Options="OPTIONS",e.Head="HEAD",e.Patch="PATCH",e}({});function D5(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function rse(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?D5(Object(n),!0).forEach((function(t){L(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):D5(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}class lu extends Error{constructor(e,t,n){super(e),this.httpStatus=t,this.httpHeaders=n}isRateLimitError(){return 429===this.httpStatus}getRetryAfterMs(){var e,t=null===(e=this.httpHeaders)||void 0===e?void 0:e.get("Retry-After");if(null!=t){if(/^\d+$/.test(t)){var n=1e3*Number.parseInt(t);if(!Number.isFinite(n))throw new Error("Retry-After header integer value is too large");return n}var r=new Date(t);if(r.toUTCString()!==t)throw new Error("Retry-After header value is not a valid HTTP-date or non-negative decimal integer");return r.getTime()-Date.now()}return null}}class bn extends lu{constructor(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0,n=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0,i=arguments.length>4?arguments[4]:void 0,o=e.error||"Unknown message";t&&(o="[".concat(t,"] ").concat(o)),n&&(o="".concat(o," (").concat(n,")")),super("MatrixError: ".concat(o),t,i),this.url=n,this.event=r,L(this,"errcode",void 0),L(this,"data",void 0),this.errcode=e.errcode,this.name=e.errcode||"Unknown error code",this.data=e}isRateLimitError(){return"M_LIMIT_EXCEEDED"===this.errcode||("M_UNKNOWN"===this.errcode||void 0===this.errcode)&&super.isRateLimitError()}getRetryAfterMs(){var e=super.getRetryAfterMs();if(null!==e)return e;if("M_LIMIT_EXCEEDED"===this.errcode&&"retry_after_ms"in this.data){if(!Number.isInteger(this.data.retry_after_ms))throw new Error("retry_after_ms is not an integer");return this.data.retry_after_ms}return null}asWidgetApiErrorData(){var e,t,n,r,i={};if(this.httpHeaders)for(var[o,s]of this.httpHeaders)i[o]=s;return{http_status:null!==(e=this.httpStatus)&&void 0!==e?e:400,http_headers:i,url:null!==(t=this.url)&&void 0!==t?t:"",response:rse({errcode:null!==(n=this.errcode)&&void 0!==n?n:"M_UNKNOWN",error:null!==(r=this.data.error)&&void 0!==r?r:"Unknown message"},this.data)}}static fromWidgetApiErrorData(e){return new bn(e.response,e.http_status,e.url,void 0,new Headers(e.http_headers))}}function jP(e,t){if(!(e instanceof lu&&e.isRateLimitError()))return t;try{var n;return null!==(n=e.getRetryAfterMs())&&void 0!==n?n:t}catch{return t}}let Jd=class extends Error{constructor(e,t){super(e+(t?": ".concat(t.message):""))}get name(){return"ConnectionError"}};class eH extends Error{constructor(e){var t;super(null!==(t=null==e?void 0:e.message)&&void 0!==t?t:"")}get name(){return"TokenRefreshError"}}class UP extends Error{constructor(e){var t;super(null!==(t=null==e?void 0:e.message)&&void 0!==t?t:"")}get name(){return"TokenRefreshLogoutError"}}var j5,uk=function(e){return e.SessionLoggedOut="Session.logged_out",e.NoConsent="no_consent",e}({}),b1={};function ise(){if(j5)return b1;j5=1;var e=/; *([!#$%&'*+.^_`|~0-9A-Za-z-]+) *= *("(?:[\u000b\u0020\u0021\u0023-\u005b\u005d-\u007e\u0080-\u00ff]|\\[\u000b\u0020-\u00ff])*"|[!#$%&'*+.^_`|~0-9A-Za-z-]+) */g,t=/^[\u000b\u0020-\u007e\u0080-\u00ff]+$/,n=/^[!#$%&'*+.^_`|~0-9A-Za-z-]+$/,r=/\\([\u000b\u0020-\u00ff])/g,i=/([\\"])/g,o=/^[!#$%&'*+.^_`|~0-9A-Za-z-]+\/[!#$%&'*+.^_`|~0-9A-Za-z-]+$/;function s(e){var r=String(e);if(n.test(r))return r;if(r.length>0&&!t.test(r))throw new TypeError("invalid parameter value");return'"'+r.replace(i,"\\$1")+'"'}function a(e){this.parameters=Object.create(null),this.type=e}return b1.format=function(e){if(!e||"object"!=typeof e)throw new TypeError("argument obj is required");var t=e.parameters,r=e.type;if(!r||!o.test(r))throw new TypeError("invalid type");var i=r;if(t&&"object"==typeof t)for(var a,l=Object.keys(t).sort(),c=0;c<l.length;c++){if(a=l[c],!n.test(a))throw new TypeError("invalid parameter name");i+="; "+a+"="+s(t[a])}return i},b1.parse=function(t){if(!t)throw new TypeError("argument string is required");var n="object"==typeof t?function(e){var t;if("function"==typeof e.getHeader?t=e.getHeader("content-type"):"object"==typeof e.headers&&(t=e.headers&&e.headers["content-type"]),"string"!=typeof t)throw new TypeError("content-type header is missing from object");return t}(t):t;if("string"!=typeof n)throw new TypeError("argument string is required to be a string");var i=n.indexOf(";"),s=-1!==i?n.slice(0,i).trim():n.trim();if(!o.test(s))throw new TypeError("invalid media type");var l=new a(s.toLowerCase());if(-1!==i){var c,u,d;for(e.lastIndex=i;u=e.exec(n);){if(u.index!==i)throw new TypeError("invalid parameter format");i+=u[0].length,c=u[1].toLowerCase(),34===(d=u[2]).charCodeAt(0)&&(-1!==(d=d.slice(1,-1)).indexOf("\\")&&(d=d.replace(r,"$1"))),l.parameters[c]=d}if(i!==n.length)throw new TypeError("invalid parameter format")}return l},b1}var nH,rH,sse=ise();function kE(e){var t=new AbortController;return setTimeout((()=>{t.abort()}),e),t.signal}function tH(e){var t=new AbortController;function n(){for(var t of e)t.removeEventListener("abort",r)}function r(){t.abort(),n()}for(var i of e){if(i.aborted){r();break}i.addEventListener("abort",r)}return{signal:t.signal,cleanup:n}}function FP(e,t){var n,r,i,o=U5(e)?new Headers(e.getAllResponseHeaders().trim().split(/[\r\n]+/).map((e=>{var t=e.indexOf(":");return[e.substring(0,t),e.substring(t+1)]}))):e.headers;try{i=ose(o)}catch(e){return e}return"application/json"===(null===(n=i)||void 0===n?void 0:n.type)&&t?new bn(JSON.parse(t),e.status,U5(e)?e.responseURL:e.url,void 0,o):"text/plain"===(null===(r=i)||void 0===r?void 0:r.type)?new lu("Server returned ".concat(e.status," error: ").concat(t),e.status,o):new lu("Server returned ".concat(e.status," error"),e.status,o)}function U5(e){return"getResponseHeader"in e}function ose(e){var t=e.get("Content-Type");if(null===t)return null;try{return sse.parse(t)}catch(e){throw new Error("Error parsing Content-Type '".concat(t,"': ").concat(e))}}function dk(e,t){return fk.apply(this,arguments)}function fk(){return(fk=U((function*(e,t){for(var n=0,r=null;n<e;)try{if(n>0){var i=1e3*Math.pow(2,n);A.log("network operation failed ".concat(n," times, retrying in ").concat(i,"ms...")),yield su(i)}return yield t()}catch(e){if(!(e instanceof Jd))throw e;n+=1,r=e}throw r}))).apply(this,arguments)}function $P(e,t,n){return t>4||e instanceof Jd&&!n||e.httpStatus&&4===Math.floor(e.httpStatus/100)&&429!==e.httpStatus||"AbortError"===e.name||"M_TOO_LARGE"===e.name?-1:jP(e,1e3*Math.pow(2,t))}function ase(e){var t;function n(){return n=U((function*(){if(t)return t;try{for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return t=e.call(this,...r),yield t,t}finally{t=void 0}})),n.apply(this,arguments)}return function(){return n.apply(this,arguments)}}function F5(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function JT(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?F5(Object(n),!0).forEach((function(t){L(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):F5(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function lse(e,t,n,r,i,o){var s,a,l,c,u,d,h,p=Symbol.metadata||Symbol.for("Symbol.metadata"),f=Object.defineProperty,m=Object.create,v=[m(null),m(null)],g=t.length;function y(t,n,r){return function(i,o){n&&(o=i,i=e);for(var s=0;s<t.length;s++)o=t[s].apply(i,r?[o]:[]);return r?o:i}}function b(e,t,n,r){if("function"!=typeof e&&(r||void 0!==e))throw new TypeError(t+" must "+(n||"be")+" a function"+(r?"":" or undefined"));return e}function _(e,t,n,r,i,o,l,c,u,d,h){function p(e){if(!h(e))throw new TypeError("Attempted to access private element on non-instance")}var m=[].concat(t[0]),g=t[3],_=!l,w=1===i,E=3===i,S=4===i,C=2===i;function k(t,n,r){return function(i,o){return n&&(o=i,i=e),r&&r(i),T[t].call(i,o)}}if(!_){var T={},I=[],R=E?"get":S||w?"set":"value";if(u?(d||w?T={get:$5((function(){return g(this)}),r,"get"),set:function(e){t[4](this,e)}}:T[R]=g,d||$5(T[R],r,C?"":R)):d||(T=Object.getOwnPropertyDescriptor(e,r)),!d&&!u){if((a=v[+c][r])&&7!=(a^i))throw Error("Decorating two elements with the same name ("+T[R].name+") is not supported yet");v[+c][r]=i<3?1:i}}for(var x=e,L=m.length-1;L>=0;L-=n?2:1){var P=b(m[L],"A decorator","be",!0),O=n?m[L-1]:void 0,A={},M={kind:["field","accessor","method","getter","setter","class"][i],name:r,metadata:s,addInitializer:function(e,t){if(e.v)throw new TypeError("attempted to call addInitializer after decoration was finished");b(t,"An initializer","be",!0),o.push(t)}.bind(null,A)};if(_)a=P.call(O,x,M),A.v=1,b(a,"class decorators","return")&&(x=a);else if(M.static=c,M.private=u,a=M.access={has:u?h.bind():function(e){return r in e}},S||(a.get=u?C?function(e){return p(e),T.value}:k("get",0,p):function(e){return e[r]}),C||E||(a.set=u?k("set",0,p):function(e,t){e[r]=t}),x=P.call(O,w?{get:T.get,set:T.set}:T[R],M),A.v=1,w){if("object"==typeof x&&x)(a=b(x.get,"accessor.get"))&&(T.get=a),(a=b(x.set,"accessor.set"))&&(T.set=a),(a=b(x.init,"accessor.init"))&&I.unshift(a);else if(void 0!==x)throw new TypeError("accessor decorators must return an object with get, set, or init properties or undefined")}else b(x,(d?"field":"method")+" decorators","return")&&(d?I.unshift(x):T[R]=x)}return i<2&&l.push(y(I,c,1),y(o,c,0)),d||_||(u?w?l.splice(-1,0,k("get",c),k("set",c)):l.push(C?T[R]:b.call.bind(T[R])):f(e,r,T)),x}function w(e){return f(e,p,{configurable:!0,enumerable:!0,value:s})}return s=m(s??null),u=[],d=function(e){e&&u.push(y(e))},(h=function(t,r){for(var o=0;o<n.length;o++){var s=n[o],a=s[1],d=7&a;if((8&a)==t&&!d==r){var h=s[2],p=!!s[3],f=16&a;_(t?e:e.prototype,s,f,p?"#"+h:cse(h),d,d<2?[]:t?c=c||[]:l=l||[],u,!!t,p,r,t&&p?function(t){return dse(t)===e}:i)}}})(8,0),h(0,0),h(8,1),h(0,1),d(l),d(c),a=u,g||w(e),{e:a,get c(){var n=[];return g&&[w(e=_(e,[t],r,e.name,5,n)),y(n,1)]}}}function cse(e){var t=use(e,"string");return"symbol"==typeof t?t:t+""}function use(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t);if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}function $5(e,t,n){"symbol"==typeof t&&(t=(t=t.description)?"["+t+"]":"");try{Object.defineProperty(e,"name",{configurable:!0,value:n?n+" "+t:t})}catch{}return e}function dse(e){if(Object(e)!==e)throw TypeError("right-hand side of 'in' should be an object, got "+(null!==e?typeof e:"null"));return e}var id=function(e){return e.Success="success",e.Failure="failure",e.Logout="logout",e}(id||{});class iH{constructor(e,t){var n;this.eventEmitter=e,this.opts=t,L(this,"abortController",(rH(this),new AbortController)),L(this,"tokenRefreshPromise",void 0),f$(t,["baseUrl","prefix"]),t.onlyData=!!t.onlyData,t.useAuthorizationHeader=null===(n=t.useAuthorizationHeader)||void 0===n||n}abort(){this.abortController.abort(),this.abortController=new AbortController}fetch(e,t){return this.opts.fetchFn?this.opts.fetchFn(e,t):globalThis.fetch(e,t)}setIdBaseUrl(e){this.opts.idBaseUrl=e}idServerRequest(e,t,n,r,i){if(!this.opts.idBaseUrl)throw new Error("No identity server base URL set");var o=void 0,s=void 0;e===ae.Get?o=n:s=n;var a=this.getUrl(t,o,r,this.opts.idBaseUrl),l={json:!0,headers:{}};return i&&(l.headers.Authorization="Bearer ".concat(i)),this.requestOtherUrl(e,a,s,l)}authedRequest(e,t,n,r){var i=arguments,o=this;return U((function*(){var s=i.length>4&&void 0!==i[4]?i[4]:{};n||(n={});var a=JT({},s);yield o.tokenRefreshPromise;var l=o.opts.accessToken;l&&(o.opts.useAuthorizationHeader?(a.headers||(a.headers={}),a.headers.Authorization||(a.headers.Authorization="Bearer ".concat(l)),n.access_token&&delete n.access_token):n.access_token||(n.access_token=l));try{return yield o.request(e,t,n,r,a)}catch(i){if(!(i instanceof bn))throw i;if("M_UNKNOWN_TOKEN"===i.errcode&&!a.doNotAttemptTokenRefresh){var c=null;if(l===o.opts.accessToken){var u=o.tryRefreshToken();o.tokenRefreshPromise=u,c=yield u}if(c===id.Success||null===c)return o.authedRequest(e,t,n,r,JT(JT({},s),{},{doNotAttemptTokenRefresh:null!==c}));if(c===id.Failure)throw new eH(i)}throw"M_UNKNOWN_TOKEN"!=i.errcode||null!=a&&a.inhibitLogoutEmit?"M_CONSENT_NOT_GIVEN"==i.errcode&&o.eventEmitter.emit(uk.NoConsent,i.message,i.data.consent_uri):o.eventEmitter.emit(uk.SessionLoggedOut,i),i}}))()}tryRefreshToken(){var e=this;return U((function*(){if(!e.opts.refreshToken||!e.opts.tokenRefreshFunction)return id.Logout;try{var{accessToken:t,refreshToken:n}=yield e.opts.tokenRefreshFunction(e.opts.refreshToken);return e.opts.accessToken=t,e.opts.refreshToken=n,id.Success}catch(t){var r;return null===(r=e.opts.logger)||void 0===r||r.warn("Failed to refresh token",t),t instanceof UP||t instanceof bn?id.Logout:id.Failure}}))()}request(e,t,n,r,i){var o=this.getUrl(t,n,null==i?void 0:i.prefix,null==i?void 0:i.baseUrl);return this.requestOtherUrl(e,o,r,i)}requestOtherUrl(e,t,n){var r=arguments,i=this;return U((function*(){var o,s,a,l,c,u=r.length>3&&void 0!==r[3]?r[3]:{},d=i.sanitizeUrlForLogs(t);null===(o=i.opts.logger)||void 0===o||o.debug("FetchHttpApi: --\x3e ".concat(e," ").concat(d));var h=Object.assign({},u.headers||{}),p=null===(s=u.json)||void 0===s||s,f=p&&(null==n||null===(a=n.constructor)||void 0===a?void 0:a.name)===Object.name;p&&(f&&!h["Content-Type"]&&(h["Content-Type"]="application/json"),h.Accept||(h.Accept="application/json"));var m,v=null!==(l=u.localTimeoutMs)&&void 0!==l?l:i.opts.localTimeoutMs,g=null!==(c=u.keepAlive)&&void 0!==c&&c,y=[i.abortController.signal];void 0!==v&&y.push(kE(v)),u.abortSignal&&y.push(u.abortSignal),m=f?JSON.stringify(n):n;var b,{signal:_,cleanup:w}=tH(y),E=Date.now();try{var S;b=yield i.fetch(t,{signal:_,method:e,body:m,headers:h,mode:"cors",redirect:"follow",referrer:"",referrerPolicy:"no-referrer",cache:"no-cache",credentials:"omit",keepalive:g,priority:u.priority}),null===(S=i.opts.logger)||void 0===S||S.debug("FetchHttpApi: <-- ".concat(e," ").concat(d," [").concat(Date.now()-E,"ms ").concat(b.status,"]"))}catch(t){var C;throw null===(C=i.opts.logger)||void 0===C||C.debug("FetchHttpApi: <-- ".concat(e," ").concat(d," [").concat(Date.now()-E,"ms ").concat(t,"]")),"AbortError"===t.name?t:new Jd("fetch failed",t)}finally{w()}if(!b.ok)throw FP(b,yield b.text());return i.opts.onlyData?p?b.json():b.text():b}))()}sanitizeUrlForLogs(e){try{var t;t="string"==typeof e?new URL(e):e;var n=new URLSearchParams;for(var r of t.searchParams.keys())n.append(r,"xxx");var i=n.toString(),o=i?"?".concat(i):"";return t.origin+t.pathname+o}catch{return"??"}}getUrl(e,t,n,r){var i=r??this.opts.baseUrl,o=i.endsWith("/")?i.slice(0,-1):i,s=new URL(o+(n??this.opts.prefix)+e);return t&&JI(t,s.searchParams),s}}nH=iH,[rH]=lse(nH,[],[[ase,2,"tryRefreshToken"]]).e;var XT,fr=function(e){return e.V1="/_matrix/client/v1",e.V3="/_matrix/client/v3",e.Unstable="/_matrix/client/unstable",e}({}),Qa=function(e){return e.V2="/_matrix/identity/v2",e}({}),Lh=function(e){return e.V1="/_matrix/media/v1",e.V3="/_matrix/media/v3",e}({}),fse=1e3,hse=0,yl=[],pse=function(){};function H5(e,t){for(var n=arguments.length,r=new Array(n>2?n-2:0),i=2;i<n;i++)r[i-2]=arguments[i];(t=t||0)<0&&(t=0);var o=Date.now()+t,s=hse++,a={runAt:o,func:e,params:r,key:s},l=gse(yl,(function(e){return e.runAt-o}));return yl.splice(l,0,a),HP(),s}function B5(e){if(0!==yl.length){var t;for(t=0;t<yl.length;t++){if(yl[t].key==e){yl.splice(t,1);break}}0===t&&HP()}}function HP(){XT&&globalThis.clearTimeout(XT);var e=yl[0];if(e){var t=Date.now(),n=Math.min(e.runAt-t,fse);XT=globalThis.setTimeout(mse,n)}}function mse(){for(var e=Date.now(),t=[];;){var n=yl[0];if(!n||n.runAt>e)break;var r=yl.shift();pse("runCallbacks: popping",r.key),t.push(r)}for(var i of(HP(),t))try{i.func.apply(globalThis,i.params)}catch(e){A.error("Uncaught exception in callback function",e)}}function gse(e,t){for(var n=0,r=e.length;n<r;){var i=n+r>>1;t(e[i])>0?r=i:n=i+1}return n}class sH extends iH{constructor(){super(...arguments),L(this,"uploads",[])}uploadContent(e){var t,n,r,i,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},s=null===(t=o.includeFilename)||void 0===t||t,a=null!==(n=o.abortController)&&void 0!==n?n:new AbortController,l=(null!==(r=o.type)&&void 0!==r?r:e.type)||"application/octet-stream",c=null!==(i=o.name)&&void 0!==i?i:e.name,u={loaded:0,total:0,abortController:a},d=ou();if(globalThis.XMLHttpRequest){var h=new globalThis.XMLHttpRequest,p=function(){h.abort(),d.reject(new Error("Timeout"))},f=H5(p,3e4);h.onreadystatechange=function(){if(h.readyState===globalThis.XMLHttpRequest.DONE){B5(f);try{if(0===h.status)throw new DOMException(h.statusText,"AbortError");if(!h.responseText)throw new Error("No response body.");h.status>=400?d.reject(FP(h,h.responseText)):d.resolve(JSON.parse(h.responseText))}catch(e){if("AbortError"===e.name)return void d.reject(e);d.reject(new Jd("request failed",e))}}},h.upload.onprogress=e=>{var t;B5(f),u.loaded=e.loaded,u.total=e.total,f=H5(p,3e4),null===(t=o.progressHandler)||void 0===t||t.call(o,{loaded:e.loaded,total:e.total})};var m=this.getUrl("/upload",void 0,Lh.V3);s&&c&&m.searchParams.set("filename",encodeURIComponent(c)),!this.opts.useAuthorizationHeader&&this.opts.accessToken&&m.searchParams.set("access_token",encodeURIComponent(this.opts.accessToken)),h.open(ae.Post,m.href),this.opts.useAuthorizationHeader&&this.opts.accessToken&&h.setRequestHeader("Authorization","Bearer "+this.opts.accessToken),h.setRequestHeader("Content-Type",l),h.send(e),a.signal.addEventListener("abort",(()=>{h.abort()}))}else{var v={};s&&c&&(v.filename=c);var g={"Content-Type":l};this.authedRequest(ae.Post,"/upload",v,e,{prefix:Lh.V3,headers:g,abortSignal:a.signal}).then((e=>this.opts.onlyData?e:e.json())).then(d.resolve,d.reject)}return u.promise=d.promise.finally((()=>{Hb(this.uploads,(e=>e===u))})),a.signal.addEventListener("abort",(()=>{Hb(this.uploads,(e=>e===u)),d.reject(new DOMException("Aborted","AbortError"))})),this.uploads.push(u),u.promise}cancelUpload(e){var t=this.uploads.find((t=>t.promise===e));return!!t&&(t.abortController.abort(),!0)}getCurrentUploads(){return this.uploads}getContentUri(){return{base:this.opts.baseUrl,path:Lh.V3+"/upload",params:{access_token:this.opts.accessToken}}}}var vse=216e5,yse=3e4,oH=function(e){return e.Stable="stable",e.Unstable="unstable",e}({});class aH{constructor(e){var t=this;this.http=e,L(this,"capabilities",void 0),L(this,"retryTimeout",void 0),L(this,"refreshTimeout",void 0),L(this,"fetchCapabilities",U((function*(){var e=yield t.http.authedRequest(ae.Get,"/capabilities");return t.capabilities=e.capabilities,t.capabilities}))),L(this,"poll",U((function*(){try{yield t.fetchCapabilities(),t.clearTimeouts(),t.refreshTimeout=setTimeout(t.poll,vse),A.debug("Fetched new server capabilities")}catch(n){t.clearTimeouts();var e=Math.floor(yse+5e3*Math.random());t.retryTimeout=setTimeout(t.poll,e),A.warn("Failed to refresh capabilities: retrying in ".concat(e,"ms"),n)}})))}start(){this.poll().then()}stop(){this.clearTimeouts()}getCachedCapabilities(){return this.capabilities}clearTimeouts(){this.refreshTimeout&&(clearInterval(this.refreshTimeout),this.refreshTimeout=void 0),this.retryTimeout&&(clearTimeout(this.retryTimeout),this.retryTimeout=void 0)}}function V5(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function eg(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?V5(Object(n),!0).forEach((function(t){L(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):V5(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var lH="10",_se=["1","2","3","4","5","6","7","8","9","10"],bse=30,jt=function(e){return e.Highlight="highlight",e.Total="total",e}({}),ke=function(e){return e.MyMembership="Room.myMembership",e.Tags="Room.tags",e.AccountData="Room.accountData",e.Receipt="Room.receipt",e.Name="Room.name",e.Redaction="Room.redaction",e.RedactionCancelled="Room.redactionCancelled",e.LocalEchoUpdated="Room.localEchoUpdated",e.Timeline="Room.timeline",e.TimelineReset="Room.timelineReset",e.TimelineRefresh="Room.TimelineRefresh",e.OldStateUpdated="Room.OldStateUpdated",e.CurrentStateUpdated="Room.CurrentStateUpdated",e.HistoryImportedWithinTimeline="Room.historyImportedWithinTimeline",e.UnreadNotifications="Room.UnreadNotifications",e.Summary="Room.Summary",e}({});let xE=class extends Y${constructor(e,t,n){var r,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};super(),r=this,this.roomId=e,this.client=t,this.myUserId=n,this.opts=i,L(this,"reEmitter",void 0),L(this,"txnToEvent",new Map),L(this,"notificationCounts",{}),L(this,"bumpStamp",void 0),L(this,"threadNotifications",new Map),L(this,"cachedThreadReadReceipts",new Map),L(this,"oldestThreadedReceiptTs",1/0),L(this,"unthreadedReceipts",new Map),L(this,"timelineSets",void 0),L(this,"polls",new Map),L(this,"threadsTimelineSets",[]),L(this,"filteredTimelineSets",{}),L(this,"timelineNeedsRefresh",!1),L(this,"pendingEventList",void 0),L(this,"blacklistUnverifiedDevices",void 0),L(this,"selfMembership",void 0),L(this,"heroes",null),L(this,"getTypeWarning",!1),L(this,"getVersionWarning",!1),L(this,"membersPromise",void 0),L(this,"name",void 0),L(this,"normalizedName",void 0),L(this,"tags",{}),L(this,"accountData",new Map),L(this,"summary",null),L(this,"oldState",void 0),L(this,"currentState",void 0),L(this,"relations",void 0),L(this,"threads",new Map),L(this,"visibilityEvents",new Map),L(this,"roomReceipts",new Wie(this)),L(this,"threadTimelineSetsPromise",null),L(this,"threadsReady",!1),L(this,"updateThreadRootEvents",((e,t,n)=>{var r,i;e.length&&(this.updateThreadRootEvent(null===(r=this.threadsTimelineSets)||void 0===r?void 0:r[0],e,t,n),e.hasCurrentUserParticipated&&this.updateThreadRootEvent(null===(i=this.threadsTimelineSets)||void 0===i?void 0:i[1],e,t,n))})),L(this,"updateThreadRootEvent",((e,t,n,r)=>{e&&t.rootEvent&&(r&&e.removeEvent(t.id),dn.hasServerSideSupport?e.addLiveEvent(t.rootEvent,{duplicateStrategy:Vg.Replace,fromCache:!1,roomState:this.currentState,addToState:!1}):e.addEventToTimeline(t.rootEvent,e.getLiveTimeline(),{toStartOfTimeline:n,addToState:!1}))})),L(this,"applyRedaction",(e=>{if(e.isRedaction()){var t=e.event.redacts,n=t?this.findEventById(t):void 0;if(n){var r=n.threadRootId;if(n.makeRedacted(e,this),n.isState()){var i=this.currentState.getStateEvents(n.getType(),n.getStateKey());(null==i?void 0:i.getId())===n.getId()&&this.currentState.setStateEvents([n])}this.emit(ke.Redaction,e,this,r),this.visibilityEvents.delete(t),n.isVisibilityEvent()&&this.redactVisibilityChangeEvent(e)}}})),this.setMaxListeners(100),this.reEmitter=new Mp(this),i.pendingEventOrdering=i.pendingEventOrdering||cp.Chronological,this.name=e,this.normalizedName=e,this.relations=new M$(this.client,this),this.on(ke.Receipt,this.onReceipt),this.timelineSets=[new _h(this,i)],this.reEmitter.reEmit(this.getUnfilteredTimelineSet(),[ke.Timeline,ke.TimelineReset]),this.fixUpLegacyTimelineFields(),this.opts.pendingEventOrdering===cp.Detached&&(this.pendingEventList=[],this.client.store.getPendingEvents(this.roomId).then((e=>{var n,i=this.client.getEventMapper({toDevice:!1,decrypt:!1});e.forEach((n=U((function*(e){var n=i(e);yield t.decryptEventIfNeeded(n),n.setStatus(et.NOT_SENT),r.addPendingEvent(n,n.getTxnId())})),function(e){return n.apply(this,arguments)}))}))),this.opts.lazyLoadMembers?this.membersPromise=void 0:this.membersPromise=Promise.resolve(!1)}createThreadsTimelineSets(){var e=this;return U((function*(){var t;if(e.threadTimelineSetsPromise)return e.threadTimelineSetsPromise;if(null!==(t=e.client)&&void 0!==t&&t.supportsThreads())try{e.threadTimelineSetsPromise=Promise.all([e.createThreadTimelineSet(),e.createThreadTimelineSet(Eo.My)]);var n=yield e.threadTimelineSetsPromise;return e.threadsTimelineSets[0]=n[0],e.threadsTimelineSets[1]=n[1],n}catch{return e.threadTimelineSetsPromise=null,null}return null}))()}decryptCriticalEvents(){var e=this;return U((function*(){if(e.client.getCrypto()){var t=e.getEventReadUpTo(e.client.getUserId(),!0),n=e.getLiveTimeline().getEvents(),r=n.findIndex((e=>e.event.event_id===t)),i=n.slice(r).reverse().map((t=>e.client.decryptEventIfNeeded(t)));yield Promise.allSettled(i)}}))()}decryptAllEvents(){var e=this;return U((function*(){if(e.client.getCrypto()){var t=e.getUnfilteredTimelineSet().getLiveTimeline().getEvents().slice(0).reverse().map((t=>e.client.decryptEventIfNeeded(t)));yield Promise.allSettled(t)}}))()}getCreator(){var e,t=this.currentState.getStateEvents(ee.RoomCreate,"");return null!==(e=null==t?void 0:t.getSender())&&void 0!==e?e:null}getVersion(){var e,t=this.currentState.getStateEvents(ee.RoomCreate,"");return t?null!==(e=t.getContent().room_version)&&void 0!==e?e:"1":(this.getVersionWarning||(A.warn("[getVersion] Room "+this.roomId+" does not have an m.room.create event"),this.getVersionWarning=!0),"1")}getRecommendedVersion(){var e=this;return U((function*(){var t={};try{t=yield e.client.getCapabilities()}catch{}var n=t["m.room_versions"];if(!n)for(var r of(n={default:lH,available:{}},_se))n.available[r]=oH.Stable;var i=e.checkVersionAgainstCapability(n);if(i.urgent&&i.needsUpgrade){A.warn("Refreshing room version capability because the server looks to be supporting a newer room version we don't know about.");try{t=yield e.client.fetchCapabilities()}catch(e){A.warn("Failed to refresh room version capabilities",e)}if(!(n=t["m.room_versions"]))return A.warn("No room version capability - assuming upgrade required."),i;i=e.checkVersionAgainstCapability(n)}return i}))()}checkVersionAgainstCapability(e){var t=this.getVersion();A.log("[".concat(this.roomId,"] Current version: ").concat(t)),A.log("[".concat(this.roomId,"] Version capability: "),e);var n={version:t,needsUpgrade:!1,urgent:!1};return t===e.default||Object.keys(e.available).filter((t=>"stable"===e.available[t])).includes(t)||(n.version=e.default,n.needsUpgrade=!0,n.urgent=!!this.getVersion().match(/^[0-9]+[0-9.]*$/g),n.urgent?A.warn("URGENT upgrade required on ".concat(this.roomId)):A.warn("Non-urgent upgrade required on ".concat(this.roomId))),n}userMayUpgradeRoom(e){return this.currentState.maySendStateEvent(ee.RoomTombstone,e)}getPendingEvents(){if(!this.pendingEventList)throw new Error("Cannot call getPendingEvents with pendingEventOrdering == "+this.opts.pendingEventOrdering);return this.pendingEventList}removePendingEvent(e){if(!this.pendingEventList)throw new Error("Cannot call removePendingEvent with pendingEventOrdering == "+this.opts.pendingEventOrdering);var t=Hb(this.pendingEventList,(function(t){return t.getId()==e}),!1);return this.savePendingEvents(),t}hasPendingEvent(e){var t,n;return null!==(t=null===(n=this.pendingEventList)||void 0===n?void 0:n.some((t=>t.getId()===e)))&&void 0!==t&&t}getPendingEvent(e){var t,n;return null!==(t=null===(n=this.pendingEventList)||void 0===n?void 0:n.find((t=>t.getId()===e)))&&void 0!==t?t:null}getLiveTimeline(){return this.getUnfilteredTimelineSet().getLiveTimeline()}get timeline(){return this.getLiveTimeline().getEvents()}getLastActiveTimestamp(){var e=this.getLiveTimeline().getEvents();return e.length?e[e.length-1].getTs():Number.MIN_SAFE_INTEGER}getLastLiveEvent(){var e,t,n=this.getLiveTimeline().getEvents(),r=n[n.length-1],i=this.getLastThread();if(!i)return r;var o=i.events[i.events.length-1];return(null!==(e=null==r?void 0:r.getTs())&&void 0!==e?e:0)>(null!==(t=null==o?void 0:o.getTs())&&void 0!==t?t:0)?r:o}getLastThread(){return this.getThreads().reduce(((e,t)=>{var n,r;if(!e)return t;var i=t.events[t.events.length-1],o=e.events[e.events.length-1];return(null!==(n=null==i?void 0:i.getTs())&&void 0!==n?n:0)>=(null!==(r=null==o?void 0:o.getTs())&&void 0!==r?r:0)?t:e}),void 0)}getMyMembership(){var e;return null!==(e=this.selfMembership)&&void 0!==e?e:Ke.Leave}getDMInviter(){var e,t=this.getMember(this.myUserId);if(t)return t.getDMInviter();if(this.selfMembership===Ke.Invite&&2===this.getInvitedAndJoinedMemberCount())return null===(e=this.heroes)||void 0===e||null===(e=e[0])||void 0===e?void 0:e.userId}guessDMUserId(){var e=this.getMember(this.myUserId);if(e){var t=e.getDMInviter();if(t)return t}if(Array.isArray(this.heroes)&&this.heroes.length)return this.heroes[0].userId;var n=this.currentState.getMembers().find((e=>e.userId!==this.myUserId));return n?n.userId:this.myUserId}getFunctionalMembers(){var e=this.currentState.getStateEvents(E$.name,"");return Array.isArray(null==e?void 0:e.getContent().service_members)?e.getContent().service_members:[]}getAvatarFallbackMember(){var e,t=this.getFunctionalMembers(),n=0;if(this.getMembers().forEach((e=>{"join"!==e.membership&&"invite"!==e.membership||t.includes(e.userId)||n++})),!(n>2)){var r=null===(e=this.heroes)||void 0===e?void 0:e.filter((e=>!t.includes(e.userId))),i=Array.isArray(r)&&r.length;if(i){for(var o of r){if(o.fromMSC4186){var s=new wv(this.roomId,o.userId);return s.setMembershipEvent(new Ci({event_id:"$"+this.roomId+o.userId+(new Date).getTime(),type:ee.RoomMember,state_key:o.userId,content:{displayname:o.displayName,avatar_url:o.avatarUrl}})),s}var a=this.getMember(o.userId);if(a)return a}var l=r.map((e=>this.getMember(e.userId))).find((e=>!!e));if(l)return l}var c=this.getMembers(),u=null==c?void 0:c.filter((e=>!t.includes(e.userId)));if(u.length<=2){var d=u.find((e=>e.userId!==this.myUserId));if(d)return d}if(i){var h=r.map((e=>this.client.getUser(e.userId))).find((e=>!!e));if(h){var p=new wv(this.roomId,h.userId);return p.user=h,p}}}}updateMyMembership(e){var t=this.selfMembership;this.selfMembership=e,t!==e&&(e===Ke.Leave&&this.cleanupAfterLeaving(),this.emit(ke.MyMembership,this,e,t))}loadMembersFromServer(){var e=this;return U((function*(){var t=e.client.store.getSyncToken();return(yield e.client.members(e.roomId,void 0,Ke.Leave,t??void 0)).chunk}))()}loadMembers(){var e=this;return U((function*(){var t=!1,n=yield e.client.store.getOutOfBandMembers(e.roomId);return(null===n||e.hasEncryptionStateEvent())&&(t=!0,n=yield e.loadMembersFromServer(),A.log("LL: got ".concat(n.length," ")+"members from server for room ".concat(e.roomId))),{memberEvents:n.filter(Io).map(e.client.getEventMapper()),fromServer:t}}))()}membersLoaded(){return!this.opts.lazyLoadMembers||this.currentState.outOfBandMembersReady()}loadMembersIfNeeded(){if(this.membersPromise)return this.membersPromise;this.currentState.markOutOfBandMembersStarted();var e=this.loadMembers().then((e=>(this.currentState.setOutOfBandMembers(e.memberEvents),e.fromServer))).catch((e=>{throw this.membersPromise=void 0,this.currentState.markOutOfBandMembersFailed(),e}));return e.then((e=>{if(e){var t=this.currentState.getMembers().filter((e=>e.isOutOfBand())).map((e=>{var t;return null===(t=e.events.member)||void 0===t?void 0:t.event}));return A.log("LL: telling store to write ".concat(t.length)+" members for room ".concat(this.roomId)),this.client.store.setOutOfBandMembers(this.roomId,t).catch((e=>{A.log("LL: storing OOB room members failed, oh well",e)}))}})).catch((e=>{A.error(e)})),this.membersPromise=e,this.membersPromise}clearLoadedMembersIfNeeded(){var e=this;return U((function*(){e.opts.lazyLoadMembers&&e.membersPromise&&(yield e.loadMembersIfNeeded(),yield e.client.store.clearOutOfBandMembers(e.roomId),e.currentState.clearOutOfBandMembers(),e.membersPromise=void 0)}))()}cleanupAfterLeaving(){this.clearLoadedMembersIfNeeded().catch((e=>{A.error("error after clearing loaded members from "+"room ".concat(this.roomId," after leaving")),A.log(e)}))}refreshLiveTimeline(){var e=this;return U((function*(){var t=e.getLiveTimeline(),n=t.getPaginationToken(Le.FORWARDS),r=t.getPaginationToken(Le.BACKWARDS),i=t.getEvents(),o=i[i.length-1];A.log("[refreshLiveTimeline for ".concat(e.roomId,"] at ")+"mostRecentEventInTimeline=".concat(o&&o.getId()," ")+"liveTimelineBefore=".concat(t.toString()," ")+"forwardPaginationToken=".concat(n," ")+"backwardPaginationToken=".concat(r));var s,a=e.getUnfilteredTimelineSet();o?(e.resetLiveTimeline(null,null),e.emit(ke.TimelineRefresh,e,a),s=yield e.client.getEventTimeline(a,o.getId())):s=yield e.client.getLatestTimeline(a);var l=a.getLiveTimeline();!l||null===l.getPaginationToken(ht.Forward)&&null===l.getPaginationToken(ht.Backward)&&0===l.getEvents().length?(A.log("[refreshLiveTimeline for ".concat(e.roomId,"] using our new live timeline")),s.setPaginationToken(n,Le.FORWARDS),a.setLiveTimeline(s),e.fixUpLegacyTimelineFields()):A.log("[refreshLiveTimeline for ".concat(e.roomId,"] `/sync` or some other request beat us to creating a new ")+"live timeline after we reset it. We'll use that instead since any events in the scrollback from this timeline will include the history."),e.setTimelineNeedsRefresh(!1),e.emit(ke.TimelineRefresh,e,a)}))()}resetLiveTimeline(e,t){for(var n of this.timelineSets)n.resetLiveTimeline(e??void 0,t??void 0);for(var r of this.threads.values())r.resetLiveTimeline(e,t);this.fixUpLegacyTimelineFields()}fixUpLegacyTimelineFields(){var e=this.oldState,t=this.currentState;this.oldState=this.getLiveTimeline().getState(Le.BACKWARDS),this.currentState=this.getLiveTimeline().getState(Le.FORWARDS),e!==this.oldState&&this.emit(ke.OldStateUpdated,this,e,this.oldState),t!==this.currentState&&(this.emit(ke.CurrentStateUpdated,this,t,this.currentState),this.reEmitter.stopReEmitting(t,[ut.Events,ut.Members,ut.NewMember,ut.Update,ut.Marker,yn.New,yn.Update,yn.Destroy,yn.LivenessChange]),this.reEmitter.reEmit(this.currentState,[ut.Events,ut.Members,ut.NewMember,ut.Update,ut.Marker,yn.New,yn.Update,yn.Destroy,yn.LivenessChange]))}onReceipt(e){this.hasEncryptionStateEvent()&&this.clearNotificationsOnReceipt(e)}clearNotificationsOnReceipt(e){var t=[],n=!1,r=e.getContent();for(var i of Object.values(r))for(var[o,s]of Object.entries(i))if(kP(o)&&s)for(var[a,l]of Object.entries(s))if(l&&"object"==typeof l){var c=l;a===this.client.getUserId()&&(void 0===c.thread_id?n=!0:"string"==typeof c.thread_id&&t.push(c.thread_id))}for(var u of(n&&(t=this.getThreads().filter((e=>this.getThreadUnreadNotificationCount(e.id,jt.Total)>0||this.getThreadUnreadNotificationCount(e.id,jt.Highlight)>0)).map((e=>e.id))).push("main"),t)){var d,h="main"===u?this.getLiveTimeline():null===(d=this.getThread(u))||void 0===d?void 0:d.liveTimeline;if(h){for(var p=h.getEvents(),f=0,m=p.length-1;m>=0;m--){var v;if(m===p.length-20)return;var g=p[m];if(this.hasUserReadEvent(this.client.getUserId(),g.getId()))break;var y=this.client.getPushActionsForEvent(g);f+=null!=y&&null!==(v=y.tweaks)&&void 0!==v&&v.highlight?1:0}"main"===u?this.setUnreadNotificationCount(jt.Highlight,f):this.setThreadUnreadNotificationCount(u,jt.Highlight,f)}else A.warn("Couldn't find timeline for thread ID ".concat(u," in room ").concat(this.roomId))}}getTimelineSets(){return this.timelineSets}getUnfilteredTimelineSet(){return this.timelineSets[0]}getTimelineForEvent(e){var t=this.findEventById(e),n=this.findThreadForEvent(t);return n?n.timelineSet.getTimelineForEvent(e):this.getUnfilteredTimelineSet().getTimelineForEvent(e)}addTimeline(){return this.getUnfilteredTimelineSet().addTimeline()}setTimelineNeedsRefresh(e){this.timelineNeedsRefresh=e}getTimelineNeedsRefresh(){return this.timelineNeedsRefresh}findEventById(e){var t=this.getUnfilteredTimelineSet().findEventById(e);if(!t)for(var n=this.getThreads(),r=0;r<n.length;r++){if(t=n[r].findEventById(e))return t}return t}getUnreadNotificationCount(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:jt.Total,t=this.getRoomUnreadNotificationCount(e);for(var n of this.threadNotifications.values()){var r;t+=null!==(r=n[e])&&void 0!==r?r:0}return t}getUnreadCountForEventContext(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:jt.Total,n=arguments.length>1?arguments[1]:void 0;return null!==(e=!!n.threadRootId&&!n.isThreadRoot?this.getThreadUnreadNotificationCount(n.threadRootId,t):this.getRoomUnreadNotificationCount(t))&&void 0!==e?e:0}getRoomUnreadNotificationCount(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:jt.Total;return null!==(e=this.notificationCounts[t])&&void 0!==e?e:0}getThreadUnreadNotificationCount(e){var t,n,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:jt.Total;return null!==(t=null===(n=this.threadNotifications.get(e))||void 0===n?void 0:n[r])&&void 0!==t?t:0}hasThreadUnreadNotification(){for(var e of this.threadNotifications.values()){var t,n;if((null!==(t=e.highlight)&&void 0!==t?t:0)>0||(null!==(n=e.total)&&void 0!==n?n:0)>0)return!0}return!1}setThreadUnreadNotificationCount(e,t,n){var r,i,o=eg({highlight:null===(r=this.threadNotifications.get(e))||void 0===r?void 0:r.highlight,total:null===(i=this.threadNotifications.get(e))||void 0===i?void 0:i.total},{[t]:n});this.threadNotifications.set(e,o),this.emit(ke.UnreadNotifications,o,e)}get threadsAggregateNotificationType(){var e=null;for(var t of this.threadNotifications.values()){var n,r;if((null!==(n=t.highlight)&&void 0!==n?n:0)>0)return jt.Highlight;(null!==(r=t.total)&&void 0!==r?r:0)>0&&!e&&(e=jt.Total)}return e}resetThreadUnreadNotificationCountFromSync(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=this.hasEncryptionStateEvent();for(var[n,r]of this.threadNotifications)e.includes(n)||(r.total=0,t||(r.highlight=0));this.emit(ke.UnreadNotifications)}setBumpStamp(e){this.bumpStamp=e}getBumpStamp(){return this.bumpStamp}setUnreadNotificationCount(e,t){this.notificationCounts[e]=t,this.emit(ke.UnreadNotifications,this.notificationCounts)}setUnread(e,t){return this.setUnreadNotificationCount(e,t)}setSummary(e){var t,n=null===(t=e["m.heroes"])||void 0===t?void 0:t.map((e=>({userId:e,fromMSC4186:!1}))),r=e["m.joined_member_count"],i=e["m.invited_member_count"];Number.isInteger(r)&&this.currentState.setJoinedMemberCount(r),Number.isInteger(i)&&this.currentState.setInvitedMemberCount(i),Array.isArray(n)&&(this.heroes=n.filter((e=>e.userId!=this.myUserId))),this.emit(ke.Summary,e)}setMSC4186SummaryData(e,t,n){e&&(this.heroes=e.filter((e=>e.user_id!==this.myUserId)).map((e=>({userId:e.user_id,displayName:e.displayname,avatarUrl:e.avatar_url,fromMSC4186:!0})))),void 0!==t&&Number.isInteger(t)&&this.currentState.setJoinedMemberCount(t),void 0!==n&&Number.isInteger(n)&&this.currentState.setInvitedMemberCount(n),this.emit(ke.Summary,{"m.heroes":this.heroes?this.heroes.map((e=>e.userId)):[],"m.joined_member_count":t,"m.invited_member_count":n})}setBlacklistUnverifiedDevices(e){this.blacklistUnverifiedDevices=e}getBlacklistUnverifiedDevices(){return void 0===this.blacklistUnverifiedDevices?null:this.blacklistUnverifiedDevices}getAvatarUrl(e,t,n,r){var i=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],o=arguments.length>5&&void 0!==arguments[5]&&arguments[5],s=this.currentState.getStateEvents(ee.RoomAvatar,"");if(!s&&!i)return null;var a=s?s.getContent().url:null;return a?TE(e,a,t,n,r,void 0,void 0,o):null}getMxcAvatarUrl(){var e;return(null===(e=this.currentState.getStateEvents(ee.RoomAvatar,""))||void 0===e||null===(e=e.getContent())||void 0===e?void 0:e.url)||null}getCanonicalAlias(){var e=this.currentState.getStateEvents(ee.RoomCanonicalAlias,"");return e&&e.getContent().alias||null}getAltAliases(){var e=this.currentState.getStateEvents(ee.RoomCanonicalAlias,"");return e&&e.getContent().alt_aliases||[]}addEventsToTimeline(e,t,n,r,i){r.getTimelineSet().addEventsToTimeline(e,t,n,r,i)}getThread(e){var t;return null!==(t=this.threads.get(e))&&void 0!==t?t:null}getThreads(){return Array.from(this.threads.values())}getMember(e){return this.currentState.getMember(e)}getMembers(){return this.currentState.getMembers()}getJoinedMembers(){return this.getMembersWithMembership(Ke.Join)}getJoinedMemberCount(){return this.currentState.getJoinedMemberCount()}getInvitedMemberCount(){return this.currentState.getInvitedMemberCount()}getInvitedAndJoinedMemberCount(){return this.getInvitedMemberCount()+this.getJoinedMemberCount()}getMembersWithMembership(e){return this.currentState.getMembers().filter((function(t){return t.membership===e}))}getEncryptionTargetMembers(){var e=this;return U((function*(){yield e.loadMembersIfNeeded();var t=e.getMembersWithMembership(Ke.Join);return e.shouldEncryptForInvitedMembers()&&(t=t.concat(e.getMembersWithMembership(Ke.Invite))),t}))()}shouldEncryptForInvitedMembers(){var e,t=this.currentState.getStateEvents(ee.RoomHistoryVisibility,"");return"joined"!==(null==t||null===(e=t.getContent())||void 0===e?void 0:e.history_visibility)}getDefaultRoomName(e){return this.calculateRoomName(e,!0)}hasMembershipState(e,t){var n=this.getMember(e);return!!n&&n.membership===t}getOrCreateFilteredTimelineSet(e){var{prepopulateTimeline:t=!0,useSyncEvents:n=!0,pendingEvents:r=!0}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(this.filteredTimelineSets[e.filterId])return this.filteredTimelineSets[e.filterId];var i=Object.assign({filter:e,pendingEvents:r},this.opts),o=new _h(this,i);this.reEmitter.reEmit(o,[ke.Timeline,ke.TimelineReset]),n&&(this.filteredTimelineSets[e.filterId]=o,this.timelineSets.push(o));var s=this.getLiveTimeline();if(t){s.getEvents().forEach((function(e){o.addLiveEvent(e,{addToState:!1})}));for(var a=s;a.getNeighbouringTimeline(Le.BACKWARDS);)a=a.getNeighbouringTimeline(Le.BACKWARDS);o.getLiveTimeline().setPaginationToken(a.getPaginationToken(Le.BACKWARDS),Le.BACKWARDS)}else if(n){var l=s.getPaginationToken(ht.Forward);o.getLiveTimeline().setPaginationToken(l,ht.Backward)}return o}getThreadListFilter(){var e=arguments,t=this;return U((function*(){var n=e.length>0&&void 0!==e[0]?e[0]:Eo.All,r=t.client.getUserId(),i=new Hi(r),o={room:{timeline:{[jh.name]:[Zt.name]}}};n===Eo.My&&(o.room.timeline[Dh.name]=[r]),i.setDefinition(o);var s=yield t.client.getOrCreateFilter("THREAD_PANEL_".concat(t.roomId,"_").concat(n),i);return i.filterId=s,i}))()}createThreadTimelineSet(e){var t=this;return U((function*(){var n;if(dn.hasServerSideListSupport)n=new _h(t,eg(eg({},t.opts),{},{pendingEvents:!1}),void 0,void 0,e??Eo.All),t.reEmitter.reEmit(n,[ke.Timeline,ke.TimelineReset]);else if(dn.hasServerSideSupport){var r=yield t.getThreadListFilter(e);n=t.getOrCreateFilteredTimelineSet(r,{prepopulateTimeline:!1,useSyncEvents:!1,pendingEvents:!1})}else n=new _h(t,{pendingEvents:!1}),Array.from(t.threads).forEach((r=>{var[,i]=r;if(0!==i.length){var o=i.timeline.some((e=>e.getSender()===t.client.getUserId()));(e!==Eo.My||o)&&n.getLiveTimeline().addEvent(i.rootEvent,{toStartOfTimeline:!1,addToState:!1})}}));return n}))()}processThreadRoots(e,t){if(this.client.supportsThreads())for(var n of e)Le.setEventMetadata(n,this.currentState,t),this.getThread(n.getId())||this.createThread(n.getId(),n,[],t)}fetchRoomThreads(){var e=this;return U((function*(){if(!e.threadsReady&&e.client.supportsThreads()){if(dn.hasServerSideListSupport)yield Promise.all([e.fetchRoomThreadList(Eo.All),e.fetchRoomThreadList(Eo.My)]);else{var t=yield e.getThreadListFilter(),{chunk:n}=yield e.client.createMessagesRequest(e.roomId,"",Number.MAX_SAFE_INTEGER,ht.Backward,t);if(!n.length)return;var r,i=n.map(e.client.getEventMapper()).sort(((e,t)=>{var n=e.getServerAggregatedRelation(Zt.name),r=t.getServerAggregatedRelation(Zt.name);return n.latest_event.origin_server_ts-r.latest_event.origin_server_ts})),o=e.getLiveTimeline().getState(Le.FORWARDS);for(var s of i){var a,l={duplicateStrategy:Vg.Ignore,fromCache:!1,addToState:!1,roomState:o};null===(a=e.threadsTimelineSets[0])||void 0===a||a.addLiveEvent(s,l);var c,u=s.getServerAggregatedRelation(Zt.name);if(null!=u&&u.current_user_participated)null===(c=e.threadsTimelineSets[1])||void 0===c||c.addLiveEvent(s,l),r=s}e.processThreadRoots(i,!0),e.client.decryptEventIfNeeded(i[i.length-1]),r&&e.client.decryptEventIfNeeded(r)}e.on(_i.NewReply,e.onThreadReply),e.on(_i.Update,e.onThreadUpdate),e.on(_i.Delete,e.onThreadDelete),e.threadsReady=!0}}))()}processPollEvents(e){var t=this;return U((function*(){for(var n of e)try{if(!n.isEncrypted()&&!X$(n))continue;yield t.client.decryptEventIfNeeded(n),t.processPollEvent(n)}catch(e){A.warn("Error processing poll event",n.getId(),e)}}))()}processPollEvent(e){var t=this;return U((function*(){if(e.isDecryptionFailure())e.once(Mt.Decrypted,(e=>{t.processPollEvent(e)}));else if(rs.M_POLL_START.matches(e.getType()))try{var n=new J$(e,t.client,t);t.polls.set(e.getId(),n),t.emit(Oc.New,n),e.once(Mt.BeforeRedaction,(e=>{t.polls.delete(e.getId())}))}catch{}else{var r=e.relationEventId;if(r&&t.polls.has(r)){var i=t.polls.get(r);null==i||i.onNewRelation(e)}}}))()}fetchRoomThreadList(e){var t=this;return U((function*(){if(t.client.supportsThreads()&&0!==t.threadsTimelineSets.length){var n=e===Eo.My?t.threadsTimelineSets[1]:t.threadsTimelineSets[0],{chunk:r,end:i}=yield t.client.createThreadListMessagesRequest(t.roomId,null,void 0,ht.Backward,n.threadListType,n.getFilter());if(n.getLiveTimeline().setPaginationToken(i??null,ht.Backward),r.length){var o=r.map(t.client.getEventMapper());t.processThreadRoots(o,!0);var s=t.getLiveTimeline().getState(Le.FORWARDS);for(var a of o)n.addLiveEvent(a,{duplicateStrategy:Vg.Replace,fromCache:!1,roomState:s,addToState:!1})}}}))()}onThreadUpdate(e){this.updateThreadRootEvents(e,!1,!1)}onThreadReply(e){this.updateThreadRootEvents(e,!1,!0)}onThreadDelete(e){var t;this.threads.delete(e.id);var n=this.getTimelineForEvent(e.id),r=null==n||null===(t=n.getEvents())||void 0===t?void 0:t.find((t=>t.getId()===e.id));for(var i of(r?e.clearEventMetadata(r):A.debug("onThreadDelete: Could not find root event in room timeline"),this.threadsTimelineSets))i.removeEvent(e.id)}removeFilteredTimelineSet(e){var t=this.filteredTimelineSets[e.filterId];delete this.filteredTimelineSets[e.filterId];var n=this.timelineSets.indexOf(t);n>-1&&this.timelineSets.splice(n,1)}eventShouldLiveIn(e,t,n){var r;if(null===(r=this.client)||void 0===r||!r.supportsThreads())return{shouldLiveInRoom:!0,shouldLiveInThread:!1};if(e.isThreadRoot||null!=n&&n.has(e.getId()))return{shouldLiveInRoom:!0,shouldLiveInThread:!0,threadId:e.getId()};var i,o,s=e.isRelation(Zt.name),a=e.getAssociatedId(),l=e.threadRootId;if(a&&!s&&(l===a||null!=n&&n.has(a)))return{shouldLiveInRoom:!0,shouldLiveInThread:!1};a&&(i=null!==(o=this.findEventById(a))&&void 0!==o?o:null==t?void 0:t.find((e=>e.getId()===a)));return i&&!s?this.eventShouldLiveIn(i,t,n):null!=l?{shouldLiveInRoom:!1,shouldLiveInThread:!0,threadId:l}:!a||e.replyEventId?{shouldLiveInRoom:!0,shouldLiveInThread:!1}:{shouldLiveInRoom:!1,shouldLiveInThread:!1}}findThreadForEvent(e){if(!e)return null;var{threadId:t}=this.eventShouldLiveIn(e);return t?this.getThread(t):null}addThreadedEvents(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=this.getThread(e);if(r)r.addEvents(t,n);else{var i,o=null!==(i=this.findEventById(e))&&void 0!==i?i:t.find((t=>t.getId()===e));this.createThread(e,o,t,n)}}processThreadedEvents(e,t){e.forEach(this.applyRedaction);var n={};for(var r of e){var i,{threadId:o,shouldLiveInThread:s}=this.eventShouldLiveIn(r);s&&!n[o]&&(n[o]=[]),null===(i=n[o])||void 0===i||i.push(r)}Object.entries(n).map((e=>{var[n,r]=e;return this.addThreadedEvents(n,r,t)}))}createThread(e,t){var n,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],i=arguments.length>3?arguments[3]:void 0;if(this.threads.has(e))return this.threads.get(e);if(t){var o=this.relations.getAllChildEventsForEvent(t.getId());null!=o&&o.length&&(r=r.concat(o.filter((e=>!e.isRelation(cn.Replace)))))}var s=new dn(e,t,{room:this,client:this.client,pendingEventOrdering:this.opts.pendingEventOrdering,receipts:null!==(n=this.cachedThreadReadReceipts.get(e))&&void 0!==n?n:[]});return this.reEmitter.reEmit(s,[_i.Delete,_i.Update,_i.NewReply,ke.Timeline,ke.TimelineReset]),this.cachedThreadReadReceipts.delete(e),this.threads.set(s.id,s),s.addEvents(r,!1),this.threadsReady&&s.initialEventsFetched&&this.updateThreadRootEvents(s,i,!1),this.emit(_i.New,s,i),s}processLiveEvent(e){if(this.applyRedaction(e),e.isVisibilityEvent()&&this.applyNewVisibilityEvent(e),this.applyPendingVisibilityEvents(e),!e.getUnsigned().transaction_id&&e.getSender()===this.myUserId)for(var[t,n]of this.txnToEvent)if(n.getId()===e.getId()){A.debug("processLiveEvent: found sent event without txn ID: ",t,e.getId());var r=e.getUnsigned();r.transaction_id=t,e.setUnsigned(r);break}}addLiveEvent(e,t){var{duplicateStrategy:n,timelineWasEmpty:r,fromCache:i,addToState:o}=t;for(var s of this.timelineSets)s.addLiveEvent(e,{duplicateStrategy:n,fromCache:i,timelineWasEmpty:r,addToState:o});e.sender&&e.getType()!==ee.RoomRedaction&&this.addReceipt(z$(e.sender.userId,e,yi.Read),!0)}addPendingEvent(e,t){if(e.status!==et.SENDING&&e.status!==et.NOT_SENT)throw new Error("addPendingEvent called on an event with status "+e.status);if(this.txnToEvent.get(t))throw new Error("addPendingEvent called on an event with known txnId "+t);if(Le.setEventMetadata(e,this.getLiveTimeline().getState(Le.FORWARDS),!1),this.txnToEvent.set(t,e),this.pendingEventList){if(this.pendingEventList.some((e=>e.status===et.NOT_SENT))&&(A.warn("Setting event as NOT_SENT due to messages in the same state"),e.setStatus(et.NOT_SENT)),this.pendingEventList.push(e),this.savePendingEvents(),e.isRelation()&&this.aggregateNonLiveRelation(e),e.isRedaction()){var n=e.event.redacts,r=this.pendingEventList.find((e=>e.getId()===n));!r&&n&&(r=this.findEventById(n)),r&&(r.markLocallyRedacted(e),this.emit(ke.Redaction,e,this,r.threadRootId))}}else for(var i of this.timelineSets)i.getFilter()?i.getFilter().filterRoomTimeline([e]).length&&i.addEventToTimeline(e,i.getLiveTimeline(),{toStartOfTimeline:!1,addToState:!1}):i.addEventToTimeline(e,i.getLiveTimeline(),{toStartOfTimeline:!1,addToState:!1});this.emit(ke.LocalEchoUpdated,e,this)}savePendingEvents(){if(this.pendingEventList){var e=this.pendingEventList.map((e=>eg(eg({},e.event),{},{txn_id:e.getTxnId()}))).filter((e=>{var t=e.type===ee.RoomMessageEncrypted,n=this.hasEncryptionStateEvent();return t||!n}));this.client.store.setPendingEvents(this.roomId,e)}}aggregateNonLiveRelation(e){this.relations.aggregateChildEvent(e)}getEventForTxnId(e){return this.txnToEvent.get(e)}handleRemoteEcho(e,t){var n=t.getId(),r=e.getId(),i=t.status;A.debug("Got remote echo for event ".concat(n," -> ").concat(r," old status ").concat(i)),this.txnToEvent.delete(e.getUnsigned().transaction_id),this.pendingEventList&&this.removePendingEvent(n),t.handleRemoteEcho(e.event);var{shouldLiveInRoom:o,threadId:s}=this.eventShouldLiveIn(e),a=s?this.getThread(s):null;if(null==a||a.setEventMetadata(t),null==a||a.timelineSet.handleRemoteEcho(t,n,r),o)for(var l of this.timelineSets)l.handleRemoteEcho(t,n,r);this.emit(ke.LocalEchoUpdated,t,this,n,i)}updatePendingEvent(e,t,n){if(A.log("setting pendingEvent status to ".concat(t," in ").concat(e.getRoomId()," ")+"event ID ".concat(e.getId()," -> ").concat(n)),t==et.SENT&&!n)throw new Error("updatePendingEvent called with status=SENT, but no new event id");if(t==et.SENT&&this.getTimelineForEvent(n)){var r=this.findEventById(n);if(!(null==r?void 0:r.getUnsigned().transaction_id)&&r){var i=r.getUnsigned();i.transaction_id=e.getTxnId(),r.setUnsigned(i),this.removeEvent(r.getId()),this.handleRemoteEcho(r,e)}return}var o=e.status,s=e.getId();if(!o)throw new Error("updatePendingEventStatus called on an event which is not a local echo.");var a=Sse[o];if(null==a||!a.includes(t))throw new Error("Invalid EventStatus transition ".concat(o,"->").concat(t));if(e.setStatus(t),t==et.SENT){e.replaceLocalEventId(n);var{shouldLiveInRoom:l,threadId:c}=this.eventShouldLiveIn(e),u=c?this.getThread(c):void 0;if(null==u||u.setEventMetadata(e),null==u||u.timelineSet.replaceEventId(s,n),l)for(var d of this.timelineSets)d.replaceEventId(s,n)}else if(t==et.CANCELLED){if(this.pendingEventList){var h=this.getPendingEvent(s);this.removePendingEvent(s),null!=h&&h.isRedaction()&&this.revertRedactionLocalEcho(h)}this.removeEvent(s)}this.savePendingEvents(),this.emit(ke.LocalEchoUpdated,e,this,s,o)}revertRedactionLocalEcho(e){var t=e.event.redacts;if(t){var n=this.getUnfilteredTimelineSet().findEventById(t);n&&(n.unmarkLocallyRedacted(),this.emit(ke.RedactionCancelled,e,this),n.isRelation()&&this.aggregateNonLiveRelation(n))}}assertTimelineSetsAreLive(){for(var e=0;e<this.timelineSets.length;e++){var t=this.timelineSets[e].getLiveTimeline();if(t.getPaginationToken(Le.FORWARDS))throw new Error("live timeline "+e+" is no longer live - it has a pagination token ("+t.getPaginationToken(Le.FORWARDS)+")");if(t.getNeighbouringTimeline(Le.FORWARDS))throw new Error("live timeline ".concat(e," is no longer live - it has a neighbouring timeline"))}}addLiveEvents(e,t){var n=this;return U((function*(){var{duplicateStrategy:r,fromCache:i,timelineWasEmpty:o=!1,addToState:s}=t;if(r&&-1===["replace","ignore"].indexOf(r))throw new Error("duplicateStrategy MUST be either 'replace' or 'ignore'");n.assertTimelineSetsAreLive();var a=n.findThreadRoots(e),l={},c={duplicateStrategy:r,fromCache:i,timelineWasEmpty:o,addToState:s},u=[...e];for(var d of e){var h;if(n.processLiveEvent(d),d.getUnsigned().transaction_id){var p=n.txnToEvent.get(d.getUnsigned().transaction_id);if(p){n.handleRemoteEcho(d,p);continue}}var{shouldLiveInRoom:f,shouldLiveInThread:m,threadId:v=""}=n.eventShouldLiveIn(d,u,a);if(!m&&!f&&d.isRelation())try{var g=new Ci(yield n.client.fetchRoomEvent(n.roomId,d.relationEventId));if(u.push(g),g.threadRootId){a.add(g.threadRootId);var y=d.getUnsigned();y[Gb.name]=g.threadRootId,d.setUnsigned(y)}({shouldLiveInRoom:f,shouldLiveInThread:m,threadId:v=""}=n.eventShouldLiveIn(d,u,a))}catch(e){A.error("Failed to load parent event of unhandled relation",e)}m&&!l[v]&&(l[v]=[]),null===(h=l[v])||void 0===h||h.push(d),f?n.addLiveEvent(d,c):!m&&d.isRelation()&&n.relations.aggregateChildEvent(d)}Object.entries(l).forEach((e=>{var[t,r]=e;n.addThreadedEvents(t,r,!1)}))}))()}partitionThreadedEvents(e){if(this.client.supportsThreads()){var t=this.findThreadRoots(e);return e.reduce(((n,r)=>{var{shouldLiveInRoom:i,shouldLiveInThread:o,threadId:s}=this.eventShouldLiveIn(r,e,t);return i&&n[0].push(r),o&&(r.setThreadId(s??""),n[1].push(r)),!o&&!i&&n[2].push(r),n}),[[],[],[]])}return[e,[],[]]}findThreadRoots(e){var t=new Set;for(var n of e){var r=n.threadRootId;null!=r&&t.add(r)}return t}addReceipt(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=e.getContent();this.roomReceipts.add(n,t),Object.keys(n).forEach((e=>{Object.keys(n[e]).forEach((r=>{Object.keys(n[e][r]).forEach((i=>{var o,s,a,l,c=n[e][r][i],u=!c.thread_id||c.thread_id===Ey,d=u?this:this.threads.get(null!==(o=c.thread_id)&&void 0!==o?o:"");if(d){if(d.addReceiptToStructure(e,r,i,c,t),!t&&this.client.isInitialSyncComplete()&&i===this.client.getUserId()){var h=d.timeline[d.timeline.length-1];h&&e===h.getId()&&i===h.getSender()&&(d.setUnread(jt.Total,0),d.setUnread(jt.Highlight,0))}}else this.cachedThreadReadReceipts.set(c.thread_id,[...null!==(l=this.cachedThreadReadReceipts.get(c.thread_id))&&void 0!==l?l:[],{eventId:e,receiptType:r,userId:i,receipt:c,synthetic:t}]);i===this.client.getUserId()&&!u&&c.ts<this.oldestThreadedReceiptTs&&(this.oldestThreadedReceiptTs=c.ts),!c.thread_id&&c.ts>(null!==(s=null===(a=this.unthreadedReceipts.get(i))||void 0===a?void 0:a.ts)&&void 0!==s?s:0)&&this.unthreadedReceipts.set(i,c)}))}))})),this.emit(ke.Receipt,e,this)}addEphemeralEvents(e){for(var t of e)t.getType()===ee.Typing?this.currentState.setTypingEvent(t):t.getType()===ee.Receipt&&this.addReceipt(t)}removeEvents(e){for(var t of e)this.removeEvent(t)}removeEvent(e){var t=!1;for(var n of this.timelineSets){var r=n.removeEvent(e);r&&(r.isRedaction()&&this.revertRedactionLocalEcho(r),t=!0)}return t}recalculate(){var e=this.currentState.getStateEvents(ee.RoomMember,this.myUserId);if(e){var t=e.getContent().membership;if(this.updateMyMembership(t),t===Ke.Invite)(e.getUnsigned().invite_room_state||[]).forEach((e=>{this.currentState.getStateEvents(e.type,e.state_key)||this.currentState.setStateEvents([new Ci({type:e.type,state_key:e.state_key,content:e.content,event_id:"$fake"+Date.now(),room_id:this.roomId,sender:this.myUserId})])}))}var n=this.name;this.name=this.calculateRoomName(this.myUserId),this.normalizedName=rie(this.name),this.summary=new A$(this.roomId,{title:this.name}),n!==this.name&&this.emit(ke.Name,this)}addTags(e){this.tags=e.getContent().tags||{},this.emit(ke.Tags,e,this)}addAccountData(e){for(var t of e){"m.tag"===t.getType()&&this.addTags(t);var n=t.getType(),r=this.accountData.get(n);this.accountData.set(n,t),this.emit(ke.AccountData,t,this,r)}}getAccountData(e){return this.accountData.get(e)}maySendMessage(){return this.getMyMembership()===Ke.Join&&(this.hasEncryptionStateEvent()?this.currentState.maySendEvent(ee.RoomMessageEncrypted,this.myUserId):this.currentState.maySendEvent(ee.RoomMessage,this.myUserId))}canInvite(e){var t=this.getMyMembership()===Ke.Join,n=this.currentState.getStateEvents(ee.RoomPowerLevels,""),r=n&&n.getContent(),i=this.getMember(e);return r&&i&&r.invite>i.powerLevel&&(t=!1),t}getJoinRule(){return this.currentState.getJoinRule()}getHistoryVisibility(){return this.currentState.getHistoryVisibility()}getGuestAccess(){return this.currentState.getGuestAccess()}getType(){var e=this.currentState.getStateEvents(ee.RoomCreate,"");if(e)return e.getContent()[Kb];this.getTypeWarning||(A.warn("[getType] Room "+this.roomId+" does not have an m.room.create event"),this.getTypeWarning=!0)}isSpaceRoom(){return this.getType()===Ph.Space}isCallRoom(){return this.getType()===Ph.UnstableCall}isElementVideoRoom(){return this.getType()===Ph.ElementVideo}findPredecessor(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=this.getLiveTimeline().getState(Le.FORWARDS);return t?t.findPredecessor(e):null}roomNameGenerator(e){if(this.client.roomNameGenerator){var t=this.client.roomNameGenerator(this.roomId,e);if(null!==t)return t}switch(e.type){case na.Actual:return e.name;case na.Generated:return"Inviting"===e.subtype?"Inviting ".concat(q5(e.names,e.count)):q5(e.names,e.count);case na.EmptyRoom:return e.oldName?"Empty room (was ".concat(e.oldName,")"):"Empty room"}}calculateRoomName(e){if(!(arguments.length>1&&void 0!==arguments[1]&&arguments[1])){var t=this.currentState.getStateEvents(ee.RoomName,"");if(null!=t&&t.getContent().name)return this.roomNameGenerator({type:na.Actual,name:t.getContent().name})}var n=this.getCanonicalAlias();if(n)return this.roomNameGenerator({type:na.Actual,name:n});var r=this.currentState.getJoinedMemberCount()+this.currentState.getInvitedMemberCount()-1,i=this.getFunctionalMembers(),o=[];if(this.heroes)this.heroes.forEach((e=>{if(i.includes(e.userId))r--;else if(e.displayName)o.push(e.displayName);else{var t=this.getMember(e.userId);o.push(t?t.name:e.userId)}}));else{var s=this.currentState.getMembers().filter((t=>t.userId!==e&&(t.membership===Ke.Invite||t.membership===Ke.Join)));s=s.filter((e=>{var{userId:t}=e;return!i.includes(t)||(r--,!1)}));var a=new Intl.Collator;s.sort(((e,t)=>a.compare(e.userId,t.userId))),s=s.slice(0,5),o=s.map((e=>e.name))}if(r)return this.roomNameGenerator({type:na.Generated,names:o,count:r});if(this.getMyMembership()==Ke.Join){var l=this.currentState.getStateEvents(ee.RoomThirdPartyInvite);if(null!=l&&l.length){var c=l.map((e=>e.getContent().display_name));return this.roomNameGenerator({type:na.Generated,subtype:"Inviting",names:c,count:c.length+1})}}var u,d=o;return d.length||(d=this.currentState.getMembers().filter((t=>t.userId!==e&&t.membership!==Ke.Invite&&t.membership!==Ke.Join)).map((e=>e.name))),d.length&&(u=this.roomNameGenerator({type:na.Generated,names:d,count:d.length+1})),this.roomNameGenerator({type:na.EmptyRoom,oldName:u})}applyNewVisibilityEvent(e){var t=e.asVisibilityChange();if(t){var n=e.getSender();if(n)if(md.name&&this.currentState.maySendStateEvent(md.name,n)||md.altName&&this.currentState.maySendStateEvent(md.altName,n)){var r=this.visibilityEvents.get(t.eventId);if(r){for(var i=r.length-1,o=Math.max(0,r.length-bse);i>=o;--i){if(r[i].getTs()<e.getTs())break}-1===i?r.unshift(e):r.splice(i+1,0,e)}else this.visibilityEvents.set(t.eventId,[e]);var s=this.findEventById(t.eventId);s&&s.applyVisibilityEvent(t)}}}redactVisibilityChangeEvent(e){if(!e.isVisibilityEvent)throw new Error("expected a visibility change event");var t=e.getRelation(),n=null==t?void 0:t.event_id,r=this.visibilityEvents.get(n);if(r){var i=r.findIndex((t=>t.getId()===e.getId()));if(-1!==i&&(r.splice(i,1),i===r.length)){var o=this.findEventById(n);if(!o)return;if(0===i)this.visibilityEvents.delete(n),o.applyVisibilityEvent();else{var s=r[r.length-1].asVisibilityChange();if(!s)throw new Error("at this stage, visibility changes should be well-formed");o.applyVisibilityEvent(s)}}}}applyPendingVisibilityEvents(e){var t=this.visibilityEvents.get(e.getId());if(t&&0!=t.length){var n=t[t.length-1],r=n.asVisibilityChange();r&&(r.visible,!(n.getTs()<e.getTs())&&e.applyVisibilityEvent(r))}}getOldestThreadedReceiptTs(){return this.oldestThreadedReceiptTs}hasUserReadEvent(e,t){return this.roomReceipts.hasUserReadEvent(e,t)}getLastUnthreadedReceiptFor(e){return this.unthreadedReceipts.get(e)}fixupNotifications(e){super.fixupNotifications(e);var t=this.getThreads().filter((e=>this.getThreadUnreadNotificationCount(e.id,jt.Total)>0));for(var n of t)n.fixupNotifications(e)}compareEventOrdering(e,t){return ese(this,e,t)}hasEncryptionStateEvent(){var e;return!(null===(e=this.getLiveTimeline().getState(Le.FORWARDS))||void 0===e||!e.getStateEvents(ee.RoomEncryption,""))}};var Sse={[et.ENCRYPTING]:[et.SENDING,et.NOT_SENT,et.CANCELLED],[et.SENDING]:[et.ENCRYPTING,et.QUEUED,et.NOT_SENT,et.SENT],[et.QUEUED]:[et.SENDING,et.NOT_SENT,et.CANCELLED],[et.SENT]:[],[et.NOT_SENT]:[et.SENDING,et.QUEUED,et.CANCELLED],[et.CANCELLED]:[]},na=function(e){return e[e.EmptyRoom=0]="EmptyRoom",e[e.Generated=1]="Generated",e[e.Actual=2]="Actual",e}({});function q5(e,t){var n=t-1;return e.length?1===e.length&&n<=1?e[0]:2===e.length&&n<=2?"".concat(e[0]," and ").concat(e[1]):n>1?"".concat(e[0]," and ").concat(n," others"):"".concat(e[0]," and 1 other"):"Empty room"}var gr=function(e){return e[e.Stable=0]="Stable",e[e.Unstable=1]="Unstable",e[e.Unsupported=2]="Unsupported",e}({}),vr=function(e){return e.Thread="Thread",e.ThreadUnreadNotifications="ThreadUnreadNotifications",e.LoginTokenRequest="LoginTokenRequest",e.RelationBasedRedactions="RelationBasedRedactions",e.AccountDataDeletion="AccountDataDeletion",e.RelationsRecursion="RelationsRecursion",e.IntentionalMentions="IntentionalMentions",e}({}),Ese={[vr.Thread]:{unstablePrefixes:["org.matrix.msc3440"],matrixVersion:"v1.3"},[vr.ThreadUnreadNotifications]:{unstablePrefixes:["org.matrix.msc3771","org.matrix.msc3773"],matrixVersion:"v1.4"},[vr.LoginTokenRequest]:{unstablePrefixes:["org.matrix.msc3882"]},[vr.RelationBasedRedactions]:{unstablePrefixes:["org.matrix.msc3912"]},[vr.AccountDataDeletion]:{unstablePrefixes:["org.matrix.msc3391"]},[vr.RelationsRecursion]:{unstablePrefixes:["org.matrix.msc3981"],matrixVersion:"v1.10"},[vr.IntentionalMentions]:{unstablePrefixes:["org.matrix.msc3952_intentional_mentions"],matrixVersion:"v1.7"}};function wse(e){return hk.apply(this,arguments)}function hk(){return(hk=U((function*(e){var t=new Map;for(var[n,r]of Object.entries(Ese)){var i,o,s,a,l=null!==(i=null===(o=e.versions)||void 0===o?void 0:o.includes(r.matrixVersion||""))&&void 0!==i&&i,c=null!==(s=null===(a=r.unstablePrefixes)||void 0===a?void 0:a.every((t=>{var n;return!0===(null===(n=e.unstable_features)||void 0===n?void 0:n[t])})))&&void 0!==s&&s;l?t.set(n,gr.Stable):c?t.set(n,gr.Unstable):t.set(n,gr.Unsupported)}return t}))).apply(this,arguments)}function K5(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Jb(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?K5(Object(n),!0).forEach((function(t){L(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):K5(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var G5=8e4,Cse=3,Dt=function(e){return e.Error="ERROR",e.Prepared="PREPARED",e.Stopped="STOPPED",e.Syncing="SYNCING",e.Catchup="CATCHUP",e.Reconnecting="RECONNECTING",e}({}),Tse=["org.matrix.msc2716v3"];function W5(e,t){return"FILTER_SYNC_".concat(e)+(t?"_"+t:"")}function Tn(){A.log(...arguments)}var cH=function(e){return e.Offline="offline",e.Online="online",e.Unavailable="unavailable",e}({});function uH(e){return Jb({initialSyncLimit:8,resolveInvitesToProfiles:!1,pollTimeout:3e4,pendingEventOrdering:cp.Chronological,threadSupport:!1},e)}function dH(e){return Jb({canResetEntireTimeline:e=>!1},e)}class gd{constructor(e,t,n){var r=this;this.client=e,L(this,"opts",void 0),L(this,"syncOpts",void 0),L(this,"_peekRoom",null),L(this,"currentSyncRequest",void 0),L(this,"abortController",void 0),L(this,"syncState",null),L(this,"syncStateData",void 0),L(this,"catchingUp",!1),L(this,"running",!1),L(this,"keepAliveTimer",void 0),L(this,"connectionReturnedDefer",void 0),L(this,"notifEvents",[]),L(this,"failedSyncCount",0),L(this,"storeIsInvalid",!1),L(this,"presence",void 0),L(this,"getPushRules",U((function*(){try{Tn("Getting push rules...");var e=yield r.client.getPushRules();Tn("Got push rules"),r.client.pushRules=e}catch(e){return A.error("Getting push rules failed",e),r.shouldAbortSync(e)?void 0:(Tn("Waiting for saved sync before retrying push rules..."),yield r.recoverFromSyncStartupError(r.savedSyncPromise,e),r.getPushRules())}}))),L(this,"buildDefaultFilter",(()=>{var e=new Hi(this.client.credentials.userId);return this.client.canSupport.get(vr.ThreadUnreadNotifications)!==gr.Unsupported&&e.setUnreadThreadNotifications(!0),e})),L(this,"prepareLazyLoadingForSync",U((function*(){Tn("Prepare lazy loading for sync..."),r.client.isGuest()&&(r.opts.lazyLoadMembers=!1),r.opts.lazyLoadMembers&&(Tn("Enabling lazy load on sync filter..."),r.opts.filter||(r.opts.filter=r.buildDefaultFilter()),r.opts.filter.setLazyLoadMembers(!0))}))),L(this,"storeClientOptions",U((function*(){try{Tn("Storing client options..."),yield r.client.storeClientOptions(),Tn("Stored client options")}catch(e){throw A.error("Storing client options failed",e),e}}))),L(this,"getFilter",U((function*(){var e,t;Tn("Getting filter..."),e=r.opts.filter?r.opts.filter:r.buildDefaultFilter();try{t=yield r.client.getOrCreateFilter(W5(r.client.credentials.userId),e)}catch(e){return A.error("Getting filter failed",e),r.shouldAbortSync(e)?{}:(Tn("Waiting for saved sync before retrying filter..."),yield r.recoverFromSyncStartupError(r.savedSyncPromise,e),r.getFilter())}return{filter:e,filterId:t}}))),L(this,"savedSyncPromise",void 0),L(this,"onOnline",(()=>{Tn("Browser thinks we are back online"),this.startKeepAlives(0)})),this.opts=uH(t),this.syncOpts=dH(n),e.getNotifTimelineSet()&&e.reEmitter.reEmit(e.getNotifTimelineSet(),[ke.Timeline,ke.TimelineReset])}createRoom(e){var t=fH(this.client,e,this.opts);return t.on(ut.Marker,((e,n)=>{this.onMarkerStateEvent(t,e,n)})),t}onMarkerStateEvent(e,t){var{timelineWasEmpty:n}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};n?A.debug("MarkerState: Ignoring markerEventId=".concat(t.getId()," in roomId=").concat(e.roomId," ")+"because the timeline was empty before the marker arrived which means there is nothing to refresh."):Tse.includes(e.getVersion())||t.getSender()===e.getCreator()?(A.debug("MarkerState: Timeline needs to be refreshed because "+"a new markerEventId=".concat(t.getId()," was sent in roomId=").concat(e.roomId)),e.setTimelineNeedsRefresh(!0),e.emit(ke.HistoryImportedWithinTimeline,t,e)):A.debug("MarkerState: Ignoring markerEventId=".concat(t.getId()," in roomId=").concat(e.roomId," because ")+"MSC2716 is not supported in the room version or for any room version, the marker wasn't sent by the room creator.")}syncLeftRooms(){var e=this;return U((function*(){var t,n=e.client,r=new Hi(e.client.credentials.userId);r.setTimelineLimit(1),r.setIncludeLeaveRooms(!0);var i=e.opts.pollTimeout+G5,o={timeout:0,filter:yield n.getOrCreateFilter(W5(n.credentials.userId,"LEFT_ROOMS"),r),"org.matrix.msc4222.use_state_after":!0},s=yield n.http.authedRequest(ae.Get,"/sync",o,void 0,{localTimeoutMs:i}),a=[];null!==(t=s.rooms)&&void 0!==t&&t.leave&&(a=e.mapSyncResponseToRoomArray(s.rooms.leave));var l,c=yield Promise.all(a.map((l=U((function*(t){var r=t.room;if(t.isBrandNewRoom){t.timeline=t.timeline||{prev_batch:null,events:[]},r.getLiveTimeline().setPaginationToken(t.timeline.prev_batch,Le.BACKWARDS);var{timelineEvents:i}=yield e.mapAndInjectRoomEvents(t);return r.recalculate(),n.store.storeRoom(r),n.emit(Oe.Room,r),e.processEventsForNotifs(r,i),r}})),function(e){return l.apply(this,arguments)})));return c.filter(Boolean)}))()}peek(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:20;if((null===(t=this._peekRoom)||void 0===t?void 0:t.roomId)===e)return Promise.resolve(this._peekRoom);var r=this.client;return this._peekRoom=this.createRoom(e),this.client.roomInitialSync(e,n).then((t=>{var n;if((null===(n=this._peekRoom)||void 0===n?void 0:n.roomId)!==e)throw new Error("Peeking aborted");t.messages=t.messages||{chunk:[]},t.messages.chunk=t.messages.chunk||[],t.state=t.state||[];var i=wE(t.state).map(r.getEventMapper()),o=t.state.map(r.getEventMapper()),s=t.messages.chunk.map(r.getEventMapper());return Array.isArray(t.presence)&&t.presence.map(r.getEventMapper()).forEach((function(e){var t=r.store.getUser(e.getContent().user_id);t?t.setPresenceEvent(e):((t=El.createUser(e.getContent().user_id,r)).setPresenceEvent(e),r.store.storeUser(t)),r.emit(Oe.Event,e)})),t.messages.start&&(this._peekRoom.oldState.paginationToken=t.messages.start),this._peekRoom.oldState.setStateEvents(i),this._peekRoom.currentState.setStateEvents(o),this.resolveInvites(this._peekRoom),this._peekRoom.recalculate(),this._peekRoom.addEventsToTimeline(s.reverse(),!0,!0,this._peekRoom.getLiveTimeline(),t.messages.start),r.store.storeRoom(this._peekRoom),r.emit(Oe.Room,this._peekRoom),this.peekPoll(this._peekRoom),this._peekRoom}))}stopPeeking(){this._peekRoom=null}peekPoll(e,t){var n,r,i=this;this._peekRoom===e?this.client.http.authedRequest(ae.Get,"/events",{room_id:e.roomId,timeout:String(3e4),from:t},void 0,{localTimeoutMs:5e4,abortSignal:null===(n=this.abortController)||void 0===n?void 0:n.signal}).then((r=U((function*(t){if(i._peekRoom===e){t.chunk.filter((function(e){return"m.presence"===e.type})).map(i.client.getEventMapper()).forEach((e=>{var t=i.client.store.getUser(e.getContent().user_id);t?t.setPresenceEvent(e):((t=El.createUser(e.getContent().user_id,i.client)).setPresenceEvent(e),i.client.store.storeUser(t)),i.client.emit(Oe.Event,e)}));var n=t.chunk.filter((function(t){return t.room_id===e.roomId&&t.event_id})).map(i.client.getEventMapper());yield e.addLiveEvents(n,{addToState:!0}),i.peekPoll(e,t.end)}else Tn("Stopped peeking in room %s",e.roomId)})),function(e){return r.apply(this,arguments)}),(n=>{A.error("[%s] Peek poll failed: %s",e.roomId,n),setTimeout((()=>{this.peekPoll(e,t)}),3e4)})):Tn("Stopped peeking in room %s",e.roomId)}getSyncState(){return this.syncState}getSyncStateData(){var e;return null!==(e=this.syncStateData)&&void 0!==e?e:null}recoverFromSyncStartupError(e,t){var n=this;return U((function*(){yield e;var r=n.startKeepAlives();n.updateSyncState(Dt.Error,{error:t}),yield r}))()}shouldAbortSync(e){return"M_UNKNOWN_TOKEN"===e.errcode&&(A.warn("Token no longer valid - assuming logout"),this.stop(),this.updateSyncState(Dt.Error,{error:e}),!0)}sync(){var e=this;return U((function*(){var t,n;if(e.running=!0,e.abortController=new AbortController,null===(t=globalThis.window)||void 0===t||null===(n=t.addEventListener)||void 0===n||n.call(t,"online",e.onOnline,!1),e.client.isGuest())return e.doSync({});Tn("Getting saved sync token...");var r=e.client.store.getSavedSyncToken().then((e=>(Tn("Got saved sync token"),e)));e.savedSyncPromise=e.client.store.getSavedSync().then((t=>{if(Tn("Got reply from saved sync, exists? ".concat(!!t)),t)return e.syncFromCache(t)})).catch((e=>{A.error("Getting saved sync failed",e)})),yield e.getPushRules(),yield e.prepareLazyLoadingForSync(),yield e.storeClientOptions();var{filterId:i,filter:o}=yield e.getFilter();if(o){if(e.client.resetNotifTimelineSet(),!e.currentSyncRequest){var s=i,a=yield r;if(a)Tn("Sending first sync request...");else{Tn("Sending initial sync request...");var l=e.buildDefaultFilter();l.setDefinition(o.getDefinition()),l.setTimelineLimit(e.opts.initialSyncLimit),s=JSON.stringify(l.getDefinition())}e.currentSyncRequest=e.doSyncRequest({filter:s},a)}return Tn("Waiting for saved sync before starting sync processing..."),yield e.savedSyncPromise,e.doSync({filter:i})}}))()}stop(){var e,t,n;Tn("SyncApi.stop"),null===(e=globalThis.window)||void 0===e||null===(t=e.removeEventListener)||void 0===t||t.call(e,"online",this.onOnline,!1),this.running=!1,null===(n=this.abortController)||void 0===n||n.abort(),this.keepAliveTimer&&(clearTimeout(this.keepAliveTimer),this.keepAliveTimer=void 0)}retryImmediately(){return!!this.connectionReturnedDefer&&(this.startKeepAlives(0),!0)}syncFromCache(e){var t=this;return U((function*(){Tn("sync(): not doing HTTP hit, instead returning stored /sync data");var n=e.nextBatch;t.client.store.setSyncToken(n);var r={nextSyncToken:n,catchingUp:!1,fromCache:!0},i={next_batch:n,rooms:e.roomsData,account_data:{events:e.accountData}};try{yield t.processSyncResponse(r,i)}catch(e){A.error("Error processing cached sync",e)}t.storeIsInvalid||t.updateSyncState(Dt.Prepared,r)}))()}doSync(e){var t=this;return U((function*(){for(;t.running;){var n=t.client.store.getSyncToken(),r=void 0;try{t.currentSyncRequest||(t.currentSyncRequest=t.doSyncRequest(e,n)),r=yield t.currentSyncRequest}catch(e){if(yield t.onSyncError(e))return;continue}finally{t.currentSyncRequest=void 0}t.client.store.setSyncToken(r.next_batch),t.failedSyncCount=0;var i={oldSyncToken:n??void 0,nextSyncToken:r.next_batch,catchingUp:t.catchingUp};try{yield t.processSyncResponse(i,r)}catch(e){A.error("Caught /sync error",e),t.client.emit(Oe.SyncUnexpectedError,e)}yield t.client.store.setSyncData(r),i.catchingUp=t.catchingUp,e.hasSyncedBefore||(t.updateSyncState(Dt.Prepared,i),e.hasSyncedBefore=!0),t.syncOpts.cryptoCallbacks&&(yield t.syncOpts.cryptoCallbacks.onSyncCompleted(i)),t.updateSyncState(Dt.Syncing,i),t.client.store.wantsSave()&&(yield t.client.store.save())}t.running||(Tn("Sync no longer running: exiting."),t.connectionReturnedDefer&&(t.connectionReturnedDefer.reject(),t.connectionReturnedDefer=void 0),t.updateSyncState(Dt.Stopped))}))()}doSyncRequest(e,t){var n,r=this.getSyncParams(e,t);return this.client.http.authedRequest(ae.Get,"/sync",r,void 0,{localTimeoutMs:r.timeout+G5,abortSignal:null===(n=this.abortController)||void 0===n?void 0:n.signal})}getSyncParams(e,t){var n=this.opts.pollTimeout;(this.getSyncState()!==Dt.Syncing||this.catchingUp)&&(this.catchingUp=!0,n=0);var r=e.filter;this.client.isGuest()&&!r&&(r=this.getGuestFilter());var i={filter:r,timeout:n,"org.matrix.msc4222.use_state_after":!0};return this.opts.disablePresence?i.set_presence=cH.Offline:void 0!==this.presence&&(i.set_presence=this.presence),t?i.since=t:i._cacheBuster=Date.now(),[Dt.Reconnecting,Dt.Error].includes(this.getSyncState())&&(i.timeout=0),i}setPresence(e){this.presence=e}onSyncError(e){var t=this;return U((function*(){if(!t.running)return Tn("Sync no longer running: exiting"),t.connectionReturnedDefer&&(t.connectionReturnedDefer.reject(),t.connectionReturnedDefer=void 0),t.updateSyncState(Dt.Stopped),!0;if(A.error("/sync error %s",e),t.shouldAbortSync(e))return!0;t.failedSyncCount++,A.log("Number of consecutive failed sync requests:",t.failedSyncCount),Tn("Starting keep-alive");var n=t.startKeepAlives();return t.currentSyncRequest=void 0,t.updateSyncState(t.failedSyncCount>=Cse?Dt.Error:Dt.Reconnecting,{error:e}),(yield n)&&t.getSyncState()===Dt.Error&&t.updateSyncState(Dt.Catchup,{catchingUp:!0}),!1}))()}processSyncResponse(e,t){var n=this;return U((function*(){var r,i,o,s,a=n.client;if(Array.isArray(null===(r=t.presence)||void 0===r?void 0:r.events)&&t.presence.events.filter(Io).map(a.getEventMapper()).forEach((function(e){var t=a.store.getUser(e.getSender());t?t.setPresenceEvent(e):((t=El.createUser(e.getSender(),a)).setPresenceEvent(e),a.store.storeUser(t)),a.emit(Oe.Event,e)})),Array.isArray(null===(i=t.account_data)||void 0===i?void 0:i.events)){var l=t.account_data.events.filter(Io).map(a.getEventMapper()),c=l.reduce(((e,t)=>(e[t.getType()]=a.store.getAccountData(t.getType()),e)),{});a.store.storeAccountDataEvents(l),l.forEach((function(e){if(e.getType()===ee.PushRules){var t=e.getContent();a.setPushRules(t)}var n=c[e.getType()];return a.emit(Oe.AccountData,e,n),e}))}if(t.to_device&&Array.isArray(t.to_device.events)&&t.to_device.events.length>0){var u=t.to_device.events.filter(Io);n.syncOpts.cryptoCallbacks&&(u=yield n.syncOpts.cryptoCallbacks.preprocessToDeviceMessages(u));var d=[];u.map(hH).map((e=>{if("m.key.verification.cancel"===e.getType()){var t=e.getContent().transaction_id;t&&d.push(t)}return e})).forEach((function(e){var t=e.getContent();if("m.room.message"!=e.getType()||"m.bad.encrypted"!=t.msgtype){if("m.key.verification.start"===e.getType()||"m.key.verification.request"===e.getType()){var n=t.transaction_id;d.includes(n)&&e.flagCancelled()}a.emit(Oe.ToDeviceEvent,e)}else A.log("Ignoring undecryptable to-device event from "+e.getSender())}))}else n.catchingUp=!1;var h,p=[],f=[],m=[],v=[];t.rooms&&(t.rooms.invite&&(p=n.mapSyncResponseToRoomArray(t.rooms.invite)),t.rooms.join&&(f=n.mapSyncResponseToRoomArray(t.rooms.join)),t.rooms.leave&&(m=n.mapSyncResponseToRoomArray(t.rooms.leave)),t.rooms.knock&&(v=n.mapSyncResponseToRoomArray(t.rooms.knock))),n.notifEvents=[],yield yh(p,(h=U((function*(e){var t=e.room,r=n.mapSyncEventsFormat(e.invite_state,t);yield n.injectRoomEvents(t,r,void 0),e.isBrandNewRoom?(t.recalculate(),a.store.storeRoom(t),a.emit(Oe.Room,t)):t.recalculate(),r.forEach((function(e){a.emit(Oe.Event,e)}))})),function(e){return h.apply(this,arguments)})),yield yh(f,function(){var t=U((function*(t){var r,i=t.room,o=n.mapSyncEventsFormat(t.state,i),s=n.mapSyncEventsFormat(t["org.matrix.msc4222.state_after"],i),l=n.mapSyncEventsFormat(t.timeline,i,!1),c=n.mapSyncEventsFormat(t.ephemeral),u=n.mapSyncEventsFormat(t.account_data),d=t["org.matrix.msc4222.state_after"]?s:o.concat(l),h=n.isRoomEncrypted(i,d);if(t.unread_notifications){var p,f;if(!h||0===t.unread_notifications.notification_count)i.setUnreadNotificationCount(jt.Total,null!==(p=t.unread_notifications.notification_count)&&void 0!==p?p:0);if(!h||i.getUnreadNotificationCount(jt.Highlight)<=0)i.setUnreadNotificationCount(jt.Highlight,null!==(f=t.unread_notifications.highlight_count)&&void 0!==f?f:0)}var m=null!==(r=t[Tv.name])&&void 0!==r?r:t[Tv.altName];if(m)for(var[v,g]of(i.resetThreadUnreadNotificationCountFromSync(Object.keys(m)),Object.entries(m))){var y;if(!h||0===g.notification_count)i.setThreadUnreadNotificationCount(v,jt.Total,null!==(y=g.notification_count)&&void 0!==y?y:0);var b,_=i.getThreadUnreadNotificationCount(v,jt.Highlight)<=0;if(!h||h&&_)i.setThreadUnreadNotificationCount(v,jt.Highlight,null!==(b=g.highlight_count)&&void 0!==b?b:0)}else i.resetThreadUnreadNotificationCountFromSync();if(t.timeline=t.timeline||{},t.isBrandNewRoom)null!==t.timeline.prev_batch&&i.getLiveTimeline().setPaginationToken(t.timeline.prev_batch,Le.BACKWARDS);else if(t.timeline.limited){for(var w=!0,E=l.length-1;E>=0;E--){var S=l[E].getId();if(i.getTimelineForEvent(S)){Tn("Already have event ".concat(S," in limited sync - not resetting")),w=!1,l.splice(0,E);break}}var C;if(w)i.resetLiveTimeline(t.timeline.prev_batch,n.syncOpts.canResetEntireTimeline(i.roomId)?null:null!==(C=e.oldSyncToken)&&void 0!==C?C:null),a.resetNotifTimelineSet()}if(n.syncOpts.cryptoCallbacks)for(var k of d)k.isState()&&k.getType()===ee.RoomEncryption&&""===k.getStateKey()&&(yield n.syncOpts.cryptoCallbacks.onCryptoEvent(i,k));try{"org.matrix.msc4222.state_after"in t?yield n.injectRoomEvents(i,void 0,s,l,e.fromCache):yield n.injectRoomEvents(i,o,void 0,l,e.fromCache)}catch(e){A.error("Failed to process events on room ".concat(i.roomId,":"),e)}t.summary&&i.setSummary(t.summary),i.addEphemeralEvents(c),i.addAccountData(u),i.recalculate(),t.isBrandNewRoom&&(a.store.storeRoom(i),a.emit(Oe.Room,i)),n.processEventsForNotifs(i,l);var T=e=>a.emit(Oe.Event,e);o.forEach(T),l.forEach(T),c.forEach(T),u.forEach(T),i.decryptCriticalEvents()}));return function(e){return t.apply(this,arguments)}}()),yield yh(m,function(){var e=U((function*(e){var t=e.room,{timelineEvents:r,stateEvents:i,stateAfterEvents:o}=yield n.mapAndInjectRoomEvents(e),s=n.mapSyncEventsFormat(e.account_data);t.addAccountData(s),t.recalculate(),e.isBrandNewRoom&&(a.store.storeRoom(t),a.emit(Oe.Room,t)),n.processEventsForNotifs(t,r),null==i||i.forEach((function(e){a.emit(Oe.Event,e)})),null==o||o.forEach((function(e){a.emit(Oe.Event,e)})),r.forEach((function(e){a.emit(Oe.Event,e)})),s.forEach((function(e){a.emit(Oe.Event,e)}))}));return function(t){return e.apply(this,arguments)}}()),yield yh(v,function(){var e=U((function*(e){var t=e.room,r=n.mapSyncEventsFormat(e.knock_state,t);yield n.injectRoomEvents(t,r,void 0),e.isBrandNewRoom?(t.recalculate(),a.store.storeRoom(t),a.emit(Oe.Room,t)):t.recalculate(),r.forEach((function(e){a.emit(Oe.Event,e)}))}));return function(t){return e.apply(this,arguments)}}()),e.oldSyncToken&&n.notifEvents.length&&(n.notifEvents.sort((function(e,t){return e.getTs()-t.getTs()})),n.notifEvents.forEach((function(e){var t;null===(t=a.getNotifTimelineSet())||void 0===t||t.addLiveEvent(e,{addToState:!0})}))),t.device_lists&&n.syncOpts.cryptoCallbacks&&(yield n.syncOpts.cryptoCallbacks.processDeviceLists(t.device_lists)),yield null===(o=n.syncOpts.cryptoCallbacks)||void 0===o?void 0:o.processKeyCounts(t.device_one_time_keys_count,null!==(s=t.device_unused_fallback_key_types)&&void 0!==s?s:t["org.matrix.msc2732.device_unused_fallback_key_types"])}))()}startKeepAlives(e){return void 0===e&&(e=2e3+Math.floor(5e3*Math.random())),null!==this.keepAliveTimer&&clearTimeout(this.keepAliveTimer),e>0?this.keepAliveTimer=setTimeout(this.pokeKeepAlive.bind(this),e):this.pokeKeepAlive(),this.connectionReturnedDefer||(this.connectionReturnedDefer=ou()),this.connectionReturnedDefer.promise}pokeKeepAlive(){var e,t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this.running)return clearTimeout(this.keepAliveTimer),void(this.connectionReturnedDefer&&(this.connectionReturnedDefer.reject("SyncApi.stop() was called"),this.connectionReturnedDefer=void 0));var n=()=>{clearTimeout(this.keepAliveTimer),this.connectionReturnedDefer&&(this.connectionReturnedDefer.resolve(t),this.connectionReturnedDefer=void 0)};this.client.http.request(ae.Get,"/_matrix/client/versions",void 0,void 0,{prefix:"",localTimeoutMs:15e3,abortSignal:null===(e=this.abortController)||void 0===e?void 0:e.signal}).then((()=>{n()}),(e=>{400==e.httpStatus||404==e.httpStatus?this.keepAliveTimer=setTimeout(n,2e3):(t=!0,this.keepAliveTimer=setTimeout(this.pokeKeepAlive.bind(this,t),5e3+Math.floor(5e3*Math.random())),this.updateSyncState(Dt.Error,{error:e}))}))}mapSyncResponseToRoomArray(e){var t=this.client;return Object.keys(e).filter((e=>!Bg(e))).map((n=>{var r=t.store.getRoom(n),i=!1;return r||(r=this.createRoom(n),i=!0),Jb(Jb({},e[n]),{},{room:r,isBrandNewRoom:i})}))}mapSyncEventsFormat(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(!e||!Array.isArray(e.events))return[];var r=this.client.getEventMapper({decrypt:n});return e.events.filter(Io).map((function(e){return t&&(e.room_id=t.roomId),r(e)}))}resolveInvites(e){if(e&&this.opts.resolveInvitesToProfiles){var t=this.client;e.getMembersWithMembership(Ke.Invite).forEach((function(n){if(!n.requestedProfileInfo){n.requestedProfileInfo=!0;var r=t.getUser(n.userId);(r?Promise.resolve({avatar_url:r.avatarUrl,displayname:r.displayName}):t.getProfileInfo(n.userId)).then((function(t){var r=n.events.member;(null==r?void 0:r.getContent().membership)===Ke.Invite&&(r.getContent().avatar_url=t.avatar_url,r.getContent().displayname=t.displayname,n.setMembershipEvent(r,e.currentState))}),(function(e){}))}}))}}findEncryptionEvent(e){return null==e?void 0:e.find((e=>e.getType()===ee.RoomEncryption&&""===e.getStateKey()))}isRoomEncrypted(e,t){return e.hasEncryptionStateEvent()||!!this.findEncryptionEvent(t)}mapAndInjectRoomEvents(e){var t=this;return U((function*(){var n=t.mapSyncEventsFormat(e.state,e.room),r=t.mapSyncEventsFormat(e["org.matrix.msc4222.state_after"],e.room),i=t.mapSyncEventsFormat(e.timeline,e.room);return"org.matrix.msc4222.state_after"in e?yield t.injectRoomEvents(e.room,void 0,r,i):yield t.injectRoomEvents(e.room,n,void 0,i),{timelineEvents:i,stateEvents:n,stateAfterEvents:r}}))()}injectRoomEvents(e,t,n,r){var i=arguments,o=this;return U((function*(){var s=i.length>4&&void 0!==i[4]&&i[4],a=n??t,l=e.getLiveTimeline(),c=0==l.getEvents().length;if(c){for(var u of a)o.client.getPushActionsForEvent(u);l.initialiseState(a,{timelineWasEmpty:c})}o.resolveInvites(e),e.recalculate(),c||(e.oldState.setStateEvents(a),e.currentState.setStateEvents(a)),yield e.addLiveEvents(r||[],{fromCache:s,timelineWasEmpty:c,addToState:void 0===n}),o.client.processBeaconEvents(e,r)}))()}processEventsForNotifs(e,t){if(this.client.getNotifTimelineSet())for(var n of t){var r,i=this.client.getPushActionsForEvent(n);null!=i&&i.notify&&null!==(r=i.tweaks)&&void 0!==r&&r.highlight&&this.notifEvents.push(n)}}getGuestFilter(){return"{}"}updateSyncState(e,t){var n=this.syncState;this.syncState=e,this.syncStateData=t,this.client.emit(Oe.Sync,this.syncState,n,t)}}function fH(e,t,n){var{timelineSupport:r}=e,i=new xE(t,e,e.getUserId(),{lazyLoadMembers:n.lazyLoadMembers,pendingEventOrdering:n.pendingEventOrdering,timelineSupport:r});return e.reEmitter.reEmit(i,[ke.Name,ke.Redaction,ke.RedactionCancelled,ke.Receipt,ke.Tags,ke.LocalEchoUpdated,ke.AccountData,ke.MyMembership,ke.Timeline,ke.TimelineReset,ut.Events,ut.Members,ut.NewMember,ut.Update,yn.New,yn.Update,yn.Destroy,yn.LivenessChange]),i.on(ut.NewMember,((t,n,r)=>{var i;r.user=null!==(i=e.getUser(r.userId))&&void 0!==i?i:void 0,e.reEmitter.reEmit(r,[Gi.Name,Gi.Typing,Gi.PowerLevel,Gi.Membership])})),i}function hH(e){return delete e.room_id,new Ci(e)}class Rse{constructor(){L(this,"accountData",new Map),L(this,"fromToken",null)}isNewlyCreated(){return Promise.resolve(!0)}getSyncToken(){return this.fromToken}setSyncToken(e){this.fromToken=e}storeRoom(e){}getRoom(e){return null}getRooms(){return[]}removeRoom(e){}getRoomSummaries(){return[]}storeUser(e){}getUser(e){return null}getUsers(){return[]}scrollback(e,t){return[]}setUserCreator(e){}storeEvents(e,t,n,r){}storeFilter(e){}getFilter(e,t){return null}getFilterIdByName(e){return null}setFilterIdByName(e,t){}storeAccountDataEvents(e){}getAccountData(e){}setSyncData(e){return Promise.resolve()}wantsSave(){return!1}save(){return Promise.resolve()}startup(){return Promise.resolve()}getSavedSync(){return Promise.resolve(null)}getSavedSyncToken(){return Promise.resolve(null)}deleteAllData(){return Promise.resolve()}getOutOfBandMembers(){return Promise.resolve(null)}setOutOfBandMembers(e,t){return Promise.resolve()}clearOutOfBandMembers(){return Promise.resolve()}getClientOptions(){return Promise.resolve(void 0)}storeClientOptions(e){return Promise.resolve()}getPendingEvents(e){return U((function*(){return[]}))()}setPendingEvents(e,t){return Promise.resolve()}saveToDeviceBatches(e){return U((function*(){return Promise.resolve()}))()}getOldestToDeviceBatch(){return Promise.resolve(null)}removeToDeviceBatch(e){return U((function*(){return Promise.resolve()}))()}destroy(){return U((function*(){}))()}}const Vr=[];for(let e=0;e<256;++e)Vr.push((e+256).toString(16).slice(1));function Ise(e,t=0){return(Vr[e[t+0]]+Vr[e[t+1]]+Vr[e[t+2]]+Vr[e[t+3]]+"-"+Vr[e[t+4]]+Vr[e[t+5]]+"-"+Vr[e[t+6]]+Vr[e[t+7]]+"-"+Vr[e[t+8]]+Vr[e[t+9]]+"-"+Vr[e[t+10]]+Vr[e[t+11]]+Vr[e[t+12]]+Vr[e[t+13]]+Vr[e[t+14]]+Vr[e[t+15]]).toLowerCase()}let ZT;const kse=new Uint8Array(16);function xse(){if(!ZT){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");ZT=crypto.getRandomValues.bind(crypto)}return ZT(kse)}const Pse=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),z5={randomUUID:Pse};function Lse(e,t,n){var r;if(z5.randomUUID&&!e)return z5.randomUUID();const i=(e=e||{}).random??(null==(r=e.rng)?void 0:r.call(e))??xse();if(i.length<16)throw new Error("Random bytes length must be >= 16");return i[6]=15&i[6]|64,i[8]=63&i[8]|128,Ise(i)}var Y5,J5,t2,X5,Z5,go={},QT={},e2={exports:{}};function BP(){if(Y5)return e2.exports;Y5=1;var e=e2.exports={v:[{name:"version",reg:/^(\d*)$/}],o:[{name:"origin",reg:/^(\S*) (\d*) (\d*) (\S*) IP(\d) (\S*)/,names:["username","sessionId","sessionVersion","netType","ipVer","address"],format:"%s %s %d %s IP%d %s"}],s:[{name:"name"}],i:[{name:"description"}],u:[{name:"uri"}],e:[{name:"email"}],p:[{name:"phone"}],z:[{name:"timezones"}],r:[{name:"repeats"}],t:[{name:"timing",reg:/^(\d*) (\d*)/,names:["start","stop"],format:"%d %d"}],c:[{name:"connection",reg:/^IN IP(\d) (\S*)/,names:["version","ip"],format:"IN IP%d %s"}],b:[{push:"bandwidth",reg:/^(TIAS|AS|CT|RR|RS):(\d*)/,names:["type","limit"],format:"%s:%s"}],m:[{reg:/^(\w*) (\d*) ([\w/]*)(?: (.*))?/,names:["type","port","protocol","payloads"],format:"%s %d %s %s"}],a:[{push:"rtp",reg:/^rtpmap:(\d*) ([\w\-.]*)(?:\s*\/(\d*)(?:\s*\/(\S*))?)?/,names:["payload","codec","rate","encoding"],format:function(e){return e.encoding?"rtpmap:%d %s/%s/%s":e.rate?"rtpmap:%d %s/%s":"rtpmap:%d %s"}},{push:"fmtp",reg:/^fmtp:(\d*) ([\S| ]*)/,names:["payload","config"],format:"fmtp:%d %s"},{name:"control",reg:/^control:(.*)/,format:"control:%s"},{name:"rtcp",reg:/^rtcp:(\d*)(?: (\S*) IP(\d) (\S*))?/,names:["port","netType","ipVer","address"],format:function(e){return null!=e.address?"rtcp:%d %s IP%d %s":"rtcp:%d"}},{push:"rtcpFbTrrInt",reg:/^rtcp-fb:(\*|\d*) trr-int (\d*)/,names:["payload","value"],format:"rtcp-fb:%s trr-int %d"},{push:"rtcpFb",reg:/^rtcp-fb:(\*|\d*) ([\w-_]*)(?: ([\w-_]*))?/,names:["payload","type","subtype"],format:function(e){return null!=e.subtype?"rtcp-fb:%s %s %s":"rtcp-fb:%s %s"}},{push:"ext",reg:/^extmap:(\d+)(?:\/(\w+))?(?: (urn:ietf:params:rtp-hdrext:encrypt))? (\S*)(?: (\S*))?/,names:["value","direction","encrypt-uri","uri","config"],format:function(e){return"extmap:%d"+(e.direction?"/%s":"%v")+(e["encrypt-uri"]?" %s":"%v")+" %s"+(e.config?" %s":"")}},{name:"extmapAllowMixed",reg:/^(extmap-allow-mixed)/},{push:"crypto",reg:/^crypto:(\d*) ([\w_]*) (\S*)(?: (\S*))?/,names:["id","suite","config","sessionConfig"],format:function(e){return null!=e.sessionConfig?"crypto:%d %s %s %s":"crypto:%d %s %s"}},{name:"setup",reg:/^setup:(\w*)/,format:"setup:%s"},{name:"connectionType",reg:/^connection:(new|existing)/,format:"connection:%s"},{name:"mid",reg:/^mid:([^\s]*)/,format:"mid:%s"},{name:"msid",reg:/^msid:(.*)/,format:"msid:%s"},{name:"ptime",reg:/^ptime:(\d*(?:\.\d*)*)/,format:"ptime:%d"},{name:"maxptime",reg:/^maxptime:(\d*(?:\.\d*)*)/,format:"maxptime:%d"},{name:"direction",reg:/^(sendrecv|recvonly|sendonly|inactive)/},{name:"icelite",reg:/^(ice-lite)/},{name:"iceUfrag",reg:/^ice-ufrag:(\S*)/,format:"ice-ufrag:%s"},{name:"icePwd",reg:/^ice-pwd:(\S*)/,format:"ice-pwd:%s"},{name:"fingerprint",reg:/^fingerprint:(\S*) (\S*)/,names:["type","hash"],format:"fingerprint:%s %s"},{push:"candidates",reg:/^candidate:(\S*) (\d*) (\S*) (\d*) (\S*) (\d*) typ (\S*)(?: raddr (\S*) rport (\d*))?(?: tcptype (\S*))?(?: generation (\d*))?(?: network-id (\d*))?(?: network-cost (\d*))?/,names:["foundation","component","transport","priority","ip","port","type","raddr","rport","tcptype","generation","network-id","network-cost"],format:function(e){var t="candidate:%s %d %s %d %s %d typ %s";return t+=null!=e.raddr?" raddr %s rport %d":"%v%v",t+=null!=e.tcptype?" tcptype %s":"%v",null!=e.generation&&(t+=" generation %d"),t+=null!=e["network-id"]?" network-id %d":"%v",t+=null!=e["network-cost"]?" network-cost %d":"%v"}},{name:"endOfCandidates",reg:/^(end-of-candidates)/},{name:"remoteCandidates",reg:/^remote-candidates:(.*)/,format:"remote-candidates:%s"},{name:"iceOptions",reg:/^ice-options:(\S*)/,format:"ice-options:%s"},{push:"ssrcs",reg:/^ssrc:(\d*) ([\w_-]*)(?::(.*))?/,names:["id","attribute","value"],format:function(e){var t="ssrc:%d";return null!=e.attribute&&(t+=" %s",null!=e.value&&(t+=":%s")),t}},{push:"ssrcGroups",reg:/^ssrc-group:([\x21\x23\x24\x25\x26\x27\x2A\x2B\x2D\x2E\w]*) (.*)/,names:["semantics","ssrcs"],format:"ssrc-group:%s %s"},{name:"msidSemantic",reg:/^msid-semantic:\s?(\w*) (\S*)/,names:["semantic","token"],format:"msid-semantic: %s %s"},{push:"groups",reg:/^group:(\w*) (.*)/,names:["type","mids"],format:"group:%s %s"},{name:"rtcpMux",reg:/^(rtcp-mux)/},{name:"rtcpRsize",reg:/^(rtcp-rsize)/},{name:"sctpmap",reg:/^sctpmap:([\w_/]*) (\S*)(?: (\S*))?/,names:["sctpmapNumber","app","maxMessageSize"],format:function(e){return null!=e.maxMessageSize?"sctpmap:%s %s %s":"sctpmap:%s %s"}},{name:"xGoogleFlag",reg:/^x-google-flag:([^\s]*)/,format:"x-google-flag:%s"},{push:"rids",reg:/^rid:([\d\w]+) (\w+)(?: ([\S| ]*))?/,names:["id","direction","params"],format:function(e){return e.params?"rid:%s %s %s":"rid:%s %s"}},{push:"imageattrs",reg:new RegExp("^imageattr:(\\d+|\\*)[\\s\\t]+(send|recv)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*)(?:[\\s\\t]+(recv|send)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*))?"),names:["pt","dir1","attrs1","dir2","attrs2"],format:function(e){return"imageattr:%s %s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast",reg:new RegExp("^simulcast:(send|recv) ([a-zA-Z0-9\\-_~;,]+)(?:\\s?(send|recv) ([a-zA-Z0-9\\-_~;,]+))?$"),names:["dir1","list1","dir2","list2"],format:function(e){return"simulcast:%s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast_03",reg:/^simulcast:[\s\t]+([\S+\s\t]+)$/,names:["value"],format:"simulcast: %s"},{name:"framerate",reg:/^framerate:(\d+(?:$|\.\d+))/,format:"framerate:%s"},{name:"sourceFilter",reg:/^source-filter: *(excl|incl) (\S*) (IP4|IP6|\*) (\S*) (.*)/,names:["filterMode","netType","addressTypes","destAddress","srcList"],format:"source-filter: %s %s %s %s %s"},{name:"bundleOnly",reg:/^(bundle-only)/},{name:"label",reg:/^label:(.+)/,format:"label:%s"},{name:"sctpPort",reg:/^sctp-port:(\d+)$/,format:"sctp-port:%s"},{name:"maxMessageSize",reg:/^max-message-size:(\d+)$/,format:"max-message-size:%s"},{push:"tsRefClocks",reg:/^ts-refclk:([^\s=]*)(?:=(\S*))?/,names:["clksrc","clksrcExt"],format:function(e){return"ts-refclk:%s"+(null!=e.clksrcExt?"=%s":"")}},{name:"mediaClk",reg:/^mediaclk:(?:id=(\S*))? *([^\s=]*)(?:=(\S*))?(?: *rate=(\d+)\/(\d+))?/,names:["id","mediaClockName","mediaClockValue","rateNumerator","rateDenominator"],format:function(e){var t="mediaclk:";return t+=null!=e.id?"id=%s %s":"%v%s",t+=null!=e.mediaClockValue?"=%s":"",t+=null!=e.rateNumerator?" rate=%s":"",t+=null!=e.rateDenominator?"/%s":""}},{name:"keywords",reg:/^keywds:(.+)$/,format:"keywds:%s"},{name:"content",reg:/^content:(.+)/,format:"content:%s"},{name:"bfcpFloorCtrl",reg:/^floorctrl:(c-only|s-only|c-s)/,format:"floorctrl:%s"},{name:"bfcpConfId",reg:/^confid:(\d+)/,format:"confid:%s"},{name:"bfcpUserId",reg:/^userid:(\d+)/,format:"userid:%s"},{name:"bfcpFloorId",reg:/^floorid:(.+) (?:m-stream|mstrm):(.+)/,names:["id","mStream"],format:"floorid:%s mstrm:%s"},{push:"invalid",names:["value"]}]};return Object.keys(e).forEach((function(t){e[t].forEach((function(e){e.reg||(e.reg=/(.*)/),e.format||(e.format="%s")}))})),e2.exports}function Ose(){return J5||(J5=1,function(e){var t=function(e){return String(Number(e))===e?Number(e):e},n=function(e,n,r){var i=e.name&&e.names;e.push&&!n[e.push]?n[e.push]=[]:i&&!n[e.name]&&(n[e.name]={});var o=e.push?{}:i?n[e.name]:n;(function(e,n,r,i){if(i&&!r)n[i]=t(e[1]);else for(var o=0;o<r.length;o+=1)null!=e[o+1]&&(n[r[o]]=t(e[o+1]))})(r.match(e.reg),o,e.names,e.name),e.push&&n[e.push].push(o)},r=BP(),i=RegExp.prototype.test.bind(/^([a-z])=(.*)/);e.parse=function(e){var t={},o=[],s=t;return e.split(/(\r\n|\r|\n)/).filter(i).forEach((function(e){var t=e[0],i=e.slice(2);"m"===t&&(o.push({rtp:[],fmtp:[]}),s=o[o.length-1]);for(var a=0;a<(r[t]||[]).length;a+=1){var l=r[t][a];if(l.reg.test(i))return n(l,s,i)}})),t.media=o,t};var o=function(e,n){var r=n.split(/=(.+)/,2);return 2===r.length?e[r[0]]=t(r[1]):1===r.length&&n.length>1&&(e[r[0]]=void 0),e};e.parseParams=function(e){return e.split(/;\s?/).reduce(o,{})},e.parseFmtpConfig=e.parseParams,e.parsePayloads=function(e){return e.toString().split(" ").map(Number)},e.parseRemoteCandidates=function(e){for(var n=[],r=e.split(" ").map(t),i=0;i<r.length;i+=3)n.push({component:r[i],ip:r[i+1],port:r[i+2]});return n},e.parseImageAttributes=function(e){return e.split(" ").map((function(e){return e.substring(1,e.length-1).split(",").reduce(o,{})}))},e.parseSimulcastStreamList=function(e){return e.split(";").map((function(e){return e.split(",").map((function(e){var n,r=!1;return"~"!==e[0]?n=t(e):(n=t(e.substring(1,e.length)),r=!0),{scid:n,paused:r}}))}))}}(QT)),QT}function Mse(){if(X5)return t2;X5=1;var e=BP(),t=/%[sdv%]/g,n=function(e){var n=1,r=arguments,i=r.length;return e.replace(t,(function(e){if(n>=i)return e;var t=r[n];switch(n+=1,e){case"%%":return"%";case"%s":return String(t);case"%d":return Number(t);case"%v":return""}}))},r=function(e,t,r){var i=[e+"="+(t.format instanceof Function?t.format(t.push?r:r[t.name]):t.format)];if(t.names)for(var o=0;o<t.names.length;o+=1){var s=t.names[o];t.name?i.push(r[t.name][s]):i.push(r[t.names[o]])}else i.push(r[t.name]);return n.apply(null,i)},i=["v","o","s","i","u","e","p","c","b","t","r","z","a"],o=["i","c","b","a"];return t2=function(t,n){n=n||{},null==t.version&&(t.version=0),null==t.name&&(t.name=" "),t.media.forEach((function(e){null==e.payloads&&(e.payloads="")}));var s=n.outerOrder||i,a=n.innerOrder||o,l=[];return s.forEach((function(n){e[n].forEach((function(e){e.name in t&&null!=t[e.name]?l.push(r(n,e,t)):e.push in t&&null!=t[e.push]&&t[e.push].forEach((function(t){l.push(r(n,e,t))}))}))})),t.media.forEach((function(t){l.push(r("m",e.m[0],t)),a.forEach((function(n){e[n].forEach((function(e){e.name in t&&null!=t[e.name]?l.push(r(n,e,t)):e.push in t&&null!=t[e.push]&&t[e.push].forEach((function(t){l.push(r(n,e,t))}))}))}))})),l.join("\r\n")+"\r\n"}}function Ase(){if(Z5)return go;Z5=1;var e=Ose(),t=Mse(),n=BP();return go.grammar=n,go.write=t,go.parse=e.parse,go.parseParams=e.parseParams,go.parseFmtpConfig=e.parseFmtpConfig,go.parsePayloads=e.parsePayloads,go.parseRemoteCandidates=e.parseRemoteCandidates,go.parseImageAttributes=e.parseImageAttributes,go.parseSimulcastStreamList=e.parseSimulcastStreamList,go}var pk=Ase();function VP(e,t){if("function"==typeof e.toBase64)return e.toBase64(t);var n=btoa(e.reduce(((e,t)=>e+String.fromCharCode(t)),""));return t.omitPadding&&(n=n.replace(/={1,2}$/,"")),"base64url"===t.alphabet&&(n=n.replace(/\+/g,"-").replace(/\//g,"_")),n}function D_(e){return VP(e,{alphabet:"base64",omitPadding:!1})}function pH(e){return VP(e,{alphabet:"base64",omitPadding:!0})}function PE(e){return VP(e,{alphabet:"base64url",omitPadding:!0})}function Nse(e,t){return"function"==typeof Uint8Array.fromBase64?Uint8Array.fromBase64(e,t):Uint8Array.from(atob(e),(e=>e.charCodeAt(0)))}function Oh(e){return Nse(e.replace(/-/g,"+").replace(/_/g,"/"),{alphabet:"base64",lastChunkHandling:"loose"})}var Dse="abcdefghijklmnopqrstuvwxyz",jse="ABCDEFGHIJKLMNOPQRSTUVWXYZ",Use="0123456789";function mH(e){var t=new Uint8Array(e);return globalThis.crypto.getRandomValues(t),PE(t)}function _s(e){return Fse(e,jse+Dse+Use)}function Fse(e,t){if(t.length<2||t.length>256)throw new Error("Character set must be between 2 and 256 characters long");if(e<1||e>32768)throw new Error("Requested random string length must be between 1 and 32768");for(var n=256-256%t.length,r=new Uint8Array(Math.floor(1.3*e)),i=r.length,o=[];o.length<e;){i===r.length&&(globalThis.crypto.getRandomValues(r),i=0);var s=r[i++];s<n&&o.push(t[s%t.length])}return o.join("")}var vc="org.matrix.msc3077.sdp_stream_metadata",sn=function(e){return e.Usermedia="m.usermedia",e.Screenshare="m.screenshare",e}({}),qg=null,mk=0,$se=()=>(null===qg&&(qg=new AudioContext),mk++,qg),Hse=()=>{var e;0===--mk&&(null===(e=qg)||void 0===e||e.close(),qg=null)},Bse=200,gk=-60,Vse=8,ra=function(e){return e.NewStream="new_stream",e.MuteStateChanged="mute_state_changed",e.LocalVolumeChanged="local_volume_changed",e.VolumeChanged="volume_changed",e.ConnectedChanged="connected_changed",e.Speaking="speaking",e.Disposed="disposed",e}({});class hl extends En{constructor(e){super(),L(this,"stream",void 0),L(this,"sdpMetadataStreamId",void 0),L(this,"userId",void 0),L(this,"deviceId",void 0),L(this,"purpose",void 0),L(this,"speakingVolumeSamples",void 0),L(this,"client",void 0),L(this,"call",void 0),L(this,"roomId",void 0),L(this,"audioMuted",void 0),L(this,"videoMuted",void 0),L(this,"localVolume",1),L(this,"measuringVolumeActivity",!1),L(this,"audioContext",void 0),L(this,"analyser",void 0),L(this,"frequencyBinCount",void 0),L(this,"speakingThreshold",gk),L(this,"speaking",!1),L(this,"volumeLooperTimeout",void 0),L(this,"_disposed",!1),L(this,"_connected",!1),L(this,"onAddTrack",(()=>{this.emit(ra.NewStream,this.stream)})),L(this,"onCallState",(e=>{e===rt.Connected?this.connected=!0:e===rt.Connecting&&(this.connected=!1)})),L(this,"volumeLooper",(()=>{if(this.analyser&&this.measuringVolumeActivity){this.analyser.getFloatFrequencyData(this.frequencyBinCount);var e=-1/0;for(var t of this.frequencyBinCount)t>e&&(e=t);this.speakingVolumeSamples.shift(),this.speakingVolumeSamples.push(e),this.emit(ra.VolumeChanged,e);var n=!1;for(var r of this.speakingVolumeSamples)if(r>this.speakingThreshold){n=!0;break}this.speaking!==n&&(this.speaking=n,this.emit(ra.Speaking,this.speaking)),this.volumeLooperTimeout=setTimeout(this.volumeLooper,Bse)}})),this.client=e.client,this.call=e.call,this.roomId=e.roomId,this.userId=e.userId,this.deviceId=e.deviceId,this.purpose=e.purpose,this.audioMuted=e.audioMuted,this.videoMuted=e.videoMuted,this.speakingVolumeSamples=new Array(Vse).fill(-1/0),this.sdpMetadataStreamId=e.stream.id,this.updateStream(null,e.stream),this.stream=e.stream,this.hasAudioTrack&&this.initVolumeMeasuring(),e.call&&(e.call.addListener(ft.State,this.onCallState),this.onCallState(e.call.state))}get connected(){return this.isLocal()||this._connected}set connected(e){this._connected=e,this.emit(ra.ConnectedChanged,this.connected)}get hasAudioTrack(){return this.stream.getAudioTracks().length>0}updateStream(e,t){if(t!==e){var n=this.measuringVolumeActivity;e&&(e.removeEventListener("addtrack",this.onAddTrack),this.measureVolumeActivity(!1)),this.stream=t,t.addEventListener("addtrack",this.onAddTrack),this.hasAudioTrack?(this.initVolumeMeasuring(),n&&this.measureVolumeActivity(!0)):this.measureVolumeActivity(!1),this.emit(ra.NewStream,this.stream)}}initVolumeMeasuring(){this.hasAudioTrack&&(this.audioContext||(this.audioContext=$se()),this.analyser=this.audioContext.createAnalyser(),this.analyser.fftSize=512,this.analyser.smoothingTimeConstant=.1,this.audioContext.createMediaStreamSource(this.stream).connect(this.analyser),this.frequencyBinCount=new Float32Array(this.analyser.frequencyBinCount))}getMember(){var e,t=this.client.getRoom(this.roomId);return null!==(e=null==t?void 0:t.getMember(this.userId))&&void 0!==e?e:null}isLocal(){return this.userId===this.client.getUserId()&&(void 0===this.deviceId||this.deviceId===this.client.getDeviceId())}isAudioMuted(){return 0===this.stream.getAudioTracks().length||this.audioMuted}isVideoMuted(){return 0===this.stream.getVideoTracks().length||this.videoMuted}isSpeaking(){return this.speaking}setNewStream(e){this.updateStream(this.stream,e)}setAudioVideoMuted(e,t){null!==e&&(this.audioMuted!==e&&this.speakingVolumeSamples.fill(-1/0),this.audioMuted=e),null!==t&&(this.videoMuted=t),this.emit(ra.MuteStateChanged,this.audioMuted,this.videoMuted)}measureVolumeActivity(e){if(e){if(!this.analyser||!this.frequencyBinCount||!this.hasAudioTrack)return;this.measuringVolumeActivity=!0,this.volumeLooper()}else this.measuringVolumeActivity=!1,this.speakingVolumeSamples.fill(-1/0),this.emit(ra.VolumeChanged,-1/0)}setSpeakingThreshold(e){this.speakingThreshold=e}clone(){var e=this.client.getMediaHandler(),t=this.stream.clone();return A.log("CallFeed clone() cloning stream (originalStreamId=".concat(this.stream.id,", newStreamId").concat(t.id,")")),this.purpose===sn.Usermedia?e.userMediaStreams.push(t):e.screensharingStreams.push(t),new hl({client:this.client,roomId:this.roomId,userId:this.userId,deviceId:this.deviceId,stream:t,purpose:this.purpose,audioMuted:this.audioMuted,videoMuted:this.videoMuted})}dispose(){var e,t;clearTimeout(this.volumeLooperTimeout),null===(e=this.stream)||void 0===e||e.removeEventListener("addtrack",this.onAddTrack),null===(t=this.call)||void 0===t||t.removeListener(ft.State,this.onCallState),this.audioContext&&(this.audioContext=void 0,this.analyser=void 0,Hse()),this._disposed=!0,this.emit(ra.Disposed)}get disposed(){return this._disposed}set disposed(e){this._disposed=e}getLocalVolume(){return this.localVolume}setLocalVolume(e){this.localVolume=e,this.emit(ra.LocalVolumeChanged,e)}}var qse=3e3,vk=function(e){return e.Incoming="Call.incoming",e}({});class Kse{constructor(e){L(this,"calls",void 0),L(this,"callEventBuffer",void 0),L(this,"nextSeqByCall",new Map),L(this,"toDeviceEventBuffers",new Map),L(this,"client",void 0),L(this,"candidateEventsByCall",void 0),L(this,"eventBufferPromiseChain",void 0),L(this,"onSync",(()=>{var e=this.callEventBuffer;this.callEventBuffer=[],this.eventBufferPromiseChain?this.eventBufferPromiseChain=this.eventBufferPromiseChain.then((()=>this.evaluateEventBuffer(e))):this.eventBufferPromiseChain=this.evaluateEventBuffer(e)})),L(this,"onRoomTimeline",(e=>{this.callEventBuffer.push(e)})),L(this,"onToDeviceEvent",(e=>{var t=e.getContent();if(t.call_id)if(this.nextSeqByCall.has(t.call_id)||this.nextSeqByCall.set(t.call_id,0),void 0!==t.seq){var n=this.nextSeqByCall.get(t.call_id)||0;if(t.seq!==n){this.toDeviceEventBuffers.has(t.call_id)||this.toDeviceEventBuffers.set(t.call_id,[]);var r=this.toDeviceEventBuffers.get(t.call_id),i=r.findIndex((e=>e.getContent().seq>t.seq));-1===i?r.push(e):r.splice(i,0,e)}else{var o=t.call_id;this.callEventBuffer.push(e),this.nextSeqByCall.set(o,t.seq+1);for(var s=this.toDeviceEventBuffers.get(o),a=s&&s.shift();a&&a.getContent().seq===this.nextSeqByCall.get(o);)this.callEventBuffer.push(a),this.nextSeqByCall.set(o,a.getContent().seq+1),a=s.shift()}}else this.callEventBuffer.push(e);else this.callEventBuffer.push(e)})),this.client=e,this.calls=new Map,this.callEventBuffer=[],this.candidateEventsByCall=new Map}start(){this.client.on(Oe.Sync,this.onSync),this.client.on(ke.Timeline,this.onRoomTimeline),this.client.on(Oe.ToDeviceEvent,this.onToDeviceEvent)}stop(){this.client.removeListener(Oe.Sync,this.onSync),this.client.removeListener(ke.Timeline,this.onRoomTimeline),this.client.removeListener(Oe.ToDeviceEvent,this.onToDeviceEvent)}evaluateEventBuffer(e){var t=this;return U((function*(){yield Promise.all(e.map((e=>t.client.decryptEventIfNeeded(e))));var n=e.filter((e=>{var t=e.getType();return t.startsWith("m.call.")||t.startsWith("org.matrix.call.")})),r=new Set;for(var i of n){var o=i.getType();(o===ee.CallAnswer||o===ee.CallHangup)&&r.add(i.getContent().call_id)}for(var s of n){var a=s.getType(),l=s.getContent().call_id;if(a!==ee.CallInvite||!r.has(l))try{yield t.handleCallEvent(s)}catch(e){A.error("CallEventHandler evaluateEventBuffer() caught exception handling call event",e)}}}))()}handleCallEvent(e){var t=this;return U((function*(){var n;t.client.emit(Oe.ReceivedVoipEvent,e);var r,i,o=e.getContent(),s=e.getRoomId()||(null===(n=t.client.groupCallEventHandler.getGroupCallById(o.conf_id))||void 0===n||null===(n=n.room)||void 0===n?void 0:n.roomId),a=o.conf_id,l=e.getType(),c=e.getSender(),u=o.call_id?t.calls.get(o.call_id):void 0;if(a){if(!(i=t.client.groupCallEventHandler.getGroupCallById(a)))return void A.warn("CallEventHandler handleCallEvent() could not find a group call - ignoring event (groupCallId=".concat(a,", type=").concat(l,")"));if(!(r=o.device_id))return A.warn("CallEventHandler handleCallEvent() could not find a device id - ignoring event (senderId=".concat(c,")")),void i.emit(rn.Error,new yH(c));if(o.dest_session_id!==t.client.getSessionId())return void A.warn("CallEventHandler handleCallEvent() call event does not match current session id - ignoring")}var d=c===t.client.credentials.userId&&(void 0===r||r===t.client.getDeviceId());if(s){if(l===ee.CallInvite){var h,p,f;if(d||e.getLocalAge()>o.lifetime-qse||u&&u.state===rt.Ended||(u&&A.warn("CallEventHandler handleCallEvent() already has a call but got an invite - clobbering (callId=".concat(o.call_id,")")),o.invitee&&o.invitee!==t.client.getUserId()))return;var m=(null!==(h=t.client.getTurnServersExpiry())&&void 0!==h?h:0)-Date.now();if(A.info("CallEventHandler handleCallEvent() current turn creds expire in "+m+" ms"),!(u=null!==(p=Iv(t.client,s,{forceTURN:t.client.forceTURN,opponentDeviceId:r,groupCallId:a,opponentSessionId:o.sender_session_id}))&&void 0!==p?p:void 0))return void A.log("CallEventHandler handleCallEvent() this client does not support WebRTC (callId=".concat(o.call_id,")"));u.callId=o.call_id;var v,g=null===(f=i)||void 0===f?void 0:f.getGroupCallStats();g&&u.initStats(g);try{yield u.initWithInvite(e)}catch(e){if(e instanceof rl)if(e.code===Gg.UnknownDevice){var y;null===(y=i)||void 0===y||y.emit(rn.Error,e)}else A.error(e)}if(t.calls.set(u.callId,u),t.candidateEventsByCall.get(u.callId))for(var b of t.candidateEventsByCall.get(u.callId))u.onRemoteIceCandidatesReceived(b);for(var _ of t.calls.values()){var w,E=[rt.WaitLocalMedia,rt.CreateOffer,rt.InviteSent].includes(_.state);if(u.roomId===_.roomId&&_.direction===Rc.Outbound&&(null===(w=u.getOpponentMember())||void 0===w?void 0:w.userId)===_.invitee&&E){v=_;break}}return void(v?v.callId>u.callId?(A.log("CallEventHandler handleCallEvent() detected glare - answering incoming call and canceling outgoing call (incomingId=".concat(u.callId,", outgoingId=").concat(v.callId,")")),v.replacedBy(u)):(A.log("CallEventHandler handleCallEvent() detected glare - hanging up incoming call (incomingId=".concat(u.callId,", outgoingId=").concat(v.callId,")")),u.hangup(ct.Replaced,!0)):t.client.emit(vk.Incoming,u))}if(l===ee.CallCandidates){if(d)return;return void(u?u.onRemoteIceCandidatesReceived(e):(t.candidateEventsByCall.has(o.call_id)||t.candidateEventsByCall.set(o.call_id,[]),t.candidateEventsByCall.get(o.call_id).push(e)))}if([ee.CallHangup,ee.CallReject].includes(l)){var S;if(u)u.state!==rt.Ended&&(l===ee.CallHangup?u.onHangupReceived(o):u.onRejectReceived(o),u.state===rt.Ended&&t.calls.delete(o.call_id));else(u=null!==(S=Iv(t.client,s,{opponentDeviceId:r,opponentSessionId:o.sender_session_id}))&&void 0!==S?S:void 0)&&(u.callId=o.call_id,u.initWithHangup(e),t.calls.set(o.call_id,u));return}if(!u||!u.hasPeerConnection)return void A.info("CallEventHandler handleCallEvent() discarding possible call event as we don't have a call (type=".concat(l,")"));if(e.getContent().party_id!==u.ourPartyId)switch(l){case ee.CallAnswer:d?u.state===rt.Ringing&&u.onAnsweredElsewhere(o):u.onAnswerReceived(e);break;case ee.CallSelectAnswer:u.onSelectAnswerReceived(e);break;case ee.CallNegotiate:u.onNegotiateReceived(e);break;case ee.CallAssertedIdentity:case ee.CallAssertedIdentityPrefix:u.onAssertedIdentityReceived(e);break;case ee.CallSDPStreamMetadataChanged:case ee.CallSDPStreamMetadataChangedPrefix:u.onSDPStreamMetadataChangedReceived(e)}}}))()}}var yk=function(e){return e.Incoming="GroupCall.incoming",e.Outgoing="GroupCall.outgoing",e.Ended="GroupCall.ended",e.Participants="GroupCall.participants",e}({});class Gse{constructor(e){this.client=e,L(this,"groupCalls",new Map),L(this,"roomDeferreds",new Map),L(this,"onRoomsChanged",(e=>{this.createGroupCallForRoom(e)})),L(this,"onRoomStateChanged",((e,t)=>{if(e.getType()===ee.GroupCallPrefix){var n=e.getStateKey(),r=e.getContent(),i=this.groupCalls.get(t.roomId);i||r["m.terminated"]||e.isRedacted()?i&&i.groupCallId===n?r["m.terminated"]||e.isRedacted()?i.terminate(!1):r["m.type"]!==i.type&&A.warn("GroupCallEventHandler onRoomStateChanged() currently does not support changing type (roomId=".concat(t.roomId,")")):i&&i.groupCallId!==n&&A.warn("GroupCallEventHandler onRoomStateChanged() currently does not support multiple calls (roomId=".concat(t.roomId,")")):this.createGroupCallFromRoomStateEvent(e)}}))}start(){var e=this;return U((function*(){e.client.getSyncState()!==Dt.Syncing&&(A.debug("GroupCallEventHandler start() waiting for client to start syncing"),yield new Promise((t=>{var n=()=>{if(e.client.getSyncState()===Dt.Syncing)return e.client.off(Oe.Sync,n),t()};e.client.on(Oe.Sync,n)})));var t=e.client.getRooms();for(var n of t)e.createGroupCallForRoom(n);e.client.on(Oe.Room,e.onRoomsChanged),e.client.on(ut.Events,e.onRoomStateChanged)}))()}stop(){this.client.removeListener(Oe.Room,this.onRoomsChanged),this.client.removeListener(ut.Events,this.onRoomStateChanged)}getRoomDeferred(e){var t,n=this.roomDeferreds.get(e);void 0===n&&((n={prom:new Promise((e=>{t=e}))}).resolve=t,this.roomDeferreds.set(e,n));return n}waitUntilRoomReadyForGroupCalls(e){return this.getRoomDeferred(e).prom}getGroupCallById(e){return[...this.groupCalls.values()].find((t=>t.groupCallId===e))}createGroupCallForRoom(e){var t=e.currentState.getStateEvents(ee.GroupCallPrefix),n=t.sort(((e,t)=>t.getTs()-e.getTs()));for(var r of n){if(!r.getContent()["m.terminated"]&&!r.isRedacted()){A.debug("GroupCallEventHandler createGroupCallForRoom() choosing group call from possible calls (stateKey=".concat(r.getStateKey(),", ts=").concat(r.getTs(),", roomId=").concat(e.roomId,", numOfPossibleCalls=").concat(t.length,")")),this.createGroupCallFromRoomStateEvent(r);break}}this.getRoomDeferred(e.roomId).resolve()}createGroupCallFromRoomStateEvent(e){var t=e.getRoomId(),n=e.getContent(),r=this.client.getRoom(t);if(r){var i=e.getStateKey(),o=n["m.type"];if(Object.values(LE).includes(o)){var s=n["m.intent"];if(Object.values(vH).includes(s)){var a,l=!!n["io.element.ptt"];if(null!=n&&n.dataChannelsEnabled&&null!=n&&n.dataChannelOptions){var{ordered:c,maxPacketLifeTime:u,maxRetransmits:d,protocol:h}=n.dataChannelOptions;a={ordered:c,maxPacketLifeTime:u,maxRetransmits:d,protocol:h}}var p=new qP(this.client,r,o,l,s,i,(null==n?void 0:n.dataChannelsEnabled)||this.client.isVoipWithNoMediaAllowed,a,this.client.isVoipWithNoMediaAllowed,this.client.useLivekitForGroupCalls,n["io.element.livekit_service_url"]);return this.groupCalls.set(r.roomId,p),this.client.emit(yk.Incoming,p),p}A.warn("Received invalid group call intent (type=".concat(o,", roomId=").concat(t,")"))}else A.warn("GroupCallEventHandler createGroupCallFromRoomStateEvent() received invalid call type (type=".concat(o,", roomId=").concat(t,")"))}else A.warn("GroupCallEventHandler createGroupCallFromRoomStateEvent() couldn't find room for call (roomId=".concat(t,")"))}}class Wse{constructor(){L(this,"bandwidth",{}),L(this,"bitrate",{}),L(this,"packetLoss",{}),L(this,"transport",[])}}class zse{static buildBandwidthReport(e){var t=e.availableIncomingBitrate,n=e.availableOutgoingBitrate;return{download:t?Math.round(t/1e3):0,upload:n?Math.round(n/1e3):0}}}class Yse{static buildReport(e,t,n,r){var i=null==e?void 0:e.get(t.localCandidateId),o=null==e?void 0:e.get(t.remoteCandidateId);if(o&&i){var s=void 0!==o.ip?o.ip:o.address,a=o.port,l="".concat(s,":").concat(a),c=void 0!==i.ip?i.ip:i.address,u=i.port,d="".concat(c,":").concat(u),h=o.protocol;n.some((e=>e.ip===l&&e.type===h&&e.localIp===d))||n.push({ip:l,type:h,localIp:d,isFocus:r,localCandidateType:i.candidateType,remoteCandidateType:o.candidateType,networkType:i.networkType,rtt:t.currentRoundTripTime?1e3*t.currentRoundTripTime:NaN})}return n}}class Jse{constructor(){L(this,"ssrcToMid",{local:new Map,remote:new Map})}findMidBySsrc(e,t){var n;return this.ssrcToMid[t].forEach(((t,r)=>{t.find((t=>t==e))&&(n=r)})),n}parse(e,t){var n=pk.parse(e),r=new Map;n.media.forEach((e=>{if(e.mid&&"video"===e.type||"audio"===e.type){var t,n=[];null===(t=e.ssrcs)||void 0===t||t.forEach((e=>{"cname"===e.attribute&&n.push("".concat(e.id))})),r.set("".concat(e.mid),n)}})),this.ssrcToMid[t]=r}getSsrcToMidMap(e){return this.ssrcToMid[e]}}class Xse{constructor(e){this.pc=e}getLocalTracks(e){return this.pc.getTransceivers().filter((e=>"sendonly"===e.currentDirection||"sendrecv"===e.currentDirection)).filter((e=>null!==e.sender)).map((e=>e.sender)).map((e=>e.track)).filter((t=>null!==t&&t.kind===e))}getTackById(e){return this.pc.getTransceivers().map((t=>null!==(null==t?void 0:t.sender.track)&&t.sender.track.id===e?t.sender.track:null!==(null==t?void 0:t.receiver.track)&&t.receiver.track.id===e?t.receiver.track:void 0)).find((e=>void 0!==e))}getLocalTrackIdByMid(e){var t,n=this.pc.getTransceivers().find((t=>t.mid===e));return null==n||null===(t=n.sender)||void 0===t||null===(t=t.track)||void 0===t?void 0:t.id}getRemoteTrackIdByMid(e){var t,n=this.pc.getTransceivers().find((t=>t.mid===e));return null==n||null===(t=n.receiver)||void 0===t||null===(t=t.track)||void 0===t?void 0:t.id}getActiveSimulcastStreams(){return 3}getTransceiverByTrackId(e){return this.pc.getTransceivers().find((t=>t.receiver.track.id===e||null!==t.sender.track&&t.sender.track.id===e))}}class Zse{constructor(e,t,n){this.trackId=e,this.type=t,this.kind=n,L(this,"loss",{packetsTotal:0,packetsLost:0,isDownloadStream:!1}),L(this,"bitrate",{download:0,upload:0}),L(this,"resolution",{width:-1,height:-1}),L(this,"audioConcealment",{concealedAudio:0,totalAudioDuration:0}),L(this,"framerate",0),L(this,"jitter",0),L(this,"codec",""),L(this,"isAlive",!0),L(this,"isMuted",!1),L(this,"isEnabled",!0)}getType(){return this.type}setLoss(e){this.loss=e}getLoss(){return this.loss}setResolution(e){this.resolution=e}getResolution(){return this.resolution}setFramerate(e){this.framerate=e}getFramerate(){return this.framerate}setBitrate(e){this.bitrate=e}getBitrate(){return this.bitrate}setCodec(e){return this.codec=e,!0}getCodec(){return this.codec}resetBitrate(){this.bitrate={download:0,upload:0}}set alive(e){this.isAlive=e}get alive(){return this.isAlive}set muted(e){this.isMuted=e}get muted(){return this.isMuted}set enabled(e){this.isEnabled=e}get enabled(){return this.isEnabled}setJitter(e){this.jitter=e}getJitter(){return this.jitter}setAudioConcealment(e,t){this.audioConcealment.concealedAudio=e,this.audioConcealment.totalAudioDuration=t}getAudioConcealment(){return this.audioConcealment}}class Qse{constructor(e,t){this.mediaSsrcHandler=e,this.mediaTrackHandler=t,L(this,"track2stats",new Map)}findTrack2Stats(e,t){var n;if(e.trackIdentifier)n=e.trackIdentifier;else if(e.mid)n="remote"===t?this.mediaTrackHandler.getRemoteTrackIdByMid(e.mid):this.mediaTrackHandler.getLocalTrackIdByMid(e.mid);else if(e.ssrc){if(!this.mediaSsrcHandler.findMidBySsrc(e.ssrc,t))return;n="remote"===t?this.mediaTrackHandler.getRemoteTrackIdByMid(e.mid):this.mediaTrackHandler.getLocalTrackIdByMid(e.mid)}if(n){var r=this.track2stats.get(n);if(!r){var i=this.mediaTrackHandler.getTackById(n);if(void 0===i)return;var o="audio"===i.kind?i.kind:"video";r=new Zse(n,t,o),this.track2stats.set(n,r)}return r}}findLocalVideoTrackStats(e){if(0!==this.mediaTrackHandler.getLocalTracks("video").length)return this.findTrack2Stats(e,"local")}getTrack2stats(){return this.track2stats}findTransceiverByTrackId(e){return this.mediaTrackHandler.getTransceiverByTrackId(e)}}class sd{static getNonNegativeValue(e){var t=e;return"number"!=typeof t&&(t=Number(t)),isNaN(t)?0:Math.max(0,t)}}class fs{static buildFramerateResolution(e,t){var n={height:t.frameHeight,width:t.frameWidth},r=t.framesPerSecond;n.height&&n.width&&e.setResolution(n),e.setFramerate(Math.round(r||0))}static calculateSimulcastFramerate(e,t,n,r){var i=e.getFramerate();if(!i){if(n){var o=t.timestamp-n.timestamp;if(o>0&&t.framesSent)i=(t.framesSent-n.framesSent)/o*1e3}if(!i)return}i=r?Math.round(i/r):0,e.setFramerate(i)}static buildCodec(e,t,n){var r=null==e?void 0:e.get(n.codecId);if(r){var i=r.mimeType.split("/")[1];i&&t.setCodec(i)}}static buildBitrateReceived(e,t,n){e.setBitrate({download:fs.calculateBitrate(t.bytesReceived,n.bytesReceived,t.timestamp,n.timestamp),upload:0})}static buildBitrateSend(e,t,n){e.setBitrate({download:0,upload:this.calculateBitrate(t.bytesSent,n.bytesSent,t.timestamp,n.timestamp)})}static buildPacketsLost(e,t,n){var r="outbound-rtp"===t.type?"packetsSent":"packetsReceived",i=t[r];(!i||i<0)&&(i=0);var o=sd.getNonNegativeValue(n[r]),s=Math.max(0,i-o),a=sd.getNonNegativeValue(t.packetsLost),l=sd.getNonNegativeValue(n.packetsLost),c=Math.max(0,a-l);e.setLoss({packetsTotal:s+c,packetsLost:c,isDownloadStream:"outbound-rtp"!==t.type})}static calculateBitrate(e,t,n,r){var i=sd.getNonNegativeValue(e),o=sd.getNonNegativeValue(t),s=Math.max(0,i-o),a=n-r,l=0;return a>0&&(l=Math.round(8*s/a)),l}static setTrackStatsState(e,t){var n;if(void 0!==t){var r="remote"===e.getType()?t.receiver.track:null==t||null===(n=t.sender)||void 0===n?void 0:n.track;null!=r&&"ended"!==r.readyState?(e.muted=r.muted,e.enabled=r.enabled,e.alive=!0):e.alive=!1}else e.alive=!1}static buildTrackSummary(e){var t={count:0,muted:0,maxJitter:0,maxPacketLoss:0,concealedAudio:0,totalAudio:0},n={count:0,muted:0,maxJitter:0,maxPacketLoss:0,concealedAudio:0,totalAudio:0},r=e.filter((e=>"remote"===e.getType())),i=r.filter((e=>"audio"===e.kind));return r.forEach((e=>{var r,o,s="video"===e.kind?t:n;(s.count++,e.alive&&e.muted&&s.muted++,s.maxJitter<e.getJitter()&&(s.maxJitter=e.getJitter()),s.maxPacketLoss<e.getLoss().packetsLost&&(s.maxPacketLoss=e.getLoss().packetsLost),i.length>0)&&(s.concealedAudio+=null===(r=e.getAudioConcealment())||void 0===r?void 0:r.concealedAudio,s.totalAudio+=null===(o=e.getAudioConcealment())||void 0===o?void 0:o.totalAudioDuration)})),{audioTrackSummary:n,videoTrackSummary:t}}static buildJitter(e,t){if("inbound-rtp"===t.type){var n=null==t?void 0:t.jitter;if(void 0!==n){var r=sd.getNonNegativeValue(n);e.setJitter(Math.round(1e3*r))}else e.setJitter(-1)}}static buildAudioConcealment(e,t){if("inbound-rtp"===t.type){var n=1e3*(null==t?void 0:t.totalSamplesDuration)/(null==t?void 0:t.totalSamplesReceived)*(null==t?void 0:t.concealedSamples),r=1e3*(null==t?void 0:t.totalSamplesDuration);e.setAudioConcealment(n,r)}}}class Kg{static build(e){var t={},n={download:0,upload:0},r={download:0,upload:0},i=0,o=0,s={local:new Map,remote:new Map},a={local:new Map,remote:new Map},l={local:new Map,remote:new Map},c=new Map,u=new Map,d=0,h=0,p=0,f=0,m=0,v=0;for(var[g,y]of e){var b=y.getLoss(),_=b.isDownloadStream?"download":"upload";if(n[_]+=b.packetsTotal,r[_]+=b.packetsLost,i+=y.getBitrate().download,o+=y.getBitrate().upload,"audio"===y.kind){var w=y.getAudioConcealment();m+=w.concealedAudio,v+=w.totalAudioDuration,d+=y.getBitrate().download,h+=y.getBitrate().upload}else p+=y.getBitrate().download,f+=y.getBitrate().upload;s[y.getType()].set(g,y.getResolution()),a[y.getType()].set(g,y.getFramerate()),l[y.getType()].set(g,y.getCodec()),"remote"===y.getType()&&(c.set(g,y.getJitter()),"audio"===y.kind&&u.set(g,y.getAudioConcealment())),y.resetBitrate()}return t.bitrate={upload:o,download:i},t.bitrate.audio={upload:h,download:d},t.bitrate.video={upload:f,download:p},t.packetLoss={total:Kg.calculatePacketLoss(r.download+r.upload,n.download+n.upload),download:Kg.calculatePacketLoss(r.download,n.download),upload:Kg.calculatePacketLoss(r.upload,n.upload)},t.audioConcealment=u,t.totalAudioConcealment={concealedAudio:m,totalAudioDuration:v},t.framerate=a,t.resolution=s,t.codec=l,t.jitter=c,t}static calculatePacketLoss(e,t){return!t||t<=0||!e||e<=0?0:Math.round(e/t*100)}}class Fc{static buildCallFeedReport(e,t,n){var r=n.getTransceivers(),i=[];return r.forEach((e=>{var t,n=null!==(t=e.sender)&&void 0!==t&&t.track?Fc.buildTrackStats(e.sender.track,"sender"):null,r=Fc.buildTrackStats(e.receiver.track,"receiver");i.push({mid:null==e.mid?"null":e.mid,direction:e.direction,currentDirection:null==e.currentDirection?"null":e.currentDirection,sender:n,receiver:r})})),{callId:e,opponentMemberId:t,transceiver:i,callFeeds:[]}}static buildTrackStats(e){var t,n,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"--",i=null===(t=e.getSettings())||void 0===t?void 0:t.deviceId,o=null===(n=e.getConstraints())||void 0===n?void 0:n.deviceId;return{id:e.id,kind:e.kind,settingDeviceId:i??"unknown",constrainDeviceId:o??"unknown",muted:e.muted,enabled:e.enabled,readyState:e.readyState,label:r}}static expandCallFeedReport(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"unknown";return t.forEach((t=>{var r=t.stream.getAudioTracks(),i=t.stream.getVideoTracks(),o=r.length>0?Fc.buildTrackStats(t.stream.getAudioTracks()[0],t.purpose):null,s=i.length>0?Fc.buildTrackStats(t.stream.getVideoTracks()[0],t.purpose):null,a={stream:t.stream.id,type:t.isLocal()?"local":"remote",audio:o,video:s,purpose:t.purpose,prefix:n,isVideoMuted:t.isVideoMuted(),isAudioMuted:t.isAudioMuted()};e.callFeeds.push(a)})),e}}function Q5(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function S1(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Q5(Object(n),!0).forEach((function(t){L(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Q5(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}class eoe{constructor(e,t,n,r){var i=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];this.callId=e,this.opponentMemberId=t,this.pc=n,this.emitter=r,this.isFocus=i,L(this,"isActive",!0),L(this,"previousStatsReport",void 0),L(this,"currentStatsReport",void 0),L(this,"connectionStats",new Wse),L(this,"trackStats",void 0),n.addEventListener("signalingstatechange",this.onSignalStateChange.bind(this)),this.trackStats=new Qse(new Jse,new Xse(n))}processStats(e,t){var n=this;return U((function*(){var r={isFirstCollection:void 0===n.previousStatsReport,receivedMedia:0,receivedAudioMedia:0,receivedVideoMedia:0,audioTrackSummary:{count:0,muted:0,maxPacketLoss:0,maxJitter:0,concealedAudio:0,totalAudio:0},videoTrackSummary:{count:0,muted:0,maxPacketLoss:0,maxJitter:0,concealedAudio:0,totalAudio:0}};if(n.isActive){var i=n.pc.getStats();if("function"==typeof(null==i?void 0:i.then))return i.then((i=>{var o,s;n.currentStatsReport="function"==typeof(null==i?void 0:i.result)?i.result():i;try{n.processStatsReport(e,t)}catch(e){return n.handleError(e),r}n.previousStatsReport=n.currentStatsReport,r.receivedMedia=n.connectionStats.bitrate.download,r.receivedAudioMedia=(null===(o=n.connectionStats.bitrate.audio)||void 0===o?void 0:o.download)||0,r.receivedVideoMedia=(null===(s=n.connectionStats.bitrate.video)||void 0===s?void 0:s.download)||0;var a=fs.buildTrackSummary(Array.from(n.trackStats.getTrack2stats().values()));return S1(S1({},r),{},{audioTrackSummary:a.audioTrackSummary,videoTrackSummary:a.videoTrackSummary})})).catch((e=>(n.handleError(e),r)));n.isActive=!1}return Promise.resolve(r)}))()}processStatsReport(e,t){var n,r=new Map;r.callId=this.callId,r.opponentMemberId=this.opponentMemberId,null===(n=this.currentStatsReport)||void 0===n||n.forEach((e=>{var t=this.previousStatsReport?this.previousStatsReport.get(e.id):null;if("candidate-pair"===e.type&&e.nominated&&"succeeded"===e.state)this.connectionStats.bandwidth=zse.buildBandwidthReport(e),this.connectionStats.transport=Yse.buildReport(this.currentStatsReport,e,this.connectionStats.transport,this.isFocus);else if("inbound-rtp"===e.type||"outbound-rtp"===e.type){var n=this.trackStats.findTrack2Stats(e,"inbound-rtp"===e.type?"remote":"local");if(!n)return;if(t&&fs.buildPacketsLost(n,e,t),"inbound-rtp"===e.type){fs.buildFramerateResolution(n,e),t&&fs.buildBitrateReceived(n,e,t);var i=this.trackStats.findTransceiverByTrackId(n.trackId);fs.setTrackStatsState(n,i),fs.buildJitter(n,e),fs.buildAudioConcealment(n,e)}else t&&(r.set(n.trackId,sd.getNonNegativeValue(e.bytesSent)),fs.buildBitrateSend(n,e,t));fs.buildCodec(this.currentStatsReport,n,e)}else if("track"===e.type&&"video"===e.kind&&!e.remoteSource){var o=this.trackStats.findLocalVideoTrackStats(e);if(!o)return;fs.buildFramerateResolution(o,e),fs.calculateSimulcastFramerate(o,e,t,this.trackStats.mediaTrackHandler.getActiveSimulcastStreams())}})),this.emitter.emitByteSendReport(r),this.emitter.emitCallFeedReport(Fc.buildCallFeedReport(this.callId,this.opponentMemberId,this.pc)),this.processAndEmitConnectionStatsReport()}setActive(e){this.isActive=e}getActive(){return this.isActive}handleError(e){this.isActive=!1,A.warn("CallStatsReportGatherer ".concat(this.callId," processStatsReport fails and set to inactive ").concat(e))}processAndEmitConnectionStatsReport(){var e=Kg.build(this.trackStats.getTrack2stats());e.callId=this.callId,e.opponentMemberId=this.opponentMemberId,this.connectionStats.bandwidth=e.bandwidth,this.connectionStats.bitrate=e.bitrate,this.connectionStats.packetLoss=e.packetLoss,this.emitter.emitConnectionStatsReport(S1(S1({},e),{},{transport:this.connectionStats.transport})),this.connectionStats.transport=[]}stopProcessingStats(){}onSignalStateChange(){"stable"===this.pc.signalingState&&(this.pc.currentRemoteDescription&&this.trackStats.mediaSsrcHandler.parse(this.pc.currentRemoteDescription.sdp,"remote"),this.pc.currentLocalDescription&&this.trackStats.mediaSsrcHandler.parse(this.pc.currentLocalDescription.sdp,"local"))}setOpponentMemberId(e){this.opponentMemberId=e}}var _l=function(e){return e.CONNECTION_STATS="StatsReport.connection_stats",e.CALL_FEED_REPORT="StatsReport.call_feed_report",e.BYTE_SENT_STATS="StatsReport.byte_sent_stats",e.SUMMARY_STATS="StatsReport.summary_stats",e}({});class toe extends En{emitByteSendReport(e){this.emit(_l.BYTE_SENT_STATS,e)}emitConnectionStatsReport(e){this.emit(_l.CONNECTION_STATS,e)}emitCallFeedReport(e){this.emit(_l.CALL_FEED_REPORT,e)}emitSummaryStatsReport(e){this.emit(_l.SUMMARY_STATS,e)}}class gH{constructor(e){this.emitter=e}build(e){var t=e.filter((e=>!e.isFirstCollection)),n=t.length,r=e.length;if(0!==n){var i={receivedAudio:0,receivedVideo:0,receivedMedia:0,concealedAudio:0,totalAudio:0},o=0,s=0;t.forEach((e=>{this.countTrackListReceivedMedia(i,e),this.countConcealedAudio(i,e),o=this.buildMaxJitter(o,e),s=this.buildMaxPacketLoss(s,e)}));var a={percentageReceivedMedia:Number((i.receivedMedia/n).toFixed(5)),percentageReceivedVideoMedia:Number((i.receivedVideo/n).toFixed(5)),percentageReceivedAudioMedia:Number((i.receivedAudio/n).toFixed(5)),maxJitter:o,maxPacketLoss:s,percentageConcealedAudio:Number(i.totalAudio>0?(i.concealedAudio/i.totalAudio).toFixed(5):0),peerConnections:r};this.emitter.emitSummaryStatsReport(a)}}static extendSummaryReport(e,t){var n=[],r=[];for(var i of t)for(var o of(r.push(i),i[1]))n.push(o);e.opponentDevicesInCall=Math.max(0,n.length-1),e.opponentUsersInCall=Math.max(0,r.length-1),e.diffDevicesToPeerConnections=Math.max(0,n.length-1)-e.peerConnections,e.ratioPeerConnectionToDevices=0==Math.max(0,n.length-1)?0:e.peerConnections/(n.length-1)}countTrackListReceivedMedia(e,t){var n=!1,r=!1;(t.receivedAudioMedia>0||0===t.audioTrackSummary.count)&&(e.receivedAudio++,n=!0),(t.receivedVideoMedia>0||0===t.videoTrackSummary.count||t.videoTrackSummary.muted>0&&t.videoTrackSummary.muted===t.videoTrackSummary.count)&&(e.receivedVideo++,r=!0),r&&n&&e.receivedMedia++}buildMaxJitter(e,t){return e<t.videoTrackSummary.maxJitter&&(e=t.videoTrackSummary.maxJitter),e<t.audioTrackSummary.maxJitter&&(e=t.audioTrackSummary.maxJitter),e}buildMaxPacketLoss(e,t){return e<t.videoTrackSummary.maxPacketLoss&&(e=t.videoTrackSummary.maxPacketLoss),e<t.audioTrackSummary.maxPacketLoss&&(e=t.audioTrackSummary.maxPacketLoss),e}countConcealedAudio(e,t){e.concealedAudio+=t.audioTrackSummary.concealedAudio,e.totalAudio+=t.audioTrackSummary.totalAudio}}class noe{constructor(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1e4;this.groupCallId=e,this.userId=t,this.interval=n,L(this,"timer",void 0),L(this,"gatherers",new Map),L(this,"reports",new toe),L(this,"summaryStatsReportGatherer",new gH(this.reports))}start(){void 0===this.timer&&this.interval>0&&(this.timer=setInterval((()=>{this.processStats()}),this.interval))}stop(){void 0!==this.timer&&(clearInterval(this.timer),this.gatherers.forEach((e=>e.stopProcessingStats())))}hasStatsReportGatherer(e){return this.gatherers.has(e)}addStatsReportGatherer(e,t,n){return!this.hasStatsReportGatherer(e)&&(this.gatherers.set(e,new eoe(e,t,n,this.reports)),!0)}removeStatsReportGatherer(e){return this.gatherers.delete(e)}getStatsReportGatherer(e){return this.hasStatsReportGatherer(e)?this.gatherers.get(e):void 0}updateOpponentMember(e,t){var n;null===(n=this.getStatsReportGatherer(e))||void 0===n||n.setOpponentMemberId(t)}processStats(){var e=[];this.gatherers.forEach((t=>{e.push(t.processStats(this.groupCallId,this.userId))})),Promise.all(e).then((e=>this.summaryStatsReportGatherer.build(e))).catch((e=>{A.error("Could not build summary stats report",e)}))}setInterval(e){this.interval=e}}function eN(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function E1(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?eN(Object(n),!0).forEach((function(t){L(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):eN(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var vH=function(e){return e.Ring="m.ring",e.Prompt="m.prompt",e.Room="m.room",e}({}),LE=function(e){return e.Video="m.video",e.Voice="m.voice",e}({}),roe=function(e){return e.CallEnded="call_ended",e}({}),rn=function(e){return e.GroupCallStateChanged="group_call_state_changed",e.ActiveSpeakerChanged="active_speaker_changed",e.CallsChanged="calls_changed",e.UserMediaFeedsChanged="user_media_feeds_changed",e.ScreenshareFeedsChanged="screenshare_feeds_changed",e.LocalScreenshareStateChanged="local_screenshare_state_changed",e.LocalMuteStateChanged="local_mute_state_changed",e.ParticipantsChanged="participants_changed",e.Error="group_call_error",e}({}),Og=function(e){return e.ConnectionStats="GroupCall.connection_stats",e.ByteSentStats="GroupCall.byte_sent_stats",e.SummaryStats="GroupCall.summary_stats",e.CallFeedStats="GroupCall.call_feed_stats",e}({}),Gg=function(e){return e.NoUserMedia="no_user_media",e.UnknownDevice="unknown_device",e.PlaceCallFailed="place_call_failed",e}({});class _k extends Error{constructor(e,t,n){n?(super(t+": "+n),L(this,"code",void 0)):(super(t),L(this,"code",void 0)),this.code=e}}class yH extends _k{constructor(e){super(Gg.UnknownDevice,"No device found for "+e),this.userId=e}}var Ln=function(e){return e.LocalCallFeedUninitialized="local_call_feed_uninitialized",e.InitializingLocalCallFeed="initializing_local_call_feed",e.LocalCallFeedInitialized="local_call_feed_initialized",e.Entered="entered",e.Ended="ended",e}({}),tN=36e5;function w1(e){var t;return(null===(t=e.getOpponentMember())||void 0===t?void 0:t.userId)||e.invitee||null}class qP extends En{constructor(e,t,n,r,i,o,s,a,l){var c,u,d=arguments.length>9&&void 0!==arguments[9]&&arguments[9],h=arguments.length>10?arguments[10]:void 0;super(),this.client=e,this.room=t,this.type=n,this.isPtt=r,this.intent=i,this.dataChannelsEnabled=s,this.dataChannelOptions=a,this.useLivekit=d,L(this,"activeSpeakerInterval",1e3),L(this,"retryCallInterval",5e3),L(this,"participantTimeout",15e3),L(this,"pttMaxTransmitTime",2e4),L(this,"activeSpeaker",void 0),L(this,"localCallFeed",void 0),L(this,"localScreenshareFeed",void 0),L(this,"localDesktopCapturerSourceId",void 0),L(this,"userMediaFeeds",[]),L(this,"screenshareFeeds",[]),L(this,"groupCallId",void 0),L(this,"allowCallWithoutVideoAndAudio",void 0),L(this,"calls",new Map),L(this,"callHandlers",new Map),L(this,"activeSpeakerLoopInterval",void 0),L(this,"retryCallLoopInterval",void 0),L(this,"retryCallCounts",new Map),L(this,"reEmitter",void 0),L(this,"transmitTimer",null),L(this,"participantsExpirationTimer",null),L(this,"resendMemberStateTimer",null),L(this,"initWithAudioMuted",!1),L(this,"initWithVideoMuted",!1),L(this,"initCallFeedPromise",void 0),L(this,"_livekitServiceURL",void 0),L(this,"stats",void 0),L(this,"statsCollectIntervalTime",0),L(this,"onConnectionStats",(e=>{this.emit(Og.ConnectionStats,{report:e})})),L(this,"onByteSentStats",(e=>{this.emit(Og.ByteSentStats,{report:e})})),L(this,"onSummaryStats",(e=>{gH.extendSummaryReport(e,this.participants),this.emit(Og.SummaryStats,{report:e})})),L(this,"onCallFeedReport",(e=>{this.localCallFeed&&(e=Fc.expandCallFeedReport(e,[this.localCallFeed],"from-local-feed"));var t=[];this.forEachCall((n=>{n.callId===e.callId&&n.getFeeds().forEach((e=>t.push(e)))})),e=Fc.expandCallFeedReport(e,t,"from-call-feed"),this.emit(Og.CallFeedStats,{report:e})})),L(this,"_state",Ln.LocalCallFeedUninitialized),L(this,"_participants",new Map),L(this,"_creationTs",null),L(this,"_enteredViaAnotherSession",!1),L(this,"onIncomingCall",(e=>{var t,n;if(e.roomId===this.room.roomId){if(e.state!==rt.Ringing)return void A.warn("GroupCall ".concat(this.groupCallId," onIncomingCall() incoming call no longer in ringing state - ignoring"));if(!e.groupCallId||e.groupCallId!==this.groupCallId)return A.log("GroupCall ".concat(this.groupCallId," onIncomingCall() ignored because it doesn't match the current group call")),void e.reject();var r=null===(t=e.getOpponentMember())||void 0===t?void 0:t.userId;if(void 0===r)return void A.warn("GroupCall ".concat(this.groupCallId," onIncomingCall() incoming call with no member - ignoring"));if(this.useLivekit)return void A.info("Received incoming call whilst in signaling-only mode! Ignoring.");var i=null!==(n=this.calls.get(r))&&void 0!==n?n:new Map,o=i.get(e.getOpponentDeviceId());if((null==o?void 0:o.callId)!==e.callId){A.log("GroupCall ".concat(this.groupCallId," onIncomingCall() incoming call (userId=").concat(r,", callId=").concat(e.callId,")")),o&&o.hangup(ct.Replaced,!1),i.set(e.getOpponentDeviceId(),e),this.calls.set(r,i),this.initCall(e);var s=this.getLocalFeeds().map((e=>e.clone()));if(!this.callExpected(e))for(var a of s)rr(a.stream.getAudioTracks(),!1),rr(a.stream.getVideoTracks(),!1);e.answerWithCallFeeds(s),this.emit(rn.CallsChanged,this.calls)}}})),L(this,"onRetryCallLoop",(()=>{var e=!1;for(var[{userId:t},n]of this.participants){var r=this.calls.get(t),i=this.retryCallCounts.get(t);for(var[o,s]of n){var a,l,c=null==r?void 0:r.get(o),u=null!==(a=null===(l=i)||void 0===l?void 0:l.get(o))&&void 0!==a?a:0;(null==c?void 0:c.getOpponentSessionId())!==s.sessionId&&this.wantsOutgoingCall(t,o)&&u<3&&(void 0===i&&(i=new Map,this.retryCallCounts.set(t,i)),i.set(o,u+1),e=!0)}}e&&this.placeOutgoingCalls()})),L(this,"onCallFeedsChanged",(e=>{var t=w1(e),n=e.getOpponentDeviceId();if(!t)throw new Error("Cannot change call feeds without user id");var r=this.getUserMediaFeed(t,n),i=e.remoteUsermediaFeed,o=i!==r,s=this.calls.get(t),a=null==s?void 0:s.get(n);if((null==a?void 0:a.callId)===e.callId){o&&(!r&&i?this.addUserMediaFeed(i):r&&i?this.replaceUserMediaFeed(r,i):r&&!i&&this.removeUserMediaFeed(r));var l=this.getScreenshareFeed(t,n),c=e.remoteScreensharingFeed;c!==l&&(!l&&c?this.addScreenshareFeed(c):l&&c?this.replaceScreenshareFeed(l,c):l&&!c&&this.removeScreenshareFeed(l))}})),L(this,"onCallStateChanged",((e,t,n)=>{var r;if(t!==rt.Ended){var i=this.localCallFeed.isAudioMuted();e.localUsermediaStream&&e.isMicrophoneMuted()!==i&&e.setMicrophoneMuted(i);var o=this.localCallFeed.isVideoMuted();e.localUsermediaStream&&e.isLocalVideoMuted()!==o&&e.setLocalVideoMuted(o);var s=null===(r=e.getOpponentMember())||void 0===r?void 0:r.userId;if(t===rt.Connected&&s){var a=this.retryCallCounts.get(s);null==a||a.delete(e.getOpponentDeviceId()),0===(null==a?void 0:a.size)&&this.retryCallCounts.delete(s)}}})),L(this,"onCallHangup",(e=>{var t,n;if(e.hangupReason!==ct.Replaced){var r=null!==(t=null===(n=e.getOpponentMember())||void 0===n?void 0:n.userId)&&void 0!==t?t:this.room.getMember(e.invitee).userId,i=this.calls.get(r);(null==i?void 0:i.get(e.getOpponentDeviceId()))===e&&(this.disposeCall(e,e.hangupReason),i.delete(e.getOpponentDeviceId()),0===i.size&&this.calls.delete(r),this.emit(rn.CallsChanged,this.calls))}})),L(this,"onCallReplaced",((e,t)=>{var n=e.getOpponentMember().userId,r=this.calls.get(n);void 0===r&&(r=new Map,this.calls.set(n,r)),e.hangup(ct.Replaced,!1),this.initCall(t),r.set(e.getOpponentDeviceId(),t),this.emit(rn.CallsChanged,this.calls)})),L(this,"onActiveSpeakerLoop",(()=>{var e=void 0,t=void 0;for(var n of this.userMediaFeeds)if(!(n.isLocal()&&this.userMediaFeeds.length>1)){var r=n.speakingVolumeSamples.reduce(((e,t)=>e+Math.max(t,gk)))/n.speakingVolumeSamples.length;(!e||r>e)&&(e=r,t=n)}t&&this.activeSpeaker!==t&&e&&e>gk&&(this.activeSpeaker=t,this.emit(rn.ActiveSpeakerChanged,this.activeSpeaker))})),L(this,"onRoomState",(()=>this.updateParticipants())),L(this,"onParticipantsChanged",(()=>{this.forEachCall((e=>{var t=this.callExpected(e);for(var n of e.getLocalFeeds())rr(n.stream.getAudioTracks(),!n.isAudioMuted()&&t),rr(n.stream.getVideoTracks(),!n.isVideoMuted()&&t)})),this.state===Ln.Entered&&!this.useLivekit&&this.placeOutgoingCalls()})),L(this,"onStateChanged",((e,t)=>{(e===Ln.Entered||t===Ln.Entered||e===Ln.Ended)&&(this.updateParticipants(),this.updateMemberState().catch((e=>A.error("GroupCall ".concat(this.groupCallId,' onStateChanged() failed to update member state devices"'),e))))})),L(this,"onLocalFeedsChanged",(()=>{this.state===Ln.Entered&&this.updateMemberState().catch((e=>A.error("GroupCall ".concat(this.groupCallId," onLocalFeedsChanged() failed to update member state feeds"),e)))})),this.reEmitter=new N$(this),this.groupCallId=o??od(),this._livekitServiceURL=h,this.creationTs=null!==(c=null===(u=t.currentState.getStateEvents(ee.GroupCallPrefix,this.groupCallId))||void 0===u?void 0:u.getTs())&&void 0!==c?c:null,this.updateParticipants(),t.on(ut.Update,this.onRoomState),this.on(rn.ParticipantsChanged,this.onParticipantsChanged),this.on(rn.GroupCallStateChanged,this.onStateChanged),this.on(rn.LocalScreenshareStateChanged,this.onLocalFeedsChanged),this.allowCallWithoutVideoAndAudio=!!l}create(){var e=this;return U((function*(){return e.creationTs=Date.now(),e.client.groupCallEventHandler.groupCalls.set(e.room.roomId,e),e.client.emit(yk.Outgoing,e),yield e.sendCallStateEvent(),e}))()}sendCallStateEvent(){var e=this;return U((function*(){var t={"m.intent":e.intent,"m.type":e.type,"io.element.ptt":e.isPtt,dataChannelsEnabled:e.dataChannelsEnabled,dataChannelOptions:e.dataChannelsEnabled?e.dataChannelOptions:void 0};e.livekitServiceURL&&(t["io.element.livekit_service_url"]=e.livekitServiceURL),yield e.client.sendStateEvent(e.room.roomId,ee.GroupCallPrefix,t,e.groupCallId)}))()}get livekitServiceURL(){return this._livekitServiceURL}updateLivekitServiceURL(e){return this._livekitServiceURL=e,this.sendCallStateEvent()}get state(){return this._state}set state(e){var t=this._state;e!==t&&(this._state=e,this.emit(rn.GroupCallStateChanged,e,t))}get participants(){return this._participants}set participants(e){var t=this._participants,n=(e,t)=>e.sessionId===t.sessionId&&e.screensharing===t.screensharing;r5(e,t,((e,t)=>r5(e,t,n)))||(this._participants=e,this.emit(rn.ParticipantsChanged,e))}get creationTs(){return this._creationTs}set creationTs(e){this._creationTs=e}get enteredViaAnotherSession(){return this._enteredViaAnotherSession}set enteredViaAnotherSession(e){this._enteredViaAnotherSession=e,this.updateParticipants()}forEachCall(e){for(var t of this.calls.values())for(var n of t.values())e(n)}getLocalFeeds(){var e=[];return this.localCallFeed&&e.push(this.localCallFeed),this.localScreenshareFeed&&e.push(this.localScreenshareFeed),e}hasLocalParticipant(){var e,t;return null!==(e=null===(t=this.participants.get(this.room.getMember(this.client.getUserId())))||void 0===t?void 0:t.has(this.client.getDeviceId()))&&void 0!==e&&e}callExpected(e){var t,n=w1(e),r=null===n?null:this.room.getMember(n),i=e.getOpponentDeviceId();return null!==r&&void 0!==i&&void 0!==(null===(t=this.participants.get(r))||void 0===t?void 0:t.get(i))}initLocalCallFeed(){var e=this;return U((function*(){if(e.useLivekit)A.info("Livekit group call: not starting local call feed.");else{if(e.state!==Ln.LocalCallFeedUninitialized)throw new Error('Cannot initialize local call feed in the "'.concat(e.state,'" state.'));if(e.state=Ln.InitializingLocalCallFeed,e.initCallFeedPromise)return e.initCallFeedPromise;try{e.initCallFeedPromise=e.initLocalCallFeedInternal(),yield e.initCallFeedPromise}finally{e.initCallFeedPromise=void 0}}}))()}initLocalCallFeedInternal(){var e=this;return U((function*(){var t;A.log("GroupCall ".concat(e.groupCallId," initLocalCallFeedInternal() running"));try{t=yield e.client.getMediaHandler().getUserMediaStream(!0,e.type===LE.Video)}catch(n){if(!e.allowCallWithoutVideoAndAudio)throw e.state=Ln.LocalCallFeedUninitialized,n;t=new MediaStream}if(e._state!==Ln.InitializingLocalCallFeed)throw e.client.getMediaHandler().stopUserMediaStream(t),new Error("Group call disposed while gathering media stream");var n=new hl({client:e.client,roomId:e.room.roomId,userId:e.client.getUserId(),deviceId:e.client.getDeviceId(),stream:t,purpose:sn.Usermedia,audioMuted:e.initWithAudioMuted||0===t.getAudioTracks().length||e.isPtt,videoMuted:e.initWithVideoMuted||0===t.getVideoTracks().length});rr(t.getAudioTracks(),!n.isAudioMuted()),rr(t.getVideoTracks(),!n.isVideoMuted()),e.localCallFeed=n,e.addUserMediaFeed(n),e.state=Ln.LocalCallFeedInitialized}))()}updateLocalUsermediaStream(e){var t=this;return U((function*(){if(t.localCallFeed){var n=t.localCallFeed.stream;t.localCallFeed.setNewStream(e);var r=t.localCallFeed.isAudioMuted(),i=t.localCallFeed.isVideoMuted();A.log("GroupCall ".concat(t.groupCallId," updateLocalUsermediaStream() (oldStreamId=").concat(n.id,", newStreamId=").concat(e.id,", micShouldBeMuted=").concat(r,", vidShouldBeMuted=").concat(i,")")),rr(e.getAudioTracks(),!r),rr(e.getVideoTracks(),!i),t.client.getMediaHandler().stopUserMediaStream(n)}}))()}enter(){var e=this;return U((function*(){if(e.state===Ln.LocalCallFeedUninitialized)yield e.initLocalCallFeed();else if(e.state!==Ln.LocalCallFeedInitialized)throw new Error('Cannot enter call in the "'.concat(e.state,'" state'));for(var t of(A.log("GroupCall ".concat(e.groupCallId," enter() running")),e.state=Ln.Entered,e.client.on(vk.Incoming,e.onIncomingCall),e.client.callEventHandler.calls.values()))e.onIncomingCall(t);e.useLivekit||(e.retryCallLoopInterval=setInterval(e.onRetryCallLoop,e.retryCallInterval),e.activeSpeaker=void 0,e.onActiveSpeakerLoop(),e.activeSpeakerLoopInterval=setInterval(e.onActiveSpeakerLoop,e.activeSpeakerInterval))}))()}dispose(){var e;this.localCallFeed&&(this.removeUserMediaFeed(this.localCallFeed),this.localCallFeed=void 0),this.localScreenshareFeed&&(this.client.getMediaHandler().stopScreensharingStream(this.localScreenshareFeed.stream),this.removeScreenshareFeed(this.localScreenshareFeed),this.localScreenshareFeed=void 0,this.localDesktopCapturerSourceId=void 0),this.client.getMediaHandler().stopAllStreams(),null!==this.transmitTimer&&(clearTimeout(this.transmitTimer),this.transmitTimer=null),void 0!==this.retryCallLoopInterval&&(clearInterval(this.retryCallLoopInterval),this.retryCallLoopInterval=void 0),null!==this.participantsExpirationTimer&&(clearTimeout(this.participantsExpirationTimer),this.participantsExpirationTimer=null),this.state===Ln.Entered&&(this.forEachCall((e=>e.hangup(ct.UserHangup,!1))),this.activeSpeaker=void 0,clearInterval(this.activeSpeakerLoopInterval),this.retryCallCounts.clear(),clearInterval(this.retryCallLoopInterval),this.client.removeListener(vk.Incoming,this.onIncomingCall),null===(e=this.stats)||void 0===e||e.stop())}leave(){this.dispose(),this.state=Ln.LocalCallFeedUninitialized}terminate(){var e=arguments,t=this;return U((function*(){var n=!(e.length>0&&void 0!==e[0])||e[0];if(t.dispose(),t.room.off(ut.Update,t.onRoomState),t.client.groupCallEventHandler.groupCalls.delete(t.room.roomId),t.client.emit(yk.Ended,t),t.state=Ln.Ended,n){var r=t.room.currentState.getStateEvents(ee.GroupCallPrefix,t.groupCallId);yield t.client.sendStateEvent(t.room.roomId,ee.GroupCallPrefix,E1(E1({},r.getContent()),{},{"m.terminated":roe.CallEnded}),t.groupCallId)}}))()}isLocalVideoMuted(){return!this.localCallFeed||this.localCallFeed.isVideoMuted()}isMicrophoneMuted(){return!this.localCallFeed||this.localCallFeed.isAudioMuted()}setMicrophoneMuted(e){var t=this;return U((function*(){if(!e&&!(yield t.client.getMediaHandler().hasAudioDevice()))return!1;var n=!e&&t.isPtt;t.isPtt&&(!e&&t.isMicrophoneMuted()?t.transmitTimer=setTimeout((()=>{t.setMicrophoneMuted(!0)}),t.pttMaxTransmitTime):e&&!t.isMicrophoneMuted()&&(null!==t.transmitTimer&&clearTimeout(t.transmitTimer),t.transmitTimer=null)),t.forEachCall((t=>{var n;return null===(n=t.localUsermediaFeed)||void 0===n?void 0:n.setAudioVideoMuted(e,null)}));var r,i=(r=U((function*(){var e=[];t.forEachCall((t=>e.push(t.sendMetadataUpdate()))),yield Promise.all(e).catch((e=>A.info("GroupCall ".concat(t.groupCallId," setMicrophoneMuted() failed to send some metadata updates"),e)))})),function(){return r.apply(this,arguments)});if(n&&(yield i()),t.localCallFeed){if(A.log("GroupCall ".concat(t.groupCallId," setMicrophoneMuted() (streamId=").concat(t.localCallFeed.stream.id,", muted=").concat(e,")")),!(yield t.checkAudioPermissionIfNecessary(e)))return!1;t.localCallFeed.setAudioVideoMuted(e,null),rr(t.localCallFeed.stream.getAudioTracks(),!e)}else A.log("GroupCall ".concat(t.groupCallId," setMicrophoneMuted() no stream muted (muted=").concat(e,")")),t.initWithAudioMuted=e;return t.forEachCall((n=>rr(n.localUsermediaFeed.stream.getAudioTracks(),!e&&t.callExpected(n)))),t.emit(rn.LocalMuteStateChanged,e,t.isLocalVideoMuted()),n||(yield i()),!0}))()}checkAudioPermissionIfNecessary(e){var t=this;return U((function*(){try{if(!e&&t.localCallFeed&&!t.localCallFeed.hasAudioTrack){var n=yield t.client.getMediaHandler().getUserMediaStream(!0,!t.localCallFeed.isVideoMuted());if(0===(null==n?void 0:n.getTracks().length))return A.log("GroupCall ".concat(t.groupCallId," setMicrophoneMuted() no device to receive local stream, muted=").concat(e)),!1}}catch{return A.log("GroupCall ".concat(t.groupCallId," setMicrophoneMuted() no device or permission to receive local stream, muted=").concat(e)),!1}return!0}))()}setLocalVideoMuted(e){var t=this;return U((function*(){if(!e&&!(yield t.client.getMediaHandler().hasVideoDevice()))return!1;if(t.localCallFeed){A.log("GroupCall ".concat(t.groupCallId," setLocalVideoMuted() (stream=").concat(t.localCallFeed.stream.id,", muted=").concat(e,")"));try{var n=yield t.client.getMediaHandler().getUserMediaStream(!0,!e);yield t.updateLocalUsermediaStream(n),t.localCallFeed.setAudioVideoMuted(null,e),rr(t.localCallFeed.stream.getVideoTracks(),!e)}catch{return A.log("GroupCall ".concat(t.groupCallId," setLocalVideoMuted() no device or permission to receive local stream, muted=").concat(e)),!1}}else A.log("GroupCall ".concat(t.groupCallId," setLocalVideoMuted() no stream muted (muted=").concat(e,")")),t.initWithVideoMuted=e;var r=[];return t.forEachCall((t=>r.push(t.setLocalVideoMuted(e)))),yield Promise.all(r),t.forEachCall((n=>rr(n.localUsermediaFeed.stream.getVideoTracks(),!e&&t.callExpected(n)))),t.emit(rn.LocalMuteStateChanged,t.isMicrophoneMuted(),e),!0}))()}setScreensharingEnabled(e){var t=arguments,n=this;return U((function*(){var r=t.length>1&&void 0!==t[1]?t[1]:{};if(e===n.isScreensharing())return e;if(!e)return n.forEachCall((e=>{e.localScreensharingFeed&&e.removeLocalFeed(e.localScreensharingFeed)})),n.client.getMediaHandler().stopScreensharingStream(n.localScreenshareFeed.stream),n.removeScreenshareFeed(n.localScreenshareFeed),n.localScreenshareFeed=void 0,n.localDesktopCapturerSourceId=void 0,n.emit(rn.LocalScreenshareStateChanged,!1,void 0,void 0),!1;try{A.log("GroupCall ".concat(n.groupCallId," setScreensharingEnabled() is asking for screensharing permissions"));var i=yield n.client.getMediaHandler().getScreensharingStream(r),o=function*(e){var t=()=>{n.setScreensharingEnabled(!1),e.removeEventListener("ended",t)};e.addEventListener("ended",t)};for(var s of i.getTracks())yield*o(s);return A.log("GroupCall ".concat(n.groupCallId," setScreensharingEnabled() granted screensharing permissions. Setting screensharing enabled on all calls")),n.localDesktopCapturerSourceId=r.desktopCapturerSourceId,n.localScreenshareFeed=new hl({client:n.client,roomId:n.room.roomId,userId:n.client.getUserId(),deviceId:n.client.getDeviceId(),stream:i,purpose:sn.Screenshare,audioMuted:!1,videoMuted:!1}),n.addScreenshareFeed(n.localScreenshareFeed),n.emit(rn.LocalScreenshareStateChanged,!0,n.localScreenshareFeed,n.localDesktopCapturerSourceId),n.forEachCall((e=>e.pushLocalFeed(n.localScreenshareFeed.clone()))),!0}catch(e){if(r.throwOnFail)throw e;return A.error("GroupCall ".concat(n.groupCallId," setScreensharingEnabled() enabling screensharing error"),e),n.emit(rn.Error,new _k(Gg.NoUserMedia,"Failed to get screen-sharing stream: ",e)),!1}}))()}isScreensharing(){return!!this.localScreenshareFeed}wantsOutgoingCall(e,t){var n=this.client.getUserId(),r=this.client.getDeviceId();return e>=n&&(e!==n||t>r)}placeOutgoingCalls(){var e=this,t=!1,n=function(n){var r,o=null!==(r=e.calls.get(n))&&void 0!==r?r:new Map,s=function(r){var i=o.get(r);if((null==i?void 0:i.getOpponentSessionId())!==l.sessionId&&e.wantsOutgoingCall(n,r)){t=!0,void 0!==i&&(A.debug("GroupCall ".concat(e.groupCallId," placeOutgoingCalls() replacing call (userId=").concat(n,", deviceId=").concat(r,", callId=").concat(i.callId,")")),i.hangup(ct.NewSession,!1));var s=Iv(e.client,e.room.roomId,{invitee:n,opponentDeviceId:r,opponentSessionId:l.sessionId,groupCallId:e.groupCallId});null===s?(A.error("GroupCall ".concat(e.groupCallId," placeOutgoingCalls() failed to create call (userId=").concat(n,", device=").concat(r,")")),o.delete(r)):(e.initCall(s),o.set(r,s),A.debug("GroupCall ".concat(e.groupCallId," placeOutgoingCalls() placing call (userId=").concat(n,", deviceId=").concat(r,", sessionId=").concat(l.sessionId,")")),s.placeCallWithCallFeeds(e.getLocalFeeds().map((e=>e.clone())),l.screensharing).then((()=>{e.dataChannelsEnabled&&s.createDataChannel("datachannel",e.dataChannelOptions)})).catch((t=>{A.warn("GroupCall ".concat(e.groupCallId," placeOutgoingCalls() failed to place call (userId=").concat(n,")"),t),t instanceof rl&&t.code===Gg.UnknownDevice?e.emit(rn.Error,t):e.emit(rn.Error,new _k(Gg.PlaceCallFailed,"Failed to place call to ".concat(n))),s.hangup(ct.SignallingFailed,!1),o.get(r)===s&&o.delete(r)})))}};for(var[a,l]of i)s(a);o.size>0?e.calls.set(n,o):e.calls.delete(n)};for(var[{userId:r},i]of this.participants)n(r);t&&this.emit(rn.CallsChanged,this.calls)}getMemberStateEvents(e){return void 0===e?this.room.currentState.getStateEvents(ee.GroupCallMemberPrefix):this.room.currentState.getStateEvents(ee.GroupCallMemberPrefix,e)}initCall(e){var t=w1(e);if(!t)throw new Error("Cannot init call without user id");var n=()=>this.onCallFeedsChanged(e),r=(t,n)=>this.onCallStateChanged(e,t,n),i=this.onCallHangup,o=t=>this.onCallReplaced(e,t),s=this.callHandlers.get(t);void 0===s&&(s=new Map,this.callHandlers.set(t,s)),s.set(e.getOpponentDeviceId(),{onCallFeedsChanged:n,onCallStateChanged:r,onCallHangup:i,onCallReplaced:o}),e.on(ft.FeedsChanged,n),e.on(ft.State,r),e.on(ft.Hangup,i),e.on(ft.Replaced,o),e.isPtt=this.isPtt,this.reEmitter.reEmit(e,Object.values(ft)),e.initStats(this.getGroupCallStats()),n()}disposeCall(e,t){var n=w1(e),r=e.getOpponentDeviceId();if(!n)throw new Error("Cannot dispose call without user id");var i=this.callHandlers.get(n),{onCallFeedsChanged:o,onCallStateChanged:s,onCallHangup:a,onCallReplaced:l}=i.get(r);if(e.removeListener(ft.FeedsChanged,o),e.removeListener(ft.State,s),e.removeListener(ft.Hangup,a),e.removeListener(ft.Replaced,l),i.delete(n),0===i.size&&this.callHandlers.delete(n),e.hangupReason!==ct.Replaced){var c=this.getUserMediaFeed(n,r);c&&this.removeUserMediaFeed(c);var u=this.getScreenshareFeed(n,r);u&&this.removeScreenshareFeed(u)}}getUserMediaFeed(e,t){return this.userMediaFeeds.find((n=>n.userId===e&&n.deviceId===t))}addUserMediaFeed(e){this.userMediaFeeds.push(e),e.measureVolumeActivity(!0),this.emit(rn.UserMediaFeedsChanged,this.userMediaFeeds)}replaceUserMediaFeed(e,t){var n=this.userMediaFeeds.findIndex((t=>t.userId===e.userId&&t.deviceId===e.deviceId));if(-1===n)throw new Error("Couldn't find user media feed to replace");this.userMediaFeeds.splice(n,1,t),e.dispose(),t.measureVolumeActivity(!0),this.emit(rn.UserMediaFeedsChanged,this.userMediaFeeds)}removeUserMediaFeed(e){var t=this.userMediaFeeds.findIndex((t=>t.userId===e.userId&&t.deviceId===e.deviceId));if(-1===t)throw new Error("Couldn't find user media feed to remove");this.userMediaFeeds.splice(t,1),e.dispose(),this.emit(rn.UserMediaFeedsChanged,this.userMediaFeeds),this.activeSpeaker===e&&(this.activeSpeaker=this.userMediaFeeds[0],this.emit(rn.ActiveSpeakerChanged,this.activeSpeaker))}getScreenshareFeed(e,t){return this.screenshareFeeds.find((n=>n.userId===e&&n.deviceId===t))}addScreenshareFeed(e){this.screenshareFeeds.push(e),this.emit(rn.ScreenshareFeedsChanged,this.screenshareFeeds)}replaceScreenshareFeed(e,t){var n=this.screenshareFeeds.findIndex((t=>t.userId===e.userId&&t.deviceId===e.deviceId));if(-1===n)throw new Error("Couldn't find screenshare feed to replace");this.screenshareFeeds.splice(n,1,t),e.dispose(),this.emit(rn.ScreenshareFeedsChanged,this.screenshareFeeds)}removeScreenshareFeed(e){var t=this.screenshareFeeds.findIndex((t=>t.userId===e.userId&&t.deviceId===e.deviceId));if(-1===t)throw new Error("Couldn't find screenshare feed to remove");this.screenshareFeeds.splice(t,1),e.dispose(),this.emit(rn.ScreenshareFeedsChanged,this.screenshareFeeds)}updateParticipants(){var e=this.room.getMember(this.client.getSafeUserId());if(e)if(null!==this.participantsExpirationTimer&&(clearTimeout(this.participantsExpirationTimer),this.participantsExpirationTimer=null),this.state!==Ln.Ended){var t=new Map,n=Date.now(),r=this.state===Ln.Entered||this.enteredViaAnotherSession,i=1/0;for(var o of this.getMemberStateEvents()){var s=this.room.getMember(o.getStateKey()),a=o.getContent(),l=(Array.isArray(a["m.calls"])?a["m.calls"]:[]).find((e=>e["m.call_id"]===this.groupCallId)),c=(Array.isArray(null==l?void 0:l["m.devices"])?l["m.devices"]:[]).filter((e=>"string"==typeof e.device_id&&"string"==typeof e.session_id&&"number"==typeof e.expires_ts&&e.expires_ts>n&&Array.isArray(e.feeds)));if(!r&&(null==s?void 0:s.userId)===this.client.getUserId()&&(c=c.filter((e=>e.device_id!==this.client.getDeviceId()))),c.length>0&&(null==s?void 0:s.membership)===Ke.Join){var u=new Map;for(var d of(t.set(s,u),c))u.set(d.device_id,{sessionId:d.session_id,screensharing:d.feeds.some((e=>e.purpose===sn.Screenshare))}),d.expires_ts<i&&(i=d.expires_ts)}}if(r){var h=t.get(e);void 0===h&&(h=new Map,t.set(e,h)),h.has(this.client.getDeviceId())||h.set(this.client.getDeviceId(),{sessionId:this.client.getSessionId(),screensharing:this.getLocalFeeds().some((e=>e.purpose===sn.Screenshare))})}this.participants=t,i<1/0&&(this.participantsExpirationTimer=setTimeout((()=>this.updateParticipants()),i-n))}else this.participants=new Map;else A.warn("GroupCall ".concat(this.groupCallId," updateParticipants() tried to update participants before local room member is available"))}updateDevices(e){var t=arguments,n=this;return U((function*(){var r,i=t.length>1&&void 0!==t[1]&&t[1],o=Date.now(),s=n.client.getUserId(),a=n.getMemberStateEvents(s),l=null!==(r=null==a?void 0:a.getContent())&&void 0!==r?r:{},c=Array.isArray(l["m.calls"])?l["m.calls"]:[],u=null,d=[];for(var h of c)h["m.call_id"]===n.groupCallId?u=h:d.push(h);null===u&&(u={});var p=(Array.isArray(u["m.devices"])?u["m.devices"]:[]).filter((e=>"string"==typeof e.device_id&&"string"==typeof e.session_id&&"number"==typeof e.expires_ts&&e.expires_ts>o&&Array.isArray(e.feeds))),f=e(p);if(null!==f){var m=[...d];f.length>0&&m.push(E1(E1({},u),{},{"m.call_id":n.groupCallId,"m.devices":f}));var v={"m.calls":m};yield n.client.sendStateEvent(n.room.roomId,ee.GroupCallMemberPrefix,v,s,{keepAlive:i})}}))()}addDeviceToMemberState(){var e=this;return U((function*(){yield e.updateDevices((t=>[...t.filter((t=>t.device_id!==e.client.getDeviceId())),{device_id:e.client.getDeviceId(),session_id:e.client.getSessionId(),expires_ts:Date.now()+tN,feeds:e.getLocalFeeds().map((e=>({purpose:e.purpose})))}]))}))()}updateMemberState(){var e=this;return U((function*(){null!==e.resendMemberStateTimer&&(clearInterval(e.resendMemberStateTimer),e.resendMemberStateTimer=null),e.state===Ln.Entered?(yield e.addDeviceToMemberState(),e.resendMemberStateTimer=setInterval(U((function*(){A.log("GroupCall ".concat(e.groupCallId,' updateMemberState() resending call member state"'));try{yield e.addDeviceToMemberState()}catch(t){A.error("GroupCall ".concat(e.groupCallId," updateMemberState() failed to resend call member state"),t)}})),3*tN/4)):yield e.updateDevices((t=>t.filter((t=>t.device_id!==e.client.getDeviceId()))),!0)}))()}cleanMemberState(){var e=this;return U((function*(){var{devices:t}=yield e.client.getDevices(),n=new Map(t.map((e=>[e.device_id,e])));yield e.updateDevices((t=>{var r=t.filter((t=>{var r=n.get(t.device_id);return void 0!==(null==r?void 0:r.last_seen_ts)&&!(t.device_id===e.client.getDeviceId()&&e.state!==Ln.Entered&&!e.enteredViaAnotherSession)}));return r.length===t.length?null:r}))}))()}getGroupCallStats(){if(void 0===this.stats){var e=this.client.getUserId()||"unknown";this.stats=new noe(this.groupCallId,e,this.statsCollectIntervalTime),this.stats.reports.on(_l.CONNECTION_STATS,this.onConnectionStats),this.stats.reports.on(_l.BYTE_SENT_STATS,this.onByteSentStats),this.stats.reports.on(_l.SUMMARY_STATS,this.onSummaryStats),this.stats.reports.on(_l.CALL_FEED_REPORT,this.onCallFeedReport)}return this.stats}setGroupCallStatsInterval(e){this.statsCollectIntervalTime=e,void 0!==this.stats&&(this.stats.stop(),this.stats.setInterval(e),e>0&&this.stats.start())}}function nN(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function C1(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?nN(Object(n),!0).forEach((function(t){L(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):nN(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var rt=function(e){return e.Fledgling="fledgling",e.InviteSent="invite_sent",e.WaitLocalMedia="wait_local_media",e.CreateOffer="create_offer",e.CreateAnswer="create_answer",e.Connecting="connecting",e.Connected="connected",e.Ringing="ringing",e.Ended="ended",e}({}),rN=function(e){return e.Voice="voice",e.Video="video",e}({}),Rc=function(e){return e.Inbound="inbound",e.Outbound="outbound",e}({}),Fn=function(e){return e.Local="local",e.Remote="remote",e}({}),ft=function(e){return e.Hangup="hangup",e.State="state",e.Error="error",e.Replaced="replaced",e.LocalHoldUnhold="local_hold_unhold",e.RemoteHoldUnhold="remote_hold_unhold",e.HoldUnhold="hold_unhold",e.FeedsChanged="feeds_changed",e.AssertedIdentityChanged="asserted_identity_changed",e.LengthChanged="length_changed",e.DataChannel="datachannel",e.SendVoipEvent="send_voip_event",e.PeerConnectionCreated="peer_connection_created",e}({}),ct=function(e){return e.UserHangup="user_hangup",e.LocalOfferFailed="local_offer_failed",e.NoUserMedia="no_user_media",e.UnknownDevices="unknown_devices",e.SendInvite="send_invite",e.CreateAnswer="create_answer",e.CreateOffer="create_offer",e.SendAnswer="send_answer",e.SetRemoteDescription="set_remote_description",e.SetLocalDescription="set_local_description",e.AnsweredElsewhere="answered_elsewhere",e.IceFailed="ice_failed",e.InviteTimeout="invite_timeout",e.Replaced="replaced",e.SignallingFailed="signalling_timeout",e.UserBusy="user_busy",e.Transferred="transferred",e.NewSession="new_session",e}({}),ioe="1",soe="stun:turn.matrix.org",n2=6e4,ooe=1e3,aoe=3e4,loe=2e3;class rl extends Error{constructor(e,t,n){super(t+": "+n),L(this,"code",void 0),this.code=e}}function od(){return Date.now().toString()+_s(16)}function iN(e){return[{mediaType:"audio",codec:"opus",enableDtx:!0,maxAverageBitrate:e?12e3:void 0}]}function vo(e,t){return e+":"+t}class coe extends En{constructor(e){var t,n;if(super(),t=this,L(this,"roomId",void 0),L(this,"callId",void 0),L(this,"invitee",void 0),L(this,"hangupParty",void 0),L(this,"hangupReason",void 0),L(this,"direction",void 0),L(this,"ourPartyId",void 0),L(this,"peerConn",void 0),L(this,"toDeviceSeq",0),L(this,"isPtt",!1),L(this,"_state",rt.Fledgling),L(this,"client",void 0),L(this,"forceTURN",void 0),L(this,"turnServers",void 0),L(this,"candidateSendQueue",[]),L(this,"candidateSendTries",0),L(this,"candidatesEnded",!1),L(this,"feeds",[]),L(this,"transceivers",new Map),L(this,"inviteOrAnswerSent",!1),L(this,"waitForLocalAVStream",!1),L(this,"successor",void 0),L(this,"opponentMember",void 0),L(this,"opponentVersion",void 0),L(this,"opponentPartyId",void 0),L(this,"opponentCaps",void 0),L(this,"iceDisconnectedTimeout",void 0),L(this,"iceReconnectionTimeOut",void 0),L(this,"inviteTimeout",void 0),L(this,"removeTrackListeners",new Map),L(this,"remoteOnHold",!1),L(this,"callStatsAtEnd",void 0),L(this,"makingOffer",!1),L(this,"ignoreOffer",!1),L(this,"isSettingRemoteAnswerPending",!1),L(this,"responsePromiseChain",void 0),L(this,"remoteCandidateBuffer",new Map),L(this,"remoteAssertedIdentity",void 0),L(this,"remoteSDPStreamMetadata",void 0),L(this,"callLengthInterval",void 0),L(this,"callStartTime",void 0),L(this,"opponentDeviceId",void 0),L(this,"hasOpponentDeviceInfo",void 0),L(this,"opponentSessionId",void 0),L(this,"groupCallId",void 0),L(this,"stopVideoTrackTimer",void 0),L(this,"isOnlyDataChannelAllowed",void 0),L(this,"stats",void 0),L(this,"gotLocalIceCandidate",(e=>{if(e.candidate){if(this.candidatesEnded&&A.warn("Call ".concat(this.callId," gotLocalIceCandidate() got candidate after candidates have ended!")),A.debug("Call ".concat(this.callId," got local ICE ").concat(e.candidate.sdpMid," ").concat(e.candidate.candidate)),this.callHasEnded())return;""===e.candidate.candidate?this.queueCandidate(null):this.queueCandidate(e.candidate)}})),L(this,"onIceGatheringStateChange",(e=>{var t;A.debug("Call ".concat(this.callId," onIceGatheringStateChange() ice gathering state changed to ").concat(this.peerConn.iceGatheringState)),"complete"===(null===(t=this.peerConn)||void 0===t?void 0:t.iceGatheringState)&&(this.queueCandidate(null),A.debug("Call ".concat(this.callId," onIceGatheringStateChange() ice gathering state complete, set candidates have ended")))})),L(this,"getLocalOfferFailed",(e=>{A.error("Call ".concat(this.callId," getLocalOfferFailed() running"),e),this.emit(ft.Error,new rl(ct.LocalOfferFailed,"Failed to get local offer!",e),this),this.terminate(Fn.Local,ct.LocalOfferFailed,!1)})),L(this,"getUserMediaFailed",(e=>{this.successor?this.successor.getUserMediaFailed(e):(A.warn("Call ".concat(this.callId," getUserMediaFailed() failed to get user media - ending call"),e),this.emit(ft.Error,new rl(ct.NoUserMedia,"Couldn't start capturing media! Is your microphone set up and does this app have permission?",e),this),this.terminate(Fn.Local,ct.NoUserMedia,!1))})),L(this,"placeCallFailed",(e=>{this.successor?this.successor.placeCallFailed(e):(A.warn("Call ".concat(this.callId," placeCallWithCallFeeds() failed - ending call"),e),this.emit(ft.Error,new rl(ct.IceFailed,"Couldn't start call! Invalid ICE server configuration.",e),this),this.terminate(Fn.Local,ct.IceFailed,!1))})),L(this,"onIceConnectionStateChanged",(()=>{var e,t,n,r,i,o;if(!this.callHasEnded()){if(A.debug("Call ".concat(this.callId," onIceConnectionStateChanged() running (state=").concat(null===(e=this.peerConn)||void 0===e?void 0:e.iceConnectionState,", conn=").concat(null===(t=this.peerConn)||void 0===t?void 0:t.connectionState,")")),["connected","completed"].includes(null!==(n=null===(r=this.peerConn)||void 0===r?void 0:r.iceConnectionState)&&void 0!==n?n:""))clearTimeout(this.iceDisconnectedTimeout),this.iceDisconnectedTimeout=void 0,this.iceReconnectionTimeOut&&clearTimeout(this.iceReconnectionTimeOut),this.state=rt.Connected,!this.callLengthInterval&&!this.callStartTime&&(this.callStartTime=Date.now(),this.callLengthInterval=setInterval((()=>{this.emit(ft.LengthChanged,Math.round((Date.now()-this.callStartTime)/1e3),this)}),ooe));else if("failed"==(null===(i=this.peerConn)||void 0===i?void 0:i.iceConnectionState)){var s,a;if(this.candidatesEnded=!1,null!==(s=this.peerConn)&&void 0!==s&&s.restartIce)this.candidatesEnded=!1,A.debug("Call ".concat(this.callId," onIceConnectionStateChanged() ice restart (state=").concat(null===(a=this.peerConn)||void 0===a?void 0:a.iceConnectionState,")")),this.peerConn.restartIce();else A.info("Call ".concat(this.callId," onIceConnectionStateChanged() hanging up call (ICE failed and no ICE restart method)")),this.hangup(ct.IceFailed,!1)}else"disconnected"==(null===(o=this.peerConn)||void 0===o?void 0:o.iceConnectionState)&&(this.candidatesEnded=!1,this.iceReconnectionTimeOut=setTimeout((()=>{var e,t,n;A.info("Call ".concat(this.callId," onIceConnectionStateChanged() ICE restarting because of ICE disconnected, (state=").concat(null===(e=this.peerConn)||void 0===e?void 0:e.iceConnectionState,", conn=").concat(null===(t=this.peerConn)||void 0===t?void 0:t.connectionState,")")),null!==(n=this.peerConn)&&void 0!==n&&n.restartIce&&(this.candidatesEnded=!1,this.peerConn.restartIce()),this.iceReconnectionTimeOut=void 0}),loe),this.iceDisconnectedTimeout=setTimeout((()=>{A.info("Call ".concat(this.callId," onIceConnectionStateChanged() hanging up call (ICE disconnected for too long)")),this.hangup(ct.IceFailed,!1)}),aoe),this.state=rt.Connecting);if(this.isPtt&&["failed","disconnected"].includes(this.peerConn.iceConnectionState))for(var l of this.getRemoteFeeds())l.setAudioVideoMuted(!0,!0)}})),L(this,"onSignallingStateChanged",(()=>{var e;A.debug("Call ".concat(this.callId," onSignallingStateChanged() running (state=").concat(null===(e=this.peerConn)||void 0===e?void 0:e.signalingState,")"))})),L(this,"onTrack",(e=>{if(0!==e.streams.length){var t=e.streams[0];if(this.pushRemoteFeed(t),!this.removeTrackListeners.has(t)){var n=()=>{0===t.getTracks().length&&(A.info("Call ".concat(this.callId," onTrack() removing track (streamId=").concat(t.id,")")),this.deleteFeedByStream(t),t.removeEventListener("removetrack",n),this.removeTrackListeners.delete(t))};t.addEventListener("removetrack",n),this.removeTrackListeners.set(t,n)}}else A.warn("Call ".concat(this.callId," onTrack() called with streamless track streamless (kind=").concat(e.track.kind,")"))})),L(this,"onDataChannel",(e=>{this.emit(ft.DataChannel,e.channel,this)})),L(this,"onNegotiationNeeded",U((function*(){A.info("Call ".concat(t.callId," onNegotiationNeeded() negotiation is needed!")),t.state===rt.CreateOffer||0!==t.opponentVersion?t.queueGotLocalOffer():A.info("Call ".concat(t.callId," onNegotiationNeeded() opponent does not support renegotiation: ignoring negotiationneeded event"))}))),L(this,"onHangupReceived",(e=>{A.debug("Call ".concat(this.callId," onHangupReceived() running")),this.partyIdMatches(e)||this.state===rt.Ringing?this.terminate(Fn.Remote,e.reason||ct.UserHangup,!0):A.info("Call ".concat(this.callId," onHangupReceived() ignoring message from party ID ").concat(e.party_id,": our partner is ").concat(this.opponentPartyId))})),L(this,"onRejectReceived",(e=>{A.debug("Call ".concat(this.callId," onRejectReceived() running")),[rt.InviteSent,rt.Ringing].includes(this.state)||this.state===rt.Fledgling&&this.direction===Rc.Inbound?this.terminate(Fn.Remote,e.reason||ct.UserHangup,!0):A.debug("Call ".concat(this.callId," onRejectReceived() called in wrong state (state=").concat(this.state,")"))})),L(this,"onAnsweredElsewhere",(e=>{A.debug("Call ".concat(this.callId," onAnsweredElsewhere() running")),this.terminate(Fn.Remote,ct.AnsweredElsewhere,!0)})),this.roomId=e.roomId,this.invitee=e.invitee,this.client=e.client,!this.client.deviceId)throw new Error("Client must have a device ID to start calls");for(var r of(this.forceTURN=null!==(n=e.forceTURN)&&void 0!==n&&n,this.ourPartyId=this.client.deviceId,this.opponentDeviceId=e.opponentDeviceId,this.opponentSessionId=e.opponentSessionId,this.groupCallId=e.groupCallId,this.turnServers=e.turnServers||[],0===this.turnServers.length&&this.client.isFallbackICEServerAllowed()&&this.turnServers.push({urls:[soe]}),this.turnServers))f$(r,["urls"]);this.callId=od(),this.isOnlyDataChannelAllowed=this.client.isVoipWithNoMediaAllowed}placeVoiceCall(){var e=this;return U((function*(){yield e.placeCall(!0,!1)}))()}placeVideoCall(){var e=this;return U((function*(){yield e.placeCall(!0,!0)}))()}createDataChannel(e,t){var n=this.peerConn.createDataChannel(e,t);return this.emit(ft.DataChannel,n,this),n}getOpponentMember(){return this.opponentMember}getOpponentDeviceId(){return this.opponentDeviceId}getOpponentSessionId(){return this.opponentSessionId}opponentCanBeTransferred(){return!(!this.opponentCaps||!this.opponentCaps["m.call.transferee"])}opponentSupportsDTMF(){return!(!this.opponentCaps||!this.opponentCaps["m.call.dtmf"])}getRemoteAssertedIdentity(){return this.remoteAssertedIdentity}get state(){return this._state}set state(e){var t=this._state;this._state=e,this.emit(ft.State,e,t,this)}get type(){return this.hasUserMediaVideoSender||this.hasRemoteUserMediaVideoTrack?rN.Video:rN.Voice}get hasLocalUserMediaVideoTrack(){var e;return!(null===(e=this.localUsermediaStream)||void 0===e||!e.getVideoTracks().length)}get hasRemoteUserMediaVideoTrack(){return this.getRemoteFeeds().some((e=>{var t;return e.purpose===sn.Usermedia&&(null===(t=e.stream)||void 0===t?void 0:t.getVideoTracks().length)}))}get hasLocalUserMediaAudioTrack(){var e;return!(null===(e=this.localUsermediaStream)||void 0===e||!e.getAudioTracks().length)}get hasRemoteUserMediaAudioTrack(){return this.getRemoteFeeds().some((e=>{var t;return e.purpose===sn.Usermedia&&!(null===(t=e.stream)||void 0===t||!t.getAudioTracks().length)}))}get hasUserMediaAudioSender(){var e;return!(null===(e=this.transceivers.get(vo(sn.Usermedia,"audio")))||void 0===e||!e.sender)}get hasUserMediaVideoSender(){var e;return!(null===(e=this.transceivers.get(vo(sn.Usermedia,"video")))||void 0===e||!e.sender)}get localUsermediaFeed(){return this.getLocalFeeds().find((e=>e.purpose===sn.Usermedia))}get localScreensharingFeed(){return this.getLocalFeeds().find((e=>e.purpose===sn.Screenshare))}get localUsermediaStream(){var e;return null===(e=this.localUsermediaFeed)||void 0===e?void 0:e.stream}get localScreensharingStream(){var e;return null===(e=this.localScreensharingFeed)||void 0===e?void 0:e.stream}get remoteUsermediaFeed(){return this.getRemoteFeeds().find((e=>e.purpose===sn.Usermedia))}get remoteScreensharingFeed(){return this.getRemoteFeeds().find((e=>e.purpose===sn.Screenshare))}get remoteUsermediaStream(){var e;return null===(e=this.remoteUsermediaFeed)||void 0===e?void 0:e.stream}get remoteScreensharingStream(){var e;return null===(e=this.remoteScreensharingFeed)||void 0===e?void 0:e.stream}getFeedByStreamId(e){return this.getFeeds().find((t=>t.stream.id===e))}getFeeds(){return this.feeds}getLocalFeeds(){return this.feeds.filter((e=>e.isLocal()))}getRemoteFeeds(){return this.feeds.filter((e=>!e.isLocal()))}initOpponentCrypto(){var e=this;return U((function*(){var t;if(e.opponentDeviceId&&e.client.getUseE2eForGroupCall()){if(!e.client.getCrypto())return void(e.hasOpponentDeviceInfo=!0);var n=e.invitee||(null===(t=e.getOpponentMember())||void 0===t?void 0:t.userId);throw n?(e.hasOpponentDeviceInfo=!1,new yH(n)):new Error("Couldn't find opponent user ID to init crypto")}}))()}getLocalSDPStreamMetadata(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t={};for(var n of this.getLocalFeeds())e&&(n.sdpMetadataStreamId=n.stream.id),t[n.sdpMetadataStreamId]={purpose:n.purpose,audio_muted:n.isAudioMuted(),video_muted:n.isVideoMuted()};return t}noIncomingFeeds(){return!this.feeds.some((e=>!e.isLocal()))}pushRemoteFeed(e){if(this.opponentSupportsSDPStreamMetadata()){var t=this.getOpponentMember().userId,n=this.remoteSDPStreamMetadata[e.id].purpose,r=this.remoteSDPStreamMetadata[e.id].audio_muted,i=this.remoteSDPStreamMetadata[e.id].video_muted;n?this.getFeedByStreamId(e.id)?A.warn("Call ".concat(this.callId," pushRemoteFeed() ignoring stream because we already have a feed for it (streamId=").concat(e.id,")")):(this.feeds.push(new hl({client:this.client,call:this,roomId:this.roomId,userId:t,deviceId:this.getOpponentDeviceId(),stream:e,purpose:n,audioMuted:r,videoMuted:i})),this.emit(ft.FeedsChanged,this.feeds,this),A.info("Call ".concat(this.callId," pushRemoteFeed() pushed stream (streamId=").concat(e.id,", active=").concat(e.active,", purpose=").concat(n,")"))):A.warn("Call ".concat(this.callId," pushRemoteFeed() ignoring stream because we didn't get any metadata about it (streamId=").concat(e.id,")"))}else this.pushRemoteFeedWithoutMetadata(e)}pushRemoteFeedWithoutMetadata(e){var t,n=this.getOpponentMember().userId,r=sn.Usermedia,i=null===(t=this.feeds.find((e=>!e.isLocal())))||void 0===t?void 0:t.stream;i&&e.id!==i.id?A.warn("Call ".concat(this.callId," pushRemoteFeedWithoutMetadata() ignoring new stream because we already have stream (streamId=").concat(e.id,")")):this.getFeedByStreamId(e.id)?A.warn("Call ".concat(this.callId," pushRemoteFeedWithoutMetadata() ignoring stream because we already have a feed for it (streamId=").concat(e.id,")")):(this.feeds.push(new hl({client:this.client,call:this,roomId:this.roomId,audioMuted:!1,videoMuted:!1,userId:n,deviceId:this.getOpponentDeviceId(),stream:e,purpose:r})),this.emit(ft.FeedsChanged,this.feeds,this),A.info("Call ".concat(this.callId," pushRemoteFeedWithoutMetadata() pushed stream (streamId=").concat(e.id,", active=").concat(e.active,")")))}pushNewLocalFeed(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],r=this.client.getUserId();rr(e.getAudioTracks(),!0),rr(e.getVideoTracks(),!0),this.getFeedByStreamId(e.id)?A.warn("Call ".concat(this.callId," pushNewLocalFeed() ignoring stream because we already have a feed for it (streamId=").concat(e.id,")")):this.pushLocalFeed(new hl({client:this.client,roomId:this.roomId,audioMuted:!1,videoMuted:!1,userId:r,deviceId:this.getOpponentDeviceId(),stream:e,purpose:t}),n)}pushLocalFeed(e){var t=this,n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.feeds.some((t=>e.stream.id===t.stream.id)))A.info("Call ".concat(this.callId," pushLocalFeed() ignoring duplicate local stream (streamId=").concat(e.stream.id,")"));else{if(this.feeds.push(e),n){var r=function(){A.info("Call ".concat(t.callId," pushLocalFeed() adding track to peer connection (id=").concat(i.id,", kind=").concat(i.kind,", streamId=").concat(e.stream.id,", streamPurpose=").concat(e.purpose,", enabled=").concat(i.enabled,")"));var n=vo(e.purpose,i.kind);if(t.transceivers.has(n)){var r=t.transceivers.get(n);r.sender.replaceTrack(i),r.direction="inactive"===r.direction?"sendonly":"sendrecv"}else{var o=t.peerConn.addTrack(i,e.stream),s=t.peerConn.getTransceivers().find((e=>e.sender===o));s?t.transceivers.set(n,s):A.warn("Call ".concat(t.callId," pushLocalFeed() didn't find a matching transceiver after adding track!"))}};for(var i of e.stream.getTracks())r()}A.info("Call ".concat(this.callId," pushLocalFeed() pushed stream (id=").concat(e.stream.id,", active=").concat(e.stream.active,", purpose=").concat(e.purpose,")")),this.emit(ft.FeedsChanged,this.feeds,this)}}removeLocalFeed(e){var t=vo(e.purpose,"audio"),n=vo(e.purpose,"video");for(var r of[t,n])if(this.transceivers.has(r)){var i=this.transceivers.get(r);i.sender&&this.peerConn.removeTrack(i.sender)}e.purpose===sn.Screenshare&&this.client.getMediaHandler().stopScreensharingStream(e.stream),this.deleteFeed(e)}deleteAllFeeds(){for(var e of this.feeds)(!e.isLocal()||!this.groupCallId)&&e.dispose();this.feeds=[],this.emit(ft.FeedsChanged,this.feeds,this)}deleteFeedByStream(e){var t=this.getFeedByStreamId(e.id);t?this.deleteFeed(t):A.warn("Call ".concat(this.callId," deleteFeedByStream() didn't find the feed to delete (streamId=").concat(e.id,")"))}deleteFeed(e){e.dispose(),this.feeds.splice(this.feeds.indexOf(e),1),this.emit(ft.FeedsChanged,this.feeds,this)}getCurrentCallStats(){var e=this;return U((function*(){return e.callHasEnded()?e.callStatsAtEnd:e.collectCallStats()}))()}collectCallStats(){var e=this;return U((function*(){if(e.peerConn){var t=yield e.peerConn.getStats(),n=[];return t.forEach((e=>{n.push(e)})),n}}))()}initWithInvite(e){var t=this;return U((function*(){var n,r=e.getContent();t.direction=Rc.Inbound,(yield t.client.checkTurnServers())||A.warn("Call ".concat(t.callId," initWithInvite() failed to get TURN credentials! Proceeding with call anyway..."));var i=r[vc];i?t.updateRemoteSDPStreamMetadata(i):A.debug("Call ".concat(t.callId," initWithInvite() did not get any SDPStreamMetadata! Can not send/receive multiple streams")),t.peerConn=t.createPeerConnection(),t.emit(ft.PeerConnectionCreated,t.peerConn,t),t.chooseOpponent(e),yield t.initOpponentCrypto();try{yield t.peerConn.setRemoteDescription(r.offer),A.debug("Call ".concat(t.callId," initWithInvite() set remote description: ").concat(r.offer.type)),yield t.addBufferedIceCandidates()}catch(e){return A.debug("Call ".concat(t.callId," initWithInvite() failed to set remote description"),e),void t.terminate(Fn.Local,ct.SetRemoteDescription,!1)}var o=null===(n=t.feeds.find((e=>!e.isLocal())))||void 0===n?void 0:n.stream;if(!(t.isOnlyDataChannelAllowed||o&&0!==o.getTracks().length))return A.error("Call ".concat(t.callId," initWithInvite() no remote stream or no tracks after setting remote description!")),void t.terminate(Fn.Local,ct.SetRemoteDescription,!1);if(t.state=rt.Ringing,e.getLocalAge()){var s=setTimeout((()=>{var e;t.state==rt.Ringing&&(A.debug("Call ".concat(t.callId," initWithInvite() invite has expired. Hanging up.")),t.hangupParty=Fn.Remote,t.state=rt.Ended,t.stopAllMedia(),"closed"!=t.peerConn.signalingState&&t.peerConn.close(),null===(e=t.stats)||void 0===e||e.removeStatsReportGatherer(t.callId),t.emit(ft.Hangup,t))}),r.lifetime-e.getLocalAge()),a=e=>{e!==rt.Ringing&&(clearTimeout(s),t.off(ft.State,a))};t.on(ft.State,a)}}))()}initWithHangup(e){this.state=rt.Ended}shouldAnswerWithMediaType(e,t,n){return e&&!t?(A.warn("Call ".concat(this.callId," shouldAnswerWithMediaType() unable to answer with ").concat(n," because the other side isn't sending it either.")),!1):m$(e)||e===t||this.opponentSupportsSDPStreamMetadata()?e??t:(A.warn("Call ".concat(this.callId," shouldAnswerWithMediaType() unable to answer with ").concat(n,"=").concat(e," because the other side doesn't support it. Answering with ").concat(n,"=").concat(t,".")),t)}answer(e,t){var n=this;return U((function*(){if(!n.inviteOrAnswerSent){if(!1===e&&!1===t)throw new Error("You CANNOT answer a call without media");if(n.localUsermediaStream||n.waitForLocalAVStream)n.waitForLocalAVStream&&(n.state=rt.WaitLocalMedia);else{var r=n.state,i=n.shouldAnswerWithMediaType(e,n.hasRemoteUserMediaAudioTrack,"audio"),o=n.shouldAnswerWithMediaType(t,n.hasRemoteUserMediaVideoTrack,"video");n.state=rt.WaitLocalMedia,n.waitForLocalAVStream=!0;try{var s,a=yield n.client.getMediaHandler().getUserMediaStream(i,o);n.waitForLocalAVStream=!1;var l=[new hl({client:n.client,roomId:n.roomId,userId:n.client.getUserId(),deviceId:null!==(s=n.client.getDeviceId())&&void 0!==s?s:void 0,stream:a,purpose:sn.Usermedia,audioMuted:!1,videoMuted:!1})];n.localScreensharingFeed&&l.push(n.localScreensharingFeed),n.answerWithCallFeeds(l)}catch(e){if(!o)return void n.getUserMediaFailed(e);A.warn("Call ".concat(n.callId," answer() failed to getUserMedia(), trying to getUserMedia() without video")),n.state=r,n.waitForLocalAVStream=!1,yield n.answer(i,!1)}}}}))()}answerWithCallFeeds(e){this.inviteOrAnswerSent||this.queueGotCallFeedsForAnswer(e)}replacedBy(e){A.debug("Call ".concat(this.callId," replacedBy() running (newCallId=").concat(e.callId,")")),this.state===rt.WaitLocalMedia?(A.debug("Call ".concat(this.callId," replacedBy() telling new call to wait for local media (newCallId=").concat(e.callId,")")),e.waitForLocalAVStream=!0):[rt.CreateOffer,rt.InviteSent].includes(this.state)&&(e.direction===Rc.Outbound?e.queueGotCallFeedsForAnswer([]):(A.debug("Call ".concat(this.callId," replacedBy() handing local stream to new call(newCallId=").concat(e.callId,")")),e.queueGotCallFeedsForAnswer(this.getLocalFeeds().map((e=>e.clone()))))),this.successor=e,this.emit(ft.Replaced,e,this),this.hangup(ct.Replaced,!0)}hangup(e,t){if(!this.callHasEnded()&&(A.debug("Call ".concat(this.callId," hangup() ending call (reason=").concat(e,")")),this.terminate(Fn.Local,e,!t),![rt.Fledgling,rt.WaitLocalMedia].includes(this.state))){var n={};(this.opponentVersion&&0!==this.opponentVersion||e!==ct.UserHangup)&&(n.reason=e),this.sendVoipEvent(ee.CallHangup,n)}}reject(){if(this.state!==rt.Ringing)throw Error("Call must be in 'ringing' state to reject!");if(0===this.opponentVersion)return A.info("Call ".concat(this.callId," reject() opponent version is less than 1: sending hangup instead of reject (opponentVersion=").concat(this.opponentVersion,")")),void this.hangup(ct.UserHangup,!0);A.debug("Rejecting call: "+this.callId),this.terminate(Fn.Local,ct.UserHangup,!0),this.sendVoipEvent(ee.CallReject,{})}upgradeCall(e,t){var n=this;return U((function*(){if((e||t)&&n.opponentSupportsSDPStreamMetadata())try{A.debug("Call ".concat(n.callId," upgradeCall() upgrading call (audio=").concat(e,", video=").concat(t,")"));var r=e||n.hasLocalUserMediaAudioTrack,i=t||n.hasLocalUserMediaVideoTrack,o=yield n.client.getMediaHandler().getUserMediaStream(r,i,!1);yield n.updateLocalUsermediaStream(o,e,t)}catch(e){A.error("Call ".concat(n.callId," upgradeCall() failed to upgrade the call"),e),n.emit(ft.Error,new rl(ct.NoUserMedia,"Failed to get camera access: ",e),n)}}))()}opponentSupportsSDPStreamMetadata(){return!!this.remoteSDPStreamMetadata}isScreensharing(){return!!this.localScreensharingStream}setScreensharingEnabled(e,t){var n=this;return U((function*(){if(e&&n.isScreensharing())return A.warn("Call ".concat(n.callId," setScreensharingEnabled() there is already a screensharing stream - there is nothing to do!")),!0;if(!e&&!n.isScreensharing())return A.warn("Call ".concat(n.callId," setScreensharingEnabled() there already isn't a screensharing stream - there is nothing to do!")),!1;if(!n.opponentSupportsSDPStreamMetadata())return n.setScreensharingEnabledWithoutMetadataSupport(e,t);if(A.debug("Call ".concat(n.callId," setScreensharingEnabled() running (enabled=").concat(e,")")),!e){var r=n.transceivers.get(vo(sn.Screenshare,"audio")),i=n.transceivers.get(vo(sn.Screenshare,"video"));for(var o of[r,i])o&&o.sender&&n.peerConn.removeTrack(o.sender);return n.client.getMediaHandler().stopScreensharingStream(n.localScreensharingStream),n.deleteFeedByStream(n.localScreensharingStream),!1}try{var s=yield n.client.getMediaHandler().getScreensharingStream(t);return!!s&&(n.pushNewLocalFeed(s,sn.Screenshare),!0)}catch(e){return A.error("Call ".concat(n.callId," setScreensharingEnabled() failed to get screen-sharing stream:"),e),!1}}))()}setScreensharingEnabledWithoutMetadataSupport(e,t){var n=this;return U((function*(){if(A.debug("Call ".concat(n.callId," setScreensharingEnabledWithoutMetadataSupport() running (enabled=").concat(e,")")),!e){var r,i,o=null===(r=n.localUsermediaStream)||void 0===r?void 0:r.getTracks().find((e=>"video"===e.kind)),s=null===(i=n.transceivers.get(vo(sn.Usermedia,"video")))||void 0===i?void 0:i.sender;return null==s||s.replaceTrack(o??null),n.client.getMediaHandler().stopScreensharingStream(n.localScreensharingStream),n.deleteFeedByStream(n.localScreensharingStream),!1}try{var a,l=yield n.client.getMediaHandler().getScreensharingStream(t);if(!l)return!1;var c=l.getTracks().find((e=>"video"===e.kind)),u=null===(a=n.transceivers.get(vo(sn.Usermedia,"video")))||void 0===a?void 0:a.sender;return null==u||u.replaceTrack(c??null),n.pushNewLocalFeed(l,sn.Screenshare,!1),!0}catch(e){return A.error("Call ".concat(n.callId," setScreensharingEnabledWithoutMetadataSupport() failed to get screen-sharing stream:"),e),!1}}))()}updateLocalUsermediaStream(e){var t=arguments,n=this;return U((function*(){var r=t.length>1&&void 0!==t[1]&&t[1],i=t.length>2&&void 0!==t[2]&&t[2],o=n.localUsermediaFeed,s=r||!o.isAudioMuted()&&!n.remoteOnHold,a=i||!o.isVideoMuted()&&!n.remoteOnHold;for(var l of(A.log("Call ".concat(n.callId," updateLocalUsermediaStream() running (streamId=").concat(e.id,", audio=").concat(s,", video=").concat(a,")")),rr(e.getAudioTracks(),s),rr(e.getVideoTracks(),a),n.localUsermediaStream.getTracks()))n.localUsermediaStream.removeTrack(l),l.stop();for(var c of e.getTracks())n.localUsermediaStream.addTrack(c);var u=function*(){var t=vo(sn.Usermedia,d.kind),r=n.transceivers.get(t),i=null==r?void 0:r.sender,s=!1;if(i)try{A.info("Call ".concat(n.callId," updateLocalUsermediaStream() replacing track (id=").concat(d.id,", kind=").concat(d.kind,", streamId=").concat(e.id,", streamPurpose=").concat(o.purpose,")")),yield i.replaceTrack(d),r.direction="inactive"===r.direction?"sendonly":"sendrecv",s=!0}catch(e){A.warn("Call ".concat(n.callId," updateLocalUsermediaStream() replaceTrack failed: adding new transceiver instead"),e)}if(!s){A.info("Call ".concat(n.callId," updateLocalUsermediaStream() adding track to peer connection (id=").concat(d.id,", kind=").concat(d.kind,", streamId=").concat(e.id,", streamPurpose=").concat(o.purpose,")"));var a=n.peerConn.addTrack(d,n.localUsermediaStream),l=n.peerConn.getTransceivers().find((e=>e.sender===a));l?n.transceivers.set(t,l):A.warn("Call ".concat(n.callId," updateLocalUsermediaStream() couldn't find matching transceiver for newly added track!"))}};for(var d of e.getTracks())yield*u()}))()}setLocalVideoMuted(e){var t=this;return U((function*(){var n,r;if(A.log("Call ".concat(t.callId," setLocalVideoMuted() running ").concat(e)),!e&&void 0!==t.stopVideoTrackTimer&&(clearTimeout(t.stopVideoTrackTimer),t.stopVideoTrackTimer=void 0),!(yield t.client.getMediaHandler().hasVideoDevice()))return t.isLocalVideoMuted();if(!t.hasUserMediaVideoSender&&!e)return null===(r=t.localUsermediaFeed)||void 0===r||r.setAudioVideoMuted(null,e),yield t.upgradeCall(!1,!0),t.isLocalVideoMuted();if(!e&&0===t.localUsermediaStream.getVideoTracks().length){var i=yield t.client.getMediaHandler().getUserMediaStream(!0,!0);yield t.updateLocalUsermediaStream(i)}return null===(n=t.localUsermediaFeed)||void 0===n||n.setAudioVideoMuted(null,e),t.updateMuteStatus(),yield t.sendMetadataUpdate(),e&&(t.stopVideoTrackTimer=setTimeout((()=>{for(var e of t.localUsermediaStream.getVideoTracks())e.stop(),t.localUsermediaStream.removeTrack(e)}),120)),t.isLocalVideoMuted()}))()}isLocalVideoMuted(){var e,t;return null!==(e=null===(t=this.localUsermediaFeed)||void 0===t?void 0:t.isVideoMuted())&&void 0!==e&&e}setMicrophoneMuted(e){var t=this;return U((function*(){var n;return A.log("Call ".concat(t.callId," setMicrophoneMuted() running ").concat(e)),(yield t.client.getMediaHandler().hasAudioDevice())?e||t.hasUserMediaAudioSender&&t.hasLocalUserMediaAudioTrack?(null===(n=t.localUsermediaFeed)||void 0===n||n.setAudioVideoMuted(e,null),t.updateMuteStatus(),yield t.sendMetadataUpdate(),t.isMicrophoneMuted()):(yield t.upgradeCall(!0,!1),t.isMicrophoneMuted()):t.isMicrophoneMuted()}))()}isMicrophoneMuted(){var e,t;return null!==(e=null===(t=this.localUsermediaFeed)||void 0===t?void 0:t.isAudioMuted())&&void 0!==e&&e}isRemoteOnHold(){return this.remoteOnHold}setRemoteOnHold(e){if(this.isRemoteOnHold()!==e){for(var t of(this.remoteOnHold=e,this.peerConn.getTransceivers()))t.direction=e?"sendonly":"sendrecv";this.updateMuteStatus(),this.sendMetadataUpdate(),this.emit(ft.RemoteHoldUnhold,this.remoteOnHold,this)}}isLocalOnHold(){if(this.state!==rt.Connected)return!1;var e=!0;for(var t of this.peerConn.getTransceivers()){["inactive","recvonly"].includes(t.currentDirection)||(e=!1)}return e}sendDtmfDigit(e){for(var t of this.peerConn.getSenders()){var n;if("audio"===(null===(n=t.track)||void 0===n?void 0:n.kind)&&t.dtmf)return void t.dtmf.insertDTMF(e)}throw new Error("Unable to find a track to send DTMF on")}updateMuteStatus(){var e=this.isMicrophoneMuted()||this.remoteOnHold,t=this.isLocalVideoMuted()||this.remoteOnHold;A.log("Call ".concat(this.callId," updateMuteStatus stream ").concat(this.localUsermediaStream.id," micShouldBeMuted ").concat(e," vidShouldBeMuted ").concat(t)),rr(this.localUsermediaStream.getAudioTracks(),!e),rr(this.localUsermediaStream.getVideoTracks(),!t)}sendMetadataUpdate(){var e=this;return U((function*(){yield e.sendVoipEvent(ee.CallSDPStreamMetadataChangedPrefix,{[vc]:e.getLocalSDPStreamMetadata()})}))()}gotCallFeedsForInvite(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.successor)this.successor.queueGotCallFeedsForAnswer(e);else if(this.callHasEnded())this.stopAllMedia();else{for(var n of e)this.pushLocalFeed(n);t&&this.peerConn.addTransceiver("video",{direction:"recvonly"}),this.state=rt.CreateOffer,A.debug("Call ".concat(this.callId," gotUserMediaForInvite() run"))}}sendAnswer(){var e=this;return U((function*(){var t={answer:{sdp:e.peerConn.localDescription.sdp,type:e.peerConn.localDescription.type},[vc]:e.getLocalSDPStreamMetadata(!0)};t.capabilities={"m.call.transferee":e.client.supportsCallTransfer,"m.call.dtmf":!1};var n=e.discardDuplicateCandidates();A.info("Call ".concat(e.callId," sendAnswer() discarding ").concat(n," candidates that will be sent in answer"));try{yield e.sendVoipEvent(ee.CallAnswer,t),e.inviteOrAnswerSent=!0}catch(t){e.state=rt.Ringing,t instanceof bn&&t.event&&e.client.cancelPendingEvent(t.event);var r=ct.SendAnswer,i="Failed to send answer";throw"UnknownDeviceError"==t.name&&(r=ct.UnknownDevices,i="Unknown devices present in the room"),e.emit(ft.Error,new rl(r,i,t),e),t}e.sendCandidateQueue()}))()}queueGotCallFeedsForAnswer(e){this.responsePromiseChain?this.responsePromiseChain=this.responsePromiseChain.then((()=>this.gotCallFeedsForAnswer(e))):this.responsePromiseChain=this.gotCallFeedsForAnswer(e)}mungeSdp(e,t){var n=pk.parse(e.sdp);n.media.forEach((e=>{var n=new Map,r=new Map;for(var i of e.rtp)n.set(i.payload,i.codec),r.set(i.codec,i.payload);for(var o of t)if(o.mediaType===e.type){if(!r.has(o.codec)){A.info("Call ".concat(this.callId," mungeSdp() ignoring SDP modifications for ").concat(o.codec," as it's not present."));continue}var s=[];void 0!==o.enableDtx&&s.push("usedtx=".concat(o.enableDtx?"1":"0")),void 0!==o.maxAverageBitrate&&s.push("maxaveragebitrate=".concat(o.maxAverageBitrate));var a=!1;for(var l of e.fmtp)n.get(l.payload)===o.codec&&(a=!0,l.config+=";"+s.join(";"));a||e.fmtp.push({payload:r.get(o.codec),config:s.join(";")})}})),e.sdp=pk.write(n)}createOffer(){var e=this;return U((function*(){var t=yield e.peerConn.createOffer();return e.mungeSdp(t,iN(e.isPtt)),t}))()}createAnswer(){var e=this;return U((function*(){var t=yield e.peerConn.createAnswer();return e.mungeSdp(t,iN(e.isPtt)),t}))()}gotCallFeedsForAnswer(e){var t=this;return U((function*(){if(!t.callHasEnded()){for(var n of(t.waitForLocalAVStream=!1,e))t.pushLocalFeed(n);var r;t.state=rt.CreateAnswer;try{t.getRidOfRTXCodecs(),r=yield t.createAnswer()}catch(e){return A.debug("Call ".concat(t.callId," gotCallFeedsForAnswer() failed to create answer: "),e),void t.terminate(Fn.Local,ct.CreateAnswer,!0)}try{if(yield t.peerConn.setLocalDescription(r),t.callHasEnded()||(t.state=rt.Connecting,yield new Promise((e=>{setTimeout(e,200)})),t.callHasEnded()))return;t.sendAnswer()}catch(e){return A.debug("Call ".concat(t.callId," gotCallFeedsForAnswer() error setting local description!"),e),void t.terminate(Fn.Local,ct.SetLocalDescription,!0)}}}))()}onRemoteIceCandidatesReceived(e){var t=this;return U((function*(){if(!t.callHasEnded()){var n=e.getContent(),r=n.candidates;if(!r)return void A.info("Call ".concat(t.callId," onRemoteIceCandidatesReceived() ignoring candidates event with no candidates!"));var i=0===n.version?null:n.party_id||null;if(void 0===t.opponentPartyId){if(i){A.info("Call ".concat(t.callId," onRemoteIceCandidatesReceived() buffering ").concat(r.length," candidates until we pick an opponent"));var o=t.remoteCandidateBuffer.get(i)||[];o.push(...r),t.remoteCandidateBuffer.set(i,o)}return}if(!t.partyIdMatches(n))return void A.info("Call ".concat(t.callId," onRemoteIceCandidatesReceived() ignoring candidates from party ID ").concat(n.party_id,": we have chosen party ID ").concat(t.opponentPartyId));yield t.addIceCandidates(r)}}))()}onAnswerReceived(e){var t=this;return U((function*(){var n=e.getContent();if(A.debug("Call ".concat(t.callId," onAnswerReceived() running (hangupParty=").concat(n.party_id,")")),t.callHasEnded())A.debug("Call ".concat(t.callId," onAnswerReceived() ignoring answer because call has ended"));else if(void 0===t.opponentPartyId){t.chooseOpponent(e),yield t.addBufferedIceCandidates(),t.state=rt.Connecting;var r=n[vc];r?t.updateRemoteSDPStreamMetadata(r):A.warn("Call ".concat(t.callId," onAnswerReceived() did not get any SDPStreamMetadata! Can not send/receive multiple streams"));try{t.isSettingRemoteAnswerPending=!0,yield t.peerConn.setRemoteDescription(n.answer),t.isSettingRemoteAnswerPending=!1,A.debug("Call ".concat(t.callId," onAnswerReceived() set remote description: ").concat(n.answer.type))}catch(e){return t.isSettingRemoteAnswerPending=!1,A.debug("Call ".concat(t.callId," onAnswerReceived() failed to set remote description"),e),void t.terminate(Fn.Local,ct.SetRemoteDescription,!1)}if(null!==t.opponentPartyId)try{yield t.sendVoipEvent(ee.CallSelectAnswer,{selected_party_id:t.opponentPartyId})}catch(e){A.warn("Call ".concat(t.callId," onAnswerReceived() failed to send select_answer event"),e)}}else A.info("Call ".concat(t.callId," onAnswerReceived() ignoring answer from party ID ").concat(n.party_id,": we already have an answer/reject from ").concat(t.opponentPartyId))}))()}onSelectAnswerReceived(e){var t=this;return U((function*(){if(t.direction===Rc.Inbound){var n=e.getContent().selected_party_id;null!=n?n!==t.ourPartyId&&(A.info("Call ".concat(t.callId," onSelectAnswerReceived() got select_answer for party ID ").concat(n,": we are party ID ").concat(t.ourPartyId,".")),yield t.terminate(Fn.Remote,ct.AnsweredElsewhere,!0)):A.warn("Call ".concat(t.callId," onSelectAnswerReceived() got nonsensical select_answer with null/undefined selected_party_id: ignoring"))}else A.warn("Call ".concat(t.callId," onSelectAnswerReceived() got select_answer for an outbound call: ignoring"))}))()}onNegotiateReceived(e){var t=this;return U((function*(){var n=e.getContent(),r=n.description;if(r&&r.sdp&&r.type){var i=t.direction===Rc.Inbound,o=!t.makingOffer&&("stable"===t.peerConn.signalingState||t.isSettingRemoteAnswerPending),s="offer"===r.type&&!o;if(t.ignoreOffer=!i&&s,t.ignoreOffer)A.info("Call ".concat(t.callId," onNegotiateReceived() ignoring colliding negotiate event because we're impolite"));else{var a=t.isLocalOnHold(),l=n[vc];l?t.updateRemoteSDPStreamMetadata(l):A.warn("Call ".concat(t.callId," onNegotiateReceived() received negotiation event without SDPStreamMetadata!"));try{if(t.isSettingRemoteAnswerPending="answer"==r.type,yield t.peerConn.setRemoteDescription(r),t.isSettingRemoteAnswerPending=!1,A.debug("Call ".concat(t.callId," onNegotiateReceived() set remote description: ").concat(r.type)),"offer"===r.type){var c,u;try{t.getRidOfRTXCodecs(),u=yield t.createAnswer()}catch(e){return A.debug("Call ".concat(t.callId," onNegotiateReceived() failed to create answer: "),e),void t.terminate(Fn.Local,ct.CreateAnswer,!0)}yield t.peerConn.setLocalDescription(u),A.debug("Call ".concat(t.callId," onNegotiateReceived() create an answer")),t.sendVoipEvent(ee.CallNegotiate,{lifetime:n2,description:null===(c=t.peerConn.localDescription)||void 0===c?void 0:c.toJSON(),[vc]:t.getLocalSDPStreamMetadata(!0)})}}catch(e){t.isSettingRemoteAnswerPending=!1,A.warn("Call ".concat(t.callId," onNegotiateReceived() failed to complete negotiation"),e)}var d=t.isLocalOnHold();a!==d&&(t.emit(ft.LocalHoldUnhold,d,t),t.emit(ft.HoldUnhold,d))}}else A.info("Call ".concat(t.callId," onNegotiateReceived() ignoring invalid m.call.negotiate event"))}))()}updateRemoteSDPStreamMetadata(e){for(var t of(this.remoteSDPStreamMetadata=g$(this.remoteSDPStreamMetadata||{},e,!0),this.getRemoteFeeds())){var n,r=t.stream.id,i=this.remoteSDPStreamMetadata[r];t.setAudioVideoMuted(null==i?void 0:i.audio_muted,null==i?void 0:i.video_muted),t.purpose=null===(n=this.remoteSDPStreamMetadata[r])||void 0===n?void 0:n.purpose}}onSDPStreamMetadataChangedReceived(e){var t=e.getContent()[vc];this.updateRemoteSDPStreamMetadata(t)}onAssertedIdentityReceived(e){var t=this;return U((function*(){var n=e.getContent();n.asserted_identity&&(t.remoteAssertedIdentity={id:n.asserted_identity.id,displayName:n.asserted_identity.display_name},t.emit(ft.AssertedIdentityChanged,t))}))()}callHasEnded(){return this.state===rt.Ended}queueGotLocalOffer(){this.responsePromiseChain?this.responsePromiseChain=this.responsePromiseChain.then((()=>this.wrappedGotLocalOffer())):this.responsePromiseChain=this.wrappedGotLocalOffer()}wrappedGotLocalOffer(){var e=this;return U((function*(){e.makingOffer=!0;try{yield e.gotLocalOffer()}catch(t){return void e.getLocalOfferFailed(t)}finally{e.makingOffer=!1}}))()}gotLocalOffer(){var e=this;return U((function*(){if(A.debug("Call ".concat(e.callId," gotLocalOffer() running")),e.callHasEnded())A.debug("Call ".concat(e.callId,' gotLocalOffer() ignoring newly created offer because the call has ended"'));else{var t;try{e.getRidOfRTXCodecs(),t=yield e.createOffer()}catch(t){return A.debug("Call ".concat(e.callId," gotLocalOffer() failed to create offer: "),t),void e.terminate(Fn.Local,ct.CreateOffer,!0)}try{yield e.peerConn.setLocalDescription(t)}catch(t){return A.debug("Call ".concat(e.callId," gotLocalOffer() error setting local description!"),t),void e.terminate(Fn.Local,ct.SetLocalDescription,!0)}if("gathering"===e.peerConn.iceGatheringState&&(yield new Promise((e=>{setTimeout(e,200)}))),!e.callHasEnded()){var n,r,i=e.state===rt.CreateOffer?ee.CallInvite:ee.CallNegotiate,o={lifetime:n2};if(i===ee.CallInvite&&e.invitee&&(o.invitee=e.invitee),e.state===rt.CreateOffer)o.offer=null===(n=e.peerConn.localDescription)||void 0===n?void 0:n.toJSON();else o.description=null===(r=e.peerConn.localDescription)||void 0===r?void 0:r.toJSON();o.capabilities={"m.call.transferee":e.client.supportsCallTransfer,"m.call.dtmf":!1},o[vc]=e.getLocalSDPStreamMetadata(!0);var s=e.discardDuplicateCandidates();A.info("Call ".concat(e.callId," gotLocalOffer() discarding ").concat(s," candidates that will be sent in offer"));try{yield e.sendVoipEvent(i,o)}catch(t){A.error("Call ".concat(e.callId," gotLocalOffer() failed to send invite"),t),t instanceof bn&&t.event&&e.client.cancelPendingEvent(t.event);var a=ct.SignallingFailed,l="Signalling failed";return e.state===rt.CreateOffer&&(a=ct.SendInvite,l="Failed to send invite"),"UnknownDeviceError"==t.name&&(a=ct.UnknownDevices,l="Unknown devices present in the room"),e.emit(ft.Error,new rl(a,l,t),e),void e.terminate(Fn.Local,a,!1)}e.sendCandidateQueue(),e.state===rt.CreateOffer&&(e.inviteOrAnswerSent=!0,e.state=rt.InviteSent,e.inviteTimeout=setTimeout((()=>{e.inviteTimeout=void 0,e.state===rt.InviteSent&&e.hangup(ct.InviteTimeout,!1)}),n2))}}}))()}getRidOfRTXCodecs(){if(RTCRtpReceiver.getCapabilities&&RTCRtpSender.getCapabilities){var e=this.transceivers.get(vo(sn.Screenshare,"video"));if(e&&e.setCodecPreferences){var t=RTCRtpReceiver.getCapabilities("video").codecs,n=RTCRtpSender.getCapabilities("video").codecs,r=[];for(var i of[...t,...n])if("video/rtx"!==i.mimeType){r.push(i);try{e.setCodecPreferences(r)}catch(e){A.info("Working around buggy WebRTC impl: claimed to support codec but threw when setting codec preferences",i,e),r.pop()}}}}}sendVoipEvent(e,t){var n=this;return U((function*(){var r=C1(C1({},t),{},{version:ioe,call_id:n.callId,party_id:n.ourPartyId,conf_id:n.groupCallId});if(n.opponentDeviceId){var i,o=n.toDeviceSeq++,s=C1(C1({},r),{},{device_id:n.client.deviceId,sender_session_id:n.client.getSessionId(),dest_session_id:n.opponentSessionId,seq:o,[IE]:Lse()});n.emit(ft.SendVoipEvent,{type:"toDevice",eventType:e,userId:n.invitee||(null===(i=n.getOpponentMember())||void 0===i?void 0:i.userId),opponentDeviceId:n.opponentDeviceId,content:s},n);var a=n.invitee||n.getOpponentMember().userId;if(n.client.getUseE2eForGroupCall()){if(!n.hasOpponentDeviceInfo)return void A.warn("Call ".concat(n.callId," sendVoipEvent() failed: we do not have opponentDeviceInfo"));throw new Error("Unimplemented")}yield n.client.sendToDevice(e,new Map([[a,new Map([[n.opponentDeviceId,s]])]]))}else{var l;n.emit(ft.SendVoipEvent,{type:"sendEvent",eventType:e,roomId:n.roomId,content:r,userId:n.invitee||(null===(l=n.getOpponentMember())||void 0===l?void 0:l.userId)},n),yield n.client.sendEvent(n.roomId,e,r)}}))()}queueCandidate(e){if(e?this.candidateSendQueue.push(e):this.candidatesEnded=!0,this.state!==rt.Ringing&&this.inviteOrAnswerSent){var t=this.direction===Rc.Inbound?500:2e3;0===this.candidateSendTries&&setTimeout((()=>{this.sendCandidateQueue()}),t)}}discardDuplicateCandidates(){for(var e=0,t=[],n=0;n<this.candidateSendQueue.length;n++){var r=this.candidateSendQueue[n];""===r.candidate?t.push(r):e++}return this.candidateSendQueue=t,e}transfer(e){var t=this;return U((function*(){var n=yield t.client.getProfileInfo(e),r=od(),i={replacement_id:od(),target_user:{id:e,display_name:n.displayname,avatar_url:n.avatar_url},create_call:r};yield t.sendVoipEvent(ee.CallReplaces,i),yield t.terminate(Fn.Local,ct.Transferred,!0)}))()}transferToCall(e){var t=this;return U((function*(){var n,r,i=null===(n=e.getOpponentMember())||void 0===n?void 0:n.userId,o=i?yield t.client.getProfileInfo(i):void 0,s=null===(r=t.getOpponentMember())||void 0===r?void 0:r.userId,a=s?yield t.client.getProfileInfo(s):void 0,l=od(),c={replacement_id:od(),target_user:{id:s,display_name:null==a?void 0:a.displayname,avatar_url:null==a?void 0:a.avatar_url},await_call:l};yield e.sendVoipEvent(ee.CallReplaces,c);var u={replacement_id:od(),target_user:{id:i,display_name:null==o?void 0:o.displayname,avatar_url:null==o?void 0:o.avatar_url},create_call:l};yield t.sendVoipEvent(ee.CallReplaces,u),yield t.terminate(Fn.Local,ct.Transferred,!0),yield e.terminate(Fn.Local,ct.Transferred,!0)}))()}terminate(e,t,n){var r=this;return U((function*(){var i;if(!r.callHasEnded()){for(var[o,s]of(r.hangupParty=e,r.hangupReason=t,r.state=rt.Ended,r.inviteTimeout&&(clearTimeout(r.inviteTimeout),r.inviteTimeout=void 0),void 0!==r.iceDisconnectedTimeout&&(clearTimeout(r.iceDisconnectedTimeout),r.iceDisconnectedTimeout=void 0),r.callLengthInterval&&(clearInterval(r.callLengthInterval),r.callLengthInterval=void 0),void 0!==r.stopVideoTrackTimer&&(clearTimeout(r.stopVideoTrackTimer),r.stopVideoTrackTimer=void 0),r.removeTrackListeners))o.removeEventListener("removetrack",s);r.removeTrackListeners.clear(),r.callStatsAtEnd=yield r.collectCallStats(),r.stopAllMedia(),r.deleteAllFeeds(),r.peerConn&&"closed"!==r.peerConn.signalingState&&r.peerConn.close(),null===(i=r.stats)||void 0===i||i.removeStatsReportGatherer(r.callId),n&&r.emit(ft.Hangup,r),r.client.callEventHandler.calls.delete(r.callId)}}))()}stopAllMedia(){for(var e of(A.debug("Call ".concat(this.callId," stopAllMedia() running")),this.feeds))if(e.isLocal()&&e.purpose===sn.Usermedia)this.client.getMediaHandler().stopUserMediaStream(e.stream);else if(e.isLocal()&&e.purpose===sn.Screenshare)this.client.getMediaHandler().stopScreensharingStream(e.stream);else if(!e.isLocal())for(var t of(A.debug("Call ".concat(this.callId," stopAllMedia() stopping stream (streamId=").concat(e.stream.id,")")),e.stream.getTracks()))t.stop()}checkForErrorListener(){if(0===this.listeners(_$.Error).length)throw new Error("You MUST attach an error listener using call.on('error', function() {})")}sendCandidateQueue(){var e=this;return U((function*(){if(0!==e.candidateSendQueue.length&&!e.callHasEnded()){var t=e.candidateSendQueue;e.candidateSendQueue=[],++e.candidateSendTries;var n={candidates:t.map((e=>e.toJSON()))};e.candidatesEnded&&n.candidates.push({candidate:""}),A.debug("Call ".concat(e.callId," sendCandidateQueue() attempting to send ").concat(t.length," candidates"));try{yield e.sendVoipEvent(ee.CallCandidates,n),e.candidateSendTries=0,e.sendCandidateQueue()}catch(n){if(n instanceof bn&&n.event&&e.client.cancelPendingEvent(n.event),e.candidateSendQueue.push(...t),e.candidateSendTries>5){A.debug("Call ".concat(e.callId," sendCandidateQueue() failed to send candidates on attempt ").concat(e.candidateSendTries,". Giving up on this call."),n);var r=ct.SignallingFailed;return e.emit(ft.Error,new rl(r,"Signalling failed",n),e),void e.hangup(r,!1)}var i=500*Math.pow(2,e.candidateSendTries);++e.candidateSendTries,A.debug("Call ".concat(e.callId," sendCandidateQueue() failed to send candidates. Retrying in ").concat(i,"ms"),n),setTimeout((()=>{e.sendCandidateQueue()}),i)}}}))()}placeCall(e,t){var n=this;return U((function*(){if(!e)throw new Error("You CANNOT start a call without audio");var r;n.state=rt.WaitLocalMedia;try{var i,o=yield n.client.getMediaHandler().getUserMediaStream(e,t);rr(o.getAudioTracks(),!0),rr(o.getVideoTracks(),!0),r=new hl({client:n.client,roomId:n.roomId,userId:n.client.getUserId(),deviceId:null!==(i=n.client.getDeviceId())&&void 0!==i?i:void 0,stream:o,purpose:sn.Usermedia,audioMuted:!1,videoMuted:!1})}catch(e){return void n.getUserMediaFailed(e)}try{yield n.placeCallWithCallFeeds([r])}catch(e){return void n.placeCallFailed(e)}}))()}placeCallWithCallFeeds(e){var t=arguments,n=this;return U((function*(){var r=t.length>1&&void 0!==t[1]&&t[1];n.checkForErrorListener(),n.direction=Rc.Outbound,yield n.initOpponentCrypto(),n.client.callEventHandler.calls.set(n.callId,n),(yield n.client.checkTurnServers())||A.warn("Call ".concat(n.callId," placeCallWithCallFeeds() failed to get TURN credentials! Proceeding with call anyway...")),n.peerConn=n.createPeerConnection(),n.emit(ft.PeerConnectionCreated,n.peerConn,n),n.gotCallFeedsForInvite(e,r)}))()}createPeerConnection(){var e,t=new window.RTCPeerConnection({iceTransportPolicy:this.forceTURN?"relay":void 0,iceServers:this.turnServers.length?this.turnServers:void 0,iceCandidatePoolSize:this.client.iceCandidatePoolSize,bundlePolicy:"max-bundle"});t.addEventListener("iceconnectionstatechange",this.onIceConnectionStateChanged),t.addEventListener("signalingstatechange",this.onSignallingStateChanged),t.addEventListener("icecandidate",this.gotLocalIceCandidate),t.addEventListener("icegatheringstatechange",this.onIceGatheringStateChange),t.addEventListener("track",this.onTrack),t.addEventListener("negotiationneeded",this.onNegotiationNeeded),t.addEventListener("datachannel",this.onDataChannel);var n=this.getOpponentMember(),r=n?n.userId:"unknown";return null===(e=this.stats)||void 0===e||e.addStatsReportGatherer(this.callId,r,t),t}partyIdMatches(e){return(0===e.version?null:e.party_id||null)===this.opponentPartyId}chooseOpponent(e){var t,n,r=e.getContent();(A.debug("Call ".concat(this.callId," chooseOpponent() running (partyId=").concat(r.party_id,")")),this.opponentVersion=r.version,0===this.opponentVersion?this.opponentPartyId=null:this.opponentPartyId=r.party_id||null,this.opponentCaps=r.capabilities||{},this.opponentMember=null!==(t=this.client.getRoom(this.roomId).getMember(e.getSender()))&&void 0!==t?t:void 0,this.opponentMember)&&(null===(n=this.stats)||void 0===n||n.updateOpponentMember(this.callId,this.opponentMember.userId))}addBufferedIceCandidates(){var e=this;return U((function*(){var t=e.remoteCandidateBuffer.get(e.opponentPartyId);t&&(A.info("Call ".concat(e.callId," addBufferedIceCandidates() adding ").concat(t.length," buffered candidates for opponent ").concat(e.opponentPartyId)),yield e.addIceCandidates(t)),e.remoteCandidateBuffer.clear()}))()}addIceCandidates(e){var t=this;return U((function*(){for(var n of e){null!==n.sdpMid&&void 0!==n.sdpMid||null!==n.sdpMLineIndex&&void 0!==n.sdpMLineIndex?A.debug("Call ".concat(t.callId," addIceCandidates() got remote ICE candidate (sdpMid=").concat(n.sdpMid,", candidate=").concat(n.candidate,")")):A.debug("Call ".concat(t.callId," addIceCandidates() got remote ICE end-of-candidates"));try{yield t.peerConn.addIceCandidate(n)}catch(e){t.ignoreOffer?A.debug("Call ".concat(t.callId," addIceCandidates() failed to add remote ICE candidate because ignoring offer"),e):A.info("Call ".concat(t.callId," addIceCandidates() failed to add remote ICE candidate"),e)}}}))()}get hasPeerConnection(){return!!this.peerConn}initStats(e){this.stats=e,this.stats.start()}}function rr(e,t){for(var n of e)n.enabled=t}function bk(){if(typeof window>"u"||typeof document>"u")return!1;try{var e,t,n;if(!!!(null!==(e=null!==(t=null!==(n=window.RTCPeerConnection)&&void 0!==n?n:window.RTCSessionDescription)&&void 0!==t?t:window.RTCIceCandidate)&&void 0!==e?e:navigator.mediaDevices))return A.error("WebRTC is not supported in this browser / environment"),!1}catch(e){return A.error("Exception thrown when trying to access WebRTC",e),!1}return!0}function Iv(e,t,n){if(!bk())return null;var r=!!n&&n.forceTURN,i={client:e,roomId:t,invitee:null==n?void 0:n.invitee,turnServers:e.getTurnServers(),forceTURN:e.forceTURN||r,opponentDeviceId:null==n?void 0:n.opponentDeviceId,opponentSessionId:null==n?void 0:n.opponentSessionId,groupCallId:null==n?void 0:n.groupCallId},o=new coe(i);return e.reEmitter.reEmit(o,Object.values(ft)),o}var Yc=function(e){return e.DontNotify="dont_notify",e.Notify="notify",e.Coalesce="coalesce",e}({}),KP=function(e){return e.Highlight="highlight",e.Sound="sound",e}({}),uoe=function(e){return e.ExactEquals="==",e.LessThan="<",e.GreaterThan=">",e.GreaterThanOrEqual=">=",e.LessThanOrEqual="<=",e}({}),doe="2";function foe(e){return"==2"===e||"2"===e}var ir=function(e){return e.EventMatch="event_match",e.EventPropertyIs="event_property_is",e.EventPropertyContains="event_property_contains",e.ContainsDisplayName="contains_display_name",e.RoomMemberCount="room_member_count",e.SenderNotificationPermission="sender_notification_permission",e.CallStarted="call_started",e.CallStartedPrefix="org.matrix.msc3914.call_started",e}({}),Lr=function(e){return e.Override="override",e.ContentSpecific="content",e.RoomSpecific="room",e.SenderSpecific="sender",e.Underride="underride",e}({}),Pr=function(e){return e.Master=".m.rule.master",e.IsUserMention=".m.rule.is_user_mention",e.IsRoomMention=".m.rule.is_room_mention",e.ContainsDisplayName=".m.rule.contains_display_name",e.ContainsUserName=".m.rule.contains_user_name",e.AtRoomNotification=".m.rule.roomnotif",e.DM=".m.rule.room_one_to_one",e.EncryptedDM=".m.rule.encrypted_room_one_to_one",e.Message=".m.rule.message",e.EncryptedMessage=".m.rule.encrypted",e.InviteToSelf=".m.rule.invite_for_me",e.MemberEvent=".m.rule.member_event",e.IncomingCall=".m.rule.call",e.SuppressNotices=".m.rule.suppress_notices",e.Tombstone=".m.rule.tombstone",e.PollStart=".m.rule.poll_start",e.PollStartUnstable=".org.matrix.msc3930.rule.poll_start",e.PollEnd=".m.rule.poll_end",e.PollEndUnstable=".org.matrix.msc3930.rule.poll_end",e.PollStartOneToOne=".m.rule.poll_start_one_to_one",e.PollStartOneToOneUnstable=".org.matrix.msc3930.rule.poll_start_one_to_one",e.PollEndOneToOne=".m.rule.poll_end_one_to_one",e.PollEndOneToOneUnstable=".org.matrix.msc3930.rule.poll_end_one_to_one",e}({});function sN(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function oN(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?sN(Object(n),!0).forEach((function(t){L(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):sN(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var aN=[Lr.Override,Lr.ContentSpecific,Lr.RoomSpecific,Lr.SenderSpecific,Lr.Underride],hoe={".m.rule.is_room_mention":{rule_id:".m.rule.is_room_mention",default:!0,enabled:!0,conditions:[{kind:ir.EventPropertyIs,key:"content.m\\.mentions.room",value:!0},{kind:ir.SenderNotificationPermission,key:"room"}],actions:[Yc.Notify,{set_tweak:KP.Highlight}]},".m.rule.reaction":{rule_id:".m.rule.reaction",default:!0,enabled:!0,conditions:[{kind:ir.EventMatch,key:"type",pattern:"m.reaction"}],actions:[Yc.DontNotify]},".org.matrix.msc3786.rule.room.server_acl":{rule_id:".org.matrix.msc3786.rule.room.server_acl",default:!0,enabled:!0,conditions:[{kind:ir.EventMatch,key:"type",pattern:ee.RoomServerAcl},{kind:ir.EventMatch,key:"state_key",pattern:""}],actions:[]}},GP=Symbol("UserDefinedRules"),poe=[Pr.Master,GP,Pr.SuppressNotices,Pr.InviteToSelf,Pr.MemberEvent,Pr.IsUserMention,Pr.ContainsDisplayName,Pr.IsRoomMention,Pr.AtRoomNotification,Pr.Tombstone,".m.rule.reaction",".m.rule.room.server_acl",".org.matrix.msc3786.rule.room.server_acl",".m.rule.suppress_edits"],moe={".org.matrix.msc3914.rule.room.call":{rule_id:".org.matrix.msc3914.rule.room.call",default:!0,enabled:!0,conditions:[{kind:ir.EventMatch,key:"type",pattern:"org.matrix.msc3401.call"},{kind:ir.CallStarted}],actions:[Yc.Notify,{set_tweak:KP.Sound,value:"default"}]}},goe=[GP,Pr.IncomingCall,".org.matrix.msc3914.rule.room.call",Pr.EncryptedDM,Pr.DM,Pr.Message,Pr.EncryptedMessage];function lN(e,t,n,r){var i=t.filter((e=>e.default)),o=t.filter((e=>!e.default));function s(t){t===GP?l.push(...o):t in n?(A.warn("Adding default global ".concat(e," push rule ").concat(t)),l.push(n[t])):A.warn("Missing default global ".concat(e," push rule ").concat(t))}var a=0,l=[];for(var c of i){var u=r.indexOf(c.rule_id);if(-1!==u){for(;u>a;){s(r[a]),a+=1}l.push(c),a+=1}else l.push(c)}for(var d of r.slice(a))s(d);return l}class Co{constructor(e){this.client=e,L(this,"parsedKeys",new Map)}static actionListToActionsObject(e){var t={notify:!1,tweaks:{}};for(var n of e)n===Yc.Notify?t.notify=!0:"object"==typeof n&&(void 0===n.value&&(n.value=!0),t.tweaks[n.set_tweak]=n.value);return t}static rewriteDefaultRules(e){var t=JSON.parse(JSON.stringify(e));return t||(t={}),t.global||(t.global={}),t.global.override||(t.global.override=[]),t.global.underride||(t.global.underride=[]),t.global.override=lN(Lr.Override,t.global.override,hoe,poe),t.global.underride=lN(Lr.Underride,t.global.underride,moe,goe),t}static getPushRuleGlobRegex(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"i",[r,i]=t?["(?<=^|\\W)","(?=\\W|$)"]:["^","$"],o="".concat(t,"-").concat(n,"-").concat(e);return Co.cachedGlobToRegex[o]||(Co.cachedGlobToRegex[o]=new RegExp(r+"("+p$(e)+")"+i,n)),Co.cachedGlobToRegex[o]}updateCachedPushRuleKeys(e){e||(e={}),e.global||(e.global={}),e.global.override||(e.global.override=[]),e.global.room||(e.global.room=[]),e.global.sender||(e.global.sender=[]),e.global.underride||(e.global.underride=[]);var t=new Set(this.parsedKeys.keys());for(var n of[e.global.override,e.global.room,e.global.sender,e.global.underride])for(var r of n)if(r.conditions)for(var i of r.conditions)i.kind===ir.EventMatch&&(t.delete(i.key),this.parsedKeys.set(i.key,Co.partsForDottedKey(i.key)));t.forEach((e=>this.parsedKeys.delete(e)))}matchingRuleFromKindSet(e,t){for(var n of aN){var r=t[n];if(r)for(var i of r)if(i.enabled){var o=this.templateRuleToRaw(n,i);if(o&&this.ruleMatchesEvent(o,e))return oN(oN({},i),{},{kind:n})}}return null}templateRuleToRaw(e,t){var n={rule_id:t.rule_id,actions:t.actions,conditions:[]};switch(e){case Lr.Underride:case Lr.Override:n.conditions=t.conditions;break;case Lr.RoomSpecific:if(!t.rule_id)return null;n.conditions.push({kind:ir.EventMatch,key:"room_id",value:t.rule_id});break;case Lr.SenderSpecific:if(!t.rule_id)return null;n.conditions.push({kind:ir.EventMatch,key:"user_id",value:t.rule_id});break;case Lr.ContentSpecific:if(!t.pattern)return null;n.conditions.push({kind:ir.EventMatch,key:"content.body",pattern:t.pattern})}return n}eventFulfillsCondition(e,t){switch(e.kind){case ir.EventMatch:return this.eventFulfillsEventMatchCondition(e,t);case ir.EventPropertyIs:return this.eventFulfillsEventPropertyIsCondition(e,t);case ir.EventPropertyContains:return this.eventFulfillsEventPropertyContains(e,t);case ir.ContainsDisplayName:return this.eventFulfillsDisplayNameCondition(e,t);case ir.RoomMemberCount:return this.eventFulfillsRoomMemberCountCondition(e,t);case ir.SenderNotificationPermission:return this.eventFulfillsSenderNotifPermCondition(e,t);case ir.CallStarted:case ir.CallStartedPrefix:return this.eventFulfillsCallStartedCondition(e,t)}return!1}eventFulfillsSenderNotifPermCondition(e,t){var n=e.key;if(!n)return!1;var r=this.client.getRoom(t.getRoomId());return!(null==r||!r.currentState)&&r.currentState.mayTriggerNotifOfType(n,t.getSender())}eventFulfillsRoomMemberCountCondition(e,t){if(!e.is)return!1;var n=this.client.getRoom(t.getRoomId());if(!n||!n.currentState||!n.currentState.members)return!1;var r=n.currentState.getJoinedMemberCount(),i=e.is.match(/^([=<>]*)(\d*)$/);if(!i)return!1;var o=i[1],s=parseInt(i[2]);if(isNaN(s))return!1;switch(o){case"":case"==":return r==s;case"<":return r<s;case">":return r>s;case"<=":return r<=s;case">=":return r>=s;default:return!1}}eventFulfillsDisplayNameCondition(e,t){var n,r=t.getContent();if(t.isEncrypted()&&t.getClearContent()&&(r=t.getClearContent()),!r||!r.body||"string"!=typeof r.body)return!1;var i=this.client.getRoom(t.getRoomId()),o=null==i||null===(n=i.currentState)||void 0===n?void 0:n.getMember(this.client.credentials.userId);if(!o)return!1;var s=o.name,a=new RegExp("(^|\\W)"+h$(s)+"(\\W|$)","i");return r.body.search(a)>-1}eventFulfillsEventMatchCondition(e,t){if(!e.key)return!1;var n=this.valueForDottedKey(e.key,t);if("string"!=typeof n)return!1;if(e.value)return e.value===n;if("string"!=typeof e.pattern)return!1;var r=Co.getPushRuleGlobRegex(e.pattern,"content.body"===e.key);return!!n.match(r)}eventFulfillsEventPropertyIsCondition(e,t){return!(!e.key||void 0===e.value)&&e.value===this.valueForDottedKey(e.key,t)}eventFulfillsEventPropertyContains(e,t){if(!e.key||void 0===e.value)return!1;var n=this.valueForDottedKey(e.key,t);return!!Array.isArray(n)&&n.includes(e.value)}eventFulfillsCallStartedCondition(e,t){return["m.ring","m.prompt"].includes(t.getContent()["m.intent"])&&!("m.terminated"in t.getContent())&&(t.getPrevContent()["m.terminated"]!==t.getContent()["m.terminated"]||Md(t.getPrevContent(),{}))}static partsForDottedKey(e){var t=[],n="",r=!1;for(var i of e)r?(n+="\\"===i||"."===i?i:"\\"+i,r=!1):"."==i?(t.push(n),n=""):"\\"==i?r=!0:n+=i;return r&&(n+="\\"),t.push(n),t}valueForDottedKey(e,t){var n=this.parsedKeys.get(e);void 0===n&&(n=Co.partsForDottedKey(e),this.parsedKeys.set(e,n));var r,i=n[0],o=0;for("content"===i?(r=t.getContent(),++o):"type"===i?(r=t.getType(),++o):r=t.event;o<n.length;++o){if(m$(r))return;r=r[n[o]]}return r}matchingRuleForEventWithRulesets(e,t){return t&&e.getSender()!==this.client.getSafeUserId()?this.matchingRuleFromKindSet(e,t.global):null}pushActionsForEventAndRulesets(e,t){var n=this.matchingRuleForEventWithRulesets(e,t);if(!n)return{};var r=Co.actionListToActionsObject(n.actions);return void 0===r.tweaks.highlight&&(r.tweaks.highlight=n.kind==Lr.ContentSpecific),{actions:r,rule:n}}ruleMatchesEvent(e,t){var n;return(!this.client.supportsIntentionalMentions()||void 0===t.getContent()["m.mentions"]||e.rule_id!==Pr.ContainsUserName&&e.rule_id!==Pr.ContainsDisplayName&&e.rule_id!==Pr.AtRoomNotification)&&!(null!==(n=e.conditions)&&void 0!==n&&n.some((e=>!this.eventFulfillsCondition(e,t))))}actionsForEvent(e){var{actions:t}=this.pushActionsForEventAndRulesets(e,this.client.pushRules);return t||{}}actionsAndRuleForEvent(e){return this.pushActionsForEventAndRulesets(e,this.client.pushRules)}getPushRuleById(e){var t,n=this.getPushRuleAndKindById(e);return null!==(t=null==n?void 0:n.rule)&&void 0!==t?t:null}getPushRuleAndKindById(e){for(var t of["global"]){var n;if(void 0!==(null===(n=this.client.pushRules)||void 0===n?void 0:n[t]))for(var r of aN)if(void 0!==this.client.pushRules[t][r])for(var i of this.client.pushRules[t][r])if(i.rule_id===e)return{rule:i,kind:r}}return null}}L(Co,"cachedGlobToRegex",{});var kv=["v1.1","v1.2","v1.3","v1.4","v1.5","v1.6","v1.7","v1.8","v1.9"],voe=kv[0],yoe=kv[kv.length-1],ms=function(e){return e.SUCCESS="SUCCESS",e.IGNORE="IGNORE",e.PROMPT="PROMPT",e.FAIL_PROMPT="FAIL_PROMPT",e.FAIL_ERROR="FAIL_ERROR",e}({}),to=function(e){return e.Invalid="Invalid homeserver discovery response",e.GenericFailure="Failed to get autodiscovery configuration from server",e.InvalidHsBaseUrl="Invalid base_url for m.homeserver",e.InvalidHomeserver="Homeserver URL does not appear to be a valid Matrix homeserver",e.InvalidIsBaseUrl="Invalid base_url for m.identity_server",e.InvalidIdentityServer="Identity server URL does not appear to be a valid identity server",e.InvalidIs="Invalid identity server discovery response",e.MissingWellknown="No .well-known JSON file found",e.InvalidJson="Invalid JSON",e.UnsupportedHomeserverSpecVersion="The homeserver does not meet the version requirements",e}({});class it{static fromDiscoveryConfig(e){var t=this;return U((function*(){var n,r={"m.homeserver":{state:it.FAIL_ERROR,error:it.ERROR_INVALID,base_url:null},"m.identity_server":{state:it.PROMPT,error:null,base_url:null}};if(null==e||!e["m.homeserver"])return A.error("No m.homeserver key in config"),r["m.homeserver"].state=it.FAIL_PROMPT,r["m.homeserver"].error=it.ERROR_INVALID,Promise.resolve(r);if(!e["m.homeserver"].base_url)return A.error("No m.homeserver base_url in config"),r["m.homeserver"].state=it.FAIL_PROMPT,r["m.homeserver"].error=it.ERROR_INVALID_HS_BASE_URL,Promise.resolve(r);var i=t.sanitizeWellKnownUrl(e["m.homeserver"].base_url);if(!i)return A.error("Invalid base_url for m.homeserver"),r["m.homeserver"].error=it.ERROR_INVALID_HS_BASE_URL,Promise.resolve(r);var o=yield t.fetchWellKnownObject("".concat(i,"/_matrix/client/versions"));if(!o||!Array.isArray(null===(n=o.raw)||void 0===n?void 0:n.versions))return A.error("Invalid /versions response"),r["m.homeserver"].error=it.ERROR_INVALID_HOMESERVER,r["m.homeserver"].base_url=i,Promise.resolve(r);var s=new Set(o.raw.versions),a=!1;for(var l of kv)if(s.has(l)){a=!0;break}if(!a)return A.error("Homeserver does not meet version requirements"),r["m.homeserver"].error=it.ERROR_UNSUPPORTED_HOMESERVER_SPEC_VERSION,r["m.homeserver"].base_url=i,Promise.resolve(r);r["m.homeserver"]={state:it.SUCCESS,error:null,base_url:i};var c="";if(e["m.identity_server"]){var u={"m.homeserver":r["m.homeserver"],"m.identity_server":{state:it.FAIL_PROMPT,error:it.ERROR_INVALID_IS,base_url:null}};if(!(c=t.sanitizeWellKnownUrl(e["m.identity_server"].base_url)))return A.error("Invalid base_url for m.identity_server"),u["m.identity_server"].error=it.ERROR_INVALID_IS_BASE_URL,Promise.resolve(u);var d=yield t.fetchWellKnownObject("".concat(c,"/_matrix/identity/v2"));if(null==d||!d.raw||d.action!==ms.SUCCESS)return A.error("Invalid /v2 response"),u["m.identity_server"].error=it.ERROR_INVALID_IDENTITY_SERVER,u["m.identity_server"].base_url=c,Promise.resolve(u)}return c&&c.toString().length>0&&(r["m.identity_server"]={state:it.SUCCESS,error:null,base_url:c}),Object.keys(e).forEach((t=>{if("m.homeserver"===t||"m.identity_server"===t){var n=["error","state","base_url"];for(var i of Object.keys(e[t]))n.includes(i)||(r[t][i]=e[t][i])}else r[t]=e[t]})),Promise.resolve(r)}))()}static findClientConfig(e){var t=this;return U((function*(){if(!e||"string"!=typeof e||0===e.length)throw new Error("'domain' must be a string of non-zero length");var n={"m.homeserver":{state:it.FAIL_ERROR,error:it.ERROR_INVALID,base_url:null},"m.identity_server":{state:it.PROMPT,error:null,base_url:null}},r=e.includes("://")?e:"https://".concat(e),i=yield t.fetchWellKnownObject("".concat(r,"/.well-known/matrix/client"));return i&&i.action===ms.SUCCESS?it.fromDiscoveryConfig(i.raw):(A.error("No response or error when parsing .well-known"),i.reason&&A.error(i.reason),i.action===ms.IGNORE?n["m.homeserver"]={state:it.PROMPT,error:null,base_url:null}:(n["m.homeserver"].state=it.FAIL_PROMPT,n["m.homeserver"].error=it.ERROR_INVALID),Promise.resolve(n))}))()}static getRawClientConfig(e){var t=this;return U((function*(){var n;if(!e||"string"!=typeof e||0===e.length)throw new Error("'domain' must be a string of non-zero length");var r=yield t.fetchWellKnownObject("https://".concat(e,"/.well-known/matrix/client"));return r&&null!==(n=r.raw)&&void 0!==n?n:{}}))()}static sanitizeWellKnownUrl(e){if(!e)return!1;try{var t,n;try{n=new URL(e)}catch(e){A.error("Could not parse url",e)}if(null===(t=n)||void 0===t||!t.hostname||"http:"!==n.protocol&&"https:"!==n.protocol)return!1;var r=n.port?":".concat(n.port):"",i=n.pathname?n.pathname:"",o="".concat(n.protocol,"//").concat(n.hostname).concat(r).concat(i);return o.endsWith("/")&&(o=o.substring(0,o.length-1)),o}catch(e){return A.error(e),!1}}static fetch(e,t){return this.fetchFn?this.fetchFn(e,t):globalThis.fetch(e,t)}static setFetchFn(e){it.fetchFn=e}static fetchWellKnownObject(e){return U((function*(){var t;try{if(404===(t=yield it.fetch(e,{method:ae.Get,signal:kE(5e3)})).status)return{raw:{},action:ms.IGNORE,reason:it.ERROR_MISSING_WELLKNOWN};if(!t.ok)return{raw:{},action:ms.FAIL_PROMPT,reason:"General failure"}}catch(e){var n=e,r="";return"object"==typeof n&&(r=null==n?void 0:n.message),{error:n,raw:{},action:ms.FAIL_PROMPT,reason:r||"General failure"}}try{return{raw:yield t.json(),action:ms.SUCCESS}}catch(e){var i=e;return{error:i,raw:{},action:ms.FAIL_PROMPT,reason:"SyntaxError"===(null==i?void 0:i.name)?it.ERROR_INVALID_JSON:it.ERROR_INVALID}}}))()}}L(it,"ERROR_INVALID",to.Invalid),L(it,"ERROR_GENERIC_FAILURE",to.GenericFailure),L(it,"ERROR_INVALID_HS_BASE_URL",to.InvalidHsBaseUrl),L(it,"ERROR_INVALID_HOMESERVER",to.InvalidHomeserver),L(it,"ERROR_INVALID_IS_BASE_URL",to.InvalidIsBaseUrl),L(it,"ERROR_INVALID_IDENTITY_SERVER",to.InvalidIdentityServer),L(it,"ERROR_INVALID_IS",to.InvalidIs),L(it,"ERROR_MISSING_WELLKNOWN",to.MissingWellknown),L(it,"ERROR_INVALID_JSON",to.InvalidJson),L(it,"ERROR_UNSUPPORTED_HOMESERVER_SPEC_VERSION",to.UnsupportedHomeserverSpecVersion),L(it,"ALL_ERRORS",Object.keys(to)),L(it,"FAIL_ERROR",ms.FAIL_ERROR),L(it,"FAIL_PROMPT",ms.FAIL_PROMPT),L(it,"PROMPT",ms.PROMPT),L(it,"SUCCESS",ms.SUCCESS),L(it,"fetchFn",void 0);var Sk=function(e){return e.IS="SERVICE_TYPE_IS",e.IM="SERVICE_TYPE_IM",e}({});class _oe{constructor(e){this.ourEvent=e,L(this,"timeline",void 0),L(this,"ourEventIndex",0),L(this,"paginateTokens",{[ht.Backward]:null,[ht.Forward]:null}),this.timeline=[e]}getEvent(){return this.timeline[this.ourEventIndex]}getTimeline(){return this.timeline}getOurEventIndex(){return this.ourEventIndex}getPaginateToken(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return this.paginateTokens[e?ht.Backward:ht.Forward]}setPaginateToken(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.paginateTokens[t?ht.Backward:ht.Forward]=e??null}addEvents(e){arguments.length>1&&void 0!==arguments[1]&&arguments[1]?(this.timeline=e.concat(this.timeline),this.ourEventIndex+=e.length):this.timeline=this.timeline.concat(e)}}class OE{static fromJson(e,t){var n=e.context||{},r=(n.events_before||[]).map(t),i=(n.events_after||[]).map(t),o=new _oe(t(e.result)),s=o.ourEvent.threadRootId;return r=r.filter((e=>e.threadRootId===s)),i=i.filter((e=>e.threadRootId===s)),o.setPaginateToken(n.start,!0),o.addEvents(r,!0),o.addEvents(i,!1),o.setPaginateToken(n.end,!1),new OE(e.rank,o)}constructor(e,t){this.rank=e,this.context=t}}var _H=function(e){return e.Public="public",e.Private="private",e}({}),ME=function(e){return e.PrivateChat="private_chat",e.TrustedPrivateChat="trusted_private_chat",e.PublicChat="public_chat",e}({}),Jc=function(e){return e.Public="public",e.Invite="invite",e.Private="private",e.Knock="knock",e.Restricted="restricted",e}({}),boe=function(e){return e.RoomMembership="m.room_membership",e}({}),Xb=function(e){return e.CanJoin="can_join",e.Forbidden="forbidden",e}({}),WP=function(e){return e.Invited="invited",e.Joined="joined",e.Shared="shared",e.WorldReadable="world_readable",e}({});function cN(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function uN(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?cN(Object(n),!0).forEach((function(t){L(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):cN(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Soe(e,t){var n=!!t.preventReEmit,r=!1!==t.decrypt;return function t(i){var o,s=e.getRoom(i.room_id);s&&void 0===i.state_key&&(o=s.findEventById(i.event_id)),!o||o.status?o=new Ci(i):(o.setUnsigned(uN(uN({},o.getUnsigned()),i.unsigned)),n=!0);var a=o.getServerAggregatedRelation(cn.Replace);if(null!=a&&a.content){var l=t(a);o.makeReplaced(l)}var c=null==s?void 0:s.findThreadForEvent(o);return c&&o.setThread(c),o.isEncrypted()&&(n||e.reEmitter.reEmit(o,[Mt.Decrypted]),r&&e.decryptEventIfNeeded(o)),n||(e.reEmitter.reEmit(o,[Mt.Replaced,Mt.VisibilityChange]),null==s||s.reEmitter.reEmit(o,[Mt.BeforeRedaction])),o}}function dN(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function yc(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?dN(Object(n),!0).forEach((function(t){L(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):dN(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}class fN{constructor(e,t,n){this.client=e,this.indexEvent=t,this.directory=n}get id(){var e=this.indexEvent.getStateKey();if(!e)throw new Error("State key not found for branch");return e}get isActive(){return!0===this.indexEvent.getContent().active}get version(){var e;return null!==(e=this.indexEvent.getContent().version)&&void 0!==e?e:1}get roomId(){return this.indexEvent.getRoomId()}delete(){var e=this;return U((function*(){yield e.client.sendStateEvent(e.roomId,fl.name,{},e.id),yield e.client.redactEvent(e.roomId,e.id);var t=(yield e.getVersionHistory())[1];t&&(yield t.delete())}))()}getName(){return this.indexEvent.getContent().name||"Unnamed File"}setName(e){var t=this;return U((function*(){yield t.client.sendStateEvent(t.roomId,fl.name,yc(yc({},t.indexEvent.getContent()),{},{name:e}),t.id)}))()}isLocked(){return this.indexEvent.getContent().locked||!1}setLocked(e){var t=this;return U((function*(){yield t.client.sendStateEvent(t.roomId,fl.name,yc(yc({},t.indexEvent.getContent()),{},{locked:e}),t.id)}))()}getFileInfo(){var e=this;return U((function*(){var t=(yield e.getFileEvent()).getOriginalContent().file,n=e.client.mxcUrlToHttp(t.url);if(!n)throw new Error("No HTTP URL available for ".concat(t.url));return{info:t,httpUrl:n}}))()}getFileEvent(){var e=this;return U((function*(){var t=e.client.getRoom(e.roomId);if(!t)throw new Error("Unknown room");for(var n=t.getUnfilteredTimelineSet().findEventById(e.id);!n&&t.getLiveTimeline().getState(Le.BACKWARDS).paginationToken;)yield e.client.scrollback(t,100),n=t.getUnfilteredTimelineSet().findEventById(e.id);if(!n)throw new Error("Failed to find event");return yield e.client.decryptEventIfNeeded(n),n}))()}createNewVersion(e,t,n,r){var i=this;return U((function*(){var o=yield i.directory.createFile(e,t,n,yc(yc({},r??{}),{},{"m.new_content":!0,"m.relates_to":{rel_type:cn.Replace,event_id:i.id}}));return yield i.client.sendStateEvent(i.roomId,fl.name,{active:!0,name:e,version:i.version+1},o.event_id),yield i.client.sendStateEvent(i.roomId,fl.name,yc(yc({},i.indexEvent.getContent()),{},{active:!1}),i.id),o}))()}getVersionHistory(){var e=this;return U((function*(){var t=[];t.push(e);var n=e.client.getRoom(e.roomId);if(!n)throw new Error("Invalid or unknown room");var r,i=[...n.getLiveTimeline().getEvents()].reverse(),o=yield e.getFileEvent();do{if(r=i.find((e=>e.replacingEventId()===o.getId()))){var s=e.directory.getFile(r.getId());if(!s)break;t.push(s),o=r}}while(r);return t}))()}}function hN(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Xu(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?hN(Object(n),!0).forEach((function(t){L(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):hN(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Eoe={invite:100,kick:100,ban:100,redact:50,state_default:50,events_default:50,users_default:0,events:{[ee.RoomPowerLevels]:100,[ee.RoomHistoryVisibility]:100,[ee.RoomTombstone]:100,[ee.RoomEncryption]:100,[ee.RoomName]:50,[ee.RoomMessage]:50,[ee.RoomMessageEncrypted]:50,[ee.Sticker]:50},users:{}},Vf=function(e){return e.Viewer="viewer",e.Editor="editor",e.Owner="owner",e}({});class pN{constructor(e,t){if(this.client=e,this.roomId=t,L(this,"room",void 0),this.room=this.client.getRoom(this.roomId),!this.room)throw new Error("Unknown room")}get id(){return this.roomId}get isTopLevel(){var e=this.room.currentState.getStateEvents(ee.SpaceParent);return null==e||!e.length||e.every((e=>{var t;return!(null!==(t=e.getContent())&&void 0!==t&&t.via)}))}setName(e){var t=this;return U((function*(){yield t.client.sendStateEvent(t.roomId,ee.RoomName,{name:e},"")}))()}invite(e){var t=arguments,n=this;return U((function*(){var r=!(t.length>1&&void 0!==t[1])||t[1],i=[n.retryInvite(e)];r&&i.push(...n.getDirectories().map((t=>t.invite(e,r)))),yield Promise.all(i)}))()}retryInvite(e){var t=this;return oie(U((function*(){yield t.client.invite(t.roomId,e).catch((e=>{throw"M_FORBIDDEN"===(null==e?void 0:e.errcode)?new d$.AbortError(e):e}))})))}setPermissions(e,t){var n=this;return U((function*(){var r,i=n.room.currentState.getStateEvents(ee.RoomPowerLevels,"");if(Array.isArray(i))throw new Error("Unexpected return type for power levels");var o=(null==i?void 0:i.getContent())||{},s=o.users_default||0,a=o.events_default||50,l=(null===(r=o.events)||void 0===r?void 0:r[ee.RoomPowerLevels])||100,c=o.users||{};switch(t){case Vf.Viewer:c[e]=s;break;case Vf.Editor:c[e]=a;break;case Vf.Owner:c[e]=l;break;default:throw new Error("Invalid role: "+t)}o.users=c,yield n.client.sendStateEvent(n.roomId,ee.RoomPowerLevels,o,"")}))()}getPermissions(e){var t,n,r=this.room.currentState.getStateEvents(ee.RoomPowerLevels,"");if(Array.isArray(r))throw new Error("Unexpected return type for power levels");var i=(null==r?void 0:r.getContent())||{},o=i.users_default||0,s=i.events_default||50,a=(null===(t=i.events)||void 0===t?void 0:t[ee.RoomPowerLevels])||100,l=(null===(n=i.users)||void 0===n?void 0:n[e])||o;return l>=a?Vf.Owner:l>=s?Vf.Editor:Vf.Viewer}createDirectory(e){var t=this;return U((function*(){var n=yield t.client.unstableCreateFileTree(e);return yield t.client.sendStateEvent(t.roomId,ee.SpaceChild,{via:[t.client.getDomain()]},n.roomId),yield t.client.sendStateEvent(n.roomId,ee.SpaceParent,{via:[t.client.getDomain()]},t.roomId),n}))()}getDirectories(){var e=[],t=this.room.currentState.getStateEvents(ee.SpaceChild);for(var n of t)try{var r=n.getStateKey();if(r){var i=this.client.unstableGetFileTreeSpace(r);i&&e.push(i)}}catch(e){A.warn("Unable to create tree space instance for listing. Are we joined?",e)}return e}getDirectory(e){return this.getDirectories().find((t=>t.roomId===e))}delete(){var e=this;return U((function*(){var t=e.getDirectories();for(var n of t)yield n.delete();var r=[Ke.Invite,Ke.Knock,Ke.Join],i=e.room.currentState.getStateEvents(ee.RoomMember);for(var o of i){if(o.getStateKey()!==e.client.getUserId()&&r.includes(o.getContent().membership)){var s=o.getStateKey();if(!s)throw new Error("State key not found for branch");yield e.client.kick(e.roomId,s,"Room deleted")}}yield e.client.leave(e.roomId)}))()}getOrderedChildren(e){var t=e.map((e=>({roomId:e.getStateKey(),order:e.getContent().order}))).filter((e=>e.roomId));return t.sort(((e,t)=>{if(e.order&&!t.order)return-1;if(!e.order&&t.order)return 1;if(e.order||t.order)return M_(e.order,t.order);var n,r,i,o,s=this.client.getRoom(e.roomId),a=this.client.getRoom(t.roomId);if(!s||!a)return M_(e.roomId,t.roomId);var l=null!==(n=null===(r=s.currentState.getStateEvents(ee.RoomCreate,""))||void 0===r?void 0:r.getTs())&&void 0!==n?n:0,c=null!==(i=null===(o=a.currentState.getStateEvents(ee.RoomCreate,""))||void 0===o?void 0:o.getTs())&&void 0!==i?i:0;return l===c?M_(e.roomId,t.roomId):l-c})),t}getParentRoom(){var e=this.room.currentState.getStateEvents(ee.SpaceParent)[0];if(!e)throw new Error("Expected to have a parent in a non-top level space");var t=e.getStateKey();if(!t)throw new Error("No state key found for parent");var n=this.client.getRoom(t);if(!n)throw new Error("Unable to locate room for parent");return n}getOrder(){if(this.isTopLevel)return-1;var e=this.getParentRoom().currentState.getStateEvents(ee.SpaceChild);return this.getOrderedChildren(e).findIndex((e=>e.roomId===this.roomId))}setOrder(e){var t=this;return U((function*(){var n;if(t.isTopLevel)throw new Error("Cannot set order of top level spaces currently");var r=t.getParentRoom(),i=r.currentState.getStateEvents(ee.SpaceChild),o=t.getOrderedChildren(i);e=Math.max(Math.min(e,o.length-1),0);var s=t.getOrder()<e;s&&e===o.length-1?e--:!s&&0===e&&e++;var a=o[s?e:e-1],l=o[s?e+1:e],c=au[0],u=!1;if(a)if(e===o.length-1)null!=l&&l.order&&(c=Bm(l.order));else{var d=null==a?void 0:a.order,h=null==l?void 0:l.order;d&&h?c=d===h?Bm(d):aie(d,h):d?c=Bm(d):h?c=t5(h):u=!0}else null!=l&&l.order&&(c=t5(l.order));if(u){for(var p,f=0;f<=e;f++){var m=o[f];if(0===f&&(p=m.order),m.order)p=m.order;else{var v;p=p?Bm(p):au[0];var g=r.currentState.getStateEvents(ee.SpaceChild,m.roomId),y=null!==(v=null==g?void 0:g.getContent())&&void 0!==v?v:{via:[t.client.getDomain()]};yield t.client.sendStateEvent(r.roomId,ee.SpaceChild,Xu(Xu({},y),{},{order:p}),m.roomId)}}p&&(c=Bm(p))}var b=r.currentState.getStateEvents(ee.SpaceChild,t.roomId),_=null!==(n=null==b?void 0:b.getContent())&&void 0!==n?n:{via:[t.client.getDomain()]};yield t.client.sendStateEvent(r.roomId,ee.SpaceChild,Xu(Xu({},_),{},{order:c}),t.roomId)}))()}createFile(e,t,n,r){var i=this;return U((function*(){var{content_uri:o}=yield i.client.uploadContent(t,{includeFilename:!1});n.url=o;var s={msgtype:Pa.File,body:e,url:o,file:n};(r=r??{})["m.new_content"]&&(r["m.new_content"]=s);var a=yield i.client.sendMessage(i.roomId,Xu(Xu(Xu({},r),s),{},{[b$.name]:{}}));return yield i.client.sendStateEvent(i.roomId,fl.name,{active:!0,name:e},a.event_id),a}))()}getFile(e){var t=this.room.currentState.getStateEvents(fl.name,e);return t?new fN(this.client,t,this):null}listFiles(){return this.listAllFiles().filter((e=>e.isActive))}listAllFiles(){var e;return(null!==(e=this.room.currentState.getStateEvents(fl.name))&&void 0!==e?e:[]).map((e=>new fN(this.client,e,this)))}}var bH=function(e){return e.Recent="recent",e.Rank="rank",e}({}),ad=function(e){return e.LocalStreamsChanged="local_streams_changed",e}({});class woe extends En{constructor(e){super(),this.client=e,L(this,"audioInput",void 0),L(this,"audioSettings",void 0),L(this,"videoInput",void 0),L(this,"localUserMediaStream",void 0),L(this,"userMediaStreams",[]),L(this,"screensharingStreams",[]),L(this,"getMediaStreamPromise",void 0)}restoreMediaSettings(e,t){this.audioInput=e,this.videoInput=t}setAudioInput(e){var t=this;return U((function*(){A.info("MediaHandler setAudioInput() running (deviceId=".concat(e,")")),t.audioInput!==e&&(t.audioInput=e,yield t.updateLocalUsermediaStreams())}))()}setAudioSettings(e){var t=this;return U((function*(){A.info("MediaHandler setAudioSettings() running (opts=".concat(JSON.stringify(e),")")),t.audioSettings=Object.assign({},e),yield t.updateLocalUsermediaStreams()}))()}setVideoInput(e){var t=this;return U((function*(){A.info("MediaHandler setVideoInput() running (deviceId=".concat(e,")")),t.videoInput!==e&&(t.videoInput=e,yield t.updateLocalUsermediaStreams())}))()}setMediaInputs(e,t){var n=this;return U((function*(){A.log("MediaHandler setMediaInputs() running (audioInput: ".concat(e," videoInput: ").concat(t,")")),n.audioInput=e,n.videoInput=t,yield n.updateLocalUsermediaStreams()}))()}updateLocalUsermediaStreams(){var e=this;return U((function*(){if(0!==e.userMediaStreams.length){var t=new Map;for(var n of e.client.callEventHandler.calls.values())t.set(n.callId,{audio:n.hasLocalUserMediaAudioTrack,video:n.hasLocalUserMediaVideoTrack});for(var r of e.userMediaStreams)for(var i of(A.log("MediaHandler updateLocalUsermediaStreams() stopping all tracks (streamId=".concat(r.id,")")),r.getTracks()))i.stop();for(var o of(e.userMediaStreams=[],e.localUserMediaStream=void 0,e.client.callEventHandler.calls.values()))if(!o.callHasEnded()&&t.has(o.callId)){var{audio:s,video:a}=t.get(o.callId);A.log("MediaHandler updateLocalUsermediaStreams() calling getUserMediaStream() (callId=".concat(o.callId,")"));var l=yield e.getUserMediaStream(s,a);o.callHasEnded()||(yield o.updateLocalUsermediaStream(l))}for(var c of e.client.groupCallEventHandler.groupCalls.values())if(c.localCallFeed){A.log("MediaHandler updateLocalUsermediaStreams() calling getUserMediaStream() (groupCallId=".concat(c.groupCallId,")"));var u=yield e.getUserMediaStream(!0,c.type===LE.Video);c.state!==Ln.Ended&&(yield c.updateLocalUsermediaStream(u))}e.emit(ad.LocalStreamsChanged)}}))()}hasAudioDevice(){return U((function*(){try{return(yield navigator.mediaDevices.enumerateDevices()).filter((e=>"audioinput"===e.kind)).length>0}catch(e){return A.log("MediaHandler hasAudioDevice() calling navigator.mediaDevices.enumerateDevices with error",e),!1}}))()}hasVideoDevice(){return U((function*(){try{return(yield navigator.mediaDevices.enumerateDevices()).filter((e=>"videoinput"===e.kind)).length>0}catch(e){return A.log("MediaHandler hasVideoDevice() calling navigator.mediaDevices.enumerateDevices with error",e),!1}}))()}getUserMediaStream(e,t){var n=arguments,r=this;return U((function*(){var i=!(n.length>2&&void 0!==n[2])||n[2];return r.getMediaStreamPromise?r.getMediaStreamPromise=r.getMediaStreamPromise.then((()=>r.getUserMediaStreamInternal(e,t,i))):r.getMediaStreamPromise=r.getUserMediaStreamInternal(e,t,i),r.getMediaStreamPromise}))()}getUserMediaStreamInternal(e,t,n){var r=this;return U((function*(){var i,o,s,a=e&&(yield r.hasAudioDevice()),l=t&&(yield r.hasVideoDevice()),c=!0;r.localUserMediaStream?(a!==r.localUserMediaStream.getAudioTracks().length>0&&(c=!1),l!==r.localUserMediaStream.getVideoTracks().length>0&&(c=!1),a&&(null===(o=r.localUserMediaStream.getAudioTracks()[0])||void 0===o||null===(o=o.getSettings())||void 0===o?void 0:o.deviceId)!==r.audioInput&&(c=!1),l&&(null===(s=r.localUserMediaStream.getVideoTracks()[0])||void 0===s||null===(s=s.getSettings())||void 0===s?void 0:s.deviceId)!==r.videoInput&&(c=!1)):c=!1;if(c){var u;if(i=r.localUserMediaStream.clone(),A.log("MediaHandler getUserMediaStreamInternal() cloning (oldStreamId=".concat(null===(u=r.localUserMediaStream)||void 0===u?void 0:u.id," newStreamId=").concat(i.id," shouldRequestAudio=").concat(a," shouldRequestVideo=").concat(l,")")),!a)for(var d of i.getAudioTracks())i.removeTrack(d);if(!l)for(var h of i.getVideoTracks())i.removeTrack(h)}else{var p=r.getUserMediaContraints(a,l);for(var f of(i=yield navigator.mediaDevices.getUserMedia(p),A.log("MediaHandler getUserMediaStreamInternal() calling getUserMediaStream (streamId=".concat(i.id,", shouldRequestAudio=").concat(a,", shouldRequestVideo=").concat(l,", constraints=").concat(JSON.stringify(p),")")),i.getTracks())){var m=f.getSettings();"audio"===f.kind?r.audioInput=m.deviceId:"video"===f.kind&&(r.videoInput=m.deviceId)}n&&(r.localUserMediaStream=i)}return n&&r.userMediaStreams.push(i),r.emit(ad.LocalStreamsChanged),i}))()}stopUserMediaStream(e){for(var t of(A.log("MediaHandler stopUserMediaStream() stopping (streamId=".concat(e.id,")")),e.getTracks()))t.stop();var n=this.userMediaStreams.indexOf(e);if(-1!==n&&(A.debug("MediaHandler stopUserMediaStream() splicing usermedia stream out stream array (streamId=".concat(e.id,")"),e.id),this.userMediaStreams.splice(n,1)),this.emit(ad.LocalStreamsChanged),this.localUserMediaStream===e)this.localUserMediaStream=void 0;else for(var r of e.getTracks()){var i;if(null!==(i=this.localUserMediaStream)&&void 0!==i&&i.getTrackById(r.id)){this.stopUserMediaStream(this.localUserMediaStream);break}}}getScreensharingStream(){var e=arguments,t=this;return U((function*(){var n,r=e.length>0&&void 0!==e[0]?e[0]:{},i=!(e.length>1&&void 0!==e[1])||e[1];if(0===t.screensharingStreams.length){var o=t.getScreenshareContraints(r);r.desktopCapturerSourceId?(A.debug("MediaHandler getScreensharingStream() calling getUserMedia() (opts=".concat(JSON.stringify(r),")")),n=yield navigator.mediaDevices.getUserMedia(o)):(A.debug("MediaHandler getScreensharingStream() calling getDisplayMedia() (opts=".concat(JSON.stringify(r),")")),n=yield navigator.mediaDevices.getDisplayMedia(o))}else{var s=t.screensharingStreams[t.screensharingStreams.length-1];A.log("MediaHandler getScreensharingStream() cloning (streamId=".concat(s.id,")")),n=s.clone()}return i&&t.screensharingStreams.push(n),t.emit(ad.LocalStreamsChanged),n}))()}stopScreensharingStream(e){for(var t of(A.debug("MediaHandler stopScreensharingStream() stopping stream (streamId=".concat(e.id,")")),e.getTracks()))t.stop();var n=this.screensharingStreams.indexOf(e);-1!==n&&(A.debug("MediaHandler stopScreensharingStream() splicing stream out (streamId=".concat(e.id,")")),this.screensharingStreams.splice(n,1)),this.emit(ad.LocalStreamsChanged)}stopAllStreams(){for(var e of this.userMediaStreams)for(var t of(A.log("MediaHandler stopAllStreams() stopping (streamId=".concat(e.id,")")),e.getTracks()))t.stop();for(var n of this.screensharingStreams)for(var r of n.getTracks())r.stop();this.userMediaStreams=[],this.screensharingStreams=[],this.localUserMediaStream=void 0,this.emit(ad.LocalStreamsChanged)}getUserMediaContraints(e,t){var n=!!navigator.webkitGetUserMedia;return{audio:!!e&&{deviceId:this.audioInput?{ideal:this.audioInput}:void 0,autoGainControl:this.audioSettings?{ideal:this.audioSettings.autoGainControl}:void 0,echoCancellation:this.audioSettings?{ideal:this.audioSettings.echoCancellation}:void 0,noiseSuppression:this.audioSettings?{ideal:this.audioSettings.noiseSuppression}:void 0},video:!!t&&{deviceId:this.videoInput?{ideal:this.videoInput}:void 0,width:n?{exact:640}:{ideal:640},height:n?{exact:360}:{ideal:360}}}}getScreenshareContraints(e){var{desktopCapturerSourceId:t,audio:n}=e;return t?{audio:n??!1,video:{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:t}}}:{audio:n??!1,video:!0}}}var mN=function(e){return e.RequestFinished="FINISHED",e.Complete="COMPLETE",e}({}),Cy=function(e){return e.PreProcess="ExtState.PreProcess",e.PostProcess="ExtState.PostProcess",e}({}),Ek=function(e){return e.RoomData="SlidingSync.RoomData",e.Lifecycle="SlidingSync.Lifecycle",e}({}),Coe=3;class Toe{constructor(e){this.crypto=e}name(){return"e2ee"}when(){return Cy.PreProcess}onRequest(e){var t=this;return U((function*(){return e&&(A.log("ExtensionE2EE: invalidating all device lists due to missing 'pos'"),yield t.crypto.markAllTrackedUsersAsDirty()),{enabled:!0}}))()}onResponse(e){var t=this;return U((function*(){e.device_lists&&(yield t.crypto.processDeviceLists(e.device_lists)),yield t.crypto.processKeyCounts(e.device_one_time_keys_count,e.device_unused_fallback_key_types||e["org.matrix.msc2732.device_unused_fallback_key_types"]),t.crypto.onSyncCompleted({})}))()}}class Roe{constructor(e,t){this.client=e,this.cryptoCallbacks=t,L(this,"nextBatch",null)}name(){return"to_device"}when(){return Cy.PreProcess}onRequest(e){var t=this;return U((function*(){return{since:null!==t.nextBatch?t.nextBatch:void 0,limit:100,enabled:!0}}))()}onResponse(e){var t=this;return U((function*(){var n=[],r=e.events||[];r.length>0&&t.cryptoCallbacks&&(r=yield t.cryptoCallbacks.preprocessToDeviceMessages(r)),r.map(hH).map((e=>{if("m.key.verification.cancel"===e.getType()){var t=e.getContent().transaction_id;t&&n.push(t)}return e})).forEach((e=>{var r=e.getContent();if("m.room.message"!=e.getType()||"m.bad.encrypted"!=r.msgtype){if("m.key.verification.start"===e.getType()||"m.key.verification.request"===e.getType()){var i=r.transaction_id;n.includes(i)&&e.flagCancelled()}t.client.emit(Oe.ToDeviceEvent,e)}else A.log("Ignoring undecryptable to-device event from "+e.getSender())})),t.nextBatch=e.next_batch}))()}}class Ioe{constructor(e){this.client=e}name(){return"account_data"}when(){return Cy.PostProcess}onRequest(e){return U((function*(){return{enabled:!0}}))()}onResponse(e){var t=this;return U((function*(){for(var n in e.global&&e.global.length>0&&t.processGlobalAccountData(e.global),e.rooms){var r=Mh(t.client,n,e.rooms[n]),i=t.client.getRoom(n);i?(i.addAccountData(r),r.forEach((e=>{t.client.emit(Oe.Event,e)}))):A.warn("got account data for room but room doesn't exist on client:",n)}}))()}processGlobalAccountData(e){var t=Mh(this.client,void 0,e),n=t.reduce(((e,t)=>(e[t.getType()]=this.client.store.getAccountData(t.getType()),e)),{});this.client.store.storeAccountDataEvents(t),t.forEach((e=>{if(e.getType()===ee.PushRules){var t=e.getContent();this.client.setPushRules(t)}var r=n[e.getType()];return this.client.emit(Oe.AccountData,e,r),e}))}}class koe{constructor(e){this.client=e}name(){return"typing"}when(){return Cy.PostProcess}onRequest(e){return U((function*(){return{enabled:!0}}))()}onResponse(e){var t=this;return U((function*(){if(null!=e&&e.rooms)for(var n in e.rooms)EH(t.client,n,[e.rooms[n]])}))()}}class xoe{constructor(e){this.client=e}name(){return"receipts"}when(){return Cy.PostProcess}onRequest(e){return U((function*(){return{enabled:!0}}))()}onResponse(e){var t=this;return U((function*(){if(null!=e&&e.rooms)for(var n in e.rooms)EH(t.client,n,[e.rooms[n]])}))()}}class SH{constructor(e,t,n,r){this.slidingSync=e,this.client=t,L(this,"opts",void 0),L(this,"syncOpts",void 0),L(this,"syncState",null),L(this,"syncStateData",void 0),L(this,"lastPos",null),L(this,"failCount",0),L(this,"notifEvents",[]),this.opts=uH(n),this.syncOpts=dH(r),t.getNotifTimelineSet()&&t.reEmitter.reEmit(t.getNotifTimelineSet(),[ke.Timeline,ke.TimelineReset]),this.slidingSync.on(Ek.Lifecycle,this.onLifecycle.bind(this)),this.slidingSync.on(Ek.RoomData,this.onRoomData.bind(this));var i=[new Roe(this.client,this.syncOpts.cryptoCallbacks),new Ioe(this.client),new koe(this.client),new xoe(this.client)];this.syncOpts.cryptoCallbacks&&i.push(new Toe(this.syncOpts.cryptoCallbacks)),i.forEach((e=>{this.slidingSync.registerExtension(e)}))}onRoomData(e,t){var n=this;return U((function*(){var r=n.client.store.getRoom(e);if(!r){if(!t.initial)return void A.debug("initial flag not set but no stored room exists for room ",e,t);r=fH(n.client,e,n.opts)}yield n.processRoomData(n.client,r,t)}))()}onLifecycle(e,t,n){switch(n&&A.debug("onLifecycle",e,n),e){case mN.Complete:if(this.purgeNotifications(),!t)break;this.lastPos||this.updateSyncState(Dt.Prepared,{oldSyncToken:void 0,nextSyncToken:t.pos,catchingUp:!1,fromCache:!1}),this.updateSyncState(Dt.Syncing,{oldSyncToken:this.lastPos,nextSyncToken:t.pos,catchingUp:!1,fromCache:!1}),this.lastPos=t.pos;break;case mN.RequestFinished:if(n){if(this.failCount+=1,this.updateSyncState(this.failCount>Coe?Dt.Error:Dt.Reconnecting,{error:new bn(n)}),this.shouldAbortSync(new bn(n)))return}else this.failCount=0,A.log("SlidingSyncState.RequestFinished with ".concat(Object.keys((null==t?void 0:t.rooms)||[]).length," rooms"))}}syncLeftRooms(){return U((function*(){return[]}))()}peek(e){return U((function*(){return null}))()}stopPeeking(){}setPresence(e){}getSyncState(){return this.syncState}getSyncStateData(){var e;return null!==(e=this.syncStateData)&&void 0!==e?e:null}createRoom(e){var{timelineSupport:t}=this.client,n=new xE(e,this.client,this.client.getUserId(),{lazyLoadMembers:this.opts.lazyLoadMembers,pendingEventOrdering:this.opts.pendingEventOrdering,timelineSupport:t});return this.client.reEmitter.reEmit(n,[ke.Name,ke.Redaction,ke.RedactionCancelled,ke.Receipt,ke.Tags,ke.LocalEchoUpdated,ke.AccountData,ke.MyMembership,ke.Timeline,ke.TimelineReset]),this.registerStateListeners(n),n}registerStateListeners(e){this.client.reEmitter.reEmit(e.currentState,[ut.Events,ut.Members,ut.NewMember,ut.Update]),e.currentState.on(ut.NewMember,((e,t,n)=>{var r;n.user=null!==(r=this.client.getUser(n.userId))&&void 0!==r?r:void 0,this.client.reEmitter.reEmit(n,[Gi.Name,Gi.Typing,Gi.PowerLevel,Gi.Membership])}))}shouldAbortSync(e){return"M_UNKNOWN_TOKEN"===e.errcode&&(A.warn("Token no longer valid - assuming logout"),this.stop(),this.updateSyncState(Dt.Error,{error:e}),!0)}processRoomData(e,t,n){var r=this;return U((function*(){n=Poe(e,t.roomId,n);var i=Mh(r.client,t.roomId,n.required_state),o=Mh(r.client,t.roomId,n.timeline,!1),s=[];if(n.limited||n.initial){var a=new Set;t.getLiveTimeline().getEvents().forEach((e=>{a.add(e.getId())}));for(var l=[],c=[],u=!1,d=o.length-1;d>=0;d--){var h=o[d];a.has(h.getId())?u=!0:u?l.push(h):c.unshift(h)}o=c,l.length>0&&t.addEventsToTimeline(l,!0,!1,t.getLiveTimeline(),n.prev_batch)}var p,f=t.hasEncryptionStateEvent();if(null!=n.notification_count&&t.setUnreadNotificationCount(jt.Total,n.notification_count),null!=n.highlight_count&&(!f||f&&t.getUnreadNotificationCount(jt.Highlight)<=0)&&t.setUnreadNotificationCount(jt.Highlight,n.highlight_count),n.bump_stamp&&t.setBumpStamp(n.bump_stamp),Number.isInteger(n.invited_count)&&t.currentState.setInvitedMemberCount(n.invited_count),Number.isInteger(n.joined_count)&&t.currentState.setJoinedMemberCount(n.joined_count),n.invite_state){var m=Mh(r.client,t.roomId,n.invite_state);return yield r.injectRoomEvents(t,m),n.initial&&(t.recalculate(),r.client.store.storeRoom(t),r.client.emit(Oe.Room,t)),void m.forEach((e=>{r.client.emit(Oe.Event,e)}))}n.limited&&t.getLiveTimeline().setPaginationToken(null!==(p=n.prev_batch)&&void 0!==p?p:null,Le.BACKWARDS);yield r.injectRoomEvents(t,i,o,n.num_live),t.addEphemeralEvents(s),t.updateMyMembership(Ke.Join),t.setMSC4186SummaryData(n.heroes,n.joined_count,n.invited_count),t.recalculate(),n.initial&&(e.store.storeRoom(t),e.emit(Oe.Room,t)),r.addNotifications(o);var v,g=(v=U((function*(n){e.emit(Oe.Event,n),n.isState()&&n.getType()==ee.RoomEncryption&&r.syncOpts.cryptoCallbacks&&(yield r.syncOpts.cryptoCallbacks.onCryptoEvent(t,n))})),function(e){return v.apply(this,arguments)});yield yh(i,g),yield yh(o,g),s.forEach((function(t){e.emit(Oe.Event,t)})),t.decryptCriticalEvents()}))()}injectRoomEvents(e,t){var n=arguments,r=this;return U((function*(){var i=n.length>2&&void 0!==n[2]?n[2]:[],o=n.length>3&&void 0!==n[3]?n[3]:0,s=e.getLiveTimeline(),a=0==s.getEvents().length;if(a){for(var l of t)r.client.getPushActionsForEvent(l);s.initialiseState(t)}a||(e.oldState.setStateEvents(t),e.currentState.setStateEvents(t));var c=[];o>0&&(c=i.slice(-1*o),i=i.slice(0,-1*c.length)),yield e.addLiveEvents(i,{fromCache:!0,addToState:!1}),c.length>0&&(yield e.addLiveEvents(c,{fromCache:!1,addToState:!1})),e.recalculate(),r.resolveInvites(e)}))()}resolveInvites(e){if(e&&this.opts.resolveInvitesToProfiles){var t=this.client;e.getMembersWithMembership(Ke.Invite).forEach((function(n){if(!n.requestedProfileInfo){n.requestedProfileInfo=!0;var r=t.getUser(n.userId);(r?Promise.resolve({avatar_url:r.avatarUrl,displayname:r.displayName}):t.getProfileInfo(n.userId)).then((function(t){var r=n.events.member;r.getContent().membership===Ke.Invite&&(r.getContent().avatar_url=t.avatar_url,r.getContent().displayname=t.displayname,n.setMembershipEvent(r,e.currentState))}),(function(e){}))}}))}}retryImmediately(){return!0}sync(){var e=this;return U((function*(){for(A.debug("Sliding sync init loop");!e.client.isGuest();)try{A.debug("Getting push rules...");var t=yield e.client.getPushRules();A.debug("Got push rules"),e.client.pushRules=t;break}catch(t){if(A.error("Getting push rules failed",t),e.shouldAbortSync(t))return}yield e.slidingSync.start()}))()}stop(){A.debug("SyncApi.stop"),this.slidingSync.stop()}updateSyncState(e,t){var n=this.syncState;this.syncState=e,this.syncStateData=t,this.client.emit(Oe.Sync,this.syncState,n,t)}addNotifications(e){if(this.client.getNotifTimelineSet())for(var t of e){var n=this.client.getPushActionsForEvent(t);n&&n.notify&&n.tweaks&&n.tweaks.highlight&&this.notifEvents.push(t)}}purgeNotifications(){this.notifEvents.sort((function(e,t){return e.getTs()-t.getTs()})),this.notifEvents.forEach((e=>{var t;null===(t=this.client.getNotifTimelineSet())||void 0===t||t.addLiveEvent(e,{addToState:!1})})),this.notifEvents=[]}}function Poe(e,t,n){if(!n.name)return n;for(var r of n.required_state)if(r.type===ee.RoomName&&""===r.state_key)return r.content={name:n.name},n;return n.required_state.push({event_id:"$fake-sliding-sync-name-event-"+t,state_key:"",type:ee.RoomName,content:{name:n.name},sender:e.getUserId(),origin_server_ts:(new Date).getTime()}),n}function Mh(e,t,n){var r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],i=e.getEventMapper({decrypt:r});return n.map((function(e){return e.room_id=t,i(e)}))}function EH(e,t,n){var r=Mh(e,t,n),i=e.getRoom(t);i?(i.addEphemeralEvents(r),r.forEach((t=>{e.emit(Oe.Event,t)}))):A.warn("got ephemeral events for room but room doesn't exist on client:",t)}var zP=new Kn("m.beacon_info","org.matrix.msc3672.beacon_info"),wk=new Kn("m.beacon","org.matrix.msc3672.beacon");class ap{static RETRY_BACKOFF_RATELIMIT(e,t,n){return $P(n,t,!1)}static QUEUE_MESSAGES(e){return e.getType()===ee.RoomMessage||e.hasAssociation()?"message":null}constructor(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:ap.RETRY_BACKOFF_RATELIMIT,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:ap.QUEUE_MESSAGES;this.retryAlgorithm=e,this.queueAlgorithm=t,L(this,"queues",{}),L(this,"activeQueues",[]),L(this,"procFn",null),L(this,"processQueue",(e=>{var t=this.peekNextEvent(e);t?(this.queues[e].length,Promise.resolve().then((()=>this.procFn(t.event))).then((n=>{this.removeNextEvent(e),t.event.getId(),t.defer.resolve(n),this.processQueue(e)}),(n=>{t.attempts+=1;var r=this.retryAlgorithm(t.event,t.attempts,n);t.attempts,t.event.getId(),-1===r?(A.info("Queue '%s' giving up on event %s",e,t.event.getId()),this.clearQueue(e,n)):setTimeout(this.processQueue,r,e)}))):this.disableQueue(e)}))}getQueueForEvent(e){var t=this.queueAlgorithm(e);return t&&this.queues[t]?this.queues[t].map((function(e){return e.event})):null}removeEventFromQueue(e){var t=this.queueAlgorithm(e);if(!t||!this.queues[t])return!1;var n=!1;return Hb(this.queues[t],(t=>t.event.getId()===e.getId()&&(n=!0,!0))),n}setProcessFunction(e){this.procFn=e,this.startProcessingQueues()}queueEvent(e){var t=this.queueAlgorithm(e);if(!t)return null;this.queues[t]||(this.queues[t]=[]);var n=ou();return this.queues[t].push({event:e,defer:n,attempts:0}),e.getId(),this.startProcessingQueues(),n.promise}startProcessingQueues(){this.procFn&&Object.keys(this.queues).filter((e=>-1===this.activeQueues.indexOf(e)&&this.queues[e].length>0)).forEach((e=>{this.activeQueues.push(e),this.processQueue(e)}))}disableQueue(e){var t=this.activeQueues.indexOf(e);t>=0&&this.activeQueues.splice(t,1),A.info("Stopping queue '%s' as it is now empty",e)}clearQueue(e,t){A.info("clearing queue '%s'",e);for(var n;n=this.removeNextEvent(e);)n.defer.reject(t);this.disableQueue(e)}peekNextEvent(e){var t=this.queues[e];if(Array.isArray(t))return t[0]}removeNextEvent(e){var t=this.queues[e];if(Array.isArray(t))return t.shift()}}var gN=20;class Loe{constructor(e){var t=this;this.client=e,L(this,"sending",!1),L(this,"running",!0),L(this,"retryTimeout",null),L(this,"retryAttempts",0),L(this,"sendQueue",U((function*(){if(null!==t.retryTimeout&&clearTimeout(t.retryTimeout),t.retryTimeout=null,!t.sending&&t.running){var e;A.debug("Attempting to send queued to-device messages"),t.sending=!0;try{for(;t.running&&null!==(e=yield t.client.store.getOldestToDeviceBatch());)yield t.sendBatch(e),yield t.client.store.removeToDeviceBatch(e.id),t.retryAttempts=0;if(!t.running)return;A.debug("All queued to-device messages sent")}catch(r){++t.retryAttempts;var n=ap.RETRY_BACKOFF_RATELIMIT(null,t.retryAttempts,r);if(-1===n)return void(4===Math.floor(r.httpStatus/100)?(A.error("Fatal error when sending to-device message - dropping to-device batch!",r),yield t.client.store.removeToDeviceBatch(e.id)):A.info("Automatic retry limit reached for to-device messages."));A.info("Failed to send batch of to-device messages. Will retry in ".concat(n,"ms"),r),t.retryTimeout=setTimeout(t.sendQueue,n)}finally{t.sending=!1}}}))),L(this,"onResumedSync",((e,t)=>{e===Dt.Syncing&&t!==Dt.Syncing&&(A.info("Resuming queue after resumed sync"),this.sendQueue())}))}start(){this.running=!0,this.sendQueue(),this.client.on(Oe.Sync,this.onResumedSync)}stop(){this.running=!1,null!==this.retryTimeout&&clearTimeout(this.retryTimeout),this.retryTimeout=null,this.client.removeListener(Oe.Sync,this.onResumedSync)}queueBatch(e){var t=this;return U((function*(){for(var n=[],r=0;r<e.batch.length;r+=gN){var i={eventType:e.eventType,batch:e.batch.slice(r,r+gN),txnId:t.client.makeTxnId()};n.push(i);var o=i.batch.map((e=>"".concat(e.userId,"/").concat(e.deviceId," (msgid ").concat(e.payload[IE],")")));A.info("Enqueuing batch of to-device messages. type=".concat(e.eventType," txnid=").concat(i.txnId),o)}yield t.client.store.saveToDeviceBatches(n),t.sendQueue()}))()}sendBatch(e){var t=this;return U((function*(){var n=new Sl((()=>new Map));for(var r of e.batch)n.getOrCreate(r.userId).set(r.deviceId,r.payload);A.info("Sending batch of ".concat(e.batch.length," to-device messages with ID ").concat(e.id," and txnId ").concat(e.txnId)),yield t.client.sendToDevice(e.eventType,n,e.txnId)}))()}}var r2=new rs.UnstableValue("m.policies","org.matrix.msc3847.policies"),T1=new rs.UnstableValue("m.ignore.invites","org.matrix.msc3847.ignore.invites"),vN=function(e){return e.Ban="m.ban",e}({}),Ah=function(e){return e.User="m.policy.user",e.Room="m.policy.room",e.Server="m.policy.server",e}({}),yN={[Ah.User]:ee.PolicyRuleUser,[Ah.Room]:ee.PolicyRuleRoom,[Ah.Server]:ee.PolicyRuleServer};class Ooe{constructor(e){this.client=e}addRule(e,t,n){var r=this;return U((function*(){var i=yield r.getOrCreateTargetRoom();return(yield r.client.sendStateEvent(i.roomId,yN[e],{entity:t,reason:n,recommendation:vN.Ban})).event_id}))()}removeRule(e){var t=this;return U((function*(){yield t.client.redactEvent(e.getRoomId(),e.getId())}))()}addSource(e){var t=this;return U((function*(){yield t.client.joinRoom(e);var n=(yield t.getOrCreateSourceRooms()).map((e=>e.roomId));return!n.includes(e)&&(n.push(e),yield t.withIgnoreInvitesPolicies((e=>{e.sources=n})),!0)}))()}getRuleForInvite(e){var t=this;return U((function*(){var{sender:n,roomId:r}=e,i=yield t.getOrCreateSourceRooms(),o=n.split(":")[1],s=r.split(":")[1];for(var a of i){var l=a.getUnfilteredTimelineSet().getLiveTimeline().getState(Le.FORWARDS);for(var{scope:c,entities:u}of[{scope:Ah.Room,entities:[r]},{scope:Ah.User,entities:[n]},{scope:Ah.Server,entities:[o,s]}]){var d=l.getStateEvents(yN[c]);for(var h of d){var p=h.getContent();if((null==p?void 0:p.recommendation)==vN.Ban){var f=null==p?void 0:p.entity;if(f){var m=void 0;try{m=new RegExp(p$(f))}catch{continue}for(var v of u)if(v&&m.test(v))return h}}}}}return null}))()}getOrCreateTargetRoom(){var e=this;return U((function*(){var t=e.getIgnoreInvitesPolicies().target;if("string"!=typeof t&&(t=null),t){var n=e.client.getRoom(t);if(n)return n;t=null}return t=(yield e.client.createRoom({name:"Individual Policy Room",preset:ME.PrivateChat})).room_id,yield e.withIgnoreInvitesPolicies((e=>{e.target=t})),e.client.getRoom(t)}))()}getOrCreateSourceRooms(){var e=this;return U((function*(){var t=e.getIgnoreInvitesPolicies().sources,n=!1;Array.isArray(t)||(n=!0,t=[]);var r=t.filter((e=>"string"==typeof e)).map((t=>e.client.getRoom(t))).filter((e=>!!e));(r.length!=t.length&&(n=!0),0==r.length)&&(n=!0,r=[yield e.getOrCreateTargetRoom()]);return n&&(yield e.withIgnoreInvitesPolicies((e=>{e.sources=t}))),r}))()}getIgnoreInvitesPolicies(){return this.getPoliciesAndIgnoreInvitesPolicies().ignoreInvitesPolicies}withIgnoreInvitesPolicies(e){var t=this;return U((function*(){var{policies:n,ignoreInvitesPolicies:r}=t.getPoliciesAndIgnoreInvitesPolicies();e(r),n[T1.name]=r,yield t.client.setAccountData(r2.name,n)}))()}getPoliciesAndIgnoreInvitesPolicies(){var e={};for(var t of[r2.name,r2.altName]){var n;if(t){var r=null===(n=this.client.getAccountData(t))||void 0===n?void 0:n.getContent();if(r){e=r;break}}}var i={},o=!1;for(var s of[T1.name,T1.altName])if(s){var a=e[s];if(a&&"object"==typeof a){i=a,o=!0;break}}return o||(e[T1.name]=i),{policies:e,ignoreInvitesPolicies:i}}}var i2="matrix-js-sdk";function Moe(e){if(e.length>=255)throw new TypeError("Alphabet too long");const t=new Uint8Array(256);for(let e=0;e<t.length;e++)t[e]=255;for(let n=0;n<e.length;n++){const r=e.charAt(n),i=r.charCodeAt(0);if(255!==t[i])throw new TypeError(r+" is ambiguous");t[i]=n}const n=e.length,r=e.charAt(0),i=Math.log(n)/Math.log(256),o=Math.log(256)/Math.log(n);function s(e){if("string"!=typeof e)throw new TypeError("Expected String");if(0===e.length)return new Uint8Array;let o=0,s=0,a=0;for(;e[o]===r;)s++,o++;const l=(e.length-o)*i+1>>>0,c=new Uint8Array(l);for(;e[o];){let r=t[e.charCodeAt(o)];if(255===r)return;let i=0;for(let e=l-1;(0!==r||i<a)&&-1!==e;e--,i++)r+=n*c[e]>>>0,c[e]=r%256>>>0,r=r/256>>>0;if(0!==r)throw new Error("Non-zero carry");a=i,o++}let u=l-a;for(;u!==l&&0===c[u];)u++;const d=new Uint8Array(s+(l-u));let h=s;for(;u!==l;)d[h++]=c[u++];return d}return{encode:function(t){if(t instanceof Uint8Array||(ArrayBuffer.isView(t)?t=new Uint8Array(t.buffer,t.byteOffset,t.byteLength):Array.isArray(t)&&(t=Uint8Array.from(t))),!(t instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(0===t.length)return"";let i=0,s=0,a=0;const l=t.length;for(;a!==l&&0===t[a];)a++,i++;const c=(l-a)*o+1>>>0,u=new Uint8Array(c);for(;a!==l;){let e=t[a],r=0;for(let t=c-1;(0!==e||r<s)&&-1!==t;t--,r++)e+=256*u[t]>>>0,u[t]=e%n>>>0,e=e/n>>>0;if(0!==e)throw new Error("Non-zero carry");s=r,a++}let d=c-s;for(;d!==c&&0===u[d];)d++;let h=r.repeat(i);for(;d<c;++d)h+=e.charAt(u[d]);return h},decodeUnsafe:s,decode:function(e){const t=s(e);if(t)return t;throw new Error("Non-base"+n+" character")}}}var Aoe="123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz";const zKe=Moe(Aoe);var Rr=function(e){return e.UserTrustStatusChanged="userTrustStatusChanged",e.KeyBackupStatus="crypto.keyBackupStatus",e.KeyBackupFailed="crypto.keyBackupFailed",e.KeyBackupSessionsRemaining="crypto.keyBackupSessionsRemaining",e.KeyBackupDecryptionKeyCached="crypto.keyBackupDecryptionKeyCached",e.VerificationRequestReceived="crypto.verificationRequestReceived",e.WillUpdateDevices="crypto.willUpdateDevices",e.DevicesUpdated="crypto.devicesUpdated",e.KeysChanged="crossSigning.keysChanged",e.LegacyCryptoStoreMigrationProgress="crypto.legacyCryptoStoreMigrationProgress",e.DehydratedDeviceCreated="dehydration.DehydratedDeviceCreated",e.DehydratedDeviceUploaded="dehydration.DehydratedDeviceUploaded",e.RehydrationStarted="dehydration.RehydrationStarted",e.RehydrationProgress="dehydration.RehydrationProgress",e.RehydrationCompleted="dehydration.RehydrationCompleted",e.RehydrationError="dehydration.RehydrationError",e.DehydrationKeyCached="dehydration.DehydrationKeyCached",e.DehydratedDeviceRotationError="dehydration.DehydratedDeviceRotationError",e}({}),_N=function(e){return e.MEGOLM_UNKNOWN_INBOUND_SESSION_ID="MEGOLM_UNKNOWN_INBOUND_SESSION_ID",e.MEGOLM_KEY_WITHHELD="MEGOLM_KEY_WITHHELD",e.MEGOLM_KEY_WITHHELD_FOR_UNVERIFIED_DEVICE="MEGOLM_KEY_WITHHELD_FOR_UNVERIFIED_DEVICE",e.OLM_UNKNOWN_MESSAGE_INDEX="OLM_UNKNOWN_MESSAGE_INDEX",e.HISTORICAL_MESSAGE_NO_KEY_BACKUP="HISTORICAL_MESSAGE_NO_KEY_BACKUP",e.HISTORICAL_MESSAGE_BACKUP_UNCONFIGURED="HISTORICAL_MESSAGE_BACKUP_UNCONFIGURED",e.HISTORICAL_MESSAGE_WORKING_BACKUP="HISTORICAL_MESSAGE_WORKING_BACKUP",e.HISTORICAL_MESSAGE_USER_NOT_JOINED="HISTORICAL_MESSAGE_USER_NOT_JOINED",e.SENDER_IDENTITY_PREVIOUSLY_VERIFIED="SENDER_IDENTITY_PREVIOUSLY_VERIFIED",e.UNSIGNED_SENDER_DEVICE="UNSIGNED_SENDER_DEVICE",e.UNKNOWN_SENDER_DEVICE="UNKNOWN_SENDER_DEVICE",e.UNKNOWN_ERROR="UNKNOWN_ERROR",e.MEGOLM_BAD_ROOM="MEGOLM_BAD_ROOM",e.MEGOLM_MISSING_FIELDS="MEGOLM_MISSING_FIELDS",e.OLM_DECRYPT_GROUP_MESSAGE_ERROR="OLM_DECRYPT_GROUP_MESSAGE_ERROR",e.OLM_BAD_ENCRYPTED_MESSAGE="OLM_BAD_ENCRYPTED_MESSAGE",e.OLM_BAD_RECIPIENT="OLM_BAD_RECIPIENT",e.OLM_BAD_RECIPIENT_KEY="OLM_BAD_RECIPIENT_KEY",e.OLM_BAD_ROOM="OLM_BAD_ROOM",e.OLM_BAD_SENDER_CHECK_FAILED="OLM_BAD_SENDER_CHECK_FAILED",e.OLM_BAD_SENDER="OLM_BAD_SENDER",e.OLM_FORWARDED_MESSAGE="OLM_FORWARDED_MESSAGE",e.OLM_MISSING_CIPHERTEXT="OLM_MISSING_CIPHERTEXT",e.OLM_NOT_INCLUDED_IN_RECIPIENTS="OLM_NOT_INCLUDED_IN_RECIPIENTS",e.UNKNOWN_ENCRYPTION_ALGORITHM="UNKNOWN_ENCRYPTION_ALGORITHM",e}({}),Noe=function(e){return e[e.AllDevicesIsolationMode=0]="AllDevicesIsolationMode",e[e.OnlySignedDevicesIsolationMode=1]="OnlySignedDevicesIsolationMode",e}({});class YKe{constructor(e){this.errorOnVerifiedUserProblems=e,L(this,"kind",Noe.AllDevicesIsolationMode)}}class JKe{constructor(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this.crossSigningVerified=e,this.crossSigningVerifiedBefore=t,this.tofu=n,L(this,"needsUserApproval",void 0),this.needsUserApproval=r}isVerified(){return this.isCrossSigningVerified()}isCrossSigningVerified(){return this.crossSigningVerified}wasCrossSigningVerified(){return this.crossSigningVerifiedBefore}isTofu(){return this.tofu}}class XKe{constructor(e){var t,n,r,i,o;L(this,"signedByOwner",void 0),L(this,"crossSigningVerified",void 0),L(this,"tofu",void 0),L(this,"localVerified",void 0),L(this,"trustCrossSignedDevices",void 0),this.signedByOwner=null!==(t=e.signedByOwner)&&void 0!==t&&t,this.crossSigningVerified=null!==(n=e.crossSigningVerified)&&void 0!==n&&n,this.tofu=null!==(r=e.tofu)&&void 0!==r&&r,this.localVerified=null!==(i=e.localVerified)&&void 0!==i&&i,this.trustCrossSignedDevices=null!==(o=e.trustCrossSignedDevices)&&void 0!==o&&o}isVerified(){return this.localVerified||this.trustCrossSignedDevices&&this.crossSigningVerified}}var ZKe=function(e){return e.Fetch="fetch",e.LoadKeys="load_keys",e}({}),QKe=function(e){return e.Master="master",e.SelfSigning="self_signing",e.UserSigning="user_signing",e}({}),eGe=function(e){return e[e.NONE=0]="NONE",e[e.GREY=1]="GREY",e[e.RED=2]="RED",e}({}),tGe=function(e){return e[e.UNKNOWN=0]="UNKNOWN",e[e.UNVERIFIED_IDENTITY=1]="UNVERIFIED_IDENTITY",e[e.UNSIGNED_DEVICE=2]="UNSIGNED_DEVICE",e[e.UNKNOWN_DEVICE=3]="UNKNOWN_DEVICE",e[e.AUTHENTICITY_NOT_GUARANTEED=4]="AUTHENTICITY_NOT_GUARANTEED",e[e.MISMATCHED_SENDER_KEY=5]="MISMATCHED_SENDER_KEY",e[e.SENT_IN_CLEAR=6]="SENT_IN_CLEAR",e[e.VERIFICATION_VIOLATION=7]="VERIFICATION_VIOLATION",e}({}),Doe=new Uint8Array(8);function wH(e,t){return Ck.apply(this,arguments)}function Ck(){return(Ck=U((function*(e,t){var n=yield globalThis.crypto.subtle.importKey("raw",e,{name:"HKDF"},!1,["deriveBits"]),r=yield globalThis.crypto.subtle.deriveBits({name:"HKDF",salt:Doe,info:(new TextEncoder).encode(t),hash:"SHA-256"},n,512),i=r.slice(0,32),o=r.slice(32),s=globalThis.crypto.subtle.importKey("raw",i,{name:"AES-CTR"},!1,["encrypt","decrypt"]),a=globalThis.crypto.subtle.importKey("raw",o,{name:"HMAC",hash:{name:"SHA-256"}},!1,["sign","verify"]);return Promise.all([s,a])}))).apply(this,arguments)}function CH(e,t,n,r){return Tk.apply(this,arguments)}function Tk(){return(Tk=U((function*(e,t,n,r){var i;r?i=Oh(r):(i=new Uint8Array(16),globalThis.crypto.getRandomValues(i),i[8]&=127);var[o,s]=yield wH(t,n),a=(new TextEncoder).encode(e),l=yield globalThis.crypto.subtle.encrypt({name:"AES-CTR",counter:i,length:64},o,a),c=yield globalThis.crypto.subtle.sign({name:"HMAC"},s,l);return{iv:D_(i),ciphertext:D_(new Uint8Array(l)),mac:D_(new Uint8Array(c))}}))).apply(this,arguments)}function joe(e,t,n){return Rk.apply(this,arguments)}function Rk(){return(Rk=U((function*(e,t,n){var[r,i]=yield wH(t,n),o=Oh(e.ciphertext);if(!(yield globalThis.crypto.subtle.verify({name:"HMAC"},i,Oh(e.mac),o)))throw new Error("Error decrypting secret ".concat(n,": bad MAC"));var s=yield globalThis.crypto.subtle.decrypt({name:"AES-CTR",counter:Oh(e.iv),length:64},r,o);return(new TextDecoder).decode(new Uint8Array(s))}))).apply(this,arguments)}var ld="m.secret_storage.v1.aes-hmac-sha2";class TH{constructor(e,t){this.accountDataAdapter=e,this.callbacks=t}getDefaultKeyId(){var e=this;return U((function*(){var t,n=yield e.accountDataAdapter.getAccountDataFromServer("m.secret_storage.default_key");return n&&null!==(t=n.key)&&void 0!==t?t:null}))()}setDefaultKeyId(e){return new Promise(((t,n)=>{var r=n=>{if("m.secret_storage.default_key"===n.getType()){var i=n.getContent();(null===e?0===Object.keys(i).length:i.key===e)&&(this.accountDataAdapter.removeListener(Oe.AccountData,r),t())}};this.accountDataAdapter.on(Oe.AccountData,r);var i=null===e?{}:{key:e};this.accountDataAdapter.setAccountData("m.secret_storage.default_key",i).catch((e=>{this.accountDataAdapter.removeListener(Oe.AccountData,r),n(e)}))}))}addKey(e,t,n){var r=this;return U((function*(){if(e!==ld)throw new Error("Unknown key algorithm ".concat(e));var i={algorithm:e};t.name&&(i.name=t.name),t.passphrase&&(i.passphrase=t.passphrase);var{iv:o,mac:s}=yield kk(t.key);if(i.iv=o,i.mac=s,!n)do{n=_s(32)}while(yield r.accountDataAdapter.getAccountDataFromServer("m.secret_storage.key.".concat(n)));return yield r.accountDataAdapter.setAccountData("m.secret_storage.key.".concat(n),i),{keyId:n,keyInfo:i}}))()}getKey(e){var t=this;return U((function*(){if(e||(e=yield t.getDefaultKeyId()),!e)return null;var n=yield t.accountDataAdapter.getAccountDataFromServer("m.secret_storage.key.".concat(e));return n?[e,n]:null}))()}hasKey(e){var t=this;return U((function*(){return!!(yield t.getKey(e))}))()}checkKey(e,t){return U((function*(){if(t.algorithm===ld){if(t.mac){var{mac:n}=yield kk(e,t.iv);return Ik(t.mac)===Ik(n)}return!0}throw new Error("Unknown algorithm")}))()}store(e,t,n){var r=this;return U((function*(){if(null!==t){var i={};if(!n){var o=yield r.getDefaultKeyId();if(!o)throw new Error("No keys specified and no default key present");n=[o]}if(0===n.length)throw new Error("Zero keys given to encrypt with!");for(var s of n){var a=yield r.accountDataAdapter.getAccountDataFromServer("m.secret_storage.key.".concat(s));if(!a)throw new Error("Unknown key: "+s);if(a.algorithm===ld){var l={[s]:a},[,c]=yield r.getSecretStorageKey(l,e);i[s]=yield c.encrypt(t)}else A.warn("unknown algorithm for secret storage key "+s+": "+a.algorithm)}yield r.accountDataAdapter.setAccountData(e,{encrypted:i})}else yield r.accountDataAdapter.setAccountData(e,{})}))()}get(e){var t=this;return U((function*(){var n=yield t.accountDataAdapter.getAccountDataFromServer(e);if(n){if(!n.encrypted)throw new Error("Content is not encrypted!");var r={};for(var i of Object.keys(n.encrypted)){var o=yield t.accountDataAdapter.getAccountDataFromServer("m.secret_storage.key.".concat(i)),s=n.encrypted[i];(null==o?void 0:o.algorithm)===ld&&s.iv&&s.ciphertext&&s.mac&&(r[i]=o)}if(0===Object.keys(r).length)throw new Error("Could not decrypt ".concat(e," because none of ")+"the keys it is encrypted with are for a supported algorithm");var[a,l]=yield t.getSecretStorageKey(r,e),c=n.encrypted[a];return l.decrypt(c)}}))()}isStored(e){var t=this;return U((function*(){var n=yield t.accountDataAdapter.getAccountDataFromServer(e);if(null==n||!n.encrypted)return null;var r={};for(var i of Object.keys(n.encrypted)){var o=yield t.accountDataAdapter.getAccountDataFromServer("m.secret_storage.key.".concat(i));if(o){var s=n.encrypted[i];o.algorithm===ld&&s.iv&&s.ciphertext&&s.mac&&(r[i]=o)}}return Object.keys(r).length?r:null}))()}getSecretStorageKey(e,t){var n=this;return U((function*(){if(!n.callbacks.getSecretStorageKey)throw new Error("No getSecretStorageKey callback supplied");var r=yield n.callbacks.getSecretStorageKey({keys:e},t);if(!r)throw new Error("getSecretStorageKey callback returned falsey");if(r.length<2)throw new Error("getSecretStorageKey callback returned invalid data");var[i,o]=r;if(!e[i])throw new Error("App returned unknown key from getSecretStorageKey!");if(e[i].algorithm===ld)return[i,{encrypt:function(e){return CH(e,o,t)},decrypt:function(e){return joe(e,o,t)}}];throw new Error("Unknown key type: "+e[i].algorithm)}))()}}function Ik(e){for(var t=e.length;t>=1&&61==e.charCodeAt(t-1);)t--;return t<e.length?e.substring(0,t):e}var Uoe="\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0";function kk(e,t){return CH(Uoe,e,"",t)}const Foe=Object.freeze(Object.defineProperty({__proto__:null,SECRET_STORAGE_ALGORITHM_V1_AES:ld,ServerSideSecretStorageImpl:TH,calculateKeyCheck:kk,trimTrailingEquals:Ik},Symbol.toStringTag,{value:"Module"}));var RH=e=>"livekit"===e.type&&"livekit_service_url"in e,xk=e=>RH(e)&&"livekit_alias"in e,YP=e=>"livekit"===e.type&&"focus_selection"in e,JP=144e5,$oe=(e,t)=>{var n,r="Malformed session membership event: ";return"string"!=typeof e.device_id&&t.push(r+"device_id must be string"),"string"!=typeof e.call_id&&t.push(r+"call_id must be string"),"string"!=typeof e.application&&t.push(r+"application must be a string"),"string"!=typeof(null===(n=e.focus_active)||void 0===n?void 0:n.type)&&t.push(r+"focus_active.type must be a string"),Array.isArray(e.foci_preferred)||t.push(r+"foci_preferred must be an array"),e.created_ts&&"number"!=typeof e.created_ts&&t.push(r+"created_ts must be number"),e.scope&&"string"!=typeof e.scope&&t.push(r+"scope must be string"),0===t.length};class bN{static equal(e,t){return Md(e.membershipData,t.membershipData)}constructor(e,t){this.parentEvent=e,L(this,"membershipData",void 0);var n=[];if(!$oe(t,n))throw Error("unknown CallMembership data. Does not match MSC4143 call.member (".concat(n.join(" & "),") events this could be a legacy membership event: (").concat(t,")"));this.membershipData=t}get sender(){return this.parentEvent.getSender()}get eventId(){return this.parentEvent.getId()}get callId(){return this.membershipData.call_id}get deviceId(){return this.membershipData.device_id}get application(){return this.membershipData.application}get scope(){return this.membershipData.scope}get membershipID(){return this.createdTs().toString()}createdTs(){var e;return null!==(e=this.membershipData.created_ts)&&void 0!==e?e:this.parentEvent.getTs()}getAbsoluteExpiry(){var e;return this.createdTs()+(null!==(e=this.membershipData.expires)&&void 0!==e?e:JP)}getMsUntilExpiry(){return this.getAbsoluteExpiry()-Date.now()}isExpired(){return this.getMsUntilExpiry()<=0}getPreferredFoci(){return this.membershipData.foci_preferred}getFocusSelection(){var e=this.membershipData.focus_active;if(YP(e))return e.focus_selection}}var Sd=function(e){return e.Cancel="cancel",e.Restart="restart",e.Send="send",e}({}),XP=function(e){return e.TooNew="TOO_NEW",e}({});class ZP extends Error{constructor(e){super("Crypto store is invalid because ".concat(e,", ")+"please stop the client, delete all data and start the client again"),this.reason=e,this.name="InvalidCryptoStoreError"}}L(ZP,"TOO_NEW",XP.TooNew);class Hoe extends Error{constructor(e,t){super(e),this.value=t}}class Boe extends Error{constructor(){super("MatrixClient has been stopped")}}class $c extends Error{constructor(e,t){super(e),this.clientEndpoint=t,this.name="UnsupportedDelayedEventsEndpointError"}}var Ic=function(e){return e.Disconnected="Disconnected",e.Connecting="Connecting",e.ConnectingFailed="ConnectingFailed",e.Connected="Connected",e.Reconnecting="Reconnecting",e.Disconnecting="Disconnecting",e.Stuck="Stuck",e.Unknown="Unknown",e}({}),j_=(e,t,n)=>e.sender===t&&e.deviceId===n;class Voe{constructor(e,t){this.membershipLoopHandler=e,L(this,"logger",void 0),L(this,"running",!1),L(this,"wakeup",(e=>{this.logger.error("Cannot call wakeup before calling `startWithJoin()`")})),L(this,"_actions",[]),this.logger=(t??A).getChild("[NewMembershipActionScheduler]")}get actions(){return this._actions}startWithJoin(){var e=this;return U((function*(){if(e.running)e.logger.error("Cannot call startWithJoin() on NewMembershipActionScheduler while already running");else{e.running=!0,e._actions=[{ts:Date.now(),type:ot.SendDelayedEvent}];try{for(var t=function*(){e._actions.sort(((e,t)=>e.ts-t.ts));var t=e._actions[0],n=void 0,r=new Promise((t=>{e.wakeup=e=>{n=e,t()}}));t.ts>Date.now()&&(yield Promise.race([r,su(t.ts-Date.now())]));var i={};if(!n){e.logger.debug("Current MembershipManager processing: ".concat(t.type,"\nQueue:"),e._actions,'\nDate.now: "'.concat(Date.now()));try{i=yield e.membershipLoopHandler(t.type)}catch(e){throw Error("The MembershipManager shut down because of the end condition: ".concat(e))}}e._actions.splice(0,1);var o=n??i;"replace"in o?e._actions=o.replace:"insert"in o&&e._actions.push(...o.insert)};e._actions.length>0;)yield*t()}finally{e.running=!1}e.logger.debug("Leave MembershipManager ActionScheduler loop (no more actions)")}}))()}initiateJoin(){var e;null===(e=this.wakeup)||void 0===e||e.call(this,{replace:[{ts:Date.now(),type:ot.SendDelayedEvent}]})}initiateLeave(){var e;null===(e=this.wakeup)||void 0===e||e.call(this,{replace:[{ts:Date.now(),type:ot.SendScheduledDelayedLeaveEvent}]})}}var SN=function(e){return e.StatusChanged="StatusChanged",e}({}),ot=function(e){return e.SendDelayedEvent="SendDelayedEvent",e.SendJoinEvent="SendJoinEvent",e.RestartDelayedEvent="RestartDelayedEvent",e.UpdateExpiry="UpdateExpiry",e.SendScheduledDelayedLeaveEvent="SendScheduledDelayedLeaveEvent",e.SendLeaveEvent="SendLeaveEvent",e}({});class Zb extends En{isActivated(){return this.activated}isJoined(){return this.isActivated()}join(e,t,n){this.scheduler.running?this.logger.error("MembershipManager is already running. Ignoring join request."):(this.fociPreferred=e,this.focusActive=t,this.leavePromiseDefer=void 0,this.activated=!0,this.oldStatus=this.status,this.state=Zb.defaultState,this.scheduler.startWithJoin().catch((e=>{this.logger.error("MembershipManager stopped because: ",e),null==n||n(e)})).finally((()=>{var e;(this.activated=!1,this.oldStatus&&this.oldStatus!==this.status&&this.emit(SN.StatusChanged,this.oldStatus,this.status),this.scheduler.running)||(null===(e=this.leavePromiseDefer)||void 0===e||e.resolve(!0),this.leavePromiseDefer=void 0)})))}leave(e){return this.scheduler.running?(this.leavePromiseDefer||(this.leavePromiseDefer=ou(),this.activated=!1,this.scheduler.initiateLeave(),e&&setTimeout((()=>{var e;return null===(e=this.leavePromiseDefer)||void 0===e?void 0:e.resolve(!1)}),e)),this.leavePromiseDefer.promise):(this.logger.warn("Called MembershipManager.leave() even though the MembershipManager is not running"),Promise.resolve(!0))}onRTCSessionMemberUpdate(e){var t=this;return U((function*(){var n=t.client.getUserId(),r=t.client.getDeviceId();if(n&&r&&t.isJoined()&&!e.some((e=>j_(e,n,r)))){var i=[ot.SendDelayedEvent,ot.SendJoinEvent];t.logger.warn("Missing own membership: force re-join"),t.scheduler.actions.find((e=>i.includes(e.type)))?t.logger.error("NewMembershipManger tried adding another `SendFirstDelayedEvent` actions even though we already have one in the Queue\nActionQueueOnMemberUpdate:",t.scheduler.actions):(t.state.hasMemberStateEvent=!1,t.scheduler.initiateJoin())}return Promise.resolve()}))()}getActiveFocus(){if(!this.focusActive){var e=this.getOldestMembership();return null==e?void 0:e.getPreferredFoci()[0]}if(YP(this.focusActive)){if("oldest_membership"===this.focusActive.focus_selection){var t=this.getOldestMembership();return null==t?void 0:t.getPreferredFoci()[0]}}else this.logger.warn("Unknown own ActiveFocus type. This makes it impossible to connect to an SFU.")}constructor(e,t,n,r,i){super(),this.joinConfig=e,this.room=t,this.client=n,this.getOldestMembership=r,L(this,"activated",!1),L(this,"logger",void 0),L(this,"leavePromiseDefer",void 0),L(this,"oldStatus",void 0),L(this,"scheduler",void 0),L(this,"state",void 0),L(this,"deviceId",void 0),L(this,"stateKey",void 0),L(this,"fociPreferred",void 0),L(this,"focusActive",void 0),L(this,"membershipServerSideExpiryTimeoutOverride",void 0),this.logger=(i??A).getChild("[NewMembershipManager]");var[o,s]=[this.client.getUserId(),this.client.getDeviceId()];if(null===o)throw Error("Missing userId in client");if(null===s)throw Error("Missing deviceId in client");this.deviceId=s,this.stateKey=this.makeMembershipStateKey(o,s),this.state=Zb.defaultState,this.scheduler=new Voe((e=>(this.oldStatus&&(this.logger.debug("MembershipManager applied action changes. Status: ".concat(this.oldStatus," -> ").concat(this.status)),this.oldStatus!==this.status&&this.emit(SN.StatusChanged,this.oldStatus,this.status)),this.oldStatus=this.status,this.logger.debug("MembershipManager before processing action. status=".concat(this.oldStatus)),this.membershipLoopHandler(e))),this.logger)}static get defaultState(){return{hasMemberStateEvent:!1,delayId:void 0,startTime:0,rateLimitRetries:new Map,networkErrorRetries:new Map,expireUpdateIterations:1}}get callMemberEventRetryDelayMinimum(){var e,t;return null!==(e=null===(t=this.joinConfig)||void 0===t?void 0:t.callMemberEventRetryDelayMinimum)&&void 0!==e?e:3e3}get membershipEventExpiryTimeout(){var e,t;return null!==(e=null===(t=this.joinConfig)||void 0===t?void 0:t.membershipExpiryTimeout)&&void 0!==e?e:JP}get membershipEventExpiryTimeoutHeadroom(){var e,t;return null!==(e=null===(t=this.joinConfig)||void 0===t?void 0:t.membershipExpiryTimeoutHeadroom)&&void 0!==e?e:5e3}computeNextExpiryActionTs(e){return this.state.startTime+this.membershipEventExpiryTimeout*e-this.membershipEventExpiryTimeoutHeadroom}get membershipServerSideExpiryTimeout(){var e,t,n;return null!==(e=null!==(t=this.membershipServerSideExpiryTimeoutOverride)&&void 0!==t?t:null===(n=this.joinConfig)||void 0===n?void 0:n.membershipServerSideExpiryTimeout)&&void 0!==e?e:8e3}get membershipKeepAlivePeriod(){var e,t;return null!==(e=null===(t=this.joinConfig)||void 0===t?void 0:t.membershipKeepAlivePeriod)&&void 0!==e?e:5e3}get maximumRateLimitRetryCount(){var e,t;return null!==(e=null===(t=this.joinConfig)||void 0===t?void 0:t.maximumRateLimitRetryCount)&&void 0!==e?e:10}get maximumNetworkErrorRetryCount(){var e,t;return null!==(e=null===(t=this.joinConfig)||void 0===t?void 0:t.maximumNetworkErrorRetryCount)&&void 0!==e?e:10}membershipLoopHandler(e){var t=this;return U((function*(){switch(e){case ot.SendDelayedEvent:return t.state.delayId?t.cancelKnownDelayIdBeforeSendFirstDelayedEvent(t.state.delayId):t.sendOrResendDelayedLeaveEvent();case ot.RestartDelayedEvent:return t.state.delayId?t.restartDelayedEvent(t.state.delayId):Ls(ot.SendDelayedEvent);case ot.SendScheduledDelayedLeaveEvent:return t.state.hasMemberStateEvent?t.state.delayId?t.sendScheduledDelayedLeaveEventOrFallbackToSendLeaveEvent(t.state.delayId):Ls(ot.SendLeaveEvent):{replace:[]};case ot.SendJoinEvent:return t.sendJoinEvent();case ot.UpdateExpiry:return t.updateExpiryOnJoinedEvent();case ot.SendLeaveEvent:return t.state.hasMemberStateEvent?t.sendFallbackLeaveEvent():{replace:[]}}}))()}sendOrResendDelayedLeaveEvent(){var e=this;return U((function*(){return yield e.client._unstable_sendDelayedStateEvent(e.room.roomId,{delay:e.membershipServerSideExpiryTimeout},ee.GroupCallMemberPrefix,{},e.stateKey).then((t=>(e.resetRateLimitCounter(ot.SendDelayedEvent),e.state.delayId=t.delay_id,e.state.hasMemberStateEvent?Ls(ot.RestartDelayedEvent,e.membershipKeepAlivePeriod):Ls(ot.SendJoinEvent)))).catch((t=>{var n=ot.SendDelayedEvent;if(e.manageMaxDelayExceededSituation(t))return Ls(n);var r=e.actionUpdateFromErrors(t,n,"sendDelayedStateEvent");if(r)return r;if(e.state.hasMemberStateEvent){if(e.isUnsupportedDelayedEndpoint(t))return{};throw Error("Could not send delayed event, even though delayed events are supported. "+t)}return e.isUnsupportedDelayedEndpoint(t)?e.logger.info("Not using delayed event because the endpoint is not supported"):e.logger.info("Not using delayed event because: "+t),Ls(ot.SendJoinEvent)}))}))()}cancelKnownDelayIdBeforeSendFirstDelayedEvent(e){var t=this;return U((function*(){return yield t.client._unstable_updateDelayedEvent(e,Sd.Cancel).then((()=>(t.state.delayId=void 0,t.resetRateLimitCounter(ot.SendDelayedEvent),s2(ot.SendDelayedEvent)))).catch((e=>{var n=ot.SendDelayedEvent,r=t.actionUpdateFromErrors(e,n,"updateDelayedEvent");if(r)return r;if(t.isNotFoundError(e))return t.state.delayId=void 0,s2(n);if(t.isUnsupportedDelayedEndpoint(e))return s2(ot.SendJoinEvent);throw Error("We failed to cancel a delayed event where we already had a delay id with an error we cannot automatically handle")}))}))()}restartDelayedEvent(e){var t=this;return U((function*(){return yield t.client._unstable_updateDelayedEvent(e,Sd.Restart).then((()=>(t.resetRateLimitCounter(ot.RestartDelayedEvent),Ls(ot.RestartDelayedEvent,t.membershipKeepAlivePeriod)))).catch((e=>{var n=ot.RestartDelayedEvent;if(t.isNotFoundError(e))return t.state.delayId=void 0,Ls(ot.SendDelayedEvent);if(t.isUnsupportedDelayedEndpoint(e))return{};var r=t.actionUpdateFromErrors(e,n,"updateDelayedEvent");if(r)return r;throw Error("Could not restart delayed event, even though delayed events are supported. "+e)}))}))()}sendScheduledDelayedLeaveEventOrFallbackToSendLeaveEvent(e){var t=this;return U((function*(){return yield t.client._unstable_updateDelayedEvent(e,Sd.Send).then((()=>(t.state.hasMemberStateEvent=!1,t.resetRateLimitCounter(ot.SendScheduledDelayedLeaveEvent),{replace:[]}))).catch((e=>{var n=ot.SendLeaveEvent;return t.isUnsupportedDelayedEndpoint(e)?{}:t.isNotFoundError(e)?(t.state.delayId=void 0,Ls(n)):t.actionUpdateFromErrors(e,n,"updateDelayedEvent")||(t.logger.warn("Encountered unexpected error during SendScheduledDelayedLeaveEvent. Falling back to SendLeaveEvent",e),Ls(n))}))}))()}sendJoinEvent(){var e=this;return U((function*(){return yield e.client.sendStateEvent(e.room.roomId,ee.GroupCallMemberPrefix,e.makeMyMembership(e.membershipEventExpiryTimeout),e.stateKey).then((()=>(e.state.startTime=Date.now(),e.state.expireUpdateIterations=1,e.state.hasMemberStateEvent=!0,e.resetRateLimitCounter(ot.SendJoinEvent),{insert:[{ts:Date.now(),type:ot.RestartDelayedEvent},{ts:e.computeNextExpiryActionTs(e.state.expireUpdateIterations),type:ot.UpdateExpiry}]}))).catch((t=>{var n=e.actionUpdateFromErrors(t,ot.SendJoinEvent,"sendStateEvent");if(n)return n;throw t}))}))()}updateExpiryOnJoinedEvent(){var e=this;return U((function*(){var t=e.state.expireUpdateIterations+1;return yield e.client.sendStateEvent(e.room.roomId,ee.GroupCallMemberPrefix,e.makeMyMembership(e.membershipEventExpiryTimeout*t),e.stateKey).then((()=>(e.resetRateLimitCounter(ot.UpdateExpiry),e.state.expireUpdateIterations=t,{insert:[{ts:e.computeNextExpiryActionTs(t),type:ot.UpdateExpiry}]}))).catch((t=>{var n=e.actionUpdateFromErrors(t,ot.UpdateExpiry,"sendStateEvent");if(n)return n;throw t}))}))()}sendFallbackLeaveEvent(){var e=this;return U((function*(){return yield e.client.sendStateEvent(e.room.roomId,ee.GroupCallMemberPrefix,{},e.stateKey).then((()=>(e.resetRateLimitCounter(ot.SendLeaveEvent),e.state.hasMemberStateEvent=!1,{replace:[]}))).catch((t=>{var n=e.actionUpdateFromErrors(t,ot.SendLeaveEvent,"sendStateEvent");if(n)return n;throw t}))}))()}makeMembershipStateKey(e,t){var n="".concat(e,"_").concat(t);return/^org\.matrix\.msc(3757|3779)\b/.exec(this.room.getVersion())?n:"_".concat(n)}makeMyMembership(e){var t;return{call_id:"",scope:"m.room",application:"m.call",device_id:this.deviceId,expires:e,focus_active:{type:"livekit",focus_selection:"oldest_membership"},foci_preferred:null!==(t=this.fociPreferred)&&void 0!==t?t:[]}}isNotFoundError(e){return e instanceof bn&&"M_NOT_FOUND"===e.errcode}manageMaxDelayExceededSituation(e){if(e instanceof bn&&"M_UNKNOWN"===e.errcode&&"M_MAX_DELAY_EXCEEDED"===e.data["org.matrix.msc4140.errcode"]){var t=e.data["org.matrix.msc4140.max_delay"];return"number"==typeof t&&this.membershipServerSideExpiryTimeout>t&&(this.membershipServerSideExpiryTimeoutOverride=t),this.logger.warn("Retry sending delayed disconnection event due to server timeout limitations:",e),!0}return!1}actionUpdateFromErrors(e,t,n){var r=this.actionUpdateFromRateLimitError(e,n,t);if(r)return r;var i=this.actionUpdateFromNetworkErrorRetry(e,t);return i||void 0}actionUpdateFromRateLimitError(e,t,n){var r;if((e instanceof lu||e instanceof bn)&&e.isRateLimitError()){var i=null!==(r=this.state.rateLimitRetries.get(n))&&void 0!==r?r:0;if(i<this.maximumRateLimitRetryCount){var o,s=5e3;try{var a;o=null!==(a=e.getRetryAfterMs())&&void 0!==a?a:s,this.logger.info("Rate limited by server, retrying in ".concat(o,"ms"))}catch(e){this.logger.warn("Error while retrieving a rate-limit retry delay, retrying after default delay of ".concat(s),e),o=s}return this.state.rateLimitRetries.set(n,i+1),Ls(n,o)}throw Error("Exceeded maximum retries for "+n+" attempts (client."+t+"): "+e)}}actionUpdateFromNetworkErrorRetry(e,t){var n,r=null!==(n=this.state.networkErrorRetries.get(t))&&void 0!==n?n:0,i=this.callMemberEventRetryDelayMinimum/1e3+"s",o="("+r+"/"+this.maximumNetworkErrorRetryCount+")";if(e instanceof Error&&"AbortError"===e.name)this.logger.warn("Network local timeout error while sending event, retrying in "+i+" "+o,e);else if(e instanceof Error&&e.message.includes("updating delayed event"))this.logger.warn("delayed event update timeout error, retrying in "+i+" "+o,e);else if(e instanceof Jd)this.logger.warn("Network connection error while sending event, retrying in "+i+" "+o,e);else{if(!((e instanceof lu||e instanceof bn)&&"number"==typeof e.httpStatus&&e.httpStatus>=500&&e.httpStatus<600))return;this.logger.warn("Server error while sending event, retrying in "+i+" "+o,e)}if(r<this.maximumNetworkErrorRetryCount)return this.state.networkErrorRetries.set(t,r+1),Ls(t,this.callMemberEventRetryDelayMinimum);throw Error("Reached maximum ("+this.maximumNetworkErrorRetryCount+") retries cause by: "+e)}isUnsupportedDelayedEndpoint(e){return e instanceof $c}resetRateLimitCounter(e){this.state.rateLimitRetries.set(e,0),this.state.networkErrorRetries.set(e,0)}get status(){var e=this.scheduler.actions;if(1===e.length){var{type:t}=e[0];switch(t){case ot.SendDelayedEvent:case ot.SendJoinEvent:return Ic.Connecting;case ot.UpdateExpiry:return Ic.Connected;case ot.SendScheduledDelayedLeaveEvent:case ot.SendLeaveEvent:return Ic.Disconnecting}}else if(2===e.length){var n=e.map((e=>e.type));if((n.includes(ot.RestartDelayedEvent)||n.includes(ot.SendDelayedEvent)&&this.state.hasMemberStateEvent)&&n.includes(ot.UpdateExpiry))return Ic.Connected}else if(3===e.length){var r=e.map((e=>e.type));if(2===r.filter((e=>e===ot.RestartDelayedEvent)).length&&r.includes(ot.UpdateExpiry))return Ic.Connected}return this.scheduler.running?(this.logger.error("MembershipManager has an unknown state. Actions: ",e),Ic.Unknown):Ic.Disconnected}}function Ls(e,t){return{insert:[{ts:Date.now()+(t??0),type:e}]}}function s2(e,t){return{replace:[{ts:Date.now()+0,type:e}]}}var Hc=function(e){return e.ReceivedKeys="received_keys",e}({}),AE=function(e){return e.EnabledTransportsChanged="enabled_transports_changed",e}({});class IH extends En{constructor(e,t,n){var r;super(),r=this,this.toDeviceTransport=e,this.roomKeyTransport=t,L(this,"logger",void 0),L(this,"_enabled",{toDevice:!0,room:!1}),this.logger=(n??A).getChild("[RoomAndToDeviceTransport]"),this.toDeviceTransport.setParentLogger(this.logger),this.roomKeyTransport.setParentLogger(this.logger),this.roomKeyTransport.on(Hc.ReceivedKeys,(function(){r._enabled.room||(r.logger.debug("Received room key, enabling room key transport, disabling toDevice transport"),r.setEnabled({toDevice:!1,room:!0}));for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];r.emit(Hc.ReceivedKeys,...t)})),this.toDeviceTransport.on(Hc.ReceivedKeys,(function(){if(r._enabled.toDevice){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];r.emit(Hc.ReceivedKeys,...t)}else r.logger.debug("To Device transport is disabled, ignoring received keys")}))}setEnabled(e){(this.enabled.toDevice!==e.toDevice||this.enabled.room!==e.room)&&(this._enabled=e,this.emit(AE.EnabledTransportsChanged,e))}get enabled(){return this._enabled}start(){this.roomKeyTransport.start(),this.toDeviceTransport.start()}stop(){this.roomKeyTransport.stop(),this.toDeviceTransport.stop()}sendKey(e,t,n){var r=this;return U((function*(){r.logger.debug("Sending key with index ".concat(t," to call members (count=").concat(n.length,") via:")+(r._enabled.room?"room transport":"")+(r._enabled.room&&r._enabled.toDevice?"and":"")+(r._enabled.toDevice?"to device transport":"")),r._enabled.room&&(yield r.roomKeyTransport.sendKey(e,t,n)),r._enabled.toDevice&&(yield r.toDeviceTransport.sendKey(e,t,n))}))()}}class qoe{get updateEncryptionKeyThrottle(){var e,t;return null!==(e=null===(t=this.joinConfig)||void 0===t?void 0:t.updateEncryptionKeyThrottle)&&void 0!==e?e:3e3}get makeKeyDelay(){var e,t;return null!==(e=null===(t=this.joinConfig)||void 0===t?void 0:t.makeKeyDelay)&&void 0!==e?e:3e3}get useKeyDelay(){var e,t;return null!==(e=null===(t=this.joinConfig)||void 0===t?void 0:t.useKeyDelay)&&void 0!==e?e:5e3}constructor(e,t,n,r,i,o,s){var a,l=this;this.userId=e,this.deviceId=t,this.getMemberships=n,this.transport=r,this.statistics=i,this.onEncryptionKeysChanged=o,L(this,"manageMediaKeys",!1),L(this,"keysEventUpdateTimeout",void 0),L(this,"makeNewKeyTimeout",void 0),L(this,"setNewKeyTimeouts",new Set),L(this,"encryptionKeys",new Map),L(this,"lastEncryptionKeyUpdateRequest",void 0),L(this,"lastMembershipFingerprints",void 0),L(this,"latestGeneratedKeyIndex",-1),L(this,"joinConfig",void 0),L(this,"logger",void 0),L(this,"joined",!1),L(this,"sendEncryptionKeysEvent",(a=U((function*(e){if(void 0!==l.keysEventUpdateTimeout&&(clearTimeout(l.keysEventUpdateTimeout),l.keysEventUpdateTimeout=void 0),l.lastEncryptionKeyUpdateRequest=Date.now(),l.joined){var t=l.getKeysForParticipant(l.userId,l.deviceId);if(!t)return void l.logger.warn("Tried to send encryption keys event but no keys found!");if("number"!=typeof e&&-1===l.latestGeneratedKeyIndex)return void l.logger.warn("Tried to send encryption keys event but no current key index found!");var n=e??l.latestGeneratedKeyIndex;l.logger.info("Try sending encryption keys event. keyIndexToSend=".concat(n," (method parameter: ").concat(e,")"));var r=t[n];try{l.statistics.counters.roomEventEncryptionKeysSent+=1,yield l.transport.sendKey(pH(r),n,l.getMemberships()),l.logger.debug("sendEncryptionKeysEvent participantId=".concat(l.userId,":").concat(l.deviceId," numKeys=").concat(t.length," currentKeyIndex=").concat(l.latestGeneratedKeyIndex," keyIndexToSend=").concat(n),l.encryptionKeys)}catch(e){if(void 0===l.keysEventUpdateTimeout){var i=jP(e,5e3);l.logger.warn("Failed to send m.call.encryption_key, retrying in ".concat(i),e),l.keysEventUpdateTimeout=setTimeout((()=>{l.sendEncryptionKeysEvent()}),i)}else l.logger.info("Not scheduling key resend as another re-send is already pending")}}})),function(e){return a.apply(this,arguments)})),L(this,"onTransportChanged",(()=>{this.requestSendCurrentKey()})),L(this,"onNewKeyReceived",((e,t,n,r,i)=>{this.logger.debug("Received key over key transport ".concat(e,":").concat(t," at index ").concat(r)),this.setEncryptionKey(e,t,r,n,i)})),L(this,"onRotateKeyTimeout",(()=>{if(this.manageMediaKeys){this.makeNewKeyTimeout=void 0,this.logger.info("Making new sender key for key rotation");var e=this.makeNewSenderKey(!0);this.sendEncryptionKeysEvent(e)}})),this.logger=(s??A).getChild("[EncryptionManager]")}getEncryptionKeys(){return this.encryptionKeys}join(e){var t,n,r;this.joinConfig=e,this.joined=!0,this.manageMediaKeys=null!==(t=null===(n=this.joinConfig)||void 0===n?void 0:n.manageMediaKeys)&&void 0!==t?t:this.manageMediaKeys,this.transport.on(Hc.ReceivedKeys,this.onNewKeyReceived),this.transport instanceof IH&&this.transport.on(AE.EnabledTransportsChanged,this.onTransportChanged),this.transport.start(),null!==(r=this.joinConfig)&&void 0!==r&&r.manageMediaKeys&&(this.makeNewSenderKey(),this.requestSendCurrentKey())}leave(){for(var e of(this.encryptionKeys.set(U_(this.userId,this.deviceId),[]),this.transport.off(Hc.ReceivedKeys,this.onNewKeyReceived),this.transport.stop(),void 0!==this.makeNewKeyTimeout&&(clearTimeout(this.makeNewKeyTimeout),this.makeNewKeyTimeout=void 0),this.setNewKeyTimeouts))clearTimeout(e);this.setNewKeyTimeouts.clear(),this.manageMediaKeys=!1,this.joined=!1}onMembershipsUpdate(e){if(this.manageMediaKeys&&this.joined){var t=new Set(e.filter((e=>!j_(e,this.userId,this.deviceId))).map(o2)),n=new Set(this.getMemberships().filter((e=>!j_(e,this.userId,this.deviceId))).map(o2)),r=Array.from(t).some((e=>!n.has(e))),i=Array.from(n).some((e=>!t.has(e))),o=this.lastMembershipFingerprints;if(this.storeLastMembershipFingerprints(),r)this.makeNewKeyTimeout||(this.logger.debug("Member(s) have left: queueing sender key rotation"),this.makeNewKeyTimeout=setTimeout(this.onRotateKeyTimeout,this.makeKeyDelay));else if(i)this.logger.debug("New member(s) have joined: re-sending keys"),this.requestSendCurrentKey();else if(o){var s=this.lastMembershipFingerprints;(Array.from(o).some((e=>!s.has(e)))||Array.from(s).some((e=>!o.has(e))))&&(this.logger.debug("Member(s) have updated/reconnected: re-sending keys to everyone"),this.requestSendCurrentKey())}}}makeNewSenderKey(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=mH(16),n=this.getNewEncryptionKeyIndex();return this.logger.info("Generated new key at index "+n),this.setEncryptionKey(this.userId,this.deviceId,n,t,Date.now(),e),n}requestSendCurrentKey(){if(this.manageMediaKeys){if(this.lastEncryptionKeyUpdateRequest&&this.lastEncryptionKeyUpdateRequest+this.updateEncryptionKeyThrottle>Date.now())return this.logger.info("Last encryption key event sent too recently: postponing"),void(void 0===this.keysEventUpdateTimeout&&(this.keysEventUpdateTimeout=setTimeout((()=>{this.sendEncryptionKeysEvent()}),this.updateEncryptionKeyThrottle)));this.sendEncryptionKeysEvent()}}getKeysForParticipant(e,t){var n;return null===(n=this.encryptionKeys.get(U_(e,t)))||void 0===n?void 0:n.map((e=>e.key))}storeLastMembershipFingerprints(){this.lastMembershipFingerprints=new Set(this.getMemberships().filter((e=>!j_(e,this.userId,this.deviceId))).map((e=>"".concat(o2(e),":").concat(e.createdTs()))))}getNewEncryptionKeyIndex(){return-1===this.latestGeneratedKeyIndex?0:(this.latestGeneratedKeyIndex+1)%256}setEncryptionKey(e,t,n,r,i){var o=arguments.length>5&&void 0!==arguments[5]&&arguments[5];this.logger.debug("Setting encryption key for ".concat(e,":").concat(t," at index ").concat(n));var s=Oh(r),a=U_(e,t);this.encryptionKeys.has(a)||this.encryptionKeys.set(a,[]);var l=this.encryptionKeys.get(a),c=l[n];if(c){if(c.timestamp>i)return void this.logger.info("Ignoring new key at index ".concat(n," for ").concat(a," as it is older than existing known key"));if(Koe(c.key,s))return void(c.timestamp=i)}if(e===this.userId&&t===this.deviceId&&(this.latestGeneratedKeyIndex=n),l[n]={key:s,timestamp:i},o){var u=setTimeout((()=>{this.setNewKeyTimeouts.delete(u),this.logger.info("Delayed-emitting key changed event for ".concat(a," index ").concat(n)),this.onEncryptionKeysChanged(s,n,a)}),this.useKeyDelay);this.setNewKeyTimeouts.add(u)}else this.onEncryptionKeysChanged(s,n,a)}}var U_=(e,t)=>"".concat(e,":").concat(t);function Koe(e,t){return e===t||!!e&&!!t&&e.length===t.length&&e.every(((e,n)=>e===t[n]))}var o2=e=>U_(e.sender,e.deviceId);class Goe{get callMemberEventRetryDelayMinimum(){var e,t;return null!==(e=null===(t=this.joinConfig)||void 0===t?void 0:t.callMemberEventRetryDelayMinimum)&&void 0!==e?e:3e3}get membershipExpiryTimeout(){var e,t;return null!==(e=null===(t=this.joinConfig)||void 0===t?void 0:t.membershipExpiryTimeout)&&void 0!==e?e:JP}get membershipServerSideExpiryTimeout(){var e,t,n;return null!==(e=null!==(t=this.membershipServerSideExpiryTimeoutOverride)&&void 0!==t?t:null===(n=this.joinConfig)||void 0===n?void 0:n.membershipServerSideExpiryTimeout)&&void 0!==e?e:8e3}get membershipKeepAlivePeriod(){var e,t;return null!==(e=null===(t=this.joinConfig)||void 0===t?void 0:t.membershipKeepAlivePeriod)&&void 0!==e?e:5e3}get callMemberEventRetryJitter(){var e,t;return null!==(e=null===(t=this.joinConfig)||void 0===t?void 0:t.callMemberEventRetryJitter)&&void 0!==e?e:2e3}constructor(e,t,n,r){var i=this;this.joinConfig=e,this.room=t,this.client=n,this.getOldestMembership=r,L(this,"relativeExpiry",void 0),L(this,"memberEventTimeout",void 0),L(this,"ownFociPreferred",void 0),L(this,"ownFocusActive",void 0),L(this,"updateCallMembershipRunning",!1),L(this,"needCallMembershipUpdate",!1),L(this,"membershipServerSideExpiryTimeoutOverride",void 0),L(this,"disconnectDelayId",void 0),L(this,"triggerCallMembershipEventUpdate",U((function*(){if(i.updateCallMembershipRunning)i.needCallMembershipUpdate=!0;else{i.updateCallMembershipRunning=!0;try{do{i.needCallMembershipUpdate=!1,yield i.updateCallMembershipEvent()}while(i.needCallMembershipUpdate)}finally{i.updateCallMembershipRunning=!1}}}))),L(this,"delayDisconnection",U((function*(){try{var e=i.disconnectDelayId;yield qf((()=>i.client._unstable_updateDelayedEvent(e,Sd.Restart))),i.scheduleDelayDisconnection()}catch(e){A.error("Failed to delay our disconnection event:",e)}})))}off(e,t){return A.error("off is not implemented on LegacyMembershipManager"),this}on(e,t){return A.error("on is not implemented on LegacyMembershipManager"),this}isJoined(){return void 0!==this.relativeExpiry}isActivated(){return this.isJoined()}get status(){return Ic.Unknown}join(e,t){this.ownFocusActive=t,this.ownFociPreferred=e,this.relativeExpiry=this.membershipExpiryTimeout,this.triggerCallMembershipEventUpdate()}leave(){var e=arguments,t=this;return U((function*(){var n=e.length>0&&void 0!==e[0]?e[0]:void 0;return t.relativeExpiry=void 0,t.ownFocusActive=void 0,t.memberEventTimeout&&(clearTimeout(t.memberEventTimeout),t.memberEventTimeout=void 0),n?"timeout"!==(yield Promise.race([t.triggerCallMembershipEventUpdate(),su(n,"timeout")])):(yield t.triggerCallMembershipEventUpdate(),!0)}))()}onRTCSessionMemberUpdate(e){var t=this;return U((function*(){if(t.isJoined()&&!e.some((e=>e.sender===t.client.getUserId()&&e.deviceId===t.client.getDeviceId())))return A.warn("Missing own membership: force re-join"),t.triggerCallMembershipEventUpdate()}))()}getActiveFocus(){if(!this.ownFocusActive){var e=this.getOldestMembership();return null==e?void 0:e.getPreferredFoci()[0]}if(YP(this.ownFocusActive)){if("oldest_membership"===this.ownFocusActive.focus_selection){var t=this.getOldestMembership();return null==t?void 0:t.getPreferredFoci()[0]}}else A.warn("Unknown own ActiveFocus type. This makes it impossible to connect to an SFU.")}makeNewMembership(e){return this.isJoined()?this.makeMyMembership(e):{}}makeMyMembership(e){var t;return{call_id:"",scope:"m.room",application:"m.call",device_id:e,expires:this.relativeExpiry,focus_active:{type:"livekit",focus_selection:"oldest_membership"},foci_preferred:null!==(t=this.ownFociPreferred)&&void 0!==t?t:[]}}updateCallMembershipEvent(){var e=this;return U((function*(){if(e.memberEventTimeout&&(clearTimeout(e.memberEventTimeout),e.memberEventTimeout=void 0),!e.room.getLiveTimeline().getState(Le.FORWARDS))throw new Error("Couldn't get room state for room "+e.room.roomId);var t=e.client.getUserId(),n=e.client.getDeviceId();if(!t||!n)throw new Error("User ID or device ID was null!");var r,i;r=e.makeNewMembership(n);try{if(e.isJoined()){var o=e.makeMembershipStateKey(t,n),s=(i=U((function*(){try{var t=yield qf((()=>e.client._unstable_sendDelayedStateEvent(e.room.roomId,{delay:e.membershipServerSideExpiryTimeout},ee.GroupCallMemberPrefix,{},o)));e.disconnectDelayId=t.delay_id}catch(t){if(t instanceof bn&&"M_UNKNOWN"===t.errcode&&"M_MAX_DELAY_EXCEEDED"===t.data["org.matrix.msc4140.errcode"]){var n=t.data["org.matrix.msc4140.max_delay"];if("number"==typeof n&&e.membershipServerSideExpiryTimeout>n)return e.membershipServerSideExpiryTimeoutOverride=n,s()}A.error("Failed to prepare delayed disconnection event:",t)}})),function(){return i.apply(this,arguments)});if(yield s(),yield qf((()=>e.client.sendStateEvent(e.room.roomId,ee.GroupCallMemberPrefix,r,o))),void 0!==e.disconnectDelayId)try{var a=e.disconnectDelayId;yield qf((()=>e.client._unstable_updateDelayedEvent(a,Sd.Restart)))}catch(i){i instanceof bn&&"M_NOT_FOUND"===i.errcode&&(A.warn("Failed to update delayed disconnection event, prepare it again:",i),e.disconnectDelayId=void 0,yield s())}void 0!==e.disconnectDelayId&&e.scheduleDelayDisconnection()}else{var l=!1;if(void 0!==e.disconnectDelayId){try{var c=e.disconnectDelayId;yield qf((()=>e.client._unstable_updateDelayedEvent(c,Sd.Send))),l=!0}catch(i){A.error("Failed to send our delayed disconnection event:",i)}e.disconnectDelayId=void 0}l||(yield qf((()=>e.client.sendStateEvent(e.room.roomId,ee.GroupCallMemberPrefix,{},e.makeMembershipStateKey(t,n)))))}A.info("Sent updated call member event.")}catch(i){var u=e.callMemberEventRetryDelayMinimum+Math.random()*e.callMemberEventRetryJitter;A.warn("Failed to send call member event (retrying in ".concat(u,"): ").concat(i)),yield su(u),yield e.triggerCallMembershipEventUpdate()}}))()}scheduleDelayDisconnection(){this.memberEventTimeout=setTimeout((()=>{this.delayDisconnection()}),this.membershipKeepAlivePeriod)}makeMembershipStateKey(e,t){var n="".concat(e,"_").concat(t);return/^org\.matrix\.msc(3757|3779)\b/.exec(this.room.getVersion())?n:"_".concat(n)}}function qf(e){return Pk.apply(this,arguments)}function Pk(){return Pk=U((function*(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;;)try{return yield e()}catch(e){if(!(t>0&&e instanceof lu&&e.isRateLimitError()))throw e;t--;var n=void 0,r=5e3;try{var i;n=null!==(i=e.getRetryAfterMs())&&void 0!==i?i:r,A.info("Rate limited by server, retrying in ".concat(n,"ms"))}catch(e){A.warn("Error while retrieving a rate-limit retry delay, retrying after default delay of ".concat(r),e),n=r}yield su(n)}})),Pk.apply(this,arguments)}class EN extends En{setParentLogger(e){this.logger=e.getChild("[RoomKeyTransport]")}constructor(e,t,n,r){super(),this.room=e,this.client=t,this.statistics=n,L(this,"logger",A),this.setParentLogger(r??A)}start(){this.room.on(ke.Timeline,(e=>{this.consumeCallEncryptionEvent(e)}))}stop(){this.room.off(ke.Timeline,(e=>{this.consumeCallEncryptionEvent(e)}))}consumeCallEncryptionEvent(e){var t=arguments,n=this;return U((function*(){var r=t.length>1&&void 0!==t[1]&&t[1];if(yield n.client.decryptEventIfNeeded(e),!e.isDecryptionFailure())return r&&n.logger.info("Decryption succeeded for event ".concat(e.getId()," after retry")),e.getType()!==ee.CallEncryptionKeysPrefix?Promise.resolve():n.room?void n.onEncryptionEvent(e):(n.logger.error("Got room state event for unknown room ".concat(e.getRoomId(),"!")),Promise.resolve());r?n.logger.warn("Decryption failed for event ".concat(e.getId(),": ").concat(e.decryptionFailureReason)):(n.logger.warn("Decryption failed for event ".concat(e.getId(),": ").concat(e.decryptionFailureReason," will retry once only")),setTimeout((()=>{n.consumeCallEncryptionEvent(e,!0)}),1e3))}))()}sendKey(e,t,n){var r=this;return U((function*(){var n={keys:[{index:t,key:e}],device_id:r.client.getDeviceId(),call_id:"",sent_ts:Date.now()};try{yield r.client.sendEvent(r.room.roomId,ee.CallEncryptionKeysPrefix,n)}catch(e){r.logger.error("Failed to send call encryption keys",e);var i=e;throw i.event&&r.client.cancelPendingEvent(i.event),e}}))()}onEncryptionEvent(e){var t=e.getSender(),n=e.getContent(),r=n.device_id,i=n.call_id;if(t)if(""===i)if(Array.isArray(n.keys))if(t!==this.client.getUserId()||r!==this.client.getDeviceId()){this.statistics.counters.roomEventEncryptionKeysReceived+=1;var o=Date.now()-("number"==typeof n.sent_ts?n.sent_ts:e.getTs());for(var s of(this.statistics.totals.roomEventEncryptionKeysReceivedTotalAge+=o,n.keys))if(s){var a=s.key,l=s.index;a&&null!=l&&null!=i&&"string"==typeof r&&"string"==typeof i&&"string"==typeof a&&"number"==typeof l?(this.logger.debug("onCallEncryption userId=".concat(t,":").concat(r," encryptionKeyIndex=").concat(l," age=").concat(o,"ms")),this.emit(Hc.ReceivedKeys,t,r,a,l,e.getTs())):this.logger.warn("Malformed call encryption_key: userId=".concat(t,", deviceId=").concat(r,", encryptionKeyIndex=").concat(l," callId=").concat(i))}else this.logger.info("Ignoring false-y key in keys event")}else this.logger.info("Ignoring our own keys event");else this.logger.warn("Received m.call.encryption_keys where keys wasn't an array: callId=".concat(i));else this.logger.warn("Received m.call.encryption_keys with unsupported callId: userId=".concat(t,", deviceId=").concat(r,", callId=").concat(i));else this.logger.warn("Received m.call.encryption_keys with no userId: callId=".concat(i))}}class Woe extends En{setParentLogger(e){this.logger=e.getChild("[ToDeviceKeyTransport]")}constructor(e,t,n,r,i,o){super(),this.userId=e,this.deviceId=t,this.roomId=n,this.client=r,this.statistics=i,L(this,"logger",A),L(this,"onToDeviceEvent",(e=>{if(e.getType()===ee.CallEncryptionKeysPrefix){var t=this.getValidEventContent(e);t&&e.getSender()&&this.receiveCallKeyEvent(e.getSender(),t)}})),this.setParentLogger(o??A)}start(){this.client.on(Oe.ToDeviceEvent,this.onToDeviceEvent)}stop(){this.client.off(Oe.ToDeviceEvent,this.onToDeviceEvent)}sendKey(e,t,n){var r=this;return U((function*(){var i={keys:{index:t,key:e},room_id:r.roomId,member:{claimed_device_id:r.deviceId},session:{call_id:"",application:"m.call",scope:"m.room"}},o=n.filter((e=>null==e.sender||null==e.deviceId?(r.logger.warn("Malformed call member: ".concat(e.sender,"|").concat(e.deviceId)),!1):!(e.sender==r.userId&&e.deviceId==r.deviceId))).map((e=>({userId:e.sender,deviceId:e.deviceId})));o.length>0?(yield r.client.encryptAndSendToDevice(ee.CallEncryptionKeysPrefix,o,i),r.statistics.counters.roomEventEncryptionKeysSent+=1):r.logger.warn("No targets found for sending key")}))()}receiveCallKeyEvent(e,t){this.statistics.counters.roomEventEncryptionKeysReceived+=1;var n=Date.now(),r=n-("number"==typeof t.sent_ts?t.sent_ts:n);this.statistics.totals.roomEventEncryptionKeysReceivedTotalAge+=r,this.emit(Hc.ReceivedKeys,e,t.member.claimed_device_id,t.keys.key,t.keys.index,n)}getValidEventContent(e){var t=e.getContent(),n=t.room_id;if(n)if(n===this.roomId)if(t.keys&&t.keys.key&&"number"==typeof t.keys.index){if(t.member&&t.member.claimed_device_id)return t;this.logger.warn("Malformed Event: Missing claimed_device_id")}else this.logger.warn("Malformed Event: Missing keys field");else this.logger.warn("Malformed Event: Mismatch roomId");else this.logger.warn("Malformed Event: invalid call encryption keys event, no roomId")}}var ar=function(e){return e.MembershipsChanged="memberships_changed",e.JoinStateChanged="join_state_changed",e.EncryptionKeyChanged="encryption_key_changed",e.MembershipManagerError="membership_manager_error",e}({});class Nh extends En{get callId(){return this._callId}static callMembershipsForRoom(e){var t=A.getChild("[MatrixRTCSession ".concat(e.roomId,"]")),n=e.getLiveTimeline().getState(Le.FORWARDS);if(!n)throw t.warn("Couldn't get state for room "+e.roomId),new Error("Could't get state for room "+e.roomId);var r=n.getStateEvents(ee.GroupCallMemberPrefix),i=[];for(var o of r){var s=o.getContent(),a=Object.keys(s).length;if(0!==a){var l=[];if(a>1&&"focus_active"in s?l.push(s):1===a&&"memberships"in s&&t.warn("Legacy event found. Those are ignored, they do not contribute to the MatrixRTC session"),0!==l.length)for(var c of l)try{var u,d=new bN(o,c);if(""!==d.callId||"m.room"!==d.scope){t.info("Ignoring user-scoped call");continue}if(d.isExpired()){t.info("Ignoring expired device membership ".concat(d.sender,"/").concat(d.deviceId));continue}if(!e.hasMembershipState(null!==(u=d.sender)&&void 0!==u?u:"",Ke.Join)){t.info("Ignoring membership of user ".concat(d.sender," who is not in the room."));continue}i.push(d)}catch(e){t.warn("Couldn't construct call membership: ",e)}}}return i.sort(((e,t)=>e.createdTs()-t.createdTs())),i.length>1&&t.debug("Call memberships in room ".concat(e.roomId,", in order: "),i.map((e=>[e.createdTs(),e.sender]))),i}static roomSessionForRoom(e,t){var n=Nh.callMembershipsForRoom(t);return new Nh(e,t,n)}get room(){return this.roomSubset}constructor(e,t,n){var r;super(),this.client=e,this.roomSubset=t,this.memberships=n,L(this,"membershipManager",void 0),L(this,"encryptionManager",void 0),L(this,"_callId",void 0),L(this,"logger",void 0),L(this,"expiryTimeout",void 0),L(this,"statistics",{counters:{roomEventEncryptionKeysSent:0,roomEventEncryptionKeysReceived:0},totals:{roomEventEncryptionKeysReceivedTotalAge:0}}),L(this,"reEmitter",new Mp(this)),L(this,"onRoomMemberUpdate",(()=>{this.recalculateSessionMembers()})),L(this,"onRTCSessionMemberUpdate",(()=>{this.recalculateSessionMembers()})),L(this,"recalculateSessionMembers",(()=>{var e,t,n,r,i=this.memberships;(this.memberships=Nh.callMembershipsForRoom(this.room),this._callId=null!==(e=this._callId)&&void 0!==e?e:null===(t=this.memberships[0])||void 0===t?void 0:t.callId,i.length!=this.memberships.length||i.some(((e,t)=>!bN.equal(e,this.memberships[t]))))&&(this.logger.info("Memberships for call in room ".concat(this.roomSubset.roomId," have changed: emitting")),sie(this.logger,"emit MatrixRTCSessionEvent.MembershipsChanged",(()=>{this.emit(ar.MembershipsChanged,i,this.memberships)})),null===(r=this.membershipManager)||void 0===r||r.onRTCSessionMemberUpdate(this.memberships));null===(n=this.encryptionManager)||void 0===n||n.onMembershipsUpdate(i),this.setExpiryTimer()})),this.logger=A.getChild("[MatrixRTCSession ".concat(t.roomId,"]")),this._callId=null===(r=n[0])||void 0===r?void 0:r.callId;var i=this.roomSubset.getLiveTimeline().getState(Le.FORWARDS);null==i||i.on(ut.Members,this.onRoomMemberUpdate),this.setExpiryTimer()}isJoined(){var e,t;return null!==(e=null===(t=this.membershipManager)||void 0===t?void 0:t.isJoined())&&void 0!==e&&e}stop(){var e=this;return U((function*(){var t;yield null===(t=e.membershipManager)||void 0===t?void 0:t.leave(1e3),e.expiryTimeout&&(clearTimeout(e.expiryTimeout),e.expiryTimeout=void 0);var n=e.roomSubset.getLiveTimeline().getState(Le.FORWARDS);null==n||n.off(ut.Members,e.onRoomMemberUpdate)}))()}joinRoomSession(e,t,n){if(this.isJoined())this.logger.info("Already joined to session in room ".concat(this.roomSubset.roomId,": ignoring join call"));else{var r,i;if(null!==(r=null==n?void 0:n.useNewMembershipManager)&&void 0!==r&&r?this.membershipManager=new Zb(n,this.roomSubset,this.client,(()=>this.getOldestMembership()),this.logger):this.membershipManager=new Goe(n,this.roomSubset,this.client,(()=>this.getOldestMembership())),null!=n&&n.useExperimentalToDeviceTransport){this.logger.info("Using to-device with room fallback transport for encryption keys");var[o,s]=[this.client.getUserId(),this.client.getDeviceId()],[a,l,c]=[this.roomSubset,this.client,this.statistics],u=new EN(a,l,c),d=new Woe(o,s,a.roomId,l,c);i=new IH(d,u,this.logger),this.reEmitter.reEmit(i,[AE.EnabledTransportsChanged])}else i=new EN(this.roomSubset,this.client,this.statistics);this.encryptionManager=new qoe(this.client.getUserId(),this.client.getDeviceId(),(()=>this.memberships),i,this.statistics,((e,t,n)=>{this.emit(ar.EncryptionKeyChanged,e,t,n)}),this.logger),this.membershipManager.join(e,t,(e=>{this.logger.error("MembershipManager encountered an unrecoverable error: ",e),this.emit(ar.MembershipManagerError,e),this.emit(ar.JoinStateChanged,this.isJoined())})),this.encryptionManager.join(n),this.emit(ar.JoinStateChanged,!0)}}leaveRoomSession(){var e=arguments,t=this;return U((function*(){var n=e.length>0&&void 0!==e[0]?e[0]:void 0;if(!t.isJoined())return t.logger.info("Not joined to session in room ".concat(t.roomSubset.roomId,": ignoring leave call")),!1;t.logger.info("Leaving call session in room ".concat(t.roomSubset.roomId)),t.encryptionManager.leave();var r=t.membershipManager.leave(n);return t.emit(ar.JoinStateChanged,!1),yield r}))()}getActiveFocus(){var e;return null===(e=this.membershipManager)||void 0===e?void 0:e.getActiveFocus()}getOldestMembership(){return this.memberships[0]}getFocusInUse(){var e=this.getOldestMembership();if("oldest_membership"===(null==e?void 0:e.getFocusSelection()))return e.getPreferredFoci()[0]}reemitEncryptionKeys(){var e;null===(e=this.encryptionManager)||void 0===e||e.getEncryptionKeys().forEach(((e,t)=>{e.forEach(((e,n)=>{this.emit(ar.EncryptionKeyChanged,e.key,n,t)}))}))}getEncryptionKeys(){var e,t,n=null!==(e=null===(t=this.encryptionManager)||void 0===t?void 0:t.getEncryptionKeys())&&void 0!==e?e:new Map;return Array.from(n.entries()).map((e=>{var[t,n]=e;return[t,n.map((e=>e.key))]})).values()}setExpiryTimer(){var e;for(var t of(this.expiryTimeout&&(clearTimeout(this.expiryTimeout),this.expiryTimeout=void 0),this.memberships)){var n=t.getMsUntilExpiry();void 0!==n&&(void 0===e||n<e)&&(e=n)}null!=e&&(this.expiryTimeout=setTimeout(this.onRTCSessionMemberUpdate,e))}}var Qb=function(e){return e.SessionStarted="session_started",e.SessionEnded="session_ended",e}({});class zoe extends En{constructor(e){super(),this.client=e,L(this,"roomSessions",new Map),L(this,"logger",void 0),L(this,"onRoom",(e=>{this.refreshRoom(e)})),L(this,"onRoomState",((e,t)=>{var n=this.client.getRoom(e.getRoomId());n?e.getType()==ee.GroupCallMemberPrefix&&this.refreshRoom(n):this.logger.error("Got room state event for unknown room ".concat(e.getRoomId(),"!"))})),this.logger=A.getChild("[MatrixRTCSessionManager]")}start(){for(var e of null!==(t=this.client.getRooms())&&void 0!==t?t:[]){var t,n=Nh.roomSessionForRoom(this.client,e);n.memberships.length>0&&this.roomSessions.set(e.roomId,n)}this.client.on(Oe.Room,this.onRoom),this.client.on(ut.Events,this.onRoomState)}stop(){for(var e of this.roomSessions.values())e.stop();this.roomSessions.clear(),this.client.off(Oe.Room,this.onRoom),this.client.off(ut.Events,this.onRoomState)}getActiveRoomSession(e){return this.roomSessions.get(e.roomId)}getRoomSession(e){return this.roomSessions.has(e.roomId)||this.roomSessions.set(e.roomId,Nh.roomSessionForRoom(this.client,e)),this.roomSessions.get(e.roomId)}refreshRoom(e){var t=!this.roomSessions.has(e.roomId),n=this.getRoomSession(e),r=n.memberships.length>0&&!t;n.onRTCSessionMemberUpdate();var i=n.memberships.length>0;r&&!i?(this.logger.trace("Session ended for ".concat(e.roomId," (").concat(n.memberships.length," members)")),this.emit(Qb.SessionEnded,e.roomId,this.roomSessions.get(e.roomId))):!r&&i&&(this.logger.trace("Session started for ".concat(e.roomId," (").concat(n.memberships.length," members)")),this.emit(Qb.SessionStarted,e.roomId,this.roomSessions.get(e.roomId)))}}function a2(e){return t=>{var n,r;return(null===(n=t.content)||void 0===n||null===(n=n["m.relates_to"])||void 0===n?void 0:n.event_id)!==e||(null===(r=t.content)||void 0===r||null===(r=r["m.relates_to"])||void 0===r?void 0:r.rel_type)===Zt.name}}function kH(e){return Lk.apply(this,arguments)}function Lk(){return(Lk=U((function*(e){if(!globalThis.crypto.subtle)throw new Error("Crypto.subtle is not available: insecure context?");var t=(new TextEncoder).encode(e),n=yield globalThis.crypto.subtle.digest("SHA-256",t);return new Uint8Array(n)}))).apply(this,arguments)}class Mg extends Error{}function Yoe(e){return decodeURIComponent(atob(e).replace(/(.)/g,((e,t)=>{let n=t.charCodeAt(0).toString(16).toUpperCase();return n.length<2&&(n="0"+n),"%"+n})))}function Joe(e){let t=e.replace(/-/g,"+").replace(/_/g,"/");switch(t.length%4){case 0:break;case 2:t+="==";break;case 3:t+="=";break;default:throw new Error("base64 string is not of the correct length")}try{return Yoe(t)}catch{return atob(t)}}function xH(e,t){if("string"!=typeof e)throw new Mg("Invalid token specified: must be a string");t||(t={});const n=!0===t.header?0:1,r=e.split(".")[n];if("string"!=typeof r)throw new Mg(`Invalid token specified: missing part #${n+1}`);let i;try{i=Joe(r)}catch(e){throw new Mg(`Invalid token specified: invalid base64 for part #${n+1} (${e.message})`)}try{return JSON.parse(i)}catch(e){throw new Mg(`Invalid token specified: invalid json for part #${n+1} (${e.message})`)}}Mg.prototype.name="InvalidTokenError";var la,ca,Xoe={debug:()=>{},info:()=>{},warn:()=>{},error:()=>{}},xv=(e=>(e[e.NONE=0]="NONE",e[e.ERROR=1]="ERROR",e[e.WARN=2]="WARN",e[e.INFO=3]="INFO",e[e.DEBUG=4]="DEBUG",e))(xv||{});(e=>{e.reset=function(){la=3,ca=Xoe},e.setLevel=function(e){if(!(0<=e&&e<=4))throw new Error("Invalid log level");la=e},e.setLogger=function(e){ca=e}})(xv||(xv={}));var Zn=class e{constructor(e){this._name=e}debug(...t){la>=4&&ca.debug(e._format(this._name,this._method),...t)}info(...t){la>=3&&ca.info(e._format(this._name,this._method),...t)}warn(...t){la>=2&&ca.warn(e._format(this._name,this._method),...t)}error(...t){la>=1&&ca.error(e._format(this._name,this._method),...t)}throw(e){throw this.error(e),e}create(e){const t=Object.create(this);return t._method=e,t.debug("begin"),t}static createStatic(t,n){const r=new e(`${t}.${n}`);return r.debug("begin"),r}static _format(e,t){const n=`[${e}]`;return t?`${n} ${t}:`:n}static debug(t,...n){la>=4&&ca.debug(e._format(t),...n)}static info(t,...n){la>=3&&ca.info(e._format(t),...n)}static warn(t,...n){la>=2&&ca.warn(e._format(t),...n)}static error(t,...n){la>=1&&ca.error(e._format(t),...n)}};xv.reset();var eS=class{static decode(e){try{return xH(e)}catch(e){throw Zn.error("JwtUtils.decode",e),e}}static async generateSignedJwt(e,t,n){const r=`${jo.encodeBase64Url((new TextEncoder).encode(JSON.stringify(e)))}.${jo.encodeBase64Url((new TextEncoder).encode(JSON.stringify(t)))}`,i=await window.crypto.subtle.sign({name:"ECDSA",hash:{name:"SHA-256"}},n,(new TextEncoder).encode(r));return`${r}.${jo.encodeBase64Url(new Uint8Array(i))}`}},Zoe="10000000-1000-4000-8000-100000000000",Ok=e=>btoa([...new Uint8Array(e)].map((e=>String.fromCharCode(e))).join("")),PH=class e{static _randomWord(){const e=new Uint32Array(1);return crypto.getRandomValues(e),e[0]}static generateUUIDv4(){return Zoe.replace(/[018]/g,(t=>(+t^e._randomWord()&15>>+t/4).toString(16))).replace(/-/g,"")}static generateCodeVerifier(){return e.generateUUIDv4()+e.generateUUIDv4()+e.generateUUIDv4()}static async generateCodeChallenge(e){if(!crypto.subtle)throw new Error("Crypto.subtle is available only in secure contexts (HTTPS).");try{const t=(new TextEncoder).encode(e),n=await crypto.subtle.digest("SHA-256",t);return Ok(n).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}catch(e){throw Zn.error("CryptoUtils.generateCodeChallenge",e),e}}static generateBasicAuth(e,t){const n=(new TextEncoder).encode([e,t].join(":"));return Ok(n)}static async hash(e,t){const n=(new TextEncoder).encode(t),r=await crypto.subtle.digest(e,n);return new Uint8Array(r)}static async customCalculateJwkThumbprint(t){let n;switch(t.kty){case"RSA":n={e:t.e,kty:t.kty,n:t.n};break;case"EC":n={crv:t.crv,kty:t.kty,x:t.x,y:t.y};break;case"OKP":n={crv:t.crv,kty:t.kty,x:t.x};break;case"oct":n={crv:t.k,kty:t.kty};break;default:throw new Error("Unknown jwk type")}const r=await e.hash("SHA-256",JSON.stringify(n));return e.encodeBase64Url(r)}static async generateDPoPProof({url:t,accessToken:n,httpMethod:r,keyPair:i,nonce:o}){let s,a;const l={jti:window.crypto.randomUUID(),htm:r??"GET",htu:t,iat:Math.floor(Date.now()/1e3)};n&&(s=await e.hash("SHA-256",n),a=e.encodeBase64Url(s),l.ath=a),o&&(l.nonce=o);try{const e=await crypto.subtle.exportKey("jwk",i.publicKey),t={alg:"ES256",typ:"dpop+jwt",jwk:{crv:e.crv,kty:e.kty,x:e.x,y:e.y}};return await eS.generateSignedJwt(t,l,i.privateKey)}catch(e){throw e instanceof TypeError?new Error(`Error exporting dpop public key: ${e.message}`):e}}static async generateDPoPJkt(t){try{const n=await crypto.subtle.exportKey("jwk",t.publicKey);return await e.customCalculateJwkThumbprint(n)}catch(e){throw e instanceof TypeError?new Error(`Could not retrieve dpop keys from storage: ${e.message}`):e}}static async generateDPoPKeys(){return await window.crypto.subtle.generateKey({name:"ECDSA",namedCurve:"P-256"},!1,["sign","verify"])}};PH.encodeBase64Url=e=>Ok(e).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_");var jo=PH,Qoe=class{constructor(e){this._name=e,this._callbacks=[],this._logger=new Zn(`Event('${this._name}')`)}addHandler(e){return this._callbacks.push(e),()=>this.removeHandler(e)}removeHandler(e){const t=this._callbacks.lastIndexOf(e);t>=0&&this._callbacks.splice(t,1)}async raise(...e){this._logger.debug("raise:",...e);for(const t of this._callbacks)await t(...e)}},tS=class e extends Qoe{constructor(){super(...arguments),this._logger=new Zn(`Timer('${this._name}')`),this._timerHandle=null,this._expiration=0,this._callback=()=>{const t=this._expiration-e.getEpochTime();this._logger.debug("timer completes in",t),this._expiration<=e.getEpochTime()&&(this.cancel(),super.raise())}}static getEpochTime(){return Math.floor(Date.now()/1e3)}init(t){const n=this._logger.create("init");t=Math.max(Math.floor(t),1);const r=e.getEpochTime()+t;if(this.expiration===r&&this._timerHandle)return void n.debug("skipping since already initialized for expiration at",this.expiration);this.cancel(),n.debug("using duration",t),this._expiration=r;const i=Math.min(t,5);this._timerHandle=setInterval(this._callback,1e3*i)}get expiration(){return this._expiration}cancel(){this._logger.create("cancel"),this._timerHandle&&(clearInterval(this._timerHandle),this._timerHandle=null)}},wN=class{static readParams(e,t="query"){if(!e)throw new TypeError("Invalid URL");const n=new URL(e,"http://127.0.0.1")["fragment"===t?"hash":"search"];return new URLSearchParams(n.slice(1))}},Mk=";",lp=class extends Error{constructor(e,t){var n,r,i;if(super(e.error_description||e.error||""),this.form=t,this.name="ErrorResponse",!e.error)throw Zn.error("ErrorResponse","No error passed"),new Error("No error passed");this.error=e.error,this.error_description=null!=(n=e.error_description)?n:null,this.error_uri=null!=(r=e.error_uri)?r:null,this.state=e.userState,this.session_state=null!=(i=e.session_state)?i:null,this.url_state=e.url_state}},eae=class extends Error{constructor(e){super(e),this.name="ErrorTimeout"}},tae=class{constructor(){this._logger=new Zn("InMemoryWebStorage"),this._data={}}clear(){this._logger.create("clear"),this._data={}}getItem(e){return this._logger.create(`getItem('${e}')`),this._data[e]}setItem(e,t){this._logger.create(`setItem('${e}')`),this._data[e]=t}removeItem(e){this._logger.create(`removeItem('${e}')`),delete this._data[e]}get length(){return Object.getOwnPropertyNames(this._data).length}key(e){return Object.getOwnPropertyNames(this._data)[e]}},Ak=class extends Error{constructor(e,t){super(t),this.name="ErrorDPoPNonce",this.nonce=e}},QP=class{constructor(e=[],t=null,n={}){this._jwtHandler=t,this._extraHeaders=n,this._logger=new Zn("JsonService"),this._contentTypes=[],this._contentTypes.push(...e,"application/json"),t&&this._contentTypes.push("application/jwt")}async fetchWithTimeout(e,t={}){const{timeoutInSeconds:n,...r}=t;if(!n)return await fetch(e,r);const i=new AbortController,o=setTimeout((()=>i.abort()),1e3*n);try{return await fetch(e,{...t,signal:i.signal})}catch(e){throw e instanceof DOMException&&"AbortError"===e.name?new eae("Network timed out"):e}finally{clearTimeout(o)}}async getJson(e,{token:t,credentials:n,timeoutInSeconds:r}={}){const i=this._logger.create("getJson"),o={Accept:this._contentTypes.join(", ")};let s;t&&(i.debug("token passed, setting Authorization header"),o.Authorization="Bearer "+t),this.appendExtraHeaders(o);try{i.debug("url:",e),s=await this.fetchWithTimeout(e,{method:"GET",headers:o,timeoutInSeconds:r,credentials:n})}catch(e){throw i.error("Network Error"),e}i.debug("HTTP response received, status",s.status);const a=s.headers.get("Content-Type");if(a&&!this._contentTypes.find((e=>a.startsWith(e)))&&i.throw(new Error(`Invalid response Content-Type: ${a??"undefined"}, from URL: ${e}`)),s.ok&&this._jwtHandler&&null!=a&&a.startsWith("application/jwt"))return await this._jwtHandler(await s.text());let l;try{l=await s.json()}catch(e){throw i.error("Error parsing JSON response",e),s.ok?e:new Error(`${s.statusText} (${s.status})`)}if(!s.ok)throw i.error("Error from server:",l),l.error?new lp(l):new Error(`${s.statusText} (${s.status}): ${JSON.stringify(l)}`);return l}async postForm(e,{body:t,basicAuth:n,timeoutInSeconds:r,initCredentials:i,extraHeaders:o}){const s=this._logger.create("postForm"),a={Accept:this._contentTypes.join(", "),"Content-Type":"application/x-www-form-urlencoded",...o};let l;void 0!==n&&(a.Authorization="Basic "+n),this.appendExtraHeaders(a);try{s.debug("url:",e),l=await this.fetchWithTimeout(e,{method:"POST",headers:a,body:t,timeoutInSeconds:r,credentials:i})}catch(e){throw s.error("Network error"),e}s.debug("HTTP response received, status",l.status);const c=l.headers.get("Content-Type");if(c&&!this._contentTypes.find((e=>c.startsWith(e))))throw new Error(`Invalid response Content-Type: ${c??"undefined"}, from URL: ${e}`);const u=await l.text();let d={};if(u)try{d=JSON.parse(u)}catch(e){throw s.error("Error parsing JSON response",e),l.ok?e:new Error(`${l.statusText} (${l.status})`)}if(!l.ok){if(s.error("Error from server:",d),l.headers.has("dpop-nonce")){const e=l.headers.get("dpop-nonce");throw new Ak(e,`${JSON.stringify(d)}`)}throw d.error?new lp(d,t):new Error(`${l.statusText} (${l.status}): ${JSON.stringify(d)}`)}return d}appendExtraHeaders(e){const t=this._logger.create("appendExtraHeaders"),n=Object.keys(this._extraHeaders),r=["authorization","accept","content-type"];0!==n.length&&n.forEach((n=>{if(r.includes(n.toLocaleLowerCase()))return void t.warn("Protected header could not be overridden",n,r);const i="function"==typeof this._extraHeaders[n]?this._extraHeaders[n]():this._extraHeaders[n];i&&""!==i&&(e[n]=i)}))}},LH=class{constructor(e){this._settings=e,this._logger=new Zn("MetadataService"),this._signingKeys=null,this._metadata=null,this._metadataUrl=this._settings.metadataUrl,this._jsonService=new QP(["application/jwk-set+json"],null,this._settings.extraHeaders),this._settings.signingKeys&&(this._logger.debug("using signingKeys from settings"),this._signingKeys=this._settings.signingKeys),this._settings.metadata&&(this._logger.debug("using metadata from settings"),this._metadata=this._settings.metadata),this._settings.fetchRequestCredentials&&(this._logger.debug("using fetchRequestCredentials from settings"),this._fetchRequestCredentials=this._settings.fetchRequestCredentials)}resetSigningKeys(){this._signingKeys=null}async getMetadata(){const e=this._logger.create("getMetadata");if(this._metadata)return e.debug("using cached values"),this._metadata;if(!this._metadataUrl)throw e.throw(new Error("No authority or metadataUrl configured on settings")),null;e.debug("getting metadata from",this._metadataUrl);const t=await this._jsonService.getJson(this._metadataUrl,{credentials:this._fetchRequestCredentials,timeoutInSeconds:this._settings.requestTimeoutInSeconds});return e.debug("merging remote JSON with seed metadata"),this._metadata=Object.assign({},this._settings.metadataSeed,t),this._metadata}getIssuer(){return this._getMetadataProperty("issuer")}getAuthorizationEndpoint(){return this._getMetadataProperty("authorization_endpoint")}getUserInfoEndpoint(){return this._getMetadataProperty("userinfo_endpoint")}getTokenEndpoint(e=!0){return this._getMetadataProperty("token_endpoint",e)}getCheckSessionIframe(){return this._getMetadataProperty("check_session_iframe",!0)}getEndSessionEndpoint(){return this._getMetadataProperty("end_session_endpoint",!0)}getRevocationEndpoint(e=!0){return this._getMetadataProperty("revocation_endpoint",e)}getKeysEndpoint(e=!0){return this._getMetadataProperty("jwks_uri",e)}async _getMetadataProperty(e,t=!1){const n=this._logger.create(`_getMetadataProperty('${e}')`),r=await this.getMetadata();if(n.debug("resolved"),void 0===r[e]){if(!0===t)return void n.warn("Metadata does not contain optional property");n.throw(new Error("Metadata does not contain property "+e))}return r[e]}async getSigningKeys(){const e=this._logger.create("getSigningKeys");if(this._signingKeys)return e.debug("returning signingKeys from cache"),this._signingKeys;const t=await this.getKeysEndpoint(!1);e.debug("got jwks_uri",t);const n=await this._jsonService.getJson(t,{timeoutInSeconds:this._settings.requestTimeoutInSeconds});if(e.debug("got key set",n),!Array.isArray(n.keys))throw e.throw(new Error("Missing keys on keyset")),null;return this._signingKeys=n.keys,this._signingKeys}},NE=class{constructor({prefix:e="oidc.",store:t=localStorage}={}){this._logger=new Zn("WebStorageStateStore"),this._store=t,this._prefix=e}async set(e,t){this._logger.create(`set('${e}')`),e=this._prefix+e,await this._store.setItem(e,t)}async get(e){return this._logger.create(`get('${e}')`),e=this._prefix+e,await this._store.getItem(e)}async remove(e){this._logger.create(`remove('${e}')`),e=this._prefix+e;const t=await this._store.getItem(e);return await this._store.removeItem(e),t}async getAllKeys(){this._logger.create("getAllKeys");const e=await this._store.length,t=[];for(let n=0;n<e;n++){const e=await this._store.key(n);e&&0===e.indexOf(this._prefix)&&t.push(e.substr(this._prefix.length))}return t}},nae="code",rae="openid",iae="client_secret_post",sae=900,Nk=class{constructor({authority:e,metadataUrl:t,metadata:n,signingKeys:r,metadataSeed:i,client_id:o,client_secret:s,response_type:a=nae,scope:l=rae,redirect_uri:c,post_logout_redirect_uri:u,client_authentication:d=iae,prompt:h,display:p,max_age:f,ui_locales:m,acr_values:v,resource:g,response_mode:y,filterProtocolClaims:b=!0,loadUserInfo:_=!1,requestTimeoutInSeconds:w,staleStateAgeInSeconds:E=sae,mergeClaimsStrategy:S={array:"replace"},disablePKCE:C=!1,stateStore:k,revokeTokenAdditionalContentTypes:T,fetchRequestCredentials:I,refreshTokenAllowedScope:R,extraQueryParams:x={},extraTokenParams:L={},extraHeaders:P={},dpop:O,omitScopeWhenRequesting:A=!1}){var M;if(this.authority=e,t?this.metadataUrl=t:(this.metadataUrl=e,e&&(this.metadataUrl.endsWith("/")||(this.metadataUrl+="/"),this.metadataUrl+=".well-known/openid-configuration")),this.metadata=n,this.metadataSeed=i,this.signingKeys=r,this.client_id=o,this.client_secret=s,this.response_type=a,this.scope=l,this.redirect_uri=c,this.post_logout_redirect_uri=u,this.client_authentication=d,this.prompt=h,this.display=p,this.max_age=f,this.ui_locales=m,this.acr_values=v,this.resource=g,this.response_mode=y,this.filterProtocolClaims=b??!0,this.loadUserInfo=!!_,this.staleStateAgeInSeconds=E,this.mergeClaimsStrategy=S,this.omitScopeWhenRequesting=A,this.disablePKCE=!!C,this.revokeTokenAdditionalContentTypes=T,this.fetchRequestCredentials=I||"same-origin",this.requestTimeoutInSeconds=w,k)this.stateStore=k;else{const e=typeof window<"u"?window.localStorage:new tae;this.stateStore=new NE({store:e})}if(this.refreshTokenAllowedScope=R,this.extraQueryParams=x,this.extraTokenParams=L,this.extraHeaders=P,this.dpop=O,this.dpop&&(null==(M=this.dpop)||!M.store))throw new Error("A DPoPStore is required when dpop is enabled")}},oae=class{constructor(e,t){this._settings=e,this._metadataService=t,this._logger=new Zn("UserInfoService"),this._getClaimsFromJwt=async e=>{const t=this._logger.create("_getClaimsFromJwt");try{const n=eS.decode(e);return t.debug("JWT decoding successful"),n}catch(e){throw t.error("Error parsing JWT response"),e}},this._jsonService=new QP(void 0,this._getClaimsFromJwt,this._settings.extraHeaders)}async getClaims(e){const t=this._logger.create("getClaims");e||this._logger.throw(new Error("No token passed"));const n=await this._metadataService.getUserInfoEndpoint();t.debug("got userinfo url",n);const r=await this._jsonService.getJson(n,{token:e,credentials:this._settings.fetchRequestCredentials,timeoutInSeconds:this._settings.requestTimeoutInSeconds});return t.debug("got claims",r),r}},OH=class{constructor(e,t){this._settings=e,this._metadataService=t,this._logger=new Zn("TokenClient"),this._jsonService=new QP(this._settings.revokeTokenAdditionalContentTypes,null,this._settings.extraHeaders)}async exchangeCode({grant_type:e="authorization_code",redirect_uri:t=this._settings.redirect_uri,client_id:n=this._settings.client_id,client_secret:r=this._settings.client_secret,extraHeaders:i,...o}){const s=this._logger.create("exchangeCode");n||s.throw(new Error("A client_id is required")),t||s.throw(new Error("A redirect_uri is required")),o.code||s.throw(new Error("A code is required"));const a=new URLSearchParams({grant_type:e,redirect_uri:t});for(const[e,t]of Object.entries(o))null!=t&&a.set(e,t);let l;switch(this._settings.client_authentication){case"client_secret_basic":if(!r)throw s.throw(new Error("A client_secret is required")),null;l=jo.generateBasicAuth(n,r);break;case"client_secret_post":a.append("client_id",n),r&&a.append("client_secret",r)}const c=await this._metadataService.getTokenEndpoint(!1);s.debug("got token endpoint");const u=await this._jsonService.postForm(c,{body:a,basicAuth:l,timeoutInSeconds:this._settings.requestTimeoutInSeconds,initCredentials:this._settings.fetchRequestCredentials,extraHeaders:i});return s.debug("got response"),u}async exchangeCredentials({grant_type:e="password",client_id:t=this._settings.client_id,client_secret:n=this._settings.client_secret,scope:r=this._settings.scope,...i}){const o=this._logger.create("exchangeCredentials");t||o.throw(new Error("A client_id is required"));const s=new URLSearchParams({grant_type:e});this._settings.omitScopeWhenRequesting||s.set("scope",r);for(const[e,t]of Object.entries(i))null!=t&&s.set(e,t);let a;switch(this._settings.client_authentication){case"client_secret_basic":if(!n)throw o.throw(new Error("A client_secret is required")),null;a=jo.generateBasicAuth(t,n);break;case"client_secret_post":s.append("client_id",t),n&&s.append("client_secret",n)}const l=await this._metadataService.getTokenEndpoint(!1);o.debug("got token endpoint");const c=await this._jsonService.postForm(l,{body:s,basicAuth:a,timeoutInSeconds:this._settings.requestTimeoutInSeconds,initCredentials:this._settings.fetchRequestCredentials});return o.debug("got response"),c}async exchangeRefreshToken({grant_type:e="refresh_token",client_id:t=this._settings.client_id,client_secret:n=this._settings.client_secret,timeoutInSeconds:r,extraHeaders:i,...o}){const s=this._logger.create("exchangeRefreshToken");t||s.throw(new Error("A client_id is required")),o.refresh_token||s.throw(new Error("A refresh_token is required"));const a=new URLSearchParams({grant_type:e});for(const[e,t]of Object.entries(o))Array.isArray(t)?t.forEach((t=>a.append(e,t))):null!=t&&a.set(e,t);let l;switch(this._settings.client_authentication){case"client_secret_basic":if(!n)throw s.throw(new Error("A client_secret is required")),null;l=jo.generateBasicAuth(t,n);break;case"client_secret_post":a.append("client_id",t),n&&a.append("client_secret",n)}const c=await this._metadataService.getTokenEndpoint(!1);s.debug("got token endpoint");const u=await this._jsonService.postForm(c,{body:a,basicAuth:l,timeoutInSeconds:r,initCredentials:this._settings.fetchRequestCredentials,extraHeaders:i});return s.debug("got response"),u}async revoke(e){var t;const n=this._logger.create("revoke");e.token||n.throw(new Error("A token is required"));const r=await this._metadataService.getRevocationEndpoint(!1);n.debug(`got revocation endpoint, revoking ${null!=(t=e.token_type_hint)?t:"default token type"}`);const i=new URLSearchParams;for(const[t,n]of Object.entries(e))null!=n&&i.set(t,n);i.set("client_id",this._settings.client_id),this._settings.client_secret&&i.set("client_secret",this._settings.client_secret),await this._jsonService.postForm(r,{body:i,timeoutInSeconds:this._settings.requestTimeoutInSeconds}),n.debug("got response")}},aae=class{constructor(e,t,n){this._settings=e,this._metadataService=t,this._claimsService=n,this._logger=new Zn("ResponseValidator"),this._userInfoService=new oae(this._settings,this._metadataService),this._tokenClient=new OH(this._settings,this._metadataService)}async validateSigninResponse(e,t,n){const r=this._logger.create("validateSigninResponse");this._processSigninState(e,t),r.debug("state processed"),await this._processCode(e,t,n),r.debug("code processed"),e.isOpenId&&this._validateIdTokenAttributes(e),r.debug("tokens validated"),await this._processClaims(e,null==t?void 0:t.skipUserInfo,e.isOpenId),r.debug("claims processed")}async validateCredentialsResponse(e,t){const n=this._logger.create("validateCredentialsResponse");e.isOpenId&&e.id_token&&this._validateIdTokenAttributes(e),n.debug("tokens validated"),await this._processClaims(e,t,e.isOpenId),n.debug("claims processed")}async validateRefreshResponse(e,t){const n=this._logger.create("validateRefreshResponse");e.userState=t.data,null!=e.session_state||(e.session_state=t.session_state),null!=e.scope||(e.scope=t.scope),e.isOpenId&&e.id_token&&(this._validateIdTokenAttributes(e,t.id_token),n.debug("ID Token validated")),e.id_token||(e.id_token=t.id_token,e.profile=t.profile);const r=e.isOpenId&&!!e.id_token;await this._processClaims(e,!1,r),n.debug("claims processed")}validateSignoutResponse(e,t){const n=this._logger.create("validateSignoutResponse");if(t.id!==e.state&&n.throw(new Error("State does not match")),n.debug("state validated"),e.userState=t.data,e.error)throw n.warn("Response was error",e.error),new lp(e)}_processSigninState(e,t){const n=this._logger.create("_processSigninState");if(t.id!==e.state&&n.throw(new Error("State does not match")),t.client_id||n.throw(new Error("No client_id on state")),t.authority||n.throw(new Error("No authority on state")),this._settings.authority!==t.authority&&n.throw(new Error("authority mismatch on settings vs. signin state")),this._settings.client_id&&this._settings.client_id!==t.client_id&&n.throw(new Error("client_id mismatch on settings vs. signin state")),n.debug("state validated"),e.userState=t.data,e.url_state=t.url_state,null!=e.scope||(e.scope=t.scope),e.error)throw n.warn("Response was error",e.error),new lp(e);t.code_verifier&&!e.code&&n.throw(new Error("Expected code in response"))}async _processClaims(e,t=!1,n=!0){const r=this._logger.create("_processClaims");if(e.profile=this._claimsService.filterProtocolClaims(e.profile),t||!this._settings.loadUserInfo||!e.access_token)return void r.debug("not loading user info");r.debug("loading user info");const i=await this._userInfoService.getClaims(e.access_token);r.debug("user info claims received from user info endpoint"),n&&i.sub!==e.profile.sub&&r.throw(new Error("subject from UserInfo response does not match subject in ID Token")),e.profile=this._claimsService.mergeClaims(e.profile,this._claimsService.filterProtocolClaims(i)),r.debug("user info claims received, updated profile:",e.profile)}async _processCode(e,t,n){const r=this._logger.create("_processCode");if(e.code){r.debug("Validating code");const i=await this._tokenClient.exchangeCode({client_id:t.client_id,client_secret:t.client_secret,code:e.code,redirect_uri:t.redirect_uri,code_verifier:t.code_verifier,extraHeaders:n,...t.extraTokenParams});Object.assign(e,i)}else r.debug("No code to process")}_validateIdTokenAttributes(e,t){var n;const r=this._logger.create("_validateIdTokenAttributes");r.debug("decoding ID Token JWT");const i=eS.decode(null!=(n=e.id_token)?n:"");if(i.sub||r.throw(new Error("ID Token is missing a subject claim")),t){const e=eS.decode(t);i.sub!==e.sub&&r.throw(new Error("sub in id_token does not match current sub")),i.auth_time&&i.auth_time!==e.auth_time&&r.throw(new Error("auth_time in id_token does not match original auth_time")),i.azp&&i.azp!==e.azp&&r.throw(new Error("azp in id_token does not match original azp")),!i.azp&&e.azp&&r.throw(new Error("azp not in id_token, but present in original id_token"))}e.profile=i}},nS=class e{constructor(e){this.id=e.id||jo.generateUUIDv4(),this.data=e.data,e.created&&e.created>0?this.created=e.created:this.created=tS.getEpochTime(),this.request_type=e.request_type,this.url_state=e.url_state}toStorageString(){return new Zn("State").create("toStorageString"),JSON.stringify({id:this.id,data:this.data,created:this.created,request_type:this.request_type,url_state:this.url_state})}static fromStorageString(t){return Zn.createStatic("State","fromStorageString"),Promise.resolve(new e(JSON.parse(t)))}static async clearStaleState(t,n){const r=Zn.createStatic("State","clearStaleState"),i=tS.getEpochTime()-n,o=await t.getAllKeys();r.debug("got keys",o);for(let n=0;n<o.length;n++){const s=o[n],a=await t.get(s);let l=!1;if(a)try{const t=await e.fromStorageString(a);r.debug("got item from key:",s,t.created),t.created<=i&&(l=!0)}catch(e){r.error("Error parsing state for key:",s,e),l=!0}else r.debug("no item in storage for key:",s),l=!0;l&&(r.debug("removed item for key:",s),t.remove(s))}}},eL=class e extends nS{constructor(e){super(e),this.code_verifier=e.code_verifier,this.code_challenge=e.code_challenge,this.authority=e.authority,this.client_id=e.client_id,this.redirect_uri=e.redirect_uri,this.scope=e.scope,this.client_secret=e.client_secret,this.extraTokenParams=e.extraTokenParams,this.response_mode=e.response_mode,this.skipUserInfo=e.skipUserInfo}static async create(t){const n=!0===t.code_verifier?jo.generateCodeVerifier():t.code_verifier||void 0,r=n?await jo.generateCodeChallenge(n):void 0;return new e({...t,code_verifier:n,code_challenge:r})}toStorageString(){return new Zn("SigninState").create("toStorageString"),JSON.stringify({id:this.id,data:this.data,created:this.created,request_type:this.request_type,url_state:this.url_state,code_verifier:this.code_verifier,authority:this.authority,client_id:this.client_id,redirect_uri:this.redirect_uri,scope:this.scope,client_secret:this.client_secret,extraTokenParams:this.extraTokenParams,response_mode:this.response_mode,skipUserInfo:this.skipUserInfo})}static fromStorageString(t){Zn.createStatic("SigninState","fromStorageString");const n=JSON.parse(t);return e.create(n)}},MH=class e{constructor(e){this.url=e.url,this.state=e.state}static async create({url:t,authority:n,client_id:r,redirect_uri:i,response_type:o,scope:s,state_data:a,response_mode:l,request_type:c,client_secret:u,nonce:d,url_state:h,resource:p,skipUserInfo:f,extraQueryParams:m,extraTokenParams:v,disablePKCE:g,dpopJkt:y,omitScopeWhenRequesting:b,..._}){if(!t)throw this._logger.error("create: No url passed"),new Error("url");if(!r)throw this._logger.error("create: No client_id passed"),new Error("client_id");if(!i)throw this._logger.error("create: No redirect_uri passed"),new Error("redirect_uri");if(!o)throw this._logger.error("create: No response_type passed"),new Error("response_type");if(!s)throw this._logger.error("create: No scope passed"),new Error("scope");if(!n)throw this._logger.error("create: No authority passed"),new Error("authority");const w=await eL.create({data:a,request_type:c,url_state:h,code_verifier:!g,client_id:r,authority:n,redirect_uri:i,response_mode:l,client_secret:u,scope:s,extraTokenParams:v,skipUserInfo:f}),E=new URL(t);E.searchParams.append("client_id",r),E.searchParams.append("redirect_uri",i),E.searchParams.append("response_type",o),b||E.searchParams.append("scope",s),d&&E.searchParams.append("nonce",d),y&&E.searchParams.append("dpop_jkt",y);let S=w.id;h&&(S=`${S}${Mk}${h}`),E.searchParams.append("state",S),w.code_challenge&&(E.searchParams.append("code_challenge",w.code_challenge),E.searchParams.append("code_challenge_method","S256")),p&&(Array.isArray(p)?p:[p]).forEach((e=>E.searchParams.append("resource",e)));for(const[e,t]of Object.entries({response_mode:l,..._,...m}))null!=t&&E.searchParams.append(e,t.toString());return new e({url:E.href,state:w})}};MH._logger=new Zn("SigninRequest");var lae=MH,cae="openid",$_=class{constructor(e){if(this.access_token="",this.token_type="",this.profile={},this.state=e.get("state"),this.session_state=e.get("session_state"),this.state){const e=decodeURIComponent(this.state).split(Mk);this.state=e[0],e.length>1&&(this.url_state=e.slice(1).join(Mk))}this.error=e.get("error"),this.error_description=e.get("error_description"),this.error_uri=e.get("error_uri"),this.code=e.get("code")}get expires_in(){if(void 0!==this.expires_at)return this.expires_at-tS.getEpochTime()}set expires_in(e){"string"==typeof e&&(e=Number(e)),void 0!==e&&e>=0&&(this.expires_at=Math.floor(e)+tS.getEpochTime())}get isOpenId(){var e;return(null==(e=this.scope)?void 0:e.split(" ").includes(cae))||!!this.id_token}},uae=class{constructor({url:e,state_data:t,id_token_hint:n,post_logout_redirect_uri:r,extraQueryParams:i,request_type:o,client_id:s}){if(this._logger=new Zn("SignoutRequest"),!e)throw this._logger.error("ctor: No url passed"),new Error("url");const a=new URL(e);n&&a.searchParams.append("id_token_hint",n),s&&a.searchParams.append("client_id",s),r&&(a.searchParams.append("post_logout_redirect_uri",r),t&&(this.state=new nS({data:t,request_type:o}),a.searchParams.append("state",this.state.id)));for(const[e,t]of Object.entries({...i}))null!=t&&a.searchParams.append(e,t.toString());this.url=a.href}},dae=class{constructor(e){this.state=e.get("state"),this.error=e.get("error"),this.error_description=e.get("error_description"),this.error_uri=e.get("error_uri")}},fae=["nbf","jti","auth_time","nonce","acr","amr","azp","at_hash"],hae=["sub","iss","aud","exp","iat"],pae=class{constructor(e){this._settings=e,this._logger=new Zn("ClaimsService")}filterProtocolClaims(e){const t={...e};if(this._settings.filterProtocolClaims){let e;e=Array.isArray(this._settings.filterProtocolClaims)?this._settings.filterProtocolClaims:fae;for(const n of e)hae.includes(n)||delete t[n]}return t}mergeClaims(e,t){const n={...e};for(const[e,r]of Object.entries(t))if(n[e]!==r)if(Array.isArray(n[e])||Array.isArray(r))if("replace"==this._settings.mergeClaimsStrategy.array)n[e]=r;else{const t=Array.isArray(n[e])?n[e]:[n[e]];for(const e of Array.isArray(r)?r:[r])t.includes(e)||t.push(e);n[e]=t}else"object"==typeof n[e]&&"object"==typeof r?n[e]=this.mergeClaims(n[e],r):n[e]=r;return n}},mae=class{constructor(e,t){this.keys=e,this.nonce=t}},tL=class{constructor(e,t){this._logger=new Zn("OidcClient"),this.settings=e instanceof Nk?e:new Nk(e),this.metadataService=t??new LH(this.settings),this._claimsService=new pae(this.settings),this._validator=new aae(this.settings,this.metadataService,this._claimsService),this._tokenClient=new OH(this.settings,this.metadataService)}async createSigninRequest({state:e,request:t,request_uri:n,request_type:r,id_token_hint:i,login_hint:o,skipUserInfo:s,nonce:a,url_state:l,response_type:c=this.settings.response_type,scope:u=this.settings.scope,redirect_uri:d=this.settings.redirect_uri,prompt:h=this.settings.prompt,display:p=this.settings.display,max_age:f=this.settings.max_age,ui_locales:m=this.settings.ui_locales,acr_values:v=this.settings.acr_values,resource:g=this.settings.resource,response_mode:y=this.settings.response_mode,extraQueryParams:b=this.settings.extraQueryParams,extraTokenParams:_=this.settings.extraTokenParams,dpopJkt:w,omitScopeWhenRequesting:E=this.settings.omitScopeWhenRequesting}){const S=this._logger.create("createSigninRequest");if("code"!==c)throw new Error("Only the Authorization Code flow (with PKCE) is supported");const C=await this.metadataService.getAuthorizationEndpoint();S.debug("Received authorization endpoint",C);const k=await lae.create({url:C,authority:this.settings.authority,client_id:this.settings.client_id,redirect_uri:d,response_type:c,scope:u,state_data:e,url_state:l,prompt:h,display:p,max_age:f,ui_locales:m,id_token_hint:i,login_hint:o,acr_values:v,dpopJkt:w,resource:g,request:t,request_uri:n,extraQueryParams:b,extraTokenParams:_,request_type:r,response_mode:y,client_secret:this.settings.client_secret,skipUserInfo:s,nonce:a,disablePKCE:this.settings.disablePKCE,omitScopeWhenRequesting:E});await this.clearStaleState();const T=k.state;return await this.settings.stateStore.set(T.id,T.toStorageString()),k}async readSigninResponseState(e,t=!1){const n=this._logger.create("readSigninResponseState"),r=new $_(wN.readParams(e,this.settings.response_mode));if(!r.state)throw n.throw(new Error("No state in response")),null;const i=await this.settings.stateStore[t?"remove":"get"](r.state);if(!i)throw n.throw(new Error("No matching state found in storage")),null;return{state:await eL.fromStorageString(i),response:r}}async processSigninResponse(e,t){const n=this._logger.create("processSigninResponse"),{state:r,response:i}=await this.readSigninResponseState(e,!0);if(n.debug("received state from storage; validating response"),this.settings.dpop&&this.settings.dpop.store){const e=await this.getDpopProof(this.settings.dpop.store);t={...t,DPoP:e}}try{await this._validator.validateSigninResponse(i,r,t)}catch(e){if(!(e instanceof Ak&&this.settings.dpop))throw e;{const n=await this.getDpopProof(this.settings.dpop.store,e.nonce);t.DPoP=n,await this._validator.validateSigninResponse(i,r,t)}}return i}async getDpopProof(e,t){let n,r;return(await e.getAllKeys()).includes(this.settings.client_id)?(r=await e.get(this.settings.client_id),r.nonce!==t&&t&&(r.nonce=t,await e.set(this.settings.client_id,r))):(n=await jo.generateDPoPKeys(),r=new mae(n,t),await e.set(this.settings.client_id,r)),await jo.generateDPoPProof({url:await this.metadataService.getTokenEndpoint(!1),httpMethod:"POST",keyPair:r.keys,nonce:r.nonce})}async processResourceOwnerPasswordCredentials({username:e,password:t,skipUserInfo:n=!1,extraTokenParams:r={}}){const i=await this._tokenClient.exchangeCredentials({username:e,password:t,...r}),o=new $_(new URLSearchParams);return Object.assign(o,i),await this._validator.validateCredentialsResponse(o,n),o}async useRefreshToken({state:e,redirect_uri:t,resource:n,timeoutInSeconds:r,extraHeaders:i,extraTokenParams:o}){var s;const a=this._logger.create("useRefreshToken");let l,c;if(void 0===this.settings.refreshTokenAllowedScope)l=e.scope;else{const t=this.settings.refreshTokenAllowedScope.split(" ");l=((null==(s=e.scope)?void 0:s.split(" "))||[]).filter((e=>t.includes(e))).join(" ")}if(this.settings.dpop&&this.settings.dpop.store){const e=await this.getDpopProof(this.settings.dpop.store);i={...i,DPoP:e}}try{c=await this._tokenClient.exchangeRefreshToken({refresh_token:e.refresh_token,scope:l,redirect_uri:t,resource:n,timeoutInSeconds:r,extraHeaders:i,...o})}catch(s){if(!(s instanceof Ak&&this.settings.dpop))throw s;i.DPoP=await this.getDpopProof(this.settings.dpop.store,s.nonce),c=await this._tokenClient.exchangeRefreshToken({refresh_token:e.refresh_token,scope:l,redirect_uri:t,resource:n,timeoutInSeconds:r,extraHeaders:i,...o})}const u=new $_(new URLSearchParams);return Object.assign(u,c),a.debug("validating response",u),await this._validator.validateRefreshResponse(u,{...e,scope:l}),u}async createSignoutRequest({state:e,id_token_hint:t,client_id:n,request_type:r,post_logout_redirect_uri:i=this.settings.post_logout_redirect_uri,extraQueryParams:o=this.settings.extraQueryParams}={}){const s=this._logger.create("createSignoutRequest"),a=await this.metadataService.getEndSessionEndpoint();if(!a)throw s.throw(new Error("No end session endpoint")),null;s.debug("Received end session endpoint",a),!n&&i&&!t&&(n=this.settings.client_id);const l=new uae({url:a,id_token_hint:t,client_id:n,post_logout_redirect_uri:i,state_data:e,extraQueryParams:o,request_type:r});await this.clearStaleState();const c=l.state;return c&&(s.debug("Signout request has state to persist"),await this.settings.stateStore.set(c.id,c.toStorageString())),l}async readSignoutResponseState(e,t=!1){const n=this._logger.create("readSignoutResponseState"),r=new dae(wN.readParams(e,this.settings.response_mode));if(!r.state){if(n.debug("No state in response"),r.error)throw n.warn("Response was error:",r.error),new lp(r);return{state:void 0,response:r}}const i=await this.settings.stateStore[t?"remove":"get"](r.state);if(!i)throw n.throw(new Error("No matching state found in storage")),null;return{state:await nS.fromStorageString(i),response:r}}async processSignoutResponse(e){const t=this._logger.create("processSignoutResponse"),{state:n,response:r}=await this.readSignoutResponseState(e,!0);return n?(t.debug("Received state from storage; validating response"),this._validator.validateSignoutResponse(r,n)):t.debug("No state from storage; skipping response validation"),r}clearStaleState(){return this._logger.create("clearStaleState"),nS.clearStaleState(this.settings.stateStore,this.settings.staleStateAgeInSeconds)}async revokeToken(e,t){return this._logger.create("revokeToken"),await this._tokenClient.revoke({token:e,token_type_hint:t})}},li=function(e){return e.NotSupported="OIDC authentication not supported",e.Misconfigured="OIDC is misconfigured",e.General="Something went wrong with OIDC discovery",e.OpSupport="Configured OIDC OP does not support required functions",e.DynamicRegistrationNotSupported="Dynamic registration not supported",e.DynamicRegistrationFailed="Dynamic registration failed",e.DynamicRegistrationInvalid="Dynamic registration invalid response",e.CodeExchangeFailed="Failed to exchange code for token",e.InvalidBearerTokenResponse="Invalid bearer token response",e.InvalidIdToken="Invalid ID token",e.MissingOrInvalidStoredState="State required to finish logging in is not found in storage.",e}({}),nL=e=>!!e&&"object"==typeof e&&!Array.isArray(e),bl=(e,t)=>!(!e[t]||!Wg(e,t))||(A.error("Missing or invalid property: ".concat(t)),!1),Wg=(e,t)=>!e[t]||"string"==typeof e[t]||(A.error("Invalid property: ".concat(t)),!1),CN=(e,t)=>!!(!e[t]||Array.isArray(e[t])&&e[t].every((e=>"string"==typeof e)))||(A.error("Invalid property: ".concat(t)),!1),l2=(e,t,n)=>{var r=e[t];return!!(r&&Array.isArray(r)&&r.includes(n))||(A.error("Invalid property: ".concat(t,". ").concat(n," is required.")),!1)},NH=e=>{if(!nL(e))throw A.error("Issuer configuration not found or malformed"),new Error(li.OpSupport);if(![bl(e,"issuer"),bl(e,"authorization_endpoint"),bl(e,"token_endpoint"),bl(e,"revocation_endpoint"),Wg(e,"registration_endpoint"),Wg(e,"account_management_uri"),Wg(e,"device_authorization_endpoint"),CN(e,"account_management_actions_supported"),l2(e,"response_types_supported","code"),l2(e,"grant_types_supported","authorization_code"),l2(e,"code_challenge_methods_supported","S256"),CN(e,"prompt_values_supported")].some((e=>!e)))return e;throw A.error("Issuer configuration not valid"),new Error(li.OpSupport)},DH=e=>{try{return xH(e)}catch(e){throw A.error("Could not decode id_token",e),e}},jH=(e,t,n,r)=>{try{if(!e)throw new Error("No ID token");var i=DH(e);if(i.iss!==t)throw new Error("Invalid issuer");if(!("string"==typeof i.aud?[i.aud]:i.aud).includes(n))throw new Error("Invalid audience");if(void 0!==r&&i.nonce!==r)throw new Error("Invalid nonce");if(!i.exp||Date.now()>1e3*i.exp)throw new Error("Invalid expiry")}catch(e){throw A.error("Invalid ID token",e),new Error(li.InvalidIdToken)}};function UH(e){if(!nL(e))throw A.error("Stored user state not found"),new Error(li.MissingOrInvalidStoredState);if([bl(e,"homeserverUrl"),bl(e,"nonce"),Wg(e,"identityServerUrl")].some((e=>!e)))throw new Error(li.MissingOrInvalidStoredState)}var gae=e=>nL(e)&&bl(e,"token_type")&&"bearer"===e.token_type.toLowerCase()&&bl(e,"access_token")&&bl(e,"refresh_token")&&(!("expires_in"in e)||"number"==typeof e.expires_in);function FH(e){if(!gae(e))throw new Error(li.InvalidBearerTokenResponse)}function TN(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function rS(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?TN(Object(n),!0).forEach((function(t){L(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):TN(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var DE=e=>{var t=e??_s(10);return"openid urn:matrix:org.matrix.msc2967.client:api:* urn:matrix:org.matrix.msc2967.client:device:".concat(t)},vae=function(){var e=U((function*(e){return globalThis.crypto.subtle?PE(yield kH(e)):(A.warn("A secure context is required to generate code challenge. Using plain text code challenge"),e)}));return function(t){return e.apply(this,arguments)}}(),yae=e=>{var{redirectUri:t}=e;return{scope:DE(),redirectUri:t,state:_s(8),nonce:_s(8),codeVerifier:_s(64)}},_ae=function(){var e=U((function*(e,t,n){var{scope:r,redirectUri:i,state:o,nonce:s,codeVerifier:a}=n,l=new URL(e);return l.searchParams.append("response_mode","query"),l.searchParams.append("response_type","code"),l.searchParams.append("redirect_uri",i),l.searchParams.append("client_id",t),l.searchParams.append("state",o),l.searchParams.append("scope",r),l.searchParams.append("nonce",s),l.searchParams.append("code_challenge_method","S256"),l.searchParams.append("code_challenge",yield vae(a)),l.toString()}));return function(t,n,r){return e.apply(this,arguments)}}(),bae=function(){var e=U((function*(e){var{metadata:t,redirectUri:n,clientId:r,homeserverUrl:i,identityServerUrl:o,nonce:s,prompt:a,urlState:l}=e,c=DE(),u=new tL(rS(rS({},t),{},{client_id:r,redirect_uri:n,authority:t.issuer,response_mode:"query",response_type:"code",scope:c,stateStore:new NE({prefix:"mx_oidc_",store:window.sessionStorage})})),d={homeserverUrl:i,nonce:s,identityServerUrl:o};return(yield u.createSigninRequest({state:d,nonce:s,prompt:a,url_state:l})).url}));return function(t){return e.apply(this,arguments)}}(),Sae=e=>({id_token:e.id_token,scope:e.scope,expires_at:e.expires_at,refresh_token:e.refresh_token,access_token:e.access_token,token_type:"Bearer"}),Eae=function(){var e=U((function*(e,t){var n=new URL(window.location.origin);n.searchParams.append("code",e),n.searchParams.append("state",t),xv.setLogger(A);try{var r=new $_(n.searchParams),i=new NE({prefix:"mx_oidc_",store:window.sessionStorage}),o=yield i.get(r.state);if(!o)throw new Error(li.MissingOrInvalidStoredState);var s=yield eL.fromStorageString(o),a=new tL(rS(rS({},s),{},{stateStore:i})),l=yield a.processSigninResponse(n.href),c=l.userState;UH(c),FH(l),jH(l.id_token,a.settings.authority,a.settings.client_id,c.nonce);var u=Sae(l);return{oidcClientSettings:{clientId:a.settings.client_id,issuer:a.settings.authority},tokenResponse:u,homeserverUrl:c.homeserverUrl,identityServerUrl:c.identityServerUrl,idTokenClaims:l.profile}}catch(e){A.error("Oidc login failed",e);var d=e.message;throw Object.values(li).includes(d)?e:new Error(li.CodeExchangeFailed)}}));return function(t,n){return e.apply(this,arguments)}}();function RN(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function IN(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?RN(Object(n),!0).forEach((function(t){L(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):RN(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var rL=function(){var e=U((function*(e){var t=new URL(".well-known/openid-configuration",e),n=yield fetch(t,{method:ae.Get,signal:kE(5e3)}),r=yield n.json();return iL(r)}));return function(t){return e.apply(this,arguments)}}(),iL=function(){var e=U((function*(e){var t=NH(e),n=new Nk({authority:t.issuer,metadata:t,redirect_uri:"",client_id:""}),r=new LH(n);return IN(IN({},t),{},{signingKeys:yield r.getSigningKeys()})}));return function(t){return e.apply(this,arguments)}}(),wae="urn:ietf:params:oauth:grant-type:device_code",c2=(e,t)=>{if(!t)return!1;var n=new URL(t);return!(n.protocol!==e.protocol||n.hostname!==e.hostname&&!n.hostname.endsWith(".".concat(e.hostname)))},Cae=function(){var e=U((function*(e,t){if(!e.registration_endpoint)throw new Error(li.DynamicRegistrationNotSupported);var n=["authorization_code","refresh_token"];if(n.some((t=>!e.grant_types_supported.includes(t))))throw new Error(li.DynamicRegistrationNotSupported);var r=new URL(t.clientUri),i={client_name:t.clientName,client_uri:t.clientUri,response_types:["code"],grant_types:n,redirect_uris:t.redirectUris,id_token_signed_response_alg:"RS256",token_endpoint_auth_method:"none",application_type:t.applicationType,contacts:t.contacts,logo_uri:c2(r,t.logoUri)?t.logoUri:void 0,policy_uri:c2(r,t.policyUri)?t.policyUri:void 0,tos_uri:c2(r,t.tosUri)?t.tosUri:void 0};try{var o=yield fetch(e.registration_endpoint,{method:ae.Post,headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(i)});if(o.status>=400)throw new Error(li.DynamicRegistrationFailed);var s=(yield o.json()).client_id;if(!s||"string"!=typeof s)throw new Error(li.DynamicRegistrationInvalid);return s}catch(e){throw Object.values(li).includes(e.message)?e:(A.error("Dynamic registration request failed",e),new Error(li.DynamicRegistrationFailed))}}));return function(t,n){return e.apply(this,arguments)}}();class Tae{constructor(e,t,n,r,i){this.idTokenClaims=i,L(this,"oidcClientReady",void 0),L(this,"oidcClient",void 0),L(this,"inflightRefreshRequest",void 0),this.oidcClientReady=this.initialiseOidcClient(e,t,r,n)}initialiseOidcClient(e,t,n,r){var i=this;return U((function*(){try{var o,s=yield rL(e),a=DE(n);i.oidcClient=new tL({metadata:s,signingKeys:null!==(o=s.signingKeys)&&void 0!==o?o:void 0,client_id:t,scope:a,redirect_uri:r,authority:s.issuer,stateStore:new NE({prefix:"mx_oidc_",store:window.sessionStorage})})}catch(e){throw A.error("Failed to initialise OIDC client.",e),new Error("Failed to initialise OIDC client.")}}))()}doRefreshAccessToken(e){var t=this;return U((function*(){t.inflightRefreshRequest||(t.inflightRefreshRequest=t.getNewTokens(e));try{return yield t.inflightRefreshRequest}catch(e){throw e instanceof lp?new UP(e):e}finally{t.inflightRefreshRequest=void 0}}))()}persistTokens(e){return U((function*(){}))()}getNewTokens(e){var t=this;return U((function*(){if(!t.oidcClient)throw new Error("Cannot get new token before OIDC client is initialised.");var n={refresh_token:e,session_state:"test",data:void 0,profile:t.idTokenClaims},r=yield t.oidcClient.useRefreshToken({state:n,timeoutInSeconds:300}),i={accessToken:r.access_token,refreshToken:r.refresh_token};return yield t.persistTokens(i),i}))()}}var Rae=["server","limit","since"];function kN(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function dr(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?kN(Object(n),!0).forEach((function(t){L(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):kN(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Iae=3e3,xN=6e5,kae=new Kn("last_seen_user_agent","org.matrix.msc3852.last_seen_user_agent"),cp=function(e){return e.Chronological="chronological",e.Detached="detached",e}({}),xae=new SE("m.get_login_token","org.matrix.msc3882.get_login_token"),$H="uk.half-shot.msc2666",HH="uk.half-shot.msc2666.mutual_rooms",BH="uk.half-shot.msc2666.query_mutual_rooms",ha="org.matrix.msc4140",VH="uk.tcpip.msc4133",Zo="$",Oe=function(e){return e.Sync="sync",e.Event="event",e.ToDeviceEvent="toDeviceEvent",e.AccountData="accountData",e.Room="Room",e.DeleteRoom="deleteRoom",e.SyncUnexpectedError="sync.unexpectedError",e.ClientWellKnown="WellKnown.client",e.ReceivedVoipEvent="received_voip_event",e.UndecryptableToDeviceEvent="toDeviceEvent.undecryptable",e.TurnServers="turnServers",e.TurnServersError="turnServers.error",e}({}),Pae=new Kn("action","org.matrix.msc3824.action");class jE extends En{constructor(e){var t,n,r,i;super(),r=this,L(this,"logger",void 0),L(this,"reEmitter",new Mp(this)),L(this,"olmVersion",null),L(this,"usingExternalCrypto",!1),L(this,"_store",void 0),L(this,"deviceId",void 0),L(this,"credentials",void 0),L(this,"legacyPickleKey",void 0),L(this,"scheduler",void 0),L(this,"clientRunning",!1),L(this,"timelineSupport",!1),L(this,"urlPreviewCache",{}),L(this,"identityServer",void 0),L(this,"http",void 0),L(this,"cryptoBackend",void 0),L(this,"cryptoCallbacks",void 0),L(this,"callEventHandler",void 0),L(this,"groupCallEventHandler",void 0),L(this,"supportsCallTransfer",!1),L(this,"forceTURN",!1),L(this,"iceCandidatePoolSize",0),L(this,"idBaseUrl",void 0),L(this,"baseUrl",void 0),L(this,"isVoipWithNoMediaAllowed",void 0),L(this,"useLivekitForGroupCalls",void 0),L(this,"canSupportVoip",!1),L(this,"peekSync",null),L(this,"isGuestAccount",!1),L(this,"ongoingScrollbacks",{}),L(this,"notifTimelineSet",null),L(this,"legacyCryptoStore",void 0),L(this,"verificationMethods",void 0),L(this,"fallbackICEServerAllowed",!1),L(this,"syncApi",void 0),L(this,"roomNameGenerator",void 0),L(this,"pushRules",void 0),L(this,"syncLeftRoomsPromise",void 0),L(this,"syncedLeftRooms",!1),L(this,"clientOpts",void 0),L(this,"clientWellKnownIntervalID",void 0),L(this,"canResetTimelineCallback",void 0),L(this,"canSupport",new Map),L(this,"pushProcessor",new Co(this)),L(this,"serverVersionsPromise",void 0),L(this,"clientWellKnown",void 0),L(this,"clientWellKnownPromise",void 0),L(this,"turnServers",[]),L(this,"turnServersExpiry",0),L(this,"checkTurnServersIntervalID",void 0),L(this,"txnCtr",0),L(this,"mediaHandler",new woe(this)),L(this,"sessionId",void 0),L(this,"eventsBeingEncrypted",new Set),L(this,"useE2eForGroupCall",!0),L(this,"toDeviceMessageQueue",void 0),L(this,"livekitServiceURL",void 0),L(this,"_secretStorage",void 0),L(this,"ignoredInvites",void 0),L(this,"matrixRTC",void 0),L(this,"serverCapabilitiesService",void 0),L(this,"startCallEventHandler",(()=>{this.isInitialSyncComplete()&&(bk()&&(this.callEventHandler.start(),this.groupCallEventHandler.start()),this.off(Oe.Sync,this.startCallEventHandler))})),L(this,"startMatrixRTC",(()=>{this.isInitialSyncComplete()&&(this.matrixRTC.start(),this.off(Oe.Sync,this.startMatrixRTC))})),L(this,"fixupRoomNotifications",(()=>{if(this.isInitialSyncComplete()){var e,t=(null!==(e=this.getRooms())&&void 0!==e?e:[]).filter((e=>e.getUnreadNotificationCount(jt.Total)>0));for(var n of t){var r=this.getSafeUserId();n.fixupNotifications(r)}this.off(Oe.Sync,this.fixupRoomNotifications)}})),this.logger=null!==(t=e.logger)&&void 0!==t?t:A,e.baseUrl=GT(e.baseUrl),e.idBaseUrl=GT(e.idBaseUrl),this.baseUrl=e.baseUrl,this.idBaseUrl=e.idBaseUrl,this.identityServer=e.identityServer,this.usingExternalCrypto=null!==(n=e.usingExternalCrypto)&&void 0!==n&&n,this.store=e.store||new Rse,this.deviceId=e.deviceId||null,this.sessionId=_s(10);var o,s=e.userId||null;this.credentials={userId:s},this.http=new sH(this,{fetchFn:e.fetchFn,baseUrl:e.baseUrl,idBaseUrl:e.idBaseUrl,accessToken:e.accessToken,refreshToken:e.refreshToken,tokenRefreshFunction:e.tokenRefreshFunction,prefix:fr.V3,onlyData:!0,extraParams:e.queryParams,localTimeoutMs:e.localTimeoutMs,useAuthorizationHeader:e.useAuthorizationHeader,logger:this.logger}),e.pickleKey&&(this.legacyPickleKey=e.pickleKey),this.useLivekitForGroupCalls=!!e.useLivekitForGroupCalls,this.scheduler=e.scheduler,this.scheduler&&this.scheduler.setProcessFunction((o=U((function*(e){var t=r.getRoom(e.getRoomId());e.status!==et.SENDING&&r.updatePendingEventStatus(t,e,et.SENDING);var n=yield r.sendEventHttpRequest(e);return t&&t.updatePendingEvent(e,et.SENT,n.event_id),n})),function(e){return o.apply(this,arguments)})),bk()&&(this.callEventHandler=new Kse(this),this.groupCallEventHandler=new Gse(this),this.canSupportVoip=!0,this.on(Oe.Sync,this.startCallEventHandler)),this.matrixRTC=new zoe(this),this.serverCapabilitiesService=new aH(this.http),this.on(Oe.Sync,this.fixupRoomNotifications),this.timelineSupport=!!e.timelineSupport,this.legacyCryptoStore=e.cryptoStore,this.verificationMethods=e.verificationMethods,this.cryptoCallbacks=e.cryptoCallbacks||{},this.forceTURN=e.forceTURN||!1,this.iceCandidatePoolSize=void 0===e.iceCandidatePoolSize?0:e.iceCandidatePoolSize,this.supportsCallTransfer=e.supportsCallTransfer||!1,this.fallbackICEServerAllowed=e.fallbackICEServerAllowed||!1,this.isVoipWithNoMediaAllowed=e.isVoipWithNoMediaAllowed||!1,void 0!==e.useE2eForGroupCall&&(this.useE2eForGroupCall=e.useE2eForGroupCall),this.livekitServiceURL=e.livekitServiceURL,this.roomNameGenerator=e.roomNameGenerator,this.toDeviceMessageQueue=new Loe(this),this.on(Mt.Decrypted,(e=>{qH(this,e)})),this.ignoredInvites=new Ooe(this),this._secretStorage=new TH(this,null!==(i=e.cryptoCallbacks)&&void 0!==i?i:{}),this.setMaxListeners(0)}set store(e){this._store=e,this._store.setUserCreator((e=>El.createUser(e,this)))}get store(){return this._store}startClient(e){var t=this;return U((function*(){if(!t.clientRunning){t.clientRunning=!0,t.on(Oe.Sync,t.startMatrixRTC);var n=t.getUserId();n&&t.store.storeUser(new El(n)),t.canSupportVoip&&(t.checkTurnServersIntervalID=setInterval((()=>{t.checkTurnServers()}),xN),t.checkTurnServers()),t.syncApi&&(t.logger.error("Still have sync object whilst not running: stopping old one"),t.syncApi.stop());try{yield t.getVersions();var{threads:r,list:i,fwdPagination:o}=yield t.doesServerSupportThread();dn.setServerSideSupport(r),dn.setServerSideListSupport(i),dn.setServerSideFwdPaginationSupport(o)}catch(e){t.logger.error("Can't fetch server versions, continuing to initialise sync, this will be retried later",e)}t.clientOpts=e??{},t.clientOpts.slidingSync?t.syncApi=new SH(t.clientOpts.slidingSync,t,t.clientOpts,t.buildSyncApiOptions()):t.syncApi=new gd(t,t.clientOpts,t.buildSyncApiOptions()),t.syncApi.sync().catch((e=>t.logger.info("Sync startup aborted with an error:",e))),void 0!==t.clientOpts.clientWellKnownPollPeriod&&(t.clientWellKnownIntervalID=setInterval((()=>{t.fetchClientWellKnown()}),1e3*t.clientOpts.clientWellKnownPollPeriod),t.fetchClientWellKnown()),t.toDeviceMessageQueue.start(),t.serverCapabilitiesService.start()}}))()}buildSyncApiOptions(){return{cryptoCallbacks:this.cryptoBackend,canResetEntireTimeline:e=>!!this.canResetTimelineCallback&&this.canResetTimelineCallback(e)}}stopClient(){var e,t,n,r,i;null===(e=this.cryptoBackend)||void 0===e||e.stop(),this.off(Oe.Sync,this.startMatrixRTC),this.clientRunning&&(this.logger.debug("stopping MatrixClient"),this.clientRunning=!1,null===(t=this.syncApi)||void 0===t||t.stop(),this.syncApi=void 0,null===(n=this.peekSync)||void 0===n||n.stopPeeking(),null===(r=this.callEventHandler)||void 0===r||r.stop(),null===(i=this.groupCallEventHandler)||void 0===i||i.stop(),this.callEventHandler=void 0,this.groupCallEventHandler=void 0,globalThis.clearInterval(this.checkTurnServersIntervalID),this.checkTurnServersIntervalID=void 0,void 0!==this.clientWellKnownIntervalID&&globalThis.clearInterval(this.clientWellKnownIntervalID),this.toDeviceMessageQueue.stop(),this.matrixRTC.stop(),this.serverCapabilitiesService.stop())}clearStores(){var e=this;if(this.clientRunning)throw new Error("Cannot clear stores while client is running");var t=[];t.push(this.store.deleteAllData()),this.legacyCryptoStore&&t.push(this.legacyCryptoStore.deleteAllData());var n,r=(n=U((function*(){var t;try{if(!(t=globalThis.indexedDB))return}catch{return}var n=function*(n){var r=new Promise(((r,i)=>{e.logger.info("Removing IndexedDB instance ".concat(n));var o=t.deleteDatabase(n);o.onsuccess=t=>{e.logger.info("Removed IndexedDB instance ".concat(n)),r(0)},o.onerror=t=>{e.logger.warn("Failed to remove IndexedDB instance ".concat(n,":"),t),r(0)},o.onblocked=t=>{e.logger.info("cannot yet remove IndexedDB instance ".concat(n))}}));yield r};for(var r of["".concat(i2,"::matrix-sdk-crypto"),"".concat(i2,"::matrix-sdk-crypto-meta")])yield*n(r)})),function(){return n.apply(this,arguments)});return t.push(r()),Promise.all(t).then()}getUserId(){var e,t;return null!==(e=null===(t=this.credentials)||void 0===t?void 0:t.userId)&&void 0!==e?e:null}getSafeUserId(){var e=this.getUserId();if(!e)throw new Error("Expected logged in user but found none.");return e}getDomain(){var e;return null!==(e=this.credentials)&&void 0!==e&&e.userId?this.credentials.userId.replace(/^.*?:/,""):null}getUserIdLocalpart(){var e,t;return null!==(e=null===(t=this.credentials)||void 0===t||null===(t=t.userId)||void 0===t?void 0:t.split(":")[0].substring(1))&&void 0!==e?e:null}getDeviceId(){return this.deviceId}getSessionId(){return this.sessionId}supportsVoip(){return this.canSupportVoip}getMediaHandler(){return this.mediaHandler}setForceTURN(e){this.forceTURN=e}setSupportsCallTransfer(e){this.supportsCallTransfer=e}getUseE2eForGroupCall(){return this.useE2eForGroupCall}createCall(e){return Iv(this,e)}createGroupCall(e,t,n,r,i,o){var s=this;return U((function*(){if(s.getGroupCallForRoom(e))throw new Error("".concat(e," already has an existing group call"));var a=s.getRoom(e);if(!a)throw new Error("Cannot find room ".concat(e));return new qP(s,a,t,n,r,void 0,i||s.isVoipWithNoMediaAllowed,o,s.isVoipWithNoMediaAllowed,s.useLivekitForGroupCalls,s.livekitServiceURL).create()}))()}getLivekitServiceURL(){return this.livekitServiceURL}setLivekitServiceURL(e){this.livekitServiceURL=e}waitUntilRoomReadyForGroupCalls(e){return this.groupCallEventHandler.waitUntilRoomReadyForGroupCalls(e)}getGroupCallForRoom(e){return this.groupCallEventHandler.groupCalls.get(e)||null}getSyncState(){var e,t;return null!==(e=null===(t=this.syncApi)||void 0===t?void 0:t.getSyncState())&&void 0!==e?e:null}getSyncStateData(){return this.syncApi?this.syncApi.getSyncStateData():null}isInitialSyncComplete(){var e=this.getSyncState();return!!e&&(e===Dt.Prepared||e===Dt.Syncing)}isGuest(){return this.isGuestAccount}setGuest(e){this.isGuestAccount=e}getScheduler(){return this.scheduler}retryImmediately(){var e,t;return this.toDeviceMessageQueue.sendQueue(),null!==(e=null===(t=this.syncApi)||void 0===t?void 0:t.retryImmediately())&&void 0!==e&&e}getNotifTimelineSet(){return this.notifTimelineSet}setNotifTimelineSet(e){this.notifTimelineSet=e}getCapabilities(){var e=this;return U((function*(){return e.serverCapabilitiesService.getCachedCapabilities()||e.serverCapabilitiesService.fetchCapabilities()}))()}getCachedCapabilities(){return this.serverCapabilitiesService.getCachedCapabilities()}fetchCapabilities(){return this.serverCapabilitiesService.fetchCapabilities()}initRustCrypto(){var e=arguments,t=this;return U((function*(){var n,r=e.length>0&&void 0!==e[0]?e[0]:{};if(t.cryptoBackend)t.logger.warn("Attempt to re-initialise e2e encryption on MatrixClient");else{var i=t.getUserId();if(null===i)throw new Error("Cannot enable encryption on MatrixClient with unknown userId: ensure userId is passed in createClient().");var o=t.getDeviceId();if(null===o)throw new Error("Cannot enable encryption on MatrixClient with unknown deviceId: ensure deviceId is passed in createClient().");t.logger.debug("Downloading Rust crypto library");var s=yield Cv((()=>import("./index-CnwgenbU.js")),__vite__mapDeps([0,1]),import.meta.url),a=yield s.initRustCrypto({logger:t.logger,http:t.http,userId:i,deviceId:o,secretStorage:t.secretStorage,cryptoCallbacks:t.cryptoCallbacks,storePrefix:!1===r.useIndexedDB?null:i2,storeKey:r.storageKey,storePassphrase:r.storagePassword,legacyCryptoStore:t.legacyCryptoStore,legacyPickleKey:null!==(n=t.legacyPickleKey)&&void 0!==n?n:"DEFAULT_KEY",legacyMigrationProgressListener:(e,n)=>{t.emit(Rr.LegacyCryptoStoreMigrationProgress,e,n)}});a.setSupportedVerificationMethods(t.verificationMethods),t.cryptoBackend=a,t.on(Gi.Membership,a.onRoomMembership.bind(a)),t.on(Oe.Event,(e=>{a.onLiveEventFromSync(e)})),t.reEmitter.reEmit(a,[Rr.VerificationRequestReceived,Rr.UserTrustStatusChanged,Rr.KeyBackupStatus,Rr.KeyBackupSessionsRemaining,Rr.KeyBackupFailed,Rr.KeyBackupDecryptionKeyCached,Rr.KeysChanged,Rr.DevicesUpdated,Rr.WillUpdateDevices,Rr.DehydratedDeviceCreated,Rr.DehydratedDeviceUploaded,Rr.RehydrationStarted,Rr.RehydrationProgress,Rr.RehydrationCompleted,Rr.RehydrationError,Rr.DehydrationKeyCached,Rr.DehydratedDeviceRotationError])}}))()}get secretStorage(){return this._secretStorage}getCrypto(){return this.cryptoBackend}isRoomEncrypted(e){var t=this.getRoom(e);return!!t&&t.hasEncryptionStateEvent()}isKeyBackupKeyStored(){return Promise.resolve(this.secretStorage.isStored("m.megolm_backup.v1"))}makeKeyBackupPath(e,t,n){return{path:void 0!==t?Ie("/room_keys/keys/$roomId/$sessionId",{$roomId:e,$sessionId:t}):void 0!==e?Ie("/room_keys/keys/$roomId",{$roomId:e}):"/room_keys/keys",queryData:void 0===n?void 0:{version:n}}}deleteKeysFromBackup(e,t,n){var r=this;return U((function*(){var i=r.makeKeyBackupPath(e,t,n);yield r.http.authedRequest(ae.Delete,i.path,i.queryData,void 0,{prefix:fr.V3})}))()}getMediaConfig(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=e?"/media/config":"/config";return this.http.authedRequest(ae.Get,t,void 0,void 0,{prefix:e?fr.V1:Lh.V3})}getRoom(e){return e?this.store.getRoom(e):null}getRooms(){return this.store.getRooms()}getVisibleRooms(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=this.store.getRooms(),n=new Set;for(var r of t){var i,o=null===(i=r.findPredecessor(e))||void 0===i?void 0:i.roomId;o&&n.add(o)}return t.filter((e=>!(e.currentState.getStateEvents(ee.RoomTombstone,"")&&n.has(e.roomId))))}getUser(e){return this.store.getUser(e)}getUsers(){return this.store.getUsers()}setAccountData(e,t){var n=this;return U((function*(){if(!n.clientRunning)return A.warn("Calling `setAccountData` before the client is started: `getAccountData` may return inconsistent results."),yield dk(5,(()=>n.setAccountDataRaw(e,t)));var r=n.store.getAccountData(e);if(r&&Md(r.event.content,t))return{};var i=ou();function o(t){t.getType()===e&&i.resolve()}n.addListener(Oe.AccountData,o);try{var s=yield dk(5,(()=>n.setAccountDataRaw(e,t)));return yield i.promise,s}finally{n.removeListener(Oe.AccountData,o)}}))()}setAccountDataRaw(e,t){var n=Ie("/user/$userId/account_data/$type",{$userId:this.credentials.userId,$type:e});return this.http.authedRequest(ae.Put,n,void 0,t)}getAccountData(e){return this.store.getAccountData(e)}getAccountDataFromServer(e){var t=this;return U((function*(){if(t.isInitialSyncComplete()){var n=t.store.getAccountData(e);return n?n.getContent():null}var r=Ie("/user/$userId/account_data/$type",{$userId:t.credentials.userId,$type:e});try{return yield t.http.authedRequest(ae.Get,r)}catch(e){var i;if("M_NOT_FOUND"===(null===(i=e.data)||void 0===i?void 0:i.errcode))return null;throw e}}))()}deleteAccountData(e){var t=this;return U((function*(){var n=t.canSupport.get(vr.AccountDataDeletion);if(n!==gr.Unsupported){var r=Ie("/user/$userId/account_data/$type",{$userId:t.getSafeUserId(),$type:e}),i=n===gr.Unstable?{prefix:"/_matrix/client/unstable/org.matrix.msc3391"}:void 0;return yield t.http.authedRequest(ae.Delete,r,void 0,void 0,i)}yield t.setAccountData(e,{})}))()}getIgnoredUsers(){var e=this.getAccountData(ee.IgnoredUserList);return null!=e&&e.getContent().ignored_users?Object.keys(e.getContent().ignored_users):[]}setIgnoredUsers(e){var t={ignored_users:{}};return e.forEach((e=>{t.ignored_users[e]={}})),this.setAccountData(ee.IgnoredUserList,t)}isUserIgnored(e){return this.getIgnoredUsers().includes(e)}joinRoom(e){var t=arguments,n=this;return U((function*(){var r=t.length>1&&void 0!==t[1]?t[1]:{};void 0===r.syncRoom&&(r.syncRoom=!0);var i=n.getRoom(e);if(null!=i&&i.hasMembershipState(n.credentials.userId,Ke.Join))return i;var o=Promise.resolve();if(r.inviteSignUrl){var s=new URL(r.inviteSignUrl);s.searchParams.set("mxid",n.credentials.userId),o=n.http.requestOtherUrl(ae.Post,s)}var a={};r.viaServers&&(a.server_name=r.viaServers,a.via=r.viaServers);var l={},c=yield o;c&&(l.third_party_signed=c);var u=Ie("/join/$roomid",{$roomid:e}),d=(yield n.http.authedRequest(ae.Post,u,a,l)).room_id,h=n.getRoom(d);if(null!=h&&h.hasMembershipState(n.credentials.userId,Ke.Join))return h;var p=new gd(n,n.clientOpts,n.buildSyncApiOptions()).createRoom(d);return r.syncRoom,p}))()}knockRoom(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=this.getRoom(e);if(null!=n&&n.hasMembershipState(this.credentials.userId,Ke.Knock))return Promise.resolve({room_id:n.roomId});var r=Ie("/knock/$roomIdOrAlias",{$roomIdOrAlias:e}),i={};t.viaServers&&(i.server_name=t.viaServers,i.via=t.viaServers);var o={};return t.reason&&(o.reason=t.reason),this.http.authedRequest(ae.Post,r,i,o)}resendEvent(e,t){return this.toDeviceMessageQueue.sendQueue(),this.updatePendingEventStatus(t,e,et.SENDING),this.encryptAndSendEvent(t,e)}cancelPendingEvent(e){if(![et.QUEUED,et.NOT_SENT,et.ENCRYPTING].includes(e.status))throw new Error("cannot cancel an event with status "+e.status);e.status===et.ENCRYPTING?this.eventsBeingEncrypted.delete(e.getId()):this.scheduler&&e.status===et.QUEUED&&this.scheduler.removeEventFromQueue(e);var t=this.getRoom(e.getRoomId());this.updatePendingEventStatus(t,e,et.CANCELLED)}setRoomName(e,t){return this.sendStateEvent(e,ee.RoomName,{name:t})}setRoomTopic(e,t,n){var r=K$(t,n);return this.sendStateEvent(e,ee.RoomTopic,r)}getRoomTags(e){var t=Ie("/user/$userId/rooms/$roomId/tags",{$userId:this.credentials.userId,$roomId:e});return this.http.authedRequest(ae.Get,t)}setRoomTag(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=Ie("/user/$userId/rooms/$roomId/tags/$tag",{$userId:this.credentials.userId,$roomId:e,$tag:t});return this.http.authedRequest(ae.Put,r,void 0,n)}deleteRoomTag(e,t){var n=Ie("/user/$userId/rooms/$roomId/tags/$tag",{$userId:this.credentials.userId,$roomId:e,$tag:t});return this.http.authedRequest(ae.Delete,n)}setRoomAccountData(e,t,n){var r=Ie("/user/$userId/rooms/$roomId/account_data/$type",{$userId:this.credentials.userId,$roomId:e,$type:t});return this.http.authedRequest(ae.Put,r,void 0,n)}setPowerLevel(e,t,n){var r=this;return U((function*(){var i,o,s;r.clientRunning&&r.isInitialSyncComplete()&&(o=null===(s=r.getRoom(e))||void 0===s||null===(s=s.currentState)||void 0===s||null===(s=s.getStateEvents(ee.RoomPowerLevels,""))||void 0===s?void 0:s.getContent());if(!o)try{o=yield r.getStateEvent(e,ee.RoomPowerLevels,"")}catch(e){if(!(e instanceof bn&&"M_NOT_FOUND"===e.errcode))throw e;o={}}null!==(i=o=wE(o))&&void 0!==i&&i.users||(o.users={});var a=Array.isArray(t)?t:[t];for(var l of a)null==n?delete o.users[l]:o.users[l]=n;return r.sendStateEvent(e,ee.RoomPowerLevels,o,"")}))()}unstable_createLiveBeacon(e,t){var n=this;return U((function*(){return n.unstable_setLiveBeacon(e,t)}))()}unstable_setLiveBeacon(e,t){var n=this;return U((function*(){return n.sendStateEvent(e,zP.name,t,n.getUserId())}))()}sendEvent(e,t,n,r,i){var o,s,a,l;return null!=t&&t.startsWith(Zo)||null===t?(l=i,a=r,s=n,o=t):(l=r,a=n,s=t,o=null),this.addThreadRelationIfNeeded(a,o,e),this.sendCompleteEvent(e,o,{type:s,content:a},l)}addThreadRelationIfNeeded(e,t,n){var r;if(t&&(null===(r=e["m.relates_to"])||void 0===r||!r.rel_type)){var i,o,s=!(null===(i=e["m.relates_to"])||void 0===i||!i["m.in_reply_to"]);e["m.relates_to"]=dr(dr({},e["m.relates_to"]),{},{rel_type:Zt.name,event_id:t,is_falling_back:!s});var a,l,c=null===(o=this.getRoom(n))||void 0===o?void 0:o.getThread(t);if(c&&!s)e["m.relates_to"]["m.in_reply_to"]={event_id:null!==(a=null===(l=c.lastReply((e=>e.isRelation(Zt.name)&&!e.status)))||void 0===l?void 0:l.getId())&&void 0!==a?a:t}}}sendCompleteEvent(e,t,n,r,i){var o,s;"string"==typeof r?s=r:(o=r,s=i),s||(s=this.makeTxnId());var a=new Ci(Object.assign(n,{event_id:"~"+e+":"+s,user_id:this.credentials.userId,sender:this.credentials.userId,room_id:e,origin_server_ts:(new Date).getTime()})),l=this.getRoom(e),c=t?null==l?void 0:l.getThread(t):void 0;c&&a.setThread(c),o||(this.reEmitter.reEmit(a,[Mt.Replaced,Mt.VisibilityChange]),null==l||l.reEmitter.reEmit(a,[Mt.BeforeRedaction]));var u=a.getAssociatedId();if(null!=u&&u.startsWith("~")){var d=null==l?void 0:l.getPendingEvents().find((e=>e.getId()===u));null==d||d.once(Mt.LocalEventIdReplaced,(()=>{a.updateAssociatedId(d.getId())}))}var h=a.getType();return this.logger.debug("sendEvent of type ".concat(h," in ").concat(e," with txnId ").concat(s).concat(o?" (delayed event)":"")),a.setTxnId(s),a.setStatus(et.SENDING),o?this.encryptAndSendEvent(l,a,o):(null==l||l.addPendingEvent(a,s),a.status===et.NOT_SENT?Promise.reject(new Error("Event blocked by other events not yet sent")):this.encryptAndSendEvent(l,a))}encryptAndSendEvent(e,t,n){var r=this;return U((function*(){if(n)return r.sendEventHttpRequest(t,n);try{var i;r.eventsBeingEncrypted.add(t.getId());try{yield r.encryptEventIfNeeded(t,e??void 0)}finally{i=!r.eventsBeingEncrypted.delete(t.getId())}if(i)return{};t.status===et.ENCRYPTING&&r.updatePendingEventStatus(e,t,et.SENDING);var o=null;return r.scheduler&&((o=r.scheduler.queueEvent(t))&&r.scheduler.getQueueForEvent(t).length>1&&r.updatePendingEventStatus(e,t,et.QUEUED)),o||(o=r.sendEventHttpRequest(t),e&&(o=o.then((n=>(e.updatePendingEvent(t,et.SENT,n.event_id),n))))),yield o}catch(n){r.logger.error("Error sending event",n);try{t.error=n,r.updatePendingEventStatus(e,t,et.NOT_SENT)}catch(e){r.logger.error("Exception in error handler!",e)}throw n instanceof bn&&(n.event=t),n}}))()}encryptEventIfNeeded(e,t){var n=this;return U((function*(){if(t&&(yield n.shouldEncryptEventForRoom(e,t))&&(n.cryptoBackend||!n.usingExternalCrypto)){if(!n.cryptoBackend)throw new Error("This room is configured to use encryption, but your client does not support encryption.");n.updatePendingEventStatus(t,e,et.ENCRYPTING),yield n.cryptoBackend.encryptEvent(e,t)}}))()}shouldEncryptEventForRoom(e,t){var n=this;return U((function*(){var r;return!e.isEncrypted()&&e.getType()!==ee.Reaction&&!e.isRedaction()&&!(!t.hasEncryptionStateEvent()&&!(yield null===(r=n.cryptoBackend)||void 0===r?void 0:r.isEncryptionEnabledInRoom(t.roomId)))}))()}getEncryptedIfNeededEventType(e,t){var n;return t===ee.Reaction?t:null!==(n=this.getRoom(e))&&void 0!==n&&n.hasEncryptionStateEvent()?ee.RoomMessageEncrypted:t}updatePendingEventStatus(e,t,n){e?e.updatePendingEvent(t,n):t.setStatus(n)}sendEventHttpRequest(e,t){var n=e.getTxnId();n||(n=this.makeTxnId(),e.setTxnId(n));var r,i={$roomId:e.getRoomId(),$eventType:e.getWireType(),$stateKey:e.getStateKey(),$txnId:n};if(e.isState()){var o="/rooms/$roomId/state/$eventType";e.getStateKey()&&e.getStateKey().length>0&&(o="/rooms/$roomId/state/$eventType/$stateKey"),r=Ie(o,i)}else if(e.isRedaction()&&e.event.redacts){r=Ie("/rooms/$roomId/redact/$redactsEventId/$txnId",dr({$redactsEventId:e.event.redacts},i))}else r=Ie("/rooms/$roomId/send/$eventType/$txnId",i);var s=e.getWireContent();return t?this.http.authedRequest(ae.Put,r,PN(t),s):this.http.authedRequest(ae.Put,r,void 0,s).then((t=>(this.logger.debug("Event sent to ".concat(e.getRoomId()," with event id ").concat(t.event_id)),t)))}redactEvent(e,t,n,r,i){var o,s,a;null!==(o=n)&&void 0!==o&&o.startsWith(Zo)||(i=r,r=n,n=t,t=null);var l={reason:null===(s=i)||void 0===s?void 0:s.reason};if(void 0!==(null===(a=i)||void 0===a?void 0:a.with_rel_types)){if(this.canSupport.get(vr.RelationBasedRedactions)===gr.Unsupported)throw new Error("Server does not support relation based redactions "+"roomId ".concat(e," eventId ").concat(n," txnId: ").concat(r," threadId ").concat(t));l[this.canSupport.get(vr.RelationBasedRedactions)===gr.Stable?sk.stable:sk.unstable]=i.with_rel_types}return this.sendCompleteEvent(e,t,{type:ee.RoomRedaction,content:l,redacts:n},r)}sendMessage(e,t,n,r){"string"!=typeof t&&null!==t&&(r=n,n=t,t=null);var i=ee.RoomMessage,o=n;return this.sendEvent(e,t,i,o,r)}sendTextMessage(e,t,n,r){var i;(null===(i=t)||void 0===i||!i.startsWith(Zo))&&null!==t&&(r=n,n=t,t=null);var o=$$(n);return this.sendMessage(e,t,o,r)}sendNotice(e,t,n,r){var i;(null===(i=t)||void 0===i||!i.startsWith(Zo))&&null!==t&&(r=n,n=t,t=null);var o=H$(n);return this.sendMessage(e,t,o,r)}sendEmoteMessage(e,t,n,r){var i;(null===(i=t)||void 0===i||!i.startsWith(Zo))&&null!==t&&(r=n,n=t,t=null);var o=B$(n);return this.sendMessage(e,t,o,r)}sendImageMessage(e,t,n,r){var i,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"Image";(null===(i=t)||void 0===i||!i.startsWith(Zo))&&null!==t&&(o=r||"Image",r=n,n=t,t=null);var s={msgtype:Pa.Image,url:n,info:r,body:o};return this.sendMessage(e,t,s)}sendStickerMessage(e,t,n,r){var i,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"Sticker";(null===(i=t)||void 0===i||!i.startsWith(Zo))&&null!==t&&(o=r||"Sticker",r=n,n=t,t=null);var s={url:n,info:r,body:o};return this.sendEvent(e,t,ee.Sticker,s)}sendHtmlMessage(e,t,n,r){var i;(null===(i=t)||void 0===i||!i.startsWith(Zo))&&null!==t&&(r=n,n=t,t=null);var o=j$(n,r);return this.sendMessage(e,t,o)}sendHtmlNotice(e,t,n,r){var i;(null===(i=t)||void 0===i||!i.startsWith(Zo))&&null!==t&&(r=n,n=t,t=null);var o=U$(n,r);return this.sendMessage(e,t,o)}sendHtmlEmote(e,t,n,r){var i;(null===(i=t)||void 0===i||!i.startsWith(Zo))&&null!==t&&(r=n,n=t,t=null);var o=F$(n,r);return this.sendMessage(e,t,o)}_unstable_sendDelayedEvent(e,t,n,r,i,o){var s=this;return U((function*(){if(!(yield s.doesServerSupportUnstableFeature(ha)))throw new $c("Server does not support the delayed events API","sendDelayedEvent");return s.addThreadRelationIfNeeded(i,n,e),s.sendCompleteEvent(e,n,{type:r,content:i},t,o)}))()}_unstable_sendDelayedStateEvent(e,t,n,r){var i=arguments,o=this;return U((function*(){var s=i.length>4&&void 0!==i[4]?i[4]:"",a=i.length>5&&void 0!==i[5]?i[5]:{};if(!(yield o.doesServerSupportUnstableFeature(ha)))throw new $c("Server does not support the delayed events API","sendDelayedStateEvent");var l={$roomId:e,$eventType:n,$stateKey:s},c=Ie("/rooms/$roomId/state/$eventType",l);return void 0!==s&&(c=Ie(c+"/$stateKey",l)),o.http.authedRequest(ae.Put,c,PN(t),r,a)}))()}_unstable_getDelayedEvents(e){var t=this;return U((function*(){if(!(yield t.doesServerSupportUnstableFeature(ha)))throw new $c("Server does not support the delayed events API","getDelayedEvents");var n=e?{from:e}:void 0;return yield t.http.authedRequest(ae.Get,"/delayed_events",n,void 0,{prefix:"".concat(fr.Unstable,"/").concat(ha)})}))()}_unstable_updateDelayedEvent(e,t){var n=arguments,r=this;return U((function*(){var i=n.length>2&&void 0!==n[2]?n[2]:{};if(!(yield r.doesServerSupportUnstableFeature(ha)))throw new $c("Server does not support the delayed events API","updateDelayedEvent");var o=Ie("/delayed_events/$delayId",{$delayId:e}),s={action:t};return yield r.http.authedRequest(ae.Post,o,void 0,s,dr(dr({},i),{},{prefix:"".concat(fr.Unstable,"/").concat(ha)}))}))()}sendReceipt(e,t,n){var r=arguments,i=this;return U((function*(){var o=r.length>3&&void 0!==r[3]&&r[3];if(i.isGuest())return Promise.resolve({});var s=Ie("/rooms/$roomId/receipt/$receiptType/$eventId",{$roomId:e.getRoomId(),$receiptType:t,$eventId:e.getId()}),a=!o&&i.supportsThreads()?dr(dr({},n),{},{thread_id:up(e)}):n,l=i.http.authedRequest(ae.Post,s,void 0,a||{}),c=i.getRoom(e.getRoomId());return c&&i.credentials.userId&&c.addLocalEchoReceipt(i.credentials.userId,e,t,o),l}))()}sendReadReceipt(e){var t=arguments,n=this;return U((function*(){var r=t.length>1&&void 0!==t[1]?t[1]:yi.Read,i=t.length>2&&void 0!==t[2]&&t[2];if(e){var o=e.getId(),s=n.getRoom(e.getRoomId());if(null!=s&&s.hasPendingEvent(o))throw new Error("Cannot set read receipt to a pending event (".concat(o,")"));return n.sendReceipt(e,r,{},i)}}))()}setRoomReadMarkers(e,t,n,r){var i=this;return U((function*(){var o,s,a=i.getRoom(e);if(null!=a&&a.hasPendingEvent(t))throw new Error("Cannot set read marker to a pending event (".concat(t,")"));if(n){if(o=n.getId(),null!=a&&a.hasPendingEvent(o))throw new Error("Cannot set read receipt to a pending event (".concat(o,")"));null==a||a.addLocalEchoReceipt(i.credentials.userId,n,yi.Read)}if(r){if(s=r.getId(),null!=a&&a.hasPendingEvent(s))throw new Error("Cannot set read receipt to a pending event (".concat(s,")"));null==a||a.addLocalEchoReceipt(i.credentials.userId,r,yi.ReadPrivate)}return yield i.setRoomReadMarkersHttpRequest(e,t,o,s)}))()}getUrlPreview(e,t){t=6e4*Math.floor(t/6e4);var n=new URL(e);n.hash="";var r=t+"_"+(e=n.toString());if(r in this.urlPreviewCache)return this.urlPreviewCache[r];var i=this.http.authedRequest(ae.Get,"/preview_url",{url:e,ts:t.toString()},void 0,{prefix:Lh.V3,priority:"low"});return this.urlPreviewCache[r]=i,i}sendTyping(e,t,n){if(this.isGuest())return Promise.resolve({});var r=Ie("/rooms/$roomId/typing/$userId",{$roomId:e,$userId:this.getUserId()}),i={typing:t};return t&&(i.timeout=n||2e4),this.http.authedRequest(ae.Put,r,void 0,i)}getRoomUpgradeHistory(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=this.getRoom(e);return r?[...this.findPredecessorRooms(r,t,n),r,...this.findSuccessorRooms(r,t,n)]:[]}findPredecessorRooms(e,t,n){for(var r,i=[],o=new Set([e.roomId]),s=null===(r=e.findPredecessor(n))||void 0===r?void 0:r.roomId;null!==s;){var a;if(s){if(o.has(s))break;o.add(s)}var l=this.getRoom(s);if(null===l)break;if(t){var c=l.currentState.getStateEvents(ee.RoomTombstone,"");if(!c||c.getContent().replacement_room!==e.roomId)break}i.splice(0,0,l),s=null===(a=(e=l).findPredecessor(n))||void 0===a?void 0:a.roomId}return i}findSuccessorRooms(e,t,n){for(var r=[],i=e.currentState.getStateEvents(ee.RoomTombstone,"");i;){var o=this.getRoom(i.getContent().replacement_room);if(!o||o.roomId===e.roomId)break;if(t){var s,a=null===(s=o.findPredecessor(n))||void 0===s?void 0:s.roomId;if(!a||a!==e.roomId)break}if(r.push(o),new Set(r.map((e=>e.roomId))).size<r.length)return r.slice(0,r.length-1);i=(e=o).currentState.getStateEvents(ee.RoomTombstone,"")}return r}invite(e,t,n){return this.membershipChange(e,t,Ke.Invite,n)}inviteByEmail(e,t){return this.inviteByThreePid(e,"email",t)}inviteByThreePid(e,t,n){var r=this;return U((function*(){var i,o=Ie("/rooms/$roomId/invite",{$roomId:e}),s=r.getIdentityServerUrl(!0);if(!s)return Promise.reject(new bn({error:"No supplied identity server URL",errcode:"ORG.MATRIX.JSSDK_MISSING_PARAM"}));var a={id_server:s,medium:t,address:n};if(null!==(i=r.identityServer)&&void 0!==i&&i.getAccessToken){var l=yield r.identityServer.getAccessToken();l&&(a.id_access_token=l)}return r.http.authedRequest(ae.Post,o,void 0,a)}))()}leave(e){return this.membershipChange(e,void 0,Ke.Leave)}leaveRoomChain(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=this.getRoomUpgradeHistory(e),r=n;if(!t)for(var i of(r=[],n))if(r.push(i),i.roomId===e)break;var o={},s=[],a=e=>this.leave(e).then((()=>{delete o[e]})).catch((t=>{o[e]=t}));for(var l of r)s.push(a(l.roomId));return Promise.all(s).then((()=>o))}ban(e,t,n){return this.membershipChange(e,t,Ke.Ban,n)}forget(e){var t=arguments,n=this;return U((function*(){var r=!(t.length>1&&void 0!==t[1])||t[1],i=Ie("/rooms/$room_id/forget",{$room_id:e}),o=yield n.http.authedRequest(ae.Post,i);return r&&(n.store.removeRoom(e),n.emit(Oe.DeleteRoom,e)),o}))()}unban(e,t){var n=Ie("/rooms/$roomId/unban",{$roomId:e}),r={user_id:t};return this.http.authedRequest(ae.Post,n,void 0,r)}kick(e,t,n){var r=Ie("/rooms/$roomId/kick",{$roomId:e}),i={user_id:t,reason:n};return this.http.authedRequest(ae.Post,r,void 0,i)}membershipChange(e,t,n,r){var i=Ie("/rooms/$room_id/$membership",{$room_id:e,$membership:n});return this.http.authedRequest(ae.Post,i,void 0,{user_id:t,reason:r})}getPushActionsForEvent(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!e.getPushActions()||t){var{actions:n,rule:r}=this.pushProcessor.actionsAndRuleForEvent(e);e.setPushDetails(n,r)}return e.getPushActions()}getPushDetailsForEvent(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!e.getPushDetails()||t){var{actions:n,rule:r}=this.pushProcessor.actionsAndRuleForEvent(e);e.setPushDetails(n,r)}return e.getPushDetails()}setProfileInfo(e,t){var n=Ie("/profile/$userId/$info",{$userId:this.credentials.userId,$info:e});return this.http.authedRequest(ae.Put,n,void 0,t)}setDisplayName(e){var t=this;return U((function*(){var n=yield t.setProfileInfo("displayname",{displayname:e}),r=t.getUser(t.getUserId());return r&&(r.displayName=e,r.emit(Kr.DisplayName,r.events.presence,r)),n}))()}setAvatarUrl(e){var t=this;return U((function*(){var n=yield t.setProfileInfo("avatar_url",{avatar_url:e}),r=t.getUser(t.getUserId());return r&&(r.avatarUrl=e,r.emit(Kr.AvatarUrl,r.events.presence,r)),n}))()}mxcUrlToHttp(e,t,n,r,i,o,s){return TE(this.baseUrl,e,t,n,r,i,o,s)}setSyncPresence(e){var t=this;return U((function*(){var n;null===(n=t.syncApi)||void 0===n||n.setPresence(e)}))()}setPresence(e){var t=this;return U((function*(){var n=Ie("/presence/$userId/status",{$userId:t.credentials.userId});if(-1===["offline","online","unavailable"].indexOf(e.presence))throw new Error("Bad presence value: "+e.presence);yield t.http.authedRequest(ae.Put,n,void 0,e)}))()}getPresence(e){var t=Ie("/presence/$userId/status",{$userId:e});return this.http.authedRequest(ae.Get,t)}scrollback(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:30,n=0,r=this.ongoingScrollbacks[e.roomId]||{};if(r.promise)return r.promise;if(r.errorTs){var i=Date.now()-r.errorTs;n=Math.max(Iae-i,0)}if(null===e.oldState.paginationToken)return Promise.resolve(e);var o=this.store.scrollback(e,t).length;if(o===t)return Promise.resolve(e);t-=o;var s=new Promise(((r,i)=>{su(n).then((()=>this.createMessagesRequest(e.roomId,e.oldState.paginationToken,t,ht.Backward))).then((t=>{var n,i,o=t.chunk.map(this.getEventMapper());if(t.state){var s=t.state.map(this.getEventMapper());e.currentState.setUnknownStateEvents(s)}var[a,l,c]=e.partitionThreadedEvents(o);this.processAggregatedTimelineEvents(e,a),e.addEventsToTimeline(a,!0,!0,e.getLiveTimeline()),this.processThreadEvents(e,l,!0),c.forEach((t=>e.relations.aggregateChildEvent(t))),e.oldState.paginationToken=null!==(n=t.end)&&void 0!==n?n:null,0===t.chunk.length&&(e.oldState.paginationToken=null),this.store.storeEvents(e,o,null!==(i=t.end)&&void 0!==i?i:null,!0),delete this.ongoingScrollbacks[e.roomId],r(e)})).catch((t=>{this.ongoingScrollbacks[e.roomId]={errorTs:Date.now()},i(t)}))}));return r={promise:s},this.ongoingScrollbacks[e.roomId]=r,s}getEventMapper(e){return Soe(this,e||{})}getEventTimeline(e,t){var n=this;return U((function*(){var r,i,o,s;if(!n.timelineSupport)throw new Error("timeline support is disabled. Set the 'timelineSupport' parameter to true when creating MatrixClient to enable it.");if(null==e||!e.room)throw new Error("getEventTimeline only supports room timelines");if(e.getTimelineForEvent(t))return e.getTimelineForEvent(t);if(e.thread&&n.supportsThreads())return n.getThreadTimeline(e,t);var a=Ie("/rooms/$roomId/context/$eventId",{$roomId:e.room.roomId,$eventId:t}),l=void 0;null!==(r=n.clientOpts)&&void 0!==r&&r.lazyLoadMembers&&(l={filter:JSON.stringify(Hi.LAZY_LOADING_MESSAGES_FILTER)});var c=yield n.http.authedRequest(ae.Get,a,l);if(!c.event)throw new Error("'event' not in '/context' result - homeserver too old?");if(e.getTimelineForEvent(t))return e.getTimelineForEvent(t);var u=n.getEventMapper(),d=u(c.event);if(!d.isRelation(Zt.name)){var h=[...c.events_after.reverse().map(u),d,...c.events_before.map(u)],p=e.getTimelineForEvent(h[0].getId());p?p.getState(Le.BACKWARDS).setUnknownStateEvents(c.state.map(u)):((p=e.addTimeline()).initialiseState(c.state.map(u)),p.getState(Le.FORWARDS).paginationToken=c.end);var[f,m,v]=e.room.partitionThreadedEvents(h);return e.addEventsToTimeline(f,!0,!1,p,c.start),n.processThreadEvents(e.room,m,!0),n.processAggregatedTimelineEvents(e.room,f),v.forEach((t=>e.relations.aggregateChildEvent(t))),null!==(i=null!==(o=e.getTimelineForEvent(t))&&void 0!==o?o:null===(s=e.room.findThreadForEvent(d))||void 0===s?void 0:s.liveTimeline)&&void 0!==i?i:p}n.logger.warn("Tried loading a regular timeline at the position of a thread event")}))()}getThreadTimeline(e,t){var n=this;return U((function*(){var r;if(!n.supportsThreads())throw new Error("could not get thread timeline: no client support");if(!e.room)throw new Error("could not get thread timeline: not a room timeline");if(!e.thread)throw new Error("could not get thread timeline: not a thread timeline");var i=Ie("/rooms/$roomId/context/$eventId",{$roomId:e.room.roomId,$eventId:t}),o={limit:"0"};null!==(r=n.clientOpts)&&void 0!==r&&r.lazyLoadMembers&&(o.filter=JSON.stringify(Hi.LAZY_LOADING_MESSAGES_FILTER));var s=yield n.http.authedRequest(ae.Get,i,o),a=n.getEventMapper(),l=a(s.event);if(e.canContain(l)){var c=n.canSupport.get(vr.RelationsRecursion)!==gr.Unsupported;if(dn.hasServerSideSupport){if(dn.hasServerSideFwdPaginationSupport){var u,d,h;if(!e.thread)throw new Error("could not get thread timeline: not a thread timeline");var p=e.thread,f=yield n.fetchRelations(e.room.roomId,p.id,null,null,{dir:ht.Backward,from:s.start,recurse:c||void 0}),m=yield n.fetchRelations(e.room.roomId,p.id,null,null,{dir:ht.Forward,from:s.end,recurse:c||void 0}),v=[...m.chunk.reverse().filter(a2(p.id)).map(a),l,...f.chunk.filter(a2(p.id)).map(a)];for(var g of v){var y;yield null===(y=e.thread)||void 0===y?void 0:y.processEvent(g)}var b=e.getTimelineForEvent(l.getId());if(b?b.getState(Le.BACKWARDS).setUnknownStateEvents(s.state.map(a)):(b=e.addTimeline()).initialiseState(s.state.map(a)),e.addEventsToTimeline(v,!0,!1,b,m.next_batch),!f.next_batch){var _=yield n.fetchRoomEvent(e.room.roomId,p.id);e.addEventsToTimeline([a(_)],!0,!1,b,null)}return b.setPaginationToken(null!==(u=f.next_batch)&&void 0!==u?u:null,ht.Backward),b.setPaginationToken(null!==(d=m.next_batch)&&void 0!==d?d:null,ht.Forward),n.processAggregatedTimelineEvents(e.room,v),null!==(h=e.getTimelineForEvent(t))&&void 0!==h?h:b}for(var w,E=e.thread,S=yield n.fetchRelations(e.room.roomId,E.id,Zt.name,null,{dir:ht.Backward,from:s.start,recurse:c||void 0}),C=[],k=s.end;k;){var T,I=yield n.fetchRelations(e.room.roomId,E.id,Zt.name,null,{dir:ht.Forward,from:k,recurse:c||void 0});k=null!==(T=I.next_batch)&&void 0!==T?T:null,C.push(...I.chunk)}var R=[...C.reverse().map(a),l,...S.chunk.map(a)];for(var x of R){var L;yield null===(L=e.thread)||void 0===L?void 0:L.processEvent(x)}var P=e.getLiveTimeline();if(P.getState(Le.BACKWARDS).setUnknownStateEvents(s.state.map(a)),e.addEventsToTimeline(R,!0,!1,P,null),!S.next_batch){var O=yield n.fetchRoomEvent(e.room.roomId,E.id);e.addEventsToTimeline([a(O)],!0,!1,P,null)}return P.setPaginationToken(null!==(w=S.next_batch)&&void 0!==w?w:null,ht.Backward),P.setPaginationToken(null,ht.Forward),n.processAggregatedTimelineEvents(e.room,R),P}}}))()}getLatestTimeline(e){var t=this;return U((function*(){if(!t.timelineSupport)throw new Error("timeline support is disabled. Set the 'timelineSupport' parameter to true when creating MatrixClient to enable it.");if(!e.room)throw new Error("getLatestTimeline only supports room timelines");var n,r;if(null!==e.threadListType)n=null===(r=(yield t.createThreadListMessagesRequest(e.room.roomId,null,1,ht.Backward,e.threadListType,e.getFilter())).chunk)||void 0===r?void 0:r[0];else if(e.thread&&dn.hasServerSideSupport){var i,o=t.canSupport.get(vr.RelationsRecursion)!==gr.Unsupported;n=null===(i=(yield t.fetchRelations(e.room.roomId,e.thread.id,Zt.name,null,{dir:ht.Backward,limit:1,recurse:o||void 0})).chunk)||void 0===i?void 0:i[0]}else{var s,a,l=Ie("/rooms/$roomId/messages",{$roomId:e.room.roomId}),c={dir:"b"};null!==(s=t.clientOpts)&&void 0!==s&&s.lazyLoadMembers&&(c.filter=JSON.stringify(Hi.LAZY_LOADING_MESSAGES_FILTER)),n=null===(a=(yield t.http.authedRequest(ae.Get,l,c)).chunk)||void 0===a?void 0:a[0]}if(!n)throw new Error("No message returned when trying to construct getLatestTimeline");return t.getEventTimeline(e,n.event_id)}))()}createMessagesRequest(e,t){var n,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:30,i=arguments.length>3?arguments[3]:void 0,o=arguments.length>4?arguments[4]:void 0,s=Ie("/rooms/$roomId/messages",{$roomId:e}),a={limit:r.toString(),dir:i};t&&(a.from=t);var l,c=null;(null!==(n=this.clientOpts)&&void 0!==n&&n.lazyLoadMembers&&(c=Object.assign({},Hi.LAZY_LOADING_MESSAGES_FILTER)),o)&&(c=c||{},Object.assign(c,null===(l=o.getRoomTimelineFilterComponent())||void 0===l?void 0:l.toJSON()));return c&&(a.filter=JSON.stringify(c)),this.http.authedRequest(ae.Get,s,a)}createThreadListMessagesRequest(e,t){var n,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:30,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:ht.Backward,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:Eo.All,s=arguments.length>5?arguments[5]:void 0,a=Ie("/rooms/$roomId/threads",{$roomId:e}),l={limit:r.toString(),dir:i,include:KH(o)};t&&(l.from=t);var c,u={};(null!==(n=this.clientOpts)&&void 0!==n&&n.lazyLoadMembers&&(u=dr({},Hi.LAZY_LOADING_MESSAGES_FILTER)),s)&&(u=dr(dr({},u),null===(c=s.getRoomTimelineFilterComponent())||void 0===c?void 0:c.toJSON()));Object.keys(u).length&&(l.filter=JSON.stringify(u));var d={prefix:dn.hasServerSideListSupport===ai.Stable?fr.V1:"/_matrix/client/unstable/org.matrix.msc3856"};return this.http.authedRequest(ae.Get,a,l,void 0,d).then((e=>{var t;return dr(dr({},e),{},{chunk:null===(t=e.chunk)||void 0===t?void 0:t.reverse(),start:e.prev_batch,end:e.next_batch})}))}paginateEventTimeline(e,t){var n=this,r=e.getTimelineSet()===this.notifTimelineSet,i=this.getRoom(e.getRoomId()),o=e.getTimelineSet().threadListType,s=e.getTimelineSet().thread,a=(t=t||{}).backwards||!1;if(r&&!a)throw new Error("paginateNotifTimeline can only paginate backwards");var l,c,u,d,h=a?Le.BACKWARDS:Le.FORWARDS,p=e.getPaginationToken(h),f=e.paginationRequests[h];if(f)return f;if(r)l={limit:(null!==(u=t.limit)&&void 0!==u?u:30).toString(),only:"highlight"},p&&"end"!==p&&(l.from=p),c=this.http.authedRequest(ae.Get,"/notifications",l).then((d=U((function*(t){var r=t.next_token,i=[];t.notifications=t.notifications.filter(Io);for(var o=0;o<t.notifications.length;o++){var s=t.notifications[o],l=n.getEventMapper()(s.event);n.getPushDetailsForEvent(l,!0),l.event.room_id=s.room_id,i[o]=l}var c=e.getTimelineSet();return c.addEventsToTimeline(i,a,!1,e,r),n.processAggregatedTimelineEvents(c.room,i),a&&!t.next_token&&e.setPaginationToken(null,h),!!t.next_token})),function(e){return d.apply(this,arguments)})).finally((()=>{e.paginationRequests[h]=null})),e.paginationRequests[h]=c;else if(null!==o){if(!i)throw new Error("Unknown room "+e.getRoomId());if(!dn.hasServerSideFwdPaginationSupport&&h===ht.Forward)throw new Error("Cannot paginate threads forwards without server-side support for MSC 3715");c=this.createThreadListMessagesRequest(e.getRoomId(),p,t.limit,h,o,e.getFilter()).then((t=>{if(t.state){var n=e.getState(h),r=t.state.filter(Io).map(this.getEventMapper());n.setUnknownStateEvents(r)}var o=t.end,s=t.chunk.filter(Io).map(this.getEventMapper());return e.getTimelineSet().addEventsToTimeline(s,a,!1,e,o),this.processAggregatedTimelineEvents(i,s),this.processThreadRoots(i,s,a),a&&t.end==t.start&&e.setPaginationToken(null,h),t.end!==t.start})).finally((()=>{e.paginationRequests[h]=null})),e.paginationRequests[h]=c}else if(s){var m,v,g=this.getRoom(null!==(m=e.getRoomId())&&void 0!==m?m:void 0);if(!g)throw new Error("Unknown room "+e.getRoomId());var y=this.canSupport.get(vr.RelationsRecursion)!==gr.Unsupported;c=this.fetchRelations(null!==(v=e.getRoomId())&&void 0!==v?v:"",s.id,null,null,{dir:h,limit:t.limit,from:p??void 0,recurse:y||void 0}).then(function(){var t=U((function*(t){var r=n.getEventMapper(),i=t.chunk.filter(Io).filter(a2(s.id)).map(r);for(var o of i.slice().reverse()){yield null==s?void 0:s.processEvent(o);var l=o.getSender();(!a||null===(null==s?void 0:s.getEventReadUpTo(l)))&&g.addLocalEchoReceipt(l,o,yi.Read)}var c=t.next_batch,u=e.getTimelineSet();if(u.addEventsToTimeline(i,a,!1,e,c??null),!c&&a){var d,p,f=null!==(d=s.rootEvent)&&void 0!==d?d:r(yield n.fetchRoomEvent(null!==(p=e.getRoomId())&&void 0!==p?p:"",s.id));u.addEventsToTimeline([f],!0,!1,e,null)}return n.processAggregatedTimelineEvents(u.room,i),a&&!c&&e.setPaginationToken(null,h),!!c}));return function(e){return t.apply(this,arguments)}}()).finally((()=>{e.paginationRequests[h]=null})),e.paginationRequests[h]=c}else{if(!i)throw new Error("Unknown room "+e.getRoomId());c=this.createMessagesRequest(e.getRoomId(),p,t.limit,h,e.getFilter()).then((t=>{if(t.state){var n=e.getState(h),r=t.state.filter(Io).map(this.getEventMapper());n.setUnknownStateEvents(r)}var o=t.end,s=t.chunk.filter(Io).map(this.getEventMapper()),l=e.getTimelineSet(),[c,,u]=i.partitionThreadedEvents(s);l.addEventsToTimeline(c,a,!1,e,o),this.processAggregatedTimelineEvents(i,c),this.processThreadRoots(i,c.filter((e=>e.getServerAggregatedRelation(Zt.name))),!1),u.forEach((e=>i.relations.aggregateChildEvent(e)));var d=void 0===t.end||t.end===t.start;return a&&d&&e.setPaginationToken(null,h),!d})).finally((()=>{e.paginationRequests[h]=null})),e.paginationRequests[h]=c}return c}resetNotifTimelineSet(){this.notifTimelineSet&&this.notifTimelineSet.resetLiveTimeline("end")}peekInRoom(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:20;return null===(t=this.peekSync)||void 0===t||t.stopPeeking(),this.peekSync=new gd(this,this.clientOpts,this.buildSyncApiOptions()),this.peekSync.peek(e,n)}stopPeeking(){this.peekSync&&(this.peekSync.stopPeeking(),this.peekSync=null)}setGuestAccess(e,t){var n=this.sendStateEvent(e,ee.RoomGuestAccess,{guest_access:t.allowJoin?Xb.CanJoin:Xb.Forbidden},""),r=Promise.resolve();return t.allowRead&&(r=this.sendStateEvent(e,ee.RoomHistoryVisibility,{history_visibility:WP.WorldReadable},"")),Promise.all([r,n]).then()}requestRegisterEmailToken(e,t,n,r){return this.requestTokenFromEndpoint("/register/email/requestToken",{email:e,client_secret:t,send_attempt:n,next_link:r})}requestRegisterMsisdnToken(e,t,n,r,i){return this.requestTokenFromEndpoint("/register/msisdn/requestToken",{country:e,phone_number:t,client_secret:n,send_attempt:r,next_link:i})}requestAdd3pidEmailToken(e,t,n,r){return this.requestTokenFromEndpoint("/account/3pid/email/requestToken",{email:e,client_secret:t,send_attempt:n,next_link:r})}requestAdd3pidMsisdnToken(e,t,n,r,i){return this.requestTokenFromEndpoint("/account/3pid/msisdn/requestToken",{country:e,phone_number:t,client_secret:n,send_attempt:r,next_link:i})}requestPasswordEmailToken(e,t,n,r){return this.requestTokenFromEndpoint("/account/password/email/requestToken",{email:e,client_secret:t,send_attempt:n,next_link:r})}requestPasswordMsisdnToken(e,t,n,r,i){return this.requestTokenFromEndpoint("/account/password/msisdn/requestToken",{country:e,phone_number:t,client_secret:n,send_attempt:r,next_link:i})}requestTokenFromEndpoint(e,t){var n=this;return U((function*(){var r=Object.assign({},t);return n.http.request(ae.Post,e,void 0,r)}))()}getRoomPushRule(e,t){var n;if(this.pushRules)return null===(n=this.pushRules[e])||void 0===n||null===(n=n.room)||void 0===n?void 0:n.find((e=>e.rule_id===t));throw new Error("SyncApi.sync() must be done before accessing to push rules.")}setRoomMutePushRule(e,t,n){var r,i=!1,o=this.getRoomPushRule(e,t);if(null!=o&&o.actions.includes(Yc.DontNotify)&&(i=!0),n)if(o){if(!i){var s=ou();this.deletePushRule(e,Lr.RoomSpecific,o.rule_id).then((()=>{this.addPushRule(e,Lr.RoomSpecific,t,{actions:[Yc.DontNotify]}).then((()=>{s.resolve()})).catch((e=>{s.reject(e)}))})).catch((e=>{s.reject(e)})),r=s.promise}}else r=this.addPushRule(e,Lr.RoomSpecific,t,{actions:[Yc.DontNotify]});else i&&(r=this.deletePushRule(e,Lr.RoomSpecific,o.rule_id));if(r)return new Promise(((e,t)=>{r.then((()=>{this.getPushRules().then((t=>{this.pushRules=t,e()})).catch((e=>{t(e)}))})).catch((e=>{this.getPushRules().then((n=>{this.pushRules=n,t(e)})).catch((n=>{t(e)}))}))}))}searchMessageText(e){var t={search_term:e.query};return"keys"in e&&(t.keys=e.keys),this.search({body:{search_categories:{room_events:t}}})}searchRoomEvents(e){var t={search_categories:{room_events:{search_term:e.term,filter:e.filter,order_by:bH.Recent,event_context:{before_limit:1,after_limit:1,include_profile:!0}}}},n={_query:t,results:[],highlights:[]};return this.search({body:t}).then((e=>this.processRoomEventsSearch(n,e)))}backPaginateRoomEventsSearch(e){if(!e.next_batch)return Promise.reject(new Error("Cannot backpaginate event search any further"));if(e.pendingRequest)return e.pendingRequest;var t={body:e._query,next_batch:e.next_batch},n=this.search(t,e.abortSignal).then((t=>this.processRoomEventsSearch(e,t))).finally((()=>{e.pendingRequest=void 0}));return e.pendingRequest=n,n}processRoomEventsSearch(e,t){var n,r,i=t.search_categories.room_events;e.count=i.count,e.next_batch=i.next_batch;var o=new Set(i.highlights);e.highlights.forEach((e=>{o.add(e)})),e.highlights=Array.from(o);for(var s=this.getEventMapper(),a=null!==(n=null===(r=i.results)||void 0===r?void 0:r.length)&&void 0!==n?n:0,l=0;l<a;l++){var c=OE.fromJson(i.results[l],s),u=this.getRoom(c.context.getEvent().getRoomId());if(u)for(var d of c.context.getTimeline())d.setMetadata(u.currentState,!1);e.results.push(c)}return e}syncLeftRooms(){if(this.syncedLeftRooms)return Promise.resolve([]);if(this.syncLeftRoomsPromise)return this.syncLeftRoomsPromise;var e=new gd(this,this.clientOpts,this.buildSyncApiOptions());return this.syncLeftRoomsPromise=e.syncLeftRooms(),this.syncLeftRoomsPromise.then((()=>{this.logger.debug("Marking success of sync left room request"),this.syncedLeftRooms=!0})).finally((()=>{this.syncLeftRoomsPromise=void 0})),this.syncLeftRoomsPromise}createFilter(e){var t=Ie("/user/$userId/filter",{$userId:this.credentials.userId});return this.http.authedRequest(ae.Post,t,void 0,e).then((t=>{var n=Hi.fromJson(this.credentials.userId,t.filter_id,e);return this.store.storeFilter(n),n}))}getFilter(e,t,n){if(n){var r=this.store.getFilter(e,t);if(r)return Promise.resolve(r)}var i=Ie("/user/$userId/filter/$filterId",{$userId:e,$filterId:t});return this.http.authedRequest(ae.Get,i).then((n=>{var r=Hi.fromJson(e,t,n);return this.store.storeFilter(r),r}))}getOrCreateFilter(e,t){var n=this;return U((function*(){var r,i=n.store.getFilterIdByName(e);if(i){try{var o=yield n.getFilter(n.credentials.userId,i,!0);if(o)Md(o.getDefinition(),t.getDefinition())&&(r=i)}catch(e){if("M_UNKNOWN"!==e.errcode&&"M_NOT_FOUND"!==e.errcode)throw e}r||n.store.setFilterIdByName(e,void 0)}if(r)return r;var s=yield n.createFilter(t.getDefinition());return n.store.setFilterIdByName(e,s.filterId),s.filterId}))()}getOpenIdToken(){var e=Ie("/user/$userId/openid/request_token",{$userId:this.credentials.userId});return this.http.authedRequest(ae.Post,e,void 0,{})}turnServer(){return this.http.authedRequest(ae.Get,"/voip/turnServer")}getTurnServers(){return this.turnServers||[]}getTurnServersExpiry(){return this.turnServersExpiry}get pollingTurnServers(){return void 0!==this.checkTurnServersIntervalID}checkTurnServers(){var e=this;return U((function*(){if(e.canSupportVoip){var t=!1,n=e.turnServersExpiry-Date.now();if(n>xN)e.logger.debug("TURN creds are valid for another "+n+" ms: not fetching new ones."),t=!0;else{e.logger.debug("Fetching new TURN credentials");try{var r=yield e.turnServer();if(r.uris){e.logger.debug("Got TURN URIs: "+r.uris+" refresh in "+r.ttl+" secs");var i={urls:r.uris,username:r.username,credential:r.password};e.turnServers=[i],e.turnServersExpiry=Date.now()+1e3*r.ttl,t=!0,e.emit(Oe.TurnServers,e.turnServers)}}catch(t){e.logger.error("Failed to get TURN URIs",t),403===t.httpStatus?(e.logger.info("TURN access unavailable for this account: stopping credentials checks"),null!==e.checkTurnServersIntervalID&&globalThis.clearInterval(e.checkTurnServersIntervalID),e.checkTurnServersIntervalID=void 0,e.emit(Oe.TurnServersError,t,!0)):e.emit(Oe.TurnServersError,t,!1)}}return t}}))()}setFallbackICEServerAllowed(e){this.fallbackICEServerAllowed=e}isFallbackICEServerAllowed(){return this.fallbackICEServerAllowed}isSynapseAdministrator(){var e=Ie("/_synapse/admin/v1/users/$userId/admin",{$userId:this.getUserId()});return this.http.authedRequest(ae.Get,e,void 0,void 0,{prefix:""}).then((e=>e.admin))}whoisSynapseUser(e){var t=Ie("/_synapse/admin/v1/whois/$userId",{$userId:e});return this.http.authedRequest(ae.Get,t,void 0,void 0,{prefix:""})}deactivateSynapseUser(e){var t=Ie("/_synapse/admin/v1/deactivate/$userId",{$userId:e});return this.http.authedRequest(ae.Post,t,void 0,void 0,{prefix:""})}fetchClientWellKnown(){var e=this;return U((function*(){var t;e.clientWellKnownPromise=it.getRawClientConfig(null!==(t=e.getDomain())&&void 0!==t?t:void 0),e.clientWellKnown=yield e.clientWellKnownPromise,e.emit(Oe.ClientWellKnown,e.clientWellKnown)}))()}getClientWellKnown(){return this.clientWellKnown}waitForClientWellKnown(){if(!this.clientRunning)throw new Error("Client is not running");return this.clientWellKnownPromise}storeClientOptions(){var e=["boolean","string","number"],t=Object.entries(this.clientOpts).filter((t=>{var[n,r]=t;return e.includes(typeof r)})).reduce(((e,t)=>{var[n,r]=t;return e[n]=r,e}),{});return this.store.storeClientOptions(t)}_unstable_getSharedRooms(e){var t=this;return U((function*(){var n,r,i=yield t.doesServerSupportUnstableFeature($H),o=yield t.doesServerSupportUnstableFeature(HH),s=yield t.doesServerSupportUnstableFeature(BH);if(!i&&!o&&!s)throw Error("Server does not support the Mutual Rooms API");s?(n="/uk.half-shot.msc2666/user/mutual_rooms",r={user_id:e}):(n=Ie("/uk.half-shot.msc2666/user/".concat(o?"mutual_rooms":"shared_rooms","/$userId"),{$userId:e}),r={});var a=[],l=null;do{var c={};null!=l&&s&&(c.batch_token=l);var u=yield t.http.authedRequest(ae.Get,n,dr(dr({},r),c),void 0,{prefix:fr.Unstable});a.push(...u.joined),l=void 0!==u.next_batch_token?u.next_batch_token:null}while(null!=l);return a}))()}getVersions(){var e=this;return U((function*(){if(e.serverVersionsPromise)return e.serverVersionsPromise;e.serverVersionsPromise=e.http.authedRequest(ae.Get,"/_matrix/client/versions",void 0,void 0,{prefix:""}).catch((t=>{throw e.serverVersionsPromise=void 0,t}));var t=yield e.serverVersionsPromise;return e.canSupport=yield wse(t),e.serverVersionsPromise}))()}isVersionSupported(e){var t=this;return U((function*(){var{versions:n}=yield t.getVersions();return n&&n.includes(e)}))()}doesServerSupportUnstableFeature(e){var t=this;return U((function*(){var n=yield t.getVersions();if(!n)return!1;var r=n.unstable_features;return r&&!!r[e]}))()}doesServerForceEncryptionForPreset(e){var t=this;return U((function*(){var n=yield t.getVersions();if(!n)return!1;var r=n.unstable_features,i=e.includes("_chat")?e.substring(0,e.indexOf("_chat")):e;return r&&!!r["io.element.e2ee_forced.".concat(i)]}))()}doesServerSupportThread(){var e=this;return U((function*(){if(yield e.isVersionSupported("v1.4"))return{threads:ai.Stable,list:ai.Stable,fwdPagination:ai.Stable};try{var[t,n,r,i,o,s]=yield Promise.all([e.doesServerSupportUnstableFeature("org.matrix.msc3440"),e.doesServerSupportUnstableFeature("org.matrix.msc3440.stable"),e.doesServerSupportUnstableFeature("org.matrix.msc3856"),e.doesServerSupportUnstableFeature("org.matrix.msc3856.stable"),e.doesServerSupportUnstableFeature("org.matrix.msc3715"),e.doesServerSupportUnstableFeature("org.matrix.msc3715.stable")]);return{threads:H_(n,t),list:H_(i,r),fwdPagination:H_(s,o)}}catch{return{threads:ai.None,list:ai.None,fwdPagination:ai.None}}}))()}hasLazyLoadMembersEnabled(){var e;return!(null===(e=this.clientOpts)||void 0===e||!e.lazyLoadMembers)}setCanResetTimelineCallback(e){this.canResetTimelineCallback=e}getCanResetTimelineCallback(){return this.canResetTimelineCallback}relations(e,t,n,r){var i=arguments,o=this;return U((function*(){var s,a,l=i.length>4&&void 0!==i[4]?i[4]:{dir:ht.Backward},c=r?o.getEncryptedIfNeededEventType(e,r):null,[u,d]=yield Promise.all([o.fetchRoomEvent(e,t),o.fetchRelations(e,t,n,c,l)]),h=o.getEventMapper(),p=u?h(u):void 0,f=d.chunk.map(h);if(c===ee.RoomMessageEncrypted){var m=p?f.concat(p):f;yield Promise.all(m.map((e=>o.decryptEventIfNeeded(e)))),null!==r&&(f=f.filter((e=>e.getType()===r)))}return p&&n===cn.Replace&&(f=f.filter((e=>e.getSender()===p.getSender()))),{originalEvent:p??null,events:f,nextBatch:null!==(s=d.next_batch)&&void 0!==s?s:null,prevBatch:null!==(a=d.prev_batch)&&void 0!==a?a:null}}))()}generateClientSecret(){return _s(32)}decryptEventIfNeeded(e,t){return e.shouldAttemptDecryption()&&this.getCrypto()&&e.attemptDecryption(this.cryptoBackend,t),e.isBeingDecrypted()?e.getDecryptionPromise():Promise.resolve()}termsUrlForService(e,t){switch(e){case Sk.IS:return this.http.getUrl("/terms",void 0,Qa.V2,t);case Sk.IM:return this.http.getUrl("/terms",void 0,"/_matrix/integrations/v1",t);default:throw new Error("Unsupported service type")}}getHomeserverUrl(){return this.baseUrl}getIdentityServerUrl(){var e,t;return arguments.length>0&&void 0!==arguments[0]&&arguments[0]&&(null!==(e=this.idBaseUrl)&&void 0!==e&&e.startsWith("http://")||null!==(t=this.idBaseUrl)&&void 0!==t&&t.startsWith("https://"))?this.idBaseUrl.split("://")[1]:this.idBaseUrl}setIdentityServerUrl(e){this.idBaseUrl=GT(e),this.http.setIdBaseUrl(this.idBaseUrl)}getAccessToken(){return this.http.opts.accessToken||null}getRefreshToken(){var e;return null!==(e=this.http.opts.refreshToken)&&void 0!==e?e:null}setAccessToken(e){this.http.opts.accessToken=e,this.serverVersionsPromise=void 0}isLoggedIn(){return void 0!==this.http.opts.accessToken}makeTxnId(){return"m"+(new Date).getTime()+"."+this.txnCtr++}isUsernameAvailable(e){return this.http.authedRequest(ae.Get,"/register/available",{username:e}).then((e=>e.available)).catch((e=>"M_USER_IN_USE"!==e.errcode&&Promise.reject(e)))}register(e,t,n,r,i,o,s){n&&(r.session=n);var a={auth:r,refresh_token:!0};return null!=e&&(a.username=e),null!=t&&(a.password=t),null!=o&&(a.guest_access_token=o),null!=s&&(a.inhibit_login=s),this.registerRequest(a)}registerGuest(){var{body:e}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.registerRequest(e||{},"guest")}registerRequest(e,t){var n={};return t&&(n.kind=t),this.http.request(ae.Post,"/register",n,e)}refreshToken(e){var t=t=>this.http.authedRequest(ae.Post,"/refresh",void 0,{refresh_token:e},{prefix:t,inhibitLogoutEmit:!0});return t(fr.V3).catch((e=>{if("M_UNRECOGNIZED"===e.errcode)return t(fr.V1);throw e}))}loginFlows(){return this.http.request(ae.Get,"/login")}login(e,t){return this.loginRequest(dr(dr({},t),{},{type:e})).then((e=>(e.access_token&&e.user_id&&(this.http.opts.accessToken=e.access_token,this.credentials={userId:e.user_id}),e)))}loginWithPassword(e,t){return this.login("m.login.password",{user:e,password:t})}getCasLoginUrl(e){return this.getSsoLoginUrl(e,"cas")}getSsoLoginUrl(e){var t=arguments.length>2?arguments[2]:void 0,n=arguments.length>3?arguments[3]:void 0,r="/login/"+(arguments.length>1&&void 0!==arguments[1]?arguments[1]:"sso")+"/redirect";t&&(r+="/"+t);var i={redirectUrl:e,[Pae.unstable]:n};return this.http.getUrl(r,i).href}loginWithToken(e){return this.login("m.login.token",{token:e})}loginRequest(e){var t=this;return U((function*(){return yield t.http.authedRequest(ae.Post,"/login",void 0,e)}))()}logout(){var e=arguments,t=this;return U((function*(){return e.length>0&&void 0!==e[0]&&e[0]&&(t.stopClient(),t.http.abort()),t.http.authedRequest(ae.Post,"/logout")}))()}deactivateAccount(e,t){var n={};return e&&(n.auth=e),void 0!==t&&(n.erase=t),this.http.authedRequest(ae.Post,"/account/deactivate",void 0,n)}requestLoginToken(e){var t=this;return U((function*(){var n={auth:e};return t.http.authedRequest(ae.Post,"/login/get_token",void 0,n,{prefix:fr.V1})}))()}getFallbackAuthUrl(e,t){var n=Ie("/auth/$loginType/fallback/web",{$loginType:e});return this.http.getUrl(n,{session:t}).href}createRoom(e){var t=this;return U((function*(){var n,r=(e.invite_3pid||[]).filter((e=>!e.id_access_token));if(r.length>0&&null!==(n=t.identityServer)&&void 0!==n&&n.getAccessToken){var i=yield t.identityServer.getAccessToken();if(i)for(var o of r)o.id_access_token=i}return t.http.authedRequest(ae.Post,"/createRoom",void 0,e)}))()}fetchRelations(e,t,n,r){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{dir:ht.Backward};dn.hasServerSideFwdPaginationSupport===ai.Experimental&&(i=ZA("dir","org.matrix.msc3715.dir",i)),this.canSupport.get(vr.RelationsRecursion)===gr.Unstable&&(i=ZA("recurse","org.matrix.msc3981.recurse",i));var o=JI(i),s="/rooms/$roomId/relations/$eventId";null!==n?(s+="/$relationType",null!==r&&(s+="/$eventType")):null!==r&&(this.logger.warn("eventType: ".concat(r," ignored when fetching\n            relations as relationType is null")),r=null);var a=Ie(s+"?"+o,{$roomId:e,$eventId:t,$relationType:n,$eventType:r});return this.http.authedRequest(ae.Get,a,void 0,void 0,{prefix:fr.V1})}roomState(e){var t=Ie("/rooms/$roomId/state",{$roomId:e});return this.http.authedRequest(ae.Get,t)}fetchRoomEvent(e,t){var n=Ie("/rooms/$roomId/event/$eventId",{$roomId:e,$eventId:t});return this.http.authedRequest(ae.Get,n)}members(e,t,n,r){var i={};t&&(i.membership=t),n&&(i.not_membership=n),r&&(i.at=r);var o=Ie("/rooms/$roomId/members?"+JI(i),{$roomId:e});return this.http.authedRequest(ae.Get,o)}upgradeRoom(e,t){var n=Ie("/rooms/$roomId/upgrade",{$roomId:e});return this.http.authedRequest(ae.Post,n,void 0,{new_version:t})}getStateEvent(e,t,n){var r={$roomId:e,$eventType:t,$stateKey:n},i=Ie("/rooms/$roomId/state/$eventType",r);return void 0!==n&&(i=Ie(i+"/$stateKey",r)),this.http.authedRequest(ae.Get,i)}sendStateEvent(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{},o={$roomId:e,$eventType:t,$stateKey:r},s=Ie("/rooms/$roomId/state/$eventType",o);return void 0!==r&&(s=Ie(s+"/$stateKey",o)),this.http.authedRequest(ae.Put,s,void 0,n,i)}roomInitialSync(e,t){var n,r=Ie("/rooms/$roomId/initialSync",{$roomId:e});return this.http.authedRequest(ae.Get,r,{limit:null!==(n=null==t?void 0:t.toString())&&void 0!==n?n:"30"})}setRoomReadMarkersHttpRequest(e,t,n,r){var i=this;return U((function*(){var o=Ie("/rooms/$roomId/read_markers",{$roomId:e}),s={[yi.FullyRead]:t,[yi.Read]:n};return((yield i.doesServerSupportUnstableFeature("org.matrix.msc2285.stable"))||(yield i.isVersionSupported("v1.4")))&&(s[yi.ReadPrivate]=r),i.http.authedRequest(ae.Post,o,void 0,s)}))()}getJoinedRooms(){var e=Ie("/joined_rooms",{});return this.http.authedRequest(ae.Get,e)}getJoinedRoomMembers(e){var t=Ie("/rooms/$roomId/joined_members",{$roomId:e});return this.http.authedRequest(ae.Get,t)}publicRooms(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{server:t,limit:n,since:r}=e,i=Lie(e,Rae);if(0===Object.keys(i).length){var o={server:t,limit:n,since:r};return this.http.authedRequest(ae.Get,"/publicRooms",o)}var s={server:t},a=dr({limit:n,since:r},i);return this.http.authedRequest(ae.Post,"/publicRooms",s,a)}createAlias(e,t){var n=Ie("/directory/room/$alias",{$alias:e}),r={room_id:t};return this.http.authedRequest(ae.Put,n,void 0,r)}deleteAlias(e){var t=Ie("/directory/room/$alias",{$alias:e});return this.http.authedRequest(ae.Delete,t)}getLocalAliases(e){var t=Ie("/rooms/$roomId/aliases",{$roomId:e}),n=fr.V3;return this.http.authedRequest(ae.Get,t,void 0,void 0,{prefix:n})}getRoomIdForAlias(e){var t=Ie("/directory/room/$alias",{$alias:e});return this.http.authedRequest(ae.Get,t)}getRoomDirectoryVisibility(e){var t=Ie("/directory/list/room/$roomId",{$roomId:e});return this.http.authedRequest(ae.Get,t)}setRoomDirectoryVisibility(e,t){var n=Ie("/directory/list/room/$roomId",{$roomId:e});return this.http.authedRequest(ae.Put,n,void 0,{visibility:t})}searchUserDirectory(e){var{term:t,limit:n}=e,r={search_term:t};return void 0!==n&&(r.limit=n),this.http.authedRequest(ae.Post,"/user_directory/search",void 0,r)}uploadContent(e,t){return this.http.uploadContent(e,t)}cancelUpload(e){return this.http.cancelUpload(e)}getCurrentUploads(){return this.http.getCurrentUploads()}getProfileInfo(e,t){var n=t?Ie("/profile/$userId/$info",{$userId:e,$info:t}):Ie("/profile/$userId",{$userId:e});return this.http.authedRequest(ae.Get,n)}doesServerSupportExtendedProfiles(){var e=this;return U((function*(){return e.doesServerSupportUnstableFeature(VH)}))()}getExtendedProfileRequestPrefix(){var e=this;return U((function*(){return(yield e.doesServerSupportUnstableFeature("uk.tcpip.msc4133.stable"))?fr.V3:"/_matrix/client/unstable/uk.tcpip.msc4133"}))()}getExtendedProfile(e){var t=this;return U((function*(){if(!(yield t.doesServerSupportExtendedProfiles()))throw new Error("Server does not support extended profiles");return t.http.authedRequest(ae.Get,Ie("/profile/$userId",{$userId:e}),void 0,void 0,{prefix:yield t.getExtendedProfileRequestPrefix()})}))()}getExtendedProfileProperty(e,t){var n=this;return U((function*(){if(!(yield n.doesServerSupportExtendedProfiles()))throw new Error("Server does not support extended profiles");return(yield n.http.authedRequest(ae.Get,Ie("/profile/$userId/$key",{$userId:e,$key:t}),void 0,void 0,{prefix:yield n.getExtendedProfileRequestPrefix()}))[t]}))()}setExtendedProfileProperty(e,t){var n=this;return U((function*(){if(!(yield n.doesServerSupportExtendedProfiles()))throw new Error("Server does not support extended profiles");var r=n.getUserId();yield n.http.authedRequest(ae.Put,Ie("/profile/$userId/$key",{$userId:r,$key:e}),void 0,{[e]:t},{prefix:yield n.getExtendedProfileRequestPrefix()})}))()}deleteExtendedProfileProperty(e){var t=this;return U((function*(){if(!(yield t.doesServerSupportExtendedProfiles()))throw new Error("Server does not support extended profiles");var n=t.getUserId();yield t.http.authedRequest(ae.Delete,Ie("/profile/$userId/$key",{$userId:n,$key:e}),void 0,void 0,{prefix:yield t.getExtendedProfileRequestPrefix()})}))()}patchExtendedProfile(e){var t=this;return U((function*(){if(!(yield t.doesServerSupportExtendedProfiles()))throw new Error("Server does not support extended profiles");var n=t.getUserId();return t.http.authedRequest(ae.Patch,Ie("/profile/$userId",{$userId:n}),{},e,{prefix:yield t.getExtendedProfileRequestPrefix()})}))()}setExtendedProfile(e){var t=this;return U((function*(){if(!(yield t.doesServerSupportExtendedProfiles()))throw new Error("Server does not support extended profiles");var n=t.getUserId();yield t.http.authedRequest(ae.Put,Ie("/profile/$userId",{$userId:n}),{},e,{prefix:yield t.getExtendedProfileRequestPrefix()})}))()}getThreePids(){return this.http.authedRequest(ae.Get,"/account/3pid")}addThreePidOnly(e){var t=this;return U((function*(){return t.http.authedRequest(ae.Post,"/account/3pid/add",void 0,e)}))()}bindThreePid(e){var t=this;return U((function*(){return t.http.authedRequest(ae.Post,"/account/3pid/bind",void 0,e)}))()}unbindThreePid(e,t){var n=this;return U((function*(){var r={medium:e,address:t,id_server:n.getIdentityServerUrl(!0)};return n.http.authedRequest(ae.Post,"/account/3pid/unbind",void 0,r)}))()}deleteThreePid(e,t){return this.http.authedRequest(ae.Post,"/account/3pid/delete",void 0,{medium:e,address:t})}setPassword(e,t,n){var r={auth:e,new_password:t,logout_devices:n};return this.http.authedRequest(ae.Post,"/account/password",void 0,r)}getDevices(){return this.http.authedRequest(ae.Get,"/devices")}getDevice(e){var t=Ie("/devices/$device_id",{$device_id:e});return this.http.authedRequest(ae.Get,t)}setDeviceDetails(e,t){var n=Ie("/devices/$device_id",{$device_id:e});return this.http.authedRequest(ae.Put,n,void 0,t)}deleteDevice(e,t){var n=Ie("/devices/$device_id",{$device_id:e}),r={};return t&&(r.auth=t),this.http.authedRequest(ae.Delete,n,void 0,r)}deleteMultipleDevices(e,t){var n={devices:e};t&&(n.auth=t);return this.http.authedRequest(ae.Post,"/delete_devices",void 0,n)}getPushers(){var e=this;return U((function*(){var t=yield e.http.authedRequest(ae.Get,"/pushers");return(yield e.doesServerSupportUnstableFeature("org.matrix.msc3881"))||(t.pushers=t.pushers.map((e=>(e.hasOwnProperty(ok.name)||(e[ok.name]=!0),e)))),t}))()}setPusher(e){return this.http.authedRequest(ae.Post,"/pushers/set",void 0,e)}removePusher(e,t){var n={pushkey:e,app_id:t,kind:null};return this.http.authedRequest(ae.Post,"/pushers/set",void 0,n)}setLocalNotificationSettings(e,t){var n="".concat(w$.name,".").concat(e);return this.setAccountData(n,t)}getPushRules(){return this.http.authedRequest(ae.Get,"/pushrules/").then((e=>(this.setPushRules(e),this.pushRules)))}setPushRules(e){this.pushRules=Co.rewriteDefaultRules(e,this.getUserId()),this.pushProcessor.updateCachedPushRuleKeys(this.pushRules)}addPushRule(e,t,n,r){var i=Ie("/pushrules/"+e+"/$kind/$ruleId",{$kind:t,$ruleId:n});return this.http.authedRequest(ae.Put,i,void 0,r)}deletePushRule(e,t,n){var r=Ie("/pushrules/"+e+"/$kind/$ruleId",{$kind:t,$ruleId:n});return this.http.authedRequest(ae.Delete,r)}setPushRuleEnabled(e,t,n,r){var i=Ie("/pushrules/"+e+"/$kind/$ruleId/enabled",{$kind:t,$ruleId:n});return this.http.authedRequest(ae.Put,i,void 0,{enabled:r})}setPushRuleActions(e,t,n,r){var i=Ie("/pushrules/"+e+"/$kind/$ruleId/actions",{$kind:t,$ruleId:n});return this.http.authedRequest(ae.Put,i,void 0,{actions:r})}search(e,t){var{body:n,next_batch:r}=e,i={};return r&&(i.next_batch=r),this.http.authedRequest(ae.Post,"/search",i,n,{abortSignal:t})}uploadKeysRequest(e,t){return this.http.authedRequest(ae.Post,"/keys/upload",void 0,e)}uploadKeySignatures(e){return this.http.authedRequest(ae.Post,"/keys/signatures/upload",void 0,e)}downloadKeysForUsers(e){var{token:t}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n={device_keys:{}};return void 0!==t&&(n.token=t),e.forEach((e=>{n.device_keys[e]=[]})),this.http.authedRequest(ae.Post,"/keys/query",void 0,n)}claimOneTimeKeys(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"signed_curve25519",n=arguments.length>2?arguments[2]:void 0,r={};for(var[i,o]of(void 0===t&&(t="signed_curve25519"),e)){var s=r[i]||{};qb(r,i,s),qb(s,o,t)}var a={one_time_keys:r};n&&(a.timeout=n);return this.http.authedRequest(ae.Post,"/keys/claim",void 0,a)}getKeyChanges(e,t){var n={from:e,to:t};return this.http.authedRequest(ae.Get,"/keys/changes",n)}uploadDeviceSigningKeys(e,t){var n=Object.assign({},t);return e&&Object.assign(n,{auth:e}),this.http.authedRequest(ae.Post,"/keys/device_signing/upload",void 0,n,{prefix:fr.Unstable})}registerWithIdentityServer(e){if(!this.idBaseUrl)throw new Error("No identity server base URL set");var t=this.http.getUrl("/account/register",void 0,Qa.V2,this.idBaseUrl);return this.http.requestOtherUrl(ae.Post,t,e)}requestEmailToken(e,t,n,r,i){var o={client_secret:t,email:e,send_attempt:null==n?void 0:n.toString()};return r&&(o.next_link=r),this.http.idServerRequest(ae.Post,"/validate/email/requestToken",o,Qa.V2,i)}requestMsisdnToken(e,t,n,r,i,o){var s={client_secret:n,country:e,phone_number:t,send_attempt:null==r?void 0:r.toString()};return i&&(s.next_link=i),this.http.idServerRequest(ae.Post,"/validate/msisdn/requestToken",s,Qa.V2,o)}submitMsisdnToken(e,t,n,r){var i={sid:e,client_secret:t,token:n};return this.http.idServerRequest(ae.Post,"/validate/msisdn/submitToken",i,Qa.V2,r??void 0)}submitMsisdnTokenOtherUrl(e,t,n,r){var i={sid:t,client_secret:n,token:r};return this.http.requestOtherUrl(ae.Post,e,i)}getIdentityHashDetails(e){return this.http.idServerRequest(ae.Get,"/hash_details",void 0,Qa.V2,e)}identityHashedLookup(e,t){var n=this;return U((function*(){var r={},i=yield n.getIdentityHashDetails(t);if(!i||!i.lookup_pepper||!i.algorithms)throw new Error("Unsupported identity server: bad response");r.pepper=i.lookup_pepper;var o,s={};if(i.algorithms.includes("sha256"))r.addresses=yield Promise.all(e.map((o=U((function*(e){var t=e[0].toLowerCase(),n=e[1].toLowerCase(),i=PE(yield kH("".concat(t," ").concat(n," ").concat(r.pepper)));return s[i]=e[0],i})),function(e){return o.apply(this,arguments)}))),r.algorithm="sha256";else{if(!i.algorithms.includes("none"))throw new Error("Unsupported identity server: unknown hash algorithm");r.addresses=e.map((e=>{var t=e[0].toLowerCase(),n=e[1].toLowerCase(),r="".concat(t," ").concat(n);return s[r]=e[0],r})),r.algorithm="none"}var a=yield n.http.idServerRequest(ae.Post,"/lookup",r,Qa.V2,t);if(null==a||!a.mappings)return[];var l=[];for(var c of Object.keys(a.mappings)){var u=a.mappings[c],d=s[c];if(!d)throw new Error("Identity server returned more results than expected");l.push({address:d,mxid:u})}return l}))()}lookupThreePid(e,t,n){var r=this;return U((function*(){var i=(yield r.identityHashedLookup([[t,e]],n)).find((e=>e.address===t));return i?{address:t,medium:e,mxid:i.mxid}:{}}))()}bulkLookupThreePids(e,t){var n=this;return U((function*(){var r=yield n.identityHashedLookup(e.map((e=>[e[1],e[0]])),t),i=[],o=function*(t){var n=e.find((e=>e[1]===t.address));if(!n)throw new Error("Identity sever returned unexpected results");i.push([n[0],t.address,t.mxid])};for(var s of r)yield*o(s);return{threepids:i}}))()}getIdentityAccount(e){return this.http.idServerRequest(ae.Get,"/account",void 0,Qa.V2,e)}sendToDevice(e,t,n){var r=Ie("/sendToDevice/$eventType/$txnId",{$eventType:e,$txnId:n||this.makeTxnId()}),i={messages:pd(t)},o=new Map;for(var[s,a]of t)o.set(s,Array.from(a.keys()));return this.logger.debug("PUT ".concat(r),o),this.http.authedRequest(ae.Put,r,void 0,i)}encryptAndSendToDevice(e,t,n){var r=this;return U((function*(){if(!r.cryptoBackend)throw new Error("Cannot encrypt to device event, your client does not support encryption.");var i=yield r.cryptoBackend.encryptToDeviceMessages(e,t,n);yield r.queueToDevice(i)}))()}queueToDevice(e){return this.toDeviceMessageQueue.queueBatch(e)}getThirdpartyProtocols(){return this.http.authedRequest(ae.Get,"/thirdparty/protocols").then((e=>{if(!e||"object"!=typeof e)throw new Error("/thirdparty/protocols did not return an object: ".concat(e));return e}))}getThirdpartyLocation(e,t){var n=Ie("/thirdparty/location/$protocol",{$protocol:e});return this.http.authedRequest(ae.Get,n,t)}getThirdpartyUser(e,t){var n=Ie("/thirdparty/user/$protocol",{$protocol:e});return this.http.authedRequest(ae.Get,n,t)}getTerms(e,t){var n=this.termsUrlForService(e,t);return this.http.requestOtherUrl(ae.Get,n)}agreeToTerms(e,t,n,r){var i=this.termsUrlForService(e,t),o={Authorization:"Bearer "+n};return this.http.requestOtherUrl(ae.Post,i,{user_accepts:r},{headers:o})}reportEvent(e,t,n,r){var i=Ie("/rooms/$roomId/report/$eventId",{$roomId:e,$eventId:t});return this.http.authedRequest(ae.Post,i,void 0,{score:n,reason:r})}reportRoom(e,t){var n=Ie("/rooms/$roomId/report",{$roomId:e});return this.http.authedRequest(ae.Post,n,void 0,{reason:t})}getRoomHierarchy(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=arguments.length>4?arguments[4]:void 0,o=Ie("/rooms/$roomId/hierarchy",{$roomId:e}),s={suggested_only:String(r),max_depth:null==n?void 0:n.toString(),from:i,limit:null==t?void 0:t.toString()};return this.http.authedRequest(ae.Get,o,s,void 0,{prefix:fr.V1}).catch((e=>{if("M_UNRECOGNIZED"===e.errcode)return this.http.authedRequest(ae.Get,o,s,void 0,{prefix:"/_matrix/client/unstable/org.matrix.msc2946"});throw e}))}unstableCreateFileTree(e){var t=this;return U((function*(){var{room_id:n}=yield t.createRoom({name:e,preset:ME.PrivateChat,power_level_content_override:dr(dr({},Eoe),{},{users:{[t.getUserId()]:100}}),creation_content:{[Kb]:Ph.Space},initial_state:[{type:nk.name,state_key:ik.name,content:{[rk.name]:!0}},{type:ee.RoomEncryption,state_key:"",content:{algorithm:"m.megolm.v1.aes-sha2"}}]});return new pN(t,n)}))()}unstableGetFileTreeSpace(e){var t,n,r=this.getRoom(e);if((null==r?void 0:r.getMyMembership())!==Ke.Join)return null;var i=r.currentState.getStateEvents(ee.RoomCreate,""),o=r.currentState.getStateEvents(nk.name,ik.name);if(!i)throw new Error("Expected single room create event");return null!=o&&null!==(t=o.getContent())&&void 0!==t&&t[rk.name]&&(null===(n=i.getContent())||void 0===n?void 0:n[Kb])===Ph.Space?new pN(this,e):null}slidingSync(e,t,n){var r={};e.pos&&(r.pos=e.pos,delete e.pos),e.timeout&&(r.timeout=e.timeout,delete e.timeout);var i=e.clientTimeout;return delete e.clientTimeout,this.http.authedRequest(ae.Post,"/sync",r,e,{prefix:"/_matrix/client/unstable/org.matrix.simplified_msc3575",baseUrl:t,localTimeoutMs:i,abortSignal:n})}supportsThreads(){var e;return(null===(e=this.clientOpts)||void 0===e?void 0:e.threadSupport)||!1}supportsIntentionalMentions(){return this.canSupport.get(vr.IntentionalMentions)!==gr.Unsupported}getRoomSummary(e,t){var n=this;return U((function*(){var r={prefix:"/_matrix/client/unstable/im.nheko.summary"};try{var i=Ie("/summary/$roomid",{$roomid:e});return yield n.http.authedRequest(ae.Get,i,{via:t},void 0,r)}catch(i){if(i instanceof bn&&"M_UNRECOGNIZED"===i.errcode){var o=Ie("/rooms/$roomid/summary",{$roomid:e});return yield n.http.authedRequest(ae.Get,o,{via:t},void 0,r)}throw i}}))()}processThreadEvents(e,t,n){e.processThreadedEvents(t,n)}processThreadRoots(e,t,n){this.supportsThreads()&&e.processThreadRoots(t,n)}processBeaconEvents(e,t){this.processAggregatedTimelineEvents(e,t)}processAggregatedTimelineEvents(e,t){null!=t&&t.length&&e&&(e.currentState.processBeaconEvents(t,this),e.processPollEvents(t))}whoami(){var e=this;return U((function*(){return e.http.authedRequest(ae.Get,"/account/whoami")}))()}timestampToEvent(e,t,n){var r=this;return U((function*(){var i=Ie("/rooms/$roomId/timestamp_to_event",{$roomId:e}),o={ts:t.toString(),dir:n};try{return yield r.http.authedRequest(ae.Get,i,o,void 0,{prefix:fr.V1})}catch(e){if("M_UNRECOGNIZED"===e.errcode&&(400===e.httpStatus||404===e.httpStatus||405===e.httpStatus))return yield r.http.authedRequest(ae.Get,i,o,void 0,{prefix:"/_matrix/client/unstable/org.matrix.msc3030"});throw e}}))()}getAuthIssuer(){var e=this;return U((function*(){return e.http.request(ae.Get,"/auth_issuer",void 0,void 0,{prefix:fr.Unstable+"/org.matrix.msc2965"})}))()}getAuthMetadata(){var e=this;return U((function*(){var t;try{t=yield e.http.request(ae.Get,"/auth_metadata",void 0,void 0,{prefix:fr.Unstable+"/org.matrix.msc2965"})}catch(t){if(t instanceof bn&&"M_UNRECOGNIZED"===t.errcode){var{issuer:n}=yield e.getAuthIssuer();return rL(n)}throw t}return iL(t)}))()}}function PN(e){return Object.fromEntries(Object.entries(e).map((e=>{var[t,n]=e;return["".concat(ha,".").concat(t),n]})))}function qH(e,t){var n,r=e.getUserId(),i=t.getId(),o=e.getRoom(t.getRoomId());if(o&&r&&i){if(!o.findEventById(i))return void A.info("Decrypted event ".concat(t.getId()," is not in room ").concat(o.roomId,": ignoring"));var s,a=!!t.threadRootId&&!t.isThreadRoot;if(a){var l=o.getThread(t.threadRootId);s=!l||l.hasUserReadEvent(r,i)}else s=o.hasUserReadEvent(r,i);if(!s){var c=e.getPushActionsForEvent(t,!0);if(!(null==c||null===(n=c.tweaks)||void 0===n||!n.highlight)){var u=o.getUnreadCountForEventContext(jt.Highlight,t)+1;a?o.setThreadUnreadNotificationCount(t.threadRootId,jt.Highlight,u):o.setUnreadNotificationCount(jt.Highlight,u)}if(!(null==c||!c.notify)){var d=o.getUnreadCountForEventContext(jt.Total,t)+1;a?o.setThreadUnreadNotificationCount(t.threadRootId,jt.Total,d):o.setUnreadNotificationCount(jt.Total,d)}}}}function up(e){return Pv(e)?Ey:e.threadRootId}function Pv(e){return!(e.threadRootId&&!e.isThreadRoot)||(e.isRelation()?!e.isRelation(Zt.name)&&e.relationEventId===e.threadRootId:(A.warn("Event is not a relation or a thread root, but still has a threadRootId! id=".concat(e.getId())),!0))}function LN(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function ON(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?LN(Object(n),!0).forEach((function(t){L(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):LN(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}L(jE,"RESTORE_BACKUP_ERROR_BAD_KEY","RESTORE_BACKUP_ERROR_BAD_KEY");var _i=function(e){return e.New="Thread.new",e.Update="Thread.update",e.NewReply="Thread.newReply",e.ViewThread="Thread.viewThread",e.Delete="Thread.delete",e}({}),ai=function(e){return e[e.None=0]="None",e[e.Experimental=1]="Experimental",e[e.Stable=2]="Stable",e}({});function H_(e,t){return e?ai.Stable:t?ai.Experimental:ai.None}class dn extends Y${constructor(e,t,n){var r,i,o;if(super(),r=this,this.id=e,this.rootEvent=t,L(this,"timelineSet",void 0),L(this,"_currentUserParticipated",!1),L(this,"reEmitter",void 0),L(this,"lastEvent",void 0),L(this,"replyCount",0),L(this,"lastPendingEvent",void 0),L(this,"pendingReplyCount",0),L(this,"room",void 0),L(this,"client",void 0),L(this,"pendingEventOrdering",void 0),L(this,"processRootEventPromise",void 0),L(this,"initialEventsFetched",!dn.hasServerSideSupport),L(this,"initalEventFetchProm",void 0),L(this,"replayEvents",[]),L(this,"onTimelineReset",U((function*(){yield r.processRootEventPromise,r.processRootEventPromise=void 0}))),L(this,"onBeforeRedaction",((e,t)=>{null!=e&&e.isRelation(Zt.name)&&this.room.eventShouldLiveIn(e).threadId===this.id&&e.getId()!==this.id&&!t.status&&(this.replyCount--,this.updatePendingReplyCount(),this.emit(_i.Update,this))})),L(this,"onRedaction",(o=U((function*(e,t,n){if(n===r.id)if(r.replyCount<=0){for(var i of r.timeline)r.clearEventMetadata(i);r.lastEvent=r.rootEvent,r._currentUserParticipated=!1,r.emit(_i.Delete,r)}else{var o;(null===(o=r.lastEvent)||void 0===o?void 0:o.getId())===e.getAssociatedId()&&(yield r.processRootEventPromise,r.processRootEventPromise=void 0),yield r.updateThreadMetadata()}})),function(e,t,n){return o.apply(this,arguments)})),L(this,"onTimelineEvent",((e,t,n)=>{if(!n){var r=e.getSender();r&&t&&this.shouldSendLocalEchoReceipt(r,e)&&t.addLocalEchoReceipt(r,e,yi.Read),e.getId()!==this.id&&e.isRelation(Zt.name)&&this.replyCount++}this.onEcho(e,n??!1)})),L(this,"onLocalEcho",(e=>{this.onEcho(e,!1)})),L(this,"onEcho",function(){var e=U((function*(e,t){e.threadRootId===r.id&&r.lastEvent!==e&&(yield r.updateThreadMetadata(),e.isRelation(Zt.name)&&(t||(r.lastEvent=void 0,r.emit(_i.NewReply,r,e))))}));return function(t,n){return e.apply(this,arguments)}}()),this.setMaxListeners(1e3),null==n||!n.room)throw new Error("element-web#22141: A thread requires a room in order to function");this.room=n.room,this.client=n.client,this.pendingEventOrdering=null!==(i=n.pendingEventOrdering)&&void 0!==i?i:cp.Chronological,this.timelineSet=new _h(this.room,{timelineSupport:!0,pendingEvents:!0},this.client,this),this.reEmitter=new Mp(this),this.reEmitter.reEmit(this.timelineSet,[ke.Timeline,ke.TimelineReset]),this.room.on(Mt.BeforeRedaction,this.onBeforeRedaction),this.room.on(ke.Redaction,this.onRedaction),this.room.on(ke.LocalEchoUpdated,this.onLocalEcho),this.room.on(ke.TimelineReset,this.onTimelineReset),this.timelineSet.on(ke.Timeline,this.onTimelineEvent),this.processReceipts(n.receipts),this.updateThreadMetadata(),this.setEventMetadata(this.rootEvent)}fetchRootEvent(){var e=this;return U((function*(){try{var t=yield e.client.fetchRoomEvent(e.roomId,e.id),n=e.client.getEventMapper();e.rootEvent=n(t)}catch(e){A.error("Failed to fetch thread root to construct thread with",e)}yield e.processEvent(e.rootEvent)}))()}static setServerSideSupport(e){dn.hasServerSideSupport=e,e!==ai.Stable&&(Dh.setPreferUnstable(!0),jh.setPreferUnstable(!0),Zt.setPreferUnstable(!0))}static setServerSideListSupport(e){dn.hasServerSideListSupport=e}static setServerSideFwdPaginationSupport(e){dn.hasServerSideFwdPaginationSupport=e}shouldSendLocalEchoReceipt(e,t){var n;if((null!==(n=this.client.canSupport.get(vr.RelationsRecursion))&&void 0!==n?n:gr.Unsupported)===gr.Unsupported){var r,i=null===(r=this.getReadReceiptForUserId(e))||void 0===r?void 0:r.eventId;if(i){var o=this.findEventById(i);if(o&&o.getTs()>t.getTs())return!1}}return!0}get roomState(){return this.room.getLiveTimeline().getState(Le.FORWARDS)}addEventToTimeline(e,t){this.findEventById(e.getId())||this.timelineSet.addEventToTimeline(e,this.liveTimeline,{toStartOfTimeline:t,fromCache:!1,roomState:this.roomState,addToState:!1})}insertEventIntoTimeline(e){var t=e.getId();t&&(this.findEventById(t)||this.timelineSet.insertEventIntoTimeline(e,this.liveTimeline,this.roomState,!1))}addEvents(e,t){e.forEach((e=>this.addEvent(e,t,!1))),this.updateThreadMetadata()}addEvent(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this.setEventMetadata(e);var r=this.lastReply(),i=!r||e.localTimestamp>=r.localTimestamp;if(dn.hasServerSideSupport){if(e.isRelation(cn.Annotation)||e.isRelation(cn.Replace))return void this.addRelatedThreadEvent(e,t);!t&&i?(this.addEventToTimeline(e,!1),this.fetchEditsWhereNeeded(e)):t?this.addEventToTimeline(e,t):this.insertEventIntoTimeline(e)}else this.addEventToTimeline(e,t),this.client.decryptEventIfNeeded(e);e.getId()!==this.id&&e.isRelation(Zt.name)&&!t&&i&&(this.lastEvent=void 0),n&&(this.emit(_i.NewReply,this,e),this.updateThreadMetadata())}addRelatedThreadEvent(e,t){var n,r,i,o;this.initialEventsFetched?(null!==(i=this.client.canSupport.get(vr.RelationsRecursion))&&void 0!==i?i:gr.Unsupported)===gr.Unsupported?this.insertEventIntoTimeline(e):this.addEventToTimeline(e,t):null===(o=this.replayEvents)||void 0===o||o.push(e);null===(n=this.timelineSet.relations)||void 0===n||n.aggregateParentEvent(e),null===(r=this.timelineSet.relations)||void 0===r||r.aggregateChildEvent(e,this.timelineSet)}processEvent(e){var t=this;return U((function*(){e&&(t.setEventMetadata(e),yield t.fetchEditsWhereNeeded(e))}))()}processReceipts(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];for(var{eventId:t,receiptType:n,userId:r,receipt:i,synthetic:o}of e)this.addReceiptToStructure(t,n,r,i,o)}getRootEventBundledRelationship(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.rootEvent;return null==e?void 0:e.getServerAggregatedRelation(Zt.name)}processRootEvent(){var e=this;return U((function*(){var t=e.getRootEventBundledRelationship();if(dn.hasServerSideSupport&&t){e.replyCount=t.count,e._currentUserParticipated=!!t.current_user_participated;var n=e.client.getEventMapper();e.lastEvent=n(ON(ON({},t.latest_event),{},{room_id:e.roomId})),e.updatePendingReplyCount(),yield e.processEvent(e.lastEvent)}}))()}updatePendingReplyCount(){var e=(this.pendingEventOrdering===cp.Detached?this.room.getPendingEvents():this.events).filter((e=>{var t;return e.threadRootId===this.id&&e.isRelation(Zt.name)&&null!==e.status&&e.getId()!==(null===(t=this.lastEvent)||void 0===t?void 0:t.getId())}));this.lastPendingEvent=e.length?e[e.length-1]:void 0,this.pendingReplyCount=e.length}resetLiveTimeline(e,t){var n=this;return U((function*(){var r=n.liveTimeline;n.timelineSet.resetLiveTimeline(e??void 0,t??void 0);var i,o,s=n.liveTimeline;e&&(i=(yield n.client.createMessagesRequest(n.roomId,e,1,ht.Forward)).end);t&&(o=(yield n.client.createMessagesRequest(n.roomId,t,1,ht.Backward)).start);t&&r.getPaginationToken(ht.Forward)===t&&r.setPaginationToken(o??null,ht.Forward),e&&s.getPaginationToken(ht.Backward)===e&&s.setPaginationToken(i??null,ht.Backward)}))()}updateThreadFromRootEvent(){var e=this;return U((function*(){dn.hasServerSideSupport&&(!e.initialEventsFetched&&!e.lastEvent&&(yield e.processRootEvent()),yield e.fetchRootEvent()),yield e.processRootEvent()}))()}updateThreadMetadata(){var e=this;return U((function*(){if(e.updatePendingReplyCount(),e.processRootEventPromise||(e.processRootEventPromise=e.updateThreadFromRootEvent()),yield e.processRootEventPromise,!e.initialEventsFetched)if(e.initalEventFetchProm)yield e.initalEventFetchProm;else try{for(var t of(e.timelineSet.resetLiveTimeline(),0===e.replyCount&&e.rootEvent?(e.timelineSet.addEventsToTimeline([e.rootEvent],!0,!1,e.liveTimeline,null),e.liveTimeline.setPaginationToken(null,ht.Backward)):(e.initalEventFetchProm=e.client.paginateEventTimeline(e.liveTimeline,{backwards:!0}),yield e.initalEventFetchProm),e.initialEventsFetched=!0,e.replayEvents))e.addEvent(t,!1);e.replayEvents=null,e.emit(ke.TimelineReset,e.room,e.timelineSet,!0)}catch(t){A.error("Failed to load start of newly created thread: ",t),e.initialEventsFetched=!1}e.emit(_i.Update,e)}))()}fetchEditsWhereNeeded(){var e=arguments,t=this;return U((function*(){var n,r;if((null!==(n=t.client.canSupport.get(vr.RelationsRecursion))&&void 0!==n?n:gr.Unsupported)===gr.Unsupported){for(var i=e.length,o=new Array(i),s=0;s<i;s++)o[s]=e[s];return Promise.all(o.filter(Lae).map((r=U((function*(e){try{var n=yield t.client.relations(t.roomId,e.getId(),cn.Replace,e.getType(),{limit:1});if(n.events.length){var r=n.events[0];e.makeReplaced(r),t.insertEventIntoTimeline(r)}}catch(e){A.error("Failed to load edits for encrypted thread event",e)}})),function(e){return r.apply(this,arguments)})))}}))()}setEventMetadata(e){e&&(Le.setEventMetadata(e,this.roomState,!1),e.setThread(this))}clearEventMetadata(e){var t;e&&(e.setThread(void 0),null===(t=e.event)||void 0===t||null===(t=t.unsigned)||void 0===t||null===(t=t["m.relations"])||void 0===t||delete t[Zt.name])}findEventById(e){return this.timelineSet.findEventById(e)}lastReply(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:e=>e.isRelation(Zt.name),t=this.timeline.length-1;t>=0;t--){var n=this.timeline[t];if(e(n))return n}return null}get roomId(){return this.room.roomId}get length(){return this.replyCount+this.pendingReplyCount}get replyToEvent(){var e,t;return null!==(e=null!==(t=this.lastPendingEvent)&&void 0!==t?t:this.lastEvent)&&void 0!==e?e:this.lastReply()}get timeline(){return this.events}get events(){return this.liveTimeline.getEvents()}has(e){return this.timelineSet.findEventById(e)instanceof Ci}get hasCurrentUserParticipated(){return this._currentUserParticipated}get liveTimeline(){return this.timelineSet.getLiveTimeline()}getUnfilteredTimelineSet(){return this.timelineSet}addReceipt(e,t){throw new Error("Unsupported function on the thread model")}getEventReadUpTo(e,t){var n=e===this.client.getUserId(),r=this.timeline[this.timeline.length-1];if(n&&r){var i=r.getTs()<this.room.getOldestThreadedReceiptTs(),o=r.getId();if(i&&o)return o}var s=super.getEventReadUpTo(e,t);if(r){var a=this.room.getLastUnthreadedReceiptFor(e);if(!a)return s;for(var l=(null===(c=this.timeline)||void 0===c?void 0:c.length)-1;l>=0;--l){var c,u,d=this.timeline[l];if(d.getId()===s)return s;if(d.getTs()<a.ts)return null!==(u=d.getId())&&void 0!==u?u:s}}return s}hasUserReadEvent(e,t){if(e===this.client.getUserId()){var n,r,i,o,s,a,l=(null!==(n=null===(r=this.lastReply())||void 0===r?void 0:r.getTs())&&void 0!==n?n:0)<this.room.getOldestThreadedReceiptTs(),c=null!==(i=null===(o=this.room.getLastUnthreadedReceiptFor(e))||void 0===o?void 0:o.ts)&&void 0!==i?i:0,u=(null!==(s=null==this||null===(a=this.lastReply())||void 0===a?void 0:a.getTs())&&void 0!==s?s:0)<c;if(l||u)return!0}return this.room.hasUserReadEvent(e,t)}setUnread(e,t){return this.room.setThreadUnreadNotificationCount(this.id,e,t)}getLastUnthreadedReceiptFor(e){return this.room.getLastUnthreadedReceiptFor(e)}}function Lae(e){return e.isEncrypted()&&(e.isRelation(Zt.name)||e.isThreadRoot)}L(dn,"hasServerSideSupport",ai.None),L(dn,"hasServerSideListSupport",ai.None),L(dn,"hasServerSideFwdPaginationSupport",ai.None);var Dh=new EE("related_by_senders","io.element.relation_senders"),jh=new EE("related_by_rel_types","io.element.relation_types"),Zt=new EE("m.thread","io.element.thread"),Eo=function(e){return e[e.My=0]="My",e[e.All=1]="All",e}({});function KH(e){return e===Eo.My?"participated":"all"}class MN extends Error{constructor(e,t,n){super(t),this.code=e,L(this,"detailedString",void 0),this.name="DecryptionError",this.detailedString=Oae(this,n)}}function Oae(e,t){var n=e.name+"[msg: "+e.message;return t&&(n+=", "+Object.keys(t).map((e=>e+": "+t[e])).join(", ")),n+="]"}var AN=Object.freeze({visible:!0}),Mt=function(e){return e.Decrypted="Event.decrypted",e.BeforeRedaction="Event.beforeRedaction",e.VisibilityChange="Event.visibilityChange",e.LocalEventIdReplaced="Event.localEventIdReplaced",e.Status="Event.status",e.Replaced="Event.replaced",e.RelationsCreated="Event.relationsCreated",e.SentinelUpdated="Event.sentinelUpdated",e}({});class Ci extends En{setMetadata(e,t){var n,r,i=this.isState()&&this.getType()===ee.RoomMember&&this.getSender()===this.getStateKey(),o=!1;if(i||null===(n=this.sender)||void 0===n||null===(n=n.events)||void 0===n||!n.member){var s=e.getSentinelMember(this.getSender());s!==this.sender&&(o=!0),this.sender=s}if(i||(null===(r=this.target)||void 0===r||null===(r=r.events)||void 0===r||!r.member)&&this.getType()===ee.RoomMember){var a=e.getSentinelMember(this.getStateKey());a!==this.target&&(o=!0),this.target=a}this.isState()&&t&&(this.forwardLooking=!1),o&&this.emit(Mt.SentinelUpdated)}constructor(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super(),this.event=t,L(this,"pushDetails",{}),L(this,"_replacingEvent",null),L(this,"_localRedactionEvent",null),L(this,"_isCancelled",!1),L(this,"clearEvent",void 0),L(this,"visibility",AN),L(this,"_hasCachedExtEv",!1),L(this,"_cachedExtEv",void 0),L(this,"_decryptionFailureReason",null),L(this,"senderCurve25519Key",null),L(this,"claimedEd25519Key",null),L(this,"forwardingCurve25519KeyChain",[]),L(this,"untrusted",null),L(this,"decryptionPromise",null),L(this,"retryDecryption",!1),L(this,"txnId",void 0),L(this,"thread",void 0),L(this,"threadId",void 0),L(this,"localTimestamp",void 0),L(this,"sender",null),L(this,"target",null),L(this,"status",null),L(this,"error",null),L(this,"forwardLooking",!0),L(this,"reEmitter",void 0),["state_key","type","sender","room_id","membership"].forEach((e=>{"string"==typeof t[e]&&(t[e]=KT(t[e]))})),["membership","avatar_url","displayname"].forEach((e=>{var n;"string"==typeof(null===(n=t.content)||void 0===n?void 0:n[e])&&(t.content[e]=KT(t.content[e]))})),["rel_type"].forEach((e=>{var n;"string"==typeof(null===(n=t.content)||void 0===n||null===(n=n["m.relates_to"])||void 0===n?void 0:n[e])&&(t.content["m.relates_to"][e]=KT(t.content["m.relates_to"][e]))})),this.txnId=t.txn_id;var n=this.getAge();this.localTimestamp=void 0!==n?Date.now()-n:null!==(e=this.getTs())&&void 0!==e?e:Date.now(),this.reEmitter=new Mp(this)}get unstableExtensibleEvent(){return this._hasCachedExtEv||(this._cachedExtEv=rs.ExtensibleEvents.parse(this.getEffectiveEvent())),this._cachedExtEv}invalidateExtensibleEvent(){this._hasCachedExtEv=!1}getEffectiveEvent(){var e=Object.assign({},this.getContent());if(this.getWireType()===ee.RoomMessageEncrypted)for(var[t,n]of Object.entries(this.getWireContent()))["algorithm","ciphertext","device_id","sender_key","session_id"].includes(t)||void 0===e[t]&&(e[t]=n);return Object.assign({},this.event,this.clearEvent,{content:e})}getId(){return this.event.event_id}getSender(){return this.event.sender}getType(){return this.clearEvent?this.clearEvent.type:this.event.type}getWireType(){return this.event.type}getRoomId(){return this.event.room_id}getTs(){return this.event.origin_server_ts}getDate(){return this.event.origin_server_ts?new Date(this.event.origin_server_ts):null}getDetails(){var e,t=this.getRoomId();if(t)return"id=".concat(this.getId()," type=").concat(this.getWireType()," sender=").concat(this.getSender()," room=").concat(t," ts=").concat(null===(e=this.getDate())||void 0===e?void 0:e.toISOString());var n=this.getContent()[IE];return"msgid=".concat(n," type=").concat(this.getWireType()," sender=").concat(this.getSender())}getOriginalContent(){var e,t;return this._localRedactionEvent?{}:this.clearEvent?null!==(t=this.clearEvent.content)&&void 0!==t?t:{}:null!==(e=this.event.content)&&void 0!==e?e:{}}getContent(){return this._localRedactionEvent?{}:this._replacingEvent?null!==(e=this._replacingEvent.getContent()["m.new_content"])&&void 0!==e?e:{}:this.getOriginalContent();var e}getWireContent(){return this.event.content||{}}get threadRootId(){var e;if(!this.isState()){var t=null===(e=this.getWireContent())||void 0===e?void 0:e["m.relates_to"];if((null==t?void 0:t.rel_type)===Zt.name)return t.event_id;if(this.thread)return this.thread.id;if(void 0!==this.threadId)return this.threadId;var n=this.getUnsigned();if("string"==typeof n[Gb.name])return n[Gb.name]}}get isThreadRoot(){return!this.isState()&&(!!this.getServerAggregatedRelation(Zt.name)||this.threadRootId===this.getId())}get replyEventId(){var e;return null===(e=this.getWireContent()["m.relates_to"])||void 0===e||null===(e=e["m.in_reply_to"])||void 0===e?void 0:e.event_id}get relationEventId(){var e;return null===(e=this.getWireContent())||void 0===e||null===(e=e["m.relates_to"])||void 0===e?void 0:e.event_id}getPrevContent(){return this.getUnsigned().prev_content||{}}getDirectionalContent(){return this.forwardLooking?this.getContent():this.getPrevContent()}getAge(){return this.getUnsigned().age}getLocalAge(){return Date.now()-this.localTimestamp}getStateKey(){return this.event.state_key}isState(){return void 0!==this.event.state_key}getMembershipAtEvent(){var e=this.getUnsigned();return C$.findIn(e)}makeEncrypted(e,t,n,r){this.clearEvent={type:this.event.type,content:this.event.content},this.event.type=e,this.event.content=t,this.senderCurve25519Key=n,this.claimedEd25519Key=r}isBeingDecrypted(){return null!=this.decryptionPromise}getDecryptionPromise(){return this.decryptionPromise}isDecryptionFailure(){return null!==this._decryptionFailureReason}get decryptionFailureReason(){return this._decryptionFailureReason}get isEncryptedDisabledForUnverifiedDevices(){return this.decryptionFailureReason===_N.MEGOLM_KEY_WITHHELD_FOR_UNVERIFIED_DEVICE}shouldAttemptDecryption(){return!(this.isRedacted()||this.isBeingDecrypted()||this.clearEvent||!this.isEncrypted())}attemptDecryption(e){var t=arguments,n=this;return U((function*(){var r=t.length>1&&void 0!==t[1]?t[1]:{};if(!n.isEncrypted())throw new Error("Attempt to decrypt event which isn't encrypted");var i=n.clearEvent&&!n.isDecryptionFailure(),o=r.forceRedecryptIfUntrusted&&n.isKeySourceUntrusted();if(i&&!o)throw new Error("Attempt to decrypt event which has already been decrypted");return n.decryptionPromise?(A.log("Event ".concat(n.getId()," already being decrypted; queueing a retry")),n.retryDecryption=!0,n.decryptionPromise):(n.decryptionPromise=n.decryptionLoop(e,r),n.decryptionPromise)}))()}getKeyRequestRecipients(e){return[{userId:e,deviceId:"*"}]}decryptionLoop(e){var t=arguments,n=this;return U((function*(){var r=t.length>1&&void 0!==t[1]?t[1]:{};for(yield Promise.resolve();;){n.retryDecryption=!1;var i=void 0;try{var o=yield e.decryptEvent(n);!0===r.isRetry&&A.info("Decrypted event on retry (".concat(n.getDetails(),")")),n.setClearData(o),n._decryptionFailureReason=null}catch(e){var s=e instanceof MN?e.detailedString:String(e);if(i=e,n.retryDecryption){A.log("Error decrypting event (".concat(n.getDetails(),"), but retrying: ").concat(s));continue}A.warn("Error decrypting event (".concat(n.getDetails(),"): ").concat(s)),n.setClearDataForDecryptionFailure(String(e)),n._decryptionFailureReason=e instanceof MN?e.code:_N.UNKNOWN_ERROR}return n.decryptionPromise=null,n.retryDecryption=!1,n.setPushDetails(),void(!1!==r.emit&&n.emit(Mt.Decrypted,n,i))}}))()}setClearData(e){var t,n;this.clearEvent=e.clearEvent,this.senderCurve25519Key=null!==(t=e.senderCurve25519Key)&&void 0!==t?t:null,this.claimedEd25519Key=null!==(n=e.claimedEd25519Key)&&void 0!==n?n:null,this.forwardingCurve25519KeyChain=e.forwardingCurve25519KeyChain||[],this.untrusted=e.untrusted||!1,this.invalidateExtensibleEvent()}setClearDataForDecryptionFailure(e){this.clearEvent={type:ee.RoomMessage,content:{msgtype:"m.bad.encrypted",body:"** Unable to decrypt: ".concat(e," **")}},this.senderCurve25519Key=null,this.claimedEd25519Key=null,this.forwardingCurve25519KeyChain=[],this.untrusted=!1,this.invalidateExtensibleEvent()}getClearContent(){return this.clearEvent?this.clearEvent.content:null}isEncrypted(){return!this.isState()&&this.event.type===ee.RoomMessageEncrypted}getSenderKey(){return this.senderCurve25519Key}getKeysClaimed(){return this.claimedEd25519Key?{ed25519:this.claimedEd25519Key}:{}}getClaimedEd25519Key(){return this.claimedEd25519Key}getForwardingCurve25519KeyChain(){return this.forwardingCurve25519KeyChain}isKeySourceUntrusted(){return!!this.untrusted}getUnsigned(){return this.event.unsigned||{}}setUnsigned(e){this.event.unsigned=e}unmarkLocallyRedacted(){var e=this._localRedactionEvent;return this._localRedactionEvent=null,this.event.unsigned&&(this.event.unsigned.redacted_because=void 0),!!e}markLocallyRedacted(e){this._localRedactionEvent||(this.emit(Mt.BeforeRedaction,this,e),this._localRedactionEvent=e,this.event.unsigned||(this.event.unsigned={}),this.event.unsigned.redacted_because=e.event)}applyVisibilityEvent(e){var t,n,r=null===(t=null==e?void 0:e.visible)||void 0===t||t,i=null!==(n=null==e?void 0:e.reason)&&void 0!==n?n:null,o=!1;(this.visibility.visible!==r||!this.visibility.visible&&this.visibility.reason!==i)&&(o=!0),o&&(this.visibility=r?AN:Object.freeze({visible:!1,reason:i}),this.emit(Mt.VisibilityChange,this,r))}messageVisibility(){return this.visibility}makeRedacted(e,t){if(!e.event)throw new Error("invalid redactionEvent in makeRedacted");for(var n in this._localRedactionEvent=null,this.emit(Mt.BeforeRedaction,this,e),this._replacingEvent=null,this.event.unsigned||(this.event.unsigned={}),this.event.unsigned.redacted_because=e.event,this.event)this.event.hasOwnProperty(n)&&!Mae.has(n)&&delete this.event[n];this.isEncrypted()&&(this.clearEvent=void 0);var r=this.getType()in NN?NN[this.getType()]:{},i=this.getContent();for(var o in i)i.hasOwnProperty(o)&&!r[o]&&delete i[o];!this.isThreadRoot&&this.threadRootId&&this.threadRootId!==this.getId()&&(this.moveAllRelatedToMainTimeline(t),e.moveToMainTimeline(t)),this.invalidateExtensibleEvent()}moveAllRelatedToMainTimeline(e){var t=this.thread;if(this.moveToMainTimeline(e),t)for(var n of t.events){var r;(null===(r=n.getRelation())||void 0===r?void 0:r.event_id)===this.getId()&&n.moveAllRelatedToMainTimeline(e)}}moveToMainTimeline(e){var t;null===(t=this.thread)||void 0===t||t.timelineSet.removeEvent(this.getId()),this.setThread(void 0);var n=e.getLiveTimeline();n.getTimelineSet().insertEventIntoTimeline(this,n,n.getState(Le.FORWARDS),!1)}isRedacted(){return!!this.getUnsigned().redacted_because}isRedaction(){return this.getType()===ee.RoomRedaction}asVisibilityChange(){if(!md.matches(this.getType()))return null;var e=this.getRelation();if(!e||"m.reference"!=e.rel_type)return null;var t=e.event_id;if(!t)return null;var n=this.getWireContent(),r=!!n.visible,i=n.reason;return i&&"string"!=typeof i?null:{visible:r,reason:i,eventId:t}}isVisibilityEvent(){return md.matches(this.getType())}getRedactionEvent(){var e,t,n,r;return this.isRedacted()?null!==(e=this.clearEvent)&&void 0!==e&&e.unsigned?null!==(n=null===(r=this.clearEvent)||void 0===r?void 0:r.unsigned.redacted_because)&&void 0!==n?n:null:null!==(t=this.event.unsigned)&&void 0!==t&&t.redacted_because?this.event.unsigned.redacted_because:{}:null}getPushActions(){return this.pushDetails.actions||null}getPushDetails(){return this.pushDetails}setPushDetails(e,t){this.pushDetails={actions:e,rule:t}}handleRemoteEcho(e){var t,n=this.getUnsigned(),r=this.getId();this.event=e,n.redacted_because&&(this.event.unsigned||(this.event.unsigned={}),this.event.unsigned.redacted_because=n.redacted_because),this.setStatus(null),this.getId()!==r&&this.emit(Mt.LocalEventIdReplaced,this),this.localTimestamp=Date.now()-(null!==(t=this.getAge())&&void 0!==t?t:0)}isSending(){return!!this.status}setStatus(e){this.status=e,this.emit(Mt.Status,this,e)}replaceLocalEventId(e){this.event.event_id=e,this.emit(Mt.LocalEventIdReplaced,this)}isRelation(e){var t,n=null===(t=this.getWireContent())||void 0===t?void 0:t["m.relates_to"];return!(this.isState()&&null!=n&&n.rel_type&&[cn.Replace,cn.Thread].includes(n.rel_type))&&!(null==n||!n.rel_type||!n.event_id||e&&n.rel_type!==e)}getRelation(){var e;return this.isRelation()&&null!==(e=this.getWireContent()["m.relates_to"])&&void 0!==e?e:null}makeReplaced(e){this.isRedacted()&&e||this.isState()||this._replacingEvent!==e&&(this._replacingEvent=e??null,this.emit(Mt.Replaced,this),this.invalidateExtensibleEvent())}getAssociatedStatus(){return this._replacingEvent?this._replacingEvent.status:this._localRedactionEvent?this._localRedactionEvent.status:this.status}getServerAggregatedRelation(e){var t;return null===(t=this.getUnsigned()["m.relations"])||void 0===t?void 0:t[e]}replacingEventId(){var e=this.getServerAggregatedRelation(cn.Replace);return e?e.event_id:this._replacingEvent?this._replacingEvent.getId():void 0}replacingEvent(){return this._replacingEvent}replacingEventDate(){var e=this.getServerAggregatedRelation(cn.Replace);if(e){var t=e.origin_server_ts;if(Number.isFinite(t))return new Date(t)}else if(this._replacingEvent){var n;return null!==(n=this._replacingEvent.getDate())&&void 0!==n?n:void 0}}localRedactionEvent(){return this._localRedactionEvent}getAssociatedId(){var e=this.getRelation();return this.replyEventId?this.replyEventId:e?e.event_id:this.isRedaction()?this.event.redacts:void 0}hasAssociation(){return!!this.getAssociatedId()}updateAssociatedId(e){var t=this.getRelation();t?t.event_id=e:this.isRedaction()&&(this.event.redacts=e)}flagCancelled(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._isCancelled=e}isCancelled(){return this._isCancelled}toSnapshot(){var e=new Ci(JSON.parse(JSON.stringify(this.event)));for(var[t,n]of Object.entries(this))"event"!==t&&(e[t]=n);return e}isEquivalentTo(e){if(!e)return!1;if(e===this)return!0;var t=XI(this.event),n=XI(e.event);return JSON.stringify(t)===JSON.stringify(n)}toJSON(){var e=this.getEffectiveEvent();return this.isEncrypted()?{decrypted:e,encrypted:this.event}:e}setTxnId(e){this.txnId=e}getTxnId(){return this.txnId}setThread(e){this.isState()||(this.thread&&this.reEmitter.stopReEmitting(this.thread,[_i.Update]),this.thread=e,this.setThreadId(null==e?void 0:e.id),e&&this.reEmitter.reEmit(e,[_i.Update]))}getThread(){return this.thread}setThreadId(e){this.threadId=e}}var Mae=new Set(["event_id","type","room_id","user_id","sender","state_key","prev_state","content","unsigned","origin_server_ts"]),NN={[ee.RoomMember]:{membership:1},[ee.RoomJoinRules]:{join_rule:1},[ee.RoomPowerLevels]:{ban:1,events:1,events_default:1,kick:1,redact:1,state_default:1,users:1,users_default:1}},ds=function(e){return e[e.NotStarted=0]="NotStarted",e[e.InProgress=1]="InProgress",e[e.Finished=2]="Finished",e}(ds||{}),ut=function(e){return e.Events="RoomState.events",e.Members="RoomState.members",e.NewMember="RoomState.newMember",e.Update="RoomState.update",e.BeaconLiveness="RoomState.BeaconLiveness",e.Marker="RoomState.Marker",e}({});class Lv extends En{constructor(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{status:ds.NotStarted};super(),this.roomId=e,this.oobMemberFlags=t,L(this,"reEmitter",new Mp(this)),L(this,"sentinels",{}),L(this,"displayNameToUserIds",new Map),L(this,"userIdsToDisplayNames",{}),L(this,"tokenToInvite",{}),L(this,"joinedMemberCount",null),L(this,"summaryJoinedMemberCount",null),L(this,"invitedMemberCount",null),L(this,"summaryInvitedMemberCount",null),L(this,"modified",-1),L(this,"members",{}),L(this,"events",new Map),L(this,"paginationToken",null),L(this,"beacons",new Map),L(this,"_liveBeaconIds",[]),this.updateModifiedTime()}getJoinedMemberCount(){return null!==this.summaryJoinedMemberCount?this.summaryJoinedMemberCount:(null===this.joinedMemberCount&&(this.joinedMemberCount=this.getMembers().reduce(((e,t)=>t.membership===Ke.Join?e+1:e),0)),this.joinedMemberCount)}setJoinedMemberCount(e){this.summaryJoinedMemberCount=e}getInvitedMemberCount(){return null!==this.summaryInvitedMemberCount?this.summaryInvitedMemberCount:(null===this.invitedMemberCount&&(this.invitedMemberCount=this.getMembers().reduce(((e,t)=>t.membership===Ke.Invite?e+1:e),0)),this.invitedMemberCount)}setInvitedMemberCount(e){this.summaryInvitedMemberCount=e}getMembers(){return Object.values(this.members)}getMembersExcept(e){return this.getMembers().filter((t=>!e.includes(t.userId)))}getMember(e){return this.members[e]||null}getSentinelMember(e){if(!e)return null;var t=this.sentinels[e];if(void 0===t){t=new wv(this.roomId,e);var n=this.members[e];null!=n&&n.events.member&&t.setMembershipEvent(n.events.member,this),this.sentinels[e]=t}return t}getStateEvents(e,t){return this.events.has(e)?void 0===t?Array.from(this.events.get(e).values()):this.events.get(e).get(t)||null:void 0===t?[]:null}get hasLiveBeacons(){var e;return!(null===(e=this.liveBeaconIds)||void 0===e||!e.length)}get liveBeaconIds(){return this._liveBeaconIds}clone(){var e=new Lv(this.roomId,this.oobMemberFlags),t=this.oobMemberFlags.status;return this.oobMemberFlags.status=ds.NotStarted,Array.from(this.events.values()).forEach((t=>{e.setStateEvents(Array.from(t.values()))})),this.oobMemberFlags.status=t,null!==this.summaryInvitedMemberCount&&e.setInvitedMemberCount(this.getInvitedMemberCount()),null!==this.summaryJoinedMemberCount&&e.setJoinedMemberCount(this.getJoinedMemberCount()),this.oobMemberFlags.status==ds.Finished&&this.getMembers().forEach((t=>{var n;t.isOutOfBand()&&(null===(n=e.getMember(t.userId))||void 0===n||n.markOutOfBand())})),e}setUnknownStateEvents(e){var t=e.filter((e=>!this.events.has(e.getType())||!this.events.get(e.getType()).has(e.getStateKey())));this.setStateEvents(t)}setStateEvents(e,t){this.updateModifiedTime(),e.forEach((e=>{if(e.getRoomId()===this.roomId&&e.isState()){zP.matches(e.getType())&&this.setBeacon(e);var t,n=this.getStateEventMatching(e);if(this.setStateEvent(e),e.getType()===ee.RoomMember)this.updateDisplayNameCache(e.getStateKey(),null!==(t=e.getContent().displayname)&&void 0!==t?t:""),this.updateThirdPartyTokenCache(e);this.emit(ut.Events,e,this,n)}})),this.onBeaconLivenessChange(),e.forEach((e=>{if(e.getRoomId()===this.roomId&&e.isState())if(e.getType()===ee.RoomMember){var n=e.getStateKey();(e.getContent().membership===Ke.Leave||e.getContent().membership===Ke.Ban)&&(e.getContent().avatar_url=e.getContent().avatar_url||e.getPrevContent().avatar_url,e.getContent().displayname=e.getContent().displayname||e.getPrevContent().displayname);var r=this.getOrCreateMember(n,e);r.setMembershipEvent(e,this),this.updateMember(r),this.emit(ut.Members,e,this,r)}else if(e.getType()===ee.RoomPowerLevels){if(""!==e.getStateKey())return;Object.values(this.members).forEach((t=>{var n=t.getLastModifiedTime();t.setPowerLevelEvent(e),n!==t.getLastModifiedTime()&&this.emit(ut.Members,e,this,t)})),this.sentinels={}}else S$.matches(e.getType())&&this.emit(ut.Marker,e,t)})),this.emit(ut.Update,this)}processBeaconEvents(e,t){var n=this;return U((function*(){if(e.length&&n.beacons.size){var r,i=[...n.beacons.values()].reduce(((e,t)=>(e[t.beaconInfoId]=t,e)),{}),o=(e,t)=>{if(wk.matches(t.getType())){var n=i[e];n&&n.addLocations([t])}},s=function*(e){var n,r=null===(n=e.getRelation())||void 0===n?void 0:n.event_id;if(!r||!i[r])return{v:void 0};if(!wk.matches(e.getType())&&!e.isEncrypted())return{v:void 0};try{yield t.decryptEventIfNeeded(e),o(r,e)}catch{e.isDecryptionFailure()&&e.once(Mt.Decrypted,U((function*(){o(r,e)})))}};for(var a of e)if(r=yield*s(a))return r.v}}))()}getOrCreateMember(e,t){var n=this.members[e];return n||(n=new wv(this.roomId,e),this.members[e]=n,this.emit(ut.NewMember,t,this,n)),n}setStateEvent(e){this.events.has(e.getType())||this.events.set(e.getType(),new Map),this.events.get(e.getType()).set(e.getStateKey(),e)}setBeacon(e){var t=zb(e);if(this.beacons.has(t)){var n,r=this.beacons.get(t);return e.isRedacted()?void(r.beaconInfoId===(null===(n=e.getRedactionEvent())||void 0===n?void 0:n.redacts)&&(r.destroy(),this.beacons.delete(t))):r.update(e)}if(!e.isRedacted()){var i=new W$(e);this.reEmitter.reEmit(i,[yn.New,yn.Update,yn.Destroy,yn.LivenessChange]),this.emit(yn.New,e,i),i.on(yn.LivenessChange,this.onBeaconLivenessChange.bind(this)),i.on(yn.Destroy,this.onBeaconLivenessChange.bind(this)),this.beacons.set(i.identifier,i)}}onBeaconLivenessChange(){this._liveBeaconIds=Array.from(this.beacons.values()).filter((e=>e.isLive)).map((e=>e.identifier)),this.emit(ut.BeaconLiveness,this,this.hasLiveBeacons)}getStateEventMatching(e){var t,n;return null!==(t=null===(n=this.events.get(e.getType()))||void 0===n?void 0:n.get(e.getStateKey()))&&void 0!==t?t:null}updateMember(e){var t=this.getStateEvents(ee.RoomPowerLevels,"");t&&e.setPowerLevelEvent(t),delete this.sentinels[e.userId],this.members[e.userId]=e,this.joinedMemberCount=null,this.invitedMemberCount=null}needsOutOfBandMembers(){return this.oobMemberFlags.status===ds.NotStarted}outOfBandMembersReady(){return this.oobMemberFlags.status===ds.Finished}markOutOfBandMembersStarted(){this.oobMemberFlags.status===ds.NotStarted&&(this.oobMemberFlags.status=ds.InProgress)}markOutOfBandMembersFailed(){this.oobMemberFlags.status===ds.InProgress&&(this.oobMemberFlags.status=ds.NotStarted)}clearOutOfBandMembers(){var e=0;Object.keys(this.members).forEach((t=>{this.members[t].isOutOfBand()&&(++e,delete this.members[t])})),A.log("LL: RoomState removed ".concat(e," members...")),this.oobMemberFlags.status=ds.NotStarted}setOutOfBandMembers(e){A.log("LL: RoomState about to set ".concat(e.length," OOB members ...")),this.oobMemberFlags.status===ds.InProgress&&(A.log("LL: RoomState put in finished state ..."),this.oobMemberFlags.status=ds.Finished,e.forEach((e=>this.setOutOfBandMember(e))),this.emit(ut.Update,this))}setOutOfBandMember(e){if(e.getType()===ee.RoomMember){var t=e.getStateKey(),n=this.getMember(t);if(!n||n.isOutOfBand()){var r=this.getOrCreateMember(t,e);r.setMembershipEvent(e,this),r.markOutOfBand(),this.updateDisplayNameCache(r.userId,r.name),this.setStateEvent(e),this.updateMember(r),this.emit(ut.Members,e,this,r)}}}setTypingEvent(e){Object.values(this.members).forEach((function(t){t.setTypingEvent(e)}))}getInviteForThreePidToken(e){return this.tokenToInvite[e]||null}updateModifiedTime(){this.modified=Date.now()}getLastModifiedTime(){return this.modified}getUserIdsWithDisplayName(e){var t;return null!==(t=this.displayNameToUserIds.get(zc(e)))&&void 0!==t?t:[]}maySendRedactionForEvent(e,t){var n=this.getMember(t);return!(!n||n.membership===Ke.Leave||e.status||e.isRedacted())&&(!!this.maySendEvent(ee.RoomRedaction,t)&&(e.getSender()===t||this.hasSufficientPowerLevelFor("redact",n.powerLevel)))}hasSufficientPowerLevelFor(e,t){var n=this.getStateEvents(ee.RoomPowerLevels,""),r={};n&&(r=n.getContent());var i=50;return QA(r[e])&&(i=r[e]),t>=i}maySendMessage(e){return this.maySendEventOfType(ee.RoomMessage,e,!1)}maySendEvent(e,t){return this.maySendEventOfType(e,t,!1)}mayClientSendStateEvent(e,t){return!(t.isGuest()||!t.credentials.userId)&&this.maySendStateEvent(e,t.credentials.userId)}maySendStateEvent(e,t){return this.maySendEventOfType(e,t,!0)}maySendEventOfType(e,t,n){var r,i=this.getStateEvents(ee.RoomPowerLevels,""),o={},s=0,a=0,l=0;if(i){o=(r=i.getContent()).events||{},s=Number.isSafeInteger(r.state_default)?r.state_default:50;var c=r.users&&r.users[t];Number.isSafeInteger(c)?l=c:Number.isSafeInteger(r.users_default)&&(l=r.users_default),Number.isSafeInteger(r.events_default)&&(a=r.events_default)}var u=n?s:a;return Number.isSafeInteger(o[e])&&(u=o[e]),l>=u}mayTriggerNotifOfType(e,t){var n=this.getMember(t);if(!n)return!1;var r=this.getStateEvents(ee.RoomPowerLevels,""),i=50;return r&&r.getContent()&&r.getContent().notifications&&QA(r.getContent().notifications[e])&&(i=r.getContent().notifications[e]),n.powerLevel>=i}getJoinRule(){var e,t=this.getStateEvents(ee.RoomJoinRules,"");return(null!==(e=null==t?void 0:t.getContent())&&void 0!==e?e:{}).join_rule||Jc.Invite}getHistoryVisibility(){var e,t=this.getStateEvents(ee.RoomHistoryVisibility,"");return(null!==(e=null==t?void 0:t.getContent())&&void 0!==e?e:{}).history_visibility||WP.Shared}getGuestAccess(){var e,t=this.getStateEvents(ee.RoomGuestAccess,"");return(null!==(e=null==t?void 0:t.getContent())&&void 0!==e?e:{}).guest_access||Xb.Forbidden}findPredecessor(){if(arguments.length>0&&void 0!==arguments[0]&&arguments[0]){var e=this.getStateEvents(ee.RoomPredecessor,"");if(e){var t=e.getContent(),n=t.predecessor_room_id,r=t.last_known_event_id;"string"!=typeof r&&(r=void 0);var i=t.via_servers;if(Array.isArray(i)||(i=void 0),"string"==typeof n)return{roomId:n,eventId:r,viaServers:i}}}var o=this.getStateEvents(ee.RoomCreate,"");if(o){var s=o.getContent().predecessor;if(s){var a=s.room_id;if("string"==typeof a){var l=s.event_id;return("string"!=typeof l||""===l)&&(l=void 0),{roomId:a,eventId:l}}}}return null}updateThirdPartyTokenCache(e){if(e.getContent().third_party_invite){var t=(e.getContent().third_party_invite.signed||{}).token;if(t)this.getStateEvents(ee.RoomThirdPartyInvite,t)&&(this.tokenToInvite[t]=e)}}updateDisplayNameCache(e,t){var n=this.userIdsToDisplayNames[e];if(delete this.userIdsToDisplayNames[e],n){var r=zc(n),i=this.displayNameToUserIds.get(r);if(i){var o=i.filter((t=>t!==e));this.displayNameToUserIds.set(r,o)}}this.userIdsToDisplayNames[e]=t;var s=t&&zc(t);if(s){var a,l=null!==(a=this.displayNameToUserIds.get(s))&&void 0!==a?a:[];l.push(e),this.displayNameToUserIds.set(s,l)}}}function DN(e){return"string"==typeof e&&!!e&&"undefined"!==e&&"null"!==e||"number"==typeof e}class Ov{constructor(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};L(this,"rooms",{}),L(this,"users",{}),L(this,"syncToken",null),L(this,"filters",new Sl((()=>new Map))),L(this,"accountData",new Map),L(this,"localStorage",void 0),L(this,"oobMembers",new Map),L(this,"pendingEvents",{}),L(this,"clientOptions",void 0),L(this,"pendingToDeviceBatches",[]),L(this,"nextToDeviceBatchId",0),L(this,"createUser",void 0),L(this,"onRoomMember",((e,t,n)=>{var r;if(n.membership!==Ke.Invite){var i=this.users[n.userId]||(null===(r=this.createUser)||void 0===r?void 0:r.call(this,n.userId));n.name&&(i.setDisplayName(n.name),n.events.member&&i.setRawDisplayName(n.events.member.getDirectionalContent().displayname)),n.events.member&&n.events.member.getContent().avatar_url&&i.setAvatarUrl(n.events.member.getContent().avatar_url),this.users[i.userId]=i}})),this.localStorage=e.localStorage}getSyncToken(){return this.syncToken}isNewlyCreated(){return Promise.resolve(!0)}setSyncToken(e){this.syncToken=e}storeRoom(e){this.rooms[e.roomId]=e,e.currentState.on(ut.Members,this.onRoomMember),e.currentState.getMembers().forEach((t=>{this.onRoomMember(null,e.currentState,t)}))}setUserCreator(e){this.createUser=e}getRoom(e){return this.rooms[e]||null}getRooms(){return Object.values(this.rooms)}removeRoom(e){this.rooms[e]&&this.rooms[e].currentState.removeListener(ut.Members,this.onRoomMember),delete this.rooms[e]}getRoomSummaries(){return Object.values(this.rooms).map((function(e){return e.summary}))}storeUser(e){this.users[e.userId]=e}getUser(e){return this.users[e]||null}getUsers(){return Object.values(this.users)}scrollback(e,t){return[]}storeEvents(e,t,n,r){}storeFilter(e){null==e||!e.userId||null==e||!e.filterId||this.filters.getOrCreate(e.userId).set(e.filterId,e)}getFilter(e,t){var n;return(null===(n=this.filters.get(e))||void 0===n?void 0:n.get(t))||null}getFilterIdByName(e){if(!this.localStorage)return null;var t="mxjssdk_memory_filter_"+e;try{var n=this.localStorage.getItem(t);if(DN(n))return n}catch{}return null}setFilterIdByName(e,t){if(this.localStorage){var n="mxjssdk_memory_filter_"+e;try{DN(t)?this.localStorage.setItem(n,t):this.localStorage.removeItem(n)}catch{}}}storeAccountDataEvents(e){e.forEach((e=>{!Object.keys(e.getContent()).length?this.accountData.delete(e.getType()):this.accountData.set(e.getType(),e)}))}getAccountData(e){return this.accountData.get(e)}setSyncData(e){return Promise.resolve()}wantsSave(){return!1}save(e){return Promise.resolve()}startup(){return Promise.resolve()}getSavedSync(){return Promise.resolve(null)}getSavedSyncToken(){return Promise.resolve(null)}deleteAllData(){return this.rooms={},this.users={},this.syncToken=null,this.filters=new Sl((()=>new Map)),this.accountData=new Map,Promise.resolve()}getOutOfBandMembers(e){return Promise.resolve(this.oobMembers.get(e)||null)}setOutOfBandMembers(e,t){return this.oobMembers.set(e,t),Promise.resolve()}clearOutOfBandMembers(e){return this.oobMembers.delete(e),Promise.resolve()}getClientOptions(){return Promise.resolve(this.clientOptions)}storeClientOptions(e){return this.clientOptions=Object.assign({},e),Promise.resolve()}getPendingEvents(e){var t=this;return U((function*(){var n;return null!==(n=t.pendingEvents[e])&&void 0!==n?n:[]}))()}setPendingEvents(e,t){var n=this;return U((function*(){n.pendingEvents[e]=t}))()}saveToDeviceBatches(e){for(var t of e)this.pendingToDeviceBatches.push({id:this.nextToDeviceBatchId++,eventType:t.eventType,txnId:t.txnId,batch:t.batch});return Promise.resolve()}getOldestToDeviceBatch(){var e=this;return U((function*(){return 0===e.pendingToDeviceBatches.length?null:e.pendingToDeviceBatches[0]}))()}removeToDeviceBatch(e){return this.pendingToDeviceBatches=this.pendingToDeviceBatches.filter((t=>t.id!==e)),Promise.resolve()}destroy(){return U((function*(){}))()}}var GH=(e=>(e.ToWidget="toWidget",e.FromWidget="fromWidget",e))(GH||{});function Aae(e){if("toWidget"===e)return"fromWidget";if("fromWidget"===e)return"toWidget";throw new Error("Invalid direction")}var kc=(e=>(e.MSC2762="org.matrix.msc2762",e.MSC2871="org.matrix.msc2871",e.MSC2873="org.matrix.msc2873",e.MSC2931="org.matrix.msc2931",e.MSC2974="org.matrix.msc2974",e.MSC2876="org.matrix.msc2876",e.MSC3819="org.matrix.msc3819",e.MSC3846="town.robin.msc3846",e.MSC3869="org.matrix.msc3869",e.MSC3973="org.matrix.msc3973",e.MSC4039="org.matrix.msc4039",e))(kc||{});const Nae=["0.0.1","0.0.2","org.matrix.msc2762","org.matrix.msc2871","org.matrix.msc2873","org.matrix.msc2931","org.matrix.msc2974","org.matrix.msc2876","org.matrix.msc3819","town.robin.msc3846","org.matrix.msc3869","org.matrix.msc3973","org.matrix.msc4039"];class Dae extends RE.EventEmitter{constructor(e,t,n,r){super(),this.sendDirection=e,this.initialWidgetId=t,this.transportWindow=n,this.inboundWindow=r,this.strictOriginCheck=!1,this.targetOrigin="*",this.timeoutSeconds=10,this._ready=!1,this._widgetId=null,this.outboundRequests=new Map,this.stopController=new AbortController,this._widgetId=t}get ready(){return this._ready}get widgetId(){return this._widgetId||null}get nextRequestId(){const e=`widgetapi-${Date.now()}`;let t=0,n=e;for(;this.outboundRequests.has(n);)n=`${e}-${t++}`;return this.outboundRequests.set(n,null),n}sendInternal(e){console.log(`[PostmessageTransport] Sending object to ${this.targetOrigin}: `,e),this.transportWindow.postMessage(e,this.targetOrigin)}reply(e,t){return this.sendInternal({...e,response:t})}send(e,t){return this.sendComplete(e,t).then((e=>e.response))}sendComplete(e,t){if(!this.ready||!this.widgetId)return Promise.reject(new Error("Not ready or unknown widget ID"));const n={api:this.sendDirection,widgetId:this.widgetId,requestId:this.nextRequestId,action:e,data:t};return e===mr.UpdateVisibility&&(n.visible=t.visible),new Promise(((e,t)=>{const r=e=>{s(),t(e)},i=setTimeout((()=>r(new Error("Request timed out"))),1e3*(this.timeoutSeconds||1)),o=()=>r(new Error("Transport stopped"));this.stopController.signal.addEventListener("abort",o);const s=()=>{this.outboundRequests.delete(n.requestId),clearTimeout(i),this.stopController.signal.removeEventListener("abort",o)};this.outboundRequests.set(n.requestId,{request:n,resolve:t=>{s(),e(t)},reject:r}),this.sendInternal(n)}))}start(){this.inboundWindow.addEventListener("message",(e=>{this.handleMessage(e)})),this._ready=!0}stop(){this._ready=!1,this.stopController.abort()}handleMessage(e){if(this.stopController.signal.aborted||!e.data||this.strictOriginCheck&&e.origin!==window.origin)return;const t=e.data;if(t.action&&t.requestId&&t.widgetId)if(t.response){if(t.api!==this.sendDirection)return;this.handleResponse(t)}else{const e=t;if(e.api!==Aae(this.sendDirection))return;this.handleRequest(e)}}handleRequest(e){if(this.widgetId){if(this.widgetId!==e.widgetId)return}else this._widgetId=e.widgetId;this.emit("message",new CustomEvent("message",{detail:e}))}handleResponse(e){if(e.widgetId!==this.widgetId)return;const t=this.outboundRequests.get(e.requestId);if(t)if(Uae(e.response)){const{message:n,...r}=e.response.error;t.reject(new iS(n,r))}else t.resolve(e)}}var mr=(e=>(e.SupportedApiVersions="supported_api_versions",e.Capabilities="capabilities",e.NotifyCapabilities="notify_capabilities",e.ThemeChange="theme_change",e.LanguageChange="language_change",e.TakeScreenshot="screenshot",e.UpdateVisibility="visibility",e.OpenIDCredentials="openid_credentials",e.WidgetConfig="widget_config",e.CloseModalWidget="close_modal",e.ButtonClicked="button_clicked",e.SendEvent="send_event",e.SendToDevice="send_to_device",e.UpdateTurnServers="update_turn_servers",e))(mr||{}),Rn=(e=>(e.SupportedApiVersions="supported_api_versions",e.ContentLoaded="content_loaded",e.SendSticker="m.sticker",e.UpdateAlwaysOnScreen="set_always_on_screen",e.GetOpenIDCredentials="get_openid",e.CloseModalWidget="close_modal",e.OpenModalWidget="open_modal",e.SetModalButtonEnabled="set_button_enabled",e.SendEvent="send_event",e.SendToDevice="send_to_device",e.WatchTurnServers="watch_turn_servers",e.UnwatchTurnServers="unwatch_turn_servers",e.BeeperReadRoomAccountData="com.beeper.read_room_account_data",e.MSC2876ReadEvents="org.matrix.msc2876.read_events",e.MSC2931Navigate="org.matrix.msc2931.navigate",e.MSC2974RenegotiateCapabilities="org.matrix.msc2974.request_capabilities",e.MSC3869ReadRelations="org.matrix.msc3869.read_relations",e.MSC3973UserDirectorySearch="org.matrix.msc3973.user_directory_search",e.MSC4039GetMediaConfigAction="org.matrix.msc4039.get_media_config",e.MSC4039UploadFileAction="org.matrix.msc4039.upload_file",e.MSC4039DownloadFileAction="org.matrix.msc4039.download_file",e.MSC4157UpdateDelayedEvent="org.matrix.msc4157.update_delayed_event",e))(Rn||{}),fh=(e=>(e.Allowed="allowed",e.Blocked="blocked",e.PendingUserConfirmation="request",e))(fh||{}),WH=(e=>(e.Custom="m.custom",e.JitsiMeet="m.jitsi",e.Stickerpicker="m.stickerpicker",e))(WH||{}),zH=(e=>(e.Close="m.close",e))(zH||{}),oa=(e=>(e.Send="send",e.Receive="receive",e))(oa||{});class oi{constructor(e,t,n,r,i){this.direction=e,this.eventType=t,this.kind=n,this.keyStr=r,this.raw=i}matchesAsStateEvent(e,t,n){return"state_event"===this.kind&&this.direction===e&&this.eventType===t&&(null===this.keyStr||this.keyStr===n)}matchesAsToDeviceEvent(e,t){return!("to_device"!==this.kind||this.direction!==e||this.eventType!==t)}matchesAsRoomEvent(e,t,n=null){return"event"===this.kind&&this.direction===e&&this.eventType===t&&("m.room.message"!==this.eventType||(null===this.keyStr||this.keyStr===n))}matchesAsRoomAccountData(e,t){return!("room_account"!==this.kind||this.direction!==e||this.eventType!==t)}static forStateEvent(e,t,n){const r=`org.matrix.msc2762.${e}.state_event:${t=t.replace(/#/g,"\\#")}${n=null!=n?`#${n}`:""}`;return oi.findEventCapabilities([r])[0]}static forToDeviceEvent(e,t){const n=`org.matrix.msc3819.${e}.to_device:${t}`;return oi.findEventCapabilities([n])[0]}static forRoomEvent(e,t){const n=`org.matrix.msc2762.${e}.event:${t}`;return oi.findEventCapabilities([n])[0]}static forRoomMessageEvent(e,t){const n=`org.matrix.msc2762.${e}.event:m.room.message#${t=t??""}`;return oi.findEventCapabilities([n])[0]}static forRoomAccountData(e,t){const n=`com.beeper.capabilities.${e}.room_account_data:${t}`;return oi.findEventCapabilities([n])[0]}static findEventCapabilities(e){const t=[];for(const n of e){let e,r=null,i=null;if(n.startsWith("org.matrix.msc2762.send.event:")?(r="send",i="event",e=n.substring(30)):n.startsWith("org.matrix.msc2762.send.state_event:")?(r="send",i="state_event",e=n.substring(36)):n.startsWith("org.matrix.msc3819.send.to_device:")?(r="send",i="to_device",e=n.substring(34)):n.startsWith("org.matrix.msc2762.receive.event:")?(r="receive",i="event",e=n.substring(33)):n.startsWith("org.matrix.msc2762.receive.state_event:")?(r="receive",i="state_event",e=n.substring(39)):n.startsWith("org.matrix.msc3819.receive.to_device:")?(r="receive",i="to_device",e=n.substring(37)):n.startsWith("com.beeper.capabilities.receive.room_account_data:")&&(r="receive",i="room_account",e=n.substring(50)),null===r||null===i||void 0===e)continue;const o=e.startsWith("m.room.message#")||"state_event"===i;let s=null;if(e.includes("#")&&o){const t=e.split("#"),n=t.findIndex((e=>!e.endsWith("\\")));e=t.slice(0,n+1).map((e=>e.endsWith("\\")?e.substring(0,e.length-1):e)).join("#"),s=t.slice(n+1).join("#")}t.push(new oi(r,e,i,s,n))}return t}}var cd=(e=>(e.AnyRoom="*",e))(cd||{});const bE=class extends Error{constructor(e,t){super(e),this.data=t}};bE.prototype.name=bE.name;let iS=bE;class jae extends RE.EventEmitter{constructor(e=null,t=null){if(super(),this.clientOrigin=t,this.capabilitiesFinished=!1,this.supportsMSC2974Renegotiate=!1,this.requestedCapabilities=[],this.turnServerWatchers=0,!window.parent)throw new Error("No parent window. This widget doesn't appear to be embedded properly.");this.transport=new Dae(GH.FromWidget,e,window.parent,window),this.transport.targetOrigin=t,this.transport.on("message",this.handleMessage.bind(this))}hasCapability(e){return Array.isArray(this.approvedCapabilities)?this.approvedCapabilities.includes(e):this.requestedCapabilities.includes(e)}requestCapability(e){if(this.capabilitiesFinished&&!this.supportsMSC2974Renegotiate)throw new Error("Capabilities have already been negotiated");this.requestedCapabilities.push(e)}requestCapabilities(e){e.forEach((e=>this.requestCapability(e)))}requestCapabilityForRoomTimeline(e){this.requestCapability(`org.matrix.msc2762.timeline:${e}`)}requestCapabilityToSendState(e,t){this.requestCapability(oi.forStateEvent(oa.Send,e,t).raw)}requestCapabilityToReceiveState(e,t){this.requestCapability(oi.forStateEvent(oa.Receive,e,t).raw)}requestCapabilityToSendToDevice(e){this.requestCapability(oi.forToDeviceEvent(oa.Send,e).raw)}requestCapabilityToReceiveToDevice(e){this.requestCapability(oi.forToDeviceEvent(oa.Receive,e).raw)}requestCapabilityToSendEvent(e){this.requestCapability(oi.forRoomEvent(oa.Send,e).raw)}requestCapabilityToReceiveEvent(e){this.requestCapability(oi.forRoomEvent(oa.Receive,e).raw)}requestCapabilityToSendMessage(e){this.requestCapability(oi.forRoomMessageEvent(oa.Send,e).raw)}requestCapabilityToReceiveMessage(e){this.requestCapability(oi.forRoomMessageEvent(oa.Receive,e).raw)}requestCapabilityToReceiveRoomAccountData(e){this.requestCapability(oi.forRoomAccountData(oa.Receive,e).raw)}requestOpenIDConnectToken(){return new Promise(((e,t)=>{this.transport.sendComplete(Rn.GetOpenIDCredentials,{}).then((n=>{const r=n.response;if(r.state===fh.Allowed)e(r);else if(r.state===fh.Blocked)t(new Error("User declined to verify their identity"));else if(r.state===fh.PendingUserConfirmation){const i=o=>{o.preventDefault();const s=o.detail;s.data.original_request_id===n.requestId&&(s.data.state===fh.Allowed?(e(s.data),this.transport.reply(s,{})):s.data.state===fh.Blocked?(t(new Error("User declined to verify their identity")),this.transport.reply(s,{})):(t(new Error("Invalid state on reply: "+r.state)),this.transport.reply(s,{error:{message:"Invalid state"}})),this.off(`action:${mr.OpenIDCredentials}`,i))};this.on(`action:${mr.OpenIDCredentials}`,i)}else t(new Error("Invalid state: "+r.state))})).catch(t)}))}updateRequestedCapabilities(){return this.transport.send(Rn.MSC2974RenegotiateCapabilities,{capabilities:this.requestedCapabilities}).then()}sendContentLoaded(){return this.transport.send(Rn.ContentLoaded,{}).then()}sendSticker(e){return this.transport.send(Rn.SendSticker,e).then()}setAlwaysOnScreen(e){return this.transport.send(Rn.UpdateAlwaysOnScreen,{value:e}).then((e=>e.success))}openModalWidget(e,t,n=[],r={},i=WH.Custom){return this.transport.send(Rn.OpenModalWidget,{type:i,url:e,name:t,buttons:n,data:r}).then()}closeModalWidget(e={}){return this.transport.send(Rn.CloseModalWidget,e).then()}sendRoomEvent(e,t,n,r,i){return this.sendEvent(e,void 0,t,n,r,i)}sendStateEvent(e,t,n,r,i,o){return this.sendEvent(e,t,n,r,i,o)}sendEvent(e,t,n,r,i,o){return this.transport.send(Rn.SendEvent,{type:e,content:n,...void 0!==t&&{state_key:t},...void 0!==r&&{room_id:r},...void 0!==i&&{delay:i},...void 0!==o&&{parent_delay_id:o}})}updateDelayedEvent(e,t){return this.transport.send(Rn.MSC4157UpdateDelayedEvent,{delay_id:e,action:t})}sendToDevice(e,t,n){return this.transport.send(Rn.SendToDevice,{type:e,encrypted:t,messages:n})}readRoomAccountData(e,t){const n={type:e};return t&&(t.includes(cd.AnyRoom)?n.room_ids=cd.AnyRoom:n.room_ids=t),this.transport.send(Rn.BeeperReadRoomAccountData,n).then((e=>e.events))}readRoomEvents(e,t,n,r,i){const o={type:e,msgtype:n};return void 0!==t&&(o.limit=t),r&&(r.includes(cd.AnyRoom)?o.room_ids=cd.AnyRoom:o.room_ids=r),i&&(o.since=i),this.transport.send(Rn.MSC2876ReadEvents,o).then((e=>e.events))}async readEventRelations(e,t,n,r,i,o,s,a){if(!(await this.getClientVersions()).includes(kc.MSC3869))throw new Error("The read_relations action is not supported by the client.");const l={event_id:e,rel_type:n,event_type:r,room_id:t,to:s,from:o,limit:i,direction:a};return this.transport.send(Rn.MSC3869ReadRelations,l)}readStateEvents(e,t,n,r){const i={type:e,state_key:void 0===n||n};return void 0!==t&&(i.limit=t),r&&(r.includes(cd.AnyRoom)?i.room_ids=cd.AnyRoom:i.room_ids=r),this.transport.send(Rn.MSC2876ReadEvents,i).then((e=>e.events))}setModalButtonEnabled(e,t){if(e===zH.Close)throw new Error("The close button cannot be disabled");return this.transport.send(Rn.SetModalButtonEnabled,{button:e,enabled:t}).then()}navigateTo(e){if(!e||!e.startsWith("https://matrix.to/#"))throw new Error("Invalid matrix.to URI");return this.transport.send(Rn.MSC2931Navigate,{uri:e}).then()}async*getTurnServers(){let e;const t=async t=>{t.preventDefault(),e(t.detail.data),await this.transport.reply(t.detail,{})};if(this.on(`action:${mr.UpdateTurnServers}`,t),0===this.turnServerWatchers)try{await this.transport.send(Rn.WatchTurnServers,{})}catch(e){throw this.off(`action:${mr.UpdateTurnServers}`,t),e}this.turnServerWatchers++;try{for(;;)yield await new Promise((t=>e=t))}finally{this.off(`action:${mr.UpdateTurnServers}`,t),this.turnServerWatchers--,0===this.turnServerWatchers&&await this.transport.send(Rn.UnwatchTurnServers,{})}}async searchUserDirectory(e,t){if(!(await this.getClientVersions()).includes(kc.MSC3973))throw new Error("The user_directory_search action is not supported by the client.");const n={search_term:e,limit:t};return this.transport.send(Rn.MSC3973UserDirectorySearch,n)}async getMediaConfig(){if(!(await this.getClientVersions()).includes(kc.MSC4039))throw new Error("The get_media_config action is not supported by the client.");return this.transport.send(Rn.MSC4039GetMediaConfigAction,{})}async uploadFile(e){if(!(await this.getClientVersions()).includes(kc.MSC4039))throw new Error("The upload_file action is not supported by the client.");const t={file:e};return this.transport.send(Rn.MSC4039UploadFileAction,t)}async downloadFile(e){if(!(await this.getClientVersions()).includes(kc.MSC4039))throw new Error("The download_file action is not supported by the client.");const t={content_uri:e};return this.transport.send(Rn.MSC4039DownloadFileAction,t)}start(){this.transport.start(),this.getClientVersions().then((e=>{e.includes(kc.MSC2974)&&(this.supportsMSC2974Renegotiate=!0)}))}handleMessage(e){const t=new CustomEvent(`action:${e.detail.action}`,{detail:e.detail,cancelable:!0});if(this.emit(`action:${e.detail.action}`,t),!t.defaultPrevented)switch(e.detail.action){case mr.SupportedApiVersions:return this.replyVersions(e.detail);case mr.Capabilities:return this.handleCapabilities(e.detail);case mr.UpdateVisibility:case mr.NotifyCapabilities:return this.transport.reply(e.detail,{});default:return this.transport.reply(e.detail,{error:{message:"Unknown or unsupported action: "+e.detail.action}})}}replyVersions(e){this.transport.reply(e,{supported_versions:Nae})}getClientVersions(){return Array.isArray(this.cachedClientVersions)?Promise.resolve(this.cachedClientVersions):this.transport.send(Rn.SupportedApiVersions,{}).then((e=>(this.cachedClientVersions=e.supported_versions,e.supported_versions))).catch((e=>(console.warn("non-fatal error getting supported client versions: ",e),[])))}handleCapabilities(e){return this.capabilitiesFinished?this.transport.reply(e,{error:{message:"Capability negotiation already completed"}}):this.getClientVersions().then((t=>(t.includes(kc.MSC2871)?this.once(`action:${mr.NotifyCapabilities}`,(e=>{this.approvedCapabilities=e.detail.data.approved,this.emit("ready")})):this.emit("ready"),this.capabilitiesFinished=!0,this.transport.reply(e,{capabilities:this.requestedCapabilities}))))}}var zg=(e=>(e.Screenshots="m.capability.screenshot",e.StickerSending="m.sticker",e.AlwaysOnScreen="m.always_on_screen",e.RequiresClient="io.element.requires_client",e.MSC2931Navigate="org.matrix.msc2931.navigate",e.MSC3846TurnServers="town.robin.msc3846.turn_servers",e.MSC3973UserDirectorySearch="org.matrix.msc3973.user_directory_search",e.MSC4039UploadFile="org.matrix.msc4039.upload_file",e.MSC4039DownloadFile="org.matrix.msc4039.download_file",e.MSC4157SendDelayedEvent="org.matrix.msc4157.send.delayed_event",e.MSC4157UpdateDelayedEvent="org.matrix.msc4157.update_delayed_event",e))(zg||{});function Uae(e){const t=e.error;return"object"==typeof t&&null!==t&&"message"in t&&"string"==typeof t.message}function jN(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function R1(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?jN(Object(n),!0).forEach((function(t){L(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):jN(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Fae(e){var t,n,r,i=2;for(typeof Symbol<"u"&&(n=Symbol.asyncIterator,r=Symbol.iterator);i--;){if(n&&null!=(t=e[n]))return t.call(e);if(r&&null!=(t=e[r]))return new B_(t.call(e));n="@@asyncIterator",r="@@iterator"}throw new TypeError("Object is not async iterable")}function B_(e){function t(e){if(Object(e)!==e)return Promise.reject(new TypeError(e+" is not an object."));var t=e.done;return Promise.resolve(e.value).then((function(e){return{value:e,done:t}}))}return(B_=function(e){this.s=e,this.n=e.next}).prototype={s:null,n:null,next:function(){return t(this.n.apply(this.s,arguments))},return:function(e){var n=this.s.return;return void 0===n?Promise.resolve({value:e,done:!0}):t(n.apply(this.s,arguments))},throw:function(e){var n=this.s.return;return void 0===n?Promise.reject(e):t(n.apply(this.s,arguments))}},new B_(e)}var V_=function(e){return e.PendingEventsChanged="PendingEvent.pendingEventsChanged",e}({});class YH extends jE{constructor(e,t,n,r,i){var o,s,a,l,c,u,d,h,p,f,m,v,g,y;super(r),o=this,this.widgetApi=e,this.capabilities=t,this.roomId=n,L(this,"room",void 0),L(this,"widgetApiReady",void 0),L(this,"lifecycle",void 0),L(this,"syncState",null),L(this,"pendingSendingEventsTxId",[]),L(this,"eventEmitter",new En),L(this,"updateTxId",(y=U((function*(e){if(e.getSender()===o.getUserId()&&o.pendingSendingEventsTxId.some((t=>e.getType()===t.type))){for(var t,n=null===(t=o.pendingSendingEventsTxId.find((t=>t.id===e.getId())))||void 0===t?void 0:t.txId;!n&&o.pendingSendingEventsTxId.length>0;){var r;yield new Promise((e=>o.eventEmitter.once(V_.PendingEventsChanged,(()=>e())))),n=null===(r=o.pendingSendingEventsTxId.find((t=>t.id===e.getId())))||void 0===r?void 0:r.txId}n&&(e.setTxnId(n),e.setUnsigned(R1(R1({},e.getUnsigned()),{},{transaction_id:n}))),o.pendingSendingEventsTxId=o.pendingSendingEventsTxId.filter((t=>t.id!==e.getId())),0===o.pendingSendingEventsTxId.length&&o.eventEmitter.emit(V_.PendingEventsChanged)}})),function(e){return y.apply(this,arguments)})),L(this,"onEvent",function(){var e=U((function*(e){if(e.preventDefault(),e.detail.data.room_id===o.roomId){var t=new Ci(e.detail.data);yield o.updateTxId(t),o.syncApi instanceof gd?yield o.syncApi.injectRoomEvents(o.room,[],void 0,[t]):yield o.syncApi.injectRoomEvents(o.room,[],[t]),o.emit(Oe.Event,t),o.setSyncState(Dt.Syncing),A.info("Received event ".concat(t.getId()," ").concat(t.getType()," ").concat(t.getStateKey()))}else{var{event_id:n,room_id:r}=e.detail.data;A.info("Received event ".concat(n," for a different room ").concat(r,"; discarding"))}yield o.ack(e)}));return function(t){return e.apply(this,arguments)}}()),L(this,"onToDevice",function(){var e=U((function*(e){e.preventDefault();var t=new Ci({type:e.detail.data.type,sender:e.detail.data.sender,content:e.detail.data.content});e.detail.data.encrypted&&t.makeEncrypted(ee.RoomMessageEncrypted,{},"",""),o.emit(Oe.ToDeviceEvent,t),o.setSyncState(Dt.Syncing),yield o.ack(e)}));return function(t){return e.apply(this,arguments)}}());var b=this.widgetApi.transport.send.bind(this.widgetApi.transport);this.widgetApi.transport.send=function(){var e=U((function*(e,t){try{return yield b(e,t)}catch(e){UN(e)}}));return function(t,n){return e.apply(this,arguments)}}();var _=this.widgetApi.transport.sendComplete.bind(this.widgetApi.transport);this.widgetApi.transport.sendComplete=function(){var e=U((function*(e,t){try{return yield _(e,t)}catch(e){UN(e)}}));return function(t,n){return e.apply(this,arguments)}}(),this.widgetApiReady=new Promise((e=>this.widgetApi.once("ready",e))),(null!==(s=t.sendEvent)&&void 0!==s&&s.length||null!==(a=t.receiveEvent)&&void 0!==a&&a.length||!0===t.sendMessage||Array.isArray(t.sendMessage)&&t.sendMessage.length||!0===t.receiveMessage||Array.isArray(t.receiveMessage)&&t.receiveMessage.length||null!==(l=t.sendState)&&void 0!==l&&l.length||null!==(c=t.receiveState)&&void 0!==c&&c.length)&&e.requestCapabilityForRoomTimeline(n),null===(u=t.sendEvent)||void 0===u||u.forEach((t=>e.requestCapabilityToSendEvent(t))),null===(d=t.receiveEvent)||void 0===d||d.forEach((t=>e.requestCapabilityToReceiveEvent(t))),!0===t.sendMessage?e.requestCapabilityToSendMessage():Array.isArray(t.sendMessage)&&t.sendMessage.forEach((t=>e.requestCapabilityToSendMessage(t))),!0===t.receiveMessage?e.requestCapabilityToReceiveMessage():Array.isArray(t.receiveMessage)&&t.receiveMessage.forEach((t=>e.requestCapabilityToReceiveMessage(t))),null===(h=t.sendState)||void 0===h||h.forEach((t=>{var{eventType:n,stateKey:r}=t;return e.requestCapabilityToSendState(n,r)})),null===(p=t.receiveState)||void 0===p||p.forEach((t=>{var{eventType:n,stateKey:r}=t;return e.requestCapabilityToReceiveState(n,r)})),null===(f=t.sendToDevice)||void 0===f||f.forEach((t=>e.requestCapabilityToSendToDevice(t))),null===(m=t.receiveToDevice)||void 0===m||m.forEach((t=>e.requestCapabilityToReceiveToDevice(t))),t.sendDelayedEvents&&(null!==(v=t.sendEvent)&&void 0!==v&&v.length||!0===t.sendMessage||Array.isArray(t.sendMessage)&&t.sendMessage.length||null!==(g=t.sendState)&&void 0!==g&&g.length)&&e.requestCapability(zg.MSC4157SendDelayedEvent),t.updateDelayedEvents&&e.requestCapability(zg.MSC4157UpdateDelayedEvent),t.turnServers&&e.requestCapability(zg.MSC3846TurnServers),e.on("action:".concat(mr.SendEvent),this.onEvent),e.on("action:".concat(mr.SendToDevice),this.onToDevice),e.start(),i&&e.sendContentLoaded()}startClient(){var e=arguments,t=this;return U((function*(){var n,r,i=e.length>0&&void 0!==e[0]?e[0]:{};t.lifecycle=new AbortController;var o,s=t.getUserId();s&&t.store.storeUser(new El(s)),i.slidingSync?t.syncApi=new SH(i.slidingSync,t,i,t.buildSyncApiOptions()):t.syncApi=new gd(t,i,t.buildSyncApiOptions()),t.room=t.syncApi.createRoom(t.roomId),t.store.storeRoom(t.room),yield t.widgetApiReady,yield Promise.all(null!==(n=null===(r=t.capabilities.receiveState)||void 0===r?void 0:r.map((o=U((function*(e){var{eventType:n,stateKey:r}=e,i=(yield t.widgetApi.readStateEvents(n,void 0,r,[t.roomId])).map((e=>new Ci(e)));t.syncApi instanceof gd?yield t.syncApi.injectRoomEvents(t.room,void 0,i):yield t.syncApi.injectRoomEvents(t.room,i),i.forEach((e=>{t.emit(Oe.Event,e),A.info("Backfilled event ".concat(e.getId()," ").concat(e.getType()," ").concat(e.getStateKey()))}))})),function(e){return o.apply(this,arguments)})))&&void 0!==n?n:[]),void 0!==i.clientWellKnownPollPeriod&&(t.clientWellKnownIntervalID=setInterval((()=>{t.fetchClientWellKnown()}),1e3*i.clientWellKnownPollPeriod),t.fetchClientWellKnown()),t.setSyncState(Dt.Syncing),A.info("Finished backfilling events"),t.matrixRTC.start(),t.capabilities.turnServers&&t.watchTurnServers()}))()}stopClient(){this.widgetApi.off("action:".concat(mr.SendEvent),this.onEvent),this.widgetApi.off("action:".concat(mr.SendToDevice),this.onToDevice),super.stopClient(),this.lifecycle.abort()}joinRoom(e){var t=this;return U((function*(){if(e===t.roomId)return t.room;throw new Error("Unknown room: ".concat(e))}))()}encryptAndSendEvent(e,t,n){var r=this;return U((function*(){var i=t.event.redacts?R1(R1({},t.getContent()),{},{redacts:t.event.redacts}):t.getContent();if(n){var o=yield r.widgetApi.sendRoomEvent(t.getType(),i,e.roomId,"delay"in n?n.delay:void 0,"parent_delay_id"in n?n.parent_delay_id:void 0).catch(Qo);return r.validateSendDelayedEventResponse(o)}var s,a=t.getTxnId();a&&r.pendingSendingEventsTxId.push({type:t.getType(),id:void 0,txId:a});try{s=yield r.widgetApi.sendRoomEvent(t.getType(),i,e.roomId).catch(Qo)}catch(n){throw r.updatePendingEventStatus(e,t,et.NOT_SENT),n}return e.updatePendingEvent(t,et.SENT,s.event_id),r.pendingSendingEventsTxId.forEach((e=>{e.txId===a&&(e.id=s.event_id)})),r.eventEmitter.emit(V_.PendingEventsChanged),{event_id:s.event_id}}))()}sendStateEvent(e,t,n){var r=arguments,i=this;return U((function*(){var o=r.length>3&&void 0!==r[3]?r[3]:"",s=yield i.widgetApi.sendStateEvent(t,o,n,e).catch(Qo);if(void 0===s.event_id)throw new Error("'event_id' absent from response to an event request");return{event_id:s.event_id}}))()}_unstable_sendDelayedStateEvent(e,t,n,r){var i=arguments,o=this;return U((function*(){var s=i.length>4&&void 0!==i[4]?i[4]:"";if(!(yield o.doesServerSupportUnstableFeature(ha)))throw new $c("Server does not support the delayed events API","sendDelayedStateEvent");var a=yield o.widgetApi.sendStateEvent(n,s,r,e,"delay"in t?t.delay:void 0,"parent_delay_id"in t?t.parent_delay_id:void 0).catch(Qo);return o.validateSendDelayedEventResponse(a)}))()}validateSendDelayedEventResponse(e){if(void 0===e.delay_id)throw new Error("'delay_id' absent from response to a delayed event request");return{delay_id:e.delay_id}}_unstable_updateDelayedEvent(e,t){var n=this;return U((function*(){if(!(yield n.doesServerSupportUnstableFeature(ha)))throw new $c("Server does not support the delayed events API","updateDelayedEvent");return yield n.widgetApi.updateDelayedEvent(e,t).catch(Qo),{}}))()}encryptAndSendToDevice(e,t,n){var r=this;return U((function*(){var i=new Sl((()=>new Map));for(var{userId:o,deviceId:s}of t)i.getOrCreate(o).set(s,n);yield r.widgetApi.sendToDevice(e,!0,pd(i)).catch(Qo)}))()}sendToDevice(e,t){var n=this;return U((function*(){return yield n.widgetApi.sendToDevice(e,!1,pd(t)).catch(Qo),{}}))()}getOpenIdToken(){var e=this;return U((function*(){var t=yield e.widgetApi.requestOpenIDConnectToken().catch(Qo);return{access_token:t.access_token,expires_in:t.expires_in,matrix_server_name:t.matrix_server_name,token_type:t.token_type}}))()}queueToDevice(e){var t=this;return U((function*(){var{eventType:n,batch:r}=e,i=new Sl((()=>new Map));for(var{userId:o,deviceId:s,payload:a}of r)i.getOrCreate(o).set(s,a);yield t.widgetApi.sendToDevice(n,!1,pd(i)).catch(Qo)}))()}sendToDeviceViaWidgetApi(e,t,n){var r=this;return U((function*(){yield r.widgetApi.sendToDevice(e,t,pd(n)).catch(Qo)}))()}checkTurnServers(){var e=this;return U((function*(){return e.turnServers.length>0}))()}getSyncState(){return this.syncState}setSyncState(e){var t=this.syncState;this.syncState=e,this.emit(Oe.Sync,e,t)}ack(e){var t=this;return U((function*(){yield t.widgetApi.transport.reply(e.detail,{})}))()}watchTurnServers(){var e=this;return U((function*(){var t=e.widgetApi.getTurnServers(),n=()=>{t.return(void 0)};e.lifecycle.signal.addEventListener("abort",n);try{var r,i=!1,o=!1;try{for(var s,a=Fae(t);i=!(s=yield a.next()).done;i=!1){var l=s.value;e.turnServers=[{urls:l.uris,username:l.username,credential:l.password}],e.emit(Oe.TurnServers,e.turnServers),A.log("Received TURN server: ".concat(l.uris))}}catch(e){o=!0,r=e}finally{try{i&&null!=a.return&&(yield a.return())}finally{if(o)throw r}}}catch(e){A.warn("Error watching TURN servers",e)}finally{e.lifecycle.signal.removeEventListener("abort",n)}}))()}}function UN(e){throw e instanceof iS&&e.data.matrix_api_error?bn.fromWidgetApiErrorData(e.data.matrix_api_error):e}function Qo(e){throw e instanceof Error&&"Request timed out"===e.message?new Jd("widget api timeout"):e}class $ae{constructor(){L(this,"unthreadedReadReceipts",new Map),L(this,"threadedReadReceipts",new Sl((()=>new Map)))}setUnthreaded(e,t){this.unthreadedReadReceipts.set(e,t)}setThreaded(e,t,n){this.threadedReadReceipts.getOrCreate(e).set(t,n)}allUnthreaded(){return this.unthreadedReadReceipts.entries()}*allThreaded(){for(var e of this.threadedReadReceipts.values())for(var t of e.entries())yield t}consumeEphemeralEvents(e){null==e||e.forEach((e=>{e.type!==ee.Receipt||!e.content||Object.keys(e.content).forEach((t=>{Object.entries(e.content[t]).forEach((n=>{var[r,i]=n;if(kP(r))for(var o of Object.keys(i)){var s=e.content[t][r][o],a={data:e.content[t][r][o],type:r,eventId:t};s.thread_id?this.setThreaded(s.thread_id,o,a):this.setUnthreaded(o,a)}}))}))}))}buildAccumulatedReceiptEvent(e){var t={type:ee.Receipt,room_id:e,content:{}},n=new Sl((()=>new Sl((()=>new Map))));for(var[r,i]of this.allUnthreaded())n.getOrCreate(i.eventId).getOrCreate(i.type).set(r,i.data);for(var[o,s]of this.allThreaded())n.getOrCreate(s.eventId).getOrCreate(s.type).set(o,s.data);return t.content=pd(n),n.size>0?t:null}}var el=function(e){return e.Invite="invite",e.Leave="leave",e.Join="join",e.Knock="knock",e}({});function Hae(e){return"_localTs"in e&&void 0!==e._localTs}class JH{constructor(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.opts=e,L(this,"accountData",{}),L(this,"inviteRooms",{}),L(this,"knockRooms",{}),L(this,"joinRooms",{}),L(this,"nextBatch",null),this.opts.maxTimelineEntries=this.opts.maxTimelineEntries||50}accumulate(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.accumulateRooms(e,t),this.accumulateAccountData(e),this.nextBatch=e.next_batch}accumulateAccountData(e){!e.account_data||!e.account_data.events||e.account_data.events.forEach((e=>{this.accountData[e.type]=e}))}accumulateRooms(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];e.rooms&&(e.rooms.invite&&Object.keys(e.rooms.invite).forEach((n=>{this.accumulateRoom(n,el.Invite,e.rooms.invite[n],t)})),e.rooms.join&&Object.keys(e.rooms.join).forEach((n=>{this.accumulateRoom(n,el.Join,e.rooms.join[n],t)})),e.rooms.leave&&Object.keys(e.rooms.leave).forEach((n=>{this.accumulateRoom(n,el.Leave,e.rooms.leave[n],t)})),e.rooms.knock&&Object.keys(e.rooms.knock).forEach((n=>{this.accumulateRoom(n,el.Knock,e.rooms.knock[n],t)})))}accumulateRoom(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];switch(t){case el.Invite:this.knockRooms[e]&&delete this.knockRooms[e],this.accumulateInviteState(e,n);break;case el.Knock:this.accumulateKnockState(e,n);break;case el.Join:this.inviteRooms[e]&&delete this.inviteRooms[e],this.accumulateJoinState(e,n,r);break;case el.Leave:this.knockRooms[e]?delete this.knockRooms[e]:this.inviteRooms[e]?delete this.inviteRooms[e]:delete this.joinRooms[e];break;default:A.error("Unknown cateogory: ",t)}}accumulateInviteState(e,t){if(t.invite_state&&t.invite_state.events){if(!this.inviteRooms[e])return void(this.inviteRooms[e]={invite_state:t.invite_state});var n=this.inviteRooms[e];t.invite_state.events.forEach((e=>{for(var t=!1,r=0;r<n.invite_state.events.length;r++){var i=n.invite_state.events[r];i.type===e.type&&i.state_key==e.state_key&&(n.invite_state.events[r]=e,t=!0)}t||n.invite_state.events.push(e)}))}}accumulateKnockState(e,t){if(t.knock_state&&t.knock_state.events){if(!this.knockRooms[e])return void(this.knockRooms[e]={knock_state:t.knock_state});var n=this.knockRooms[e];t.knock_state.events.forEach((e=>{for(var t=!1,r=0;r<n.knock_state.events.length;r++){var i=n.knock_state.events[r];i.type===e.type&&i.state_key==e.state_key&&(n.knock_state.events[r]=e,t=!0)}t||n.knock_state.events.push(e)}))}}accumulateJoinState(e,t){var n,r,i,o,s,a,l=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this.joinRooms[e]||(this.joinRooms[e]={_currentState:Object.create(null),_timeline:[],_accountData:Object.create(null),_unreadNotifications:{},_unreadThreadNotifications:{},_summary:{},_receipts:new $ae});var c=this.joinRooms[e];if(t.account_data&&t.account_data.events&&t.account_data.events.forEach((e=>{c._accountData[e.type]=e})),t.unread_notifications&&(c._unreadNotifications=t.unread_notifications),c._unreadThreadNotifications=null!==(n=null!==(r=t[Tv.stable])&&void 0!==r?r:t[Tv.unstable])&&void 0!==n?n:void 0,t.summary){var u,d,h,p="m.heroes",f="m.invited_member_count",m="m.joined_member_count",v=c._summary,g=t.summary;v[p]=null!==(u=g[p])&&void 0!==u?u:v[p],v[m]=null!==(d=g[m])&&void 0!==d?d:v[m],v[f]=null!==(h=g[f])&&void 0!==h?h:v[f]}if(c._receipts.consumeEphemeralEvents(null===(i=t.ephemeral)||void 0===i?void 0:i.events),t.timeline&&t.timeline.limited&&(c._timeline=[]),null===(o=t.state)||void 0===o||null===(o=o.events)||void 0===o||o.forEach((e=>{I1(c._currentState,e)})),null===(s=t["org.matrix.msc4222.state_after"])||void 0===s||null===(s=s.events)||void 0===s||s.forEach((e=>{I1(c._currentState,e)})),null===(a=t.timeline)||void 0===a||null===(a=a.events)||void 0===a||a.forEach(((e,n)=>{var r,i;if(t["org.matrix.msc4222.state_after"]||I1(c._currentState,e),l)i=e;else{var o;void 0!==(i=Object.assign({},e)).unsigned&&(i.unsigned=Object.assign({},i.unsigned));var s=null===(o=e.unsigned)||void 0===o?void 0:o.age;void 0!==s&&(i._localTs=Date.now()-s)}c._timeline.push({event:i,token:0===n&&null!==(r=t.timeline.prev_batch)&&void 0!==r?r:null})})),c._timeline.length>this.opts.maxTimelineEntries)for(var y=c._timeline.length-this.opts.maxTimelineEntries;y<c._timeline.length;y++)if(c._timeline[y].token){c._timeline=c._timeline.slice(y,c._timeline.length);break}}getJSON(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t={join:{},invite:{},knock:{},leave:{}};Object.keys(this.inviteRooms).forEach((e=>{t.invite[e]=this.inviteRooms[e]})),Object.keys(this.knockRooms).forEach((e=>{t.knock[e]=this.knockRooms[e]})),Object.keys(this.joinRooms).forEach((n=>{var r=this.joinRooms[n],i={ephemeral:{events:[]},account_data:{events:[]},state:{events:[]},"org.matrix.msc4222.state_after":{events:[]},timeline:{events:[],prev_batch:null},unread_notifications:r._unreadNotifications,unread_thread_notifications:r._unreadThreadNotifications,summary:r._summary};Object.keys(r._accountData).forEach((e=>{i.account_data.events.push(r._accountData[e])}));var o=r._receipts.buildAccumulatedReceiptEvent(n);o&&i.ephemeral.events.push(o),r._timeline.forEach((t=>{if(!i.timeline.prev_batch){if(!t.token)return;i.timeline.prev_batch=t.token}var n;!e&&Hae(t.event)?(void 0!==(n=Object.assign({},t.event)).unsigned&&(n.unsigned=Object.assign({},n.unsigned)),delete n._localTs,n.unsigned=n.unsigned||{},n.unsigned.age=Date.now()-t.event._localTs):n=t.event,i.timeline.events.push(n)}));for(var s=Object.create(null),a=i.timeline.events.length-1;a>=0;a--){var l=i.timeline.events[a];if(null!==l.state_key&&void 0!==l.state_key){var c=wE(l);c.unsigned&&(c.unsigned.prev_content&&(c.content=c.unsigned.prev_content),c.unsigned.prev_sender&&(c.sender=c.unsigned.prev_sender)),I1(s,c)}}Object.keys(r._currentState).forEach((e=>{Object.keys(r._currentState[e]).forEach((t=>{var n=r._currentState[e][t];i["org.matrix.msc4222.state_after"].events.push(n),s[e]&&s[e][t]&&(n=s[e][t]),i.state.events.push(n)}))})),t.join[n]=i}));var n=[];return Object.keys(this.accountData).forEach((e=>{n.push(this.accountData[e])})),{nextBatch:this.nextBatch,roomsData:t,accountData:n}}getNextBatchToken(){return this.nextBatch}}function I1(e,t){null===t.state_key||void 0===t.state_key||!t.type||(e[t.type]||(e[t.type]=Object.create(null)),e[t.type][t.state_key]=t)}var XH=function(e){return e[e.Blocked=-1]="Blocked",e[e.Unverified=0]="Unverified",e[e.Verified=1]="Verified",e}({});class Bae{constructor(e){L(this,"deviceId",void 0),L(this,"userId",void 0),L(this,"algorithms",void 0),L(this,"keys",void 0),L(this,"verified",void 0),L(this,"signatures",void 0),L(this,"displayName",void 0),L(this,"dehydrated",!1),this.deviceId=e.deviceId,this.userId=e.userId,this.algorithms=e.algorithms,this.keys=e.keys,this.verified=e.verified||XH.Unverified,this.signatures=e.signatures||new Map,this.displayName=e.displayName,this.dehydrated=!!e.dehydrated}getFingerprint(){return this.keys.get("ed25519:".concat(this.deviceId))}getIdentityKey(){return this.keys.get("curve25519:".concat(this.deviceId))}}var FN=function(){},Vae=10;class qae{constructor(e,t){var n,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};this.client=e,this.timelineSet=t,L(this,"windowLimit",void 0),L(this,"start",void 0),L(this,"end",void 0),L(this,"eventCount",0),this.windowLimit=r.windowLimit||1e3,null===(n=t.room)||void 0===n||n.on(ke.Timeline,this.onTimelineEvent.bind(this))}load(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:20,n=n=>{if(!n)throw new Error("No timeline given to initFields");var r,i=n.getEvents();if(e){if((r=i.findIndex((t=>t.getId()===e)))<0)throw new Error("getEventTimeline result didn't include requested event")}else r=i.length;var o=Math.min(i.length,r+Math.ceil(t/2)),s=Math.max(0,o-t);this.start=new Uk(n,s-n.getBaseIndex()),this.end=new Uk(n,o-n.getBaseIndex()),this.eventCount=o-s};return this.timelineSet.getTimelineForEvent(e)?(n(this.timelineSet.getTimelineForEvent(e)),Promise.resolve()):e?this.client.getEventTimeline(this.timelineSet,e).then(n):(n(this.timelineSet.getLiveTimeline()),Promise.resolve())}getTimelineIndex(e){var t,n;if(e==Le.BACKWARDS)return null!==(t=this.start)&&void 0!==t?t:null;if(e==Le.FORWARDS)return null!==(n=this.end)&&void 0!==n?n:null;throw new Error("Invalid direction '"+e+"'")}extend(e,t){var n=this.getTimelineIndex(e);if(!n)return!1;var r=e==Le.BACKWARDS?n.retreat(t):n.advance(t);if(r){this.eventCount+=r,FN("TimelineWindow: increased cap by "+r+" (now "+this.eventCount+")");var i=this.eventCount-this.windowLimit;return i>0&&this.unpaginate(i,e!=Le.BACKWARDS),!0}return!1}onTimelineEvent(e,t,n,r){r&&this.onEventRemoved()}onEventRemoved(){var e=this.getEvents();e.length>0&&void 0===e[e.length-1]&&this.end&&this.end.index--}canPaginate(e){var t=this.getTimelineIndex(e);if(!t)return!1;if(e==Le.BACKWARDS){if(t.index>t.minIndex())return!0}else if(t.index<t.maxIndex())return!0;var n=t.timeline.getNeighbouringTimeline(e),r=t.timeline.getPaginationToken(e);return!!n||!!r}paginate(e,t){var n=arguments,r=this;return U((function*(){var i=!(n.length>2&&void 0!==n[2])||n[2],o=n.length>3&&void 0!==n[3]?n[3]:Vae,s=r.getTimelineIndex(e);if(!s)return!1;if(s.pendingPaginate)return s.pendingPaginate;if(r.extend(e,t))return!0;if(!i||0===o)return!1;if(!s.timeline.getPaginationToken(e))return!1;var a=r.client.paginateEventTimeline(s.timeline,{backwards:e==Le.BACKWARDS,limit:t}).finally((function(){s.pendingPaginate=void 0})).then((n=>n?r.paginate(e,t,!0,o-1):r.paginate(e,t,!1,0)));return s.pendingPaginate=a,a}))()}unpaginate(e,t){var n=t?this.start:this.end;if(!n)throw new Error("Attempting to unpaginate startOfTimeline=".concat(t," but don't have this direction"));if(e>this.eventCount||e<0)throw new Error("Attemting to unpaginate ".concat(e," events, but only have ").concat(this.eventCount," in the timeline"));for(;e>0;){var r=t?n.advance(e):n.retreat(e);if(r<=0)throw new Error("Unable to unpaginate any further, but still have "+this.eventCount+" events");e-=r,this.eventCount-=r,FN("TimelineWindow.unpaginate: dropped "+r+" (now "+this.eventCount+")")}}getEvents(){if(!this.start)return[];for(var e=[],t=this.start.timeline;t;){var n,r,i=t.getEvents(),o=0,s=i.length;t===this.start.timeline&&(o=this.start.index+t.getBaseIndex()),t===(null===(n=this.end)||void 0===n?void 0:n.timeline)&&(s=this.end.index+t.getBaseIndex());for(var a=o;a<s;a++)e.push(i[a]);if(t===(null===(r=this.end)||void 0===r?void 0:r.timeline))break;t=t.getNeighbouringTimeline(Le.FORWARDS)}return e}}class Uk{constructor(e,t){this.timeline=e,this.index=t,L(this,"pendingPaginate",void 0)}minIndex(){return-1*this.timeline.getBaseIndex()}maxIndex(){return this.timeline.getEvents().length-this.timeline.getBaseIndex()}advance(e){if(!e)return 0;var t;if(e<0){if((t=Math.max(e,this.minIndex()-this.index))<0)return this.index+=t,t}else if((t=Math.min(e,this.maxIndex()-this.index))>0)return this.index+=t,t;var n=this.timeline.getNeighbouringTimeline(e<0?Le.BACKWARDS:Le.FORWARDS);return n?(this.timeline=n,this.index=e<0?this.maxIndex():this.minIndex(),this.advance(e)):0}retreat(e){return-1*this.advance(-1*e)}}var tg="m.login.email.identity",$N="m.login.msisdn",Fk=function(e){return e.Password="m.login.password",e.Recaptcha="m.login.recaptcha",e.Terms="m.login.terms",e.Email="m.login.email.identity",e.Msisdn="m.login.msisdn",e.Sso="m.login.sso",e.SsoUnstable="org.matrix.login.sso",e.Dummy="m.login.dummy",e.RegistrationToken="m.login.registration_token",e.UnstableRegistrationToken="org.matrix.msc3231.login.registration_token",e}({});class ZH extends Error{constructor(e,t,n){super(e),this.required_stages=t,this.flows=n,L(this,"name","NoAuthFlowFoundError")}}class sL{constructor(e){var t=this;L(this,"matrixClient",void 0),L(this,"inputs",void 0),L(this,"clientSecret",void 0),L(this,"requestCallback",void 0),L(this,"busyChangedCallback",void 0),L(this,"stateUpdatedCallback",void 0),L(this,"requestEmailTokenCallback",void 0),L(this,"supportedStages",void 0),L(this,"data",void 0),L(this,"emailSid",void 0),L(this,"requestingEmailToken",!1),L(this,"attemptAuthDeferred",null),L(this,"chosenFlow",null),L(this,"currentStage",null),L(this,"emailAttempt",1),L(this,"submitPromise",null),L(this,"requestEmailToken",U((function*(){if(t.requestingEmailToken)A.warn("Could not request email token: Already requesting");else{A.trace("Requesting email token. Attempt: "+t.emailAttempt),t.requestingEmailToken=!0;try{var e=yield t.requestEmailTokenCallback(t.inputs.emailAddress,t.clientSecret,t.emailAttempt++,t.data.session);t.emailSid=e.sid,A.trace("Email token request succeeded")}finally{t.requestingEmailToken=!1}}}))),this.matrixClient=e.matrixClient,this.data=e.authData||{flows:[]},this.requestCallback=e.doRequest,this.busyChangedCallback=e.busyChanged,this.stateUpdatedCallback=e.stateUpdated||e.startAuthStage,this.requestEmailTokenCallback=e.requestEmailToken,this.inputs=e.inputs||{},e.sessionId&&(this.data.session=e.sessionId),this.clientSecret=e.clientSecret||this.matrixClient.generateClientSecret(),this.emailSid=e.emailSid,void 0!==e.supportedStages&&(this.supportedStages=new Set(e.supportedStages))}attemptAuth(){var e=this;return U((function*(){var t;e.attemptAuthDeferred=ou();var n=e.attemptAuthDeferred.promise;if(null!==(t=e.data)&&void 0!==t&&null!==(t=t.flows)&&void 0!==t&&t.length)e.startNextAuthStage();else{var r;null===(r=e.busyChangedCallback)||void 0===r||r.call(e,!0);var i=e.data.session?{session:e.data.session}:null;e.doRequest(i).finally((()=>{var t;null===(t=e.busyChangedCallback)||void 0===t||t.call(e,!1)}))}return n}))()}poll(){var e=this;return U((function*(){if(e.data.session&&e.attemptAuthDeferred&&!e.submitPromise){var t={};if(e.currentStage==tg&&e.emailSid){var n={sid:e.emailSid,client_secret:e.clientSecret},r=e.matrixClient.getIdentityServerUrl();r&&(n.id_server=new URL(r).host),t={type:tg,threepid_creds:n}}e.submitAuthDict(t,!0)}}))()}getSessionId(){var e;return null===(e=this.data)||void 0===e?void 0:e.session}getClientSecret(){return this.clientSecret}getStageParams(e){var t;return null===(t=this.data)||void 0===t||null===(t=t.params)||void 0===t?void 0:t[e]}getChosenFlow(){return this.chosenFlow}submitAuthDict(e){var t=arguments,n=this;return U((function*(){var r,i,o,s=t.length>1&&void 0!==t[1]&&t[1];if(!n.attemptAuthDeferred)throw new Error("submitAuthDict() called before attemptAuth()");s||(null===(i=n.busyChangedCallback)||void 0===i||i.call(n,!0));for(;n.submitPromise;)try{yield n.submitPromise}catch{}o=null!==(r=n.data)&&void 0!==r&&r.session?Object.assign({session:n.data.session},e):e;try{n.submitPromise=n.doRequest(o,s),yield n.submitPromise}finally{var a;if(n.submitPromise=null,!s)null===(a=n.busyChangedCallback)||void 0===a||a.call(n,!1)}}))()}getEmailSid(){return this.emailSid}setEmailSid(e){this.emailSid=e}doRequest(e){var t=arguments,n=this;return U((function*(){var r=t.length>1&&void 0!==t[1]&&t[1];try{var i=yield n.requestCallback(e,r);n.attemptAuthDeferred.resolve(i),n.attemptAuthDeferred=null}catch(e){var o,s,a,l,c=e instanceof bn?e:null,u=null!==(o=null==c||null===(s=c.data)||void 0===s?void 0:s.flows)&&void 0!==o?o:null,d=(null===(a=n.data)||void 0===a?void 0:a.flows)||!!u;if(!c||401!==c.httpStatus||!c.data||!d)if(r)A.log("Background poll request failed doing UI auth: ignoring",e);else{var h;null===(h=n.attemptAuthDeferred)||void 0===h||h.reject(e)}c&&!c.data&&(c.data={}),c&&!c.data.flows&&!c.data.completed&&!c.data.session&&(c.data.flows=n.data.flows,c.data.completed=n.data.completed,c.data.session=n.data.session),c&&(n.data=c.data);try{n.startNextAuthStage()}catch(e){return n.attemptAuthDeferred.reject(e),void(n.attemptAuthDeferred=null)}if(!n.emailSid&&null!==(l=n.chosenFlow)&&void 0!==l&&l.stages.includes(Fk.Email))try{yield n.requestEmailToken()}catch(e){n.attemptAuthDeferred.reject(e),n.attemptAuthDeferred=null}}}))()}startNextAuthStage(){var e,t,n,r,i=this.chooseStage();if(!i)throw new Error("No incomplete flows from the server");(this.currentStage=i,i!==Fk.Dummy)?null!==(e=this.data)&&void 0!==e&&e.errcode||null!==(t=this.data)&&void 0!==t&&t.error?this.stateUpdatedCallback(i,{errcode:(null===(n=this.data)||void 0===n?void 0:n.errcode)||"",error:(null===(r=this.data)||void 0===r?void 0:r.error)||""}):this.stateUpdatedCallback(i,i===tg?{emailSid:this.emailSid}:{}):this.submitAuthDict({type:"m.login.dummy"})}chooseStage(){null===this.chosenFlow&&(this.chosenFlow=this.chooseFlow()),A.log("Active flow => %s",JSON.stringify(this.chosenFlow));var e=this.firstUncompletedStage(this.chosenFlow);return A.log("Next stage: %s",e),e}scoreFlow(e){var t=e.stages.length;return void 0!==this.supportedStages&&(t+=10*e.stages.filter((e=>!this.supportedStages.has(e))).length),t}chooseFlow(){var e,t=(null===(e=this.data)||void 0===e?void 0:e.flows)||[],n=!!this.inputs.emailAddress||!!this.emailSid,r=!!this.inputs.phoneCountry&&!!this.inputs.phoneNumber;for(var i of(t.sort(((e,t)=>this.scoreFlow(e)-this.scoreFlow(t))),t)){var o=!1,s=!1;for(var a of i.stages)a===tg?o=!0:a==$N&&(s=!0);if(o==n&&s==r)return i}var l=[];throw n&&l.push(tg),r&&l.push($N),new ZH("No appropriate authentication flow found",l,t)}firstUncompletedStage(e){var t,n=(null===(t=this.data)||void 0===t?void 0:t.completed)||[];return e.stages.find((e=>!n.includes(e)))}}function QH(e,t){return new Promise(((n,r)=>{var i=!0,o=e.open(t);o.onupgradeneeded=()=>{i=!1},o.onblocked=()=>r(o.error),o.onsuccess=()=>{o.result.close(),i||e.deleteDatabase(t),n(i)},o.onerror=()=>r(o.error)}))}var eB=[e=>{e.createObjectStore("users",{keyPath:["userId"]}),e.createObjectStore("accountData",{keyPath:["type"]}),e.createObjectStore("sync",{keyPath:["clobber"]})},e=>{e.createObjectStore("oob_membership_events",{keyPath:["room_id","state_key"]}).createIndex("room","room_id")},e=>{e.createObjectStore("client_options",{keyPath:["clobber"]})},e=>{e.createObjectStore("to_device_queue",{autoIncrement:!0})}],Kae=eB.length;function k1(e,t,n){var r=e.openCursor(t);return new Promise(((e,t)=>{var i=[];r.onerror=()=>{var e;t(new Error("Query failed: "+(null===(e=r.error)||void 0===e?void 0:e.name)))},r.onsuccess=()=>{var t=r.result;t?(i.push(n(t)),t.continue()):e(i)}}))}function Zu(e){return new Promise(((t,n)=>{e.oncomplete=function(e){t(e)},e.onerror=function(){n(e.error)}}))}function tB(e){return new Promise(((t,n)=>{e.onsuccess=function(e){t(e)},e.onerror=function(){n(e.error)}}))}function Gae(e){return new Promise(((t,n)=>{e.onsuccess=()=>t(e),e.onerror=e=>n(e)}))}function u2(e){return tB(e).then((t=>e.result))}class HN{static exists(e,t){return QH(e,t="matrix-js-sdk:"+(t||"default"))}constructor(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"default";this.indexedDB=e,L(this,"dbName",void 0),L(this,"syncAccumulator",void 0),L(this,"db",void 0),L(this,"disconnected",!0),L(this,"_isNewlyCreated",!1),L(this,"syncToDatabasePromise",void 0),L(this,"pendingUserPresenceData",[]),this.dbName="matrix-js-sdk:"+t,this.syncAccumulator=new JH}connect(e){var t=this;if(!this.disconnected)return A.log("LocalIndexedDBStoreBackend.connect: already connected or connecting"),Promise.resolve();this.disconnected=!1,A.log("LocalIndexedDBStoreBackend.connect: connecting...");var n=this.indexedDB.open(this.dbName,Kae);return n.onupgradeneeded=e=>{var t=n.result,r=e.oldVersion;A.log("LocalIndexedDBStoreBackend.connect: upgrading from ".concat(r)),r<1&&(this._isNewlyCreated=!0),eB.forEach(((e,n)=>{r<=n&&e(t)}))},n.onblocked=()=>{A.log("can't yet open LocalIndexedDBStoreBackend because it is open elsewhere")},A.log("LocalIndexedDBStoreBackend.connect: awaiting connection..."),tB(n).then(U((function*(){A.log("LocalIndexedDBStoreBackend.connect: connected"),t.db=n.result,t.db.onversionchange=()=>{var e;null===(e=t.db)||void 0===e||e.close(),t.disconnected=!0,t.db=void 0},t.db.onclose=()=>{t.disconnected=!0,t.db=void 0,null==e||e()},yield t.init()})))}isNewlyCreated(){return Promise.resolve(this._isNewlyCreated)}init(){return Promise.all([this.loadAccountData(),this.loadSyncData()]).then((e=>{var[t,n]=e;A.log("LocalIndexedDBStoreBackend: loaded initial data"),this.syncAccumulator.accumulate({next_batch:n.nextBatch,rooms:n.roomsData,account_data:{events:t}},!0)}))}getOutOfBandMembers(e){return new Promise(((t,n)=>{var r=this.db.transaction(["oob_membership_events"],"readonly").objectStore("oob_membership_events").index("room"),i=IDBKeyRange.only(e),o=r.openCursor(i),s=[],a=!1;o.onsuccess=()=>{var e=o.result;if(!e)return s.length||a?t(s):t(null);var n=e.value;n.oob_written?a=!0:s.push(n),e.continue()},o.onerror=e=>{n(e)}})).then((t=>(A.log("LL: got ".concat(null==t?void 0:t.length," membershipEvents from storage for room ").concat(e," ...")),t)))}setOutOfBandMembers(e,t){var n=this;return U((function*(){A.log("LL: backend about to store ".concat(t.length)+" members for ".concat(e));var r=n.db.transaction(["oob_membership_events"],"readwrite"),i=r.objectStore("oob_membership_events");t.forEach((e=>{i.put(e)}));var o={room_id:e,oob_written:!0,state_key:0};i.put(o),yield Zu(r),A.log("LL: backend done storing for ".concat(e,"!"))}))()}clearOutOfBandMembers(e){var t=this;return U((function*(){var n=t.db.transaction(["oob_membership_events"],"readonly").objectStore("oob_membership_events").index("room"),r=IDBKeyRange.only(e),i=u2(n.openKeyCursor(r,"next")).then((e=>(null==e?void 0:e.primaryKey)[1])),o=u2(n.openKeyCursor(r,"prev")).then((e=>(null==e?void 0:e.primaryKey)[1])),[s,a]=yield Promise.all([i,o]),l=t.db.transaction(["oob_membership_events"],"readwrite").objectStore("oob_membership_events"),c=IDBKeyRange.bound([e,s],[e,a]);A.log("LL: Deleting all users + marker in storage for room ".concat(e,", with key range:"),[e,s],[e,a]),yield Gae(l.delete(c))}))()}clearDatabase(){return new Promise((e=>{var t;A.log("Removing indexeddb instance: ".concat(this.dbName)),null===(t=this.db)||void 0===t||t.close();var n=this.indexedDB.deleteDatabase(this.dbName);n.onblocked=()=>{A.log("can't yet delete indexeddb ".concat(this.dbName," because it is open elsewhere"))},n.onerror=()=>{var t;A.warn("unable to delete js-sdk store indexeddb: ".concat(null===(t=n.error)||void 0===t?void 0:t.name)),e()},n.onsuccess=()=>{A.log("Removed indexeddb instance: ".concat(this.dbName)),e()}}))}getSavedSync(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=this.syncAccumulator.getJSON();return t.nextBatch?e?Promise.resolve(wE(t)):Promise.resolve(t):Promise.resolve(null)}getNextBatchToken(){return Promise.resolve(this.syncAccumulator.getNextBatchToken())}setSyncData(e){return Promise.resolve().then((()=>{this.syncAccumulator.accumulate(e)}))}syncToDatabase(e){var t=this;return U((function*(){return t.syncToDatabasePromise?(A.warn("Skipping syncToDatabase() as persist already in flight"),t.pendingUserPresenceData.push(...e),t.syncToDatabasePromise):(e.unshift(...t.pendingUserPresenceData),t.syncToDatabasePromise=t.doSyncToDatabase(e),t.syncToDatabasePromise)}))()}doSyncToDatabase(e){var t=this;return U((function*(){try{var n=t.syncAccumulator.getJSON(!0);yield Promise.all([t.persistUserPresenceEvents(e),t.persistAccountData(n.accountData),t.persistSyncData(n.nextBatch,n.roomsData)])}finally{t.syncToDatabasePromise=void 0}}))()}persistSyncData(e,t){return A.log("Persisting sync data up to",e),Uf((()=>{var n=this.db.transaction(["sync"],"readwrite");return n.objectStore("sync").put({clobber:"-",nextBatch:e,roomsData:t}),Zu(n).then((()=>{A.log("Persisted sync data up to",e)}))}))}persistAccountData(e){return Uf((()=>{var t=this.db.transaction(["accountData"],"readwrite"),n=t.objectStore("accountData");for(var r of e)n.put(r);return Zu(t).then()}))}persistUserPresenceEvents(e){return Uf((()=>{var t=this.db.transaction(["users"],"readwrite"),n=t.objectStore("users");for(var r of e)n.put({userId:r[0],event:r[1]});return Zu(t).then()}))}getUserPresenceEvents(){return Uf((()=>k1(this.db.transaction(["users"],"readonly").objectStore("users"),void 0,(e=>[e.value.userId,e.value.event]))))}loadAccountData(){return A.log("LocalIndexedDBStoreBackend: loading account data..."),Uf((()=>k1(this.db.transaction(["accountData"],"readonly").objectStore("accountData"),void 0,(e=>e.value)).then((e=>(A.log("LocalIndexedDBStoreBackend: loaded account data"),e)))))}loadSyncData(){return A.log("LocalIndexedDBStoreBackend: loading sync data..."),Uf((()=>k1(this.db.transaction(["sync"],"readonly").objectStore("sync"),void 0,(e=>e.value)).then((e=>(A.log("LocalIndexedDBStoreBackend: loaded sync data"),e.length>1&&A.warn("loadSyncData: More than 1 sync row found."),e.length>0?e[0]:{})))))}getClientOptions(){return Promise.resolve().then((()=>k1(this.db.transaction(["client_options"],"readonly").objectStore("client_options"),void 0,(e=>{var t;return null===(t=e.value)||void 0===t?void 0:t.options})).then((e=>e[0]))))}storeClientOptions(e){var t=this;return U((function*(){var n=t.db.transaction(["client_options"],"readwrite");n.objectStore("client_options").put({clobber:"-",options:e}),yield Zu(n)}))()}saveToDeviceBatches(e){var t=this;return U((function*(){var n=t.db.transaction(["to_device_queue"],"readwrite"),r=n.objectStore("to_device_queue");for(var i of e)r.add(i);yield Zu(n)}))()}getOldestToDeviceBatch(){var e=this;return U((function*(){var t=e.db.transaction(["to_device_queue"],"readonly").objectStore("to_device_queue"),n=yield u2(t.openCursor());if(!n)return null;var r=n.value;return{id:n.key,txnId:r.txnId,eventType:r.eventType,batch:r.batch}}))()}removeToDeviceBatch(e){var t=this;return U((function*(){var n=t.db.transaction(["to_device_queue"],"readwrite");n.objectStore("to_device_queue").delete(e),yield Zu(n)}))()}destroy(){var e=this;return U((function*(){var t;null===(t=e.db)||void 0===t||t.close()}))()}}class Wae{constructor(e,t){this.workerFactory=e,this.dbName=t,L(this,"worker",void 0),L(this,"nextSeq",0),L(this,"inFlight",{}),L(this,"startPromise",void 0),L(this,"onWorkerMessage",(e=>{var t,n=e.data;if("closed"==n.command)null===(t=this.onClose)||void 0===t||t.call(this);else if("cmd_success"==n.command||"cmd_fail"==n.command){if(void 0===n.seq)return void A.error("Got reply from worker with no seq");var r=this.inFlight[n.seq];if(void 0===r)return void A.error("Got reply for unknown seq "+n.seq);if(delete this.inFlight[n.seq],"cmd_success"==n.command)r.resolve(n.result);else{var i=new Error(n.error.message);i.name=n.error.name,r.reject(i)}}else A.warn("Unrecognised message from worker: ",n)}))}connect(e){return this.onClose=e,this.ensureStarted().then((()=>this.doCmd("connect")))}clearDatabase(){return this.ensureStarted().then((()=>this.doCmd("clearDatabase")))}isNewlyCreated(){return this.doCmd("isNewlyCreated")}getSavedSync(){return this.doCmd("getSavedSync")}getNextBatchToken(){return this.doCmd("getNextBatchToken")}setSyncData(e){return this.doCmd("setSyncData",[e])}syncToDatabase(e){return this.doCmd("syncToDatabase",[e])}getOutOfBandMembers(e){return this.doCmd("getOutOfBandMembers",[e])}setOutOfBandMembers(e,t){return this.doCmd("setOutOfBandMembers",[e,t])}clearOutOfBandMembers(e){return this.doCmd("clearOutOfBandMembers",[e])}getClientOptions(){return this.doCmd("getClientOptions")}storeClientOptions(e){return this.doCmd("storeClientOptions",[e])}getUserPresenceEvents(){return this.doCmd("getUserPresenceEvents")}saveToDeviceBatches(e){var t=this;return U((function*(){return t.doCmd("saveToDeviceBatches",[e])}))()}getOldestToDeviceBatch(){var e=this;return U((function*(){return e.doCmd("getOldestToDeviceBatch")}))()}removeToDeviceBatch(e){var t=this;return U((function*(){return t.doCmd("removeToDeviceBatch",[e])}))()}ensureStarted(){return this.startPromise||(this.worker=this.workerFactory(),this.worker.onmessage=this.onWorkerMessage,this.startPromise=this.doCmd("setupWorker",[this.dbName]).then((()=>{A.log("IndexedDB worker is ready")}))),this.startPromise}doCmd(e,t){return Promise.resolve().then((()=>{var n,r=this.nextSeq++,i=ou();return this.inFlight[r]=i,null===(n=this.worker)||void 0===n||n.postMessage({command:e,seq:r,args:t}),i.promise}))}destroy(){var e=this;return U((function*(){var t;null===(t=e.worker)||void 0===t||t.terminate()}))()}}var zae=3e5;class nB extends Ov{static exists(e,t){return HN.exists(e,t)}constructor(e){if(super(e),L(this,"backend",void 0),L(this,"startedUp",!1),L(this,"syncTs",0),L(this,"userModifiedMap",{}),L(this,"emitter",new En),L(this,"onClose",(()=>{this.emitter.emit("closed")})),L(this,"getSavedSync",this.degradable((()=>this.backend.getSavedSync()),"getSavedSync")),L(this,"isNewlyCreated",this.degradable((()=>this.backend.isNewlyCreated()),"isNewlyCreated")),L(this,"getSavedSyncToken",this.degradable((()=>this.backend.getNextBatchToken()),"getSavedSyncToken")),L(this,"deleteAllData",this.degradable((()=>(super.deleteAllData(),this.backend.clearDatabase().then((()=>{A.log("Deleted indexeddb data.")}),(e=>{throw A.error("Failed to delete indexeddb data: ".concat(e)),e})))),null)),L(this,"reallySave",this.degradable((()=>{this.syncTs=Date.now();var e=[];for(var t of this.getUsers())this.userModifiedMap[t.userId]!==t.getLastModifiedTime()&&t.events.presence&&(e.push([t.userId,t.events.presence.event]),this.userModifiedMap[t.userId]=t.getLastModifiedTime());return this.backend.syncToDatabase(e)}),null)),L(this,"setSyncData",this.degradable((e=>this.backend.setSyncData(e)),"setSyncData")),L(this,"getOutOfBandMembers",this.degradable((e=>this.backend.getOutOfBandMembers(e)),"getOutOfBandMembers")),L(this,"setOutOfBandMembers",this.degradable(((e,t)=>(super.setOutOfBandMembers(e,t),this.backend.setOutOfBandMembers(e,t))),"setOutOfBandMembers")),L(this,"clearOutOfBandMembers",this.degradable((e=>(super.clearOutOfBandMembers(e),this.backend.clearOutOfBandMembers(e))),"clearOutOfBandMembers")),L(this,"getClientOptions",this.degradable((()=>this.backend.getClientOptions()),"getClientOptions")),L(this,"storeClientOptions",this.degradable((e=>(super.storeClientOptions(e),this.backend.storeClientOptions(e))),"storeClientOptions")),!e.indexedDB)throw new Error("Missing required option: indexedDB");e.workerFactory?this.backend=new Wae(e.workerFactory,e.dbName):this.backend=new HN(e.indexedDB,e.dbName)}on(e,t){this.emitter.on(e,t)}startup(){return this.startedUp?(A.log("IndexedDBStore.startup: already started"),Promise.resolve()):(A.log("IndexedDBStore.startup: connecting to backend"),this.backend.connect(this.onClose).then((()=>(A.log("IndexedDBStore.startup: loading presence events"),this.backend.getUserPresenceEvents()))).then((e=>{A.log("IndexedDBStore.startup: processing presence events"),e.forEach((e=>{var[t,n]=e;if(!this.createUser)throw new Error("`IndexedDBStore.startup` must be called after assigning it to the client, not before!");var r=this.createUser(t);n&&r.setPresenceEvent(new Ci(n)),this.userModifiedMap[r.userId]=r.getLastModifiedTime(),this.storeUser(r)})),this.startedUp=!0})))}destroy(){return this.backend.destroy()}wantsSave(){return Date.now()-this.syncTs>zae}save(){return arguments.length>0&&void 0!==arguments[0]&&arguments[0]||this.wantsSave()?this.reallySave():Promise.resolve()}degradable(e,t){var n=this,r=t?super[t]:null;return U((function*(){for(var t=arguments.length,i=new Array(t),o=0;o<t;o++)i[o]=arguments[o];try{return yield e.call(n,...i)}catch(e){A.error("IndexedDBStore failure, degrading to MemoryStore",e),n.emitter.emit("degraded",e);try{A.log("IndexedDBStore trying to delete degraded data"),yield n.backend.clearDatabase(),A.log("IndexedDBStore delete after degrading succeeded")}catch(e){A.warn("IndexedDBStore delete after degrading failed",e)}if(r)return r.call(n,...i)}}))}getPendingEvents(e){var t=()=>super.getPendingEvents,n=this;return U((function*(){if(!n.localStorage)return t().call(n,e);var r=n.localStorage.getItem(d2(e));if(r)try{return JSON.parse(r)}catch(e){A.error("Could not parse persisted pending events",e)}return[]}))()}setPendingEvents(e,t){var n=()=>super.setPendingEvents,r=this;return U((function*(){if(!r.localStorage)return n().call(r,e,t);t.length>0?r.localStorage.setItem(d2(e),JSON.stringify(t)):r.localStorage.removeItem(d2(e))}))()}saveToDeviceBatches(e){return this.backend.saveToDeviceBatches(e)}getOldestToDeviceBatch(){return this.backend.getOldestToDeviceBatch()}removeToDeviceBatch(e){return this.backend.removeToDeviceBatch(e)}}function d2(e){return"mx_pending_events_".concat(e)}var Uo="crypto.",BN=Uo+"migration",f2=Uo+"account",Yae=Uo+"cross_signing_keys",q_=Uo+"inboundgroupsessions/",Jae=Uo+"inboundgroupsessions.withheld/",Xae=Uo+"rooms/",h2=Uo+"sessionsneedingbackup";function Kf(e){return Uo+"sessions/"+e}function p2(e,t){return q_+e+"/"+t}function Zae(e,t){return Jae+e+"/"+t}function Qae(e){return Xae+e}class UE extends CE{static exists(e){for(var t=e.length,n=0;n<t;n++){var r;if(null!==(r=e.key(n))&&void 0!==r&&r.startsWith(Uo))return!0}return!1}constructor(e){super(),this.store=e}containsData(){var e=this;return U((function*(){return UE.exists(e.store)}))()}getMigrationState(){var e=this;return U((function*(){var t;return null!==(t=Os(e.store,BN))&&void 0!==t?t:sp.NOT_STARTED}))()}setMigrationState(e){var t=this;return U((function*(){Qu(t.store,BN,e)}))()}countEndToEndSessions(e,t){for(var n=0,r=0;r<this.store.length;++r){var i=this.store.key(r);if(null!=i&&i.startsWith(Kf(""))){var o=Os(this.store,i);n+=Object.keys(o??{}).length}}t(n)}_getEndToEndSessions(e){var t=Os(this.store,Kf(e)),n={};for(var[r,i]of Object.entries(t||{}))n[r]="string"==typeof i?{session:i}:i;return n}getEndToEndSession(e,t,n,r){var i;r(null!==(i=this._getEndToEndSessions(e)[t])&&void 0!==i?i:{})}getEndToEndSessions(e,t,n){var r;n(null!==(r=this._getEndToEndSessions(e))&&void 0!==r?r:{})}storeEndToEndSession(e,t,n,r){var i=this._getEndToEndSessions(e)||{};i[t]=n,Qu(this.store,Kf(e),i)}getEndToEndSessionsBatch(){var e=this;return U((function*(){for(var t=[],n=0;n<e.store.length;++n){var r;if(null!==(r=e.store.key(n))&&void 0!==r&&r.startsWith(Kf(""))){var i=e.store.key(n).split("/")[1];for(var o of Object.values(e._getEndToEndSessions(i)))if(t.push(o),t.length>=op)return t}}return 0===t.length?null:t}))()}deleteEndToEndSessionsBatch(e){var t=this;return U((function*(){for(var{deviceKey:n,sessionId:r}of e){var i=t._getEndToEndSessions(n)||{};delete i[r],0===Object.keys(i).length?t.store.removeItem(Kf(n)):Qu(t.store,Kf(n),i)}}))()}getEndToEndInboundGroupSession(e,t,n,r){r(Os(this.store,p2(e,t)),Os(this.store,Zae(e,t)))}storeEndToEndInboundGroupSession(e,t,n,r){Qu(this.store,p2(e,t),n)}countEndToEndInboundGroupSessions(){var e=this;return U((function*(){for(var t=0,n=0;n<e.store.length;++n){var r=e.store.key(n);null!=r&&r.startsWith(q_)&&(t+=1)}return t}))()}getEndToEndInboundGroupSessionsBatch(){var e=this;return U((function*(){for(var t=Os(e.store,h2)||{},n=[],r=0;r<e.store.length;++r){var i=e.store.key(r);if(null!=i&&i.startsWith(q_)){var o=i.slice(q_.length);if(n.push({senderKey:o.slice(0,43),sessionId:o.slice(44),sessionData:Os(e.store,i),needsBackup:o in t}),n.length>=op)return n}}return 0===n.length?null:n}))()}deleteEndToEndInboundGroupSessionsBatch(e){var t=this;return U((function*(){for(var{senderKey:n,sessionId:r}of e){var i=p2(n,r);t.store.removeItem(i)}}))()}getEndToEndRooms(e,t){for(var n={},r=Qae(""),i=0;i<this.store.length;++i){var o=this.store.key(i);if(null!=o&&o.startsWith(r))n[o.slice(r.length)]=Os(this.store,o)}t(n)}markSessionsNeedingBackup(e){var t=Os(this.store,h2)||{};for(var n of e)t[n.senderKey+"/"+n.sessionId]=!0;return Qu(this.store,h2,t),Promise.resolve()}deleteAllData(){return this.store.removeItem(f2),Promise.resolve()}getAccount(e,t){t(Os(this.store,f2))}storeAccount(e,t){Qu(this.store,f2,t)}getCrossSigningKeys(e,t){t(Os(this.store,Yae))}getSecretStorePrivateKey(e,t,n){t(Os(this.store,Uo+"ssss_cache.".concat(n)))}storeSecretStorePrivateKey(e,t,n){Qu(this.store,Uo+"ssss_cache.".concat(t),n)}doTxn(e,t,n){return Promise.resolve(n(null))}}function Os(e,t){try{return JSON.parse(e.getItem(t))}catch(e){A.log("Error: Failed to get key %s: %s",t,e.message),A.log(e.stack)}return null}function Qu(e,t,n){e.setItem(t,JSON.stringify(n))}let ele=class{constructor(e){this.db=e,L(this,"nextTxnId",0),e.onversionchange=()=>{A.log("versionchange for indexeddb ".concat(this.db.name,": closing")),e.close()}}containsData(){return U((function*(){throw Error("Not implemented for Backend")}))()}startup(){var e=this;return U((function*(){return e}))()}deleteAllData(){return U((function*(){throw Error("This is not implemented, call IDBFactory::deleteDatabase(dbName) instead.")}))()}getMigrationState(){var e=this;return U((function*(){var t=sp.NOT_STARTED;return yield e.doTxn("readonly",[Lt.STORE_ACCOUNT],(e=>{var n=e.objectStore(Lt.STORE_ACCOUNT).get(ek);n.onsuccess=()=>{var e;t=null!==(e=n.result)&&void 0!==e?e:sp.NOT_STARTED}})),t}))()}setMigrationState(e){var t=this;return U((function*(){yield t.doTxn("readwrite",[Lt.STORE_ACCOUNT],(t=>{t.objectStore(Lt.STORE_ACCOUNT).put(e,ek)}))}))()}getAccount(e,t){var n=e.objectStore("account").get("-");n.onsuccess=function(){try{t(n.result||null)}catch(t){Ni(e,t)}}}storeAccount(e,t){e.objectStore("account").put(t,"-")}getCrossSigningKeys(e,t){var n=e.objectStore("account").get("crossSigningKeys");n.onsuccess=function(){try{t(n.result||null)}catch(t){Ni(e,t)}}}getSecretStorePrivateKey(e,t,n){var r=e.objectStore("account").get("ssss_cache:".concat(n));r.onsuccess=function(){try{t(r.result||null)}catch(t){Ni(e,t)}}}storeSecretStorePrivateKey(e,t,n){e.objectStore("account").put(n,"ssss_cache:".concat(t))}countEndToEndSessions(e,t){var n=e.objectStore("sessions").count();n.onsuccess=function(){try{t(n.result)}catch(t){Ni(e,t)}}}getEndToEndSessions(e,t,n){var r=t.objectStore("sessions").index("deviceKey").openCursor(e),i={};r.onsuccess=function(){var e=r.result;if(e)i[e.value.sessionId]={session:e.value.session,lastReceivedMessageTs:e.value.lastReceivedMessageTs},e.continue();else try{n(i)}catch(e){Ni(t,e)}}}getEndToEndSession(e,t,n,r){var i=n.objectStore("sessions").get([e,t]);i.onsuccess=function(){try{i.result?r({session:i.result.session,lastReceivedMessageTs:i.result.lastReceivedMessageTs}):r(null)}catch(e){Ni(n,e)}}}storeEndToEndSession(e,t,n,r){r.objectStore("sessions").put({deviceKey:e,sessionId:t,session:n.session,lastReceivedMessageTs:n.lastReceivedMessageTs})}getEndToEndSessionsBatch(){var e=this;return U((function*(){var t=[];return yield e.doTxn("readonly",[Lt.STORE_SESSIONS],(e=>{var n=e.objectStore(Lt.STORE_SESSIONS).openCursor();n.onsuccess=function(){try{var r=n.result;r&&(t.push(r.value),t.length<op&&r.continue())}catch(t){Ni(e,t)}}})),0===t.length?null:t}))()}deleteEndToEndSessionsBatch(e){var t=this;return U((function*(){var n;yield t.doTxn("readwrite",[Lt.STORE_SESSIONS],(n=U((function*(t){try{var n=t.objectStore(Lt.STORE_SESSIONS),r=function*(){var e=n.delete([i,o]);yield new Promise((t=>{e.onsuccess=t}))};for(var{deviceKey:i,sessionId:o}of e)yield*r()}catch(e){Ni(t,e)}})),function(e){return n.apply(this,arguments)}))}))()}getEndToEndInboundGroupSession(e,t,n,r){var i=!1,o=!1,s=n.objectStore("inbound_group_sessions").get([e,t]);s.onsuccess=function(){try{i=s.result?s.result.session:null,!1!==o&&r(i,o)}catch(e){Ni(n,e)}};var a=n.objectStore("inbound_group_sessions_withheld").get([e,t]);a.onsuccess=function(){try{o=a.result?a.result.session:null,!1!==i&&r(i,o)}catch(e){Ni(n,e)}}}storeEndToEndInboundGroupSession(e,t,n,r){r.objectStore("inbound_group_sessions").put({senderCurve25519Key:e,sessionId:t,session:n})}countEndToEndInboundGroupSessions(){var e=this;return U((function*(){var t=0;return yield e.doTxn("readonly",[Lt.STORE_INBOUND_GROUP_SESSIONS],(e=>{var n=e.objectStore(Lt.STORE_INBOUND_GROUP_SESSIONS).count();n.onsuccess=()=>{t=n.result}})),t}))()}getEndToEndInboundGroupSessionsBatch(){var e=this;return U((function*(){var t=[];return yield e.doTxn("readonly",[Lt.STORE_INBOUND_GROUP_SESSIONS,Lt.STORE_BACKUP],(e=>{var n=e.objectStore(Lt.STORE_INBOUND_GROUP_SESSIONS),r=e.objectStore(Lt.STORE_BACKUP),i=n.openCursor();i.onsuccess=function(){try{var n=i.result;if(n){var o=r.get(n.key);o.onsuccess=()=>{t.push({senderKey:n.value.senderCurve25519Key,sessionId:n.value.sessionId,sessionData:n.value.session,needsBackup:void 0!==o.result}),t.length<op&&n.continue()}}}catch(t){Ni(e,t)}}})),0===t.length?null:t}))()}deleteEndToEndInboundGroupSessionsBatch(e){var t=this;return U((function*(){var n;yield t.doTxn("readwrite",[Lt.STORE_INBOUND_GROUP_SESSIONS],(n=U((function*(t){try{var n=t.objectStore(Lt.STORE_INBOUND_GROUP_SESSIONS),r=function*(){var e=n.delete([i,o]);yield new Promise((t=>{e.onsuccess=t}))};for(var{senderKey:i,sessionId:o}of e)yield*r()}catch(e){Ni(t,e)}})),function(e){return n.apply(this,arguments)}))}))()}getEndToEndDeviceData(e,t){var n=e.objectStore("device_data").get("-");n.onsuccess=function(){try{t(n.result||null)}catch(t){Ni(e,t)}}}getEndToEndRooms(e,t){var n={},r=e.objectStore("rooms").openCursor();r.onsuccess=function(){var i=r.result;if(i)n[i.key]=i.value,i.continue();else try{t(n)}catch(t){Ni(e,t)}}}markSessionsNeedingBackup(e,t){var n=this;return U((function*(){t||(t=n.db.transaction("sessions_needing_backup","readwrite"));var r=t.objectStore("sessions_needing_backup");yield Promise.all(e.map((e=>new Promise(((t,n)=>{var i=r.put({senderCurve25519Key:e.senderKey,sessionId:e.sessionId});i.onsuccess=t,i.onerror=n})))))}))()}doTxn(e,t,n){var r=this.db.transaction(t,e),i=rle(r),o=n(r);return i.then((()=>o))}};var rB=[e=>{nle(e)},e=>{e.createObjectStore("account")},e=>{e.createObjectStore("sessions",{keyPath:["deviceKey","sessionId"]}).createIndex("deviceKey","deviceKey")},e=>{e.createObjectStore("inbound_group_sessions",{keyPath:["senderCurve25519Key","sessionId"]})},e=>{e.createObjectStore("device_data")},e=>{e.createObjectStore("rooms")},e=>{e.createObjectStore("sessions_needing_backup",{keyPath:["senderCurve25519Key","sessionId"]})},e=>{e.createObjectStore("inbound_group_sessions_withheld",{keyPath:["senderCurve25519Key","sessionId"]})},e=>{e.createObjectStore("session_problems",{keyPath:["deviceKey","time"]}).createIndex("deviceKey","deviceKey"),e.createObjectStore("notified_error_devices",{keyPath:["userId","deviceId"]})},e=>{e.createObjectStore("shared_history_inbound_group_sessions",{keyPath:["roomId"]})},e=>{e.createObjectStore("parked_shared_history",{keyPath:["roomId"]})}],iB=rB.length;function tle(e,t){A.log("Upgrading IndexedDBCryptoStore from version ".concat(t)+" to ".concat(iB)),rB.forEach(((n,r)=>{t<=r&&n(e)}))}function nle(e){var t=e.createObjectStore("outgoingRoomKeyRequests",{keyPath:"requestId"});t.createIndex("session",["requestBody.room_id","requestBody.session_id"]),t.createIndex("state","state")}function Ni(e,t){e._mx_abortexception=t;try{e.abort()}catch{}}function rle(e){return new Promise(((t,n)=>{e.oncomplete=()=>{void 0!==e._mx_abortexception&&n(e._mx_abortexception),t(null)},e.onerror=t=>{void 0!==e._mx_abortexception?n(e._mx_abortexception):(A.log("Error performing indexeddb txn",t),n(e.error))},e.onabort=t=>{void 0!==e._mx_abortexception?n(e._mx_abortexception):(A.log("Error performing indexeddb txn",t),n(e.error))}}))}class Lt{static exists(e,t){return QH(e,t)}static existsAndIsNotMigrated(e,t){return new Promise(((n,r)=>{var i=!0,o=e.open(t);o.onupgradeneeded=()=>{i=!1},o.onblocked=()=>r(o.error),o.onsuccess=()=>{var s=o.result;if(i){var a=s.transaction([Lt.STORE_ACCOUNT],"readonly").objectStore(Lt.STORE_ACCOUNT).get(ek);a.onsuccess=()=>{var e,t=null!==(e=a.result)&&void 0!==e?e:sp.NOT_STARTED;n(t===sp.NOT_STARTED)},a.onerror=()=>{r(a.error)},s.close()}else s.close(),e.deleteDatabase(t),n(!1)},o.onerror=()=>r(o.error)}))}constructor(e,t){this.indexedDB=e,this.dbName=t,L(this,"backendPromise",void 0),L(this,"backend",void 0)}containsData(){var e=this;return U((function*(){return Lt.exists(e.indexedDB,e.dbName)}))()}startup(){return this.backendPromise||(this.backendPromise=new Promise(((e,t)=>{if(this.indexedDB){A.log("connecting to indexeddb ".concat(this.dbName));var n=this.indexedDB.open(this.dbName,iB);n.onupgradeneeded=e=>{tle(n.result,e.oldVersion)},n.onblocked=()=>{A.log("can't yet open IndexedDBCryptoStore because it is open elsewhere")},n.onerror=e=>{A.log("Error connecting to indexeddb",e),t(n.error)},n.onsuccess=()=>{var t=n.result;A.log("connected to indexeddb ".concat(this.dbName)),e(new ele(t))}}else t(new Error("no indexeddb support available"))})).then((e=>e.doTxn("readonly",[Lt.STORE_INBOUND_GROUP_SESSIONS,Lt.STORE_INBOUND_GROUP_SESSIONS_WITHHELD],(t=>{e.getEndToEndInboundGroupSession("","",t,(()=>{}))})).then((()=>e)))).catch((e=>{if("VersionError"===e.name)throw A.warn("Crypto DB is too new for us to use!",e),new ZP(XP.TooNew);A.warn("unable to connect to indexeddb ".concat(this.dbName)+": falling back to localStorage store: ".concat(e));try{if(!(globalThis.localStorage instanceof Storage))throw new Error("localStorage is not available");return new UE(globalThis.localStorage)}catch(e){return A.warn("Unable to open localStorage: falling back to in-memory store: ".concat(e)),new CE}})).then((e=>(this.backend=e,e)))),this.backendPromise}deleteAllData(){return new Promise(((e,t)=>{if(this.indexedDB){A.log("Removing indexeddb instance: ".concat(this.dbName));var n=this.indexedDB.deleteDatabase(this.dbName);n.onblocked=()=>{A.log("can't yet delete IndexedDBCryptoStore because it is open elsewhere")},n.onerror=e=>{A.log("Error deleting data from indexeddb",e),t(n.error)},n.onsuccess=()=>{A.log("Removed indexeddb instance: ".concat(this.dbName)),e()}}else t(new Error("no indexeddb support available"))})).catch((e=>{A.warn("unable to delete IndexedDBCryptoStore: ".concat(e))}))}getMigrationState(){return this.backend.getMigrationState()}setMigrationState(e){return this.backend.setMigrationState(e)}getAccount(e,t){this.backend.getAccount(e,t)}storeAccount(e,t){this.backend.storeAccount(e,t)}getCrossSigningKeys(e,t){this.backend.getCrossSigningKeys(e,t)}getSecretStorePrivateKey(e,t,n){this.backend.getSecretStorePrivateKey(e,t,n)}storeSecretStorePrivateKey(e,t,n){this.backend.storeSecretStorePrivateKey(e,t,n)}countEndToEndSessions(e,t){this.backend.countEndToEndSessions(e,t)}getEndToEndSession(e,t,n,r){this.backend.getEndToEndSession(e,t,n,r)}getEndToEndSessions(e,t,n){this.backend.getEndToEndSessions(e,t,n)}storeEndToEndSession(e,t,n,r){this.backend.storeEndToEndSession(e,t,n,r)}countEndToEndInboundGroupSessions(){return this.backend.countEndToEndInboundGroupSessions()}getEndToEndSessionsBatch(){return this.backend.getEndToEndSessionsBatch()}deleteEndToEndSessionsBatch(e){return this.backend.deleteEndToEndSessionsBatch(e)}getEndToEndInboundGroupSession(e,t,n,r){this.backend.getEndToEndInboundGroupSession(e,t,n,r)}storeEndToEndInboundGroupSession(e,t,n,r){this.backend.storeEndToEndInboundGroupSession(e,t,n,r)}getEndToEndInboundGroupSessionsBatch(){return this.backend.getEndToEndInboundGroupSessionsBatch()}deleteEndToEndInboundGroupSessionsBatch(e){return this.backend.deleteEndToEndInboundGroupSessionsBatch(e)}getEndToEndRooms(e,t){this.backend.getEndToEndRooms(e,t)}markSessionsNeedingBackup(e,t){return this.backend.markSessionsNeedingBackup(e,t)}doTxn(e,t,n,r){return this.backend.doTxn(e,t,n,r)}}L(Lt,"STORE_ACCOUNT","account"),L(Lt,"STORE_SESSIONS","sessions"),L(Lt,"STORE_INBOUND_GROUP_SESSIONS","inbound_group_sessions"),L(Lt,"STORE_INBOUND_GROUP_SESSIONS_WITHHELD","inbound_group_sessions_withheld"),L(Lt,"STORE_SHARED_HISTORY_INBOUND_GROUP_SESSIONS","shared_history_inbound_group_sessions"),L(Lt,"STORE_PARKED_SHARED_HISTORY","parked_shared_history"),L(Lt,"STORE_DEVICE_DATA","device_data"),L(Lt,"STORE_ROOMS","rooms"),L(Lt,"STORE_BACKUP","sessions_needing_backup");var ile=function(e){return e.Email="email",e.Phone="msisdn",e}({}),sle=new Kn("delegated_oidc_compatibility","org.matrix.msc3824.delegated_oidc_compatibility"),ole=function(e){return e.Gitlab="gitlab",e.Github="github",e.Apple="apple",e.Google="google",e.Facebook="facebook",e.Twitter="twitter",e}({}),ale=function(e){return e.LOGIN="login",e.REGISTER="register",e}({}),lle="us.cloke.msc4175.tz";class cle{constructor(e){L(this,"relations",void 0),this.relations=e.filter((e=>!!e))}getRelations(){return this.relations.reduce(((e,t)=>[...e,...t.getRelations()]),[])}on(e,t){this.relations.forEach((n=>n.on(e,t)))}off(e,t){this.relations.forEach((n=>n.off(e,t)))}}var ule=function(e){return e.Global="Global",e.SetItemError="setItem",e.GetItemError="getItem",e.RemoveItemError="removeItem",e.ClearError="clear",e.QuotaExceededError="QuotaExceededError",e}({});class dle extends En{}var fle=new dle,sB=()=>new CE;function oB(e){sB=e}function aB(e){var t,n,r;return e.store=null!==(t=e.store)&&void 0!==t?t:new Ov({localStorage:globalThis.localStorage}),e.scheduler=null!==(n=e.scheduler)&&void 0!==n?n:new ap,e.cryptoStore=null!==(r=e.cryptoStore)&&void 0!==r?r:sB(),e}function FE(e){return new jE(aB(e))}function lB(e,t,n,r){var i=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];return new YH(e,t,n,aB(r),i)}const hle=Object.freeze(Object.defineProperty({__proto__:null,AuthType:Fk,AutoDiscovery:it,AutoDiscoveryAction:ms,AutoDiscoveryError:to,Beacon:W$,BeaconEvent:yn,CallEvent:ft,CallFeedEvent:ra,Category:el,ClientEvent:Oe,ClientPrefix:fr,ClientStoppedError:Boe,ConditionKind:ir,ConditionOperator:uoe,ConnectionError:Jd,ContentHelpers:Bie,DELEGATED_OIDC_COMPATIBILITY:sle,DEVICE_CODE_SCOPE:wae,DMMemberCountCondition:doe,Device:Bae,DeviceVerification:XH,Direction:ht,DuplicateStrategy:Vg,EVENT_VISIBILITY_CHANGE_TYPE:md,EventEmitterEvents:_$,EventStatus:et,EventTimeline:Le,EventTimelineSet:_h,EventType:ee,FILTER_RELATED_BY_REL_TYPES:jh,FILTER_RELATED_BY_SENDERS:Dh,FeatureSupport:ai,Filter:Hi,GET_LOGIN_TOKEN_CAPABILITY:xae,GroupCall:qP,GroupCallEvent:rn,GroupCallIntent:vH,GroupCallState:Ln,GroupCallStatsReportEvent:Og,GroupCallType:LE,GuestAccess:Xb,HTTPError:lu,HistoryVisibility:WP,HttpApiEvent:uk,IdentityPrefix:Qa,IdentityProviderBrand:ole,IndexedDBCryptoStore:Lt,IndexedDBStore:nB,InteractiveAuth:sL,InvalidCryptoStoreError:ZP,InvalidCryptoStoreState:XP,JoinRule:Jc,KNOWN_SAFE_ROOM_VERSION:lH,KeySignatureUploadError:Hoe,KnownMembership:Ke,LOCAL_NOTIFICATION_SETTINGS_PREFIX:w$,LocalStorageCryptoStore:UE,LocalStorageErrors:ule,LocationAssetType:ip,MAIN_ROOM_TIMELINE:Ey,MAXIMUM_MATRIX_VERSION:yoe,MINIMUM_MATRIX_VERSION:voe,MSC3912_RELATION_BASED_REDACTIONS_PROP:sk,M_ASSET:by,M_BEACON:wk,M_BEACON_INFO:zP,M_HTML:Nie,M_LOCATION:Sy,M_MESSAGE:Aie,M_POLL_END:Yb,M_POLL_KIND_DISCLOSED:qie,M_POLL_KIND_UNDISCLOSED:Kie,M_POLL_RESPONSE:Rv,M_POLL_START:Gie,M_TEXT:AP,M_TIMESTAMP:Eu,M_TOPIC:NP,MatrixClient:jE,MatrixError:bn,MatrixEvent:Ci,MatrixEventEvent:Mt,MatrixHttpApi:sH,MatrixScheduler:ap,MediaHandlerEvent:ad,MediaPrefix:Lh,MemoryCryptoStore:CE,MemoryStore:Ov,Method:ae,MsgType:Pa,NoAuthFlowFoundError:ZH,NotificationCountType:jt,OidcError:li,OidcTokenRefresher:Tae,PUSHER_DEVICE_ID:_ie,PUSHER_ENABLED:ok,PendingEventOrdering:cp,Poll:J$,PollEvent:Oc,Preset:ME,ProfileKeyMSC4175Timezone:lle,PushRuleActionName:Yc,PushRuleKind:Lr,REFERENCE_RELATION:D$,ReceiptType:yi,RelatedRelations:cle,RelationType:cn,Relations:MP,RelationsEvent:N_,RestrictedAllowType:boe,Room:xE,RoomCreateTypeField:Kb,RoomEvent:ke,RoomMember:wv,RoomMemberEvent:Gi,RoomNameType:na,RoomState:Lv,RoomStateEvent:ut,RoomSummary:A$,RoomType:Ph,RoomVersionStability:oH,RoomWidgetClient:YH,RoomWidgetClientEvent:V_,RuleId:Pr,SERVICE_TYPES:Sk,SSOAction:ale,SUPPORTED_MATRIX_VERSIONS:kv,SearchOrderBy:bH,SearchResult:OE,SecretStorage:Foe,ServerCapabilities:aH,SetPresence:cH,SlidingSyncEvent:Ek,StatsReport:_l,SyncAccumulator:JH,SyncState:Dt,THREAD_RELATION_TYPE:Zt,Thread:dn,ThreadEvent:_i,ThreadFilterType:Eo,ThreepidMedium:ile,TimelineIndex:Uk,TimelineWindow:qae,ToDeviceMessageId:IE,TokenRefreshError:eH,TokenRefreshLogoutError:UP,TweakName:KP,TypedEventEmitter:En,UNSIGNED_MEMBERSHIP_FIELD:C$,UNSIGNED_THREAD_ID_FIELD:Gb,UNSTABLE_ELEMENT_FUNCTIONAL_USERS:E$,UNSTABLE_MSC2666_MUTUAL_ROOMS:HH,UNSTABLE_MSC2666_QUERY_MUTUAL_ROOMS:BH,UNSTABLE_MSC2666_SHARED_ROOMS:$H,UNSTABLE_MSC2716_MARKER:S$,UNSTABLE_MSC3088_ENABLED:rk,UNSTABLE_MSC3088_PURPOSE:nk,UNSTABLE_MSC3089_BRANCH:fl,UNSTABLE_MSC3089_LEAF:b$,UNSTABLE_MSC3089_TREE_SUBTYPE:ik,UNSTABLE_MSC3852_LAST_SEEN_UA:kae,UNSTABLE_MSC4133_EXTENDED_PROFILES:VH,UNSTABLE_MSC4140_DELAYED_EVENTS:ha,UnsupportedDelayedEventsEndpointError:$c,UpdateDelayedEventAction:Sd,User:El,UserEvent:Kr,Visibility:_H,anySignal:tH,calculateRetryBackoff:$P,completeAuthorizationCodeGrant:Eae,createClient:FE,createNewMatrixCall:Iv,createRoomWidgetClient:lB,decodeBase64:Oh,decodeIdToken:DH,determineFeatureSupport:H_,discoverAndValidateOIDCIssuerWellKnown:rL,encodeBase64:D_,encodeUnpaddedBase64:pH,encodeUnpaddedBase64Url:PE,fixNotificationCountOnDecryption:qH,generateAuthorizationParams:yae,generateAuthorizationUrl:_ae,generateOidcAuthorizationUrl:bae,generateScope:DE,getBeaconInfoIdentifier:zb,getHttpUriForMxc:TE,inMainTimelineForReceipt:Pv,isDmMemberCountCondition:foe,isEventTypeSame:Die,isPollEvent:X$,isTimestampInDuration:lk,localStorageErrorsEventsEmitter:fle,parseErrorResponse:FP,registerOidcClient:Cae,retryNetworkOperation:dk,safeGetRetryAfterMs:jP,setCryptoStoreFactory:oB,threadFilterTypeToFilter:KH,threadIdForReceipt:up,timeoutSignal:kE,validateAuthMetadata:NH,validateAuthMetadataAndKeys:iL,validateBearerTokenResponse:FH,validateIdToken:jH,validateStoredUserState:UH},Symbol.toStringTag,{value:"Module"}));if(globalThis.__js_sdk_entrypoint)throw new Error("Multiple matrix-js-sdk entrypoints detected!");var $k;globalThis.__js_sdk_entrypoint=!0;try{$k=globalThis.indexedDB}catch{}$k&&oB((()=>new Lt($k,"matrix-js-sdk:crypto"))),globalThis.matrixcs=hle;var _=IP();const we=Ko(_),cB=$re({__proto__:null,default:we},[_]);var VN,qN,KN,GN,WN,x1={},m2={exports:{}},Di={},g2={exports:{}},v2={};function ple(){return VN||(VN=1,function(e){function t(e,t){var n=e.length;e.push(t);e:for(;0<n;){var r=n-1>>>1,o=e[r];if(!(0<i(o,t)))break e;e[r]=t,e[n]=o,n=r}}function n(e){return 0===e.length?null:e[0]}function r(e){if(0===e.length)return null;var t=e[0],n=e.pop();if(n!==t){e[0]=n;e:for(var r=0,o=e.length,s=o>>>1;r<s;){var a=2*(r+1)-1,l=e[a],c=a+1,u=e[c];if(0>i(l,n))c<o&&0>i(u,l)?(e[r]=u,e[c]=n,r=c):(e[r]=l,e[a]=n,r=a);else{if(!(c<o&&0>i(u,n)))break e;e[r]=u,e[c]=n,r=c}}}return t}function i(e,t){var n=e.sortIndex-t.sortIndex;return 0!==n?n:e.id-t.id}if("object"==typeof performance&&"function"==typeof performance.now){var o=performance;e.unstable_now=function(){return o.now()}}else{var s=Date,a=s.now();e.unstable_now=function(){return s.now()-a}}var l=[],c=[],u=1,d=null,h=3,p=!1,f=!1,m=!1,v="function"==typeof setTimeout?setTimeout:null,g="function"==typeof clearTimeout?clearTimeout:null,y=typeof setImmediate<"u"?setImmediate:null;function b(e){for(var i=n(c);null!==i;){if(null===i.callback)r(c);else{if(!(i.startTime<=e))break;r(c),i.sortIndex=i.expirationTime,t(l,i)}i=n(c)}}function _(e){if(m=!1,b(e),!f)if(null!==n(l))f=!0,O(w);else{var t=n(c);null!==t&&A(_,t.startTime-e)}}function w(t,i){f=!1,m&&(m=!1,g(k),k=-1),p=!0;var o=h;try{for(b(i),d=n(l);null!==d&&(!(d.expirationTime>i)||t&&!R());){var s=d.callback;if("function"==typeof s){d.callback=null,h=d.priorityLevel;var a=s(d.expirationTime<=i);i=e.unstable_now(),"function"==typeof a?d.callback=a:d===n(l)&&r(l),b(i)}else r(l);d=n(l)}if(null!==d)var u=!0;else{var v=n(c);null!==v&&A(_,v.startTime-i),u=!1}return u}finally{d=null,h=o,p=!1}}typeof navigator<"u"&&void 0!==navigator.scheduling&&void 0!==navigator.scheduling.isInputPending&&navigator.scheduling.isInputPending.bind(navigator.scheduling);var E,S=!1,C=null,k=-1,T=5,I=-1;function R(){return!(e.unstable_now()-I<T)}function x(){if(null!==C){var t=e.unstable_now();I=t;var n=!0;try{n=C(!0,t)}finally{n?E():(S=!1,C=null)}}else S=!1}if("function"==typeof y)E=function(){y(x)};else if(typeof MessageChannel<"u"){var L=new MessageChannel,P=L.port2;L.port1.onmessage=x,E=function(){P.postMessage(null)}}else E=function(){v(x,0)};function O(e){C=e,S||(S=!0,E())}function A(t,n){k=v((function(){t(e.unstable_now())}),n)}e.unstable_IdlePriority=5,e.unstable_ImmediatePriority=1,e.unstable_LowPriority=4,e.unstable_NormalPriority=3,e.unstable_Profiling=null,e.unstable_UserBlockingPriority=2,e.unstable_cancelCallback=function(e){e.callback=null},e.unstable_continueExecution=function(){f||p||(f=!0,O(w))},e.unstable_forceFrameRate=function(e){0>e||125<e?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):T=0<e?Math.floor(1e3/e):5},e.unstable_getCurrentPriorityLevel=function(){return h},e.unstable_getFirstCallbackNode=function(){return n(l)},e.unstable_next=function(e){switch(h){case 1:case 2:case 3:var t=3;break;default:t=h}var n=h;h=t;try{return e()}finally{h=n}},e.unstable_pauseExecution=function(){},e.unstable_requestPaint=function(){},e.unstable_runWithPriority=function(e,t){switch(e){case 1:case 2:case 3:case 4:case 5:break;default:e=3}var n=h;h=e;try{return t()}finally{h=n}},e.unstable_scheduleCallback=function(r,i,o){var s=e.unstable_now();switch("object"==typeof o&&null!==o?o="number"==typeof(o=o.delay)&&0<o?s+o:s:o=s,r){case 1:var a=-1;break;case 2:a=250;break;case 5:a=1073741823;break;case 4:a=1e4;break;default:a=5e3}return r={id:u++,callback:i,priorityLevel:r,startTime:o,expirationTime:a=o+a,sortIndex:-1},o>s?(r.sortIndex=o,t(c,r),null===n(l)&&r===n(c)&&(m?(g(k),k=-1):m=!0,A(_,o-s))):(r.sortIndex=a,t(l,r),f||p||(f=!0,O(w))),r},e.unstable_shouldYield=R,e.unstable_wrapCallback=function(e){var t=h;return function(){var n=h;h=t;try{return e.apply(this,arguments)}finally{h=n}}}}(v2)),v2}function mle(){return qN||(qN=1,g2.exports=ple()),g2.exports}function gle(){if(KN)return Di;KN=1;var e=IP(),t=mle();function n(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,n=1;n<arguments.length;n++)t+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var r=new Set,i={};function o(e,t){s(e,t),s(e+"Capture",t)}function s(e,t){for(i[e]=t,e=0;e<t.length;e++)r.add(t[e])}var a=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),l=Object.prototype.hasOwnProperty,c=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,u={},d={};function h(e,t,n,r,i,o,s){this.acceptsBooleans=2===t||3===t||4===t,this.attributeName=r,this.attributeNamespace=i,this.mustUseProperty=n,this.propertyName=e,this.type=t,this.sanitizeURL=o,this.removeEmptyString=s}var p={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach((function(e){p[e]=new h(e,0,!1,e,null,!1,!1)})),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach((function(e){var t=e[0];p[t]=new h(t,1,!1,e[1],null,!1,!1)})),["contentEditable","draggable","spellCheck","value"].forEach((function(e){p[e]=new h(e,2,!1,e.toLowerCase(),null,!1,!1)})),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach((function(e){p[e]=new h(e,2,!1,e,null,!1,!1)})),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach((function(e){p[e]=new h(e,3,!1,e.toLowerCase(),null,!1,!1)})),["checked","multiple","muted","selected"].forEach((function(e){p[e]=new h(e,3,!0,e,null,!1,!1)})),["capture","download"].forEach((function(e){p[e]=new h(e,4,!1,e,null,!1,!1)})),["cols","rows","size","span"].forEach((function(e){p[e]=new h(e,6,!1,e,null,!1,!1)})),["rowSpan","start"].forEach((function(e){p[e]=new h(e,5,!1,e.toLowerCase(),null,!1,!1)}));var f=/[\-:]([a-z])/g;function m(e){return e[1].toUpperCase()}function v(e,t,n,r){var i=p.hasOwnProperty(t)?p[t]:null;(null!==i?0!==i.type:r||!(2<t.length)||"o"!==t[0]&&"O"!==t[0]||"n"!==t[1]&&"N"!==t[1])&&(function(e,t,n,r){if(null===t||typeof t>"u"||function(e,t,n,r){if(null!==n&&0===n.type)return!1;switch(typeof t){case"function":case"symbol":return!0;case"boolean":return!r&&(null!==n?!n.acceptsBooleans:"data-"!==(e=e.toLowerCase().slice(0,5))&&"aria-"!==e);default:return!1}}(e,t,n,r))return!0;if(r)return!1;if(null!==n)switch(n.type){case 3:return!t;case 4:return!1===t;case 5:return isNaN(t);case 6:return isNaN(t)||1>t}return!1}(t,n,i,r)&&(n=null),r||null===i?function(e){return!!l.call(d,e)||!l.call(u,e)&&(c.test(e)?d[e]=!0:(u[e]=!0,!1))}(t)&&(null===n?e.removeAttribute(t):e.setAttribute(t,""+n)):i.mustUseProperty?e[i.propertyName]=null===n?3!==i.type&&"":n:(t=i.attributeName,r=i.attributeNamespace,null===n?e.removeAttribute(t):(n=3===(i=i.type)||4===i&&!0===n?"":""+n,r?e.setAttributeNS(r,t,n):e.setAttribute(t,n))))}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach((function(e){var t=e.replace(f,m);p[t]=new h(t,1,!1,e,null,!1,!1)})),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach((function(e){var t=e.replace(f,m);p[t]=new h(t,1,!1,e,"http://www.w3.org/1999/xlink",!1,!1)})),["xml:base","xml:lang","xml:space"].forEach((function(e){var t=e.replace(f,m);p[t]=new h(t,1,!1,e,"http://www.w3.org/XML/1998/namespace",!1,!1)})),["tabIndex","crossOrigin"].forEach((function(e){p[e]=new h(e,1,!1,e.toLowerCase(),null,!1,!1)})),p.xlinkHref=new h("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach((function(e){p[e]=new h(e,1,!1,e.toLowerCase(),null,!0,!0)}));var g=e.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,y=Symbol.for("react.element"),b=Symbol.for("react.portal"),_=Symbol.for("react.fragment"),w=Symbol.for("react.strict_mode"),E=Symbol.for("react.profiler"),S=Symbol.for("react.provider"),C=Symbol.for("react.context"),k=Symbol.for("react.forward_ref"),T=Symbol.for("react.suspense"),I=Symbol.for("react.suspense_list"),R=Symbol.for("react.memo"),x=Symbol.for("react.lazy"),L=Symbol.for("react.offscreen"),P=Symbol.iterator;function O(e){return null===e||"object"!=typeof e?null:"function"==typeof(e=P&&e[P]||e["@@iterator"])?e:null}var A,M=Object.assign;function N(e){if(void 0===A)try{throw Error()}catch(e){var t=e.stack.trim().match(/\n( *(at )?)/);A=t&&t[1]||""}return"\n"+A+e}var D=!1;function j(e,t){if(!e||D)return"";D=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(t)if(t=function(){throw Error()},Object.defineProperty(t.prototype,"props",{set:function(){throw Error()}}),"object"==typeof Reflect&&Reflect.construct){try{Reflect.construct(t,[])}catch(e){var r=e}Reflect.construct(e,[],t)}else{try{t.call()}catch(e){r=e}e.call(t.prototype)}else{try{throw Error()}catch(e){r=e}e()}}catch(t){if(t&&r&&"string"==typeof t.stack){for(var i=t.stack.split("\n"),o=r.stack.split("\n"),s=i.length-1,a=o.length-1;1<=s&&0<=a&&i[s]!==o[a];)a--;for(;1<=s&&0<=a;s--,a--)if(i[s]!==o[a]){if(1!==s||1!==a)do{if(s--,0>--a||i[s]!==o[a]){var l="\n"+i[s].replace(" at new "," at ");return e.displayName&&l.includes("<anonymous>")&&(l=l.replace("<anonymous>",e.displayName)),l}}while(1<=s&&0<=a);break}}}finally{D=!1,Error.prepareStackTrace=n}return(e=e?e.displayName||e.name:"")?N(e):""}function U(e){switch(e.tag){case 5:return N(e.type);case 16:return N("Lazy");case 13:return N("Suspense");case 19:return N("SuspenseList");case 0:case 2:case 15:return e=j(e.type,!1);case 11:return e=j(e.type.render,!1);case 1:return e=j(e.type,!0);default:return""}}function F(e){if(null==e)return null;if("function"==typeof e)return e.displayName||e.name||null;if("string"==typeof e)return e;switch(e){case _:return"Fragment";case b:return"Portal";case E:return"Profiler";case w:return"StrictMode";case T:return"Suspense";case I:return"SuspenseList"}if("object"==typeof e)switch(e.$$typeof){case C:return(e.displayName||"Context")+".Consumer";case S:return(e._context.displayName||"Context")+".Provider";case k:var t=e.render;return(e=e.displayName)||(e=""!==(e=t.displayName||t.name||"")?"ForwardRef("+e+")":"ForwardRef"),e;case R:return null!==(t=e.displayName||null)?t:F(e.type)||"Memo";case x:t=e._payload,e=e._init;try{return F(e(t))}catch{}}return null}function H(e){var t=e.type;switch(e.tag){case 24:return"Cache";case 9:return(t.displayName||"Context")+".Consumer";case 10:return(t._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return e=(e=t.render).displayName||e.name||"",t.displayName||(""!==e?"ForwardRef("+e+")":"ForwardRef");case 7:return"Fragment";case 5:return t;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return F(t);case 8:return t===w?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if("function"==typeof t)return t.displayName||t.name||null;if("string"==typeof t)return t}return null}function B(e){switch(typeof e){case"boolean":case"number":case"string":case"undefined":case"object":return e;default:return""}}function $(e){var t=e.type;return(e=e.nodeName)&&"input"===e.toLowerCase()&&("checkbox"===t||"radio"===t)}function V(e){e._valueTracker||(e._valueTracker=function(e){var t=$(e)?"checked":"value",n=Object.getOwnPropertyDescriptor(e.constructor.prototype,t),r=""+e[t];if(!e.hasOwnProperty(t)&&typeof n<"u"&&"function"==typeof n.get&&"function"==typeof n.set){var i=n.get,o=n.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return i.call(this)},set:function(e){r=""+e,o.call(this,e)}}),Object.defineProperty(e,t,{enumerable:n.enumerable}),{getValue:function(){return r},setValue:function(e){r=""+e},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}(e))}function q(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var n=t.getValue(),r="";return e&&(r=$(e)?e.checked?"true":"false":e.value),(e=r)!==n&&(t.setValue(e),!0)}function K(e){if(typeof(e=e||(typeof document<"u"?document:void 0))>"u")return null;try{return e.activeElement||e.body}catch{return e.body}}function G(e,t){var n=t.checked;return M({},t,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:n??e._wrapperState.initialChecked})}function W(e,t){var n=null==t.defaultValue?"":t.defaultValue,r=null!=t.checked?t.checked:t.defaultChecked;n=B(null!=t.value?t.value:n),e._wrapperState={initialChecked:r,initialValue:n,controlled:"checkbox"===t.type||"radio"===t.type?null!=t.checked:null!=t.value}}function z(e,t){null!=(t=t.checked)&&v(e,"checked",t,!1)}function J(e,t){z(e,t);var n=B(t.value),r=t.type;if(null!=n)"number"===r?(0===n&&""===e.value||e.value!=n)&&(e.value=""+n):e.value!==""+n&&(e.value=""+n);else if("submit"===r||"reset"===r)return void e.removeAttribute("value");t.hasOwnProperty("value")?Q(e,t.type,n):t.hasOwnProperty("defaultValue")&&Q(e,t.type,B(t.defaultValue)),null==t.checked&&null!=t.defaultChecked&&(e.defaultChecked=!!t.defaultChecked)}function Y(e,t,n){if(t.hasOwnProperty("value")||t.hasOwnProperty("defaultValue")){var r=t.type;if(!("submit"!==r&&"reset"!==r||void 0!==t.value&&null!==t.value))return;t=""+e._wrapperState.initialValue,n||t===e.value||(e.value=t),e.defaultValue=t}""!==(n=e.name)&&(e.name=""),e.defaultChecked=!!e._wrapperState.initialChecked,""!==n&&(e.name=n)}function Q(e,t,n){("number"!==t||K(e.ownerDocument)!==e)&&(null==n?e.defaultValue=""+e._wrapperState.initialValue:e.defaultValue!==""+n&&(e.defaultValue=""+n))}var Z=Array.isArray;function X(e,t,n,r){if(e=e.options,t){t={};for(var i=0;i<n.length;i++)t["$"+n[i]]=!0;for(n=0;n<e.length;n++)i=t.hasOwnProperty("$"+e[n].value),e[n].selected!==i&&(e[n].selected=i),i&&r&&(e[n].defaultSelected=!0)}else{for(n=""+B(n),t=null,i=0;i<e.length;i++){if(e[i].value===n)return e[i].selected=!0,void(r&&(e[i].defaultSelected=!0));null!==t||e[i].disabled||(t=e[i])}null!==t&&(t.selected=!0)}}function ee(e,t){if(null!=t.dangerouslySetInnerHTML)throw Error(n(91));return M({},t,{value:void 0,defaultValue:void 0,children:""+e._wrapperState.initialValue})}function te(e,t){var r=t.value;if(null==r){if(r=t.children,t=t.defaultValue,null!=r){if(null!=t)throw Error(n(92));if(Z(r)){if(1<r.length)throw Error(n(93));r=r[0]}t=r}null==t&&(t=""),r=t}e._wrapperState={initialValue:B(r)}}function ne(e,t){var n=B(t.value),r=B(t.defaultValue);null!=n&&((n=""+n)!==e.value&&(e.value=n),null==t.defaultValue&&e.defaultValue!==n&&(e.defaultValue=n)),null!=r&&(e.defaultValue=""+r)}function re(e){var t=e.textContent;t===e._wrapperState.initialValue&&""!==t&&null!==t&&(e.value=t)}function ie(e){switch(e){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function oe(e,t){return null==e||"http://www.w3.org/1999/xhtml"===e?ie(t):"http://www.w3.org/2000/svg"===e&&"foreignObject"===t?"http://www.w3.org/1999/xhtml":e}var se,ae,le=(ae=function(e,t){if("http://www.w3.org/2000/svg"!==e.namespaceURI||"innerHTML"in e)e.innerHTML=t;else{for((se=se||document.createElement("div")).innerHTML="<svg>"+t.valueOf().toString()+"</svg>",t=se.firstChild;e.firstChild;)e.removeChild(e.firstChild);for(;t.firstChild;)e.appendChild(t.firstChild)}},typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(e,t,n,r){MSApp.execUnsafeLocalFunction((function(){return ae(e,t)}))}:ae);function ce(e,t){if(t){var n=e.firstChild;if(n&&n===e.lastChild&&3===n.nodeType)return void(n.nodeValue=t)}e.textContent=t}var ue={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},de=["Webkit","ms","Moz","O"];function he(e,t,n){return null==t||"boolean"==typeof t||""===t?"":n||"number"!=typeof t||0===t||ue.hasOwnProperty(e)&&ue[e]?(""+t).trim():t+"px"}function pe(e,t){for(var n in e=e.style,t)if(t.hasOwnProperty(n)){var r=0===n.indexOf("--"),i=he(n,t[n],r);"float"===n&&(n="cssFloat"),r?e.setProperty(n,i):e[n]=i}}Object.keys(ue).forEach((function(e){de.forEach((function(t){t=t+e.charAt(0).toUpperCase()+e.substring(1),ue[t]=ue[e]}))}));var fe=M({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function me(e,t){if(t){if(fe[e]&&(null!=t.children||null!=t.dangerouslySetInnerHTML))throw Error(n(137,e));if(null!=t.dangerouslySetInnerHTML){if(null!=t.children)throw Error(n(60));if("object"!=typeof t.dangerouslySetInnerHTML||!("__html"in t.dangerouslySetInnerHTML))throw Error(n(61))}if(null!=t.style&&"object"!=typeof t.style)throw Error(n(62))}}function ve(e,t){if(-1===e.indexOf("-"))return"string"==typeof t.is;switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var ge=null;function ye(e){return(e=e.target||e.srcElement||window).correspondingUseElement&&(e=e.correspondingUseElement),3===e.nodeType?e.parentNode:e}var be=null,_e=null,we=null;function Ee(e){if(e=vi(e)){if("function"!=typeof be)throw Error(n(280));var t=e.stateNode;t&&(t=yi(t),be(e.stateNode,e.type,t))}}function Se(e){_e?we?we.push(e):we=[e]:_e=e}function Ce(){if(_e){var e=_e,t=we;if(we=_e=null,Ee(e),t)for(e=0;e<t.length;e++)Ee(t[e])}}function ke(e,t){return e(t)}function Te(){}var Ie=!1;function Re(e,t,n){if(Ie)return e(t,n);Ie=!0;try{return ke(e,t,n)}finally{Ie=!1,(null!==_e||null!==we)&&(Te(),Ce())}}function xe(e,t){var r=e.stateNode;if(null===r)return null;var i=yi(r);if(null===i)return null;r=i[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(i=!i.disabled)||(i=!("button"===(e=e.type)||"input"===e||"select"===e||"textarea"===e)),e=!i;break e;default:e=!1}if(e)return null;if(r&&"function"!=typeof r)throw Error(n(231,t,typeof r));return r}var Le=!1;if(a)try{var Pe={};Object.defineProperty(Pe,"passive",{get:function(){Le=!0}}),window.addEventListener("test",Pe,Pe),window.removeEventListener("test",Pe,Pe)}catch{Le=!1}function Oe(e,t,n,r,i,o,s,a,l){var c=Array.prototype.slice.call(arguments,3);try{t.apply(n,c)}catch(e){this.onError(e)}}var Ae=!1,Me=null,Ne=!1,De=null,je={onError:function(e){Ae=!0,Me=e}};function Ue(e,t,n,r,i,o,s,a,l){Ae=!1,Me=null,Oe.apply(je,arguments)}function Fe(e){var t=e,n=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do{!!(4098&(t=e).flags)&&(n=t.return),e=t.return}while(e)}return 3===t.tag?n:null}function He(e){if(13===e.tag){var t=e.memoizedState;if(null===t&&(null!==(e=e.alternate)&&(t=e.memoizedState)),null!==t)return t.dehydrated}return null}function Be(e){if(Fe(e)!==e)throw Error(n(188))}function $e(e){return null!==(e=function(e){var t=e.alternate;if(!t){if(null===(t=Fe(e)))throw Error(n(188));return t!==e?null:e}for(var r=e,i=t;;){var o=r.return;if(null===o)break;var s=o.alternate;if(null===s){if(null!==(i=o.return)){r=i;continue}break}if(o.child===s.child){for(s=o.child;s;){if(s===r)return Be(o),e;if(s===i)return Be(o),t;s=s.sibling}throw Error(n(188))}if(r.return!==i.return)r=o,i=s;else{for(var a=!1,l=o.child;l;){if(l===r){a=!0,r=o,i=s;break}if(l===i){a=!0,i=o,r=s;break}l=l.sibling}if(!a){for(l=s.child;l;){if(l===r){a=!0,r=s,i=o;break}if(l===i){a=!0,i=s,r=o;break}l=l.sibling}if(!a)throw Error(n(189))}}if(r.alternate!==i)throw Error(n(190))}if(3!==r.tag)throw Error(n(188));return r.stateNode.current===r?e:t}(e))?Ve(e):null}function Ve(e){if(5===e.tag||6===e.tag)return e;for(e=e.child;null!==e;){var t=Ve(e);if(null!==t)return t;e=e.sibling}return null}var qe=t.unstable_scheduleCallback,Ke=t.unstable_cancelCallback,Ge=t.unstable_shouldYield,We=t.unstable_requestPaint,ze=t.unstable_now,Je=t.unstable_getCurrentPriorityLevel,Ye=t.unstable_ImmediatePriority,Qe=t.unstable_UserBlockingPriority,Ze=t.unstable_NormalPriority,Xe=t.unstable_LowPriority,et=t.unstable_IdlePriority,tt=null,nt=null;var rt=Math.clz32?Math.clz32:function(e){return e>>>=0,0===e?32:31-(it(e)/ot|0)|0},it=Math.log,ot=Math.LN2;var st=64,at=4194304;function lt(e){switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return 4194240&e;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return 130023424&e;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return e}}function ct(e,t){var n=e.pendingLanes;if(0===n)return 0;var r=0,i=e.suspendedLanes,o=e.pingedLanes,s=268435455&n;if(0!==s){var a=s&~i;0!==a?r=lt(a):0!==(o&=s)&&(r=lt(o))}else 0!==(s=n&~i)?r=lt(s):0!==o&&(r=lt(o));if(0===r)return 0;if(0!==t&&t!==r&&!(t&i)&&((i=r&-r)>=(o=t&-t)||16===i&&4194240&o))return t;if(!!(4&r)&&(r|=16&n),0!==(t=e.entangledLanes))for(e=e.entanglements,t&=r;0<t;)i=1<<(n=31-rt(t)),r|=e[n],t&=~i;return r}function ut(e,t){switch(e){case 1:case 2:case 4:return t+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;default:return-1}}function dt(e){return 0!==(e=-1073741825&e.pendingLanes)?e:1073741824&e?1073741824:0}function ht(){var e=st;return!(4194240&(st<<=1))&&(st=64),e}function pt(e){for(var t=[],n=0;31>n;n++)t.push(e);return t}function ft(e,t,n){e.pendingLanes|=t,536870912!==t&&(e.suspendedLanes=0,e.pingedLanes=0),(e=e.eventTimes)[t=31-rt(t)]=n}function mt(e,t){var n=e.entangledLanes|=t;for(e=e.entanglements;n;){var r=31-rt(n),i=1<<r;i&t|e[r]&t&&(e[r]|=t),n&=~i}}var vt=0;function gt(e){return 1<(e&=-e)?4<e?268435455&e?16:536870912:4:1}var yt,bt,_t,wt,Et,St=!1,Ct=[],kt=null,Tt=null,It=null,Rt=new Map,xt=new Map,Lt=[],Pt="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Ot(e,t){switch(e){case"focusin":case"focusout":kt=null;break;case"dragenter":case"dragleave":Tt=null;break;case"mouseover":case"mouseout":It=null;break;case"pointerover":case"pointerout":Rt.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":xt.delete(t.pointerId)}}function At(e,t,n,r,i,o){return null===e||e.nativeEvent!==o?(e={blockedOn:t,domEventName:n,eventSystemFlags:r,nativeEvent:o,targetContainers:[i]},null!==t&&(null!==(t=vi(t))&&bt(t)),e):(e.eventSystemFlags|=r,t=e.targetContainers,null!==i&&-1===t.indexOf(i)&&t.push(i),e)}function Mt(e){var t=mi(e.target);if(null!==t){var n=Fe(t);if(null!==n)if(13===(t=n.tag)){if(null!==(t=He(n)))return e.blockedOn=t,void Et(e.priority,(function(){_t(n)}))}else if(3===t&&n.stateNode.current.memoizedState.isDehydrated)return void(e.blockedOn=3===n.tag?n.stateNode.containerInfo:null)}e.blockedOn=null}function Nt(e){if(null!==e.blockedOn)return!1;for(var t=e.targetContainers;0<t.length;){var n=Gt(e.domEventName,e.eventSystemFlags,t[0],e.nativeEvent);if(null!==n)return null!==(t=vi(n))&&bt(t),e.blockedOn=n,!1;var r=new(n=e.nativeEvent).constructor(n.type,n);ge=r,n.target.dispatchEvent(r),ge=null,t.shift()}return!0}function Dt(e,t,n){Nt(e)&&n.delete(t)}function jt(){St=!1,null!==kt&&Nt(kt)&&(kt=null),null!==Tt&&Nt(Tt)&&(Tt=null),null!==It&&Nt(It)&&(It=null),Rt.forEach(Dt),xt.forEach(Dt)}function Ut(e,n){e.blockedOn===n&&(e.blockedOn=null,St||(St=!0,t.unstable_scheduleCallback(t.unstable_NormalPriority,jt)))}function Ft(e){function t(t){return Ut(t,e)}if(0<Ct.length){Ut(Ct[0],e);for(var n=1;n<Ct.length;n++){var r=Ct[n];r.blockedOn===e&&(r.blockedOn=null)}}for(null!==kt&&Ut(kt,e),null!==Tt&&Ut(Tt,e),null!==It&&Ut(It,e),Rt.forEach(t),xt.forEach(t),n=0;n<Lt.length;n++)(r=Lt[n]).blockedOn===e&&(r.blockedOn=null);for(;0<Lt.length&&null===(n=Lt[0]).blockedOn;)Mt(n),null===n.blockedOn&&Lt.shift()}var Ht=g.ReactCurrentBatchConfig,Bt=!0;function $t(e,t,n,r){var i=vt,o=Ht.transition;Ht.transition=null;try{vt=1,qt(e,t,n,r)}finally{vt=i,Ht.transition=o}}function Vt(e,t,n,r){var i=vt,o=Ht.transition;Ht.transition=null;try{vt=4,qt(e,t,n,r)}finally{vt=i,Ht.transition=o}}function qt(e,t,n,r){if(Bt){var i=Gt(e,t,n,r);if(null===i)Br(e,t,r,Kt,n),Ot(e,r);else if(function(e,t,n,r,i){switch(t){case"focusin":return kt=At(kt,e,t,n,r,i),!0;case"dragenter":return Tt=At(Tt,e,t,n,r,i),!0;case"mouseover":return It=At(It,e,t,n,r,i),!0;case"pointerover":var o=i.pointerId;return Rt.set(o,At(Rt.get(o)||null,e,t,n,r,i)),!0;case"gotpointercapture":return o=i.pointerId,xt.set(o,At(xt.get(o)||null,e,t,n,r,i)),!0}return!1}(i,e,t,n,r))r.stopPropagation();else if(Ot(e,r),4&t&&-1<Pt.indexOf(e)){for(;null!==i;){var o=vi(i);if(null!==o&&yt(o),null===(o=Gt(e,t,n,r))&&Br(e,t,r,Kt,n),o===i)break;i=o}null!==i&&r.stopPropagation()}else Br(e,t,r,null,n)}}var Kt=null;function Gt(e,t,n,r){if(Kt=null,null!==(e=mi(e=ye(r))))if(null===(t=Fe(e)))e=null;else if(13===(n=t.tag)){if(null!==(e=He(t)))return e;e=null}else if(3===n){if(t.stateNode.current.memoizedState.isDehydrated)return 3===t.tag?t.stateNode.containerInfo:null;e=null}else t!==e&&(e=null);return Kt=e,null}function Wt(e){switch(e){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(Je()){case Ye:return 1;case Qe:return 4;case Ze:case Xe:return 16;case et:return 536870912;default:return 16}default:return 16}}var zt=null,Jt=null,Yt=null;function Qt(){if(Yt)return Yt;var e,t,n=Jt,r=n.length,i="value"in zt?zt.value:zt.textContent,o=i.length;for(e=0;e<r&&n[e]===i[e];e++);var s=r-e;for(t=1;t<=s&&n[r-t]===i[o-t];t++);return Yt=i.slice(e,1<t?1-t:void 0)}function Zt(e){var t=e.keyCode;return"charCode"in e?0===(e=e.charCode)&&13===t&&(e=13):e=t,10===e&&(e=13),32<=e||13===e?e:0}function Xt(){return!0}function en(){return!1}function tn(e){function t(t,n,r,i,o){for(var s in this._reactName=t,this._targetInst=r,this.type=n,this.nativeEvent=i,this.target=o,this.currentTarget=null,e)e.hasOwnProperty(s)&&(t=e[s],this[s]=t?t(i):i[s]);return this.isDefaultPrevented=(null!=i.defaultPrevented?i.defaultPrevented:!1===i.returnValue)?Xt:en,this.isPropagationStopped=en,this}return M(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var e=this.nativeEvent;e&&(e.preventDefault?e.preventDefault():"unknown"!=typeof e.returnValue&&(e.returnValue=!1),this.isDefaultPrevented=Xt)},stopPropagation:function(){var e=this.nativeEvent;e&&(e.stopPropagation?e.stopPropagation():"unknown"!=typeof e.cancelBubble&&(e.cancelBubble=!0),this.isPropagationStopped=Xt)},persist:function(){},isPersistent:Xt}),t}var nn,rn,on,sn={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},an=tn(sn),ln=M({},sn,{view:0,detail:0}),cn=tn(ln),un=M({},ln,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:En,button:0,buttons:0,relatedTarget:function(e){return void 0===e.relatedTarget?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==on&&(on&&"mousemove"===e.type?(nn=e.screenX-on.screenX,rn=e.screenY-on.screenY):rn=nn=0,on=e),nn)},movementY:function(e){return"movementY"in e?e.movementY:rn}}),dn=tn(un),hn=tn(M({},un,{dataTransfer:0})),pn=tn(M({},ln,{relatedTarget:0})),fn=tn(M({},sn,{animationName:0,elapsedTime:0,pseudoElement:0})),mn=M({},sn,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),vn=tn(mn),gn=tn(M({},sn,{data:0})),yn={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},bn={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},_n={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function wn(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):!!(e=_n[e])&&!!t[e]}function En(){return wn}var Sn=M({},ln,{key:function(e){if(e.key){var t=yn[e.key]||e.key;if("Unidentified"!==t)return t}return"keypress"===e.type?13===(e=Zt(e))?"Enter":String.fromCharCode(e):"keydown"===e.type||"keyup"===e.type?bn[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:En,charCode:function(e){return"keypress"===e.type?Zt(e):0},keyCode:function(e){return"keydown"===e.type||"keyup"===e.type?e.keyCode:0},which:function(e){return"keypress"===e.type?Zt(e):"keydown"===e.type||"keyup"===e.type?e.keyCode:0}}),Cn=tn(Sn),kn=tn(M({},un,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0})),Tn=tn(M({},ln,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:En})),In=tn(M({},sn,{propertyName:0,elapsedTime:0,pseudoElement:0})),Rn=M({},un,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),xn=tn(Rn),Ln=[9,13,27,32],Pn=a&&"CompositionEvent"in window,On=null;a&&"documentMode"in document&&(On=document.documentMode);var An=a&&"TextEvent"in window&&!On,Mn=a&&(!Pn||On&&8<On&&11>=On),Nn=" ",Dn=!1;function jn(e,t){switch(e){case"keyup":return-1!==Ln.indexOf(t.keyCode);case"keydown":return 229!==t.keyCode;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Un(e){return"object"==typeof(e=e.detail)&&"data"in e?e.data:null}var Fn=!1;var Hn={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Bn(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return"input"===t?!!Hn[e.type]:"textarea"===t}function $n(e,t,n,r){Se(r),0<(t=Vr(t,"onChange")).length&&(n=new an("onChange","change",null,n,r),e.push({event:n,listeners:t}))}var Vn=null,qn=null;function Kn(e){Nr(e,0)}function Gn(e){if(q(gi(e)))return e}function Wn(e,t){if("change"===e)return t}var zn=!1;if(a){var Jn;if(a){var Yn="oninput"in document;if(!Yn){var Qn=document.createElement("div");Qn.setAttribute("oninput","return;"),Yn="function"==typeof Qn.oninput}Jn=Yn}else Jn=!1;zn=Jn&&(!document.documentMode||9<document.documentMode)}function Zn(){Vn&&(Vn.detachEvent("onpropertychange",Xn),qn=Vn=null)}function Xn(e){if("value"===e.propertyName&&Gn(qn)){var t=[];$n(t,qn,e,ye(e)),Re(Kn,t)}}function er(e,t,n){"focusin"===e?(Zn(),qn=n,(Vn=t).attachEvent("onpropertychange",Xn)):"focusout"===e&&Zn()}function tr(e){if("selectionchange"===e||"keyup"===e||"keydown"===e)return Gn(qn)}function nr(e,t){if("click"===e)return Gn(t)}function rr(e,t){if("input"===e||"change"===e)return Gn(t)}var ir="function"==typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e==1/t)||e!=e&&t!=t};function or(e,t){if(ir(e,t))return!0;if("object"!=typeof e||null===e||"object"!=typeof t||null===t)return!1;var n=Object.keys(e),r=Object.keys(t);if(n.length!==r.length)return!1;for(r=0;r<n.length;r++){var i=n[r];if(!l.call(t,i)||!ir(e[i],t[i]))return!1}return!0}function sr(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function ar(e,t){var n,r=sr(e);for(e=0;r;){if(3===r.nodeType){if(n=e+r.textContent.length,e<=t&&n>=t)return{node:r,offset:t-e};e=n}e:{for(;r;){if(r.nextSibling){r=r.nextSibling;break e}r=r.parentNode}r=void 0}r=sr(r)}}function lr(e,t){return!(!e||!t)&&(e===t||(!e||3!==e.nodeType)&&(t&&3===t.nodeType?lr(e,t.parentNode):"contains"in e?e.contains(t):!!e.compareDocumentPosition&&!!(16&e.compareDocumentPosition(t))))}function cr(){for(var e=window,t=K();t instanceof e.HTMLIFrameElement;){try{var n="string"==typeof t.contentWindow.location.href}catch{n=!1}if(!n)break;t=K((e=t.contentWindow).document)}return t}function ur(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&("input"===t&&("text"===e.type||"search"===e.type||"tel"===e.type||"url"===e.type||"password"===e.type)||"textarea"===t||"true"===e.contentEditable)}function dr(e){var t=cr(),n=e.focusedElem,r=e.selectionRange;if(t!==n&&n&&n.ownerDocument&&lr(n.ownerDocument.documentElement,n)){if(null!==r&&ur(n))if(t=r.start,void 0===(e=r.end)&&(e=t),"selectionStart"in n)n.selectionStart=t,n.selectionEnd=Math.min(e,n.value.length);else if((e=(t=n.ownerDocument||document)&&t.defaultView||window).getSelection){e=e.getSelection();var i=n.textContent.length,o=Math.min(r.start,i);r=void 0===r.end?o:Math.min(r.end,i),!e.extend&&o>r&&(i=r,r=o,o=i),i=ar(n,o);var s=ar(n,r);i&&s&&(1!==e.rangeCount||e.anchorNode!==i.node||e.anchorOffset!==i.offset||e.focusNode!==s.node||e.focusOffset!==s.offset)&&((t=t.createRange()).setStart(i.node,i.offset),e.removeAllRanges(),o>r?(e.addRange(t),e.extend(s.node,s.offset)):(t.setEnd(s.node,s.offset),e.addRange(t)))}for(t=[],e=n;e=e.parentNode;)1===e.nodeType&&t.push({element:e,left:e.scrollLeft,top:e.scrollTop});for("function"==typeof n.focus&&n.focus(),n=0;n<t.length;n++)(e=t[n]).element.scrollLeft=e.left,e.element.scrollTop=e.top}}var hr=a&&"documentMode"in document&&11>=document.documentMode,pr=null,fr=null,mr=null,vr=!1;function gr(e,t,n){var r=n.window===n?n.document:9===n.nodeType?n:n.ownerDocument;vr||null==pr||pr!==K(r)||("selectionStart"in(r=pr)&&ur(r)?r={start:r.selectionStart,end:r.selectionEnd}:r={anchorNode:(r=(r.ownerDocument&&r.ownerDocument.defaultView||window).getSelection()).anchorNode,anchorOffset:r.anchorOffset,focusNode:r.focusNode,focusOffset:r.focusOffset},mr&&or(mr,r)||(mr=r,0<(r=Vr(fr,"onSelect")).length&&(t=new an("onSelect","select",null,t,n),e.push({event:t,listeners:r}),t.target=pr)))}function yr(e,t){var n={};return n[e.toLowerCase()]=t.toLowerCase(),n["Webkit"+e]="webkit"+t,n["Moz"+e]="moz"+t,n}var br={animationend:yr("Animation","AnimationEnd"),animationiteration:yr("Animation","AnimationIteration"),animationstart:yr("Animation","AnimationStart"),transitionend:yr("Transition","TransitionEnd")},_r={},wr={};function Er(e){if(_r[e])return _r[e];if(!br[e])return e;var t,n=br[e];for(t in n)if(n.hasOwnProperty(t)&&t in wr)return _r[e]=n[t];return e}a&&(wr=document.createElement("div").style,"AnimationEvent"in window||(delete br.animationend.animation,delete br.animationiteration.animation,delete br.animationstart.animation),"TransitionEvent"in window||delete br.transitionend.transition);var Sr=Er("animationend"),Cr=Er("animationiteration"),kr=Er("animationstart"),Tr=Er("transitionend"),Ir=new Map,Rr="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function xr(e,t){Ir.set(e,t),o(t,[e])}for(var Lr=0;Lr<Rr.length;Lr++){var Pr=Rr[Lr];xr(Pr.toLowerCase(),"on"+(Pr[0].toUpperCase()+Pr.slice(1)))}xr(Sr,"onAnimationEnd"),xr(Cr,"onAnimationIteration"),xr(kr,"onAnimationStart"),xr("dblclick","onDoubleClick"),xr("focusin","onFocus"),xr("focusout","onBlur"),xr(Tr,"onTransitionEnd"),s("onMouseEnter",["mouseout","mouseover"]),s("onMouseLeave",["mouseout","mouseover"]),s("onPointerEnter",["pointerout","pointerover"]),s("onPointerLeave",["pointerout","pointerover"]),o("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),o("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),o("onBeforeInput",["compositionend","keypress","textInput","paste"]),o("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),o("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),o("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Or="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Ar=new Set("cancel close invalid load scroll toggle".split(" ").concat(Or));function Mr(e,t,r){var i=e.type||"unknown-event";e.currentTarget=r,function(e,t,r,i,o,s,a,l,c){if(Ue.apply(this,arguments),Ae){if(!Ae)throw Error(n(198));var u=Me;Ae=!1,Me=null,Ne||(Ne=!0,De=u)}}(i,t,void 0,e),e.currentTarget=null}function Nr(e,t){t=!!(4&t);for(var n=0;n<e.length;n++){var r=e[n],i=r.event;r=r.listeners;e:{var o=void 0;if(t)for(var s=r.length-1;0<=s;s--){var a=r[s],l=a.instance,c=a.currentTarget;if(a=a.listener,l!==o&&i.isPropagationStopped())break e;Mr(i,a,c),o=l}else for(s=0;s<r.length;s++){if(l=(a=r[s]).instance,c=a.currentTarget,a=a.listener,l!==o&&i.isPropagationStopped())break e;Mr(i,a,c),o=l}}}if(Ne)throw e=De,Ne=!1,De=null,e}function Dr(e,t){var n=t[hi];void 0===n&&(n=t[hi]=new Set);var r=e+"__bubble";n.has(r)||(Hr(t,e,2,!1),n.add(r))}function jr(e,t,n){var r=0;t&&(r|=4),Hr(n,e,r,t)}var Ur="_reactListening"+Math.random().toString(36).slice(2);function Fr(e){if(!e[Ur]){e[Ur]=!0,r.forEach((function(t){"selectionchange"!==t&&(Ar.has(t)||jr(t,!1,e),jr(t,!0,e))}));var t=9===e.nodeType?e:e.ownerDocument;null===t||t[Ur]||(t[Ur]=!0,jr("selectionchange",!1,t))}}function Hr(e,t,n,r){switch(Wt(t)){case 1:var i=$t;break;case 4:i=Vt;break;default:i=qt}n=i.bind(null,t,n,e),i=void 0,!Le||"touchstart"!==t&&"touchmove"!==t&&"wheel"!==t||(i=!0),r?void 0!==i?e.addEventListener(t,n,{capture:!0,passive:i}):e.addEventListener(t,n,!0):void 0!==i?e.addEventListener(t,n,{passive:i}):e.addEventListener(t,n,!1)}function Br(e,t,n,r,i){var o=r;if(!(1&t||2&t||null===r))e:for(;;){if(null===r)return;var s=r.tag;if(3===s||4===s){var a=r.stateNode.containerInfo;if(a===i||8===a.nodeType&&a.parentNode===i)break;if(4===s)for(s=r.return;null!==s;){var l=s.tag;if((3===l||4===l)&&((l=s.stateNode.containerInfo)===i||8===l.nodeType&&l.parentNode===i))return;s=s.return}for(;null!==a;){if(null===(s=mi(a)))return;if(5===(l=s.tag)||6===l){r=o=s;continue e}a=a.parentNode}}r=r.return}Re((function(){var r=o,i=ye(n),s=[];e:{var a=Ir.get(e);if(void 0!==a){var l=an,c=e;switch(e){case"keypress":if(0===Zt(n))break e;case"keydown":case"keyup":l=Cn;break;case"focusin":c="focus",l=pn;break;case"focusout":c="blur",l=pn;break;case"beforeblur":case"afterblur":l=pn;break;case"click":if(2===n.button)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":l=dn;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":l=hn;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":l=Tn;break;case Sr:case Cr:case kr:l=fn;break;case Tr:l=In;break;case"scroll":l=cn;break;case"wheel":l=xn;break;case"copy":case"cut":case"paste":l=vn;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":l=kn}var u=!!(4&t),d=!u&&"scroll"===e,h=u?null!==a?a+"Capture":null:a;u=[];for(var p,f=r;null!==f;){var m=(p=f).stateNode;if(5===p.tag&&null!==m&&(p=m,null!==h&&(null!=(m=xe(f,h))&&u.push($r(f,m,p)))),d)break;f=f.return}0<u.length&&(a=new l(a,c,null,n,i),s.push({event:a,listeners:u}))}}if(!(7&t)){if(l="mouseout"===e||"pointerout"===e,(!(a="mouseover"===e||"pointerover"===e)||n===ge||!(c=n.relatedTarget||n.fromElement)||!mi(c)&&!c[di])&&(l||a)&&(a=i.window===i?i:(a=i.ownerDocument)?a.defaultView||a.parentWindow:window,l?(l=r,null!==(c=(c=n.relatedTarget||n.toElement)?mi(c):null)&&(c!==(d=Fe(c))||5!==c.tag&&6!==c.tag)&&(c=null)):(l=null,c=r),l!==c)){if(u=dn,m="onMouseLeave",h="onMouseEnter",f="mouse",("pointerout"===e||"pointerover"===e)&&(u=kn,m="onPointerLeave",h="onPointerEnter",f="pointer"),d=null==l?a:gi(l),p=null==c?a:gi(c),(a=new u(m,f+"leave",l,n,i)).target=d,a.relatedTarget=p,m=null,mi(i)===r&&((u=new u(h,f+"enter",c,n,i)).target=p,u.relatedTarget=d,m=u),d=m,l&&c)e:{for(h=c,f=0,p=u=l;p;p=qr(p))f++;for(p=0,m=h;m;m=qr(m))p++;for(;0<f-p;)u=qr(u),f--;for(;0<p-f;)h=qr(h),p--;for(;f--;){if(u===h||null!==h&&u===h.alternate)break e;u=qr(u),h=qr(h)}u=null}else u=null;null!==l&&Kr(s,a,l,u,!1),null!==c&&null!==d&&Kr(s,d,c,u,!0)}if("select"===(l=(a=r?gi(r):window).nodeName&&a.nodeName.toLowerCase())||"input"===l&&"file"===a.type)var v=Wn;else if(Bn(a))if(zn)v=rr;else{v=tr;var g=er}else(l=a.nodeName)&&"input"===l.toLowerCase()&&("checkbox"===a.type||"radio"===a.type)&&(v=nr);switch(v&&(v=v(e,r))?$n(s,v,n,i):(g&&g(e,a,r),"focusout"===e&&(g=a._wrapperState)&&g.controlled&&"number"===a.type&&Q(a,"number",a.value)),g=r?gi(r):window,e){case"focusin":(Bn(g)||"true"===g.contentEditable)&&(pr=g,fr=r,mr=null);break;case"focusout":mr=fr=pr=null;break;case"mousedown":vr=!0;break;case"contextmenu":case"mouseup":case"dragend":vr=!1,gr(s,n,i);break;case"selectionchange":if(hr)break;case"keydown":case"keyup":gr(s,n,i)}var y;if(Pn)e:{switch(e){case"compositionstart":var b="onCompositionStart";break e;case"compositionend":b="onCompositionEnd";break e;case"compositionupdate":b="onCompositionUpdate";break e}b=void 0}else Fn?jn(e,n)&&(b="onCompositionEnd"):"keydown"===e&&229===n.keyCode&&(b="onCompositionStart");b&&(Mn&&"ko"!==n.locale&&(Fn||"onCompositionStart"!==b?"onCompositionEnd"===b&&Fn&&(y=Qt()):(Jt="value"in(zt=i)?zt.value:zt.textContent,Fn=!0)),0<(g=Vr(r,b)).length&&(b=new gn(b,e,null,n,i),s.push({event:b,listeners:g}),y?b.data=y:null!==(y=Un(n))&&(b.data=y))),(y=An?function(e,t){switch(e){case"compositionend":return Un(t);case"keypress":return 32!==t.which?null:(Dn=!0,Nn);case"textInput":return(e=t.data)===Nn&&Dn?null:e;default:return null}}(e,n):function(e,t){if(Fn)return"compositionend"===e||!Pn&&jn(e,t)?(e=Qt(),Yt=Jt=zt=null,Fn=!1,e):null;switch(e){case"paste":default:return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return Mn&&"ko"!==t.locale?null:t.data}}(e,n))&&(0<(r=Vr(r,"onBeforeInput")).length&&(i=new gn("onBeforeInput","beforeinput",null,n,i),s.push({event:i,listeners:r}),i.data=y))}Nr(s,t)}))}function $r(e,t,n){return{instance:e,listener:t,currentTarget:n}}function Vr(e,t){for(var n=t+"Capture",r=[];null!==e;){var i=e,o=i.stateNode;5===i.tag&&null!==o&&(i=o,null!=(o=xe(e,n))&&r.unshift($r(e,o,i)),null!=(o=xe(e,t))&&r.push($r(e,o,i))),e=e.return}return r}function qr(e){if(null===e)return null;do{e=e.return}while(e&&5!==e.tag);return e||null}function Kr(e,t,n,r,i){for(var o=t._reactName,s=[];null!==n&&n!==r;){var a=n,l=a.alternate,c=a.stateNode;if(null!==l&&l===r)break;5===a.tag&&null!==c&&(a=c,i?null!=(l=xe(n,o))&&s.unshift($r(n,l,a)):i||null!=(l=xe(n,o))&&s.push($r(n,l,a))),n=n.return}0!==s.length&&e.push({event:t,listeners:s})}var Gr=/\r\n?/g,Wr=/\u0000|\uFFFD/g;function zr(e){return("string"==typeof e?e:""+e).replace(Gr,"\n").replace(Wr,"")}function Jr(e,t,r){if(t=zr(t),zr(e)!==t&&r)throw Error(n(425))}function Yr(){}var Qr=null,Zr=null;function Xr(e,t){return"textarea"===e||"noscript"===e||"string"==typeof t.children||"number"==typeof t.children||"object"==typeof t.dangerouslySetInnerHTML&&null!==t.dangerouslySetInnerHTML&&null!=t.dangerouslySetInnerHTML.__html}var ei="function"==typeof setTimeout?setTimeout:void 0,ti="function"==typeof clearTimeout?clearTimeout:void 0,ni="function"==typeof Promise?Promise:void 0,ri="function"==typeof queueMicrotask?queueMicrotask:typeof ni<"u"?function(e){return ni.resolve(null).then(e).catch(ii)}:ei;function ii(e){setTimeout((function(){throw e}))}function oi(e,t){var n=t,r=0;do{var i=n.nextSibling;if(e.removeChild(n),i&&8===i.nodeType)if("/$"===(n=i.data)){if(0===r)return e.removeChild(i),void Ft(t);r--}else"$"!==n&&"$?"!==n&&"$!"!==n||r++;n=i}while(n);Ft(t)}function si(e){for(;null!=e;e=e.nextSibling){var t=e.nodeType;if(1===t||3===t)break;if(8===t){if("$"===(t=e.data)||"$!"===t||"$?"===t)break;if("/$"===t)return null}}return e}function ai(e){e=e.previousSibling;for(var t=0;e;){if(8===e.nodeType){var n=e.data;if("$"===n||"$!"===n||"$?"===n){if(0===t)return e;t--}else"/$"===n&&t++}e=e.previousSibling}return null}var li=Math.random().toString(36).slice(2),ci="__reactFiber$"+li,ui="__reactProps$"+li,di="__reactContainer$"+li,hi="__reactEvents$"+li,pi="__reactListeners$"+li,fi="__reactHandles$"+li;function mi(e){var t=e[ci];if(t)return t;for(var n=e.parentNode;n;){if(t=n[di]||n[ci]){if(n=t.alternate,null!==t.child||null!==n&&null!==n.child)for(e=ai(e);null!==e;){if(n=e[ci])return n;e=ai(e)}return t}n=(e=n).parentNode}return null}function vi(e){return!(e=e[ci]||e[di])||5!==e.tag&&6!==e.tag&&13!==e.tag&&3!==e.tag?null:e}function gi(e){if(5===e.tag||6===e.tag)return e.stateNode;throw Error(n(33))}function yi(e){return e[ui]||null}var bi=[],_i=-1;function wi(e){return{current:e}}function Ei(e){0>_i||(e.current=bi[_i],bi[_i]=null,_i--)}function Si(e,t){_i++,bi[_i]=e.current,e.current=t}var Ci={},ki=wi(Ci),Ti=wi(!1),Ii=Ci;function Ri(e,t){var n=e.type.contextTypes;if(!n)return Ci;var r=e.stateNode;if(r&&r.__reactInternalMemoizedUnmaskedChildContext===t)return r.__reactInternalMemoizedMaskedChildContext;var i,o={};for(i in n)o[i]=t[i];return r&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=t,e.__reactInternalMemoizedMaskedChildContext=o),o}function xi(e){return null!=(e=e.childContextTypes)}function Li(){Ei(Ti),Ei(ki)}function Pi(e,t,r){if(ki.current!==Ci)throw Error(n(168));Si(ki,t),Si(Ti,r)}function Oi(e,t,r){var i=e.stateNode;if(t=t.childContextTypes,"function"!=typeof i.getChildContext)return r;for(var o in i=i.getChildContext())if(!(o in t))throw Error(n(108,H(e)||"Unknown",o));return M({},r,i)}function Ai(e){return e=(e=e.stateNode)&&e.__reactInternalMemoizedMergedChildContext||Ci,Ii=ki.current,Si(ki,e),Si(Ti,Ti.current),!0}function Mi(e,t,r){var i=e.stateNode;if(!i)throw Error(n(169));r?(e=Oi(e,t,Ii),i.__reactInternalMemoizedMergedChildContext=e,Ei(Ti),Ei(ki),Si(ki,e)):Ei(Ti),Si(Ti,r)}var Ni=null,ji=!1,Ui=!1;function Fi(e){null===Ni?Ni=[e]:Ni.push(e)}function Hi(){if(!Ui&&null!==Ni){Ui=!0;var e=0,t=vt;try{var n=Ni;for(vt=1;e<n.length;e++){var r=n[e];do{r=r(!0)}while(null!==r)}Ni=null,ji=!1}catch(t){throw null!==Ni&&(Ni=Ni.slice(e+1)),qe(Ye,Hi),t}finally{vt=t,Ui=!1}}return null}var Bi=[],$i=0,Vi=null,qi=0,Ki=[],Gi=0,Wi=null,zi=1,Ji="";function Yi(e,t){Bi[$i++]=qi,Bi[$i++]=Vi,Vi=e,qi=t}function Qi(e,t,n){Ki[Gi++]=zi,Ki[Gi++]=Ji,Ki[Gi++]=Wi,Wi=e;var r=zi;e=Ji;var i=32-rt(r)-1;r&=~(1<<i),n+=1;var o=32-rt(t)+i;if(30<o){var s=i-i%5;o=(r&(1<<s)-1).toString(32),r>>=s,i-=s,zi=1<<32-rt(t)+i|n<<i|r,Ji=o+e}else zi=1<<o|n<<i|r,Ji=e}function Zi(e){null!==e.return&&(Yi(e,1),Qi(e,1,0))}function Xi(e){for(;e===Vi;)Vi=Bi[--$i],Bi[$i]=null,qi=Bi[--$i],Bi[$i]=null;for(;e===Wi;)Wi=Ki[--Gi],Ki[Gi]=null,Ji=Ki[--Gi],Ki[Gi]=null,zi=Ki[--Gi],Ki[Gi]=null}var eo=null,to=null,no=!1,ro=null;function io(e,t){var n=xc(5,null,null,0);n.elementType="DELETED",n.stateNode=t,n.return=e,null===(t=e.deletions)?(e.deletions=[n],e.flags|=16):t.push(n)}function oo(e,t){switch(e.tag){case 5:var n=e.type;return null!==(t=1!==t.nodeType||n.toLowerCase()!==t.nodeName.toLowerCase()?null:t)&&(e.stateNode=t,eo=e,to=si(t.firstChild),!0);case 6:return null!==(t=""===e.pendingProps||3!==t.nodeType?null:t)&&(e.stateNode=t,eo=e,to=null,!0);case 13:return null!==(t=8!==t.nodeType?null:t)&&(n=null!==Wi?{id:zi,overflow:Ji}:null,e.memoizedState={dehydrated:t,treeContext:n,retryLane:1073741824},(n=xc(18,null,null,0)).stateNode=t,n.return=e,e.child=n,eo=e,to=null,!0);default:return!1}}function so(e){return!(!(1&e.mode)||128&e.flags)}function ao(e){if(no){var t=to;if(t){var r=t;if(!oo(e,t)){if(so(e))throw Error(n(418));t=si(r.nextSibling);var i=eo;t&&oo(e,t)?io(i,r):(e.flags=-4097&e.flags|2,no=!1,eo=e)}}else{if(so(e))throw Error(n(418));e.flags=-4097&e.flags|2,no=!1,eo=e}}}function lo(e){for(e=e.return;null!==e&&5!==e.tag&&3!==e.tag&&13!==e.tag;)e=e.return;eo=e}function co(e){if(e!==eo)return!1;if(!no)return lo(e),no=!0,!1;var t;if((t=3!==e.tag)&&!(t=5!==e.tag)&&(t="head"!==(t=e.type)&&"body"!==t&&!Xr(e.type,e.memoizedProps)),t&&(t=to)){if(so(e))throw uo(),Error(n(418));for(;t;)io(e,t),t=si(t.nextSibling)}if(lo(e),13===e.tag){if(!(e=null!==(e=e.memoizedState)?e.dehydrated:null))throw Error(n(317));e:{for(e=e.nextSibling,t=0;e;){if(8===e.nodeType){var r=e.data;if("/$"===r){if(0===t){to=si(e.nextSibling);break e}t--}else"$"!==r&&"$!"!==r&&"$?"!==r||t++}e=e.nextSibling}to=null}}else to=eo?si(e.stateNode.nextSibling):null;return!0}function uo(){for(var e=to;e;)e=si(e.nextSibling)}function ho(){to=eo=null,no=!1}function po(e){null===ro?ro=[e]:ro.push(e)}var fo=g.ReactCurrentBatchConfig;function mo(e,t,r){if(null!==(e=r.ref)&&"function"!=typeof e&&"object"!=typeof e){if(r._owner){if(r=r._owner){if(1!==r.tag)throw Error(n(309));var i=r.stateNode}if(!i)throw Error(n(147,e));var o=i,s=""+e;return null!==t&&null!==t.ref&&"function"==typeof t.ref&&t.ref._stringRef===s?t.ref:((t=function(e){var t=o.refs;null===e?delete t[s]:t[s]=e})._stringRef=s,t)}if("string"!=typeof e)throw Error(n(284));if(!r._owner)throw Error(n(290,e))}return e}function vo(e,t){throw e=Object.prototype.toString.call(t),Error(n(31,"[object Object]"===e?"object with keys {"+Object.keys(t).join(", ")+"}":e))}function go(e){return(0,e._init)(e._payload)}function yo(e){function t(t,n){if(e){var r=t.deletions;null===r?(t.deletions=[n],t.flags|=16):r.push(n)}}function r(n,r){if(!e)return null;for(;null!==r;)t(n,r),r=r.sibling;return null}function i(e,t){for(e=new Map;null!==t;)null!==t.key?e.set(t.key,t):e.set(t.index,t),t=t.sibling;return e}function o(e,t){return(e=Pc(e,t)).index=0,e.sibling=null,e}function s(t,n,r){return t.index=r,e?null!==(r=t.alternate)?(r=r.index)<n?(t.flags|=2,n):r:(t.flags|=2,n):(t.flags|=1048576,n)}function a(t){return e&&null===t.alternate&&(t.flags|=2),t}function l(e,t,n,r){return null===t||6!==t.tag?((t=Nc(n,e.mode,r)).return=e,t):((t=o(t,n)).return=e,t)}function c(e,t,n,r){var i=n.type;return i===_?d(e,t,n.props.children,r,n.key):null!==t&&(t.elementType===i||"object"==typeof i&&null!==i&&i.$$typeof===x&&go(i)===t.type)?((r=o(t,n.props)).ref=mo(e,t,n),r.return=e,r):((r=Oc(n.type,n.key,n.props,null,e.mode,r)).ref=mo(e,t,n),r.return=e,r)}function u(e,t,n,r){return null===t||4!==t.tag||t.stateNode.containerInfo!==n.containerInfo||t.stateNode.implementation!==n.implementation?((t=Dc(n,e.mode,r)).return=e,t):((t=o(t,n.children||[])).return=e,t)}function d(e,t,n,r,i){return null===t||7!==t.tag?((t=Ac(n,e.mode,r,i)).return=e,t):((t=o(t,n)).return=e,t)}function h(e,t,n){if("string"==typeof t&&""!==t||"number"==typeof t)return(t=Nc(""+t,e.mode,n)).return=e,t;if("object"==typeof t&&null!==t){switch(t.$$typeof){case y:return(n=Oc(t.type,t.key,t.props,null,e.mode,n)).ref=mo(e,null,t),n.return=e,n;case b:return(t=Dc(t,e.mode,n)).return=e,t;case x:return h(e,(0,t._init)(t._payload),n)}if(Z(t)||O(t))return(t=Ac(t,e.mode,n,null)).return=e,t;vo(e,t)}return null}function p(e,t,n,r){var i=null!==t?t.key:null;if("string"==typeof n&&""!==n||"number"==typeof n)return null!==i?null:l(e,t,""+n,r);if("object"==typeof n&&null!==n){switch(n.$$typeof){case y:return n.key===i?c(e,t,n,r):null;case b:return n.key===i?u(e,t,n,r):null;case x:return p(e,t,(i=n._init)(n._payload),r)}if(Z(n)||O(n))return null!==i?null:d(e,t,n,r,null);vo(e,n)}return null}function f(e,t,n,r,i){if("string"==typeof r&&""!==r||"number"==typeof r)return l(t,e=e.get(n)||null,""+r,i);if("object"==typeof r&&null!==r){switch(r.$$typeof){case y:return c(t,e=e.get(null===r.key?n:r.key)||null,r,i);case b:return u(t,e=e.get(null===r.key?n:r.key)||null,r,i);case x:return f(e,t,n,(0,r._init)(r._payload),i)}if(Z(r)||O(r))return d(t,e=e.get(n)||null,r,i,null);vo(t,r)}return null}return function l(c,u,d,m){if("object"==typeof d&&null!==d&&d.type===_&&null===d.key&&(d=d.props.children),"object"==typeof d&&null!==d){switch(d.$$typeof){case y:e:{for(var v=d.key,g=u;null!==g;){if(g.key===v){if((v=d.type)===_){if(7===g.tag){r(c,g.sibling),(u=o(g,d.props.children)).return=c,c=u;break e}}else if(g.elementType===v||"object"==typeof v&&null!==v&&v.$$typeof===x&&go(v)===g.type){r(c,g.sibling),(u=o(g,d.props)).ref=mo(c,g,d),u.return=c,c=u;break e}r(c,g);break}t(c,g),g=g.sibling}d.type===_?((u=Ac(d.props.children,c.mode,m,d.key)).return=c,c=u):((m=Oc(d.type,d.key,d.props,null,c.mode,m)).ref=mo(c,u,d),m.return=c,c=m)}return a(c);case b:e:{for(g=d.key;null!==u;){if(u.key===g){if(4===u.tag&&u.stateNode.containerInfo===d.containerInfo&&u.stateNode.implementation===d.implementation){r(c,u.sibling),(u=o(u,d.children||[])).return=c,c=u;break e}r(c,u);break}t(c,u),u=u.sibling}(u=Dc(d,c.mode,m)).return=c,c=u}return a(c);case x:return l(c,u,(g=d._init)(d._payload),m)}if(Z(d))return function(n,o,a,l){for(var c=null,u=null,d=o,m=o=0,v=null;null!==d&&m<a.length;m++){d.index>m?(v=d,d=null):v=d.sibling;var g=p(n,d,a[m],l);if(null===g){null===d&&(d=v);break}e&&d&&null===g.alternate&&t(n,d),o=s(g,o,m),null===u?c=g:u.sibling=g,u=g,d=v}if(m===a.length)return r(n,d),no&&Yi(n,m),c;if(null===d){for(;m<a.length;m++)null!==(d=h(n,a[m],l))&&(o=s(d,o,m),null===u?c=d:u.sibling=d,u=d);return no&&Yi(n,m),c}for(d=i(n,d);m<a.length;m++)null!==(v=f(d,n,m,a[m],l))&&(e&&null!==v.alternate&&d.delete(null===v.key?m:v.key),o=s(v,o,m),null===u?c=v:u.sibling=v,u=v);return e&&d.forEach((function(e){return t(n,e)})),no&&Yi(n,m),c}(c,u,d,m);if(O(d))return function(o,a,l,c){var u=O(l);if("function"!=typeof u)throw Error(n(150));if(null==(l=u.call(l)))throw Error(n(151));for(var d=u=null,m=a,v=a=0,g=null,y=l.next();null!==m&&!y.done;v++,y=l.next()){m.index>v?(g=m,m=null):g=m.sibling;var b=p(o,m,y.value,c);if(null===b){null===m&&(m=g);break}e&&m&&null===b.alternate&&t(o,m),a=s(b,a,v),null===d?u=b:d.sibling=b,d=b,m=g}if(y.done)return r(o,m),no&&Yi(o,v),u;if(null===m){for(;!y.done;v++,y=l.next())null!==(y=h(o,y.value,c))&&(a=s(y,a,v),null===d?u=y:d.sibling=y,d=y);return no&&Yi(o,v),u}for(m=i(o,m);!y.done;v++,y=l.next())null!==(y=f(m,o,v,y.value,c))&&(e&&null!==y.alternate&&m.delete(null===y.key?v:y.key),a=s(y,a,v),null===d?u=y:d.sibling=y,d=y);return e&&m.forEach((function(e){return t(o,e)})),no&&Yi(o,v),u}(c,u,d,m);vo(c,d)}return"string"==typeof d&&""!==d||"number"==typeof d?(d=""+d,null!==u&&6===u.tag?(r(c,u.sibling),(u=o(u,d)).return=c,c=u):(r(c,u),(u=Nc(d,c.mode,m)).return=c,c=u),a(c)):r(c,u)}}var bo=yo(!0),_o=yo(!1),wo=wi(null),Eo=null,So=null,Co=null;function ko(){Co=So=Eo=null}function To(e){var t=wo.current;Ei(wo),e._currentValue=t}function Io(e,t,n){for(;null!==e;){var r=e.alternate;if((e.childLanes&t)!==t?(e.childLanes|=t,null!==r&&(r.childLanes|=t)):null!==r&&(r.childLanes&t)!==t&&(r.childLanes|=t),e===n)break;e=e.return}}function Ro(e,t){Eo=e,Co=So=null,null!==(e=e.dependencies)&&null!==e.firstContext&&(!!(e.lanes&t)&&(ga=!0),e.firstContext=null)}function xo(e){var t=e._currentValue;if(Co!==e)if(e={context:e,memoizedValue:t,next:null},null===So){if(null===Eo)throw Error(n(308));So=e,Eo.dependencies={lanes:0,firstContext:e}}else So=So.next=e;return t}var Lo=null;function Po(e){null===Lo?Lo=[e]:Lo.push(e)}function Oo(e,t,n,r){var i=t.interleaved;return null===i?(n.next=n,Po(t)):(n.next=i.next,i.next=n),t.interleaved=n,Ao(e,r)}function Ao(e,t){e.lanes|=t;var n=e.alternate;for(null!==n&&(n.lanes|=t),n=e,e=e.return;null!==e;)e.childLanes|=t,null!==(n=e.alternate)&&(n.childLanes|=t),n=e,e=e.return;return 3===n.tag?n.stateNode:null}var Mo=!1;function No(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function Do(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,effects:e.effects})}function jo(e,t){return{eventTime:e,lane:t,tag:0,payload:null,callback:null,next:null}}function Uo(e,t,n){var r=e.updateQueue;if(null===r)return null;if(r=r.shared,2&Tl){var i=r.pending;return null===i?t.next=t:(t.next=i.next,i.next=t),r.pending=t,Ao(e,n)}return null===(i=r.interleaved)?(t.next=t,Po(r)):(t.next=i.next,i.next=t),r.interleaved=t,Ao(e,n)}function Fo(e,t,n){if(null!==(t=t.updateQueue)&&(t=t.shared,4194240&n)){var r=t.lanes;n|=r&=e.pendingLanes,t.lanes=n,mt(e,n)}}function Ho(e,t){var n=e.updateQueue,r=e.alternate;if(null!==r&&n===(r=r.updateQueue)){var i=null,o=null;if(null!==(n=n.firstBaseUpdate)){do{var s={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};null===o?i=o=s:o=o.next=s,n=n.next}while(null!==n);null===o?i=o=t:o=o.next=t}else i=o=t;return n={baseState:r.baseState,firstBaseUpdate:i,lastBaseUpdate:o,shared:r.shared,effects:r.effects},void(e.updateQueue=n)}null===(e=n.lastBaseUpdate)?n.firstBaseUpdate=t:e.next=t,n.lastBaseUpdate=t}function Bo(e,t,n,r){var i=e.updateQueue;Mo=!1;var o=i.firstBaseUpdate,s=i.lastBaseUpdate,a=i.shared.pending;if(null!==a){i.shared.pending=null;var l=a,c=l.next;l.next=null,null===s?o=c:s.next=c,s=l;var u=e.alternate;null!==u&&((a=(u=u.updateQueue).lastBaseUpdate)!==s&&(null===a?u.firstBaseUpdate=c:a.next=c,u.lastBaseUpdate=l))}if(null!==o){var d=i.baseState;for(s=0,u=c=l=null,a=o;;){var h=a.lane,p=a.eventTime;if((r&h)===h){null!==u&&(u=u.next={eventTime:p,lane:0,tag:a.tag,payload:a.payload,callback:a.callback,next:null});e:{var f=e,m=a;switch(h=t,p=n,m.tag){case 1:if("function"==typeof(f=m.payload)){d=f.call(p,d,h);break e}d=f;break e;case 3:f.flags=-65537&f.flags|128;case 0:if(null==(h="function"==typeof(f=m.payload)?f.call(p,d,h):f))break e;d=M({},d,h);break e;case 2:Mo=!0}}null!==a.callback&&0!==a.lane&&(e.flags|=64,null===(h=i.effects)?i.effects=[a]:h.push(a))}else p={eventTime:p,lane:h,tag:a.tag,payload:a.payload,callback:a.callback,next:null},null===u?(c=u=p,l=d):u=u.next=p,s|=h;if(null===(a=a.next)){if(null===(a=i.shared.pending))break;a=(h=a).next,h.next=null,i.lastBaseUpdate=h,i.shared.pending=null}}if(null===u&&(l=d),i.baseState=l,i.firstBaseUpdate=c,i.lastBaseUpdate=u,null!==(t=i.shared.interleaved)){i=t;do{s|=i.lane,i=i.next}while(i!==t)}else null===o&&(i.shared.lanes=0);Ml|=s,e.lanes=s,e.memoizedState=d}}function $o(e,t,r){if(e=t.effects,t.effects=null,null!==e)for(t=0;t<e.length;t++){var i=e[t],o=i.callback;if(null!==o){if(i.callback=null,i=r,"function"!=typeof o)throw Error(n(191,o));o.call(i)}}}var Vo={},qo=wi(Vo),Ko=wi(Vo),Go=wi(Vo);function Wo(e){if(e===Vo)throw Error(n(174));return e}function zo(e,t){switch(Si(Go,t),Si(Ko,e),Si(qo,Vo),e=t.nodeType){case 9:case 11:t=(t=t.documentElement)?t.namespaceURI:oe(null,"");break;default:t=oe(t=(e=8===e?t.parentNode:t).namespaceURI||null,e=e.tagName)}Ei(qo),Si(qo,t)}function Jo(){Ei(qo),Ei(Ko),Ei(Go)}function Yo(e){Wo(Go.current);var t=Wo(qo.current),n=oe(t,e.type);t!==n&&(Si(Ko,e),Si(qo,n))}function Qo(e){Ko.current===e&&(Ei(qo),Ei(Ko))}var Zo=wi(0);function Xo(e){for(var t=e;null!==t;){if(13===t.tag){var n=t.memoizedState;if(null!==n&&(null===(n=n.dehydrated)||"$?"===n.data||"$!"===n.data))return t}else if(19===t.tag&&void 0!==t.memoizedProps.revealOrder){if(128&t.flags)return t}else if(null!==t.child){t.child.return=t,t=t.child;continue}if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}var es=[];function ts(){for(var e=0;e<es.length;e++)es[e]._workInProgressVersionPrimary=null;es.length=0}var ns=g.ReactCurrentDispatcher,rs=g.ReactCurrentBatchConfig,is=0,os=null,ss=null,as=null,ls=!1,cs=!1,us=0,ds=0;function hs(){throw Error(n(321))}function ps(e,t){if(null===t)return!1;for(var n=0;n<t.length&&n<e.length;n++)if(!ir(e[n],t[n]))return!1;return!0}function fs(e,t,r,i,o,s){if(is=s,os=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,ns.current=null===e||null===e.memoizedState?Qs:Zs,e=r(i,o),cs){s=0;do{if(cs=!1,us=0,25<=s)throw Error(n(301));s+=1,as=ss=null,t.updateQueue=null,ns.current=Xs,e=r(i,o)}while(cs)}if(ns.current=Ys,t=null!==ss&&null!==ss.next,is=0,as=ss=os=null,ls=!1,t)throw Error(n(300));return e}function ms(){var e=0!==us;return us=0,e}function vs(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return null===as?os.memoizedState=as=e:as=as.next=e,as}function gs(){if(null===ss){var e=os.alternate;e=null!==e?e.memoizedState:null}else e=ss.next;var t=null===as?os.memoizedState:as.next;if(null!==t)as=t,ss=e;else{if(null===e)throw Error(n(310));e={memoizedState:(ss=e).memoizedState,baseState:ss.baseState,baseQueue:ss.baseQueue,queue:ss.queue,next:null},null===as?os.memoizedState=as=e:as=as.next=e}return as}function ys(e,t){return"function"==typeof t?t(e):t}function bs(e){var t=gs(),r=t.queue;if(null===r)throw Error(n(311));r.lastRenderedReducer=e;var i=ss,o=i.baseQueue,s=r.pending;if(null!==s){if(null!==o){var a=o.next;o.next=s.next,s.next=a}i.baseQueue=o=s,r.pending=null}if(null!==o){s=o.next,i=i.baseState;var l=a=null,c=null,u=s;do{var d=u.lane;if((is&d)===d)null!==c&&(c=c.next={lane:0,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null}),i=u.hasEagerState?u.eagerState:e(i,u.action);else{var h={lane:d,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null};null===c?(l=c=h,a=i):c=c.next=h,os.lanes|=d,Ml|=d}u=u.next}while(null!==u&&u!==s);null===c?a=i:c.next=l,ir(i,t.memoizedState)||(ga=!0),t.memoizedState=i,t.baseState=a,t.baseQueue=c,r.lastRenderedState=i}if(null!==(e=r.interleaved)){o=e;do{s=o.lane,os.lanes|=s,Ml|=s,o=o.next}while(o!==e)}else null===o&&(r.lanes=0);return[t.memoizedState,r.dispatch]}function _s(e){var t=gs(),r=t.queue;if(null===r)throw Error(n(311));r.lastRenderedReducer=e;var i=r.dispatch,o=r.pending,s=t.memoizedState;if(null!==o){r.pending=null;var a=o=o.next;do{s=e(s,a.action),a=a.next}while(a!==o);ir(s,t.memoizedState)||(ga=!0),t.memoizedState=s,null===t.baseQueue&&(t.baseState=s),r.lastRenderedState=s}return[s,i]}function ws(){}function Es(e,t){var r=os,i=gs(),o=t(),s=!ir(i.memoizedState,o);if(s&&(i.memoizedState=o,ga=!0),i=i.queue,Ms(ks.bind(null,r,i,e),[e]),i.getSnapshot!==t||s||null!==as&&1&as.memoizedState.tag){if(r.flags|=2048,xs(9,Cs.bind(null,r,i,o,t),void 0,null),null===Il)throw Error(n(349));30&is||Ss(r,t,o)}return o}function Ss(e,t,n){e.flags|=16384,e={getSnapshot:t,value:n},null===(t=os.updateQueue)?(t={lastEffect:null,stores:null},os.updateQueue=t,t.stores=[e]):null===(n=t.stores)?t.stores=[e]:n.push(e)}function Cs(e,t,n,r){t.value=n,t.getSnapshot=r,Ts(t)&&Is(e)}function ks(e,t,n){return n((function(){Ts(t)&&Is(e)}))}function Ts(e){var t=e.getSnapshot;e=e.value;try{var n=t();return!ir(e,n)}catch{return!0}}function Is(e){var t=Ao(e,1);null!==t&&ec(t,e,1,-1)}function Rs(e){var t=vs();return"function"==typeof e&&(e=e()),t.memoizedState=t.baseState=e,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:ys,lastRenderedState:e},t.queue=e,e=e.dispatch=Gs.bind(null,os,e),[t.memoizedState,e]}function xs(e,t,n,r){return e={tag:e,create:t,destroy:n,deps:r,next:null},null===(t=os.updateQueue)?(t={lastEffect:null,stores:null},os.updateQueue=t,t.lastEffect=e.next=e):null===(n=t.lastEffect)?t.lastEffect=e.next=e:(r=n.next,n.next=e,e.next=r,t.lastEffect=e),e}function Ls(){return gs().memoizedState}function Ps(e,t,n,r){var i=vs();os.flags|=e,i.memoizedState=xs(1|t,n,void 0,void 0===r?null:r)}function Os(e,t,n,r){var i=gs();r=void 0===r?null:r;var o=void 0;if(null!==ss){var s=ss.memoizedState;if(o=s.destroy,null!==r&&ps(r,s.deps))return void(i.memoizedState=xs(t,n,o,r))}os.flags|=e,i.memoizedState=xs(1|t,n,o,r)}function As(e,t){return Ps(8390656,8,e,t)}function Ms(e,t){return Os(2048,8,e,t)}function Ns(e,t){return Os(4,2,e,t)}function Ds(e,t){return Os(4,4,e,t)}function js(e,t){return"function"==typeof t?(e=e(),t(e),function(){t(null)}):null!=t?(e=e(),t.current=e,function(){t.current=null}):void 0}function Us(e,t,n){return n=null!=n?n.concat([e]):null,Os(4,4,js.bind(null,t,e),n)}function Fs(){}function Hs(e,t){var n=gs();t=void 0===t?null:t;var r=n.memoizedState;return null!==r&&null!==t&&ps(t,r[1])?r[0]:(n.memoizedState=[e,t],e)}function Bs(e,t){var n=gs();t=void 0===t?null:t;var r=n.memoizedState;return null!==r&&null!==t&&ps(t,r[1])?r[0]:(e=e(),n.memoizedState=[e,t],e)}function $s(e,t,n){return 21&is?(ir(n,t)||(n=ht(),os.lanes|=n,Ml|=n,e.baseState=!0),t):(e.baseState&&(e.baseState=!1,ga=!0),e.memoizedState=n)}function Vs(e,t){var n=vt;vt=0!==n&&4>n?n:4,e(!0);var r=rs.transition;rs.transition={};try{e(!1),t()}finally{vt=n,rs.transition=r}}function qs(){return gs().memoizedState}function Ks(e,t,n){var r=Xl(e);if(n={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null},Ws(e))zs(t,n);else if(null!==(n=Oo(e,t,n,r))){ec(n,e,r,Zl()),Js(n,t,r)}}function Gs(e,t,n){var r=Xl(e),i={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null};if(Ws(e))zs(t,i);else{var o=e.alternate;if(0===e.lanes&&(null===o||0===o.lanes)&&null!==(o=t.lastRenderedReducer))try{var s=t.lastRenderedState,a=o(s,n);if(i.hasEagerState=!0,i.eagerState=a,ir(a,s)){var l=t.interleaved;return null===l?(i.next=i,Po(t)):(i.next=l.next,l.next=i),void(t.interleaved=i)}}catch{}null!==(n=Oo(e,t,i,r))&&(ec(n,e,r,i=Zl()),Js(n,t,r))}}function Ws(e){var t=e.alternate;return e===os||null!==t&&t===os}function zs(e,t){cs=ls=!0;var n=e.pending;null===n?t.next=t:(t.next=n.next,n.next=t),e.pending=t}function Js(e,t,n){if(4194240&n){var r=t.lanes;n|=r&=e.pendingLanes,t.lanes=n,mt(e,n)}}var Ys={readContext:xo,useCallback:hs,useContext:hs,useEffect:hs,useImperativeHandle:hs,useInsertionEffect:hs,useLayoutEffect:hs,useMemo:hs,useReducer:hs,useRef:hs,useState:hs,useDebugValue:hs,useDeferredValue:hs,useTransition:hs,useMutableSource:hs,useSyncExternalStore:hs,useId:hs,unstable_isNewReconciler:!1},Qs={readContext:xo,useCallback:function(e,t){return vs().memoizedState=[e,void 0===t?null:t],e},useContext:xo,useEffect:As,useImperativeHandle:function(e,t,n){return n=null!=n?n.concat([e]):null,Ps(4194308,4,js.bind(null,t,e),n)},useLayoutEffect:function(e,t){return Ps(4194308,4,e,t)},useInsertionEffect:function(e,t){return Ps(4,2,e,t)},useMemo:function(e,t){var n=vs();return t=void 0===t?null:t,e=e(),n.memoizedState=[e,t],e},useReducer:function(e,t,n){var r=vs();return t=void 0!==n?n(t):t,r.memoizedState=r.baseState=t,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:t},r.queue=e,e=e.dispatch=Ks.bind(null,os,e),[r.memoizedState,e]},useRef:function(e){return e={current:e},vs().memoizedState=e},useState:Rs,useDebugValue:Fs,useDeferredValue:function(e){return vs().memoizedState=e},useTransition:function(){var e=Rs(!1),t=e[0];return e=Vs.bind(null,e[1]),vs().memoizedState=e,[t,e]},useMutableSource:function(){},useSyncExternalStore:function(e,t,r){var i=os,o=vs();if(no){if(void 0===r)throw Error(n(407));r=r()}else{if(r=t(),null===Il)throw Error(n(349));30&is||Ss(i,t,r)}o.memoizedState=r;var s={value:r,getSnapshot:t};return o.queue=s,As(ks.bind(null,i,s,e),[e]),i.flags|=2048,xs(9,Cs.bind(null,i,s,r,t),void 0,null),r},useId:function(){var e=vs(),t=Il.identifierPrefix;if(no){var n=Ji;t=":"+t+"R"+(n=(zi&~(1<<32-rt(zi)-1)).toString(32)+n),0<(n=us++)&&(t+="H"+n.toString(32)),t+=":"}else t=":"+t+"r"+(n=ds++).toString(32)+":";return e.memoizedState=t},unstable_isNewReconciler:!1},Zs={readContext:xo,useCallback:Hs,useContext:xo,useEffect:Ms,useImperativeHandle:Us,useInsertionEffect:Ns,useLayoutEffect:Ds,useMemo:Bs,useReducer:bs,useRef:Ls,useState:function(){return bs(ys)},useDebugValue:Fs,useDeferredValue:function(e){return $s(gs(),ss.memoizedState,e)},useTransition:function(){return[bs(ys)[0],gs().memoizedState]},useMutableSource:ws,useSyncExternalStore:Es,useId:qs,unstable_isNewReconciler:!1},Xs={readContext:xo,useCallback:Hs,useContext:xo,useEffect:Ms,useImperativeHandle:Us,useInsertionEffect:Ns,useLayoutEffect:Ds,useMemo:Bs,useReducer:_s,useRef:Ls,useState:function(){return _s(ys)},useDebugValue:Fs,useDeferredValue:function(e){var t=gs();return null===ss?t.memoizedState=e:$s(t,ss.memoizedState,e)},useTransition:function(){return[_s(ys)[0],gs().memoizedState]},useMutableSource:ws,useSyncExternalStore:Es,useId:qs,unstable_isNewReconciler:!1};function ea(e,t){if(e&&e.defaultProps){for(var n in t=M({},t),e=e.defaultProps)void 0===t[n]&&(t[n]=e[n]);return t}return t}function ta(e,t,n,r){n=null==(n=n(r,t=e.memoizedState))?t:M({},t,n),e.memoizedState=n,0===e.lanes&&(e.updateQueue.baseState=n)}var na={isMounted:function(e){return!!(e=e._reactInternals)&&Fe(e)===e},enqueueSetState:function(e,t,n){e=e._reactInternals;var r=Zl(),i=Xl(e),o=jo(r,i);o.payload=t,null!=n&&(o.callback=n),null!==(t=Uo(e,o,i))&&(ec(t,e,i,r),Fo(t,e,i))},enqueueReplaceState:function(e,t,n){e=e._reactInternals;var r=Zl(),i=Xl(e),o=jo(r,i);o.tag=1,o.payload=t,null!=n&&(o.callback=n),null!==(t=Uo(e,o,i))&&(ec(t,e,i,r),Fo(t,e,i))},enqueueForceUpdate:function(e,t){e=e._reactInternals;var n=Zl(),r=Xl(e),i=jo(n,r);i.tag=2,null!=t&&(i.callback=t),null!==(t=Uo(e,i,r))&&(ec(t,e,r,n),Fo(t,e,r))}};function ra(e,t,n,r,i,o,s){return"function"==typeof(e=e.stateNode).shouldComponentUpdate?e.shouldComponentUpdate(r,o,s):!t.prototype||!t.prototype.isPureReactComponent||(!or(n,r)||!or(i,o))}function ia(e,t,n){var r=!1,i=Ci,o=t.contextType;return"object"==typeof o&&null!==o?o=xo(o):(i=xi(t)?Ii:ki.current,o=(r=null!=(r=t.contextTypes))?Ri(e,i):Ci),t=new t(n,o),e.memoizedState=null!==t.state&&void 0!==t.state?t.state:null,t.updater=na,e.stateNode=t,t._reactInternals=e,r&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=i,e.__reactInternalMemoizedMaskedChildContext=o),t}function oa(e,t,n,r){e=t.state,"function"==typeof t.componentWillReceiveProps&&t.componentWillReceiveProps(n,r),"function"==typeof t.UNSAFE_componentWillReceiveProps&&t.UNSAFE_componentWillReceiveProps(n,r),t.state!==e&&na.enqueueReplaceState(t,t.state,null)}function sa(e,t,n,r){var i=e.stateNode;i.props=n,i.state=e.memoizedState,i.refs={},No(e);var o=t.contextType;"object"==typeof o&&null!==o?i.context=xo(o):(o=xi(t)?Ii:ki.current,i.context=Ri(e,o)),i.state=e.memoizedState,"function"==typeof(o=t.getDerivedStateFromProps)&&(ta(e,t,o,n),i.state=e.memoizedState),"function"==typeof t.getDerivedStateFromProps||"function"==typeof i.getSnapshotBeforeUpdate||"function"!=typeof i.UNSAFE_componentWillMount&&"function"!=typeof i.componentWillMount||(t=i.state,"function"==typeof i.componentWillMount&&i.componentWillMount(),"function"==typeof i.UNSAFE_componentWillMount&&i.UNSAFE_componentWillMount(),t!==i.state&&na.enqueueReplaceState(i,i.state,null),Bo(e,n,i,r),i.state=e.memoizedState),"function"==typeof i.componentDidMount&&(e.flags|=4194308)}function aa(e,t){try{var n="",r=t;do{n+=U(r),r=r.return}while(r);var i=n}catch(e){i="\nError generating stack: "+e.message+"\n"+e.stack}return{value:e,source:t,stack:i,digest:null}}function la(e,t,n){return{value:e,source:null,stack:n??null,digest:t??null}}function ca(e,t){try{console.error(t.value)}catch(e){setTimeout((function(){throw e}))}}var ua="function"==typeof WeakMap?WeakMap:Map;function da(e,t,n){(n=jo(-1,n)).tag=3,n.payload={element:null};var r=t.value;return n.callback=function(){$l||($l=!0,Vl=r),ca(0,t)},n}function ha(e,t,n){(n=jo(-1,n)).tag=3;var r=e.type.getDerivedStateFromError;if("function"==typeof r){var i=t.value;n.payload=function(){return r(i)},n.callback=function(){ca(0,t)}}var o=e.stateNode;return null!==o&&"function"==typeof o.componentDidCatch&&(n.callback=function(){ca(0,t),"function"!=typeof r&&(null===ql?ql=new Set([this]):ql.add(this));var e=t.stack;this.componentDidCatch(t.value,{componentStack:null!==e?e:""})}),n}function pa(e,t,n){var r=e.pingCache;if(null===r){r=e.pingCache=new ua;var i=new Set;r.set(t,i)}else void 0===(i=r.get(t))&&(i=new Set,r.set(t,i));i.has(n)||(i.add(n),e=Sc.bind(null,e,t,n),t.then(e,e))}function fa(e){do{var t;if((t=13===e.tag)&&(t=null===(t=e.memoizedState)||null!==t.dehydrated),t)return e;e=e.return}while(null!==e);return null}function ma(e,t,n,r,i){return 1&e.mode?(e.flags|=65536,e.lanes=i,e):(e===t?e.flags|=65536:(e.flags|=128,n.flags|=131072,n.flags&=-52805,1===n.tag&&(null===n.alternate?n.tag=17:((t=jo(-1,1)).tag=2,Uo(n,t,1))),n.lanes|=1),e)}var va=g.ReactCurrentOwner,ga=!1;function ya(e,t,n,r){t.child=null===e?_o(t,null,n,r):bo(t,e.child,n,r)}function ba(e,t,n,r,i){n=n.render;var o=t.ref;return Ro(t,i),r=fs(e,t,n,r,o,i),n=ms(),null===e||ga?(no&&n&&Zi(t),t.flags|=1,ya(e,t,r,i),t.child):(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~i,$a(e,t,i))}function _a(e,t,n,r,i){if(null===e){var o=n.type;return"function"!=typeof o||Lc(o)||void 0!==o.defaultProps||null!==n.compare||void 0!==n.defaultProps?((e=Oc(n.type,null,r,t,t.mode,i)).ref=t.ref,e.return=t,t.child=e):(t.tag=15,t.type=o,wa(e,t,o,r,i))}if(o=e.child,!(e.lanes&i)){var s=o.memoizedProps;if((n=null!==(n=n.compare)?n:or)(s,r)&&e.ref===t.ref)return $a(e,t,i)}return t.flags|=1,(e=Pc(o,r)).ref=t.ref,e.return=t,t.child=e}function wa(e,t,n,r,i){if(null!==e){var o=e.memoizedProps;if(or(o,r)&&e.ref===t.ref){if(ga=!1,t.pendingProps=r=o,!(e.lanes&i))return t.lanes=e.lanes,$a(e,t,i);131072&e.flags&&(ga=!0)}}return Ca(e,t,n,r,i)}function Ea(e,t,n){var r=t.pendingProps,i=r.children,o=null!==e?e.memoizedState:null;if("hidden"===r.mode)if(1&t.mode){if(!(1073741824&n))return e=null!==o?o.baseLanes|n:n,t.lanes=t.childLanes=1073741824,t.memoizedState={baseLanes:e,cachePool:null,transitions:null},t.updateQueue=null,Si(Pl,Ll),Ll|=e,null;t.memoizedState={baseLanes:0,cachePool:null,transitions:null},r=null!==o?o.baseLanes:n,Si(Pl,Ll),Ll|=r}else t.memoizedState={baseLanes:0,cachePool:null,transitions:null},Si(Pl,Ll),Ll|=n;else null!==o?(r=o.baseLanes|n,t.memoizedState=null):r=n,Si(Pl,Ll),Ll|=r;return ya(e,t,i,n),t.child}function Sa(e,t){var n=t.ref;(null===e&&null!==n||null!==e&&e.ref!==n)&&(t.flags|=512,t.flags|=2097152)}function Ca(e,t,n,r,i){var o=xi(n)?Ii:ki.current;return o=Ri(t,o),Ro(t,i),n=fs(e,t,n,r,o,i),r=ms(),null===e||ga?(no&&r&&Zi(t),t.flags|=1,ya(e,t,n,i),t.child):(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~i,$a(e,t,i))}function ka(e,t,n,r,i){if(xi(n)){var o=!0;Ai(t)}else o=!1;if(Ro(t,i),null===t.stateNode)Ba(e,t),ia(t,n,r),sa(t,n,r,i),r=!0;else if(null===e){var s=t.stateNode,a=t.memoizedProps;s.props=a;var l=s.context,c=n.contextType;"object"==typeof c&&null!==c?c=xo(c):c=Ri(t,c=xi(n)?Ii:ki.current);var u=n.getDerivedStateFromProps,d="function"==typeof u||"function"==typeof s.getSnapshotBeforeUpdate;d||"function"!=typeof s.UNSAFE_componentWillReceiveProps&&"function"!=typeof s.componentWillReceiveProps||(a!==r||l!==c)&&oa(t,s,r,c),Mo=!1;var h=t.memoizedState;s.state=h,Bo(t,r,s,i),l=t.memoizedState,a!==r||h!==l||Ti.current||Mo?("function"==typeof u&&(ta(t,n,u,r),l=t.memoizedState),(a=Mo||ra(t,n,a,r,h,l,c))?(d||"function"!=typeof s.UNSAFE_componentWillMount&&"function"!=typeof s.componentWillMount||("function"==typeof s.componentWillMount&&s.componentWillMount(),"function"==typeof s.UNSAFE_componentWillMount&&s.UNSAFE_componentWillMount()),"function"==typeof s.componentDidMount&&(t.flags|=4194308)):("function"==typeof s.componentDidMount&&(t.flags|=4194308),t.memoizedProps=r,t.memoizedState=l),s.props=r,s.state=l,s.context=c,r=a):("function"==typeof s.componentDidMount&&(t.flags|=4194308),r=!1)}else{s=t.stateNode,Do(e,t),a=t.memoizedProps,c=t.type===t.elementType?a:ea(t.type,a),s.props=c,d=t.pendingProps,h=s.context,"object"==typeof(l=n.contextType)&&null!==l?l=xo(l):l=Ri(t,l=xi(n)?Ii:ki.current);var p=n.getDerivedStateFromProps;(u="function"==typeof p||"function"==typeof s.getSnapshotBeforeUpdate)||"function"!=typeof s.UNSAFE_componentWillReceiveProps&&"function"!=typeof s.componentWillReceiveProps||(a!==d||h!==l)&&oa(t,s,r,l),Mo=!1,h=t.memoizedState,s.state=h,Bo(t,r,s,i);var f=t.memoizedState;a!==d||h!==f||Ti.current||Mo?("function"==typeof p&&(ta(t,n,p,r),f=t.memoizedState),(c=Mo||ra(t,n,c,r,h,f,l)||!1)?(u||"function"!=typeof s.UNSAFE_componentWillUpdate&&"function"!=typeof s.componentWillUpdate||("function"==typeof s.componentWillUpdate&&s.componentWillUpdate(r,f,l),"function"==typeof s.UNSAFE_componentWillUpdate&&s.UNSAFE_componentWillUpdate(r,f,l)),"function"==typeof s.componentDidUpdate&&(t.flags|=4),"function"==typeof s.getSnapshotBeforeUpdate&&(t.flags|=1024)):("function"!=typeof s.componentDidUpdate||a===e.memoizedProps&&h===e.memoizedState||(t.flags|=4),"function"!=typeof s.getSnapshotBeforeUpdate||a===e.memoizedProps&&h===e.memoizedState||(t.flags|=1024),t.memoizedProps=r,t.memoizedState=f),s.props=r,s.state=f,s.context=l,r=c):("function"!=typeof s.componentDidUpdate||a===e.memoizedProps&&h===e.memoizedState||(t.flags|=4),"function"!=typeof s.getSnapshotBeforeUpdate||a===e.memoizedProps&&h===e.memoizedState||(t.flags|=1024),r=!1)}return Ta(e,t,n,r,o,i)}function Ta(e,t,n,r,i,o){Sa(e,t);var s=!!(128&t.flags);if(!r&&!s)return i&&Mi(t,n,!1),$a(e,t,o);r=t.stateNode,va.current=t;var a=s&&"function"!=typeof n.getDerivedStateFromError?null:r.render();return t.flags|=1,null!==e&&s?(t.child=bo(t,e.child,null,o),t.child=bo(t,null,a,o)):ya(e,t,a,o),t.memoizedState=r.state,i&&Mi(t,n,!0),t.child}function Ia(e){var t=e.stateNode;t.pendingContext?Pi(0,t.pendingContext,t.pendingContext!==t.context):t.context&&Pi(0,t.context,!1),zo(e,t.containerInfo)}function Ra(e,t,n,r,i){return ho(),po(i),t.flags|=256,ya(e,t,n,r),t.child}var xa,La,Pa,Oa,Aa={dehydrated:null,treeContext:null,retryLane:0};function Ma(e){return{baseLanes:e,cachePool:null,transitions:null}}function Na(e,t,r){var i,o=t.pendingProps,s=Zo.current,a=!1,l=!!(128&t.flags);if((i=l)||(i=(null===e||null!==e.memoizedState)&&!!(2&s)),i?(a=!0,t.flags&=-129):(null===e||null!==e.memoizedState)&&(s|=1),Si(Zo,1&s),null===e)return ao(t),null!==(e=t.memoizedState)&&null!==(e=e.dehydrated)?(1&t.mode?"$!"===e.data?t.lanes=8:t.lanes=1073741824:t.lanes=1,null):(l=o.children,e=o.fallback,a?(o=t.mode,a=t.child,l={mode:"hidden",children:l},1&o||null===a?a=Mc(l,o,0,null):(a.childLanes=0,a.pendingProps=l),e=Ac(e,o,r,null),a.return=t,e.return=t,a.sibling=e,t.child=a,t.child.memoizedState=Ma(r),t.memoizedState=Aa,e):Da(t,l));if(null!==(s=e.memoizedState)&&null!==(i=s.dehydrated))return function(e,t,r,i,o,s,a){if(r)return 256&t.flags?(t.flags&=-257,i=la(Error(n(422))),ja(e,t,a,i)):null!==t.memoizedState?(t.child=e.child,t.flags|=128,null):(s=i.fallback,o=t.mode,i=Mc({mode:"visible",children:i.children},o,0,null),s=Ac(s,o,a,null),s.flags|=2,i.return=t,s.return=t,i.sibling=s,t.child=i,!!(1&t.mode)&&bo(t,e.child,null,a),t.child.memoizedState=Ma(a),t.memoizedState=Aa,s);if(!(1&t.mode))return ja(e,t,a,null);if("$!"===o.data){if(i=o.nextSibling&&o.nextSibling.dataset)var l=i.dgst;return i=l,ja(e,t,a,i=la(s=Error(n(419)),i,void 0))}if(l=!!(a&e.childLanes),ga||l){if(null!==(i=Il)){switch(a&-a){case 4:o=2;break;case 16:o=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:o=32;break;case 536870912:o=268435456;break;default:o=0}0!==(o=o&(i.suspendedLanes|a)?0:o)&&o!==s.retryLane&&(s.retryLane=o,Ao(e,o),ec(i,e,o,-1))}return pc(),ja(e,t,a,i=la(Error(n(421))))}return"$?"===o.data?(t.flags|=128,t.child=e.child,t=kc.bind(null,e),o._reactRetry=t,null):(e=s.treeContext,to=si(o.nextSibling),eo=t,no=!0,ro=null,null!==e&&(Ki[Gi++]=zi,Ki[Gi++]=Ji,Ki[Gi++]=Wi,zi=e.id,Ji=e.overflow,Wi=t),t=Da(t,i.children),t.flags|=4096,t)}(e,t,l,o,i,s,r);if(a){a=o.fallback,l=t.mode,i=(s=e.child).sibling;var c={mode:"hidden",children:o.children};return 1&l||t.child===s?(o=Pc(s,c)).subtreeFlags=14680064&s.subtreeFlags:((o=t.child).childLanes=0,o.pendingProps=c,t.deletions=null),null!==i?a=Pc(i,a):(a=Ac(a,l,r,null)).flags|=2,a.return=t,o.return=t,o.sibling=a,t.child=o,o=a,a=t.child,l=null===(l=e.child.memoizedState)?Ma(r):{baseLanes:l.baseLanes|r,cachePool:null,transitions:l.transitions},a.memoizedState=l,a.childLanes=e.childLanes&~r,t.memoizedState=Aa,o}return e=(a=e.child).sibling,o=Pc(a,{mode:"visible",children:o.children}),!(1&t.mode)&&(o.lanes=r),o.return=t,o.sibling=null,null!==e&&(null===(r=t.deletions)?(t.deletions=[e],t.flags|=16):r.push(e)),t.child=o,t.memoizedState=null,o}function Da(e,t){return(t=Mc({mode:"visible",children:t},e.mode,0,null)).return=e,e.child=t}function ja(e,t,n,r){return null!==r&&po(r),bo(t,e.child,null,n),(e=Da(t,t.pendingProps.children)).flags|=2,t.memoizedState=null,e}function Ua(e,t,n){e.lanes|=t;var r=e.alternate;null!==r&&(r.lanes|=t),Io(e.return,t,n)}function Fa(e,t,n,r,i){var o=e.memoizedState;null===o?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:r,tail:n,tailMode:i}:(o.isBackwards=t,o.rendering=null,o.renderingStartTime=0,o.last=r,o.tail=n,o.tailMode=i)}function Ha(e,t,n){var r=t.pendingProps,i=r.revealOrder,o=r.tail;if(ya(e,t,r.children,n),2&(r=Zo.current))r=1&r|2,t.flags|=128;else{if(null!==e&&128&e.flags)e:for(e=t.child;null!==e;){if(13===e.tag)null!==e.memoizedState&&Ua(e,n,t);else if(19===e.tag)Ua(e,n,t);else if(null!==e.child){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;null===e.sibling;){if(null===e.return||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}r&=1}if(Si(Zo,r),1&t.mode)switch(i){case"forwards":for(n=t.child,i=null;null!==n;)null!==(e=n.alternate)&&null===Xo(e)&&(i=n),n=n.sibling;null===(n=i)?(i=t.child,t.child=null):(i=n.sibling,n.sibling=null),Fa(t,!1,i,n,o);break;case"backwards":for(n=null,i=t.child,t.child=null;null!==i;){if(null!==(e=i.alternate)&&null===Xo(e)){t.child=i;break}e=i.sibling,i.sibling=n,n=i,i=e}Fa(t,!0,n,null,o);break;case"together":Fa(t,!1,null,null,void 0);break;default:t.memoizedState=null}else t.memoizedState=null;return t.child}function Ba(e,t){!(1&t.mode)&&null!==e&&(e.alternate=null,t.alternate=null,t.flags|=2)}function $a(e,t,r){if(null!==e&&(t.dependencies=e.dependencies),Ml|=t.lanes,!(r&t.childLanes))return null;if(null!==e&&t.child!==e.child)throw Error(n(153));if(null!==t.child){for(r=Pc(e=t.child,e.pendingProps),t.child=r,r.return=t;null!==e.sibling;)e=e.sibling,(r=r.sibling=Pc(e,e.pendingProps)).return=t;r.sibling=null}return t.child}function Va(e,t){if(!no)switch(e.tailMode){case"hidden":t=e.tail;for(var n=null;null!==t;)null!==t.alternate&&(n=t),t=t.sibling;null===n?e.tail=null:n.sibling=null;break;case"collapsed":n=e.tail;for(var r=null;null!==n;)null!==n.alternate&&(r=n),n=n.sibling;null===r?t||null===e.tail?e.tail=null:e.tail.sibling=null:r.sibling=null}}function qa(e){var t=null!==e.alternate&&e.alternate.child===e.child,n=0,r=0;if(t)for(var i=e.child;null!==i;)n|=i.lanes|i.childLanes,r|=14680064&i.subtreeFlags,r|=14680064&i.flags,i.return=e,i=i.sibling;else for(i=e.child;null!==i;)n|=i.lanes|i.childLanes,r|=i.subtreeFlags,r|=i.flags,i.return=e,i=i.sibling;return e.subtreeFlags|=r,e.childLanes=n,t}function Ka(e,t,r){var o=t.pendingProps;switch(Xi(t),t.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return qa(t),null;case 1:case 17:return xi(t.type)&&Li(),qa(t),null;case 3:return o=t.stateNode,Jo(),Ei(Ti),Ei(ki),ts(),o.pendingContext&&(o.context=o.pendingContext,o.pendingContext=null),(null===e||null===e.child)&&(co(t)?t.flags|=4:null===e||e.memoizedState.isDehydrated&&!(256&t.flags)||(t.flags|=1024,null!==ro&&(ic(ro),ro=null))),La(e,t),qa(t),null;case 5:Qo(t);var s=Wo(Go.current);if(r=t.type,null!==e&&null!=t.stateNode)Pa(e,t,r,o,s),e.ref!==t.ref&&(t.flags|=512,t.flags|=2097152);else{if(!o){if(null===t.stateNode)throw Error(n(166));return qa(t),null}if(e=Wo(qo.current),co(t)){o=t.stateNode,r=t.type;var a=t.memoizedProps;switch(o[ci]=t,o[ui]=a,e=!!(1&t.mode),r){case"dialog":Dr("cancel",o),Dr("close",o);break;case"iframe":case"object":case"embed":Dr("load",o);break;case"video":case"audio":for(s=0;s<Or.length;s++)Dr(Or[s],o);break;case"source":Dr("error",o);break;case"img":case"image":case"link":Dr("error",o),Dr("load",o);break;case"details":Dr("toggle",o);break;case"input":W(o,a),Dr("invalid",o);break;case"select":o._wrapperState={wasMultiple:!!a.multiple},Dr("invalid",o);break;case"textarea":te(o,a),Dr("invalid",o)}for(var l in me(r,a),s=null,a)if(a.hasOwnProperty(l)){var c=a[l];"children"===l?"string"==typeof c?o.textContent!==c&&(!0!==a.suppressHydrationWarning&&Jr(o.textContent,c,e),s=["children",c]):"number"==typeof c&&o.textContent!==""+c&&(!0!==a.suppressHydrationWarning&&Jr(o.textContent,c,e),s=["children",""+c]):i.hasOwnProperty(l)&&null!=c&&"onScroll"===l&&Dr("scroll",o)}switch(r){case"input":V(o),Y(o,a,!0);break;case"textarea":V(o),re(o);break;case"select":case"option":break;default:"function"==typeof a.onClick&&(o.onclick=Yr)}o=s,t.updateQueue=o,null!==o&&(t.flags|=4)}else{l=9===s.nodeType?s:s.ownerDocument,"http://www.w3.org/1999/xhtml"===e&&(e=ie(r)),"http://www.w3.org/1999/xhtml"===e?"script"===r?((e=l.createElement("div")).innerHTML="<script><\/script>",e=e.removeChild(e.firstChild)):"string"==typeof o.is?e=l.createElement(r,{is:o.is}):(e=l.createElement(r),"select"===r&&(l=e,o.multiple?l.multiple=!0:o.size&&(l.size=o.size))):e=l.createElementNS(e,r),e[ci]=t,e[ui]=o,xa(e,t,!1,!1),t.stateNode=e;e:{switch(l=ve(r,o),r){case"dialog":Dr("cancel",e),Dr("close",e),s=o;break;case"iframe":case"object":case"embed":Dr("load",e),s=o;break;case"video":case"audio":for(s=0;s<Or.length;s++)Dr(Or[s],e);s=o;break;case"source":Dr("error",e),s=o;break;case"img":case"image":case"link":Dr("error",e),Dr("load",e),s=o;break;case"details":Dr("toggle",e),s=o;break;case"input":W(e,o),s=G(e,o),Dr("invalid",e);break;case"option":default:s=o;break;case"select":e._wrapperState={wasMultiple:!!o.multiple},s=M({},o,{value:void 0}),Dr("invalid",e);break;case"textarea":te(e,o),s=ee(e,o),Dr("invalid",e)}for(a in me(r,s),c=s)if(c.hasOwnProperty(a)){var u=c[a];"style"===a?pe(e,u):"dangerouslySetInnerHTML"===a?null!=(u=u?u.__html:void 0)&&le(e,u):"children"===a?"string"==typeof u?("textarea"!==r||""!==u)&&ce(e,u):"number"==typeof u&&ce(e,""+u):"suppressContentEditableWarning"!==a&&"suppressHydrationWarning"!==a&&"autoFocus"!==a&&(i.hasOwnProperty(a)?null!=u&&"onScroll"===a&&Dr("scroll",e):null!=u&&v(e,a,u,l))}switch(r){case"input":V(e),Y(e,o,!1);break;case"textarea":V(e),re(e);break;case"option":null!=o.value&&e.setAttribute("value",""+B(o.value));break;case"select":e.multiple=!!o.multiple,null!=(a=o.value)?X(e,!!o.multiple,a,!1):null!=o.defaultValue&&X(e,!!o.multiple,o.defaultValue,!0);break;default:"function"==typeof s.onClick&&(e.onclick=Yr)}switch(r){case"button":case"input":case"select":case"textarea":o=!!o.autoFocus;break e;case"img":o=!0;break e;default:o=!1}}o&&(t.flags|=4)}null!==t.ref&&(t.flags|=512,t.flags|=2097152)}return qa(t),null;case 6:if(e&&null!=t.stateNode)Oa(e,t,e.memoizedProps,o);else{if("string"!=typeof o&&null===t.stateNode)throw Error(n(166));if(r=Wo(Go.current),Wo(qo.current),co(t)){if(o=t.stateNode,r=t.memoizedProps,o[ci]=t,(a=o.nodeValue!==r)&&null!==(e=eo))switch(e.tag){case 3:Jr(o.nodeValue,r,!!(1&e.mode));break;case 5:!0!==e.memoizedProps.suppressHydrationWarning&&Jr(o.nodeValue,r,!!(1&e.mode))}a&&(t.flags|=4)}else(o=(9===r.nodeType?r:r.ownerDocument).createTextNode(o))[ci]=t,t.stateNode=o}return qa(t),null;case 13:if(Ei(Zo),o=t.memoizedState,null===e||null!==e.memoizedState&&null!==e.memoizedState.dehydrated){if(no&&null!==to&&1&t.mode&&!(128&t.flags))uo(),ho(),t.flags|=98560,a=!1;else if(a=co(t),null!==o&&null!==o.dehydrated){if(null===e){if(!a)throw Error(n(318));if(!(a=null!==(a=t.memoizedState)?a.dehydrated:null))throw Error(n(317));a[ci]=t}else ho(),!(128&t.flags)&&(t.memoizedState=null),t.flags|=4;qa(t),a=!1}else null!==ro&&(ic(ro),ro=null),a=!0;if(!a)return 65536&t.flags?t:null}return 128&t.flags?(t.lanes=r,t):((o=null!==o)!==(null!==e&&null!==e.memoizedState)&&o&&(t.child.flags|=8192,!!(1&t.mode)&&(null===e||1&Zo.current?0===Ol&&(Ol=3):pc())),null!==t.updateQueue&&(t.flags|=4),qa(t),null);case 4:return Jo(),La(e,t),null===e&&Fr(t.stateNode.containerInfo),qa(t),null;case 10:return To(t.type._context),qa(t),null;case 19:if(Ei(Zo),null===(a=t.memoizedState))return qa(t),null;if(o=!!(128&t.flags),null===(l=a.rendering))if(o)Va(a,!1);else{if(0!==Ol||null!==e&&128&e.flags)for(e=t.child;null!==e;){if(null!==(l=Xo(e))){for(t.flags|=128,Va(a,!1),null!==(o=l.updateQueue)&&(t.updateQueue=o,t.flags|=4),t.subtreeFlags=0,o=r,r=t.child;null!==r;)e=o,(a=r).flags&=14680066,null===(l=a.alternate)?(a.childLanes=0,a.lanes=e,a.child=null,a.subtreeFlags=0,a.memoizedProps=null,a.memoizedState=null,a.updateQueue=null,a.dependencies=null,a.stateNode=null):(a.childLanes=l.childLanes,a.lanes=l.lanes,a.child=l.child,a.subtreeFlags=0,a.deletions=null,a.memoizedProps=l.memoizedProps,a.memoizedState=l.memoizedState,a.updateQueue=l.updateQueue,a.type=l.type,e=l.dependencies,a.dependencies=null===e?null:{lanes:e.lanes,firstContext:e.firstContext}),r=r.sibling;return Si(Zo,1&Zo.current|2),t.child}e=e.sibling}null!==a.tail&&ze()>Hl&&(t.flags|=128,o=!0,Va(a,!1),t.lanes=4194304)}else{if(!o)if(null!==(e=Xo(l))){if(t.flags|=128,o=!0,null!==(r=e.updateQueue)&&(t.updateQueue=r,t.flags|=4),Va(a,!0),null===a.tail&&"hidden"===a.tailMode&&!l.alternate&&!no)return qa(t),null}else 2*ze()-a.renderingStartTime>Hl&&1073741824!==r&&(t.flags|=128,o=!0,Va(a,!1),t.lanes=4194304);a.isBackwards?(l.sibling=t.child,t.child=l):(null!==(r=a.last)?r.sibling=l:t.child=l,a.last=l)}return null!==a.tail?(t=a.tail,a.rendering=t,a.tail=t.sibling,a.renderingStartTime=ze(),t.sibling=null,r=Zo.current,Si(Zo,o?1&r|2:1&r),t):(qa(t),null);case 22:case 23:return cc(),o=null!==t.memoizedState,null!==e&&null!==e.memoizedState!==o&&(t.flags|=8192),o&&1&t.mode?!!(1073741824&Ll)&&(qa(t),6&t.subtreeFlags&&(t.flags|=8192)):qa(t),null;case 24:case 25:return null}throw Error(n(156,t.tag))}function Ga(e,t){switch(Xi(t),t.tag){case 1:return xi(t.type)&&Li(),65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 3:return Jo(),Ei(Ti),Ei(ki),ts(),65536&(e=t.flags)&&!(128&e)?(t.flags=-65537&e|128,t):null;case 5:return Qo(t),null;case 13:if(Ei(Zo),null!==(e=t.memoizedState)&&null!==e.dehydrated){if(null===t.alternate)throw Error(n(340));ho()}return 65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 19:return Ei(Zo),null;case 4:return Jo(),null;case 10:return To(t.type._context),null;case 22:case 23:return cc(),null;default:return null}}xa=function(e,t){for(var n=t.child;null!==n;){if(5===n.tag||6===n.tag)e.appendChild(n.stateNode);else if(4!==n.tag&&null!==n.child){n.child.return=n,n=n.child;continue}if(n===t)break;for(;null===n.sibling;){if(null===n.return||n.return===t)return;n=n.return}n.sibling.return=n.return,n=n.sibling}},La=function(){},Pa=function(e,t,n,r){var o=e.memoizedProps;if(o!==r){e=t.stateNode,Wo(qo.current);var s,a=null;switch(n){case"input":o=G(e,o),r=G(e,r),a=[];break;case"select":o=M({},o,{value:void 0}),r=M({},r,{value:void 0}),a=[];break;case"textarea":o=ee(e,o),r=ee(e,r),a=[];break;default:"function"!=typeof o.onClick&&"function"==typeof r.onClick&&(e.onclick=Yr)}for(u in me(n,r),n=null,o)if(!r.hasOwnProperty(u)&&o.hasOwnProperty(u)&&null!=o[u])if("style"===u){var l=o[u];for(s in l)l.hasOwnProperty(s)&&(n||(n={}),n[s]="")}else"dangerouslySetInnerHTML"!==u&&"children"!==u&&"suppressContentEditableWarning"!==u&&"suppressHydrationWarning"!==u&&"autoFocus"!==u&&(i.hasOwnProperty(u)?a||(a=[]):(a=a||[]).push(u,null));for(u in r){var c=r[u];if(l=null!=o?o[u]:void 0,r.hasOwnProperty(u)&&c!==l&&(null!=c||null!=l))if("style"===u)if(l){for(s in l)!l.hasOwnProperty(s)||c&&c.hasOwnProperty(s)||(n||(n={}),n[s]="");for(s in c)c.hasOwnProperty(s)&&l[s]!==c[s]&&(n||(n={}),n[s]=c[s])}else n||(a||(a=[]),a.push(u,n)),n=c;else"dangerouslySetInnerHTML"===u?(c=c?c.__html:void 0,l=l?l.__html:void 0,null!=c&&l!==c&&(a=a||[]).push(u,c)):"children"===u?"string"!=typeof c&&"number"!=typeof c||(a=a||[]).push(u,""+c):"suppressContentEditableWarning"!==u&&"suppressHydrationWarning"!==u&&(i.hasOwnProperty(u)?(null!=c&&"onScroll"===u&&Dr("scroll",e),a||l===c||(a=[])):(a=a||[]).push(u,c))}n&&(a=a||[]).push("style",n);var u=a;(t.updateQueue=u)&&(t.flags|=4)}},Oa=function(e,t,n,r){n!==r&&(t.flags|=4)};var Wa=!1,za=!1,Ja="function"==typeof WeakSet?WeakSet:Set,Ya=null;function Qa(e,t){var n=e.ref;if(null!==n)if("function"==typeof n)try{n(null)}catch(n){Ec(e,t,n)}else n.current=null}function Za(e,t,n){try{n()}catch(n){Ec(e,t,n)}}var Xa=!1;function el(e,t,n){var r=t.updateQueue;if(null!==(r=null!==r?r.lastEffect:null)){var i=r=r.next;do{if((i.tag&e)===e){var o=i.destroy;i.destroy=void 0,void 0!==o&&Za(t,n,o)}i=i.next}while(i!==r)}}function tl(e,t){if(null!==(t=null!==(t=t.updateQueue)?t.lastEffect:null)){var n=t=t.next;do{if((n.tag&e)===e){var r=n.create;n.destroy=r()}n=n.next}while(n!==t)}}function nl(e){var t=e.ref;if(null!==t){var n=e.stateNode;e.tag,e=n,"function"==typeof t?t(e):t.current=e}}function rl(e){var t=e.alternate;null!==t&&(e.alternate=null,rl(t)),e.child=null,e.deletions=null,e.sibling=null,5===e.tag&&(null!==(t=e.stateNode)&&(delete t[ci],delete t[ui],delete t[hi],delete t[pi],delete t[fi])),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}function il(e){return 5===e.tag||3===e.tag||4===e.tag}function ol(e){e:for(;;){for(;null===e.sibling;){if(null===e.return||il(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;5!==e.tag&&6!==e.tag&&18!==e.tag;){if(2&e.flags||null===e.child||4===e.tag)continue e;e.child.return=e,e=e.child}if(!(2&e.flags))return e.stateNode}}function sl(e,t,n){var r=e.tag;if(5===r||6===r)e=e.stateNode,t?8===n.nodeType?n.parentNode.insertBefore(e,t):n.insertBefore(e,t):(8===n.nodeType?(t=n.parentNode).insertBefore(e,n):(t=n).appendChild(e),null!=(n=n._reactRootContainer)||null!==t.onclick||(t.onclick=Yr));else if(4!==r&&null!==(e=e.child))for(sl(e,t,n),e=e.sibling;null!==e;)sl(e,t,n),e=e.sibling}function al(e,t,n){var r=e.tag;if(5===r||6===r)e=e.stateNode,t?n.insertBefore(e,t):n.appendChild(e);else if(4!==r&&null!==(e=e.child))for(al(e,t,n),e=e.sibling;null!==e;)al(e,t,n),e=e.sibling}var ll=null,cl=!1;function ul(e,t,n){for(n=n.child;null!==n;)dl(e,t,n),n=n.sibling}function dl(e,t,n){if(nt&&"function"==typeof nt.onCommitFiberUnmount)try{nt.onCommitFiberUnmount(tt,n)}catch{}switch(n.tag){case 5:za||Qa(n,t);case 6:var r=ll,i=cl;ll=null,ul(e,t,n),cl=i,null!==(ll=r)&&(cl?(e=ll,n=n.stateNode,8===e.nodeType?e.parentNode.removeChild(n):e.removeChild(n)):ll.removeChild(n.stateNode));break;case 18:null!==ll&&(cl?(e=ll,n=n.stateNode,8===e.nodeType?oi(e.parentNode,n):1===e.nodeType&&oi(e,n),Ft(e)):oi(ll,n.stateNode));break;case 4:r=ll,i=cl,ll=n.stateNode.containerInfo,cl=!0,ul(e,t,n),ll=r,cl=i;break;case 0:case 11:case 14:case 15:if(!za&&(null!==(r=n.updateQueue)&&null!==(r=r.lastEffect))){i=r=r.next;do{var o=i,s=o.destroy;o=o.tag,void 0!==s&&(!!(2&o)||!!(4&o))&&Za(n,t,s),i=i.next}while(i!==r)}ul(e,t,n);break;case 1:if(!za&&(Qa(n,t),"function"==typeof(r=n.stateNode).componentWillUnmount))try{r.props=n.memoizedProps,r.state=n.memoizedState,r.componentWillUnmount()}catch(e){Ec(n,t,e)}ul(e,t,n);break;case 21:ul(e,t,n);break;case 22:1&n.mode?(za=(r=za)||null!==n.memoizedState,ul(e,t,n),za=r):ul(e,t,n);break;default:ul(e,t,n)}}function hl(e){var t=e.updateQueue;if(null!==t){e.updateQueue=null;var n=e.stateNode;null===n&&(n=e.stateNode=new Ja),t.forEach((function(t){var r=Tc.bind(null,e,t);n.has(t)||(n.add(t),t.then(r,r))}))}}function pl(e,t){var r=t.deletions;if(null!==r)for(var i=0;i<r.length;i++){var o=r[i];try{var s=e,a=t,l=a;e:for(;null!==l;){switch(l.tag){case 5:ll=l.stateNode,cl=!1;break e;case 3:case 4:ll=l.stateNode.containerInfo,cl=!0;break e}l=l.return}if(null===ll)throw Error(n(160));dl(s,a,o),ll=null,cl=!1;var c=o.alternate;null!==c&&(c.return=null),o.return=null}catch(e){Ec(o,t,e)}}if(12854&t.subtreeFlags)for(t=t.child;null!==t;)fl(t,e),t=t.sibling}function fl(e,t){var r=e.alternate,i=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:if(pl(t,e),ml(e),4&i){try{el(3,e,e.return),tl(3,e)}catch(t){Ec(e,e.return,t)}try{el(5,e,e.return)}catch(t){Ec(e,e.return,t)}}break;case 1:pl(t,e),ml(e),512&i&&null!==r&&Qa(r,r.return);break;case 5:if(pl(t,e),ml(e),512&i&&null!==r&&Qa(r,r.return),32&e.flags){var o=e.stateNode;try{ce(o,"")}catch(t){Ec(e,e.return,t)}}if(4&i&&null!=(o=e.stateNode)){var s=e.memoizedProps,a=null!==r?r.memoizedProps:s,l=e.type,c=e.updateQueue;if(e.updateQueue=null,null!==c)try{"input"===l&&"radio"===s.type&&null!=s.name&&z(o,s),ve(l,a);var u=ve(l,s);for(a=0;a<c.length;a+=2){var d=c[a],h=c[a+1];"style"===d?pe(o,h):"dangerouslySetInnerHTML"===d?le(o,h):"children"===d?ce(o,h):v(o,d,h,u)}switch(l){case"input":J(o,s);break;case"textarea":ne(o,s);break;case"select":var p=o._wrapperState.wasMultiple;o._wrapperState.wasMultiple=!!s.multiple;var f=s.value;null!=f?X(o,!!s.multiple,f,!1):p!==!!s.multiple&&(null!=s.defaultValue?X(o,!!s.multiple,s.defaultValue,!0):X(o,!!s.multiple,s.multiple?[]:"",!1))}o[ui]=s}catch(t){Ec(e,e.return,t)}}break;case 6:if(pl(t,e),ml(e),4&i){if(null===e.stateNode)throw Error(n(162));o=e.stateNode,s=e.memoizedProps;try{o.nodeValue=s}catch(t){Ec(e,e.return,t)}}break;case 3:if(pl(t,e),ml(e),4&i&&null!==r&&r.memoizedState.isDehydrated)try{Ft(t.containerInfo)}catch(t){Ec(e,e.return,t)}break;case 4:default:pl(t,e),ml(e);break;case 13:pl(t,e),ml(e),8192&(o=e.child).flags&&(s=null!==o.memoizedState,o.stateNode.isHidden=s,!s||null!==o.alternate&&null!==o.alternate.memoizedState||(Fl=ze())),4&i&&hl(e);break;case 22:if(d=null!==r&&null!==r.memoizedState,1&e.mode?(za=(u=za)||d,pl(t,e),za=u):pl(t,e),ml(e),8192&i){if(u=null!==e.memoizedState,(e.stateNode.isHidden=u)&&!d&&1&e.mode)for(Ya=e,d=e.child;null!==d;){for(h=Ya=d;null!==Ya;){switch(f=(p=Ya).child,p.tag){case 0:case 11:case 14:case 15:el(4,p,p.return);break;case 1:Qa(p,p.return);var m=p.stateNode;if("function"==typeof m.componentWillUnmount){i=p,r=p.return;try{t=i,m.props=t.memoizedProps,m.state=t.memoizedState,m.componentWillUnmount()}catch(e){Ec(i,r,e)}}break;case 5:Qa(p,p.return);break;case 22:if(null!==p.memoizedState){bl(h);continue}}null!==f?(f.return=p,Ya=f):bl(h)}d=d.sibling}e:for(d=null,h=e;;){if(5===h.tag){if(null===d){d=h;try{o=h.stateNode,u?"function"==typeof(s=o.style).setProperty?s.setProperty("display","none","important"):s.display="none":(l=h.stateNode,a=null!=(c=h.memoizedProps.style)&&c.hasOwnProperty("display")?c.display:null,l.style.display=he("display",a))}catch(t){Ec(e,e.return,t)}}}else if(6===h.tag){if(null===d)try{h.stateNode.nodeValue=u?"":h.memoizedProps}catch(t){Ec(e,e.return,t)}}else if((22!==h.tag&&23!==h.tag||null===h.memoizedState||h===e)&&null!==h.child){h.child.return=h,h=h.child;continue}if(h===e)break e;for(;null===h.sibling;){if(null===h.return||h.return===e)break e;d===h&&(d=null),h=h.return}d===h&&(d=null),h.sibling.return=h.return,h=h.sibling}}break;case 19:pl(t,e),ml(e),4&i&&hl(e);case 21:}}function ml(e){var t=e.flags;if(2&t){try{e:{for(var r=e.return;null!==r;){if(il(r)){var i=r;break e}r=r.return}throw Error(n(160))}switch(i.tag){case 5:var o=i.stateNode;32&i.flags&&(ce(o,""),i.flags&=-33),al(e,ol(e),o);break;case 3:case 4:var s=i.stateNode.containerInfo;sl(e,ol(e),s);break;default:throw Error(n(161))}}catch(t){Ec(e,e.return,t)}e.flags&=-3}4096&t&&(e.flags&=-4097)}function vl(e,t,n){Ya=e,gl(e)}function gl(e,t,n){for(var r=!!(1&e.mode);null!==Ya;){var i=Ya,o=i.child;if(22===i.tag&&r){var s=null!==i.memoizedState||Wa;if(!s){var a=i.alternate,l=null!==a&&null!==a.memoizedState||za;a=Wa;var c=za;if(Wa=s,(za=l)&&!c)for(Ya=i;null!==Ya;)l=(s=Ya).child,22===s.tag&&null!==s.memoizedState?_l(i):null!==l?(l.return=s,Ya=l):_l(i);for(;null!==o;)Ya=o,gl(o),o=o.sibling;Ya=i,Wa=a,za=c}yl(e)}else 8772&i.subtreeFlags&&null!==o?(o.return=i,Ya=o):yl(e)}}function yl(e){for(;null!==Ya;){var t=Ya;if(8772&t.flags){var r=t.alternate;try{if(8772&t.flags)switch(t.tag){case 0:case 11:case 15:za||tl(5,t);break;case 1:var i=t.stateNode;if(4&t.flags&&!za)if(null===r)i.componentDidMount();else{var o=t.elementType===t.type?r.memoizedProps:ea(t.type,r.memoizedProps);i.componentDidUpdate(o,r.memoizedState,i.__reactInternalSnapshotBeforeUpdate)}var s=t.updateQueue;null!==s&&$o(t,s,i);break;case 3:var a=t.updateQueue;if(null!==a){if(r=null,null!==t.child)switch(t.child.tag){case 5:case 1:r=t.child.stateNode}$o(t,a,r)}break;case 5:var l=t.stateNode;if(null===r&&4&t.flags){r=l;var c=t.memoizedProps;switch(t.type){case"button":case"input":case"select":case"textarea":c.autoFocus&&r.focus();break;case"img":c.src&&(r.src=c.src)}}break;case 6:case 4:case 12:case 19:case 17:case 21:case 22:case 23:case 25:break;case 13:if(null===t.memoizedState){var u=t.alternate;if(null!==u){var d=u.memoizedState;if(null!==d){var h=d.dehydrated;null!==h&&Ft(h)}}}break;default:throw Error(n(163))}za||512&t.flags&&nl(t)}catch(e){Ec(t,t.return,e)}}if(t===e){Ya=null;break}if(null!==(r=t.sibling)){r.return=t.return,Ya=r;break}Ya=t.return}}function bl(e){for(;null!==Ya;){var t=Ya;if(t===e){Ya=null;break}var n=t.sibling;if(null!==n){n.return=t.return,Ya=n;break}Ya=t.return}}function _l(e){for(;null!==Ya;){var t=Ya;try{switch(t.tag){case 0:case 11:case 15:var n=t.return;try{tl(4,t)}catch(e){Ec(t,n,e)}break;case 1:var r=t.stateNode;if("function"==typeof r.componentDidMount){var i=t.return;try{r.componentDidMount()}catch(e){Ec(t,i,e)}}var o=t.return;try{nl(t)}catch(e){Ec(t,o,e)}break;case 5:var s=t.return;try{nl(t)}catch(e){Ec(t,s,e)}}}catch(e){Ec(t,t.return,e)}if(t===e){Ya=null;break}var a=t.sibling;if(null!==a){a.return=t.return,Ya=a;break}Ya=t.return}}var wl,El=Math.ceil,Sl=g.ReactCurrentDispatcher,Cl=g.ReactCurrentOwner,kl=g.ReactCurrentBatchConfig,Tl=0,Il=null,Rl=null,xl=0,Ll=0,Pl=wi(0),Ol=0,Al=null,Ml=0,Nl=0,Dl=0,jl=null,Ul=null,Fl=0,Hl=1/0,Bl=null,$l=!1,Vl=null,ql=null,Kl=!1,Gl=null,Wl=0,zl=0,Jl=null,Yl=-1,Ql=0;function Zl(){return 6&Tl?ze():-1!==Yl?Yl:Yl=ze()}function Xl(e){return 1&e.mode?2&Tl&&0!==xl?xl&-xl:null!==fo.transition?(0===Ql&&(Ql=ht()),Ql):(0!==(e=vt)||(e=void 0===(e=window.event)?16:Wt(e.type)),e):1}function ec(e,t,r,i){if(50<zl)throw zl=0,Jl=null,Error(n(185));ft(e,r,i),(!(2&Tl)||e!==Il)&&(e===Il&&(!(2&Tl)&&(Nl|=r),4===Ol&&oc(e,xl)),tc(e,i),1===r&&0===Tl&&!(1&t.mode)&&(Hl=ze()+500,ji&&Hi()))}function tc(e,t){var n=e.callbackNode;!function(e,t){for(var n=e.suspendedLanes,r=e.pingedLanes,i=e.expirationTimes,o=e.pendingLanes;0<o;){var s=31-rt(o),a=1<<s,l=i[s];-1===l?(!(a&n)||!!(a&r))&&(i[s]=ut(a,t)):l<=t&&(e.expiredLanes|=a),o&=~a}}(e,t);var r=ct(e,e===Il?xl:0);if(0===r)null!==n&&Ke(n),e.callbackNode=null,e.callbackPriority=0;else if(t=r&-r,e.callbackPriority!==t){if(null!=n&&Ke(n),1===t)0===e.tag?function(e){ji=!0,Fi(e)}(sc.bind(null,e)):Fi(sc.bind(null,e)),ri((function(){!(6&Tl)&&Hi()})),n=null;else{switch(gt(r)){case 1:n=Ye;break;case 4:n=Qe;break;case 16:default:n=Ze;break;case 536870912:n=et}n=Ic(n,nc.bind(null,e))}e.callbackPriority=t,e.callbackNode=n}}function nc(e,t){if(Yl=-1,Ql=0,6&Tl)throw Error(n(327));var r=e.callbackNode;if(_c()&&e.callbackNode!==r)return null;var i=ct(e,e===Il?xl:0);if(0===i)return null;if(30&i||i&e.expiredLanes||t)t=fc(e,i);else{t=i;var o=Tl;Tl|=2;var s=hc();for((Il!==e||xl!==t)&&(Bl=null,Hl=ze()+500,uc(e,t));;)try{vc();break}catch(t){dc(e,t)}ko(),Sl.current=s,Tl=o,null!==Rl?t=0:(Il=null,xl=0,t=Ol)}if(0!==t){if(2===t&&(0!==(o=dt(e))&&(i=o,t=rc(e,o))),1===t)throw r=Al,uc(e,0),oc(e,i),tc(e,ze()),r;if(6===t)oc(e,i);else{if(o=e.current.alternate,!(30&i||function(e){for(var t=e;;){if(16384&t.flags){var n=t.updateQueue;if(null!==n&&null!==(n=n.stores))for(var r=0;r<n.length;r++){var i=n[r],o=i.getSnapshot;i=i.value;try{if(!ir(o(),i))return!1}catch{return!1}}}if(n=t.child,16384&t.subtreeFlags&&null!==n)n.return=t,t=n;else{if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}(o)||(t=fc(e,i),2===t&&(s=dt(e),0!==s&&(i=s,t=rc(e,s))),1!==t)))throw r=Al,uc(e,0),oc(e,i),tc(e,ze()),r;switch(e.finishedWork=o,e.finishedLanes=i,t){case 0:case 1:throw Error(n(345));case 2:case 5:bc(e,Ul,Bl);break;case 3:if(oc(e,i),(130023424&i)===i&&10<(t=Fl+500-ze())){if(0!==ct(e,0))break;if(((o=e.suspendedLanes)&i)!==i){Zl(),e.pingedLanes|=e.suspendedLanes&o;break}e.timeoutHandle=ei(bc.bind(null,e,Ul,Bl),t);break}bc(e,Ul,Bl);break;case 4:if(oc(e,i),(4194240&i)===i)break;for(t=e.eventTimes,o=-1;0<i;){var a=31-rt(i);s=1<<a,(a=t[a])>o&&(o=a),i&=~s}if(i=o,10<(i=(120>(i=ze()-i)?120:480>i?480:1080>i?1080:1920>i?1920:3e3>i?3e3:4320>i?4320:1960*El(i/1960))-i)){e.timeoutHandle=ei(bc.bind(null,e,Ul,Bl),i);break}bc(e,Ul,Bl);break;default:throw Error(n(329))}}}return tc(e,ze()),e.callbackNode===r?nc.bind(null,e):null}function rc(e,t){var n=jl;return e.current.memoizedState.isDehydrated&&(uc(e,t).flags|=256),2!==(e=fc(e,t))&&(t=Ul,Ul=n,null!==t&&ic(t)),e}function ic(e){null===Ul?Ul=e:Ul.push.apply(Ul,e)}function oc(e,t){for(t&=~Dl,t&=~Nl,e.suspendedLanes|=t,e.pingedLanes&=~t,e=e.expirationTimes;0<t;){var n=31-rt(t),r=1<<n;e[n]=-1,t&=~r}}function sc(e){if(6&Tl)throw Error(n(327));_c();var t=ct(e,0);if(!(1&t))return tc(e,ze()),null;var r=fc(e,t);if(0!==e.tag&&2===r){var i=dt(e);0!==i&&(t=i,r=rc(e,i))}if(1===r)throw r=Al,uc(e,0),oc(e,t),tc(e,ze()),r;if(6===r)throw Error(n(345));return e.finishedWork=e.current.alternate,e.finishedLanes=t,bc(e,Ul,Bl),tc(e,ze()),null}function ac(e,t){var n=Tl;Tl|=1;try{return e(t)}finally{0===(Tl=n)&&(Hl=ze()+500,ji&&Hi())}}function lc(e){null!==Gl&&0===Gl.tag&&!(6&Tl)&&_c();var t=Tl;Tl|=1;var n=kl.transition,r=vt;try{if(kl.transition=null,vt=1,e)return e()}finally{vt=r,kl.transition=n,!(6&(Tl=t))&&Hi()}}function cc(){Ll=Pl.current,Ei(Pl)}function uc(e,t){e.finishedWork=null,e.finishedLanes=0;var n=e.timeoutHandle;if(-1!==n&&(e.timeoutHandle=-1,ti(n)),null!==Rl)for(n=Rl.return;null!==n;){var r=n;switch(Xi(r),r.tag){case 1:null!=(r=r.type.childContextTypes)&&Li();break;case 3:Jo(),Ei(Ti),Ei(ki),ts();break;case 5:Qo(r);break;case 4:Jo();break;case 13:case 19:Ei(Zo);break;case 10:To(r.type._context);break;case 22:case 23:cc()}n=n.return}if(Il=e,Rl=e=Pc(e.current,null),xl=Ll=t,Ol=0,Al=null,Dl=Nl=Ml=0,Ul=jl=null,null!==Lo){for(t=0;t<Lo.length;t++)if(null!==(r=(n=Lo[t]).interleaved)){n.interleaved=null;var i=r.next,o=n.pending;if(null!==o){var s=o.next;o.next=i,r.next=s}n.pending=r}Lo=null}return e}function dc(e,t){for(;;){var r=Rl;try{if(ko(),ns.current=Ys,ls){for(var i=os.memoizedState;null!==i;){var o=i.queue;null!==o&&(o.pending=null),i=i.next}ls=!1}if(is=0,as=ss=os=null,cs=!1,us=0,Cl.current=null,null===r||null===r.return){Ol=1,Al=t,Rl=null;break}e:{var s=e,a=r.return,l=r,c=t;if(t=xl,l.flags|=32768,null!==c&&"object"==typeof c&&"function"==typeof c.then){var u=c,d=l,h=d.tag;if(!(1&d.mode||0!==h&&11!==h&&15!==h)){var p=d.alternate;p?(d.updateQueue=p.updateQueue,d.memoizedState=p.memoizedState,d.lanes=p.lanes):(d.updateQueue=null,d.memoizedState=null)}var f=fa(a);if(null!==f){f.flags&=-257,ma(f,a,l,0,t),1&f.mode&&pa(s,u,t),c=u;var m=(t=f).updateQueue;if(null===m){var v=new Set;v.add(c),t.updateQueue=v}else m.add(c);break e}if(!(1&t)){pa(s,u,t),pc();break e}c=Error(n(426))}else if(no&&1&l.mode){var g=fa(a);if(null!==g){!(65536&g.flags)&&(g.flags|=256),ma(g,a,l,0,t),po(aa(c,l));break e}}s=c=aa(c,l),4!==Ol&&(Ol=2),null===jl?jl=[s]:jl.push(s),s=a;do{switch(s.tag){case 3:s.flags|=65536,t&=-t,s.lanes|=t,Ho(s,da(0,c,t));break e;case 1:l=c;var y=s.type,b=s.stateNode;if(!(128&s.flags||"function"!=typeof y.getDerivedStateFromError&&(null===b||"function"!=typeof b.componentDidCatch||null!==ql&&ql.has(b)))){s.flags|=65536,t&=-t,s.lanes|=t,Ho(s,ha(s,l,t));break e}}s=s.return}while(null!==s)}yc(r)}catch(e){t=e,Rl===r&&null!==r&&(Rl=r=r.return);continue}break}}function hc(){var e=Sl.current;return Sl.current=Ys,null===e?Ys:e}function pc(){(0===Ol||3===Ol||2===Ol)&&(Ol=4),null===Il||!(268435455&Ml)&&!(268435455&Nl)||oc(Il,xl)}function fc(e,t){var r=Tl;Tl|=2;var i=hc();for((Il!==e||xl!==t)&&(Bl=null,uc(e,t));;)try{mc();break}catch(t){dc(e,t)}if(ko(),Tl=r,Sl.current=i,null!==Rl)throw Error(n(261));return Il=null,xl=0,Ol}function mc(){for(;null!==Rl;)gc(Rl)}function vc(){for(;null!==Rl&&!Ge();)gc(Rl)}function gc(e){var t=wl(e.alternate,e,Ll);e.memoizedProps=e.pendingProps,null===t?yc(e):Rl=t,Cl.current=null}function yc(e){var t=e;do{var n=t.alternate;if(e=t.return,32768&t.flags){if(null!==(n=Ga(n,t)))return n.flags&=32767,void(Rl=n);if(null===e)return Ol=6,void(Rl=null);e.flags|=32768,e.subtreeFlags=0,e.deletions=null}else if(null!==(n=Ka(n,t,Ll)))return void(Rl=n);if(null!==(t=t.sibling))return void(Rl=t);Rl=t=e}while(null!==t);0===Ol&&(Ol=5)}function bc(e,t,r){var i=vt,o=kl.transition;try{kl.transition=null,vt=1,function(e,t,r,i){do{_c()}while(null!==Gl);if(6&Tl)throw Error(n(327));r=e.finishedWork;var o=e.finishedLanes;if(null===r)return null;if(e.finishedWork=null,e.finishedLanes=0,r===e.current)throw Error(n(177));e.callbackNode=null,e.callbackPriority=0;var s=r.lanes|r.childLanes;if(function(e,t){var n=e.pendingLanes&~t;e.pendingLanes=t,e.suspendedLanes=0,e.pingedLanes=0,e.expiredLanes&=t,e.mutableReadLanes&=t,e.entangledLanes&=t,t=e.entanglements;var r=e.eventTimes;for(e=e.expirationTimes;0<n;){var i=31-rt(n),o=1<<i;t[i]=0,r[i]=-1,e[i]=-1,n&=~o}}(e,s),e===Il&&(Rl=Il=null,xl=0),!(2064&r.subtreeFlags)&&!(2064&r.flags)||Kl||(Kl=!0,Ic(Ze,(function(){return _c(),null}))),s=!!(15990&r.flags),15990&r.subtreeFlags||s){s=kl.transition,kl.transition=null;var a=vt;vt=1;var l=Tl;Tl|=4,Cl.current=null,function(e,t){if(Qr=Bt,ur(e=cr())){if("selectionStart"in e)var r={start:e.selectionStart,end:e.selectionEnd};else e:{var i=(r=(r=e.ownerDocument)&&r.defaultView||window).getSelection&&r.getSelection();if(i&&0!==i.rangeCount){r=i.anchorNode;var o=i.anchorOffset,s=i.focusNode;i=i.focusOffset;try{r.nodeType,s.nodeType}catch{r=null;break e}var a=0,l=-1,c=-1,u=0,d=0,h=e,p=null;t:for(;;){for(var f;h!==r||0!==o&&3!==h.nodeType||(l=a+o),h!==s||0!==i&&3!==h.nodeType||(c=a+i),3===h.nodeType&&(a+=h.nodeValue.length),null!==(f=h.firstChild);)p=h,h=f;for(;;){if(h===e)break t;if(p===r&&++u===o&&(l=a),p===s&&++d===i&&(c=a),null!==(f=h.nextSibling))break;p=(h=p).parentNode}h=f}r=-1===l||-1===c?null:{start:l,end:c}}else r=null}r=r||{start:0,end:0}}else r=null;for(Zr={focusedElem:e,selectionRange:r},Bt=!1,Ya=t;null!==Ya;)if(e=(t=Ya).child,1028&t.subtreeFlags&&null!==e)e.return=t,Ya=e;else for(;null!==Ya;){t=Ya;try{var m=t.alternate;if(1024&t.flags)switch(t.tag){case 0:case 11:case 15:case 5:case 6:case 4:case 17:break;case 1:if(null!==m){var v=m.memoizedProps,g=m.memoizedState,y=t.stateNode,b=y.getSnapshotBeforeUpdate(t.elementType===t.type?v:ea(t.type,v),g);y.__reactInternalSnapshotBeforeUpdate=b}break;case 3:var _=t.stateNode.containerInfo;1===_.nodeType?_.textContent="":9===_.nodeType&&_.documentElement&&_.removeChild(_.documentElement);break;default:throw Error(n(163))}}catch(e){Ec(t,t.return,e)}if(null!==(e=t.sibling)){e.return=t.return,Ya=e;break}Ya=t.return}m=Xa,Xa=!1}(e,r),fl(r,e),dr(Zr),Bt=!!Qr,Zr=Qr=null,e.current=r,vl(r),We(),Tl=l,vt=a,kl.transition=s}else e.current=r;if(Kl&&(Kl=!1,Gl=e,Wl=o),s=e.pendingLanes,0===s&&(ql=null),function(e){if(nt&&"function"==typeof nt.onCommitFiberRoot)try{nt.onCommitFiberRoot(tt,e,void 0,!(128&~e.current.flags))}catch{}}(r.stateNode),tc(e,ze()),null!==t)for(i=e.onRecoverableError,r=0;r<t.length;r++)o=t[r],i(o.value,{componentStack:o.stack,digest:o.digest});if($l)throw $l=!1,e=Vl,Vl=null,e;!!(1&Wl)&&0!==e.tag&&_c(),s=e.pendingLanes,1&s?e===Jl?zl++:(zl=0,Jl=e):zl=0,Hi()}(e,t,r,i)}finally{kl.transition=o,vt=i}return null}function _c(){if(null!==Gl){var e=gt(Wl),t=kl.transition,r=vt;try{if(kl.transition=null,vt=16>e?16:e,null===Gl)var i=!1;else{if(e=Gl,Gl=null,Wl=0,6&Tl)throw Error(n(331));var o=Tl;for(Tl|=4,Ya=e.current;null!==Ya;){var s=Ya,a=s.child;if(16&Ya.flags){var l=s.deletions;if(null!==l){for(var c=0;c<l.length;c++){var u=l[c];for(Ya=u;null!==Ya;){var d=Ya;switch(d.tag){case 0:case 11:case 15:el(8,d,s)}var h=d.child;if(null!==h)h.return=d,Ya=h;else for(;null!==Ya;){var p=(d=Ya).sibling,f=d.return;if(rl(d),d===u){Ya=null;break}if(null!==p){p.return=f,Ya=p;break}Ya=f}}}var m=s.alternate;if(null!==m){var v=m.child;if(null!==v){m.child=null;do{var g=v.sibling;v.sibling=null,v=g}while(null!==v)}}Ya=s}}if(2064&s.subtreeFlags&&null!==a)a.return=s,Ya=a;else e:for(;null!==Ya;){if(2048&(s=Ya).flags)switch(s.tag){case 0:case 11:case 15:el(9,s,s.return)}var y=s.sibling;if(null!==y){y.return=s.return,Ya=y;break e}Ya=s.return}}var b=e.current;for(Ya=b;null!==Ya;){var _=(a=Ya).child;if(2064&a.subtreeFlags&&null!==_)_.return=a,Ya=_;else e:for(a=b;null!==Ya;){if(2048&(l=Ya).flags)try{switch(l.tag){case 0:case 11:case 15:tl(9,l)}}catch(e){Ec(l,l.return,e)}if(l===a){Ya=null;break e}var w=l.sibling;if(null!==w){w.return=l.return,Ya=w;break e}Ya=l.return}}if(Tl=o,Hi(),nt&&"function"==typeof nt.onPostCommitFiberRoot)try{nt.onPostCommitFiberRoot(tt,e)}catch{}i=!0}return i}finally{vt=r,kl.transition=t}}return!1}function wc(e,t,n){e=Uo(e,t=da(0,t=aa(n,t),1),1),t=Zl(),null!==e&&(ft(e,1,t),tc(e,t))}function Ec(e,t,n){if(3===e.tag)wc(e,e,n);else for(;null!==t;){if(3===t.tag){wc(t,e,n);break}if(1===t.tag){var r=t.stateNode;if("function"==typeof t.type.getDerivedStateFromError||"function"==typeof r.componentDidCatch&&(null===ql||!ql.has(r))){t=Uo(t,e=ha(t,e=aa(n,e),1),1),e=Zl(),null!==t&&(ft(t,1,e),tc(t,e));break}}t=t.return}}function Sc(e,t,n){var r=e.pingCache;null!==r&&r.delete(t),t=Zl(),e.pingedLanes|=e.suspendedLanes&n,Il===e&&(xl&n)===n&&(4===Ol||3===Ol&&(130023424&xl)===xl&&500>ze()-Fl?uc(e,0):Dl|=n),tc(e,t)}function Cc(e,t){0===t&&(1&e.mode?(t=at,!(130023424&(at<<=1))&&(at=4194304)):t=1);var n=Zl();null!==(e=Ao(e,t))&&(ft(e,t,n),tc(e,n))}function kc(e){var t=e.memoizedState,n=0;null!==t&&(n=t.retryLane),Cc(e,n)}function Tc(e,t){var r=0;switch(e.tag){case 13:var i=e.stateNode,o=e.memoizedState;null!==o&&(r=o.retryLane);break;case 19:i=e.stateNode;break;default:throw Error(n(314))}null!==i&&i.delete(t),Cc(e,r)}function Ic(e,t){return qe(e,t)}function Rc(e,t,n,r){this.tag=e,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function xc(e,t,n,r){return new Rc(e,t,n,r)}function Lc(e){return!(!(e=e.prototype)||!e.isReactComponent)}function Pc(e,t){var n=e.alternate;return null===n?((n=xc(e.tag,t,e.key,e.mode)).elementType=e.elementType,n.type=e.type,n.stateNode=e.stateNode,n.alternate=e,e.alternate=n):(n.pendingProps=t,n.type=e.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=14680064&e.flags,n.childLanes=e.childLanes,n.lanes=e.lanes,n.child=e.child,n.memoizedProps=e.memoizedProps,n.memoizedState=e.memoizedState,n.updateQueue=e.updateQueue,t=e.dependencies,n.dependencies=null===t?null:{lanes:t.lanes,firstContext:t.firstContext},n.sibling=e.sibling,n.index=e.index,n.ref=e.ref,n}function Oc(e,t,r,i,o,s){var a=2;if(i=e,"function"==typeof e)Lc(e)&&(a=1);else if("string"==typeof e)a=5;else e:switch(e){case _:return Ac(r.children,o,s,t);case w:a=8,o|=8;break;case E:return(e=xc(12,r,t,2|o)).elementType=E,e.lanes=s,e;case T:return(e=xc(13,r,t,o)).elementType=T,e.lanes=s,e;case I:return(e=xc(19,r,t,o)).elementType=I,e.lanes=s,e;case L:return Mc(r,o,s,t);default:if("object"==typeof e&&null!==e)switch(e.$$typeof){case S:a=10;break e;case C:a=9;break e;case k:a=11;break e;case R:a=14;break e;case x:a=16,i=null;break e}throw Error(n(130,null==e?e:typeof e,""))}return(t=xc(a,r,t,o)).elementType=e,t.type=i,t.lanes=s,t}function Ac(e,t,n,r){return(e=xc(7,e,r,t)).lanes=n,e}function Mc(e,t,n,r){return(e=xc(22,e,r,t)).elementType=L,e.lanes=n,e.stateNode={isHidden:!1},e}function Nc(e,t,n){return(e=xc(6,e,null,t)).lanes=n,e}function Dc(e,t,n){return(t=xc(4,null!==e.children?e.children:[],e.key,t)).lanes=n,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}function jc(e,t,n,r,i){this.tag=t,this.containerInfo=e,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=pt(0),this.expirationTimes=pt(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=pt(0),this.identifierPrefix=r,this.onRecoverableError=i,this.mutableSourceEagerHydrationData=null}function Uc(e,t,n,r,i,o,s,a,l){return e=new jc(e,t,n,a,l),1===t?(t=1,!0===o&&(t|=8)):t=0,o=xc(3,null,null,t),e.current=o,o.stateNode=e,o.memoizedState={element:r,isDehydrated:n,cache:null,transitions:null,pendingSuspenseBoundaries:null},No(o),e}function Fc(e){if(!e)return Ci;e:{if(Fe(e=e._reactInternals)!==e||1!==e.tag)throw Error(n(170));var t=e;do{switch(t.tag){case 3:t=t.stateNode.context;break e;case 1:if(xi(t.type)){t=t.stateNode.__reactInternalMemoizedMergedChildContext;break e}}t=t.return}while(null!==t);throw Error(n(171))}if(1===e.tag){var r=e.type;if(xi(r))return Oi(e,r,t)}return t}function Hc(e,t,n,r,i,o,s,a,l){return(e=Uc(n,r,!0,e,0,o,0,a,l)).context=Fc(null),n=e.current,(o=jo(r=Zl(),i=Xl(n))).callback=t??null,Uo(n,o,i),e.current.lanes=i,ft(e,i,r),tc(e,r),e}function Bc(e,t,n,r){var i=t.current,o=Zl(),s=Xl(i);return n=Fc(n),null===t.context?t.context=n:t.pendingContext=n,(t=jo(o,s)).payload={element:e},null!==(r=void 0===r?null:r)&&(t.callback=r),null!==(e=Uo(i,t,s))&&(ec(e,i,s,o),Fo(e,i,s)),s}function $c(e){return(e=e.current).child?(e.child.tag,e.child.stateNode):null}function Vc(e,t){if(null!==(e=e.memoizedState)&&null!==e.dehydrated){var n=e.retryLane;e.retryLane=0!==n&&n<t?n:t}}function qc(e,t){Vc(e,t),(e=e.alternate)&&Vc(e,t)}wl=function(e,t,r){if(null!==e)if(e.memoizedProps!==t.pendingProps||Ti.current)ga=!0;else{if(!(e.lanes&r||128&t.flags))return ga=!1,function(e,t,n){switch(t.tag){case 3:Ia(t),ho();break;case 5:Yo(t);break;case 1:xi(t.type)&&Ai(t);break;case 4:zo(t,t.stateNode.containerInfo);break;case 10:var r=t.type._context,i=t.memoizedProps.value;Si(wo,r._currentValue),r._currentValue=i;break;case 13:if(null!==(r=t.memoizedState))return null!==r.dehydrated?(Si(Zo,1&Zo.current),t.flags|=128,null):n&t.child.childLanes?Na(e,t,n):(Si(Zo,1&Zo.current),null!==(e=$a(e,t,n))?e.sibling:null);Si(Zo,1&Zo.current);break;case 19:if(r=!!(n&t.childLanes),128&e.flags){if(r)return Ha(e,t,n);t.flags|=128}if(null!==(i=t.memoizedState)&&(i.rendering=null,i.tail=null,i.lastEffect=null),Si(Zo,Zo.current),r)break;return null;case 22:case 23:return t.lanes=0,Ea(e,t,n)}return $a(e,t,n)}(e,t,r);ga=!!(131072&e.flags)}else ga=!1,no&&1048576&t.flags&&Qi(t,qi,t.index);switch(t.lanes=0,t.tag){case 2:var i=t.type;Ba(e,t),e=t.pendingProps;var o=Ri(t,ki.current);Ro(t,r),o=fs(null,t,i,e,o,r);var s=ms();return t.flags|=1,"object"==typeof o&&null!==o&&"function"==typeof o.render&&void 0===o.$$typeof?(t.tag=1,t.memoizedState=null,t.updateQueue=null,xi(i)?(s=!0,Ai(t)):s=!1,t.memoizedState=null!==o.state&&void 0!==o.state?o.state:null,No(t),o.updater=na,t.stateNode=o,o._reactInternals=t,sa(t,i,e,r),t=Ta(null,t,i,!0,s,r)):(t.tag=0,no&&s&&Zi(t),ya(null,t,o,r),t=t.child),t;case 16:i=t.elementType;e:{switch(Ba(e,t),e=t.pendingProps,i=(o=i._init)(i._payload),t.type=i,o=t.tag=function(e){if("function"==typeof e)return Lc(e)?1:0;if(null!=e){if((e=e.$$typeof)===k)return 11;if(e===R)return 14}return 2}(i),e=ea(i,e),o){case 0:t=Ca(null,t,i,e,r);break e;case 1:t=ka(null,t,i,e,r);break e;case 11:t=ba(null,t,i,e,r);break e;case 14:t=_a(null,t,i,ea(i.type,e),r);break e}throw Error(n(306,i,""))}return t;case 0:return i=t.type,o=t.pendingProps,Ca(e,t,i,o=t.elementType===i?o:ea(i,o),r);case 1:return i=t.type,o=t.pendingProps,ka(e,t,i,o=t.elementType===i?o:ea(i,o),r);case 3:e:{if(Ia(t),null===e)throw Error(n(387));i=t.pendingProps,o=(s=t.memoizedState).element,Do(e,t),Bo(t,i,null,r);var a=t.memoizedState;if(i=a.element,s.isDehydrated){if(s={element:i,isDehydrated:!1,cache:a.cache,pendingSuspenseBoundaries:a.pendingSuspenseBoundaries,transitions:a.transitions},t.updateQueue.baseState=s,t.memoizedState=s,256&t.flags){t=Ra(e,t,i,r,o=aa(Error(n(423)),t));break e}if(i!==o){t=Ra(e,t,i,r,o=aa(Error(n(424)),t));break e}for(to=si(t.stateNode.containerInfo.firstChild),eo=t,no=!0,ro=null,r=_o(t,null,i,r),t.child=r;r;)r.flags=-3&r.flags|4096,r=r.sibling}else{if(ho(),i===o){t=$a(e,t,r);break e}ya(e,t,i,r)}t=t.child}return t;case 5:return Yo(t),null===e&&ao(t),i=t.type,o=t.pendingProps,s=null!==e?e.memoizedProps:null,a=o.children,Xr(i,o)?a=null:null!==s&&Xr(i,s)&&(t.flags|=32),Sa(e,t),ya(e,t,a,r),t.child;case 6:return null===e&&ao(t),null;case 13:return Na(e,t,r);case 4:return zo(t,t.stateNode.containerInfo),i=t.pendingProps,null===e?t.child=bo(t,null,i,r):ya(e,t,i,r),t.child;case 11:return i=t.type,o=t.pendingProps,ba(e,t,i,o=t.elementType===i?o:ea(i,o),r);case 7:return ya(e,t,t.pendingProps,r),t.child;case 8:case 12:return ya(e,t,t.pendingProps.children,r),t.child;case 10:e:{if(i=t.type._context,o=t.pendingProps,s=t.memoizedProps,a=o.value,Si(wo,i._currentValue),i._currentValue=a,null!==s)if(ir(s.value,a)){if(s.children===o.children&&!Ti.current){t=$a(e,t,r);break e}}else for(null!==(s=t.child)&&(s.return=t);null!==s;){var l=s.dependencies;if(null!==l){a=s.child;for(var c=l.firstContext;null!==c;){if(c.context===i){if(1===s.tag){(c=jo(-1,r&-r)).tag=2;var u=s.updateQueue;if(null!==u){var d=(u=u.shared).pending;null===d?c.next=c:(c.next=d.next,d.next=c),u.pending=c}}s.lanes|=r,null!==(c=s.alternate)&&(c.lanes|=r),Io(s.return,r,t),l.lanes|=r;break}c=c.next}}else if(10===s.tag)a=s.type===t.type?null:s.child;else if(18===s.tag){if(null===(a=s.return))throw Error(n(341));a.lanes|=r,null!==(l=a.alternate)&&(l.lanes|=r),Io(a,r,t),a=s.sibling}else a=s.child;if(null!==a)a.return=s;else for(a=s;null!==a;){if(a===t){a=null;break}if(null!==(s=a.sibling)){s.return=a.return,a=s;break}a=a.return}s=a}ya(e,t,o.children,r),t=t.child}return t;case 9:return o=t.type,i=t.pendingProps.children,Ro(t,r),i=i(o=xo(o)),t.flags|=1,ya(e,t,i,r),t.child;case 14:return o=ea(i=t.type,t.pendingProps),_a(e,t,i,o=ea(i.type,o),r);case 15:return wa(e,t,t.type,t.pendingProps,r);case 17:return i=t.type,o=t.pendingProps,o=t.elementType===i?o:ea(i,o),Ba(e,t),t.tag=1,xi(i)?(e=!0,Ai(t)):e=!1,Ro(t,r),ia(t,i,o),sa(t,i,o,r),Ta(null,t,i,!0,e,r);case 19:return Ha(e,t,r);case 22:return Ea(e,t,r)}throw Error(n(156,t.tag))};var Kc="function"==typeof reportError?reportError:function(e){console.error(e)};function Gc(e){this._internalRoot=e}function Wc(e){this._internalRoot=e}function zc(e){return!(!e||1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType)}function Jc(e){return!(!e||1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType&&(8!==e.nodeType||" react-mount-point-unstable "!==e.nodeValue))}function Yc(){}function Qc(e,t,n,r,i){var o=n._reactRootContainer;if(o){var s=o;if("function"==typeof i){var a=i;i=function(){var e=$c(s);a.call(e)}}Bc(t,s,e,i)}else s=function(e,t,n,r,i){if(i){if("function"==typeof r){var o=r;r=function(){var e=$c(s);o.call(e)}}var s=Hc(t,r,e,0,null,!1,0,"",Yc);return e._reactRootContainer=s,e[di]=s.current,Fr(8===e.nodeType?e.parentNode:e),lc(),s}for(;i=e.lastChild;)e.removeChild(i);if("function"==typeof r){var a=r;r=function(){var e=$c(l);a.call(e)}}var l=Uc(e,0,!1,null,0,!1,0,"",Yc);return e._reactRootContainer=l,e[di]=l.current,Fr(8===e.nodeType?e.parentNode:e),lc((function(){Bc(t,l,n,r)})),l}(n,t,e,i,r);return $c(s)}Wc.prototype.render=Gc.prototype.render=function(e){var t=this._internalRoot;if(null===t)throw Error(n(409));Bc(e,t,null,null)},Wc.prototype.unmount=Gc.prototype.unmount=function(){var e=this._internalRoot;if(null!==e){this._internalRoot=null;var t=e.containerInfo;lc((function(){Bc(null,e,null,null)})),t[di]=null}},Wc.prototype.unstable_scheduleHydration=function(e){if(e){var t=wt();e={blockedOn:null,target:e,priority:t};for(var n=0;n<Lt.length&&0!==t&&t<Lt[n].priority;n++);Lt.splice(n,0,e),0===n&&Mt(e)}},yt=function(e){switch(e.tag){case 3:var t=e.stateNode;if(t.current.memoizedState.isDehydrated){var n=lt(t.pendingLanes);0!==n&&(mt(t,1|n),tc(t,ze()),!(6&Tl)&&(Hl=ze()+500,Hi()))}break;case 13:lc((function(){var t=Ao(e,1);if(null!==t){var n=Zl();ec(t,e,1,n)}})),qc(e,1)}},bt=function(e){if(13===e.tag){var t=Ao(e,134217728);if(null!==t)ec(t,e,134217728,Zl());qc(e,134217728)}},_t=function(e){if(13===e.tag){var t=Xl(e),n=Ao(e,t);if(null!==n)ec(n,e,t,Zl());qc(e,t)}},wt=function(){return vt},Et=function(e,t){var n=vt;try{return vt=e,t()}finally{vt=n}},be=function(e,t,r){switch(t){case"input":if(J(e,r),t=r.name,"radio"===r.type&&null!=t){for(r=e;r.parentNode;)r=r.parentNode;for(r=r.querySelectorAll("input[name="+JSON.stringify(""+t)+'][type="radio"]'),t=0;t<r.length;t++){var i=r[t];if(i!==e&&i.form===e.form){var o=yi(i);if(!o)throw Error(n(90));q(i),J(i,o)}}}break;case"textarea":ne(e,r);break;case"select":null!=(t=r.value)&&X(e,!!r.multiple,t,!1)}},ke=ac,Te=lc;var Zc={usingClientEntryPoint:!1,Events:[vi,gi,yi,Se,Ce,ac]},Xc={findFiberByHostInstance:mi,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},eu={bundleType:Xc.bundleType,version:Xc.version,rendererPackageName:Xc.rendererPackageName,rendererConfig:Xc.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:g.ReactCurrentDispatcher,findHostInstanceByFiber:function(e){return null===(e=$e(e))?null:e.stateNode},findFiberByHostInstance:Xc.findFiberByHostInstance||function(){return null},findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var tu=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!tu.isDisabled&&tu.supportsFiber)try{tt=tu.inject(eu),nt=tu}catch{}}return Di.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Zc,Di.createPortal=function(e,t){var r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;if(!zc(t))throw Error(n(200));return function(e,t,n){var r=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null;return{$$typeof:b,key:null==r?null:""+r,children:e,containerInfo:t,implementation:n}}(e,t,null,r)},Di.createRoot=function(e,t){if(!zc(e))throw Error(n(299));var r=!1,i="",o=Kc;return null!=t&&(!0===t.unstable_strictMode&&(r=!0),void 0!==t.identifierPrefix&&(i=t.identifierPrefix),void 0!==t.onRecoverableError&&(o=t.onRecoverableError)),t=Uc(e,1,!1,null,0,r,0,i,o),e[di]=t.current,Fr(8===e.nodeType?e.parentNode:e),new Gc(t)},Di.findDOMNode=function(e){if(null==e)return null;if(1===e.nodeType)return e;var t=e._reactInternals;if(void 0===t)throw"function"==typeof e.render?Error(n(188)):(e=Object.keys(e).join(","),Error(n(268,e)));return e=null===(e=$e(t))?null:e.stateNode},Di.flushSync=function(e){return lc(e)},Di.hydrate=function(e,t,r){if(!Jc(t))throw Error(n(200));return Qc(null,e,t,!0,r)},Di.hydrateRoot=function(e,t,r){if(!zc(e))throw Error(n(405));var i=null!=r&&r.hydratedSources||null,o=!1,s="",a=Kc;if(null!=r&&(!0===r.unstable_strictMode&&(o=!0),void 0!==r.identifierPrefix&&(s=r.identifierPrefix),void 0!==r.onRecoverableError&&(a=r.onRecoverableError)),t=Hc(t,null,e,1,r??null,o,0,s,a),e[di]=t.current,Fr(e),i)for(e=0;e<i.length;e++)o=(o=(r=i[e])._getVersion)(r._source),null==t.mutableSourceEagerHydrationData?t.mutableSourceEagerHydrationData=[r,o]:t.mutableSourceEagerHydrationData.push(r,o);return new Wc(t)},Di.render=function(e,t,r){if(!Jc(t))throw Error(n(200));return Qc(null,e,t,!1,r)},Di.unmountComponentAtNode=function(e){if(!Jc(e))throw Error(n(40));return!!e._reactRootContainer&&(lc((function(){Qc(null,null,e,!1,(function(){e._reactRootContainer=null,e[di]=null}))})),!0)},Di.unstable_batchedUpdates=ac,Di.unstable_renderSubtreeIntoContainer=function(e,t,r,i){if(!Jc(r))throw Error(n(200));if(null==e||void 0===e._reactInternals)throw Error(n(38));return Qc(e,t,r,!1,i)},Di.version="18.3.1-next-f1338f8080-20240426",Di}function uB(){if(GN)return m2.exports;return GN=1,function e(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||"function"!=typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(e){console.error(e)}}(),m2.exports=gle(),m2.exports}function vle(){if(WN)return x1;WN=1;var e=uB();return x1.createRoot=e.createRoot,x1.hydrateRoot=e.hydrateRoot,x1}var yle=vle(),zN={};function _le(e,t){return t.forEach((function(t){t&&"string"!=typeof t&&!Array.isArray(t)&&Object.keys(t).forEach((function(n){if("default"!==n&&!(n in e)){var r=Object.getOwnPropertyDescriptor(t,n);Object.defineProperty(e,n,r.get?r:{enumerable:!0,get:function(){return t[n]}})}}))})),Object.freeze(e)}var ble=Object.defineProperty,Sle=(e,t,n)=>t in e?ble(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,YN=(e,t,n)=>Sle(e,"symbol"!=typeof t?t+"":t,n);let Ei=class{constructor(){YN(this,"_locking"),YN(this,"_locks"),this._locking=Promise.resolve(),this._locks=0}isLocked(){return this._locks>0}lock(){let e;this._locks+=1;const t=new Promise((t=>e=()=>{this._locks-=1,t()})),n=this._locking.then((()=>e));return this._locking=this._locking.then((()=>t)),n}};function Bn(e,t){if(!e)throw new Error(t)}const Ele=34028234663852886e22,wle=-34028234663852886e22,Cle=4294967295,Tle=2147483647,Rle=-2147483648;function K_(e){if("number"!=typeof e)throw new Error("invalid int 32: "+typeof e);if(!Number.isInteger(e)||e>Tle||e<Rle)throw new Error("invalid int 32: "+e)}function Hk(e){if("number"!=typeof e)throw new Error("invalid uint 32: "+typeof e);if(!Number.isInteger(e)||e>Cle||e<0)throw new Error("invalid uint 32: "+e)}function dB(e){if("number"!=typeof e)throw new Error("invalid float 32: "+typeof e);if(Number.isFinite(e)&&(e>Ele||e<wle))throw new Error("invalid float 32: "+e)}const fB=Symbol("@bufbuild/protobuf/enum-type");function Ile(e){const t=e[fB];return Bn(t,"missing enum type on enum object"),t}function hB(e,t,n,r){e[fB]=pB(t,n.map((t=>({no:t.no,name:t.name,localName:e[t.no]}))))}function pB(e,t,n){const r=Object.create(null),i=Object.create(null),o=[];for(const e of t){const t=mB(e);o.push(t),r[e.name]=t,i[e.no]=t}return{typeName:e,values:o,findName:e=>r[e],findNumber:e=>i[e]}}function kle(e,t,n){const r={};for(const e of t){const t=mB(e);r[t.localName]=t.no,r[t.no]=t.localName}return hB(r,e,t),r}function mB(e){return"localName"in e?e:Object.assign(Object.assign({},e),{localName:e.name})}class oL{equals(e){return this.getType().runtime.util.equals(this.getType(),this,e)}clone(){return this.getType().runtime.util.clone(this)}fromBinary(e,t){const n=this.getType().runtime.bin,r=n.makeReadOptions(t);return n.readMessage(this,r.readerFactory(e),e.byteLength,r),this}fromJson(e,t){const n=this.getType(),r=n.runtime.json,i=r.makeReadOptions(t);return r.readMessage(n,e,i,this),this}fromJsonString(e,t){let n;try{n=JSON.parse(e)}catch(e){throw new Error("cannot decode ".concat(this.getType().typeName," from JSON: ").concat(e instanceof Error?e.message:String(e)))}return this.fromJson(n,t)}toBinary(e){const t=this.getType().runtime.bin,n=t.makeWriteOptions(e),r=n.writerFactory();return t.writeMessage(this,r,n),r.finish()}toJson(e){const t=this.getType().runtime.json,n=t.makeWriteOptions(e);return t.writeMessage(this,n)}toJsonString(e){var t;const n=this.toJson(e);return JSON.stringify(n,null,null!==(t=null==e?void 0:e.prettySpaces)&&void 0!==t?t:0)}toJSON(){return this.toJson({emitDefaultValues:!0})}getType(){return Object.getPrototypeOf(this).constructor}}function xle(e,t,n,r){var i;const o=null!==(i=null==r?void 0:r.localName)&&void 0!==i?i:t.substring(t.lastIndexOf(".")+1),s={[o]:function(t){e.util.initFields(this),e.util.initPartial(t,this)}}[o];return Object.setPrototypeOf(s.prototype,new oL),Object.assign(s,{runtime:e,typeName:t,fields:e.util.newFieldList(n),fromBinary:(e,t)=>(new s).fromBinary(e,t),fromJson:(e,t)=>(new s).fromJson(e,t),fromJsonString:(e,t)=>(new s).fromJsonString(e,t),equals:(t,n)=>e.util.equals(s,t,n)}),s}function Ple(){let e=0,t=0;for(let n=0;n<28;n+=7){let r=this.buf[this.pos++];if(e|=(127&r)<<n,!(128&r))return this.assertBounds(),[e,t]}let n=this.buf[this.pos++];if(e|=(15&n)<<28,t=(112&n)>>4,!(128&n))return this.assertBounds(),[e,t];for(let n=3;n<=31;n+=7){let r=this.buf[this.pos++];if(t|=(127&r)<<n,!(128&r))return this.assertBounds(),[e,t]}throw new Error("invalid varint")}function y2(e,t,n){for(let r=0;r<28;r+=7){const i=e>>>r,o=!(!(i>>>7)&&0==t),s=255&(o?128|i:i);if(n.push(s),!o)return}const r=e>>>28&15|(7&t)<<4,i=!!(t>>3);if(n.push(255&(i?128|r:r)),i){for(let e=3;e<31;e+=7){const r=t>>>e,i=!!(r>>>7),o=255&(i?128|r:r);if(n.push(o),!i)return}n.push(t>>>31&1)}}const G_=4294967296;function JN(e){const t="-"===e[0];t&&(e=e.slice(1));const n=1e6;let r=0,i=0;function o(t,o){const s=Number(e.slice(t,o));i*=n,r=r*n+s,r>=G_&&(i+=r/G_|0,r%=G_)}return o(-24,-18),o(-18,-12),o(-12,-6),o(-6),t?vB(r,i):aL(r,i)}function Lle(e,t){let n=aL(e,t);const r=2147483648&n.hi;r&&(n=vB(n.lo,n.hi));const i=gB(n.lo,n.hi);return r?"-"+i:i}function gB(e,t){if(({lo:e,hi:t}=Ole(e,t)),t<=2097151)return String(G_*t+e);const n=16777215&(e>>>24|t<<8),r=t>>16&65535;let i=(16777215&e)+6777216*n+6710656*r,o=n+8147497*r,s=2*r;const a=1e7;return i>=a&&(o+=Math.floor(i/a),i%=a),o>=a&&(s+=Math.floor(o/a),o%=a),s.toString()+XN(o)+XN(i)}function Ole(e,t){return{lo:e>>>0,hi:t>>>0}}function aL(e,t){return{lo:0|e,hi:0|t}}function vB(e,t){return t=~t,e?e=1+~e:t+=1,aL(e,t)}const XN=e=>{const t=String(e);return"0000000".slice(t.length)+t};function ZN(e,t){if(e>=0){for(;e>127;)t.push(127&e|128),e>>>=7;t.push(e)}else{for(let n=0;n<9;n++)t.push(127&e|128),e>>=7;t.push(1)}}function Mle(){let e=this.buf[this.pos++],t=127&e;if(!(128&e))return this.assertBounds(),t;if(e=this.buf[this.pos++],t|=(127&e)<<7,!(128&e))return this.assertBounds(),t;if(e=this.buf[this.pos++],t|=(127&e)<<14,!(128&e))return this.assertBounds(),t;if(e=this.buf[this.pos++],t|=(127&e)<<21,!(128&e))return this.assertBounds(),t;e=this.buf[this.pos++],t|=(15&e)<<28;for(let t=5;128&e&&t<10;t++)e=this.buf[this.pos++];if(128&e)throw new Error("invalid varint");return this.assertBounds(),t>>>0}function Ale(){const e=new DataView(new ArrayBuffer(8));if("function"==typeof BigInt&&"function"==typeof e.getBigInt64&&"function"==typeof e.getBigUint64&&"function"==typeof e.setBigInt64&&"function"==typeof e.setBigUint64&&("object"!=typeof process||"object"!=typeof zN||"1"!==zN.BUF_BIGINT_DISABLE)){const t=BigInt("-9223372036854775808"),n=BigInt("9223372036854775807"),r=BigInt("0"),i=BigInt("18446744073709551615");return{zero:BigInt(0),supported:!0,parse(e){const r="bigint"==typeof e?e:BigInt(e);if(r>n||r<t)throw new Error("int64 invalid: ".concat(e));return r},uParse(e){const t="bigint"==typeof e?e:BigInt(e);if(t>i||t<r)throw new Error("uint64 invalid: ".concat(e));return t},enc(t){return e.setBigInt64(0,this.parse(t),!0),{lo:e.getInt32(0,!0),hi:e.getInt32(4,!0)}},uEnc(t){return e.setBigInt64(0,this.uParse(t),!0),{lo:e.getInt32(0,!0),hi:e.getInt32(4,!0)}},dec:(t,n)=>(e.setInt32(0,t,!0),e.setInt32(4,n,!0),e.getBigInt64(0,!0)),uDec:(t,n)=>(e.setInt32(0,t,!0),e.setInt32(4,n,!0),e.getBigUint64(0,!0))}}const t=e=>Bn(/^-?[0-9]+$/.test(e),"int64 invalid: ".concat(e)),n=e=>Bn(/^[0-9]+$/.test(e),"uint64 invalid: ".concat(e));return{zero:"0",supported:!1,parse:e=>("string"!=typeof e&&(e=e.toString()),t(e),e),uParse:e=>("string"!=typeof e&&(e=e.toString()),n(e),e),enc:e=>("string"!=typeof e&&(e=e.toString()),t(e),JN(e)),uEnc:e=>("string"!=typeof e&&(e=e.toString()),n(e),JN(e)),dec:(e,t)=>Lle(e,t),uDec:(e,t)=>gB(e,t)}}const kn=Ale();var he,cu,Jn;function _c(e,t,n){if(t===n)return!0;if(e==he.BYTES){if(!(t instanceof Uint8Array&&n instanceof Uint8Array&&t.length===n.length))return!1;for(let e=0;e<t.length;e++)if(t[e]!==n[e])return!1;return!0}switch(e){case he.UINT64:case he.FIXED64:case he.INT64:case he.SFIXED64:case he.SINT64:return t==n}return!1}function dp(e,t){switch(e){case he.BOOL:return!1;case he.UINT64:case he.FIXED64:case he.INT64:case he.SFIXED64:case he.SINT64:return 0==t?kn.zero:"0";case he.DOUBLE:case he.FLOAT:return 0;case he.BYTES:return new Uint8Array(0);case he.STRING:return"";default:return 0}}function yB(e,t){switch(e){case he.BOOL:return!1===t;case he.STRING:return""===t;case he.BYTES:return t instanceof Uint8Array&&!t.byteLength;default:return 0==t}}!function(e){e[e.DOUBLE=1]="DOUBLE",e[e.FLOAT=2]="FLOAT",e[e.INT64=3]="INT64",e[e.UINT64=4]="UINT64",e[e.INT32=5]="INT32",e[e.FIXED64=6]="FIXED64",e[e.FIXED32=7]="FIXED32",e[e.BOOL=8]="BOOL",e[e.STRING=9]="STRING",e[e.BYTES=12]="BYTES",e[e.UINT32=13]="UINT32",e[e.SFIXED32=15]="SFIXED32",e[e.SFIXED64=16]="SFIXED64",e[e.SINT32=17]="SINT32",e[e.SINT64=18]="SINT64"}(he||(he={})),function(e){e[e.BIGINT=0]="BIGINT",e[e.STRING=1]="STRING"}(cu||(cu={})),function(e){e[e.Varint=0]="Varint",e[e.Bit64=1]="Bit64",e[e.LengthDelimited=2]="LengthDelimited",e[e.StartGroup=3]="StartGroup",e[e.EndGroup=4]="EndGroup",e[e.Bit32=5]="Bit32"}(Jn||(Jn={}));class Nle{constructor(e){this.stack=[],this.textEncoder=e??new TextEncoder,this.chunks=[],this.buf=[]}finish(){this.chunks.push(new Uint8Array(this.buf));let e=0;for(let t=0;t<this.chunks.length;t++)e+=this.chunks[t].length;let t=new Uint8Array(e),n=0;for(let e=0;e<this.chunks.length;e++)t.set(this.chunks[e],n),n+=this.chunks[e].length;return this.chunks=[],t}fork(){return this.stack.push({chunks:this.chunks,buf:this.buf}),this.chunks=[],this.buf=[],this}join(){let e=this.finish(),t=this.stack.pop();if(!t)throw new Error("invalid state, fork stack empty");return this.chunks=t.chunks,this.buf=t.buf,this.uint32(e.byteLength),this.raw(e)}tag(e,t){return this.uint32((e<<3|t)>>>0)}raw(e){return this.buf.length&&(this.chunks.push(new Uint8Array(this.buf)),this.buf=[]),this.chunks.push(e),this}uint32(e){for(Hk(e);e>127;)this.buf.push(127&e|128),e>>>=7;return this.buf.push(e),this}int32(e){return K_(e),ZN(e,this.buf),this}bool(e){return this.buf.push(e?1:0),this}bytes(e){return this.uint32(e.byteLength),this.raw(e)}string(e){let t=this.textEncoder.encode(e);return this.uint32(t.byteLength),this.raw(t)}float(e){dB(e);let t=new Uint8Array(4);return new DataView(t.buffer).setFloat32(0,e,!0),this.raw(t)}double(e){let t=new Uint8Array(8);return new DataView(t.buffer).setFloat64(0,e,!0),this.raw(t)}fixed32(e){Hk(e);let t=new Uint8Array(4);return new DataView(t.buffer).setUint32(0,e,!0),this.raw(t)}sfixed32(e){K_(e);let t=new Uint8Array(4);return new DataView(t.buffer).setInt32(0,e,!0),this.raw(t)}sint32(e){return K_(e),ZN(e=(e<<1^e>>31)>>>0,this.buf),this}sfixed64(e){let t=new Uint8Array(8),n=new DataView(t.buffer),r=kn.enc(e);return n.setInt32(0,r.lo,!0),n.setInt32(4,r.hi,!0),this.raw(t)}fixed64(e){let t=new Uint8Array(8),n=new DataView(t.buffer),r=kn.uEnc(e);return n.setInt32(0,r.lo,!0),n.setInt32(4,r.hi,!0),this.raw(t)}int64(e){let t=kn.enc(e);return y2(t.lo,t.hi,this.buf),this}sint64(e){let t=kn.enc(e),n=t.hi>>31;return y2(t.lo<<1^n,(t.hi<<1|t.lo>>>31)^n,this.buf),this}uint64(e){let t=kn.uEnc(e);return y2(t.lo,t.hi,this.buf),this}}class Dle{constructor(e,t){this.varint64=Ple,this.uint32=Mle,this.buf=e,this.len=e.length,this.pos=0,this.view=new DataView(e.buffer,e.byteOffset,e.byteLength),this.textDecoder=t??new TextDecoder}tag(){let e=this.uint32(),t=e>>>3,n=7&e;if(t<=0||n<0||n>5)throw new Error("illegal tag: field no "+t+" wire type "+n);return[t,n]}skip(e,t){let n=this.pos;switch(e){case Jn.Varint:for(;128&this.buf[this.pos++];);break;case Jn.Bit64:this.pos+=4;case Jn.Bit32:this.pos+=4;break;case Jn.LengthDelimited:let n=this.uint32();this.pos+=n;break;case Jn.StartGroup:for(;;){const[e,n]=this.tag();if(n===Jn.EndGroup){if(void 0!==t&&e!==t)throw new Error("invalid end group tag");break}this.skip(n,e)}break;default:throw new Error("cant skip wire type "+e)}return this.assertBounds(),this.buf.subarray(n,this.pos)}assertBounds(){if(this.pos>this.len)throw new RangeError("premature EOF")}int32(){return 0|this.uint32()}sint32(){let e=this.uint32();return e>>>1^-(1&e)}int64(){return kn.dec(...this.varint64())}uint64(){return kn.uDec(...this.varint64())}sint64(){let[e,t]=this.varint64(),n=-(1&e);return e=(e>>>1|(1&t)<<31)^n,t=t>>>1^n,kn.dec(e,t)}bool(){let[e,t]=this.varint64();return 0!==e||0!==t}fixed32(){return this.view.getUint32((this.pos+=4)-4,!0)}sfixed32(){return this.view.getInt32((this.pos+=4)-4,!0)}fixed64(){return kn.uDec(this.sfixed32(),this.sfixed32())}sfixed64(){return kn.dec(this.sfixed32(),this.sfixed32())}float(){return this.view.getFloat32((this.pos+=4)-4,!0)}double(){return this.view.getFloat64((this.pos+=8)-8,!0)}bytes(){let e=this.uint32(),t=this.pos;return this.pos+=e,this.assertBounds(),this.buf.subarray(t,t+e)}string(){return this.textDecoder.decode(this.bytes())}}function jle(e,t,n,r){let i;return{typeName:t,extendee:n,get field(){if(!i){const n="function"==typeof r?r():r;n.name=t.split(".").pop(),n.jsonName="[".concat(t,"]"),i=e.util.newFieldList([n]).list()[0]}return i},runtime:e}}function _B(e){const t=e.field.localName,n=Object.create(null);return n[t]=Ule(e),[n,()=>n[t]]}function Ule(e){const t=e.field;if(t.repeated)return[];if(void 0!==t.default)return t.default;switch(t.kind){case"enum":return t.T.values[0].no;case"scalar":return dp(t.T,t.L);case"message":const e=t.T,n=new e;return e.fieldWrapper?e.fieldWrapper.unwrapField(n):n;case"map":throw"map fields are not allowed to be extensions"}}function Fle(e,t){if(!t.repeated&&("enum"==t.kind||"scalar"==t.kind)){for(let n=e.length-1;n>=0;--n)if(e[n].no==t.no)return[e[n]];return[]}return e.filter((e=>e.no===t.no))}let pl="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".split(""),$E=[];for(let e=0;e<pl.length;e++)$E[pl[e].charCodeAt(0)]=e;$E[45]=pl.indexOf("+"),$E[95]=pl.indexOf("/");const bB={dec(e){let t=3*e.length/4;"="==e[e.length-2]?t-=2:"="==e[e.length-1]&&(t-=1);let n,r=new Uint8Array(t),i=0,o=0,s=0;for(let t=0;t<e.length;t++){if(n=$E[e.charCodeAt(t)],void 0===n)switch(e[t]){case"=":o=0;case"\n":case"\r":case"\t":case" ":continue;default:throw Error("invalid base64 string.")}switch(o){case 0:s=n,o=1;break;case 1:r[i++]=s<<2|(48&n)>>4,s=n,o=2;break;case 2:r[i++]=(15&s)<<4|(60&n)>>2,s=n,o=3;break;case 3:r[i++]=(3&s)<<6|n,o=0}}if(1==o)throw Error("invalid base64 string.");return r.subarray(0,i)},enc(e){let t,n="",r=0,i=0;for(let o=0;o<e.length;o++)switch(t=e[o],r){case 0:n+=pl[t>>2],i=(3&t)<<4,r=1;break;case 1:n+=pl[i|t>>4],i=(15&t)<<2,r=2;break;case 2:n+=pl[i|t>>6],n+=pl[63&t],r=0}return r&&(n+=pl[i],n+="=",1==r&&(n+="=")),n}};function $le(e,t,n){EB(t,e);const r=t.runtime.bin.makeReadOptions(n),i=Fle(e.getType().runtime.bin.listUnknownFields(e),t.field),[o,s]=_B(t);for(const e of i)t.runtime.bin.readField(o,r.readerFactory(e.data),t.field,e.wireType,r);return s()}function Hle(e,t,n,r){EB(t,e);const i=t.runtime.bin.makeReadOptions(r),o=t.runtime.bin.makeWriteOptions(r);if(SB(e,t)){const n=e.getType().runtime.bin.listUnknownFields(e).filter((e=>e.no!=t.field.no));e.getType().runtime.bin.discardUnknownFields(e);for(const t of n)e.getType().runtime.bin.onUnknownField(e,t.no,t.wireType,t.data)}const s=o.writerFactory();let a=t.field;!a.opt&&!a.repeated&&("enum"==a.kind||"scalar"==a.kind)&&(a=Object.assign(Object.assign({},t.field),{opt:!0})),t.runtime.bin.writeField(a,n,s,o);const l=i.readerFactory(s.finish());for(;l.pos<l.len;){const[t,n]=l.tag(),r=l.skip(n,t);e.getType().runtime.bin.onUnknownField(e,t,n,r)}}function SB(e,t){const n=e.getType();return t.extendee.typeName===n.typeName&&!!n.runtime.bin.listUnknownFields(e).find((e=>e.no==t.field.no))}function EB(e,t){Bn(e.extendee.typeName==t.getType().typeName,"extension ".concat(e.typeName," can only be applied to message ").concat(e.extendee.typeName))}function wB(e,t){const n=e.localName;if(e.repeated)return t[n].length>0;if(e.oneof)return t[e.oneof.localName].case===n;switch(e.kind){case"enum":case"scalar":return e.opt||e.req?void 0!==t[n]:"enum"==e.kind?t[n]!==e.T.values[0].no:!yB(e.T,t[n]);case"message":return void 0!==t[n];case"map":return Object.keys(t[n]).length>0}}function QN(e,t){const n=e.localName,r=!e.opt&&!e.req;if(e.repeated)t[n]=[];else if(e.oneof)t[e.oneof.localName]={case:void 0};else switch(e.kind){case"map":t[n]={};break;case"enum":t[n]=r?e.T.values[0].no:void 0;break;case"scalar":t[n]=r?dp(e.T,e.L):void 0;break;case"message":t[n]=void 0}}function Ed(e,t){if(null===e||"object"!=typeof e||!Object.getOwnPropertyNames(oL.prototype).every((t=>t in e&&"function"==typeof e[t])))return!1;const n=e.getType();return null!==n&&"function"==typeof n&&"typeName"in n&&"string"==typeof n.typeName&&(void 0===t||n.typeName==t.typeName)}function CB(e,t){return Ed(t)||!e.fieldWrapper?t:e.fieldWrapper.wrapField(t)}he.DOUBLE,he.FLOAT,he.INT64,he.UINT64,he.INT32,he.UINT32,he.BOOL,he.STRING,he.BYTES;const e8={ignoreUnknownFields:!1},t8={emitDefaultValues:!1,enumAsInteger:!1,useProtoFieldName:!1,prettySpaces:0};function Ble(e){return e?Object.assign(Object.assign({},e8),e):e8}function Vle(e){return e?Object.assign(Object.assign({},t8),e):t8}const sS=Symbol(),W_=Symbol();function qle(){return{makeReadOptions:Ble,makeWriteOptions:Vle,readMessage(e,t,n,r){if(null==t||Array.isArray(t)||"object"!=typeof t)throw new Error("cannot decode message ".concat(e.typeName," from JSON: ").concat(da(t)));r=r??new e;const i=new Map,o=n.typeRegistry;for(const[s,a]of Object.entries(t)){const t=e.fields.findJsonName(s);if(t){if(t.oneof){if(null===a&&"scalar"==t.kind)continue;const n=i.get(t.oneof);if(void 0!==n)throw new Error("cannot decode message ".concat(e.typeName,' from JSON: multiple keys for oneof "').concat(t.oneof.name,'" present: "').concat(n,'", "').concat(s,'"'));i.set(t.oneof,s)}n8(r,a,t,n,e)}else{let t=!1;if(null!=o&&o.findExtension&&s.startsWith("[")&&s.endsWith("]")){const i=o.findExtension(s.substring(1,s.length-1));if(i&&i.extendee.typeName==e.typeName){t=!0;const[e,o]=_B(i);n8(e,a,i.field,n,i),Hle(r,i,o(),n)}}if(!t&&!n.ignoreUnknownFields)throw new Error("cannot decode message ".concat(e.typeName,' from JSON: key "').concat(s,'" is unknown'))}}return r},writeMessage(e,t){const n=e.getType(),r={};let i;try{for(i of n.fields.byNumber()){if(!wB(i,e)){if(i.req)throw"required field not set";if(!t.emitDefaultValues||!Gle(i))continue}const n=r8(i,i.oneof?e[i.oneof.localName].value:e[i.localName],t);void 0!==n&&(r[t.useProtoFieldName?i.name:i.jsonName]=n)}const o=t.typeRegistry;if(null!=o&&o.findExtensionFor)for(const i of n.runtime.bin.listUnknownFields(e)){const s=o.findExtensionFor(n.typeName,i.no);if(s&&SB(e,s)){const n=$le(e,s,t),i=r8(s.field,n,t);void 0!==i&&(r[s.field.jsonName]=i)}}}catch(e){const t=i?"cannot encode field ".concat(n.typeName,".").concat(i.name," to JSON"):"cannot encode message ".concat(n.typeName," to JSON"),r=e instanceof Error?e.message:String(e);throw new Error(t+(r.length>0?": ".concat(r):""))}return r},readScalar:(e,t,n)=>Yg(e,t,n??cu.BIGINT,!0),writeScalar(e,t,n){if(void 0!==t&&(n||yB(e,t)))return z_(e,t)},debug:da}}function da(e){if(null===e)return"null";switch(typeof e){case"object":return Array.isArray(e)?"array":"object";case"string":return e.length>100?"string":'"'.concat(e.split('"').join('\\"'),'"');default:return String(e)}}function n8(e,t,n,r,i){let o=n.localName;if(n.repeated){if(Bn("map"!=n.kind),null===t)return;if(!Array.isArray(t))throw new Error("cannot decode field ".concat(i.typeName,".").concat(n.name," from JSON: ").concat(da(t)));const s=e[o];for(const e of t){if(null===e)throw new Error("cannot decode field ".concat(i.typeName,".").concat(n.name," from JSON: ").concat(da(e)));switch(n.kind){case"message":s.push(n.T.fromJson(e,r));break;case"enum":const t=_2(n.T,e,r.ignoreUnknownFields,!0);t!==W_&&s.push(t);break;case"scalar":try{s.push(Yg(n.T,e,n.L,!0))}catch(t){let r="cannot decode field ".concat(i.typeName,".").concat(n.name," from JSON: ").concat(da(e));throw t instanceof Error&&t.message.length>0&&(r+=": ".concat(t.message)),new Error(r)}}}}else if("map"==n.kind){if(null===t)return;if("object"!=typeof t||Array.isArray(t))throw new Error("cannot decode field ".concat(i.typeName,".").concat(n.name," from JSON: ").concat(da(t)));const s=e[o];for(const[e,o]of Object.entries(t)){if(null===o)throw new Error("cannot decode field ".concat(i.typeName,".").concat(n.name," from JSON: map value null"));let a;try{a=Kle(n.K,e)}catch(e){let r="cannot decode map key for field ".concat(i.typeName,".").concat(n.name," from JSON: ").concat(da(t));throw e instanceof Error&&e.message.length>0&&(r+=": ".concat(e.message)),new Error(r)}switch(n.V.kind){case"message":s[a]=n.V.T.fromJson(o,r);break;case"enum":const e=_2(n.V.T,o,r.ignoreUnknownFields,!0);e!==W_&&(s[a]=e);break;case"scalar":try{s[a]=Yg(n.V.T,o,cu.BIGINT,!0)}catch(e){let r="cannot decode map value for field ".concat(i.typeName,".").concat(n.name," from JSON: ").concat(da(t));throw e instanceof Error&&e.message.length>0&&(r+=": ".concat(e.message)),new Error(r)}}}}else switch(n.oneof&&(e=e[n.oneof.localName]={case:o},o="value"),n.kind){case"message":const s=n.T;if(null===t&&"google.protobuf.Value"!=s.typeName)return;let a=e[o];Ed(a)?a.fromJson(t,r):(e[o]=a=s.fromJson(t,r),s.fieldWrapper&&!n.oneof&&(e[o]=s.fieldWrapper.unwrapField(a)));break;case"enum":const l=_2(n.T,t,r.ignoreUnknownFields,!1);switch(l){case sS:QN(n,e);break;case W_:break;default:e[o]=l}break;case"scalar":try{const r=Yg(n.T,t,n.L,!1);if(r===sS)QN(n,e);else e[o]=r}catch(e){let r="cannot decode field ".concat(i.typeName,".").concat(n.name," from JSON: ").concat(da(t));throw e instanceof Error&&e.message.length>0&&(r+=": ".concat(e.message)),new Error(r)}}}function Kle(e,t){if(e===he.BOOL)switch(t){case"true":t=!0;break;case"false":t=!1}return Yg(e,t,cu.BIGINT,!0).toString()}function Yg(e,t,n,r){if(null===t)return r?dp(e,n):sS;switch(e){case he.DOUBLE:case he.FLOAT:if("NaN"===t)return Number.NaN;if("Infinity"===t)return Number.POSITIVE_INFINITY;if("-Infinity"===t)return Number.NEGATIVE_INFINITY;if(""===t||"string"==typeof t&&t.trim().length!==t.length||"string"!=typeof t&&"number"!=typeof t)break;const r=Number(t);if(Number.isNaN(r)||!Number.isFinite(r))break;return e==he.FLOAT&&dB(r),r;case he.INT32:case he.FIXED32:case he.SFIXED32:case he.SINT32:case he.UINT32:let i;if("number"==typeof t?i=t:"string"==typeof t&&t.length>0&&t.trim().length===t.length&&(i=Number(t)),void 0===i)break;return e==he.UINT32||e==he.FIXED32?Hk(i):K_(i),i;case he.INT64:case he.SFIXED64:case he.SINT64:if("number"!=typeof t&&"string"!=typeof t)break;const o=kn.parse(t);return n?o.toString():o;case he.FIXED64:case he.UINT64:if("number"!=typeof t&&"string"!=typeof t)break;const s=kn.uParse(t);return n?s.toString():s;case he.BOOL:if("boolean"!=typeof t)break;return t;case he.STRING:if("string"!=typeof t)break;try{encodeURIComponent(t)}catch{throw new Error("invalid UTF8")}return t;case he.BYTES:if(""===t)return new Uint8Array(0);if("string"!=typeof t)break;return bB.dec(t)}throw new Error}function _2(e,t,n,r){if(null===t)return"google.protobuf.NullValue"==e.typeName?0:r?e.values[0].no:sS;switch(typeof t){case"number":if(Number.isInteger(t))return t;break;case"string":const r=e.findName(t);if(void 0!==r)return r.no;if(n)return W_}throw new Error("cannot decode enum ".concat(e.typeName," from JSON: ").concat(da(t)))}function Gle(e){return!(!e.repeated&&"map"!=e.kind)||!(e.oneof||"message"==e.kind||e.opt||e.req)}function r8(e,t,n){if("map"==e.kind){Bn("object"==typeof t&&null!=t);const r={},i=Object.entries(t);switch(e.V.kind){case"scalar":for(const[t,n]of i)r[t.toString()]=z_(e.V.T,n);break;case"message":for(const[e,t]of i)r[e.toString()]=t.toJson(n);break;case"enum":const t=e.V.T;for(const[e,o]of i)r[e.toString()]=b2(t,o,n.enumAsInteger)}return n.emitDefaultValues||i.length>0?r:void 0}if(e.repeated){Bn(Array.isArray(t));const r=[];switch(e.kind){case"scalar":for(let n=0;n<t.length;n++)r.push(z_(e.T,t[n]));break;case"enum":for(let i=0;i<t.length;i++)r.push(b2(e.T,t[i],n.enumAsInteger));break;case"message":for(let e=0;e<t.length;e++)r.push(t[e].toJson(n))}return n.emitDefaultValues||r.length>0?r:void 0}switch(e.kind){case"scalar":return z_(e.T,t);case"enum":return b2(e.T,t,n.enumAsInteger);case"message":return CB(e.T,t).toJson(n)}}function b2(e,t,n){var r;if(Bn("number"==typeof t),"google.protobuf.NullValue"==e.typeName)return null;if(n)return t;const i=e.findNumber(t);return null!==(r=null==i?void 0:i.name)&&void 0!==r?r:t}function z_(e,t){switch(e){case he.INT32:case he.SFIXED32:case he.SINT32:case he.FIXED32:case he.UINT32:return Bn("number"==typeof t),t;case he.FLOAT:case he.DOUBLE:return Bn("number"==typeof t),Number.isNaN(t)?"NaN":t===Number.POSITIVE_INFINITY?"Infinity":t===Number.NEGATIVE_INFINITY?"-Infinity":t;case he.STRING:return Bn("string"==typeof t),t;case he.BOOL:return Bn("boolean"==typeof t),t;case he.UINT64:case he.FIXED64:case he.INT64:case he.SFIXED64:case he.SINT64:return Bn("bigint"==typeof t||"string"==typeof t||"number"==typeof t),t.toString();case he.BYTES:return Bn(t instanceof Uint8Array),bB.enc(t)}}const Gf=Symbol("@bufbuild/protobuf/unknown-fields"),i8={readUnknownFields:!0,readerFactory:e=>new Dle(e)},s8={writeUnknownFields:!0,writerFactory:()=>new Nle};function Wle(e){return e?Object.assign(Object.assign({},i8),e):i8}function zle(e){return e?Object.assign(Object.assign({},s8),e):s8}function Yle(){return{makeReadOptions:Wle,makeWriteOptions:zle,listUnknownFields(e){var t;return null!==(t=e[Gf])&&void 0!==t?t:[]},discardUnknownFields(e){delete e[Gf]},writeUnknownFields(e,t){const n=e[Gf];if(n)for(const e of n)t.tag(e.no,e.wireType).raw(e.data)},onUnknownField(e,t,n,r){const i=e;Array.isArray(i[Gf])||(i[Gf]=[]),i[Gf].push({no:t,wireType:n,data:r})},readMessage(e,t,n,r,i){const o=e.getType(),s=i?t.len:t.pos+n;let a,l;for(;t.pos<s&&([a,l]=t.tag(),!0!==i||l!=Jn.EndGroup);){const n=o.fields.find(a);if(n)o8(e,t,n,l,r);else{const n=t.skip(l,a);r.readUnknownFields&&this.onUnknownField(e,a,l,n)}}if(i&&(l!=Jn.EndGroup||a!==n))throw new Error("invalid end group tag")},readField:o8,writeMessage(e,t,n){const r=e.getType();for(const i of r.fields.byNumber()){if(!wB(i,e)){if(i.req)throw new Error("cannot encode field ".concat(r.typeName,".").concat(i.name," to binary: required field not set"));continue}a8(i,i.oneof?e[i.oneof.localName].value:e[i.localName],t,n)}return n.writeUnknownFields&&this.writeUnknownFields(e,t),t},writeField(e,t,n,r){void 0!==t&&a8(e,t,n,r)}}}function o8(e,t,n,r,i){let{repeated:o,localName:s}=n;switch(n.oneof&&((e=e[n.oneof.localName]).case!=s&&delete e.value,e.case=s,s="value"),n.kind){case"scalar":case"enum":const a="enum"==n.kind?he.INT32:n.T;let l=oS;if("scalar"==n.kind&&n.L>0&&(l=Xle),o){let n=e[s];if(r==Jn.LengthDelimited&&a!=he.STRING&&a!=he.BYTES){let e=t.uint32()+t.pos;for(;t.pos<e;)n.push(l(t,a))}else n.push(l(t,a))}else e[s]=l(t,a);break;case"message":const c=n.T;o?e[s].push(Y_(t,new c,i,n)):Ed(e[s])?Y_(t,e[s],i,n):(e[s]=Y_(t,new c,i,n),c.fieldWrapper&&!n.oneof&&!n.repeated&&(e[s]=c.fieldWrapper.unwrapField(e[s])));break;case"map":let[u,d]=Jle(n,t,i);e[s][u]=d}}function Y_(e,t,n,r){const i=t.getType().runtime.bin,o=null==r?void 0:r.delimited;return i.readMessage(t,e,o?r.no:e.uint32(),n,o),t}function Jle(e,t,n){const r=t.uint32(),i=t.pos+r;let o,s;for(;t.pos<i;){const[r]=t.tag();switch(r){case 1:o=oS(t,e.K);break;case 2:switch(e.V.kind){case"scalar":s=oS(t,e.V.T);break;case"enum":s=t.int32();break;case"message":s=Y_(t,new e.V.T,n,void 0)}}}if(void 0===o&&(o=dp(e.K,cu.BIGINT)),"string"!=typeof o&&"number"!=typeof o&&(o=o.toString()),void 0===s)switch(e.V.kind){case"scalar":s=dp(e.V.T,cu.BIGINT);break;case"enum":s=e.V.T.values[0].no;break;case"message":s=new e.V.T}return[o,s]}function Xle(e,t){const n=oS(e,t);return"bigint"==typeof n?n.toString():n}function oS(e,t){switch(t){case he.STRING:return e.string();case he.BOOL:return e.bool();case he.DOUBLE:return e.double();case he.FLOAT:return e.float();case he.INT32:return e.int32();case he.INT64:return e.int64();case he.UINT64:return e.uint64();case he.FIXED64:return e.fixed64();case he.BYTES:return e.bytes();case he.FIXED32:return e.fixed32();case he.SFIXED32:return e.sfixed32();case he.SFIXED64:return e.sfixed64();case he.SINT64:return e.sint64();case he.UINT32:return e.uint32();case he.SINT32:return e.sint32()}}function a8(e,t,n,r){Bn(void 0!==t);const i=e.repeated;switch(e.kind){case"scalar":case"enum":let o="enum"==e.kind?he.INT32:e.T;if(i)if(Bn(Array.isArray(t)),e.packed)Qle(n,o,e.no,t);else for(const r of t)Jg(n,o,e.no,r);else Jg(n,o,e.no,t);break;case"message":if(i){Bn(Array.isArray(t));for(const i of t)l8(n,r,e,i)}else l8(n,r,e,t);break;case"map":Bn("object"==typeof t&&null!=t);for(const[i,o]of Object.entries(t))Zle(n,r,e,i,o)}}function Zle(e,t,n,r,i){e.tag(n.no,Jn.LengthDelimited),e.fork();let o=r;switch(n.K){case he.INT32:case he.FIXED32:case he.UINT32:case he.SFIXED32:case he.SINT32:o=Number.parseInt(r);break;case he.BOOL:Bn("true"==r||"false"==r),o="true"==r}switch(Jg(e,n.K,1,o),n.V.kind){case"scalar":Jg(e,n.V.T,2,i);break;case"enum":Jg(e,he.INT32,2,i);break;case"message":Bn(void 0!==i),e.tag(2,Jn.LengthDelimited).bytes(i.toBinary(t))}e.join()}function l8(e,t,n,r){const i=CB(n.T,r);n.delimited?e.tag(n.no,Jn.StartGroup).raw(i.toBinary(t)).tag(n.no,Jn.EndGroup):e.tag(n.no,Jn.LengthDelimited).bytes(i.toBinary(t))}function Jg(e,t,n,r){Bn(void 0!==r);let[i,o]=TB(t);e.tag(n,i)[o](r)}function Qle(e,t,n,r){if(!r.length)return;e.tag(n,Jn.LengthDelimited).fork();let[,i]=TB(t);for(let t=0;t<r.length;t++)e[i](r[t]);e.join()}function TB(e){let t=Jn.Varint;switch(e){case he.BYTES:case he.STRING:t=Jn.LengthDelimited;break;case he.DOUBLE:case he.FIXED64:case he.SFIXED64:t=Jn.Bit64;break;case he.FIXED32:case he.SFIXED32:case he.FLOAT:t=Jn.Bit32}return[t,he[e].toLowerCase()]}function ece(){return{setEnumType:hB,initPartial(e,t){if(void 0===e)return;const n=t.getType();for(const r of n.fields.byMember()){const n=r.localName,i=t,o=e;if(null!=o[n])switch(r.kind){case"oneof":const e=o[n].case;if(void 0===e)continue;const t=r.findField(e);let s=o[n].value;t&&"message"==t.kind&&!Ed(s,t.T)?s=new t.T(s):t&&"scalar"===t.kind&&t.T===he.BYTES&&(s=ng(s)),i[n]={case:e,value:s};break;case"scalar":case"enum":let a=o[n];r.T===he.BYTES&&(a=r.repeated?a.map(ng):ng(a)),i[n]=a;break;case"map":switch(r.V.kind){case"scalar":case"enum":if(r.V.T===he.BYTES)for(const[e,t]of Object.entries(o[n]))i[n][e]=ng(t);else Object.assign(i[n],o[n]);break;case"message":const e=r.V.T;for(const t of Object.keys(o[n])){let r=o[n][t];e.fieldWrapper||(r=new e(r)),i[n][t]=r}}break;case"message":const l=r.T;if(r.repeated)i[n]=o[n].map((e=>Ed(e,l)?e:new l(e)));else{const e=o[n];l.fieldWrapper?"google.protobuf.BytesValue"===l.typeName?i[n]=ng(e):i[n]=e:i[n]=Ed(e,l)?e:new l(e)}}}},equals:(e,t,n)=>t===n||!(!t||!n)&&e.fields.byMember().every((e=>{const r=t[e.localName],i=n[e.localName];if(e.repeated){if(r.length!==i.length)return!1;switch(e.kind){case"message":return r.every(((t,n)=>e.T.equals(t,i[n])));case"scalar":return r.every(((t,n)=>_c(e.T,t,i[n])));case"enum":return r.every(((e,t)=>_c(he.INT32,e,i[t])))}throw new Error("repeated cannot contain ".concat(e.kind))}switch(e.kind){case"message":return e.T.equals(r,i);case"enum":return _c(he.INT32,r,i);case"scalar":return _c(e.T,r,i);case"oneof":if(r.case!==i.case)return!1;const t=e.findField(r.case);if(void 0===t)return!0;switch(t.kind){case"message":return t.T.equals(r.value,i.value);case"enum":return _c(he.INT32,r.value,i.value);case"scalar":return _c(t.T,r.value,i.value)}throw new Error("oneof cannot contain ".concat(t.kind));case"map":const n=Object.keys(r).concat(Object.keys(i));switch(e.V.kind){case"message":const t=e.V.T;return n.every((e=>t.equals(r[e],i[e])));case"enum":return n.every((e=>_c(he.INT32,r[e],i[e])));case"scalar":const o=e.V.T;return n.every((e=>_c(o,r[e],i[e])))}}})),clone(e){const t=e.getType(),n=new t,r=n;for(const n of t.fields.byMember()){const t=e[n.localName];let i;if(n.repeated)i=t.map(P1);else if("map"==n.kind){i=r[n.localName];for(const[e,n]of Object.entries(t))i[e]=P1(n)}else i="oneof"==n.kind?n.findField(t.case)?{case:t.case,value:P1(t.value)}:{case:void 0}:P1(t);r[n.localName]=i}for(const n of t.runtime.bin.listUnknownFields(e))t.runtime.bin.onUnknownField(r,n.no,n.wireType,n.data);return n}}}function P1(e){if(void 0===e)return e;if(Ed(e))return e.clone();if(e instanceof Uint8Array){const t=new Uint8Array(e.byteLength);return t.set(e),t}return e}function ng(e){return e instanceof Uint8Array?e:new Uint8Array(e)}function tce(e,t,n){return{syntax:e,json:qle(),bin:Yle(),util:Object.assign(Object.assign({},ece()),{newFieldList:t,initFields:n}),makeMessageType(e,t,n){return xle(this,e,t,n)},makeEnum:kle,makeEnumType:pB,getEnumType:Ile,makeExtension(e,t,n){return jle(this,e,t,n)}}}class nce{constructor(e,t){this._fields=e,this._normalizer=t}findJsonName(e){if(!this.jsonNames){const e={};for(const t of this.list())e[t.jsonName]=e[t.name]=t;this.jsonNames=e}return this.jsonNames[e]}find(e){if(!this.numbers){const e={};for(const t of this.list())e[t.no]=t;this.numbers=e}return this.numbers[e]}list(){return this.all||(this.all=this._normalizer(this._fields)),this.all}byNumber(){return this.numbersAsc||(this.numbersAsc=this.list().concat().sort(((e,t)=>e.no-t.no))),this.numbersAsc}byMember(){if(!this.members){this.members=[];const e=this.members;let t;for(const n of this.list())n.oneof?n.oneof!==t&&(t=n.oneof,e.push(t)):e.push(n)}return this.members}}function RB(e,t){const n=IB(e);return t?n:lce(ace(n))}function rce(e){return RB(e,!1)}const ice=IB;function IB(e){let t=!1;const n=[];for(let r=0;r<e.length;r++){let i=e.charAt(r);switch(i){case"_":t=!0;break;case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":n.push(i),t=!1;break;default:t&&(t=!1,i=i.toUpperCase()),n.push(i)}}return n.join("")}const sce=new Set(["constructor","toString","toJSON","valueOf"]),oce=new Set(["getType","clone","equals","fromBinary","fromJson","fromJsonString","toBinary","toJson","toJsonString","toObject"]),kB=e=>"".concat(e,"$"),ace=e=>oce.has(e)?kB(e):e,lce=e=>sce.has(e)?kB(e):e;class cce{constructor(e){this.kind="oneof",this.repeated=!1,this.packed=!1,this.opt=!1,this.req=!1,this.default=void 0,this.fields=[],this.name=e,this.localName=rce(e)}addField(e){Bn(e.oneof===this,"field ".concat(e.name," not one of ").concat(this.name)),this.fields.push(e)}findField(e){if(!this._lookup){this._lookup=Object.create(null);for(let e=0;e<this.fields.length;e++)this._lookup[this.fields[e].localName]=this.fields[e]}return this._lookup[e]}}function uce(e,t){var n,r,i,o,s,a;const l=[];let c;for(const t of"function"==typeof e?e():e){const e=t;if(e.localName=RB(t.name,void 0!==t.oneof),e.jsonName=null!==(n=t.jsonName)&&void 0!==n?n:ice(t.name),e.repeated=null!==(r=t.repeated)&&void 0!==r&&r,"scalar"==t.kind&&(e.L=null!==(i=t.L)&&void 0!==i?i:cu.BIGINT),e.delimited=null!==(o=t.delimited)&&void 0!==o&&o,e.req=null!==(s=t.req)&&void 0!==s&&s,e.opt=null!==(a=t.opt)&&void 0!==a&&a,void 0===t.packed&&(e.packed="enum"==t.kind||"scalar"==t.kind&&t.T!=he.BYTES&&t.T!=he.STRING),void 0!==t.oneof){const n="string"==typeof t.oneof?t.oneof:t.oneof.name;(!c||c.name!=n)&&(c=new cce(n)),e.oneof=c,c.addField(e)}l.push(e)}return l}const ce=tce("proto3",(e=>new nce(e,(e=>uce(e)))),(e=>{for(const t of e.getType().fields.byMember()){if(t.opt)continue;const n=t.localName,r=e;if(t.repeated)r[n]=[];else switch(t.kind){case"oneof":r[n]={case:void 0};break;case"enum":r[n]=0;break;case"map":r[n]={};break;case"scalar":r[n]=dp(t.T,t.L)}}}));class qi extends oL{constructor(e){super(),this.seconds=kn.zero,this.nanos=0,ce.util.initPartial(e,this)}fromJson(e,t){if("string"!=typeof e)throw new Error("cannot decode google.protobuf.Timestamp from JSON: ".concat(ce.json.debug(e)));const n=e.match(/^([0-9]{4})-([0-9]{2})-([0-9]{2})T([0-9]{2}):([0-9]{2}):([0-9]{2})(?:Z|\.([0-9]{3,9})Z|([+-][0-9][0-9]:[0-9][0-9]))$/);if(!n)throw new Error("cannot decode google.protobuf.Timestamp from JSON: invalid RFC 3339 string");const r=Date.parse(n[1]+"-"+n[2]+"-"+n[3]+"T"+n[4]+":"+n[5]+":"+n[6]+(n[8]?n[8]:"Z"));if(Number.isNaN(r))throw new Error("cannot decode google.protobuf.Timestamp from JSON: invalid RFC 3339 string");if(r<Date.parse("0001-01-01T00:00:00Z")||r>Date.parse("9999-12-31T23:59:59Z"))throw new Error("cannot decode message google.protobuf.Timestamp from JSON: must be from 0001-01-01T00:00:00Z to 9999-12-31T23:59:59Z inclusive");return this.seconds=kn.parse(r/1e3),this.nanos=0,n[7]&&(this.nanos=parseInt("1"+n[7]+"0".repeat(9-n[7].length))-1e9),this}toJson(e){const t=1e3*Number(this.seconds);if(t<Date.parse("0001-01-01T00:00:00Z")||t>Date.parse("9999-12-31T23:59:59Z"))throw new Error("cannot encode google.protobuf.Timestamp to JSON: must be from 0001-01-01T00:00:00Z to 9999-12-31T23:59:59Z inclusive");if(this.nanos<0)throw new Error("cannot encode google.protobuf.Timestamp to JSON: nanos must not be negative");let n="Z";if(this.nanos>0){const e=(this.nanos+1e9).toString().substring(1);n="000000"===e.substring(3)?"."+e.substring(0,3)+"Z":"000"===e.substring(6)?"."+e.substring(0,6)+"Z":"."+e+"Z"}return new Date(t).toISOString().replace(".000Z",n)}toDate(){return new Date(1e3*Number(this.seconds)+Math.ceil(this.nanos/1e6))}static now(){return qi.fromDate(new Date)}static fromDate(e){const t=e.getTime();return new qi({seconds:kn.parse(Math.floor(t/1e3)),nanos:t%1e3*1e6})}static fromBinary(e,t){return(new qi).fromBinary(e,t)}static fromJson(e,t){return(new qi).fromJson(e,t)}static fromJsonString(e,t){return(new qi).fromJsonString(e,t)}static equals(e,t){return ce.util.equals(qi,e,t)}}qi.runtime=ce,qi.typeName="google.protobuf.Timestamp",qi.fields=ce.util.newFieldList((()=>[{no:1,name:"seconds",kind:"scalar",T:3},{no:2,name:"nanos",kind:"scalar",T:5}]));const dce=ce.makeMessageType("livekit.MetricsBatch",(()=>[{no:1,name:"timestamp_ms",kind:"scalar",T:3},{no:2,name:"normalized_timestamp",kind:"message",T:qi},{no:3,name:"str_data",kind:"scalar",T:9,repeated:!0},{no:4,name:"time_series",kind:"message",T:fce,repeated:!0},{no:5,name:"events",kind:"message",T:pce,repeated:!0}])),fce=ce.makeMessageType("livekit.TimeSeriesMetric",(()=>[{no:1,name:"label",kind:"scalar",T:13},{no:2,name:"participant_identity",kind:"scalar",T:13},{no:3,name:"track_sid",kind:"scalar",T:13},{no:4,name:"samples",kind:"message",T:hce,repeated:!0},{no:5,name:"rid",kind:"scalar",T:13}])),hce=ce.makeMessageType("livekit.MetricSample",(()=>[{no:1,name:"timestamp_ms",kind:"scalar",T:3},{no:2,name:"normalized_timestamp",kind:"message",T:qi},{no:3,name:"value",kind:"scalar",T:2}])),pce=ce.makeMessageType("livekit.EventMetric",(()=>[{no:1,name:"label",kind:"scalar",T:13},{no:2,name:"participant_identity",kind:"scalar",T:13},{no:3,name:"track_sid",kind:"scalar",T:13},{no:4,name:"start_timestamp_ms",kind:"scalar",T:3},{no:5,name:"end_timestamp_ms",kind:"scalar",T:3,opt:!0},{no:6,name:"normalized_start_timestamp",kind:"message",T:qi},{no:7,name:"normalized_end_timestamp",kind:"message",T:qi,opt:!0},{no:8,name:"metadata",kind:"scalar",T:9},{no:9,name:"rid",kind:"scalar",T:13}])),xB=ce.makeEnum("livekit.BackupCodecPolicy",[{no:0,name:"PREFER_REGRESSION"},{no:1,name:"SIMULCAST"},{no:2,name:"REGRESSION"}]),Lo=ce.makeEnum("livekit.TrackType",[{no:0,name:"AUDIO"},{no:1,name:"VIDEO"},{no:2,name:"DATA"}]),or=ce.makeEnum("livekit.TrackSource",[{no:0,name:"UNKNOWN"},{no:1,name:"CAMERA"},{no:2,name:"MICROPHONE"},{no:3,name:"SCREEN_SHARE"},{no:4,name:"SCREEN_SHARE_AUDIO"}]),Uh=ce.makeEnum("livekit.VideoQuality",[{no:0,name:"LOW"},{no:1,name:"MEDIUM"},{no:2,name:"HIGH"},{no:3,name:"OFF"}]),Ag=ce.makeEnum("livekit.ConnectionQuality",[{no:0,name:"POOR"},{no:1,name:"GOOD"},{no:2,name:"EXCELLENT"},{no:3,name:"LOST"}]),Mv=ce.makeEnum("livekit.ClientConfigSetting",[{no:0,name:"UNSET"},{no:1,name:"DISABLED"},{no:2,name:"ENABLED"}]),Ao=ce.makeEnum("livekit.DisconnectReason",[{no:0,name:"UNKNOWN_REASON"},{no:1,name:"CLIENT_INITIATED"},{no:2,name:"DUPLICATE_IDENTITY"},{no:3,name:"SERVER_SHUTDOWN"},{no:4,name:"PARTICIPANT_REMOVED"},{no:5,name:"ROOM_DELETED"},{no:6,name:"STATE_MISMATCH"},{no:7,name:"JOIN_FAILURE"},{no:8,name:"MIGRATION"},{no:9,name:"SIGNAL_CLOSE"},{no:10,name:"ROOM_CLOSED"},{no:11,name:"USER_UNAVAILABLE"},{no:12,name:"USER_REJECTED"},{no:13,name:"SIP_TRUNK_FAILURE"}]),Wf=ce.makeEnum("livekit.ReconnectReason",[{no:0,name:"RR_UNKNOWN"},{no:1,name:"RR_SIGNAL_DISCONNECTED"},{no:2,name:"RR_PUBLISHER_FAILED"},{no:3,name:"RR_SUBSCRIBER_FAILED"},{no:4,name:"RR_SWITCH_CANDIDATE"}]),mce=ce.makeEnum("livekit.SubscriptionError",[{no:0,name:"SE_UNKNOWN"},{no:1,name:"SE_CODEC_UNSUPPORTED"},{no:2,name:"SE_TRACK_NOTFOUND"}]),pa=ce.makeEnum("livekit.AudioTrackFeature",[{no:0,name:"TF_STEREO"},{no:1,name:"TF_NO_DTX"},{no:2,name:"TF_AUTO_GAIN_CONTROL"},{no:3,name:"TF_ECHO_CANCELLATION"},{no:4,name:"TF_NOISE_SUPPRESSION"},{no:5,name:"TF_ENHANCED_NOISE_CANCELLATION"}]),lL=ce.makeMessageType("livekit.Room",(()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"name",kind:"scalar",T:9},{no:3,name:"empty_timeout",kind:"scalar",T:13},{no:14,name:"departure_timeout",kind:"scalar",T:13},{no:4,name:"max_participants",kind:"scalar",T:13},{no:5,name:"creation_time",kind:"scalar",T:3},{no:15,name:"creation_time_ms",kind:"scalar",T:3},{no:6,name:"turn_password",kind:"scalar",T:9},{no:7,name:"enabled_codecs",kind:"message",T:aS,repeated:!0},{no:8,name:"metadata",kind:"scalar",T:9},{no:9,name:"num_participants",kind:"scalar",T:13},{no:11,name:"num_publishers",kind:"scalar",T:13},{no:10,name:"active_recording",kind:"scalar",T:8},{no:13,name:"version",kind:"message",T:HB}])),aS=ce.makeMessageType("livekit.Codec",(()=>[{no:1,name:"mime",kind:"scalar",T:9},{no:2,name:"fmtp_line",kind:"scalar",T:9}])),gce=ce.makeMessageType("livekit.ParticipantPermission",(()=>[{no:1,name:"can_subscribe",kind:"scalar",T:8},{no:2,name:"can_publish",kind:"scalar",T:8},{no:3,name:"can_publish_data",kind:"scalar",T:8},{no:9,name:"can_publish_sources",kind:"enum",T:ce.getEnumType(or),repeated:!0},{no:7,name:"hidden",kind:"scalar",T:8},{no:8,name:"recorder",kind:"scalar",T:8},{no:10,name:"can_update_metadata",kind:"scalar",T:8},{no:11,name:"agent",kind:"scalar",T:8},{no:12,name:"can_subscribe_metrics",kind:"scalar",T:8}])),Av=ce.makeMessageType("livekit.ParticipantInfo",(()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"identity",kind:"scalar",T:9},{no:3,name:"state",kind:"enum",T:ce.getEnumType(Bk)},{no:4,name:"tracks",kind:"message",T:bh,repeated:!0},{no:5,name:"metadata",kind:"scalar",T:9},{no:6,name:"joined_at",kind:"scalar",T:3},{no:17,name:"joined_at_ms",kind:"scalar",T:3},{no:9,name:"name",kind:"scalar",T:9},{no:10,name:"version",kind:"scalar",T:13},{no:11,name:"permission",kind:"message",T:gce},{no:12,name:"region",kind:"scalar",T:9},{no:13,name:"is_publisher",kind:"scalar",T:8},{no:14,name:"kind",kind:"enum",T:ce.getEnumType(lS)},{no:15,name:"attributes",kind:"map",K:9,V:{kind:"scalar",T:9}},{no:16,name:"disconnect_reason",kind:"enum",T:ce.getEnumType(Ao)},{no:18,name:"kind_details",kind:"enum",T:ce.getEnumType(vce),repeated:!0}])),Bk=ce.makeEnum("livekit.ParticipantInfo.State",[{no:0,name:"JOINING"},{no:1,name:"JOINED"},{no:2,name:"ACTIVE"},{no:3,name:"DISCONNECTED"}]),lS=ce.makeEnum("livekit.ParticipantInfo.Kind",[{no:0,name:"STANDARD"},{no:1,name:"INGRESS"},{no:2,name:"EGRESS"},{no:3,name:"SIP"},{no:4,name:"AGENT"}]),vce=ce.makeEnum("livekit.ParticipantInfo.KindDetail",[{no:0,name:"CLOUD_AGENT"},{no:1,name:"FORWARDED"}]),gs=ce.makeEnum("livekit.Encryption.Type",[{no:0,name:"NONE"},{no:1,name:"GCM"},{no:2,name:"CUSTOM"}]),yce=ce.makeMessageType("livekit.SimulcastCodecInfo",(()=>[{no:1,name:"mime_type",kind:"scalar",T:9},{no:2,name:"mid",kind:"scalar",T:9},{no:3,name:"cid",kind:"scalar",T:9},{no:4,name:"layers",kind:"message",T:wd,repeated:!0}])),bh=ce.makeMessageType("livekit.TrackInfo",(()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"type",kind:"enum",T:ce.getEnumType(Lo)},{no:3,name:"name",kind:"scalar",T:9},{no:4,name:"muted",kind:"scalar",T:8},{no:5,name:"width",kind:"scalar",T:13},{no:6,name:"height",kind:"scalar",T:13},{no:7,name:"simulcast",kind:"scalar",T:8},{no:8,name:"disable_dtx",kind:"scalar",T:8},{no:9,name:"source",kind:"enum",T:ce.getEnumType(or)},{no:10,name:"layers",kind:"message",T:wd,repeated:!0},{no:11,name:"mime_type",kind:"scalar",T:9},{no:12,name:"mid",kind:"scalar",T:9},{no:13,name:"codecs",kind:"message",T:yce,repeated:!0},{no:14,name:"stereo",kind:"scalar",T:8},{no:15,name:"disable_red",kind:"scalar",T:8},{no:16,name:"encryption",kind:"enum",T:ce.getEnumType(gs)},{no:17,name:"stream",kind:"scalar",T:9},{no:18,name:"version",kind:"message",T:HB},{no:19,name:"audio_features",kind:"enum",T:ce.getEnumType(pa),repeated:!0},{no:20,name:"backup_codec_policy",kind:"enum",T:ce.getEnumType(xB)}])),wd=ce.makeMessageType("livekit.VideoLayer",(()=>[{no:1,name:"quality",kind:"enum",T:ce.getEnumType(Uh)},{no:2,name:"width",kind:"scalar",T:13},{no:3,name:"height",kind:"scalar",T:13},{no:4,name:"bitrate",kind:"scalar",T:13},{no:5,name:"ssrc",kind:"scalar",T:13}])),Fi=ce.makeMessageType("livekit.DataPacket",(()=>[{no:1,name:"kind",kind:"enum",T:ce.getEnumType(Ot)},{no:4,name:"participant_identity",kind:"scalar",T:9},{no:5,name:"destination_identities",kind:"scalar",T:9,repeated:!0},{no:2,name:"user",kind:"message",T:LB,oneof:"value"},{no:3,name:"speaker",kind:"message",T:_ce,oneof:"value"},{no:6,name:"sip_dtmf",kind:"message",T:OB,oneof:"value"},{no:7,name:"transcription",kind:"message",T:bce,oneof:"value"},{no:8,name:"metrics",kind:"message",T:dce,oneof:"value"},{no:9,name:"chat_message",kind:"message",T:Vk,oneof:"value"},{no:10,name:"rpc_request",kind:"message",T:MB,oneof:"value"},{no:11,name:"rpc_ack",kind:"message",T:AB,oneof:"value"},{no:12,name:"rpc_response",kind:"message",T:NB,oneof:"value"},{no:13,name:"stream_header",kind:"message",T:Kk,oneof:"value"},{no:14,name:"stream_chunk",kind:"message",T:Gk,oneof:"value"},{no:15,name:"stream_trailer",kind:"message",T:Wk,oneof:"value"}])),Ot=ce.makeEnum("livekit.DataPacket.Kind",[{no:0,name:"RELIABLE"},{no:1,name:"LOSSY"}]),_ce=ce.makeMessageType("livekit.ActiveSpeakerUpdate",(()=>[{no:1,name:"speakers",kind:"message",T:PB,repeated:!0}])),PB=ce.makeMessageType("livekit.SpeakerInfo",(()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"level",kind:"scalar",T:2},{no:3,name:"active",kind:"scalar",T:8}])),LB=ce.makeMessageType("livekit.UserPacket",(()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:5,name:"participant_identity",kind:"scalar",T:9},{no:2,name:"payload",kind:"scalar",T:12},{no:3,name:"destination_sids",kind:"scalar",T:9,repeated:!0},{no:6,name:"destination_identities",kind:"scalar",T:9,repeated:!0},{no:4,name:"topic",kind:"scalar",T:9,opt:!0},{no:8,name:"id",kind:"scalar",T:9,opt:!0},{no:9,name:"start_time",kind:"scalar",T:4,opt:!0},{no:10,name:"end_time",kind:"scalar",T:4,opt:!0},{no:11,name:"nonce",kind:"scalar",T:12}])),OB=ce.makeMessageType("livekit.SipDTMF",(()=>[{no:3,name:"code",kind:"scalar",T:13},{no:4,name:"digit",kind:"scalar",T:9}])),bce=ce.makeMessageType("livekit.Transcription",(()=>[{no:2,name:"transcribed_participant_identity",kind:"scalar",T:9},{no:3,name:"track_id",kind:"scalar",T:9},{no:4,name:"segments",kind:"message",T:Sce,repeated:!0}])),Sce=ce.makeMessageType("livekit.TranscriptionSegment",(()=>[{no:1,name:"id",kind:"scalar",T:9},{no:2,name:"text",kind:"scalar",T:9},{no:3,name:"start_time",kind:"scalar",T:4},{no:4,name:"end_time",kind:"scalar",T:4},{no:5,name:"final",kind:"scalar",T:8},{no:6,name:"language",kind:"scalar",T:9}])),Vk=ce.makeMessageType("livekit.ChatMessage",(()=>[{no:1,name:"id",kind:"scalar",T:9},{no:2,name:"timestamp",kind:"scalar",T:3},{no:3,name:"edit_timestamp",kind:"scalar",T:3,opt:!0},{no:4,name:"message",kind:"scalar",T:9},{no:5,name:"deleted",kind:"scalar",T:8},{no:6,name:"generated",kind:"scalar",T:8}])),MB=ce.makeMessageType("livekit.RpcRequest",(()=>[{no:1,name:"id",kind:"scalar",T:9},{no:2,name:"method",kind:"scalar",T:9},{no:3,name:"payload",kind:"scalar",T:9},{no:4,name:"response_timeout_ms",kind:"scalar",T:13},{no:5,name:"version",kind:"scalar",T:13}])),AB=ce.makeMessageType("livekit.RpcAck",(()=>[{no:1,name:"request_id",kind:"scalar",T:9}])),NB=ce.makeMessageType("livekit.RpcResponse",(()=>[{no:1,name:"request_id",kind:"scalar",T:9},{no:2,name:"payload",kind:"scalar",T:9,oneof:"value"},{no:3,name:"error",kind:"message",T:DB,oneof:"value"}])),DB=ce.makeMessageType("livekit.RpcError",(()=>[{no:1,name:"code",kind:"scalar",T:13},{no:2,name:"message",kind:"scalar",T:9},{no:3,name:"data",kind:"scalar",T:9}])),jB=ce.makeMessageType("livekit.ParticipantTracks",(()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"track_sids",kind:"scalar",T:9,repeated:!0}])),Ece=ce.makeMessageType("livekit.ServerInfo",(()=>[{no:1,name:"edition",kind:"enum",T:ce.getEnumType(UB)},{no:2,name:"version",kind:"scalar",T:9},{no:3,name:"protocol",kind:"scalar",T:5},{no:4,name:"region",kind:"scalar",T:9},{no:5,name:"node_id",kind:"scalar",T:9},{no:6,name:"debug_info",kind:"scalar",T:9},{no:7,name:"agent_protocol",kind:"scalar",T:5}])),UB=ce.makeEnum("livekit.ServerInfo.Edition",[{no:0,name:"Standard"},{no:1,name:"Cloud"}]),wce=ce.makeMessageType("livekit.ClientInfo",(()=>[{no:1,name:"sdk",kind:"enum",T:ce.getEnumType(FB)},{no:2,name:"version",kind:"scalar",T:9},{no:3,name:"protocol",kind:"scalar",T:5},{no:4,name:"os",kind:"scalar",T:9},{no:5,name:"os_version",kind:"scalar",T:9},{no:6,name:"device_model",kind:"scalar",T:9},{no:7,name:"browser",kind:"scalar",T:9},{no:8,name:"browser_version",kind:"scalar",T:9},{no:9,name:"address",kind:"scalar",T:9},{no:10,name:"network",kind:"scalar",T:9},{no:11,name:"other_sdks",kind:"scalar",T:9}])),FB=ce.makeEnum("livekit.ClientInfo.SDK",[{no:0,name:"UNKNOWN"},{no:1,name:"JS"},{no:2,name:"SWIFT"},{no:3,name:"ANDROID"},{no:4,name:"FLUTTER"},{no:5,name:"GO"},{no:6,name:"UNITY"},{no:7,name:"REACT_NATIVE"},{no:8,name:"RUST"},{no:9,name:"PYTHON"},{no:10,name:"CPP"},{no:11,name:"UNITY_WEB"},{no:12,name:"NODE"}]),$B=ce.makeMessageType("livekit.ClientConfiguration",(()=>[{no:1,name:"video",kind:"message",T:c8},{no:2,name:"screen",kind:"message",T:c8},{no:3,name:"resume_connection",kind:"enum",T:ce.getEnumType(Mv)},{no:4,name:"disabled_codecs",kind:"message",T:Cce},{no:5,name:"force_relay",kind:"enum",T:ce.getEnumType(Mv)}])),c8=ce.makeMessageType("livekit.VideoConfiguration",(()=>[{no:1,name:"hardware_encoder",kind:"enum",T:ce.getEnumType(Mv)}])),Cce=ce.makeMessageType("livekit.DisabledCodecs",(()=>[{no:1,name:"codecs",kind:"message",T:aS,repeated:!0},{no:2,name:"publish",kind:"message",T:aS,repeated:!0}])),HB=ce.makeMessageType("livekit.TimedVersion",(()=>[{no:1,name:"unix_micro",kind:"scalar",T:3},{no:2,name:"ticks",kind:"scalar",T:5}])),qk=ce.makeEnum("livekit.DataStream.OperationType",[{no:0,name:"CREATE"},{no:1,name:"UPDATE"},{no:2,name:"DELETE"},{no:3,name:"REACTION"}]),BB=ce.makeMessageType("livekit.DataStream.TextHeader",(()=>[{no:1,name:"operation_type",kind:"enum",T:ce.getEnumType(qk)},{no:2,name:"version",kind:"scalar",T:5},{no:3,name:"reply_to_stream_id",kind:"scalar",T:9},{no:4,name:"attached_stream_ids",kind:"scalar",T:9,repeated:!0},{no:5,name:"generated",kind:"scalar",T:8}]),{localName:"DataStream_TextHeader"}),VB=ce.makeMessageType("livekit.DataStream.ByteHeader",(()=>[{no:1,name:"name",kind:"scalar",T:9}]),{localName:"DataStream_ByteHeader"}),Kk=ce.makeMessageType("livekit.DataStream.Header",(()=>[{no:1,name:"stream_id",kind:"scalar",T:9},{no:2,name:"timestamp",kind:"scalar",T:3},{no:3,name:"topic",kind:"scalar",T:9},{no:4,name:"mime_type",kind:"scalar",T:9},{no:5,name:"total_length",kind:"scalar",T:4,opt:!0},{no:7,name:"encryption_type",kind:"enum",T:ce.getEnumType(gs)},{no:8,name:"attributes",kind:"map",K:9,V:{kind:"scalar",T:9}},{no:9,name:"text_header",kind:"message",T:BB,oneof:"content_header"},{no:10,name:"byte_header",kind:"message",T:VB,oneof:"content_header"}]),{localName:"DataStream_Header"}),Gk=ce.makeMessageType("livekit.DataStream.Chunk",(()=>[{no:1,name:"stream_id",kind:"scalar",T:9},{no:2,name:"chunk_index",kind:"scalar",T:4},{no:3,name:"content",kind:"scalar",T:12},{no:4,name:"version",kind:"scalar",T:5},{no:5,name:"iv",kind:"scalar",T:12,opt:!0}]),{localName:"DataStream_Chunk"}),Wk=ce.makeMessageType("livekit.DataStream.Trailer",(()=>[{no:1,name:"stream_id",kind:"scalar",T:9},{no:2,name:"reason",kind:"scalar",T:9},{no:3,name:"attributes",kind:"map",K:9,V:{kind:"scalar",T:9}}]),{localName:"DataStream_Trailer"}),Oo=ce.makeEnum("livekit.SignalTarget",[{no:0,name:"PUBLISHER"},{no:1,name:"SUBSCRIBER"}]),zk=ce.makeEnum("livekit.StreamState",[{no:0,name:"ACTIVE"},{no:1,name:"PAUSED"}]),Tce=ce.makeEnum("livekit.CandidateProtocol",[{no:0,name:"UDP"},{no:1,name:"TCP"},{no:2,name:"TLS"}]),Rce=ce.makeMessageType("livekit.SignalRequest",(()=>[{no:1,name:"offer",kind:"message",T:Ad,oneof:"message"},{no:2,name:"answer",kind:"message",T:Ad,oneof:"message"},{no:3,name:"trickle",kind:"message",T:cL,oneof:"message"},{no:4,name:"add_track",kind:"message",T:Jk,oneof:"message"},{no:5,name:"mute",kind:"message",T:uL,oneof:"message"},{no:6,name:"subscription",kind:"message",T:HE,oneof:"message"},{no:7,name:"track_setting",kind:"message",T:qB,oneof:"message"},{no:8,name:"leave",kind:"message",T:BE,oneof:"message"},{no:10,name:"update_layers",kind:"message",T:GB,oneof:"message"},{no:11,name:"subscription_permission",kind:"message",T:JB,oneof:"message"},{no:12,name:"sync_state",kind:"message",T:XB,oneof:"message"},{no:13,name:"simulate",kind:"message",T:aa,oneof:"message"},{no:14,name:"ping",kind:"scalar",T:3,oneof:"message"},{no:15,name:"update_metadata",kind:"message",T:WB,oneof:"message"},{no:16,name:"ping_req",kind:"message",T:QB,oneof:"message"},{no:17,name:"update_audio_track",kind:"message",T:KB,oneof:"message"},{no:18,name:"update_video_track",kind:"message",T:Lce,oneof:"message"}])),u8=ce.makeMessageType("livekit.SignalResponse",(()=>[{no:1,name:"join",kind:"message",T:Ice,oneof:"message"},{no:2,name:"answer",kind:"message",T:Ad,oneof:"message"},{no:3,name:"offer",kind:"message",T:Ad,oneof:"message"},{no:4,name:"trickle",kind:"message",T:cL,oneof:"message"},{no:5,name:"update",kind:"message",T:Pce,oneof:"message"},{no:6,name:"track_published",kind:"message",T:dL,oneof:"message"},{no:8,name:"leave",kind:"message",T:BE,oneof:"message"},{no:9,name:"mute",kind:"message",T:uL,oneof:"message"},{no:10,name:"speakers_changed",kind:"message",T:Oce,oneof:"message"},{no:11,name:"room_update",kind:"message",T:Mce,oneof:"message"},{no:12,name:"connection_quality",kind:"message",T:Nce,oneof:"message"},{no:13,name:"stream_state_update",kind:"message",T:jce,oneof:"message"},{no:14,name:"subscribed_quality_update",kind:"message",T:Fce,oneof:"message"},{no:15,name:"subscription_permission_update",kind:"message",T:$ce,oneof:"message"},{no:16,name:"refresh_token",kind:"scalar",T:9,oneof:"message"},{no:17,name:"track_unpublished",kind:"message",T:xce,oneof:"message"},{no:18,name:"pong",kind:"scalar",T:3,oneof:"message"},{no:19,name:"reconnect",kind:"message",T:kce,oneof:"message"},{no:20,name:"pong_resp",kind:"message",T:Hce,oneof:"message"},{no:21,name:"subscription_response",kind:"message",T:qce,oneof:"message"},{no:22,name:"request_response",kind:"message",T:Kce,oneof:"message"},{no:23,name:"track_subscribed",kind:"message",T:Gce,oneof:"message"}])),Yk=ce.makeMessageType("livekit.SimulcastCodec",(()=>[{no:1,name:"codec",kind:"scalar",T:9},{no:2,name:"cid",kind:"scalar",T:9}])),Jk=ce.makeMessageType("livekit.AddTrackRequest",(()=>[{no:1,name:"cid",kind:"scalar",T:9},{no:2,name:"name",kind:"scalar",T:9},{no:3,name:"type",kind:"enum",T:ce.getEnumType(Lo)},{no:4,name:"width",kind:"scalar",T:13},{no:5,name:"height",kind:"scalar",T:13},{no:6,name:"muted",kind:"scalar",T:8},{no:7,name:"disable_dtx",kind:"scalar",T:8},{no:8,name:"source",kind:"enum",T:ce.getEnumType(or)},{no:9,name:"layers",kind:"message",T:wd,repeated:!0},{no:10,name:"simulcast_codecs",kind:"message",T:Yk,repeated:!0},{no:11,name:"sid",kind:"scalar",T:9},{no:12,name:"stereo",kind:"scalar",T:8},{no:13,name:"disable_red",kind:"scalar",T:8},{no:14,name:"encryption",kind:"enum",T:ce.getEnumType(gs)},{no:15,name:"stream",kind:"scalar",T:9},{no:16,name:"backup_codec_policy",kind:"enum",T:ce.getEnumType(xB)}])),cL=ce.makeMessageType("livekit.TrickleRequest",(()=>[{no:1,name:"candidateInit",kind:"scalar",T:9},{no:2,name:"target",kind:"enum",T:ce.getEnumType(Oo)},{no:3,name:"final",kind:"scalar",T:8}])),uL=ce.makeMessageType("livekit.MuteTrackRequest",(()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"muted",kind:"scalar",T:8}])),Ice=ce.makeMessageType("livekit.JoinResponse",(()=>[{no:1,name:"room",kind:"message",T:lL},{no:2,name:"participant",kind:"message",T:Av},{no:3,name:"other_participants",kind:"message",T:Av,repeated:!0},{no:4,name:"server_version",kind:"scalar",T:9},{no:5,name:"ice_servers",kind:"message",T:zB,repeated:!0},{no:6,name:"subscriber_primary",kind:"scalar",T:8},{no:7,name:"alternative_url",kind:"scalar",T:9},{no:8,name:"client_configuration",kind:"message",T:$B},{no:9,name:"server_region",kind:"scalar",T:9},{no:10,name:"ping_timeout",kind:"scalar",T:5},{no:11,name:"ping_interval",kind:"scalar",T:5},{no:12,name:"server_info",kind:"message",T:Ece},{no:13,name:"sif_trailer",kind:"scalar",T:12},{no:14,name:"enabled_publish_codecs",kind:"message",T:aS,repeated:!0},{no:15,name:"fast_publish",kind:"scalar",T:8}])),kce=ce.makeMessageType("livekit.ReconnectResponse",(()=>[{no:1,name:"ice_servers",kind:"message",T:zB,repeated:!0},{no:2,name:"client_configuration",kind:"message",T:$B}])),dL=ce.makeMessageType("livekit.TrackPublishedResponse",(()=>[{no:1,name:"cid",kind:"scalar",T:9},{no:2,name:"track",kind:"message",T:bh}])),xce=ce.makeMessageType("livekit.TrackUnpublishedResponse",(()=>[{no:1,name:"track_sid",kind:"scalar",T:9}])),Ad=ce.makeMessageType("livekit.SessionDescription",(()=>[{no:1,name:"type",kind:"scalar",T:9},{no:2,name:"sdp",kind:"scalar",T:9}])),Pce=ce.makeMessageType("livekit.ParticipantUpdate",(()=>[{no:1,name:"participants",kind:"message",T:Av,repeated:!0}])),HE=ce.makeMessageType("livekit.UpdateSubscription",(()=>[{no:1,name:"track_sids",kind:"scalar",T:9,repeated:!0},{no:2,name:"subscribe",kind:"scalar",T:8},{no:3,name:"participant_tracks",kind:"message",T:jB,repeated:!0}])),qB=ce.makeMessageType("livekit.UpdateTrackSettings",(()=>[{no:1,name:"track_sids",kind:"scalar",T:9,repeated:!0},{no:3,name:"disabled",kind:"scalar",T:8},{no:4,name:"quality",kind:"enum",T:ce.getEnumType(Uh)},{no:5,name:"width",kind:"scalar",T:13},{no:6,name:"height",kind:"scalar",T:13},{no:7,name:"fps",kind:"scalar",T:13},{no:8,name:"priority",kind:"scalar",T:13}])),KB=ce.makeMessageType("livekit.UpdateLocalAudioTrack",(()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"features",kind:"enum",T:ce.getEnumType(pa),repeated:!0}])),Lce=ce.makeMessageType("livekit.UpdateLocalVideoTrack",(()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"width",kind:"scalar",T:13},{no:3,name:"height",kind:"scalar",T:13}])),BE=ce.makeMessageType("livekit.LeaveRequest",(()=>[{no:1,name:"can_reconnect",kind:"scalar",T:8},{no:2,name:"reason",kind:"enum",T:ce.getEnumType(Ao)},{no:3,name:"action",kind:"enum",T:ce.getEnumType(Fh)},{no:4,name:"regions",kind:"message",T:Bce}])),Fh=ce.makeEnum("livekit.LeaveRequest.Action",[{no:0,name:"DISCONNECT"},{no:1,name:"RESUME"},{no:2,name:"RECONNECT"}]),GB=ce.makeMessageType("livekit.UpdateVideoLayers",(()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"layers",kind:"message",T:wd,repeated:!0}])),WB=ce.makeMessageType("livekit.UpdateParticipantMetadata",(()=>[{no:1,name:"metadata",kind:"scalar",T:9},{no:2,name:"name",kind:"scalar",T:9},{no:3,name:"attributes",kind:"map",K:9,V:{kind:"scalar",T:9}},{no:4,name:"request_id",kind:"scalar",T:13}])),zB=ce.makeMessageType("livekit.ICEServer",(()=>[{no:1,name:"urls",kind:"scalar",T:9,repeated:!0},{no:2,name:"username",kind:"scalar",T:9},{no:3,name:"credential",kind:"scalar",T:9}])),Oce=ce.makeMessageType("livekit.SpeakersChanged",(()=>[{no:1,name:"speakers",kind:"message",T:PB,repeated:!0}])),Mce=ce.makeMessageType("livekit.RoomUpdate",(()=>[{no:1,name:"room",kind:"message",T:lL}])),Ace=ce.makeMessageType("livekit.ConnectionQualityInfo",(()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"quality",kind:"enum",T:ce.getEnumType(Ag)},{no:3,name:"score",kind:"scalar",T:2}])),Nce=ce.makeMessageType("livekit.ConnectionQualityUpdate",(()=>[{no:1,name:"updates",kind:"message",T:Ace,repeated:!0}])),Dce=ce.makeMessageType("livekit.StreamStateInfo",(()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"track_sid",kind:"scalar",T:9},{no:3,name:"state",kind:"enum",T:ce.getEnumType(zk)}])),jce=ce.makeMessageType("livekit.StreamStateUpdate",(()=>[{no:1,name:"stream_states",kind:"message",T:Dce,repeated:!0}])),fL=ce.makeMessageType("livekit.SubscribedQuality",(()=>[{no:1,name:"quality",kind:"enum",T:ce.getEnumType(Uh)},{no:2,name:"enabled",kind:"scalar",T:8}])),Uce=ce.makeMessageType("livekit.SubscribedCodec",(()=>[{no:1,name:"codec",kind:"scalar",T:9},{no:2,name:"qualities",kind:"message",T:fL,repeated:!0}])),Fce=ce.makeMessageType("livekit.SubscribedQualityUpdate",(()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"subscribed_qualities",kind:"message",T:fL,repeated:!0},{no:3,name:"subscribed_codecs",kind:"message",T:Uce,repeated:!0}])),YB=ce.makeMessageType("livekit.TrackPermission",(()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"all_tracks",kind:"scalar",T:8},{no:3,name:"track_sids",kind:"scalar",T:9,repeated:!0},{no:4,name:"participant_identity",kind:"scalar",T:9}])),JB=ce.makeMessageType("livekit.SubscriptionPermission",(()=>[{no:1,name:"all_participants",kind:"scalar",T:8},{no:2,name:"track_permissions",kind:"message",T:YB,repeated:!0}])),$ce=ce.makeMessageType("livekit.SubscriptionPermissionUpdate",(()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"track_sid",kind:"scalar",T:9},{no:3,name:"allowed",kind:"scalar",T:8}])),XB=ce.makeMessageType("livekit.SyncState",(()=>[{no:1,name:"answer",kind:"message",T:Ad},{no:2,name:"subscription",kind:"message",T:HE},{no:3,name:"publish_tracks",kind:"message",T:dL,repeated:!0},{no:4,name:"data_channels",kind:"message",T:ZB,repeated:!0},{no:5,name:"offer",kind:"message",T:Ad},{no:6,name:"track_sids_disabled",kind:"scalar",T:9,repeated:!0}])),ZB=ce.makeMessageType("livekit.DataChannelInfo",(()=>[{no:1,name:"label",kind:"scalar",T:9},{no:2,name:"id",kind:"scalar",T:13},{no:3,name:"target",kind:"enum",T:ce.getEnumType(Oo)}])),aa=ce.makeMessageType("livekit.SimulateScenario",(()=>[{no:1,name:"speaker_update",kind:"scalar",T:5,oneof:"scenario"},{no:2,name:"node_failure",kind:"scalar",T:8,oneof:"scenario"},{no:3,name:"migration",kind:"scalar",T:8,oneof:"scenario"},{no:4,name:"server_leave",kind:"scalar",T:8,oneof:"scenario"},{no:5,name:"switch_candidate_protocol",kind:"enum",T:ce.getEnumType(Tce),oneof:"scenario"},{no:6,name:"subscriber_bandwidth",kind:"scalar",T:3,oneof:"scenario"},{no:7,name:"disconnect_signal_on_resume",kind:"scalar",T:8,oneof:"scenario"},{no:8,name:"disconnect_signal_on_resume_no_messages",kind:"scalar",T:8,oneof:"scenario"},{no:9,name:"leave_request_full_reconnect",kind:"scalar",T:8,oneof:"scenario"}])),QB=ce.makeMessageType("livekit.Ping",(()=>[{no:1,name:"timestamp",kind:"scalar",T:3},{no:2,name:"rtt",kind:"scalar",T:3}])),Hce=ce.makeMessageType("livekit.Pong",(()=>[{no:1,name:"last_ping_timestamp",kind:"scalar",T:3},{no:2,name:"timestamp",kind:"scalar",T:3}])),Bce=ce.makeMessageType("livekit.RegionSettings",(()=>[{no:1,name:"regions",kind:"message",T:Vce,repeated:!0}])),Vce=ce.makeMessageType("livekit.RegionInfo",(()=>[{no:1,name:"region",kind:"scalar",T:9},{no:2,name:"url",kind:"scalar",T:9},{no:3,name:"distance",kind:"scalar",T:3}])),qce=ce.makeMessageType("livekit.SubscriptionResponse",(()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"err",kind:"enum",T:ce.getEnumType(mce)}])),Kce=ce.makeMessageType("livekit.RequestResponse",(()=>[{no:1,name:"request_id",kind:"scalar",T:13},{no:2,name:"reason",kind:"enum",T:ce.getEnumType(hL)},{no:3,name:"message",kind:"scalar",T:9}])),hL=ce.makeEnum("livekit.RequestResponse.Reason",[{no:0,name:"OK"},{no:1,name:"NOT_FOUND"},{no:2,name:"NOT_ALLOWED"},{no:3,name:"LIMIT_EXCEEDED"}]),Gce=ce.makeMessageType("livekit.TrackSubscribed",(()=>[{no:1,name:"track_sid",kind:"scalar",T:9}]));function Wce(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var d8,J_={exports:{}},zce=J_.exports;function Yce(){return d8||(d8=1,t=zce,n=function(){var e=function(){},t="undefined",n=typeof window!==t&&typeof window.navigator!==t&&/Trident\/|MSIE /.test(window.navigator.userAgent),r=["trace","debug","info","warn","error"],i={},o=null;function s(e,t){var n=e[t];if("function"==typeof n.bind)return n.bind(e);try{return Function.prototype.bind.call(n,e)}catch{return function(){return Function.prototype.apply.apply(n,[e,arguments])}}}function a(){console.log&&(console.log.apply?console.log.apply(console,arguments):Function.prototype.apply.apply(console.log,[console,arguments])),console.trace&&console.trace()}function l(){for(var n=this.getLevel(),i=0;i<r.length;i++){var o=r[i];this[o]=i<n?e:this.methodFactory(o,n,this.name)}if(this.log=this.debug,typeof console===t&&n<this.levels.SILENT)return"No console available for logging"}function c(e){return function(){typeof console!==t&&(l.call(this),this[e].apply(this,arguments))}}function u(r,i,o){return function(r){return"debug"===r&&(r="log"),typeof console!==t&&("trace"===r&&n?a:void 0!==console[r]?s(console,r):void 0!==console.log?s(console,"log"):e)}(r)||c.apply(this,arguments)}function d(e,n){var s,a,c,d=this,h="loglevel";function p(){var e;if(typeof window!==t&&h){try{e=window.localStorage[h]}catch{}if(typeof e===t)try{var n=window.document.cookie,r=encodeURIComponent(h),i=n.indexOf(r+"=");-1!==i&&(e=/^([^;]+)/.exec(n.slice(i+r.length+1))[1])}catch{}return void 0===d.levels[e]&&(e=void 0),e}}function f(e){var t=e;if("string"==typeof t&&void 0!==d.levels[t.toUpperCase()]&&(t=d.levels[t.toUpperCase()]),"number"==typeof t&&t>=0&&t<=d.levels.SILENT)return t;throw new TypeError("log.setLevel() called with invalid level: "+e)}"string"==typeof e?h+=":"+e:"symbol"==typeof e&&(h=void 0),d.name=e,d.levels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5},d.methodFactory=n||u,d.getLevel=function(){return c??a??s},d.setLevel=function(e,n){return c=f(e),!1!==n&&function(e){var n=(r[e]||"silent").toUpperCase();if(typeof window!==t&&h){try{return void(window.localStorage[h]=n)}catch{}try{window.document.cookie=encodeURIComponent(h)+"="+n+";"}catch{}}}(c),l.call(d)},d.setDefaultLevel=function(e){a=f(e),p()||d.setLevel(e,!1)},d.resetLevel=function(){c=null,function(){if(typeof window!==t&&h){try{window.localStorage.removeItem(h)}catch{}try{window.document.cookie=encodeURIComponent(h)+"=; expires=Thu, 01 Jan 1970 00:00:00 UTC"}catch{}}}(),l.call(d)},d.enableAll=function(e){d.setLevel(d.levels.TRACE,e)},d.disableAll=function(e){d.setLevel(d.levels.SILENT,e)},d.rebuild=function(){if(o!==d&&(s=f(o.getLevel())),l.call(d),o===d)for(var e in i)i[e].rebuild()},s=f(o?o.getLevel():"WARN");var m=p();null!=m&&(c=f(m)),l.call(d)}(o=new d).getLogger=function(e){if("symbol"!=typeof e&&"string"!=typeof e||""===e)throw new TypeError("You must supply a name when creating a logger.");var t=i[e];return t||(t=i[e]=new d(e,o.methodFactory)),t};var h=typeof window!==t?window.log:void 0;return o.noConflict=function(){return typeof window!==t&&window.log===o&&(window.log=h),o},o.getLoggers=function(){return i},o.default=o,o},(e=J_).exports?e.exports=n():t.log=n()),J_.exports;var e,t,n}var Nv,$o,Ty=Yce();!function(e){e[e.trace=0]="trace",e[e.debug=1]="debug",e[e.info=2]="info",e[e.warn=3]="warn",e[e.error=4]="error",e[e.silent=5]="silent"}(Nv||(Nv={})),function(e){e.Default="livekit",e.Room="livekit-room",e.Participant="livekit-participant",e.Track="livekit-track",e.Publication="livekit-track-publication",e.Engine="livekit-engine",e.Signal="livekit-signal",e.PCManager="livekit-pc-manager",e.PCTransport="livekit-pc-transport",e.E2EE="lk-e2ee"}($o||($o={}));let bt=Ty.getLogger("livekit");const eV=Object.values($o).map((e=>Ty.getLogger(e)));function Ol(e){const t=Ty.getLogger(e);return t.setDefaultLevel(bt.getLevel()),t}function tV(e,t){if(t)Ty.getLogger(t).setLevel(e);else for(const t of eV)t.setLevel(e)}function Jce(e,t){eV.forEach((t=>{const n=t.methodFactory;t.methodFactory=(t,r,i)=>{const o=n(t,r,i),s=Nv[t],a=s>=r&&s<Nv.silent;return(t,n)=>{n?o(t,n):o(t),a&&e(s,t,n)}},t.setLevel(t.getLevel())}))}bt.setDefaultLevel(Nv.info);const Xce=Ty.getLogger("lk-e2ee"),rg=7e3,Zce=[0,300,1200,2700,4800,rg,rg,rg,rg,rg];class nV{constructor(e){this._retryDelays=void 0!==e?[...e]:Zce}nextRetryDelayInMs(e){if(e.retryCount>=this._retryDelays.length)return null;const t=this._retryDelays[e.retryCount];return e.retryCount<=1?t:t+1e3*Math.random()}}function Qce(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n}function J(e,t,n,r){return new(n||(n=Promise))((function(i,o){function s(e){try{l(r.next(e))}catch(e){o(e)}}function a(e){try{l(r.throw(e))}catch(e){o(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(s,a)}l((r=r.apply(e,t||[])).next())}))}function f8(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function jc(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t,n=e[Symbol.asyncIterator];return n?n.call(e):(e="function"==typeof f8?f8(e):e[Symbol.iterator](),t={},r("next"),r("throw"),r("return"),t[Symbol.asyncIterator]=function(){return this},t);function r(n){t[n]=e[n]&&function(t){return new Promise((function(r,i){(function(e,t,n,r){Promise.resolve(r).then((function(t){e({value:t,done:n})}),t)})(r,i,(t=e[n](t)).done,t.value)}))}}}var h8,L1={exports:{}};function eue(){if(h8)return L1.exports;h8=1;var e,t="object"==typeof Reflect?Reflect:null,n=t&&"function"==typeof t.apply?t.apply:function(e,t,n){return Function.prototype.apply.call(e,t,n)};e=t&&"function"==typeof t.ownKeys?t.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)};var r=Number.isNaN||function(e){return e!=e};function i(){i.init.call(this)}L1.exports=i,L1.exports.once=function(e,t){return new Promise((function(n,r){function i(n){e.removeListener(t,o),r(n)}function o(){"function"==typeof e.removeListener&&e.removeListener("error",i),n([].slice.call(arguments))}f(e,t,o,{once:!0}),"error"!==t&&function(e,t,n){"function"==typeof e.on&&f(e,"error",t,n)}(e,i,{once:!0})}))},i.EventEmitter=i,i.prototype._events=void 0,i.prototype._eventsCount=0,i.prototype._maxListeners=void 0;var o=10;function s(e){if("function"!=typeof e)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e)}function a(e){return void 0===e._maxListeners?i.defaultMaxListeners:e._maxListeners}function l(e,t,n,r){var i,o,l;if(s(n),void 0===(o=e._events)?(o=e._events=Object.create(null),e._eventsCount=0):(void 0!==o.newListener&&(e.emit("newListener",t,n.listener?n.listener:n),o=e._events),l=o[t]),void 0===l)l=o[t]=n,++e._eventsCount;else if("function"==typeof l?l=o[t]=r?[n,l]:[l,n]:r?l.unshift(n):l.push(n),(i=a(e))>0&&l.length>i&&!l.warned){l.warned=!0;var c=new Error("Possible EventEmitter memory leak detected. "+l.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");c.name="MaxListenersExceededWarning",c.emitter=e,c.type=t,c.count=l.length,function(e){console&&console.warn&&console.warn(e)}(c)}return e}function c(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function u(e,t,n){var r={fired:!1,wrapFn:void 0,target:e,type:t,listener:n},i=c.bind(r);return i.listener=n,r.wrapFn=i,i}function d(e,t,n){var r=e._events;if(void 0===r)return[];var i=r[t];return void 0===i?[]:"function"==typeof i?n?[i.listener||i]:[i]:n?function(e){for(var t=new Array(e.length),n=0;n<t.length;++n)t[n]=e[n].listener||e[n];return t}(i):p(i,i.length)}function h(e){var t=this._events;if(void 0!==t){var n=t[e];if("function"==typeof n)return 1;if(void 0!==n)return n.length}return 0}function p(e,t){for(var n=new Array(t),r=0;r<t;++r)n[r]=e[r];return n}function f(e,t,n,r){if("function"==typeof e.on)r.once?e.once(t,n):e.on(t,n);else{if("function"!=typeof e.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof e);e.addEventListener(t,(function i(o){r.once&&e.removeEventListener(t,i),n(o)}))}}return Object.defineProperty(i,"defaultMaxListeners",{enumerable:!0,get:function(){return o},set:function(e){if("number"!=typeof e||e<0||r(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");o=e}}),i.init=function(){(void 0===this._events||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},i.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||r(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},i.prototype.getMaxListeners=function(){return a(this)},i.prototype.emit=function(e){for(var t=[],r=1;r<arguments.length;r++)t.push(arguments[r]);var i="error"===e,o=this._events;if(void 0!==o)i=i&&void 0===o.error;else if(!i)return!1;if(i){var s;if(t.length>0&&(s=t[0]),s instanceof Error)throw s;var a=new Error("Unhandled error."+(s?" ("+s.message+")":""));throw a.context=s,a}var l=o[e];if(void 0===l)return!1;if("function"==typeof l)n(l,this,t);else{var c=l.length,u=p(l,c);for(r=0;r<c;++r)n(u[r],this,t)}return!0},i.prototype.addListener=function(e,t){return l(this,e,t,!1)},i.prototype.on=i.prototype.addListener,i.prototype.prependListener=function(e,t){return l(this,e,t,!0)},i.prototype.once=function(e,t){return s(t),this.on(e,u(this,e,t)),this},i.prototype.prependOnceListener=function(e,t){return s(t),this.prependListener(e,u(this,e,t)),this},i.prototype.removeListener=function(e,t){var n,r,i,o,a;if(s(t),void 0===(r=this._events))return this;if(void 0===(n=r[e]))return this;if(n===t||n.listener===t)0==--this._eventsCount?this._events=Object.create(null):(delete r[e],r.removeListener&&this.emit("removeListener",e,n.listener||t));else if("function"!=typeof n){for(i=-1,o=n.length-1;o>=0;o--)if(n[o]===t||n[o].listener===t){a=n[o].listener,i=o;break}if(i<0)return this;0===i?n.shift():function(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}(n,i),1===n.length&&(r[e]=n[0]),void 0!==r.removeListener&&this.emit("removeListener",e,a||t)}return this},i.prototype.off=i.prototype.removeListener,i.prototype.removeAllListeners=function(e){var t,n,r;if(void 0===(n=this._events))return this;if(void 0===n.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==n[e]&&(0==--this._eventsCount?this._events=Object.create(null):delete n[e]),this;if(0===arguments.length){var i,o=Object.keys(n);for(r=0;r<o.length;++r)"removeListener"!==(i=o[r])&&this.removeAllListeners(i);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(t=n[e]))this.removeListener(e,t);else if(void 0!==t)for(r=t.length-1;r>=0;r--)this.removeListener(e,t[r]);return this},i.prototype.listeners=function(e){return d(this,e,!0)},i.prototype.rawListeners=function(e){return d(this,e,!1)},i.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):h.call(e,t)},i.prototype.listenerCount=h,i.prototype.eventNames=function(){return this._eventsCount>0?e(this._events):[]},L1.exports}var Oa=eue();let rV=!0,iV=!0;function X_(e,t,n){const r=e.match(t);return r&&r.length>=n&&parseInt(r[n],10)}function Xd(e,t,n){if(!e.RTCPeerConnection)return;const r=e.RTCPeerConnection.prototype,i=r.addEventListener;r.addEventListener=function(e,r){if(e!==t)return i.apply(this,arguments);const o=e=>{const t=n(e);t&&(r.handleEvent?r.handleEvent(t):r(t))};return this._eventMap=this._eventMap||{},this._eventMap[t]||(this._eventMap[t]=new Map),this._eventMap[t].set(r,o),i.apply(this,[e,o])};const o=r.removeEventListener;r.removeEventListener=function(e,n){if(e!==t||!this._eventMap||!this._eventMap[t])return o.apply(this,arguments);if(!this._eventMap[t].has(n))return o.apply(this,arguments);const r=this._eventMap[t].get(n);return this._eventMap[t].delete(n),0===this._eventMap[t].size&&delete this._eventMap[t],0===Object.keys(this._eventMap).length&&delete this._eventMap,o.apply(this,[e,r])},Object.defineProperty(r,"on"+t,{get(){return this["_on"+t]},set(e){this["_on"+t]&&(this.removeEventListener(t,this["_on"+t]),delete this["_on"+t]),e&&this.addEventListener(t,this["_on"+t]=e)},enumerable:!0,configurable:!0})}function tue(e){return"boolean"!=typeof e?new Error("Argument type: "+typeof e+". Please use a boolean."):(rV=e,e?"adapter.js logging disabled":"adapter.js logging enabled")}function nue(e){return"boolean"!=typeof e?new Error("Argument type: "+typeof e+". Please use a boolean."):(iV=!e,"adapter.js deprecation warnings "+(e?"disabled":"enabled"))}function sV(){if("object"==typeof window){if(rV)return;typeof console<"u"&&"function"==typeof console.log&&console.log.apply(console,arguments)}}function pL(e,t){iV&&console.warn(e+" is deprecated, please use "+t+" instead.")}function rue(e){const t={browser:null,version:null};if(typeof e>"u"||!e.navigator||!e.navigator.userAgent)return t.browser="Not a browser.",t;const{navigator:n}=e;if(n.userAgentData&&n.userAgentData.brands){const e=n.userAgentData.brands.find((e=>"Chromium"===e.brand));if(e)return{browser:"chrome",version:parseInt(e.version,10)}}if(n.mozGetUserMedia)t.browser="firefox",t.version=X_(n.userAgent,/Firefox\/(\d+)\./,1);else if(n.webkitGetUserMedia||!1===e.isSecureContext&&e.webkitRTCPeerConnection)t.browser="chrome",t.version=X_(n.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else{if(!e.RTCPeerConnection||!n.userAgent.match(/AppleWebKit\/(\d+)\./))return t.browser="Not a supported browser.",t;t.browser="safari",t.version=X_(n.userAgent,/AppleWebKit\/(\d+)\./,1),t.supportsUnifiedPlan=e.RTCRtpTransceiver&&"currentDirection"in e.RTCRtpTransceiver.prototype}return t}function p8(e){return"[object Object]"===Object.prototype.toString.call(e)}function oV(e){return p8(e)?Object.keys(e).reduce((function(t,n){const r=p8(e[n]),i=r?oV(e[n]):e[n],o=r&&!Object.keys(i).length;return void 0===i||o?t:Object.assign(t,{[n]:i})}),{}):e}function Xk(e,t,n){!t||n.has(t.id)||(n.set(t.id,t),Object.keys(t).forEach((r=>{r.endsWith("Id")?Xk(e,e.get(t[r]),n):r.endsWith("Ids")&&t[r].forEach((t=>{Xk(e,e.get(t),n)}))})))}function m8(e,t,n){const r=n?"outbound-rtp":"inbound-rtp",i=new Map;if(null===t)return i;const o=[];return e.forEach((e=>{"track"===e.type&&e.trackIdentifier===t.id&&o.push(e)})),o.forEach((t=>{e.forEach((n=>{n.type===r&&n.trackId===t.id&&Xk(e,n,i)}))})),i}const g8=sV;function aV(e,t){const n=e&&e.navigator;if(!n.mediaDevices)return;const r=function(e){if("object"!=typeof e||e.mandatory||e.optional)return e;const t={};return Object.keys(e).forEach((n=>{if("require"===n||"advanced"===n||"mediaSource"===n)return;const r="object"==typeof e[n]?e[n]:{ideal:e[n]};void 0!==r.exact&&"number"==typeof r.exact&&(r.min=r.max=r.exact);const i=function(e,t){return e?e+t.charAt(0).toUpperCase()+t.slice(1):"deviceId"===t?"sourceId":t};if(void 0!==r.ideal){t.optional=t.optional||[];let e={};"number"==typeof r.ideal?(e[i("min",n)]=r.ideal,t.optional.push(e),e={},e[i("max",n)]=r.ideal,t.optional.push(e)):(e[i("",n)]=r.ideal,t.optional.push(e))}void 0!==r.exact&&"number"!=typeof r.exact?(t.mandatory=t.mandatory||{},t.mandatory[i("",n)]=r.exact):["min","max"].forEach((e=>{void 0!==r[e]&&(t.mandatory=t.mandatory||{},t.mandatory[i(e,n)]=r[e])}))})),e.advanced&&(t.optional=(t.optional||[]).concat(e.advanced)),t},i=function(e,i){if(t.version>=61)return i(e);if((e=JSON.parse(JSON.stringify(e)))&&"object"==typeof e.audio){const t=function(e,t,n){t in e&&!(n in e)&&(e[n]=e[t],delete e[t])};t((e=JSON.parse(JSON.stringify(e))).audio,"autoGainControl","googAutoGainControl"),t(e.audio,"noiseSuppression","googNoiseSuppression"),e.audio=r(e.audio)}if(e&&"object"==typeof e.video){let o=e.video.facingMode;o=o&&("object"==typeof o?o:{ideal:o});const s=t.version<66;if(o&&("user"===o.exact||"environment"===o.exact||"user"===o.ideal||"environment"===o.ideal)&&(!n.mediaDevices.getSupportedConstraints||!n.mediaDevices.getSupportedConstraints().facingMode||s)){let t;if(delete e.video.facingMode,"environment"===o.exact||"environment"===o.ideal?t=["back","rear"]:("user"===o.exact||"user"===o.ideal)&&(t=["front"]),t)return n.mediaDevices.enumerateDevices().then((n=>{let s=(n=n.filter((e=>"videoinput"===e.kind))).find((e=>t.some((t=>e.label.toLowerCase().includes(t)))));return!s&&n.length&&t.includes("back")&&(s=n[n.length-1]),s&&(e.video.deviceId=o.exact?{exact:s.deviceId}:{ideal:s.deviceId}),e.video=r(e.video),g8("chrome: "+JSON.stringify(e)),i(e)}))}e.video=r(e.video)}return g8("chrome: "+JSON.stringify(e)),i(e)},o=function(e){return t.version>=64?e:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[e.name]||e.name,message:e.message,constraint:e.constraint||e.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}};if(n.getUserMedia=function(e,t,r){i(e,(e=>{n.webkitGetUserMedia(e,t,(e=>{r&&r(o(e))}))}))}.bind(n),n.mediaDevices.getUserMedia){const e=n.mediaDevices.getUserMedia.bind(n.mediaDevices);n.mediaDevices.getUserMedia=function(t){return i(t,(t=>e(t).then((e=>{if(t.audio&&!e.getAudioTracks().length||t.video&&!e.getVideoTracks().length)throw e.getTracks().forEach((e=>{e.stop()})),new DOMException("","NotFoundError");return e}),(e=>Promise.reject(o(e))))))}}}function lV(e){e.MediaStream=e.MediaStream||e.webkitMediaStream}function cV(e){if("object"==typeof e&&e.RTCPeerConnection&&!("ontrack"in e.RTCPeerConnection.prototype)){Object.defineProperty(e.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(e){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=e)},enumerable:!0,configurable:!0});const t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=t=>{t.stream.addEventListener("addtrack",(n=>{let r;r=e.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find((e=>e.track&&e.track.id===n.track.id)):{track:n.track};const i=new Event("track");i.track=n.track,i.receiver=r,i.transceiver={receiver:r},i.streams=[t.stream],this.dispatchEvent(i)})),t.stream.getTracks().forEach((n=>{let r;r=e.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find((e=>e.track&&e.track.id===n.id)):{track:n};const i=new Event("track");i.track=n,i.receiver=r,i.transceiver={receiver:r},i.streams=[t.stream],this.dispatchEvent(i)}))},this.addEventListener("addstream",this._ontrackpoly)),t.apply(this,arguments)}}else Xd(e,"track",(e=>(e.transceiver||Object.defineProperty(e,"transceiver",{value:{receiver:e.receiver}}),e)))}function uV(e){if("object"==typeof e&&e.RTCPeerConnection&&!("getSenders"in e.RTCPeerConnection.prototype)&&"createDTMFSender"in e.RTCPeerConnection.prototype){const t=function(e,t){return{track:t,get dtmf(){return void 0===this._dtmf&&("audio"===t.kind?this._dtmf=e.createDTMFSender(t):this._dtmf=null),this._dtmf},_pc:e}};if(!e.RTCPeerConnection.prototype.getSenders){e.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const n=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(e,r){let i=n.apply(this,arguments);return i||(i=t(this,e),this._senders.push(i)),i};const r=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(e){r.apply(this,arguments);const t=this._senders.indexOf(e);-1!==t&&this._senders.splice(t,1)}}const n=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(e){this._senders=this._senders||[],n.apply(this,[e]),e.getTracks().forEach((e=>{this._senders.push(t(this,e))}))};const r=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){this._senders=this._senders||[],r.apply(this,[e]),e.getTracks().forEach((e=>{const t=this._senders.find((t=>t.track===e));t&&this._senders.splice(this._senders.indexOf(t),1)}))}}else if("object"==typeof e&&e.RTCPeerConnection&&"getSenders"in e.RTCPeerConnection.prototype&&"createDTMFSender"in e.RTCPeerConnection.prototype&&e.RTCRtpSender&&!("dtmf"in e.RTCRtpSender.prototype)){const t=e.RTCPeerConnection.prototype.getSenders;e.RTCPeerConnection.prototype.getSenders=function(){const e=t.apply(this,[]);return e.forEach((e=>e._pc=this)),e},Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get(){return void 0===this._dtmf&&("audio"===this.track.kind?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function dV(e){if(!("object"==typeof e&&e.RTCPeerConnection&&e.RTCRtpSender&&e.RTCRtpReceiver))return;if(!("getStats"in e.RTCRtpSender.prototype)){const t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){const e=t.apply(this,[]);return e.forEach((e=>e._pc=this)),e});const n=e.RTCPeerConnection.prototype.addTrack;n&&(e.RTCPeerConnection.prototype.addTrack=function(){const e=n.apply(this,arguments);return e._pc=this,e}),e.RTCRtpSender.prototype.getStats=function(){const e=this;return this._pc.getStats().then((t=>m8(t,e.track,!0)))}}if(!("getStats"in e.RTCRtpReceiver.prototype)){const t=e.RTCPeerConnection.prototype.getReceivers;t&&(e.RTCPeerConnection.prototype.getReceivers=function(){const e=t.apply(this,[]);return e.forEach((e=>e._pc=this)),e}),Xd(e,"track",(e=>(e.receiver._pc=e.srcElement,e))),e.RTCRtpReceiver.prototype.getStats=function(){const e=this;return this._pc.getStats().then((t=>m8(t,e.track,!1)))}}if(!("getStats"in e.RTCRtpSender.prototype)||!("getStats"in e.RTCRtpReceiver.prototype))return;const t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof e.MediaStreamTrack){const e=arguments[0];let t,n,r;return this.getSenders().forEach((n=>{n.track===e&&(t?r=!0:t=n)})),this.getReceivers().forEach((t=>(t.track===e&&(n?r=!0:n=t),t.track===e))),r||t&&n?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):t?t.getStats():n?n.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return t.apply(this,arguments)}}function fV(e){e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map((e=>this._shimmedLocalStreams[e][0]))};const t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(e,n){if(!n)return t.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const r=t.apply(this,arguments);return this._shimmedLocalStreams[n.id]?-1===this._shimmedLocalStreams[n.id].indexOf(r)&&this._shimmedLocalStreams[n.id].push(r):this._shimmedLocalStreams[n.id]=[n,r],r};const n=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(e){this._shimmedLocalStreams=this._shimmedLocalStreams||{},e.getTracks().forEach((e=>{if(this.getSenders().find((t=>t.track===e)))throw new DOMException("Track already exists.","InvalidAccessError")}));const t=this.getSenders();n.apply(this,arguments);const r=this.getSenders().filter((e=>-1===t.indexOf(e)));this._shimmedLocalStreams[e.id]=[e].concat(r)};const r=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[e.id],r.apply(this,arguments)};const i=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(e){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},e&&Object.keys(this._shimmedLocalStreams).forEach((t=>{const n=this._shimmedLocalStreams[t].indexOf(e);-1!==n&&this._shimmedLocalStreams[t].splice(n,1),1===this._shimmedLocalStreams[t].length&&delete this._shimmedLocalStreams[t]})),i.apply(this,arguments)}}function hV(e,t){if(!e.RTCPeerConnection)return;if(e.RTCPeerConnection.prototype.addTrack&&t.version>=65)return fV(e);const n=e.RTCPeerConnection.prototype.getLocalStreams;e.RTCPeerConnection.prototype.getLocalStreams=function(){const e=n.apply(this);return this._reverseStreams=this._reverseStreams||{},e.map((e=>this._reverseStreams[e.id]))};const r=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(t){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},t.getTracks().forEach((e=>{if(this.getSenders().find((t=>t.track===e)))throw new DOMException("Track already exists.","InvalidAccessError")})),!this._reverseStreams[t.id]){const n=new e.MediaStream(t.getTracks());this._streams[t.id]=n,this._reverseStreams[n.id]=t,t=n}r.apply(this,[t])};const i=e.RTCPeerConnection.prototype.removeStream;function o(e,t){let n=t.sdp;return Object.keys(e._reverseStreams||[]).forEach((t=>{const r=e._reverseStreams[t],i=e._streams[r.id];n=n.replace(new RegExp(i.id,"g"),r.id)})),new RTCSessionDescription({type:t.type,sdp:n})}e.RTCPeerConnection.prototype.removeStream=function(e){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},i.apply(this,[this._streams[e.id]||e]),delete this._reverseStreams[this._streams[e.id]?this._streams[e.id].id:e.id],delete this._streams[e.id]},e.RTCPeerConnection.prototype.addTrack=function(t,n){if("closed"===this.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const r=[].slice.call(arguments,1);if(1!==r.length||!r[0].getTracks().find((e=>e===t)))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find((e=>e.track===t)))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const i=this._streams[n.id];if(i)i.addTrack(t),Promise.resolve().then((()=>{this.dispatchEvent(new Event("negotiationneeded"))}));else{const r=new e.MediaStream([t]);this._streams[n.id]=r,this._reverseStreams[r.id]=n,this.addStream(r)}return this.getSenders().find((e=>e.track===t))},["createOffer","createAnswer"].forEach((function(t){const n=e.RTCPeerConnection.prototype[t],r={[t](){const e=arguments;return arguments.length&&"function"==typeof arguments[0]?n.apply(this,[t=>{const n=o(this,t);e[0].apply(null,[n])},t=>{e[1]&&e[1].apply(null,t)},arguments[2]]):n.apply(this,arguments).then((e=>o(this,e)))}};e.RTCPeerConnection.prototype[t]=r[t]}));const s=e.RTCPeerConnection.prototype.setLocalDescription;e.RTCPeerConnection.prototype.setLocalDescription=function(){return arguments.length&&arguments[0].type?(arguments[0]=function(e,t){let n=t.sdp;return Object.keys(e._reverseStreams||[]).forEach((t=>{const r=e._reverseStreams[t],i=e._streams[r.id];n=n.replace(new RegExp(r.id,"g"),i.id)})),new RTCSessionDescription({type:t.type,sdp:n})}(this,arguments[0]),s.apply(this,arguments)):s.apply(this,arguments)};const a=Object.getOwnPropertyDescriptor(e.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(e.RTCPeerConnection.prototype,"localDescription",{get(){const e=a.get.apply(this);return""===e.type?e:o(this,e)}}),e.RTCPeerConnection.prototype.removeTrack=function(e){if("closed"===this.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!e._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(e._pc!==this)throw new DOMException("Sender was not created by this connection.","InvalidAccessError");let t;this._streams=this._streams||{},Object.keys(this._streams).forEach((n=>{this._streams[n].getTracks().find((t=>e.track===t))&&(t=this._streams[n])})),t&&(1===t.getTracks().length?this.removeStream(this._reverseStreams[t.id]):t.removeTrack(e.track),this.dispatchEvent(new Event("negotiationneeded")))}}function Zk(e,t){!e.RTCPeerConnection&&e.webkitRTCPeerConnection&&(e.RTCPeerConnection=e.webkitRTCPeerConnection),e.RTCPeerConnection&&t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach((function(t){const n=e.RTCPeerConnection.prototype[t],r={[t](){return arguments[0]=new("addIceCandidate"===t?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),n.apply(this,arguments)}};e.RTCPeerConnection.prototype[t]=r[t]}))}function pV(e,t){Xd(e,"negotiationneeded",(e=>{const n=e.target;if(!(t.version<72||n.getConfiguration&&"plan-b"===n.getConfiguration().sdpSemantics)||"stable"===n.signalingState)return e}))}var v8=Object.freeze({__proto__:null,fixNegotiationNeeded:pV,shimAddTrackRemoveTrack:hV,shimAddTrackRemoveTrackWithNative:fV,shimGetSendersWithDtmf:uV,shimGetUserMedia:aV,shimMediaStream:lV,shimOnTrack:cV,shimPeerConnection:Zk,shimSenderReceiverGetStats:dV});function mV(e,t){const n=e&&e.navigator,r=e&&e.MediaStreamTrack;if(n.getUserMedia=function(e,t,r){pL("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),n.mediaDevices.getUserMedia(e).then(t,r)},!(t.version>55&&"autoGainControl"in n.mediaDevices.getSupportedConstraints())){const e=function(e,t,n){t in e&&!(n in e)&&(e[n]=e[t],delete e[t])},t=n.mediaDevices.getUserMedia.bind(n.mediaDevices);if(n.mediaDevices.getUserMedia=function(n){return"object"==typeof n&&"object"==typeof n.audio&&(n=JSON.parse(JSON.stringify(n)),e(n.audio,"autoGainControl","mozAutoGainControl"),e(n.audio,"noiseSuppression","mozNoiseSuppression")),t(n)},r&&r.prototype.getSettings){const t=r.prototype.getSettings;r.prototype.getSettings=function(){const n=t.apply(this,arguments);return e(n,"mozAutoGainControl","autoGainControl"),e(n,"mozNoiseSuppression","noiseSuppression"),n}}if(r&&r.prototype.applyConstraints){const t=r.prototype.applyConstraints;r.prototype.applyConstraints=function(n){return"audio"===this.kind&&"object"==typeof n&&(n=JSON.parse(JSON.stringify(n)),e(n,"autoGainControl","mozAutoGainControl"),e(n,"noiseSuppression","mozNoiseSuppression")),t.apply(this,[n])}}}}function iue(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&(e.navigator.mediaDevices.getDisplayMedia=function(n){if(!n||!n.video){const e=new DOMException("getDisplayMedia without video constraints is undefined");return e.name="NotFoundError",e.code=8,Promise.reject(e)}return!0===n.video?n.video={mediaSource:t}:n.video.mediaSource=t,e.navigator.mediaDevices.getUserMedia(n)})}function gV(e){"object"==typeof e&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function Qk(e,t){if("object"!=typeof e||!e.RTCPeerConnection&&!e.mozRTCPeerConnection)return;!e.RTCPeerConnection&&e.mozRTCPeerConnection&&(e.RTCPeerConnection=e.mozRTCPeerConnection),t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach((function(t){const n=e.RTCPeerConnection.prototype[t],r={[t](){return arguments[0]=new("addIceCandidate"===t?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),n.apply(this,arguments)}};e.RTCPeerConnection.prototype[t]=r[t]}));const n={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},r=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){const[e,i,o]=arguments;return r.apply(this,[e||null]).then((e=>{if(t.version<53&&!i)try{e.forEach((e=>{e.type=n[e.type]||e.type}))}catch(t){if("TypeError"!==t.name)throw t;e.forEach(((t,r)=>{e.set(r,Object.assign({},t,{type:n[t.type]||t.type}))}))}return e})).then(i,o)}}function vV(e){if("object"!=typeof e||!e.RTCPeerConnection||!e.RTCRtpSender||e.RTCRtpSender&&"getStats"in e.RTCRtpSender.prototype)return;const t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){const e=t.apply(this,[]);return e.forEach((e=>e._pc=this)),e});const n=e.RTCPeerConnection.prototype.addTrack;n&&(e.RTCPeerConnection.prototype.addTrack=function(){const e=n.apply(this,arguments);return e._pc=this,e}),e.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}}function yV(e){if("object"!=typeof e||!e.RTCPeerConnection||!e.RTCRtpSender||e.RTCRtpSender&&"getStats"in e.RTCRtpReceiver.prototype)return;const t=e.RTCPeerConnection.prototype.getReceivers;t&&(e.RTCPeerConnection.prototype.getReceivers=function(){const e=t.apply(this,[]);return e.forEach((e=>e._pc=this)),e}),Xd(e,"track",(e=>(e.receiver._pc=e.srcElement,e))),e.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function _V(e){!e.RTCPeerConnection||"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(e){pL("removeStream","removeTrack"),this.getSenders().forEach((t=>{t.track&&e.getTracks().includes(t.track)&&this.removeTrack(t)}))})}function bV(e){e.DataChannel&&!e.RTCDataChannel&&(e.RTCDataChannel=e.DataChannel)}function SV(e){if("object"!=typeof e||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.addTransceiver;t&&(e.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];let e=arguments[1]&&arguments[1].sendEncodings;void 0===e&&(e=[]),e=[...e];const n=e.length>0;n&&e.forEach((e=>{if("rid"in e&&!/^[a-z0-9]{0,16}$/i.test(e.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in e&&!(parseFloat(e.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in e&&!(parseFloat(e.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")}));const r=t.apply(this,arguments);if(n){const{sender:t}=r,n=t.getParameters();(!("encodings"in n)||1===n.encodings.length&&0===Object.keys(n.encodings[0]).length)&&(n.encodings=e,t.sendEncodings=e,this.setParametersPromises.push(t.setParameters(n).then((()=>{delete t.sendEncodings})).catch((()=>{delete t.sendEncodings}))))}return r})}function EV(e){if("object"!=typeof e||!e.RTCRtpSender)return;const t=e.RTCRtpSender.prototype.getParameters;t&&(e.RTCRtpSender.prototype.getParameters=function(){const e=t.apply(this,arguments);return"encodings"in e||(e.encodings=[].concat(this.sendEncodings||[{}])),e})}function wV(e){if("object"!=typeof e||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then((()=>t.apply(this,arguments))).finally((()=>{this.setParametersPromises=[]})):t.apply(this,arguments)}}function CV(e){if("object"!=typeof e||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.createAnswer;e.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then((()=>t.apply(this,arguments))).finally((()=>{this.setParametersPromises=[]})):t.apply(this,arguments)}}var y8=Object.freeze({__proto__:null,shimAddTransceiver:SV,shimCreateAnswer:CV,shimCreateOffer:wV,shimGetDisplayMedia:iue,shimGetParameters:EV,shimGetUserMedia:mV,shimOnTrack:gV,shimPeerConnection:Qk,shimRTCDataChannel:bV,shimReceiverGetStats:yV,shimRemoveStream:_V,shimSenderGetStats:vV});function TV(e){if("object"==typeof e&&e.RTCPeerConnection){if("getLocalStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in e.RTCPeerConnection.prototype)){const t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addStream=function(e){this._localStreams||(this._localStreams=[]),this._localStreams.includes(e)||this._localStreams.push(e),e.getAudioTracks().forEach((n=>t.call(this,n,e))),e.getVideoTracks().forEach((n=>t.call(this,n,e)))},e.RTCPeerConnection.prototype.addTrack=function(e){for(var n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];return r&&r.forEach((e=>{this._localStreams?this._localStreams.includes(e)||this._localStreams.push(e):this._localStreams=[e]})),t.apply(this,arguments)}}"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(e){this._localStreams||(this._localStreams=[]);const t=this._localStreams.indexOf(e);if(-1===t)return;this._localStreams.splice(t,1);const n=e.getTracks();this.getSenders().forEach((e=>{n.includes(e.track)&&this.removeTrack(e)}))})}}function RV(e){if("object"==typeof e&&e.RTCPeerConnection&&("getRemoteStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in e.RTCPeerConnection.prototype))){Object.defineProperty(e.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(e){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=e),this.addEventListener("track",this._onaddstreampoly=e=>{e.streams.forEach((e=>{if(this._remoteStreams||(this._remoteStreams=[]),this._remoteStreams.includes(e))return;this._remoteStreams.push(e);const t=new Event("addstream");t.stream=e,this.dispatchEvent(t)}))})}});const t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){const e=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(t){t.streams.forEach((t=>{if(e._remoteStreams||(e._remoteStreams=[]),e._remoteStreams.indexOf(t)>=0)return;e._remoteStreams.push(t);const n=new Event("addstream");n.stream=t,e.dispatchEvent(n)}))}),t.apply(e,arguments)}}}function IV(e){if("object"!=typeof e||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype,n=t.createOffer,r=t.createAnswer,i=t.setLocalDescription,o=t.setRemoteDescription,s=t.addIceCandidate;t.createOffer=function(e,t){const r=arguments.length>=2?arguments[2]:arguments[0],i=n.apply(this,[r]);return t?(i.then(e,t),Promise.resolve()):i},t.createAnswer=function(e,t){const n=arguments.length>=2?arguments[2]:arguments[0],i=r.apply(this,[n]);return t?(i.then(e,t),Promise.resolve()):i};let a=function(e,t,n){const r=i.apply(this,[e]);return n?(r.then(t,n),Promise.resolve()):r};t.setLocalDescription=a,a=function(e,t,n){const r=o.apply(this,[e]);return n?(r.then(t,n),Promise.resolve()):r},t.setRemoteDescription=a,a=function(e,t,n){const r=s.apply(this,[e]);return n?(r.then(t,n),Promise.resolve()):r},t.addIceCandidate=a}function kV(e){const t=e&&e.navigator;if(t.mediaDevices&&t.mediaDevices.getUserMedia){const e=t.mediaDevices,n=e.getUserMedia.bind(e);t.mediaDevices.getUserMedia=e=>n(xV(e))}!t.getUserMedia&&t.mediaDevices&&t.mediaDevices.getUserMedia&&(t.getUserMedia=function(e,n,r){t.mediaDevices.getUserMedia(e).then(n,r)}.bind(t))}function xV(e){return e&&void 0!==e.video?Object.assign({},e,{video:oV(e.video)}):e}function PV(e){if(!e.RTCPeerConnection)return;const t=e.RTCPeerConnection;e.RTCPeerConnection=function(e,n){if(e&&e.iceServers){const t=[];for(let n=0;n<e.iceServers.length;n++){let r=e.iceServers[n];void 0===r.urls&&r.url?(pL("RTCIceServer.url","RTCIceServer.urls"),r=JSON.parse(JSON.stringify(r)),r.urls=r.url,delete r.url,t.push(r)):t.push(e.iceServers[n])}e.iceServers=t}return new t(e,n)},e.RTCPeerConnection.prototype=t.prototype,"generateCertificate"in t&&Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:()=>t.generateCertificate})}function LV(e){"object"==typeof e&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function OV(e){const t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(e){if(e){typeof e.offerToReceiveAudio<"u"&&(e.offerToReceiveAudio=!!e.offerToReceiveAudio);const t=this.getTransceivers().find((e=>"audio"===e.receiver.track.kind));!1===e.offerToReceiveAudio&&t?"sendrecv"===t.direction?t.setDirection?t.setDirection("sendonly"):t.direction="sendonly":"recvonly"===t.direction&&(t.setDirection?t.setDirection("inactive"):t.direction="inactive"):!0===e.offerToReceiveAudio&&!t&&this.addTransceiver("audio",{direction:"recvonly"}),typeof e.offerToReceiveVideo<"u"&&(e.offerToReceiveVideo=!!e.offerToReceiveVideo);const n=this.getTransceivers().find((e=>"video"===e.receiver.track.kind));!1===e.offerToReceiveVideo&&n?"sendrecv"===n.direction?n.setDirection?n.setDirection("sendonly"):n.direction="sendonly":"recvonly"===n.direction&&(n.setDirection?n.setDirection("inactive"):n.direction="inactive"):!0===e.offerToReceiveVideo&&!n&&this.addTransceiver("video",{direction:"recvonly"})}return t.apply(this,arguments)}}function MV(e){"object"!=typeof e||e.AudioContext||(e.AudioContext=e.webkitAudioContext)}var b8,_8=Object.freeze({__proto__:null,shimAudioContext:MV,shimCallbacksAPI:IV,shimConstraints:xV,shimCreateOfferLegacy:OV,shimGetUserMedia:kV,shimLocalStreamsAPI:TV,shimRTCIceServerUrls:PV,shimRemoteStreamsAPI:RV,shimTrackEventTransceiver:LV}),S2={exports:{}};function sue(){return b8||(b8=1,function(e){const t={generateIdentifier:function(){return Math.random().toString(36).substring(2,12)}};t.localCName=t.generateIdentifier(),t.splitLines=function(e){return e.trim().split("\n").map((e=>e.trim()))},t.splitSections=function(e){return e.split("\nm=").map(((e,t)=>(t>0?"m="+e:e).trim()+"\r\n"))},t.getDescription=function(e){const n=t.splitSections(e);return n&&n[0]},t.getMediaSections=function(e){const n=t.splitSections(e);return n.shift(),n},t.matchPrefix=function(e,n){return t.splitLines(e).filter((e=>0===e.indexOf(n)))},t.parseCandidate=function(e){let t;t=0===e.indexOf("a=candidate:")?e.substring(12).split(" "):e.substring(10).split(" ");const n={foundation:t[0],component:{1:"rtp",2:"rtcp"}[t[1]]||t[1],protocol:t[2].toLowerCase(),priority:parseInt(t[3],10),ip:t[4],address:t[4],port:parseInt(t[5],10),type:t[7]};for(let e=8;e<t.length;e+=2)switch(t[e]){case"raddr":n.relatedAddress=t[e+1];break;case"rport":n.relatedPort=parseInt(t[e+1],10);break;case"tcptype":n.tcpType=t[e+1];break;case"ufrag":n.ufrag=t[e+1],n.usernameFragment=t[e+1];break;default:void 0===n[t[e]]&&(n[t[e]]=t[e+1])}return n},t.writeCandidate=function(e){const t=[];t.push(e.foundation);const n=e.component;"rtp"===n?t.push(1):"rtcp"===n?t.push(2):t.push(n),t.push(e.protocol.toUpperCase()),t.push(e.priority),t.push(e.address||e.ip),t.push(e.port);const r=e.type;return t.push("typ"),t.push(r),"host"!==r&&e.relatedAddress&&e.relatedPort&&(t.push("raddr"),t.push(e.relatedAddress),t.push("rport"),t.push(e.relatedPort)),e.tcpType&&"tcp"===e.protocol.toLowerCase()&&(t.push("tcptype"),t.push(e.tcpType)),(e.usernameFragment||e.ufrag)&&(t.push("ufrag"),t.push(e.usernameFragment||e.ufrag)),"candidate:"+t.join(" ")},t.parseIceOptions=function(e){return e.substring(14).split(" ")},t.parseRtpMap=function(e){let t=e.substring(9).split(" ");const n={payloadType:parseInt(t.shift(),10)};return t=t[0].split("/"),n.name=t[0],n.clockRate=parseInt(t[1],10),n.channels=3===t.length?parseInt(t[2],10):1,n.numChannels=n.channels,n},t.writeRtpMap=function(e){let t=e.payloadType;void 0!==e.preferredPayloadType&&(t=e.preferredPayloadType);const n=e.channels||e.numChannels||1;return"a=rtpmap:"+t+" "+e.name+"/"+e.clockRate+(1!==n?"/"+n:"")+"\r\n"},t.parseExtmap=function(e){const t=e.substring(9).split(" ");return{id:parseInt(t[0],10),direction:t[0].indexOf("/")>0?t[0].split("/")[1]:"sendrecv",uri:t[1],attributes:t.slice(2).join(" ")}},t.writeExtmap=function(e){return"a=extmap:"+(e.id||e.preferredId)+(e.direction&&"sendrecv"!==e.direction?"/"+e.direction:"")+" "+e.uri+(e.attributes?" "+e.attributes:"")+"\r\n"},t.parseFmtp=function(e){const t={};let n;const r=e.substring(e.indexOf(" ")+1).split(";");for(let e=0;e<r.length;e++)n=r[e].trim().split("="),t[n[0].trim()]=n[1];return t},t.writeFmtp=function(e){let t="",n=e.payloadType;if(void 0!==e.preferredPayloadType&&(n=e.preferredPayloadType),e.parameters&&Object.keys(e.parameters).length){const r=[];Object.keys(e.parameters).forEach((t=>{void 0!==e.parameters[t]?r.push(t+"="+e.parameters[t]):r.push(t)})),t+="a=fmtp:"+n+" "+r.join(";")+"\r\n"}return t},t.parseRtcpFb=function(e){const t=e.substring(e.indexOf(" ")+1).split(" ");return{type:t.shift(),parameter:t.join(" ")}},t.writeRtcpFb=function(e){let t="",n=e.payloadType;return void 0!==e.preferredPayloadType&&(n=e.preferredPayloadType),e.rtcpFeedback&&e.rtcpFeedback.length&&e.rtcpFeedback.forEach((e=>{t+="a=rtcp-fb:"+n+" "+e.type+(e.parameter&&e.parameter.length?" "+e.parameter:"")+"\r\n"})),t},t.parseSsrcMedia=function(e){const t=e.indexOf(" "),n={ssrc:parseInt(e.substring(7,t),10)},r=e.indexOf(":",t);return r>-1?(n.attribute=e.substring(t+1,r),n.value=e.substring(r+1)):n.attribute=e.substring(t+1),n},t.parseSsrcGroup=function(e){const t=e.substring(13).split(" ");return{semantics:t.shift(),ssrcs:t.map((e=>parseInt(e,10)))}},t.getMid=function(e){const n=t.matchPrefix(e,"a=mid:")[0];if(n)return n.substring(6)},t.parseFingerprint=function(e){const t=e.substring(14).split(" ");return{algorithm:t[0].toLowerCase(),value:t[1].toUpperCase()}},t.getDtlsParameters=function(e,n){return{role:"auto",fingerprints:t.matchPrefix(e+n,"a=fingerprint:").map(t.parseFingerprint)}},t.writeDtlsParameters=function(e,t){let n="a=setup:"+t+"\r\n";return e.fingerprints.forEach((e=>{n+="a=fingerprint:"+e.algorithm+" "+e.value+"\r\n"})),n},t.parseCryptoLine=function(e){const t=e.substring(9).split(" ");return{tag:parseInt(t[0],10),cryptoSuite:t[1],keyParams:t[2],sessionParams:t.slice(3)}},t.writeCryptoLine=function(e){return"a=crypto:"+e.tag+" "+e.cryptoSuite+" "+("object"==typeof e.keyParams?t.writeCryptoKeyParams(e.keyParams):e.keyParams)+(e.sessionParams?" "+e.sessionParams.join(" "):"")+"\r\n"},t.parseCryptoKeyParams=function(e){if(0!==e.indexOf("inline:"))return null;const t=e.substring(7).split("|");return{keyMethod:"inline",keySalt:t[0],lifeTime:t[1],mkiValue:t[2]?t[2].split(":")[0]:void 0,mkiLength:t[2]?t[2].split(":")[1]:void 0}},t.writeCryptoKeyParams=function(e){return e.keyMethod+":"+e.keySalt+(e.lifeTime?"|"+e.lifeTime:"")+(e.mkiValue&&e.mkiLength?"|"+e.mkiValue+":"+e.mkiLength:"")},t.getCryptoParameters=function(e,n){return t.matchPrefix(e+n,"a=crypto:").map(t.parseCryptoLine)},t.getIceParameters=function(e,n){const r=t.matchPrefix(e+n,"a=ice-ufrag:")[0],i=t.matchPrefix(e+n,"a=ice-pwd:")[0];return r&&i?{usernameFragment:r.substring(12),password:i.substring(10)}:null},t.writeIceParameters=function(e){let t="a=ice-ufrag:"+e.usernameFragment+"\r\na=ice-pwd:"+e.password+"\r\n";return e.iceLite&&(t+="a=ice-lite\r\n"),t},t.parseRtpParameters=function(e){const n={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},r=t.splitLines(e)[0].split(" ");n.profile=r[2];for(let i=3;i<r.length;i++){const o=r[i],s=t.matchPrefix(e,"a=rtpmap:"+o+" ")[0];if(s){const r=t.parseRtpMap(s),i=t.matchPrefix(e,"a=fmtp:"+o+" ");switch(r.parameters=i.length?t.parseFmtp(i[0]):{},r.rtcpFeedback=t.matchPrefix(e,"a=rtcp-fb:"+o+" ").map(t.parseRtcpFb),n.codecs.push(r),r.name.toUpperCase()){case"RED":case"ULPFEC":n.fecMechanisms.push(r.name.toUpperCase())}}}t.matchPrefix(e,"a=extmap:").forEach((e=>{n.headerExtensions.push(t.parseExtmap(e))}));const i=t.matchPrefix(e,"a=rtcp-fb:* ").map(t.parseRtcpFb);return n.codecs.forEach((e=>{i.forEach((t=>{e.rtcpFeedback.find((e=>e.type===t.type&&e.parameter===t.parameter))||e.rtcpFeedback.push(t)}))})),n},t.writeRtpDescription=function(e,n){let r="";r+="m="+e+" ",r+=n.codecs.length>0?"9":"0",r+=" "+(n.profile||"UDP/TLS/RTP/SAVPF")+" ",r+=n.codecs.map((e=>void 0!==e.preferredPayloadType?e.preferredPayloadType:e.payloadType)).join(" ")+"\r\n",r+="c=IN IP4 0.0.0.0\r\n",r+="a=rtcp:9 IN IP4 0.0.0.0\r\n",n.codecs.forEach((e=>{r+=t.writeRtpMap(e),r+=t.writeFmtp(e),r+=t.writeRtcpFb(e)}));let i=0;return n.codecs.forEach((e=>{e.maxptime>i&&(i=e.maxptime)})),i>0&&(r+="a=maxptime:"+i+"\r\n"),n.headerExtensions&&n.headerExtensions.forEach((e=>{r+=t.writeExtmap(e)})),r},t.parseRtpEncodingParameters=function(e){const n=[],r=t.parseRtpParameters(e),i=-1!==r.fecMechanisms.indexOf("RED"),o=-1!==r.fecMechanisms.indexOf("ULPFEC"),s=t.matchPrefix(e,"a=ssrc:").map((e=>t.parseSsrcMedia(e))).filter((e=>"cname"===e.attribute)),a=s.length>0&&s[0].ssrc;let l;const c=t.matchPrefix(e,"a=ssrc-group:FID").map((e=>e.substring(17).split(" ").map((e=>parseInt(e,10)))));c.length>0&&c[0].length>1&&c[0][0]===a&&(l=c[0][1]),r.codecs.forEach((e=>{if("RTX"===e.name.toUpperCase()&&e.parameters.apt){let t={ssrc:a,codecPayloadType:parseInt(e.parameters.apt,10)};a&&l&&(t.rtx={ssrc:l}),n.push(t),i&&(t=JSON.parse(JSON.stringify(t)),t.fec={ssrc:a,mechanism:o?"red+ulpfec":"red"},n.push(t))}})),0===n.length&&a&&n.push({ssrc:a});let u=t.matchPrefix(e,"b=");return u.length&&(u=0===u[0].indexOf("b=TIAS:")?parseInt(u[0].substring(7),10):0===u[0].indexOf("b=AS:")?1e3*parseInt(u[0].substring(5),10)*.95-16e3:void 0,n.forEach((e=>{e.maxBitrate=u}))),n},t.parseRtcpParameters=function(e){const n={},r=t.matchPrefix(e,"a=ssrc:").map((e=>t.parseSsrcMedia(e))).filter((e=>"cname"===e.attribute))[0];r&&(n.cname=r.value,n.ssrc=r.ssrc);const i=t.matchPrefix(e,"a=rtcp-rsize");n.reducedSize=i.length>0,n.compound=0===i.length;const o=t.matchPrefix(e,"a=rtcp-mux");return n.mux=o.length>0,n},t.writeRtcpParameters=function(e){let t="";return e.reducedSize&&(t+="a=rtcp-rsize\r\n"),e.mux&&(t+="a=rtcp-mux\r\n"),void 0!==e.ssrc&&e.cname&&(t+="a=ssrc:"+e.ssrc+" cname:"+e.cname+"\r\n"),t},t.parseMsid=function(e){let n;const r=t.matchPrefix(e,"a=msid:");if(1===r.length)return n=r[0].substring(7).split(" "),{stream:n[0],track:n[1]};const i=t.matchPrefix(e,"a=ssrc:").map((e=>t.parseSsrcMedia(e))).filter((e=>"msid"===e.attribute));return i.length>0?(n=i[0].value.split(" "),{stream:n[0],track:n[1]}):void 0},t.parseSctpDescription=function(e){const n=t.parseMLine(e),r=t.matchPrefix(e,"a=max-message-size:");let i;r.length>0&&(i=parseInt(r[0].substring(19),10)),isNaN(i)&&(i=65536);const o=t.matchPrefix(e,"a=sctp-port:");if(o.length>0)return{port:parseInt(o[0].substring(12),10),protocol:n.fmt,maxMessageSize:i};const s=t.matchPrefix(e,"a=sctpmap:");if(s.length>0){const e=s[0].substring(10).split(" ");return{port:parseInt(e[0],10),protocol:e[1],maxMessageSize:i}}},t.writeSctpDescription=function(e,t){let n=[];return n="DTLS/SCTP"!==e.protocol?["m="+e.kind+" 9 "+e.protocol+" "+t.protocol+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctp-port:"+t.port+"\r\n"]:["m="+e.kind+" 9 "+e.protocol+" "+t.port+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctpmap:"+t.port+" "+t.protocol+" 65535\r\n"],void 0!==t.maxMessageSize&&n.push("a=max-message-size:"+t.maxMessageSize+"\r\n"),n.join("")},t.generateSessionId=function(){return Math.random().toString().substr(2,22)},t.writeSessionBoilerplate=function(e,n,r){let i;const o=void 0!==n?n:2;return i=e||t.generateSessionId(),"v=0\r\no="+(r||"thisisadapterortc")+" "+i+" "+o+" IN IP4 127.0.0.1\r\ns=-\r\nt=0 0\r\n"},t.getDirection=function(e,n){const r=t.splitLines(e);for(let e=0;e<r.length;e++)switch(r[e]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return r[e].substring(2)}return n?t.getDirection(n):"sendrecv"},t.getKind=function(e){return t.splitLines(e)[0].split(" ")[0].substring(2)},t.isRejected=function(e){return"0"===e.split(" ",2)[1]},t.parseMLine=function(e){const n=t.splitLines(e)[0].substring(2).split(" ");return{kind:n[0],port:parseInt(n[1],10),protocol:n[2],fmt:n.slice(3).join(" ")}},t.parseOLine=function(e){const n=t.matchPrefix(e,"o=")[0].substring(2).split(" ");return{username:n[0],sessionId:n[1],sessionVersion:parseInt(n[2],10),netType:n[3],addressType:n[4],address:n[5]}},t.isValidSDP=function(e){if("string"!=typeof e||0===e.length)return!1;const n=t.splitLines(e);for(let e=0;e<n.length;e++)if(n[e].length<2||"="!==n[e].charAt(1))return!1;return!0},e.exports=t}(S2)),S2.exports}var AV=sue(),$h=Wce(AV),oue=_le({__proto__:null,default:$h},[AV]);function Z_(e){if(!e.RTCIceCandidate||e.RTCIceCandidate&&"foundation"in e.RTCIceCandidate.prototype)return;const t=e.RTCIceCandidate;e.RTCIceCandidate=function(e){if("object"==typeof e&&e.candidate&&0===e.candidate.indexOf("a=")&&((e=JSON.parse(JSON.stringify(e))).candidate=e.candidate.substring(2)),e.candidate&&e.candidate.length){const n=new t(e),r=$h.parseCandidate(e.candidate);for(const e in r)e in n||Object.defineProperty(n,e,{value:r[e]});return n.toJSON=function(){return{candidate:n.candidate,sdpMid:n.sdpMid,sdpMLineIndex:n.sdpMLineIndex,usernameFragment:n.usernameFragment}},n}return new t(e)},e.RTCIceCandidate.prototype=t.prototype,Xd(e,"icecandidate",(t=>(t.candidate&&Object.defineProperty(t,"candidate",{value:new e.RTCIceCandidate(t.candidate),writable:"false"}),t)))}function e3(e){!e.RTCIceCandidate||e.RTCIceCandidate&&"relayProtocol"in e.RTCIceCandidate.prototype||Xd(e,"icecandidate",(e=>{if(e.candidate){const t=$h.parseCandidate(e.candidate.candidate);"relay"===t.type&&(e.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[t.priority>>24])}return e}))}function Q_(e,t){if(!e.RTCPeerConnection)return;"sctp"in e.RTCPeerConnection.prototype||Object.defineProperty(e.RTCPeerConnection.prototype,"sctp",{get(){return typeof this._sctp>"u"?null:this._sctp}});const n=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,"chrome"===t.browser&&t.version>=76){const{sdpSemantics:e}=this.getConfiguration();"plan-b"===e&&Object.defineProperty(this,"sctp",{get(){return typeof this._sctp>"u"?null:this._sctp},enumerable:!0,configurable:!0})}if(function(e){if(!e||!e.sdp)return!1;const t=$h.splitSections(e.sdp);return t.shift(),t.some((e=>{const t=$h.parseMLine(e);return t&&"application"===t.kind&&-1!==t.protocol.indexOf("SCTP")}))}(arguments[0])){const e=function(e){const t=e.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(null===t||t.length<2)return-1;const n=parseInt(t[1],10);return n!=n?-1:n}(arguments[0]),n=function(e){let n=65536;return"firefox"===t.browser&&(n=t.version<57?-1===e?16384:2147483637:t.version<60?57===t.version?65535:65536:2147483637),n}(e),r=function(e,n){let r=65536;"firefox"===t.browser&&57===t.version&&(r=65535);const i=$h.matchPrefix(e.sdp,"a=max-message-size:");return i.length>0?r=parseInt(i[0].substring(19),10):"firefox"===t.browser&&-1!==n&&(r=2147483637),r}(arguments[0],e);let i;i=0===n&&0===r?Number.POSITIVE_INFINITY:0===n||0===r?Math.max(n,r):Math.min(n,r);const o={};Object.defineProperty(o,"maxMessageSize",{get:()=>i}),this._sctp=o}return n.apply(this,arguments)}}function eb(e){if(!e.RTCPeerConnection||!("createDataChannel"in e.RTCPeerConnection.prototype))return;function t(e,t){const n=e.send;e.send=function(){const r=arguments[0],i=r.length||r.size||r.byteLength;if("open"===e.readyState&&t.sctp&&i>t.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+t.sctp.maxMessageSize+" bytes)");return n.apply(e,arguments)}}const n=e.RTCPeerConnection.prototype.createDataChannel;e.RTCPeerConnection.prototype.createDataChannel=function(){const e=n.apply(this,arguments);return t(e,this),e},Xd(e,"datachannel",(e=>(t(e.channel,e.target),e)))}function t3(e){if(!e.RTCPeerConnection||"connectionState"in e.RTCPeerConnection.prototype)return;const t=e.RTCPeerConnection.prototype;Object.defineProperty(t,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(t,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(e){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),e&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=e)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach((e=>{const n=t[e];t[e]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=e=>{const t=e.target;if(t._lastConnectionState!==t.connectionState){t._lastConnectionState=t.connectionState;const n=new Event("connectionstatechange",e);t.dispatchEvent(n)}return e},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),n.apply(this,arguments)}}))}function n3(e,t){if(!e.RTCPeerConnection||"chrome"===t.browser&&t.version>=71||"safari"===t.browser&&t.version>=605)return;const n=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(t){if(t&&t.sdp&&-1!==t.sdp.indexOf("\na=extmap-allow-mixed")){const n=t.sdp.split("\n").filter((e=>"a=extmap-allow-mixed"!==e.trim())).join("\n");e.RTCSessionDescription&&t instanceof e.RTCSessionDescription?arguments[0]=new e.RTCSessionDescription({type:t.type,sdp:n}):t.sdp=n}return n.apply(this,arguments)}}function tb(e,t){if(!e.RTCPeerConnection||!e.RTCPeerConnection.prototype)return;const n=e.RTCPeerConnection.prototype.addIceCandidate;!n||0===n.length||(e.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?("chrome"===t.browser&&t.version<78||"firefox"===t.browser&&t.version<68||"safari"===t.browser)&&arguments[0]&&""===arguments[0].candidate?Promise.resolve():n.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())})}function nb(e,t){if(!e.RTCPeerConnection||!e.RTCPeerConnection.prototype)return;const n=e.RTCPeerConnection.prototype.setLocalDescription;!n||0===n.length||(e.RTCPeerConnection.prototype.setLocalDescription=function(){let e=arguments[0]||{};if("object"!=typeof e||e.type&&e.sdp)return n.apply(this,arguments);if(e={type:e.type,sdp:e.sdp},!e.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":e.type="offer";break;default:e.type="answer"}return e.sdp||"offer"!==e.type&&"answer"!==e.type?n.apply(this,[e]):("offer"===e.type?this.createOffer:this.createAnswer).apply(this).then((e=>n.apply(this,[e])))})}var aue=Object.freeze({__proto__:null,removeExtmapAllowMixed:n3,shimAddIceCandidateNullOrEmpty:tb,shimConnectionState:t3,shimMaxMessageSize:Q_,shimParameterlessSetLocalDescription:nb,shimRTCIceCandidate:Z_,shimRTCIceCandidateRelayProtocol:e3,shimSendThrowTypeError:eb});function lue(){let{window:e}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{shimChrome:!0,shimFirefox:!0,shimSafari:!0};const n=sV,r=rue(e),i={browserDetails:r,commonShim:aue,extractVersion:X_,disableLog:tue,disableWarnings:nue,sdp:oue};switch(r.browser){case"chrome":if(!v8||!Zk||!t.shimChrome)return n("Chrome shim is not included in this adapter release."),i;if(null===r.version)return n("Chrome shim can not determine version, not shimming."),i;n("adapter.js shimming chrome."),i.browserShim=v8,tb(e,r),nb(e),aV(e,r),lV(e),Zk(e,r),cV(e),hV(e,r),uV(e),dV(e),pV(e,r),Z_(e),e3(e),t3(e),Q_(e,r),eb(e),n3(e,r);break;case"firefox":if(!y8||!Qk||!t.shimFirefox)return n("Firefox shim is not included in this adapter release."),i;n("adapter.js shimming firefox."),i.browserShim=y8,tb(e,r),nb(e),mV(e,r),Qk(e,r),gV(e),_V(e),vV(e),yV(e),bV(e),SV(e),EV(e),wV(e),CV(e),Z_(e),t3(e),Q_(e,r),eb(e);break;case"safari":if(!_8||!t.shimSafari)return n("Safari shim is not included in this adapter release."),i;n("adapter.js shimming safari."),i.browserShim=_8,tb(e,r),nb(e),PV(e),OV(e),IV(e),TV(e),RV(e),LV(e),kV(e),MV(e),Z_(e),e3(e),Q_(e,r),eb(e),n3(e,r);break;default:n("Unsupported browser!")}return i}lue({window:typeof window>"u"?void 0:window});const cue=10,O1="lk_e2ee",uue="LKFrameEncryptionKey",due={sharedKey:!1,ratchetSalt:uue,ratchetWindowSize:8,failureTolerance:10,keyringSize:16,allowKeyExtraction:!1};var Xc,S8,Bc,E8,kt,cS,C8,le,oe,Pe,Re;function NV(){return fue()||r3()}function r3(){return typeof window.RTCRtpScriptTransform<"u"}function fue(){return typeof window.RTCRtpSender<"u"&&typeof window.RTCRtpSender.prototype.createEncodedStreams<"u"}function hue(e){return J(this,void 0,void 0,(function*(){let t=new TextEncoder;return yield crypto.subtle.importKey("raw",t.encode(e),{name:"PBKDF2"},!1,["deriveBits","deriveKey"])}))}function DV(e){return J(this,void 0,void 0,(function*(){return yield crypto.subtle.importKey("raw",e,"HKDF",!1,["deriveBits","deriveKey"])}))}!function(e){e.SetKey="setKey",e.RatchetRequest="ratchetRequest",e.KeyRatcheted="keyRatcheted"}(Xc||(Xc={})),(S8||(S8={})).KeyRatcheted="keyRatcheted",function(e){e.ParticipantEncryptionStatusChanged="participantEncryptionStatusChanged",e.EncryptionError="encryptionError"}(Bc||(Bc={})),(E8||(E8={})).Error="cryptorError";class jV extends Oa.EventEmitter{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super(),this.onKeyRatcheted=(e,t)=>{bt.debug("key ratcheted event received",{material:e,keyIndex:t})},this.keyInfoMap=new Map,this.options=Object.assign(Object.assign({},due),e),this.on(Xc.KeyRatcheted,this.onKeyRatcheted)}onSetEncryptionKey(e,t,n){const r={key:e,participantIdentity:t,keyIndex:n};if(!this.options.sharedKey&&!t)throw new Error("participant identity needs to be passed for encryption key if sharedKey option is false");this.keyInfoMap.set("".concat(t??"shared","-").concat(n??0),r),this.emit(Xc.SetKey,r)}getKeys(){return Array.from(this.keyInfoMap.values())}getOptions(){return this.options}ratchetKey(e,t){this.emit(Xc.RatchetRequest,e,t)}}class pue extends jV{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super(Object.assign(Object.assign({},e),{sharedKey:!0,ratchetWindowSize:0,failureTolerance:-1}))}setKey(e){return J(this,void 0,void 0,(function*(){const t="string"==typeof e?yield hue(e):yield DV(e);this.onSetEncryptionKey(t)}))}}class wu extends Error{constructor(e,t){super(t||"an error has occured"),this.name="LiveKitError",this.code=e}}!function(e){e[e.NotAllowed=0]="NotAllowed",e[e.ServerUnreachable=1]="ServerUnreachable",e[e.InternalError=2]="InternalError",e[e.Cancelled=3]="Cancelled",e[e.LeaveRequest=4]="LeaveRequest"}(kt||(kt={}));class en extends wu{constructor(e,t,n,r){super(1,e),this.name="ConnectionError",this.status=n,this.reason=t,this.context=r,this.reasonName=kt[t]}}class mL extends wu{constructor(e){super(21,e??"device is unsupported"),this.name="DeviceUnsupportedError"}}class ml extends wu{constructor(e){super(20,e??"track is invalid"),this.name="TrackInvalidError"}}class mue extends wu{constructor(e){super(10,e??"unsupported server"),this.name="UnsupportedServer"}}class hr extends wu{constructor(e){super(12,e??"unexpected connection state"),this.name="UnexpectedConnectionState"}}class i3 extends wu{constructor(e){super(13,e??"unable to negotiate"),this.name="NegotiationError"}}class E2 extends wu{constructor(e,t){super(15,e),this.name="PublishTrackError",this.status=t}}class w8 extends wu{constructor(e,t){super(15,e),this.reason=t,this.reasonName="string"==typeof t?t:hL[t]}}function gue(e){return typeof e>"u"?e:"function"==typeof structuredClone?structuredClone(e):JSON.parse(JSON.stringify(e))}!function(e){e.PermissionDenied="PermissionDenied",e.NotFound="NotFound",e.DeviceInUse="DeviceInUse",e.Other="Other"}(cS||(cS={})),function(e){e.getFailure=function(t){if(t&&"name"in t)return"NotFoundError"===t.name||"DevicesNotFoundError"===t.name?e.NotFound:"NotAllowedError"===t.name||"PermissionDeniedError"===t.name?e.PermissionDenied:"NotReadableError"===t.name||"TrackStartError"===t.name?e.DeviceInUse:e.Other}}(cS||(cS={})),function(e){e[e.InvalidKey=0]="InvalidKey",e[e.MissingKey=1]="MissingKey",e[e.InternalError=2]="InternalError"}(C8||(C8={})),function(e){e.Connected="connected",e.Reconnecting="reconnecting",e.SignalReconnecting="signalReconnecting",e.Reconnected="reconnected",e.Disconnected="disconnected",e.ConnectionStateChanged="connectionStateChanged",e.MediaDevicesChanged="mediaDevicesChanged",e.ParticipantConnected="participantConnected",e.ParticipantDisconnected="participantDisconnected",e.TrackPublished="trackPublished",e.TrackSubscribed="trackSubscribed",e.TrackSubscriptionFailed="trackSubscriptionFailed",e.TrackUnpublished="trackUnpublished",e.TrackUnsubscribed="trackUnsubscribed",e.TrackMuted="trackMuted",e.TrackUnmuted="trackUnmuted",e.LocalTrackPublished="localTrackPublished",e.LocalTrackUnpublished="localTrackUnpublished",e.LocalAudioSilenceDetected="localAudioSilenceDetected",e.ActiveSpeakersChanged="activeSpeakersChanged",e.ParticipantMetadataChanged="participantMetadataChanged",e.ParticipantNameChanged="participantNameChanged",e.ParticipantAttributesChanged="participantAttributesChanged",e.RoomMetadataChanged="roomMetadataChanged",e.DataReceived="dataReceived",e.SipDTMFReceived="sipDTMFReceived",e.TranscriptionReceived="transcriptionReceived",e.ConnectionQualityChanged="connectionQualityChanged",e.TrackStreamStateChanged="trackStreamStateChanged",e.TrackSubscriptionPermissionChanged="trackSubscriptionPermissionChanged",e.TrackSubscriptionStatusChanged="trackSubscriptionStatusChanged",e.AudioPlaybackStatusChanged="audioPlaybackChanged",e.VideoPlaybackStatusChanged="videoPlaybackChanged",e.MediaDevicesError="mediaDevicesError",e.ParticipantPermissionsChanged="participantPermissionsChanged",e.SignalConnected="signalConnected",e.RecordingStatusChanged="recordingStatusChanged",e.ParticipantEncryptionStatusChanged="participantEncryptionStatusChanged",e.EncryptionError="encryptionError",e.DCBufferStatusChanged="dcBufferStatusChanged",e.ActiveDeviceChanged="activeDeviceChanged",e.ChatMessage="chatMessage",e.LocalTrackSubscribed="localTrackSubscribed",e.MetricsReceived="metricsReceived"}(le||(le={})),function(e){e.TrackPublished="trackPublished",e.TrackSubscribed="trackSubscribed",e.TrackSubscriptionFailed="trackSubscriptionFailed",e.TrackUnpublished="trackUnpublished",e.TrackUnsubscribed="trackUnsubscribed",e.TrackMuted="trackMuted",e.TrackUnmuted="trackUnmuted",e.LocalTrackPublished="localTrackPublished",e.LocalTrackUnpublished="localTrackUnpublished",e.ParticipantMetadataChanged="participantMetadataChanged",e.ParticipantNameChanged="participantNameChanged",e.DataReceived="dataReceived",e.SipDTMFReceived="sipDTMFReceived",e.TranscriptionReceived="transcriptionReceived",e.IsSpeakingChanged="isSpeakingChanged",e.ConnectionQualityChanged="connectionQualityChanged",e.TrackStreamStateChanged="trackStreamStateChanged",e.TrackSubscriptionPermissionChanged="trackSubscriptionPermissionChanged",e.TrackSubscriptionStatusChanged="trackSubscriptionStatusChanged",e.MediaDevicesError="mediaDevicesError",e.AudioStreamAcquired="audioStreamAcquired",e.ParticipantPermissionsChanged="participantPermissionsChanged",e.PCTrackAdded="pcTrackAdded",e.AttributesChanged="attributesChanged",e.LocalTrackSubscribed="localTrackSubscribed",e.ChatMessage="chatMessage"}(oe||(oe={})),function(e){e.TransportsCreated="transportsCreated",e.Connected="connected",e.Disconnected="disconnected",e.Resuming="resuming",e.Resumed="resumed",e.Restarting="restarting",e.Restarted="restarted",e.SignalResumed="signalResumed",e.SignalRestarted="signalRestarted",e.Closing="closing",e.MediaTrackAdded="mediaTrackAdded",e.ActiveSpeakersUpdate="activeSpeakersUpdate",e.DataPacketReceived="dataPacketReceived",e.RTPVideoMapUpdate="rtpVideoMapUpdate",e.DCBufferStatusChanged="dcBufferStatusChanged",e.ParticipantUpdate="participantUpdate",e.RoomUpdate="roomUpdate",e.SpeakersChanged="speakersChanged",e.StreamStateChanged="streamStateChanged",e.ConnectionQualityUpdate="connectionQualityUpdate",e.SubscriptionError="subscriptionError",e.SubscriptionPermissionUpdate="subscriptionPermissionUpdate",e.RemoteMute="remoteMute",e.SubscribedQualityUpdate="subscribedQualityUpdate",e.LocalTrackUnpublished="localTrackUnpublished",e.LocalTrackSubscribed="localTrackSubscribed",e.Offline="offline",e.SignalRequestResponse="signalRequestResponse",e.SignalConnected="signalConnected"}(Pe||(Pe={})),function(e){e.Message="message",e.Muted="muted",e.Unmuted="unmuted",e.Restarted="restarted",e.Ended="ended",e.Subscribed="subscribed",e.Unsubscribed="unsubscribed",e.UpdateSettings="updateSettings",e.UpdateSubscription="updateSubscription",e.AudioPlaybackStarted="audioPlaybackStarted",e.AudioPlaybackFailed="audioPlaybackFailed",e.AudioSilenceDetected="audioSilenceDetected",e.VisibilityChanged="visibilityChanged",e.VideoDimensionsChanged="videoDimensionsChanged",e.VideoPlaybackStarted="videoPlaybackStarted",e.VideoPlaybackFailed="videoPlaybackFailed",e.ElementAttached="elementAttached",e.ElementDetached="elementDetached",e.UpstreamPaused="upstreamPaused",e.UpstreamResumed="upstreamResumed",e.SubscriptionPermissionChanged="subscriptionPermissionChanged",e.SubscriptionStatusChanged="subscriptionStatusChanged",e.SubscriptionFailed="subscriptionFailed",e.TrackProcessorUpdate="trackProcessorUpdate",e.AudioTrackFeatureUpdate="audioTrackFeatureUpdate",e.TranscriptionReceived="transcriptionReceived",e.TimeSyncUpdate="timeSyncUpdate"}(Re||(Re={}));const vue=/version\/(\d+(\.?_?\d+)+)/i;let w2;function Ho(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(typeof navigator>"u")return;const n=navigator.userAgent.toLowerCase();if(void 0===w2||t){const e=yue.find((e=>{let{test:t}=e;return t.test(n)}));w2=null==e?void 0:e.describe(n)}return w2}const yue=[{test:/firefox|iceweasel|fxios/i,describe:e=>({name:"Firefox",version:rb(/(?:firefox|iceweasel|fxios)[\s/](\d+(\.?_?\d+)+)/i,e),os:e.toLowerCase().includes("fxios")?"iOS":void 0,osVersion:C2(e)})},{test:/chrom|crios|crmo/i,describe:e=>({name:"Chrome",version:rb(/(?:chrome|chromium|crios|crmo)\/(\d+(\.?_?\d+)+)/i,e),os:e.toLowerCase().includes("crios")?"iOS":void 0,osVersion:C2(e)})},{test:/safari|applewebkit/i,describe:e=>({name:"Safari",version:rb(vue,e),os:e.includes("mobile/")?"iOS":"macOS",osVersion:C2(e)})}];function rb(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;const r=t.match(e);return r&&r.length>=n&&r[n]||""}function C2(e){return e.includes("mac os")?rb(/\(.+?(\d+_\d+(:?_\d+)?)/,e,1).replace(/_/g,"."):void 0}var _ue="2.11.3";const bue=_ue,Sue=15;class zr{}zr.setTimeout=function(){return setTimeout(...arguments)},zr.setInterval=function(){return setInterval(...arguments)},zr.clearTimeout=function(){return clearTimeout(...arguments)},zr.clearInterval=function(){return clearInterval(...arguments)};const Eue=5e3,ig=[];var Hs;!function(e){e[e.LOW=0]="LOW",e[e.MEDIUM=1]="MEDIUM",e[e.HIGH=2]="HIGH"}(Hs||(Hs={}));let ue=class e extends Oa.EventEmitter{constructor(t,n){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};var i;super(),this.attachedElements=[],this.isMuted=!1,this.streamState=e.StreamState.Active,this.isInBackground=!1,this._currentBitrate=0,this.log=bt,this.appVisibilityChangedListener=()=>{this.backgroundTimeout&&clearTimeout(this.backgroundTimeout),"hidden"===document.visibilityState?this.backgroundTimeout=setTimeout((()=>this.handleAppVisibilityChanged()),Eue):this.handleAppVisibilityChanged()},this.log=Ol(null!==(i=r.loggerName)&&void 0!==i?i:$o.Track),this.loggerContextCb=r.loggerContextCb,this.setMaxListeners(100),this.kind=n,this._mediaStreamTrack=t,this._mediaStreamID=t.id,this.source=e.Source.Unknown}get logContext(){var e;return Object.assign(Object.assign({},null===(e=this.loggerContextCb)||void 0===e?void 0:e.call(this)),Gt(this))}get currentBitrate(){return this._currentBitrate}get mediaStreamTrack(){return this._mediaStreamTrack}get mediaStreamID(){return this._mediaStreamID}attach(t){let n="audio";this.kind===e.Kind.Video&&(n="video"),0===this.attachedElements.length&&this.kind===e.Kind.Video&&this.addAppVisibilityListener(),t||("audio"===n&&(ig.forEach((e=>{null===e.parentElement&&!t&&(t=e)})),t&&ig.splice(ig.indexOf(t),1)),t||(t=document.createElement(n))),this.attachedElements.includes(t)||this.attachedElements.push(t),Sh(this.mediaStreamTrack,t);const r=t.srcObject.getTracks(),i=r.some((e=>"audio"===e.kind));return t.play().then((()=>{this.emit(i?Re.AudioPlaybackStarted:Re.VideoPlaybackStarted)})).catch((e=>{"NotAllowedError"===e.name?this.emit(i?Re.AudioPlaybackFailed:Re.VideoPlaybackFailed,e):"AbortError"===e.name?bt.debug("".concat(i?"audio":"video"," playback aborted, likely due to new play request")):bt.warn("could not playback ".concat(i?"audio":"video"),e),i&&t&&r.some((e=>"video"===e.kind))&&"NotAllowedError"===e.name&&(t.muted=!0,t.play().catch((()=>{})))})),this.emit(Re.ElementAttached,t),t}detach(e){try{if(e){Hh(this.mediaStreamTrack,e);const t=this.attachedElements.indexOf(e);return t>=0&&(this.attachedElements.splice(t,1),this.recycleElement(e),this.emit(Re.ElementDetached,e)),e}const t=[];return this.attachedElements.forEach((e=>{Hh(this.mediaStreamTrack,e),t.push(e),this.recycleElement(e),this.emit(Re.ElementDetached,e)})),this.attachedElements=[],t}finally{0===this.attachedElements.length&&this.removeAppVisibilityListener()}}stop(){this.stopMonitor(),this._mediaStreamTrack.stop()}enable(){this._mediaStreamTrack.enabled=!0}disable(){this._mediaStreamTrack.enabled=!1}stopMonitor(){this.monitorInterval&&clearInterval(this.monitorInterval),this.timeSyncHandle&&cancelAnimationFrame(this.timeSyncHandle)}updateLoggerOptions(e){e.loggerName&&(this.log=Ol(e.loggerName)),e.loggerContextCb&&(this.loggerContextCb=e.loggerContextCb)}recycleElement(e){if(e instanceof HTMLAudioElement){let t=!0;e.pause(),ig.forEach((e=>{e.parentElement||(t=!1)})),t&&ig.push(e)}}handleAppVisibilityChanged(){return J(this,void 0,void 0,(function*(){this.isInBackground="hidden"===document.visibilityState,!this.isInBackground&&this.kind===e.Kind.Video&&setTimeout((()=>this.attachedElements.forEach((e=>e.play().catch((()=>{}))))),0)}))}addAppVisibilityListener(){Wi()?(this.isInBackground="hidden"===document.visibilityState,document.addEventListener("visibilitychange",this.appVisibilityChangedListener)):this.isInBackground=!1}removeAppVisibilityListener(){Wi()&&document.removeEventListener("visibilitychange",this.appVisibilityChangedListener)}};function Sh(e,t){let n,r;n=t.srcObject instanceof MediaStream?t.srcObject:new MediaStream,r="audio"===e.kind?n.getAudioTracks():n.getVideoTracks(),r.includes(e)||(r.forEach((e=>{n.removeTrack(e)})),n.addTrack(e)),uu()&&t instanceof HTMLVideoElement||(t.autoplay=!0),t.muted=0===n.getAudioTracks().length,t instanceof HTMLVideoElement&&(t.playsInline=!0),t.srcObject!==n&&(t.srcObject=n,(uu()||fp())&&t instanceof HTMLVideoElement&&setTimeout((()=>{t.srcObject=n,t.play().catch((()=>{}))}),0))}function Hh(e,t){if(t.srcObject instanceof MediaStream){const n=t.srcObject;n.removeTrack(e),n.getTracks().length>0?t.srcObject=n:t.srcObject=null}}!function(e){let t;var n;let r,i;(n=t=e.Kind||(e.Kind={})).Audio="audio",n.Video="video",n.Unknown="unknown",function(e){e.Camera="camera",e.Microphone="microphone",e.ScreenShare="screen_share",e.ScreenShareAudio="screen_share_audio",e.Unknown="unknown"}(r=e.Source||(e.Source={})),function(e){e.Active="active",e.Paused="paused",e.Unknown="unknown"}(i=e.StreamState||(e.StreamState={})),e.kindToProto=function(e){switch(e){case t.Audio:return Lo.AUDIO;case t.Video:return Lo.VIDEO;default:return Lo.DATA}},e.kindFromProto=function(e){switch(e){case Lo.AUDIO:return t.Audio;case Lo.VIDEO:return t.Video;default:return t.Unknown}},e.sourceToProto=function(e){switch(e){case r.Camera:return or.CAMERA;case r.Microphone:return or.MICROPHONE;case r.ScreenShare:return or.SCREEN_SHARE;case r.ScreenShareAudio:return or.SCREEN_SHARE_AUDIO;default:return or.UNKNOWN}},e.sourceFromProto=function(e){switch(e){case or.CAMERA:return r.Camera;case or.MICROPHONE:return r.Microphone;case or.SCREEN_SHARE:return r.ScreenShare;case or.SCREEN_SHARE_AUDIO:return r.ScreenShareAudio;default:return r.Unknown}},e.streamStateFromProto=function(e){switch(e){case zk.ACTIVE:return i.Active;case zk.PAUSED:return i.Paused;default:return i.Unknown}}}(ue||(ue={}));class Qt{constructor(e,t,n,r,i){if("object"==typeof e)this.width=e.width,this.height=e.height,this.aspectRatio=e.aspectRatio,this.encoding={maxBitrate:e.maxBitrate,maxFramerate:e.maxFramerate,priority:e.priority};else{if(void 0===t||void 0===n)throw new TypeError("Unsupported options: provide at least width, height and maxBitrate");this.width=e,this.height=t,this.aspectRatio=e/t,this.encoding={maxBitrate:n,maxFramerate:r,priority:i}}}get resolution(){return{width:this.width,height:this.height,frameRate:this.encoding.maxFramerate,aspectRatio:this.aspectRatio}}}const wue=["vp8","h264"],Cue=["vp8","h264","vp9","av1"];function Tue(e){return!!wue.find((t=>t===e))}var T8,uS;!function(e){e[e.PREFER_REGRESSION=0]="PREFER_REGRESSION",e[e.SIMULCAST=1]="SIMULCAST",e[e.REGRESSION=2]="REGRESSION"}(T8||(T8={})),function(e){e.telephone={maxBitrate:12e3},e.speech={maxBitrate:24e3},e.music={maxBitrate:48e3},e.musicStereo={maxBitrate:64e3},e.musicHighQuality={maxBitrate:96e3},e.musicHighQualityStereo={maxBitrate:128e3}}(uS||(uS={}));const _a={h90:new Qt(160,90,9e4,20),h180:new Qt(320,180,16e4,20),h216:new Qt(384,216,18e4,20),h360:new Qt(640,360,45e4,20),h540:new Qt(960,540,8e5,25),h720:new Qt(1280,720,17e5,30),h1080:new Qt(1920,1080,3e6,30),h1440:new Qt(2560,1440,5e6,30),h2160:new Qt(3840,2160,8e6,30)},s3={h120:new Qt(160,120,7e4,20),h180:new Qt(240,180,125e3,20),h240:new Qt(320,240,14e4,20),h360:new Qt(480,360,33e4,20),h480:new Qt(640,480,5e5,20),h540:new Qt(720,540,6e5,25),h720:new Qt(960,720,13e5,30),h1080:new Qt(1440,1080,23e5,30),h1440:new Qt(1920,1440,38e5,30)},VE={h360fps3:new Qt(640,360,2e5,3,"medium"),h360fps15:new Qt(640,360,4e5,15,"medium"),h720fps5:new Qt(1280,720,8e5,5,"medium"),h720fps15:new Qt(1280,720,15e5,15,"medium"),h720fps30:new Qt(1280,720,2e6,30,"medium"),h1080fps15:new Qt(1920,1080,25e5,15,"medium"),h1080fps30:new Qt(1920,1080,5e6,30,"medium"),original:new Qt(0,0,7e6,30,"medium")},Rue="|",R8="https://aomediacodec.github.io/av1-rtp-spec/#dependency-descriptor-rtp-header-extension";function Iue(e){const t=e.split("|");return t.length>1?[t[0],e.substr(t[0].length+1)]:[e,""]}function Ji(e){return J(this,void 0,void 0,(function*(){return new Promise((t=>zr.setTimeout(t,e)))}))}function o3(){return"addTransceiver"in RTCPeerConnection.prototype}function a3(){return"addTrack"in RTCPeerConnection.prototype}function kue(){if(!("getCapabilities"in RTCRtpSender)||uu())return!1;const e=RTCRtpSender.getCapabilities("video");let t=!1;if(e)for(const n of e.codecs)if("video/AV1"===n.mimeType){t=!0;break}return t}function xue(){if(!("getCapabilities"in RTCRtpSender)||fp())return!1;if(uu()){const e=Ho();if(null!=e&&e.version&&Nd(e.version,"16")<0)return!1}const e=RTCRtpSender.getCapabilities("video");let t=!1;if(e)for(const n of e.codecs)if("video/VP9"===n.mimeType){t=!0;break}return t}function Xg(e){return"av1"===e||"vp9"===e}function l3(e){return!!document&&(e||(e=document.createElement("audio")),"setSinkId"in e)}function Pue(){return!(typeof RTCPeerConnection>"u")&&(o3()||a3())}function fp(){var e;return"Firefox"===(null===(e=Ho())||void 0===e?void 0:e.name)}function uu(){var e;return"Safari"===(null===(e=Ho())||void 0===e?void 0:e.name)}function Lue(){const e=Ho();return"Safari"===(null==e?void 0:e.name)&&e.version.startsWith("17.")}function UV(){var e,t;return!!Wi()&&(null!==(t=null===(e=navigator.userAgentData)||void 0===e?void 0:e.mobile)&&void 0!==t?t:/Tablet|iPad|Mobile|Android|BlackBerry/.test(navigator.userAgent))}function Oue(){const e=Ho(),t="17.2";if(e)return!!("Safari"!==e.name&&"iOS"!==e.os||"iOS"===e.os&&e.osVersion&&Nd(t,e.osVersion)>=0)||"Safari"===e.name&&Nd(t,e.version)>=0}function Wi(){return typeof document<"u"}function Ca(){return"ReactNative"==navigator.product}function c3(e){return e.hostname.endsWith(".livekit.cloud")||e.hostname.endsWith(".livekit.run")}function FV(){if(global&&global.LiveKitReactNativeGlobal)return global.LiveKitReactNativeGlobal}function $V(){if(!Ca())return;let e=FV();return e?e.platform:void 0}function I8(){if(Wi())return window.devicePixelRatio;if(Ca()){let e=FV();if(e)return e.devicePixelRatio}return 1}function Nd(e,t){const n=e.split("."),r=t.split("."),i=Math.min(n.length,r.length);for(let e=0;e<i;++e){const t=parseInt(n[e],10),o=parseInt(r[e],10);if(t>o)return 1;if(t<o)return-1;if(e===i-1&&t===o)return 0}return""===e&&""!==t?-1:""===t?1:n.length==r.length?0:n.length<r.length?-1:1}function Mue(e){for(const t of e)t.target.handleResize(t)}function Aue(e){for(const t of e)t.target.handleVisibilityChanged(t)}let T2=null;const k8=()=>(T2||(T2=new ResizeObserver(Mue)),T2);let R2=null;const x8=()=>(R2||(R2=new IntersectionObserver(Aue,{root:null,rootMargin:"0px"})),R2);function Nue(){var e;const t=new wce({sdk:FB.JS,protocol:15,version:bue});return Ca()&&(t.os=null!==(e=$V())&&void 0!==e?e:""),t}function P8(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:16,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:16,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const i=document.createElement("canvas");i.width=e,i.height=t;const o=i.getContext("2d");null==o||o.fillRect(0,0,i.width,i.height),r&&o&&(o.beginPath(),o.arc(e/2,t/2,50,0,2*Math.PI,!0),o.closePath(),o.fillStyle="grey",o.fill());const s=i.captureStream(),[a]=s.getTracks();if(!a)throw Error("Could not get empty media stream video track");return a.enabled=n,a}let sg;function I2(){if(!sg){const e=new AudioContext,t=e.createOscillator(),n=e.createGain();n.gain.setValueAtTime(0,0);const r=e.createMediaStreamDestination();if(t.connect(n),n.connect(r),t.start(),[sg]=r.stream.getAudioTracks(),!sg)throw Error("Could not get empty media stream audio track");sg.enabled=!1}return sg.clone()}class HV{constructor(e,t){this.onFinally=t,this.promise=new Promise(((t,n)=>J(this,void 0,void 0,(function*(){this.resolve=t,this.reject=n,e&&(yield e(t,n))})))).finally((()=>{var e;return null===(e=this.onFinally)||void 0===e?void 0:e.call(this)}))}}function Due(e){return Cue.includes(e)}function Zc(e){if("string"==typeof e||"number"==typeof e)return e;if(Array.isArray(e))return e[0];if(e.exact)return Array.isArray(e.exact)?e.exact[0]:e.exact;if(e.ideal)return Array.isArray(e.ideal)?e.ideal[0]:e.ideal;throw Error("could not unwrap constraint")}function jue(e){return e.startsWith("http")?e.replace(/^(http)/,"ws"):e}function u3(e){return e.startsWith("ws")?e.replace(/^(ws)/,"http"):e}function Uue(e,t){return e.segments.map((e=>{let{id:n,text:r,language:i,startTime:o,endTime:s,final:a}=e;var l;const c=null!==(l=t.get(n))&&void 0!==l?l:Date.now(),u=Date.now();return a?t.delete(n):t.set(n,c),{id:n,text:r,startTime:Number.parseInt(o.toString()),endTime:Number.parseInt(s.toString()),final:a,language:i,firstReceivedTime:c,lastReceivedTime:u}}))}function Fue(e){const{id:t,timestamp:n,message:r,editTimestamp:i}=e;return{id:t,timestamp:Number.parseInt(n.toString()),editTimestamp:i?Number.parseInt(i.toString()):void 0,message:r}}function L8(e){switch(e.reason){case kt.LeaveRequest:return e.context;case kt.Cancelled:return Ao.CLIENT_INITIATED;case kt.NotAllowed:return Ao.USER_REJECTED;case kt.ServerUnreachable:return Ao.JOIN_FAILURE;default:return Ao.UNKNOWN_REASON}}function ib(e){return void 0!==e?Number(e):void 0}function ud(e){return void 0!==e?BigInt(e):void 0}function Cd(e){return!!e&&!(e instanceof MediaStreamTrack)&&e.isLocal}function Ml(e){return!!e&&e.kind==ue.Kind.Audio}function Ap(e){return!!e&&e.kind==ue.Kind.Video}function bc(e){return Cd(e)&&Ap(e)}function dd(e){return Cd(e)&&Ml(e)}function d3(e){return!!e&&!e.isLocal}function $ue(e){return!!e&&!e.isLocal}function k2(e){return d3(e)&&Ap(e)}function Hue(e){return e.isLocal}function Bue(e,t){const n=[];let r=(new TextEncoder).encode(e);for(;r.length>t;){let e=t;for(;e>0;){const t=r[e];if(void 0!==t&&128!=(192&t))break;e--}n.push(r.slice(0,e)),r=r.slice(e)}return r.length>0&&n.push(r),n}function BV(e,t,n){var r,i,o,s;const{optionsWithoutProcessor:a,audioProcessor:l,videoProcessor:c}=KV(e??{}),u=null==t?void 0:t.processor,d=null==n?void 0:n.processor,h=a??{};return!0===h.audio&&(h.audio={}),!0===h.video&&(h.video={}),h.audio&&(f3(h.audio,t),null!==(r=(o=h.audio).deviceId)&&void 0!==r||(o.deviceId={ideal:"default"}),(l||u)&&(h.audio.processor=l??u)),h.video&&(f3(h.video,n),null!==(i=(s=h.video).deviceId)&&void 0!==i||(s.deviceId={ideal:"default"}),(c||d)&&(h.video.processor=c??d)),h}function f3(e,t){return Object.keys(t).forEach((n=>{void 0===e[n]&&(e[n]=t[n])})),e}function gL(e){var t,n,r,i;const o={};if(e.video)if("object"==typeof e.video){const n={},i=n,s=e.video;Object.keys(s).forEach((e=>{if("resolution"===e)f3(i,s.resolution);else i[e]=s[e]})),o.video=n,null!==(t=(r=o.video).deviceId)&&void 0!==t||(r.deviceId={ideal:"default"})}else o.video=!!e.video&&{deviceId:{ideal:"default"}};else o.video=!1;return e.audio?"object"==typeof e.audio?(o.audio=e.audio,null!==(n=(i=o.audio).deviceId)&&void 0!==n||(i.deviceId={ideal:"default"})):o.audio={deviceId:{ideal:"default"}}:o.audio=!1,o}function VV(e){return J(this,arguments,void 0,(function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:200;return function*(){const n=qV();if(n){const r=n.createAnalyser();r.fftSize=2048;const i=r.frequencyBinCount,o=new Uint8Array(i);n.createMediaStreamSource(new MediaStream([e.mediaStreamTrack])).connect(r),yield Ji(t),r.getByteTimeDomainData(o);const s=o.some((e=>128!==e&&0!==e));return n.close(),!s}return!1}()}))}function qV(){var e;const t=typeof window<"u"&&(window.AudioContext||window.webkitAudioContext);if(t){const n=new t({latencyHint:"interactive"});if("suspended"===n.state&&typeof window<"u"&&null!==(e=window.document)&&void 0!==e&&e.body){const e=()=>J(this,void 0,void 0,(function*(){var t;try{"suspended"===n.state&&(yield n.resume())}catch(e){console.warn("Error trying to auto-resume audio context",e)}null===(t=window.document.body)||void 0===t||t.removeEventListener("click",e)}));window.document.body.addEventListener("click",e)}return n}}function O8(e){return e===ue.Source.Microphone?"audioinput":e===ue.Source.Camera?"videoinput":void 0}function Vue(e){var t,n;let r=null===(t=e.video)||void 0===t||t;return e.resolution&&e.resolution.width>0&&e.resolution.height>0&&(r="boolean"==typeof r?{}:r,r=uu()?Object.assign(Object.assign({},r),{width:{max:e.resolution.width},height:{max:e.resolution.height},frameRate:e.resolution.frameRate}):Object.assign(Object.assign({},r),{width:{ideal:e.resolution.width},height:{ideal:e.resolution.height},frameRate:e.resolution.frameRate})),{audio:null!==(n=e.audio)&&void 0!==n&&n,video:r,controller:e.controller,selfBrowserSurface:e.selfBrowserSurface,surfaceSwitching:e.surfaceSwitching,systemAudio:e.systemAudio,preferCurrentTab:e.preferCurrentTab}}function sb(e){return e.split("/")[1].toLowerCase()}function que(e){const t=[];return e.forEach((e=>{void 0!==e.track&&t.push(new dL({cid:e.track.mediaStreamID,track:e.trackInfo}))})),t}function Gt(e){return"mediaStreamTrack"in e?{trackID:e.sid,source:e.source,muted:e.isMuted,enabled:e.mediaStreamTrack.enabled,kind:e.kind,streamID:e.mediaStreamID,streamTrackID:e.mediaStreamTrack.id}:{trackID:e.trackSid,enabled:e.isEnabled,muted:e.isMuted,trackInfo:Object.assign({mimeType:e.mimeType,name:e.trackName,encrypted:e.isEncrypted,kind:e.kind,source:e.source},e.track?Gt(e.track):{})}}function Kue(){return typeof RTCRtpReceiver<"u"&&"getSynchronizationSources"in RTCRtpReceiver}function Gue(e,t){var n;void 0===e&&(e={}),void 0===t&&(t={});const r=[...Object.keys(t),...Object.keys(e)],i={};for(const o of r)e[o]!==t[o]&&(i[o]=null!==(n=t[o])&&void 0!==n?n:"");return i}function KV(e){const t=Object.assign({},e);let n,r;return"object"==typeof t.audio&&t.audio.processor&&(n=t.audio.processor,t.audio=Object.assign(Object.assign({},t.audio),{processor:void 0})),"object"==typeof t.video&&t.video.processor&&(r=t.video.processor,t.video=Object.assign(Object.assign({},t.video),{processor:void 0})),{audioProcessor:n,videoProcessor:r,optionsWithoutProcessor:gue(t)}}function Wue(e){switch(e){case or.CAMERA:return ue.Source.Camera;case or.MICROPHONE:return ue.Source.Microphone;case or.SCREEN_SHARE:return ue.Source.ScreenShare;case or.SCREEN_SHARE_AUDIO:return ue.Source.ScreenShareAudio;default:return ue.Source.Unknown}}class zue extends Oa.EventEmitter{constructor(e){super(),this.onWorkerMessage=e=>{var t,n;const{kind:r,data:i}=e.data;switch(r){case"error":bt.error(i.error.message),this.emit(Bc.EncryptionError,i.error);break;case"initAck":i.enabled&&this.keyProvider.getKeys().forEach((e=>{this.postKey(e)}));break;case"enable":if(i.enabled&&this.keyProvider.getKeys().forEach((e=>{this.postKey(e)})),this.encryptionEnabled!==i.enabled&&i.participantIdentity===(null===(t=this.room)||void 0===t?void 0:t.localParticipant.identity))this.emit(Bc.ParticipantEncryptionStatusChanged,i.enabled,this.room.localParticipant),this.encryptionEnabled=i.enabled;else if(i.participantIdentity){const e=null===(n=this.room)||void 0===n?void 0:n.getParticipantByIdentity(i.participantIdentity);if(!e)throw TypeError("couldn't set encryption status, participant not found".concat(i.participantIdentity));this.emit(Bc.ParticipantEncryptionStatusChanged,i.enabled,e)}break;case"ratchetKey":this.keyProvider.emit(Xc.KeyRatcheted,i.material,i.keyIndex)}},this.onWorkerError=e=>{bt.error("e2ee worker encountered an error:",{error:e.error}),this.emit(Bc.EncryptionError,e.error)},this.keyProvider=e.keyProvider,this.worker=e.worker,this.encryptionEnabled=!1}setup(e){if(!NV())throw new mL("tried to setup end-to-end encryption on an unsupported browser");if(bt.info("setting up e2ee"),e!==this.room){this.room=e,this.setupEventListeners(e,this.keyProvider);const t={kind:"init",data:{keyProviderOptions:this.keyProvider.getOptions(),loglevel:Xce.getLevel()}};this.worker&&(bt.info("initializing worker",{worker:this.worker}),this.worker.onmessage=this.onWorkerMessage,this.worker.onerror=this.onWorkerError,this.worker.postMessage(t))}}setParticipantCryptorEnabled(e,t){bt.debug("set e2ee to ".concat(e," for participant ").concat(t)),this.postEnable(e,t)}setSifTrailer(e){e&&0!==e.length?this.postSifTrailer(e):bt.warn("ignoring server sent trailer as it's empty")}setupEngine(e){e.on(Pe.RTPVideoMapUpdate,(e=>{this.postRTPMap(e)}))}setupEventListeners(e,t){e.on(le.TrackPublished,((e,t)=>this.setParticipantCryptorEnabled(e.trackInfo.encryption!==gs.NONE,t.identity))),e.on(le.ConnectionStateChanged,(t=>{t===St.Connected&&e.remoteParticipants.forEach((e=>{e.trackPublications.forEach((t=>{this.setParticipantCryptorEnabled(t.trackInfo.encryption!==gs.NONE,e.identity)}))}))})).on(le.TrackUnsubscribed,((e,t,n)=>{var r;const i={kind:"removeTransform",data:{participantIdentity:n.identity,trackId:e.mediaStreamID}};null===(r=this.worker)||void 0===r||r.postMessage(i)})).on(le.TrackSubscribed,((e,t,n)=>{this.setupE2EEReceiver(e,n.identity,t.trackInfo)})).on(le.SignalConnected,(()=>{if(!this.room)throw new TypeError("expected room to be present on signal connect");t.getKeys().forEach((e=>{this.postKey(e)})),this.setParticipantCryptorEnabled(this.room.localParticipant.isE2EEEnabled,this.room.localParticipant.identity)})),e.localParticipant.on(oe.LocalTrackPublished,(e=>J(this,void 0,void 0,(function*(){this.setupE2EESender(e.track,e.track.sender)})))),t.on(Xc.SetKey,(e=>this.postKey(e))).on(Xc.RatchetRequest,((e,n)=>this.postRatchetRequest(e,n,t.getOptions().allowKeyExtraction)))}postRatchetRequest(e,t,n){if(!this.worker)throw Error("could not ratchet key, worker is missing");const r={kind:"ratchetRequest",data:{participantIdentity:e,keyIndex:t,extractable:n}};this.worker.postMessage(r)}postKey(e){let{key:t,participantIdentity:n,keyIndex:r}=e;var i;if(!this.worker)throw Error("could not set key, worker is missing");const o={kind:"setKey",data:{participantIdentity:n,isPublisher:n===(null===(i=this.room)||void 0===i?void 0:i.localParticipant.identity),key:t,keyIndex:r}};this.worker.postMessage(o)}postEnable(e,t){if(!this.worker)throw new ReferenceError("failed to enable e2ee, worker is not ready");{const n={kind:"enable",data:{enabled:e,participantIdentity:t}};this.worker.postMessage(n)}}postRTPMap(e){var t;if(!this.worker)throw TypeError("could not post rtp map, worker is missing");if(null===(t=this.room)||void 0===t||!t.localParticipant.identity)throw TypeError("could not post rtp map, local participant identity is missing");const n={kind:"setRTPMap",data:{map:e,participantIdentity:this.room.localParticipant.identity}};this.worker.postMessage(n)}postSifTrailer(e){if(!this.worker)throw Error("could not post SIF trailer, worker is missing");const t={kind:"setSifTrailer",data:{trailer:e}};this.worker.postMessage(t)}setupE2EEReceiver(e,t,n){if(e.receiver){if(null==n||!n.mimeType||""===n.mimeType)throw new TypeError("MimeType missing from trackInfo, cannot set up E2EE cryptor");this.handleReceiver(e.receiver,e.mediaStreamID,t,"video"===e.kind?sb(n.mimeType):void 0)}}setupE2EESender(e,t){Cd(e)&&t?this.handleSender(t,e.mediaStreamID,void 0):t||bt.warn("early return because sender is not ready")}handleReceiver(e,t,n,r){return J(this,void 0,void 0,(function*(){if(this.worker){if(r3()){const i={kind:"decode",participantIdentity:n,trackId:t,codec:r};e.transform=new RTCRtpScriptTransform(this.worker,i)}else{if(O1 in e&&r){const e={kind:"updateCodec",data:{trackId:t,codec:r,participantIdentity:n}};return void this.worker.postMessage(e)}let i=e.writableStream,o=e.readableStream;if(!i||!o){const t=e.createEncodedStreams();e.writableStream=t.writable,i=t.writable,e.readableStream=t.readable,o=t.readable}const s={kind:"decode",data:{readableStream:o,writableStream:i,trackId:t,codec:r,participantIdentity:n}};this.worker.postMessage(s,[o,i])}e[O1]=!0}}))}handleSender(e,t,n){var r;if(!(O1 in e)&&this.worker){if(null===(r=this.room)||void 0===r||!r.localParticipant.identity||""===this.room.localParticipant.identity)throw TypeError("local identity needs to be known in order to set up encrypted sender");if(r3()){bt.info("initialize script transform");const r={kind:"encode",participantIdentity:this.room.localParticipant.identity,trackId:t,codec:n};e.transform=new RTCRtpScriptTransform(this.worker,r)}else{bt.info("initialize encoded streams");const r=e.createEncodedStreams(),i={kind:"encode",data:{readableStream:r.readable,writableStream:r.writable,codec:n,trackId:t,participantIdentity:this.room.localParticipant.identity}};this.worker.postMessage(i,[r.readable,r.writable])}e[O1]=!0}}}const x2="default";class Mr{constructor(){this._previousDevices=[]}static getInstance(){return void 0===this.instance&&(this.instance=new Mr),this.instance}get previousDevices(){return this._previousDevices}getDevices(e){return J(this,arguments,void 0,(function(e){var t=this;let n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return function*(){var r;if((null===(r=Mr.userMediaPromiseMap)||void 0===r?void 0:r.size)>0){bt.debug("awaiting getUserMedia promise");try{e?yield Mr.userMediaPromiseMap.get(e):yield Promise.all(Mr.userMediaPromiseMap.values())}catch{bt.warn("error waiting for media permissons")}}let i=yield navigator.mediaDevices.enumerateDevices();if(n&&(!uu()||!t.hasDeviceInUse(e))&&(0===i.filter((t=>t.kind===e)).length||i.some((t=>{const n=""===t.label,r=!e||t.kind===e;return n&&r})))){const t={video:"audioinput"!==e&&"audiooutput"!==e,audio:"videoinput"!==e&&{deviceId:{ideal:"default"}}},n=yield navigator.mediaDevices.getUserMedia(t);i=yield navigator.mediaDevices.enumerateDevices(),n.getTracks().forEach((e=>{e.stop()}))}return t._previousDevices=i,e&&(i=i.filter((t=>t.kind===e))),i}()}))}normalizeDeviceId(e,t,n){return J(this,void 0,void 0,(function*(){if(t!==x2)return t;const r=yield this.getDevices(e),i=r.find((e=>e.deviceId===x2));if(!i)return void bt.warn("could not reliably determine default device");const o=r.find((e=>e.deviceId!==x2&&e.groupId===(n??i.groupId)));if(o)return null==o?void 0:o.deviceId;bt.warn("could not reliably determine default device")}))}hasDeviceInUse(e){return e?Mr.userMediaPromiseMap.has(e):Mr.userMediaPromiseMap.size>0}}var Zg;Mr.mediaDeviceKinds=["audioinput","audiooutput","videoinput"],Mr.userMediaPromiseMap=new Map,function(e){e[e.WAITING=0]="WAITING",e[e.RUNNING=1]="RUNNING",e[e.COMPLETED=2]="COMPLETED"}(Zg||(Zg={}));class Yue{constructor(){this.pendingTasks=new Map,this.taskMutex=new Ei,this.nextTaskIndex=0}run(e){return J(this,void 0,void 0,(function*(){const t={id:this.nextTaskIndex++,enqueuedAt:Date.now(),status:Zg.WAITING};this.pendingTasks.set(t.id,t);const n=yield this.taskMutex.lock();try{return t.executedAt=Date.now(),t.status=Zg.RUNNING,yield e()}finally{t.status=Zg.COMPLETED,this.pendingTasks.delete(t.id),n()}}))}flush(){return J(this,void 0,void 0,(function*(){return this.run((()=>J(this,void 0,void 0,(function*(){}))))}))}snapshot(){return Array.from(this.pendingTasks.values())}}function Jue(e,t){const n=new URL(jue(e));return t.forEach(((e,t)=>{n.searchParams.set(t,e)})),GV(n,"rtc")}function Xue(e){return GV(new URL(u3(e)),"validate")}function Zue(e){return e.endsWith("/")?e:"".concat(e,"/")}function GV(e,t){return e.pathname="".concat(Zue(e.pathname)).concat(t),e.toString()}const Que=["syncState","trickle","offer","answer","simulate","leave"];function ede(e){const t=Que.indexOf(e.case)>=0;return bt.trace("request allowed to bypass queue:",{canPass:t,req:e}),t}var gn;!function(e){e[e.CONNECTING=0]="CONNECTING",e[e.CONNECTED=1]="CONNECTED",e[e.RECONNECTING=2]="RECONNECTING",e[e.DISCONNECTING=3]="DISCONNECTING",e[e.DISCONNECTED=4]="DISCONNECTED"}(gn||(gn={}));class vL{get currentState(){return this.state}get isDisconnected(){return this.state===gn.DISCONNECTING||this.state===gn.DISCONNECTED}get isEstablishingConnection(){return this.state===gn.CONNECTING||this.state===gn.RECONNECTING}getNextRequestId(){return this._requestId+=1,this._requestId}constructor(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};var n;this.rtt=0,this.state=gn.DISCONNECTED,this.log=bt,this._requestId=0,this.resetCallbacks=()=>{this.onAnswer=void 0,this.onLeave=void 0,this.onLocalTrackPublished=void 0,this.onLocalTrackUnpublished=void 0,this.onNegotiateRequested=void 0,this.onOffer=void 0,this.onRemoteMuteChanged=void 0,this.onSubscribedQualityUpdate=void 0,this.onTokenRefresh=void 0,this.onTrickle=void 0,this.onClose=void 0},this.log=Ol(null!==(n=t.loggerName)&&void 0!==n?n:$o.Signal),this.loggerContextCb=t.loggerContextCb,this.useJSON=e,this.requestQueue=new Yue,this.queuedRequests=[],this.closingLock=new Ei,this.connectionLock=new Ei,this.state=gn.DISCONNECTED}get logContext(){var e,t;return null!==(t=null===(e=this.loggerContextCb)||void 0===e?void 0:e.call(this))&&void 0!==t?t:{}}join(e,t,n,r){return J(this,void 0,void 0,(function*(){return this.state=gn.CONNECTING,this.options=n,yield this.connect(e,t,n,r)}))}reconnect(e,t,n,r){return J(this,void 0,void 0,(function*(){if(this.options)return this.state=gn.RECONNECTING,this.clearPingInterval(),yield this.connect(e,t,Object.assign(Object.assign({},this.options),{reconnect:!0,sid:n,reconnectReason:r}));this.log.warn("attempted to reconnect without signal options being set, ignoring",this.logContext)}))}connect(e,t,n,r){this.connectOptions=n;const i=Jue(e,tde(t,Nue(),n)),o=Xue(i);return new Promise(((e,t)=>J(this,void 0,void 0,(function*(){const s=yield this.connectionLock.lock();try{const s=()=>J(this,void 0,void 0,(function*(){this.close(),clearTimeout(a),t(new en("room connection has been cancelled (signal)",kt.Cancelled))})),a=setTimeout((()=>{this.close(),t(new en("room connection has timed out (signal)",kt.ServerUnreachable))}),n.websocketTimeout);null!=r&&r.aborted&&s(),null==r||r.addEventListener("abort",s);const l=new URL(i);l.searchParams.has("access_token")&&l.searchParams.set("access_token","<redacted>"),this.log.debug("connecting to ".concat(l),Object.assign({reconnect:n.reconnect,reconnectReason:n.reconnectReason},this.logContext)),this.ws&&(yield this.close(!1)),this.ws=new WebSocket(i),this.ws.binaryType="arraybuffer",this.ws.onopen=()=>{clearTimeout(a)},this.ws.onerror=e=>J(this,void 0,void 0,(function*(){if(this.state===gn.CONNECTED)this.handleWSError(e);else{this.state=gn.DISCONNECTED,clearTimeout(a);try{const n=yield fetch(o);if(n.status.toFixed(0).startsWith("4")){const e=yield n.text();t(new en(e,kt.NotAllowed,n.status))}else t(new en("Encountered unknown websocket error during connection: ".concat(e.toString()),kt.InternalError,n.status))}catch(e){t(new en(e instanceof Error?e.message:"server was not reachable",kt.ServerUnreachable))}}})),this.ws.onmessage=i=>J(this,void 0,void 0,(function*(){var o,a,l;let c;if("string"==typeof i.data){const e=JSON.parse(i.data);c=u8.fromJson(e,{ignoreUnknownFields:!0})}else{if(!(i.data instanceof ArrayBuffer))return void this.log.error("could not decode websocket message: ".concat(typeof i.data),this.logContext);c=u8.fromBinary(new Uint8Array(i.data))}if(this.state!==gn.CONNECTED){let i=!1;if("join"===(null===(o=c.message)||void 0===o?void 0:o.case)?(this.state=gn.CONNECTED,null==r||r.removeEventListener("abort",s),this.pingTimeoutDuration=c.message.value.pingTimeout,this.pingIntervalDuration=c.message.value.pingInterval,this.pingTimeoutDuration&&this.pingTimeoutDuration>0&&(this.log.debug("ping config",Object.assign(Object.assign({},this.logContext),{timeout:this.pingTimeoutDuration,interval:this.pingIntervalDuration})),this.startPingInterval()),e(c.message.value)):this.state===gn.RECONNECTING&&"leave"!==c.message.case?(this.state=gn.CONNECTED,null==r||r.removeEventListener("abort",s),this.startPingInterval(),"reconnect"===(null===(a=c.message)||void 0===a?void 0:a.case)?e(c.message.value):(this.log.debug("declaring signal reconnected without reconnect response received",this.logContext),e(void 0),i=!0)):this.isEstablishingConnection&&"leave"===c.message.case?t(new en("Received leave request while trying to (re)connect",kt.LeaveRequest,void 0,c.message.value.reason)):n.reconnect||t(new en("did not receive join response, got ".concat(null===(l=c.message)||void 0===l?void 0:l.case," instead"),kt.InternalError)),!i)return}this.signalLatency&&(yield Ji(this.signalLatency)),this.handleSignalResponse(c)})),this.ws.onclose=e=>{this.isEstablishingConnection&&t(new en("Websocket got closed during a (re)connection attempt",kt.InternalError)),this.log.warn("websocket closed",Object.assign(Object.assign({},this.logContext),{reason:e.reason,code:e.code,wasClean:e.wasClean,state:this.state})),this.handleOnClose(e.reason)}}finally{s()}}))))}close(){return J(this,arguments,void 0,(function(){var e=this;let t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return function*(){const n=yield e.closingLock.lock();try{if(e.clearPingInterval(),t&&(e.state=gn.DISCONNECTING),e.ws){e.ws.onmessage=null,e.ws.onopen=null,e.ws.onclose=null;const t=new Promise((t=>{e.ws?e.ws.onclose=()=>{t()}:t()}));e.ws.readyState<e.ws.CLOSING&&(e.ws.close(),yield Promise.race([t,Ji(250)])),e.ws=void 0}}finally{t&&(e.state=gn.DISCONNECTED),n()}}()}))}sendOffer(e){this.log.debug("sending offer",Object.assign(Object.assign({},this.logContext),{offerSdp:e.sdp})),this.sendRequest({case:"offer",value:dS(e)})}sendAnswer(e){return this.log.debug("sending answer",Object.assign(Object.assign({},this.logContext),{answerSdp:e.sdp})),this.sendRequest({case:"answer",value:dS(e)})}sendIceCandidate(e,t){return this.log.debug("sending ice candidate",Object.assign(Object.assign({},this.logContext),{candidate:e})),this.sendRequest({case:"trickle",value:new cL({candidateInit:JSON.stringify(e),target:t})})}sendMuteTrack(e,t){return this.sendRequest({case:"mute",value:new uL({sid:e,muted:t})})}sendAddTrack(e){return this.sendRequest({case:"addTrack",value:e})}sendUpdateLocalMetadata(e,t){return J(this,arguments,void 0,(function(e,t){var n=this;let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return function*(){const i=n.getNextRequestId();return yield n.sendRequest({case:"updateMetadata",value:new WB({requestId:i,metadata:e,name:t,attributes:r})}),i}()}))}sendUpdateTrackSettings(e){this.sendRequest({case:"trackSetting",value:e})}sendUpdateSubscription(e){return this.sendRequest({case:"subscription",value:e})}sendSyncState(e){return this.sendRequest({case:"syncState",value:e})}sendUpdateVideoLayers(e,t){return this.sendRequest({case:"updateLayers",value:new GB({trackSid:e,layers:t})})}sendUpdateSubscriptionPermissions(e,t){return this.sendRequest({case:"subscriptionPermission",value:new JB({allParticipants:e,trackPermissions:t})})}sendSimulateScenario(e){return this.sendRequest({case:"simulate",value:e})}sendPing(){return Promise.all([this.sendRequest({case:"ping",value:kn.parse(Date.now())}),this.sendRequest({case:"pingReq",value:new QB({timestamp:kn.parse(Date.now()),rtt:kn.parse(this.rtt)})})])}sendUpdateLocalAudioTrack(e,t){return this.sendRequest({case:"updateAudioTrack",value:new KB({trackSid:e,features:t})})}sendLeave(){return this.sendRequest({case:"leave",value:new BE({reason:Ao.CLIENT_INITIATED,action:Fh.DISCONNECT})})}sendRequest(e){return J(this,arguments,void 0,(function(e){var t=this;let n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return function*(){if(!n&&!ede(e)&&t.state===gn.RECONNECTING)return void t.queuedRequests.push((()=>J(t,void 0,void 0,(function*(){yield this.sendRequest(e,!0)}))));if(n||(yield t.requestQueue.flush()),t.signalLatency&&(yield Ji(t.signalLatency)),!t.ws||t.ws.readyState!==t.ws.OPEN)return void t.log.error("cannot send signal request before connected, type: ".concat(null==e?void 0:e.case),t.logContext);const r=new Rce({message:e});try{t.useJSON?t.ws.send(r.toJsonString()):t.ws.send(r.toBinary())}catch(e){t.log.error("error sending signal message",Object.assign(Object.assign({},t.logContext),{error:e}))}}()}))}handleSignalResponse(e){var t,n;const r=e.message;if(null==r)return void this.log.debug("received unsupported message",this.logContext);let i=!1;if("answer"===r.case){const e=M8(r.value);this.onAnswer&&this.onAnswer(e)}else if("offer"===r.case){const e=M8(r.value);this.onOffer&&this.onOffer(e)}else if("trickle"===r.case){const e=JSON.parse(r.value.candidateInit);this.onTrickle&&this.onTrickle(e,r.value.target)}else"update"===r.case?this.onParticipantUpdate&&this.onParticipantUpdate(null!==(t=r.value.participants)&&void 0!==t?t:[]):"trackPublished"===r.case?this.onLocalTrackPublished&&this.onLocalTrackPublished(r.value):"speakersChanged"===r.case?this.onSpeakersChanged&&this.onSpeakersChanged(null!==(n=r.value.speakers)&&void 0!==n?n:[]):"leave"===r.case?this.onLeave&&this.onLeave(r.value):"mute"===r.case?this.onRemoteMuteChanged&&this.onRemoteMuteChanged(r.value.sid,r.value.muted):"roomUpdate"===r.case?this.onRoomUpdate&&r.value.room&&this.onRoomUpdate(r.value.room):"connectionQuality"===r.case?this.onConnectionQuality&&this.onConnectionQuality(r.value):"streamStateUpdate"===r.case?this.onStreamStateUpdate&&this.onStreamStateUpdate(r.value):"subscribedQualityUpdate"===r.case?this.onSubscribedQualityUpdate&&this.onSubscribedQualityUpdate(r.value):"subscriptionPermissionUpdate"===r.case?this.onSubscriptionPermissionUpdate&&this.onSubscriptionPermissionUpdate(r.value):"refreshToken"===r.case?this.onTokenRefresh&&this.onTokenRefresh(r.value):"trackUnpublished"===r.case?this.onLocalTrackUnpublished&&this.onLocalTrackUnpublished(r.value):"subscriptionResponse"===r.case?this.onSubscriptionError&&this.onSubscriptionError(r.value):"pong"===r.case||("pongResp"===r.case?(this.rtt=Date.now()-Number.parseInt(r.value.lastPingTimestamp.toString()),this.resetPingTimeout(),i=!0):"requestResponse"===r.case?this.onRequestResponse&&this.onRequestResponse(r.value):"trackSubscribed"===r.case?this.onLocalTrackSubscribed&&this.onLocalTrackSubscribed(r.value.trackSid):this.log.debug("unsupported message",Object.assign(Object.assign({},this.logContext),{msgCase:r.case})));i||this.resetPingTimeout()}setReconnected(){for(;this.queuedRequests.length>0;){const e=this.queuedRequests.shift();e&&this.requestQueue.run(e)}}handleOnClose(e){return J(this,void 0,void 0,(function*(){if(this.state===gn.DISCONNECTED)return;const t=this.onClose;yield this.close(),this.log.debug("websocket connection closed: ".concat(e),Object.assign(Object.assign({},this.logContext),{reason:e})),t&&t(e)}))}handleWSError(e){this.log.error("websocket error",Object.assign(Object.assign({},this.logContext),{error:e}))}resetPingTimeout(){this.clearPingTimeout(),this.pingTimeoutDuration?this.pingTimeout=zr.setTimeout((()=>{this.log.warn("ping timeout triggered. last pong received at: ".concat(new Date(Date.now()-1e3*this.pingTimeoutDuration).toUTCString()),this.logContext),this.handleOnClose("ping timeout")}),1e3*this.pingTimeoutDuration):this.log.warn("ping timeout duration not set",this.logContext)}clearPingTimeout(){this.pingTimeout&&zr.clearTimeout(this.pingTimeout)}startPingInterval(){this.clearPingInterval(),this.resetPingTimeout(),this.pingIntervalDuration?(this.log.debug("start ping interval",this.logContext),this.pingInterval=zr.setInterval((()=>{this.sendPing()}),1e3*this.pingIntervalDuration)):this.log.warn("ping interval duration not set",this.logContext)}clearPingInterval(){this.log.debug("clearing ping interval",this.logContext),this.clearPingTimeout(),this.pingInterval&&zr.clearInterval(this.pingInterval)}}function M8(e){const t={type:"offer",sdp:e.sdp};switch(e.type){case"answer":case"offer":case"pranswer":case"rollback":t.type=e.type}return t}function dS(e){return new Ad({sdp:e.sdp,type:e.type})}function tde(e,t,n){var r;const i=new URLSearchParams;return i.set("access_token",e),n.reconnect&&(i.set("reconnect","1"),n.sid&&i.set("sid",n.sid)),i.set("auto_subscribe",n.autoSubscribe?"1":"0"),i.set("sdk",Ca()?"reactnative":"js"),i.set("version",t.version),i.set("protocol",t.protocol.toString()),t.deviceModel&&i.set("device_model",t.deviceModel),t.os&&i.set("os",t.os),t.osVersion&&i.set("os_version",t.osVersion),t.browser&&i.set("browser",t.browser),t.browserVersion&&i.set("browser_version",t.browserVersion),n.adaptiveStream&&i.set("adaptive_stream","1"),n.reconnectReason&&i.set("reconnect_reason",n.reconnectReason.toString()),!(null===(r=navigator.connection)||void 0===r)&&r.type&&i.set("network",navigator.connection.type),i}var A8,N8,O2,D8,j8,yo={},P2={},L2={exports:{}};function yL(){if(A8)return L2.exports;A8=1;var e=L2.exports={v:[{name:"version",reg:/^(\d*)$/}],o:[{name:"origin",reg:/^(\S*) (\d*) (\d*) (\S*) IP(\d) (\S*)/,names:["username","sessionId","sessionVersion","netType","ipVer","address"],format:"%s %s %d %s IP%d %s"}],s:[{name:"name"}],i:[{name:"description"}],u:[{name:"uri"}],e:[{name:"email"}],p:[{name:"phone"}],z:[{name:"timezones"}],r:[{name:"repeats"}],t:[{name:"timing",reg:/^(\d*) (\d*)/,names:["start","stop"],format:"%d %d"}],c:[{name:"connection",reg:/^IN IP(\d) (\S*)/,names:["version","ip"],format:"IN IP%d %s"}],b:[{push:"bandwidth",reg:/^(TIAS|AS|CT|RR|RS):(\d*)/,names:["type","limit"],format:"%s:%s"}],m:[{reg:/^(\w*) (\d*) ([\w/]*)(?: (.*))?/,names:["type","port","protocol","payloads"],format:"%s %d %s %s"}],a:[{push:"rtp",reg:/^rtpmap:(\d*) ([\w\-.]*)(?:\s*\/(\d*)(?:\s*\/(\S*))?)?/,names:["payload","codec","rate","encoding"],format:function(e){return e.encoding?"rtpmap:%d %s/%s/%s":e.rate?"rtpmap:%d %s/%s":"rtpmap:%d %s"}},{push:"fmtp",reg:/^fmtp:(\d*) ([\S| ]*)/,names:["payload","config"],format:"fmtp:%d %s"},{name:"control",reg:/^control:(.*)/,format:"control:%s"},{name:"rtcp",reg:/^rtcp:(\d*)(?: (\S*) IP(\d) (\S*))?/,names:["port","netType","ipVer","address"],format:function(e){return null!=e.address?"rtcp:%d %s IP%d %s":"rtcp:%d"}},{push:"rtcpFbTrrInt",reg:/^rtcp-fb:(\*|\d*) trr-int (\d*)/,names:["payload","value"],format:"rtcp-fb:%s trr-int %d"},{push:"rtcpFb",reg:/^rtcp-fb:(\*|\d*) ([\w-_]*)(?: ([\w-_]*))?/,names:["payload","type","subtype"],format:function(e){return null!=e.subtype?"rtcp-fb:%s %s %s":"rtcp-fb:%s %s"}},{push:"ext",reg:/^extmap:(\d+)(?:\/(\w+))?(?: (urn:ietf:params:rtp-hdrext:encrypt))? (\S*)(?: (\S*))?/,names:["value","direction","encrypt-uri","uri","config"],format:function(e){return"extmap:%d"+(e.direction?"/%s":"%v")+(e["encrypt-uri"]?" %s":"%v")+" %s"+(e.config?" %s":"")}},{name:"extmapAllowMixed",reg:/^(extmap-allow-mixed)/},{push:"crypto",reg:/^crypto:(\d*) ([\w_]*) (\S*)(?: (\S*))?/,names:["id","suite","config","sessionConfig"],format:function(e){return null!=e.sessionConfig?"crypto:%d %s %s %s":"crypto:%d %s %s"}},{name:"setup",reg:/^setup:(\w*)/,format:"setup:%s"},{name:"connectionType",reg:/^connection:(new|existing)/,format:"connection:%s"},{name:"mid",reg:/^mid:([^\s]*)/,format:"mid:%s"},{name:"msid",reg:/^msid:(.*)/,format:"msid:%s"},{name:"ptime",reg:/^ptime:(\d*(?:\.\d*)*)/,format:"ptime:%d"},{name:"maxptime",reg:/^maxptime:(\d*(?:\.\d*)*)/,format:"maxptime:%d"},{name:"direction",reg:/^(sendrecv|recvonly|sendonly|inactive)/},{name:"icelite",reg:/^(ice-lite)/},{name:"iceUfrag",reg:/^ice-ufrag:(\S*)/,format:"ice-ufrag:%s"},{name:"icePwd",reg:/^ice-pwd:(\S*)/,format:"ice-pwd:%s"},{name:"fingerprint",reg:/^fingerprint:(\S*) (\S*)/,names:["type","hash"],format:"fingerprint:%s %s"},{push:"candidates",reg:/^candidate:(\S*) (\d*) (\S*) (\d*) (\S*) (\d*) typ (\S*)(?: raddr (\S*) rport (\d*))?(?: tcptype (\S*))?(?: generation (\d*))?(?: network-id (\d*))?(?: network-cost (\d*))?/,names:["foundation","component","transport","priority","ip","port","type","raddr","rport","tcptype","generation","network-id","network-cost"],format:function(e){var t="candidate:%s %d %s %d %s %d typ %s";return t+=null!=e.raddr?" raddr %s rport %d":"%v%v",t+=null!=e.tcptype?" tcptype %s":"%v",null!=e.generation&&(t+=" generation %d"),t+=null!=e["network-id"]?" network-id %d":"%v",t+=null!=e["network-cost"]?" network-cost %d":"%v"}},{name:"endOfCandidates",reg:/^(end-of-candidates)/},{name:"remoteCandidates",reg:/^remote-candidates:(.*)/,format:"remote-candidates:%s"},{name:"iceOptions",reg:/^ice-options:(\S*)/,format:"ice-options:%s"},{push:"ssrcs",reg:/^ssrc:(\d*) ([\w_-]*)(?::(.*))?/,names:["id","attribute","value"],format:function(e){var t="ssrc:%d";return null!=e.attribute&&(t+=" %s",null!=e.value&&(t+=":%s")),t}},{push:"ssrcGroups",reg:/^ssrc-group:([\x21\x23\x24\x25\x26\x27\x2A\x2B\x2D\x2E\w]*) (.*)/,names:["semantics","ssrcs"],format:"ssrc-group:%s %s"},{name:"msidSemantic",reg:/^msid-semantic:\s?(\w*) (\S*)/,names:["semantic","token"],format:"msid-semantic: %s %s"},{push:"groups",reg:/^group:(\w*) (.*)/,names:["type","mids"],format:"group:%s %s"},{name:"rtcpMux",reg:/^(rtcp-mux)/},{name:"rtcpRsize",reg:/^(rtcp-rsize)/},{name:"sctpmap",reg:/^sctpmap:([\w_/]*) (\S*)(?: (\S*))?/,names:["sctpmapNumber","app","maxMessageSize"],format:function(e){return null!=e.maxMessageSize?"sctpmap:%s %s %s":"sctpmap:%s %s"}},{name:"xGoogleFlag",reg:/^x-google-flag:([^\s]*)/,format:"x-google-flag:%s"},{push:"rids",reg:/^rid:([\d\w]+) (\w+)(?: ([\S| ]*))?/,names:["id","direction","params"],format:function(e){return e.params?"rid:%s %s %s":"rid:%s %s"}},{push:"imageattrs",reg:new RegExp("^imageattr:(\\d+|\\*)[\\s\\t]+(send|recv)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*)(?:[\\s\\t]+(recv|send)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*))?"),names:["pt","dir1","attrs1","dir2","attrs2"],format:function(e){return"imageattr:%s %s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast",reg:new RegExp("^simulcast:(send|recv) ([a-zA-Z0-9\\-_~;,]+)(?:\\s?(send|recv) ([a-zA-Z0-9\\-_~;,]+))?$"),names:["dir1","list1","dir2","list2"],format:function(e){return"simulcast:%s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast_03",reg:/^simulcast:[\s\t]+([\S+\s\t]+)$/,names:["value"],format:"simulcast: %s"},{name:"framerate",reg:/^framerate:(\d+(?:$|\.\d+))/,format:"framerate:%s"},{name:"sourceFilter",reg:/^source-filter: *(excl|incl) (\S*) (IP4|IP6|\*) (\S*) (.*)/,names:["filterMode","netType","addressTypes","destAddress","srcList"],format:"source-filter: %s %s %s %s %s"},{name:"bundleOnly",reg:/^(bundle-only)/},{name:"label",reg:/^label:(.+)/,format:"label:%s"},{name:"sctpPort",reg:/^sctp-port:(\d+)$/,format:"sctp-port:%s"},{name:"maxMessageSize",reg:/^max-message-size:(\d+)$/,format:"max-message-size:%s"},{push:"tsRefClocks",reg:/^ts-refclk:([^\s=]*)(?:=(\S*))?/,names:["clksrc","clksrcExt"],format:function(e){return"ts-refclk:%s"+(null!=e.clksrcExt?"=%s":"")}},{name:"mediaClk",reg:/^mediaclk:(?:id=(\S*))? *([^\s=]*)(?:=(\S*))?(?: *rate=(\d+)\/(\d+))?/,names:["id","mediaClockName","mediaClockValue","rateNumerator","rateDenominator"],format:function(e){var t="mediaclk:";return t+=null!=e.id?"id=%s %s":"%v%s",t+=null!=e.mediaClockValue?"=%s":"",t+=null!=e.rateNumerator?" rate=%s":"",t+=null!=e.rateDenominator?"/%s":""}},{name:"keywords",reg:/^keywds:(.+)$/,format:"keywds:%s"},{name:"content",reg:/^content:(.+)/,format:"content:%s"},{name:"bfcpFloorCtrl",reg:/^floorctrl:(c-only|s-only|c-s)/,format:"floorctrl:%s"},{name:"bfcpConfId",reg:/^confid:(\d+)/,format:"confid:%s"},{name:"bfcpUserId",reg:/^userid:(\d+)/,format:"userid:%s"},{name:"bfcpFloorId",reg:/^floorid:(.+) (?:m-stream|mstrm):(.+)/,names:["id","mStream"],format:"floorid:%s mstrm:%s"},{push:"invalid",names:["value"]}]};return Object.keys(e).forEach((function(t){e[t].forEach((function(e){e.reg||(e.reg=/(.*)/),e.format||(e.format="%s")}))})),L2.exports}function nde(){return N8||(N8=1,function(e){var t=function(e){return String(Number(e))===e?Number(e):e},n=function(e,n,r){var i=e.name&&e.names;e.push&&!n[e.push]?n[e.push]=[]:i&&!n[e.name]&&(n[e.name]={});var o=e.push?{}:i?n[e.name]:n;(function(e,n,r,i){if(i&&!r)n[i]=t(e[1]);else for(var o=0;o<r.length;o+=1)null!=e[o+1]&&(n[r[o]]=t(e[o+1]))})(r.match(e.reg),o,e.names,e.name),e.push&&n[e.push].push(o)},r=yL(),i=RegExp.prototype.test.bind(/^([a-z])=(.*)/);e.parse=function(e){var t={},o=[],s=t;return e.split(/(\r\n|\r|\n)/).filter(i).forEach((function(e){var t=e[0],i=e.slice(2);"m"===t&&(o.push({rtp:[],fmtp:[]}),s=o[o.length-1]);for(var a=0;a<(r[t]||[]).length;a+=1){var l=r[t][a];if(l.reg.test(i))return n(l,s,i)}})),t.media=o,t};var o=function(e,n){var r=n.split(/=(.+)/,2);return 2===r.length?e[r[0]]=t(r[1]):1===r.length&&n.length>1&&(e[r[0]]=void 0),e};e.parseParams=function(e){return e.split(/;\s?/).reduce(o,{})},e.parseFmtpConfig=e.parseParams,e.parsePayloads=function(e){return e.toString().split(" ").map(Number)},e.parseRemoteCandidates=function(e){for(var n=[],r=e.split(" ").map(t),i=0;i<r.length;i+=3)n.push({component:r[i],ip:r[i+1],port:r[i+2]});return n},e.parseImageAttributes=function(e){return e.split(" ").map((function(e){return e.substring(1,e.length-1).split(",").reduce(o,{})}))},e.parseSimulcastStreamList=function(e){return e.split(";").map((function(e){return e.split(",").map((function(e){var n,r=!1;return"~"!==e[0]?n=t(e):(n=t(e.substring(1,e.length)),r=!0),{scid:n,paused:r}}))}))}}(P2)),P2}function rde(){if(D8)return O2;D8=1;var e=yL(),t=/%[sdv%]/g,n=function(e){var n=1,r=arguments,i=r.length;return e.replace(t,(function(e){if(n>=i)return e;var t=r[n];switch(n+=1,e){case"%%":return"%";case"%s":return String(t);case"%d":return Number(t);case"%v":return""}}))},r=function(e,t,r){var i=[e+"="+(t.format instanceof Function?t.format(t.push?r:r[t.name]):t.format)];if(t.names)for(var o=0;o<t.names.length;o+=1){var s=t.names[o];t.name?i.push(r[t.name][s]):i.push(r[t.names[o]])}else i.push(r[t.name]);return n.apply(null,i)},i=["v","o","s","i","u","e","p","c","b","t","r","z","a"],o=["i","c","b","a"];return O2=function(t,n){n=n||{},null==t.version&&(t.version=0),null==t.name&&(t.name=" "),t.media.forEach((function(e){null==e.payloads&&(e.payloads="")}));var s=n.outerOrder||i,a=n.innerOrder||o,l=[];return s.forEach((function(n){e[n].forEach((function(e){e.name in t&&null!=t[e.name]?l.push(r(n,e,t)):e.push in t&&null!=t[e.push]&&t[e.push].forEach((function(t){l.push(r(n,e,t))}))}))})),t.media.forEach((function(t){l.push(r("m",e.m[0],t)),a.forEach((function(n){e[n].forEach((function(e){e.name in t&&null!=t[e.name]?l.push(r(n,e,t)):e.push in t&&null!=t[e.push]&&t[e.push].forEach((function(t){l.push(r(n,e,t))}))}))}))})),l.join("\r\n")+"\r\n"}}function ide(){if(j8)return yo;j8=1;var e=nde(),t=rde(),n=yL();return yo.grammar=n,yo.write=t,yo.parse=e.parse,yo.parseParams=e.parseParams,yo.parseFmtpConfig=e.parseFmtpConfig,yo.parsePayloads=e.parsePayloads,yo.parseRemoteCandidates=e.parseRemoteCandidates,yo.parseImageAttributes=e.parseImageAttributes,yo.parseSimulcastStreamList=e.parseSimulcastStreamList,yo}var xc=ide();function _L(e,t,n){var r,i,o;void 0===t&&(t=50),void 0===n&&(n={});var s=null!=(r=n.isImmediate)&&r,a=null!=(i=n.callback)&&i,l=n.maxWait,c=Date.now(),u=[];var d=function(){var n=[].slice.call(arguments),r=this;return new Promise((function(i,d){var h=s&&void 0===o;if(void 0!==o&&clearTimeout(o),o=setTimeout((function(){if(o=void 0,c=Date.now(),!s){var t=e.apply(r,n);a&&a(t),u.forEach((function(e){return(0,e.resolve)(t)})),u=[]}}),function(){if(void 0!==l){var e=Date.now()-c;if(e+t>=l)return l-e}return t}()),h){var p=e.apply(r,n);return a&&a(p),i(p)}u.push({resolve:i,reject:d})}))};return d.cancel=function(e){void 0!==o&&clearTimeout(o),u.forEach((function(t){return(0,t.reject)(e)})),u=[]},d}const sde=.7,ode=20,Bh={NegotiationStarted:"negotiationStarted",NegotiationComplete:"negotiationComplete",RTPVideoPayloadTypes:"rtpVideoPayloadTypes"};class U8 extends Oa.EventEmitter{get pc(){return this._pc||(this._pc=this.createPC()),this._pc}constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};var n;super(),this.log=bt,this.ddExtID=0,this.pendingCandidates=[],this.restartingIce=!1,this.renegotiate=!1,this.trackBitrates=[],this.remoteStereoMids=[],this.remoteNackMids=[],this.negotiate=_L((e=>J(this,void 0,void 0,(function*(){this.emit(Bh.NegotiationStarted);try{yield this.createAndSendOffer()}catch(t){if(!e)throw t;e(t)}}))),20),this.close=()=>{this._pc&&(this._pc.close(),this._pc.onconnectionstatechange=null,this._pc.oniceconnectionstatechange=null,this._pc.onicegatheringstatechange=null,this._pc.ondatachannel=null,this._pc.onnegotiationneeded=null,this._pc.onsignalingstatechange=null,this._pc.onicecandidate=null,this._pc.ondatachannel=null,this._pc.ontrack=null,this._pc.onconnectionstatechange=null,this._pc.oniceconnectionstatechange=null,this._pc=null)},this.log=Ol(null!==(n=t.loggerName)&&void 0!==n?n:$o.PCTransport),this.loggerOptions=t,this.config=e,this._pc=this.createPC()}createPC(){const e=new RTCPeerConnection(this.config);return e.onicecandidate=e=>{var t;e.candidate&&(null===(t=this.onIceCandidate)||void 0===t||t.call(this,e.candidate))},e.onicecandidateerror=e=>{var t;null===(t=this.onIceCandidateError)||void 0===t||t.call(this,e)},e.oniceconnectionstatechange=()=>{var t;null===(t=this.onIceConnectionStateChange)||void 0===t||t.call(this,e.iceConnectionState)},e.onsignalingstatechange=()=>{var t;null===(t=this.onSignalingStatechange)||void 0===t||t.call(this,e.signalingState)},e.onconnectionstatechange=()=>{var t;null===(t=this.onConnectionStateChange)||void 0===t||t.call(this,e.connectionState)},e.ondatachannel=e=>{var t;null===(t=this.onDataChannel)||void 0===t||t.call(this,e)},e.ontrack=e=>{var t;null===(t=this.onTrack)||void 0===t||t.call(this,e)},e}get logContext(){var e,t;return Object.assign({},null===(t=(e=this.loggerOptions).loggerContextCb)||void 0===t?void 0:t.call(e))}get isICEConnected(){return null!==this._pc&&("connected"===this.pc.iceConnectionState||"completed"===this.pc.iceConnectionState)}addIceCandidate(e){return J(this,void 0,void 0,(function*(){if(this.pc.remoteDescription&&!this.restartingIce)return this.pc.addIceCandidate(e);this.pendingCandidates.push(e)}))}setRemoteDescription(e){return J(this,void 0,void 0,(function*(){var t;let n;if("offer"===e.type){let{stereoMids:t,nackMids:n}=ade(e);this.remoteStereoMids=t,this.remoteNackMids=n}else if("answer"===e.type){const r=xc.parse(null!==(t=e.sdp)&&void 0!==t?t:"");r.media.forEach((e=>{"audio"===e.type&&this.trackBitrates.some((t=>{if(!t.transceiver||e.mid!=t.transceiver.mid)return!1;let n=0;if(e.rtp.some((e=>e.codec.toUpperCase()===t.codec.toUpperCase()&&(n=e.payload,!0))),0===n)return!0;let r=!1;for(const i of e.fmtp)if(i.payload===n){i.config=i.config.split(";").filter((e=>!e.includes("maxaveragebitrate"))).join(";"),t.maxbr>0&&(i.config+=";maxaveragebitrate=".concat(1e3*t.maxbr)),r=!0;break}return r||t.maxbr>0&&e.fmtp.push({payload:n,config:"maxaveragebitrate=".concat(1e3*t.maxbr)}),!0}))})),n=xc.write(r)}yield this.setMungedSDP(e,n,!0),this.pendingCandidates.forEach((e=>{this.pc.addIceCandidate(e)})),this.pendingCandidates=[],this.restartingIce=!1,this.renegotiate?(this.renegotiate=!1,yield this.createAndSendOffer()):"answer"===e.type&&(this.emit(Bh.NegotiationComplete),e.sdp&&xc.parse(e.sdp).media.forEach((e=>{"video"===e.type&&this.emit(Bh.RTPVideoPayloadTypes,e.rtp)})))}))}createAndSendOffer(e){return J(this,void 0,void 0,(function*(){var t;if(void 0===this.onOffer)return;if(null!=e&&e.iceRestart&&(this.log.debug("restarting ICE",this.logContext),this.restartingIce=!0),this._pc&&"have-local-offer"===this._pc.signalingState){const t=this._pc.remoteDescription;if(null==e||!e.iceRestart||!t)return void(this.renegotiate=!0);yield this._pc.setRemoteDescription(t)}else if(!this._pc||"closed"===this._pc.signalingState)return void this.log.warn("could not createOffer with closed peer connection",this.logContext);this.log.debug("starting to negotiate",this.logContext);const n=yield this.pc.createOffer(e);this.log.debug("original offer",Object.assign({sdp:n.sdp},this.logContext));const r=xc.parse(null!==(t=n.sdp)&&void 0!==t?t:"");r.media.forEach((e=>{$8(e),"audio"===e.type?F8(e,[],[]):"video"===e.type&&this.trackBitrates.some((t=>{if(!e.msid||!t.cid||!e.msid.includes(t.cid))return!1;let n=0;if(e.rtp.some((e=>e.codec.toUpperCase()===t.codec.toUpperCase()&&(n=e.payload,!0))),0===n||(Xg(t.codec)&&this.ensureVideoDDExtensionForSVC(e,r),"av1"!==t.codec))return!0;const i=Math.round(.7*t.maxbr);for(const t of e.fmtp)if(t.payload===n){t.config.includes("x-google-start-bitrate")||(t.config+=";x-google-start-bitrate=".concat(i));break}return!0}))})),yield this.setMungedSDP(n,xc.write(r)),this.onOffer(n)}))}createAndSetAnswer(){return J(this,void 0,void 0,(function*(){var e;const t=yield this.pc.createAnswer(),n=xc.parse(null!==(e=t.sdp)&&void 0!==e?e:"");return n.media.forEach((e=>{$8(e),"audio"===e.type&&F8(e,this.remoteStereoMids,this.remoteNackMids)})),yield this.setMungedSDP(t,xc.write(n)),t}))}createDataChannel(e,t){return this.pc.createDataChannel(e,t)}addTransceiver(e,t){return this.pc.addTransceiver(e,t)}addTrack(e){if(!this._pc)throw new hr("PC closed, cannot add track");return this._pc.addTrack(e)}setTrackCodecBitrate(e){this.trackBitrates.push(e)}setConfiguration(e){var t;if(!this._pc)throw new hr("PC closed, cannot configure");return null===(t=this._pc)||void 0===t?void 0:t.setConfiguration(e)}canRemoveTrack(){var e;return!(null===(e=this._pc)||void 0===e||!e.removeTrack)}removeTrack(e){var t;return null===(t=this._pc)||void 0===t?void 0:t.removeTrack(e)}getConnectionState(){var e,t;return null!==(t=null===(e=this._pc)||void 0===e?void 0:e.connectionState)&&void 0!==t?t:"closed"}getICEConnectionState(){var e,t;return null!==(t=null===(e=this._pc)||void 0===e?void 0:e.iceConnectionState)&&void 0!==t?t:"closed"}getSignallingState(){var e,t;return null!==(t=null===(e=this._pc)||void 0===e?void 0:e.signalingState)&&void 0!==t?t:"closed"}getTransceivers(){var e,t;return null!==(t=null===(e=this._pc)||void 0===e?void 0:e.getTransceivers())&&void 0!==t?t:[]}getSenders(){var e,t;return null!==(t=null===(e=this._pc)||void 0===e?void 0:e.getSenders())&&void 0!==t?t:[]}getLocalDescription(){var e;return null===(e=this._pc)||void 0===e?void 0:e.localDescription}getRemoteDescription(){var e;return null===(e=this.pc)||void 0===e?void 0:e.remoteDescription}getStats(){return this.pc.getStats()}getConnectedAddress(){return J(this,void 0,void 0,(function*(){var e;if(!this._pc)return;let t="";const n=new Map,r=new Map;if((yield this._pc.getStats()).forEach((e=>{switch(e.type){case"transport":t=e.selectedCandidatePairId;break;case"candidate-pair":""===t&&e.selected&&(t=e.id),n.set(e.id,e);break;case"remote-candidate":r.set(e.id,"".concat(e.address,":").concat(e.port))}})),""===t)return;const i=null===(e=n.get(t))||void 0===e?void 0:e.remoteCandidateId;return void 0!==i?r.get(i):void 0}))}setMungedSDP(e,t,n){return J(this,void 0,void 0,(function*(){if(t){const r=e.sdp;e.sdp=t;try{return this.log.debug("setting munged ".concat(n?"remote":"local"," description"),this.logContext),void(n?yield this.pc.setRemoteDescription(e):yield this.pc.setLocalDescription(e))}catch(n){this.log.warn("not able to set ".concat(e.type,", falling back to unmodified sdp"),Object.assign(Object.assign({},this.logContext),{error:n,sdp:t})),e.sdp=r}}try{n?yield this.pc.setRemoteDescription(e):yield this.pc.setLocalDescription(e)}catch(t){let r="unknown error";t instanceof Error?r=t.message:"string"==typeof t&&(r=t);const i={error:r,sdp:e.sdp};throw!n&&this.pc.remoteDescription&&(i.remoteSdp=this.pc.remoteDescription),this.log.error("unable to set ".concat(e.type),Object.assign(Object.assign({},this.logContext),{fields:i})),new i3(r)}}))}ensureVideoDDExtensionForSVC(e,t){var n,r;if(!(null===(n=e.ext)||void 0===n?void 0:n.some((e=>e.uri===R8)))){if(0===this.ddExtID){let e=0;t.media.forEach((t=>{var n;"video"===t.type&&(null===(n=t.ext)||void 0===n||n.forEach((t=>{t.value>e&&(e=t.value)})))})),this.ddExtID=e+1}null===(r=e.ext)||void 0===r||r.push({value:this.ddExtID,uri:R8})}}}function F8(e,t,n){let r=0;e.rtp.some((e=>"opus"===e.codec&&(r=e.payload,!0))),r>0&&(e.rtcpFb||(e.rtcpFb=[]),n.includes(e.mid)&&!e.rtcpFb.some((e=>e.payload===r&&"nack"===e.type))&&e.rtcpFb.push({payload:r,type:"nack"}),t.includes(e.mid)&&e.fmtp.some((e=>e.payload===r&&(e.config.includes("stereo=1")||(e.config+=";stereo=1"),!0))))}function ade(e){var t;const n=[],r=[],i=xc.parse(null!==(t=e.sdp)&&void 0!==t?t:"");let o=0;return i.media.forEach((e=>{var t;"audio"===e.type&&(e.rtp.some((e=>"opus"===e.codec&&(o=e.payload,!0))),!(null===(t=e.rtcpFb)||void 0===t)&&t.some((e=>e.payload===o&&"nack"===e.type))&&r.push(e.mid),e.fmtp.some((t=>t.payload===o&&(t.config.includes("sprop-stereo=1")&&n.push(e.mid),!0))))})),{stereoMids:n,nackMids:r}}function $8(e){if(e.connection){const t=e.connection.ip.indexOf(":")>=0;(4===e.connection.version&&t||6===e.connection.version&&!t)&&(e.connection.ip="0.0.0.0",e.connection.version=4)}}const h3="vp8",lde={audioPreset:uS.music,dtx:!0,red:!0,forceStereo:!1,simulcast:!0,screenShareEncoding:VE.h1080fps15.encoding,stopMicTrackOnMute:!1,videoCodec:h3,backupCodec:!0},WV={deviceId:{ideal:"default"},autoGainControl:!0,echoCancellation:!0,noiseSuppression:!0,voiceIsolation:!0},zV={deviceId:{ideal:"default"},resolution:_a.h720.resolution},cde={adaptiveStream:!1,dynacast:!1,stopLocalTrackOnUnpublish:!0,reconnectPolicy:new nV,disconnectOnPageLeave:!0,webAudioMix:!1},bL={autoSubscribe:!0,maxRetries:1,peerConnectionTimeout:15e3,websocketTimeout:15e3};var Hn;!function(e){e[e.NEW=0]="NEW",e[e.CONNECTING=1]="CONNECTING",e[e.CONNECTED=2]="CONNECTED",e[e.FAILED=3]="FAILED",e[e.CLOSING=4]="CLOSING",e[e.CLOSED=5]="CLOSED"}(Hn||(Hn={}));class ude{get needsPublisher(){return this.isPublisherConnectionRequired}get needsSubscriber(){return this.isSubscriberConnectionRequired}get currentState(){return this.state}constructor(e,t,n){var r;this.peerConnectionTimeout=bL.peerConnectionTimeout,this.log=bt,this.updateState=()=>{var e;const t=this.state,n=this.requiredTransports.map((e=>e.getConnectionState()));n.every((e=>"connected"===e))?this.state=Hn.CONNECTED:n.some((e=>"failed"===e))?this.state=Hn.FAILED:n.some((e=>"connecting"===e))?this.state=Hn.CONNECTING:n.every((e=>"closed"===e))?this.state=Hn.CLOSED:n.some((e=>"closed"===e))?this.state=Hn.CLOSING:n.every((e=>"new"===e))&&(this.state=Hn.NEW),t!==this.state&&(this.log.debug("pc state change: from ".concat(Hn[t]," to ").concat(Hn[this.state]),this.logContext),null===(e=this.onStateChange)||void 0===e||e.call(this,this.state,this.publisher.getConnectionState(),this.subscriber.getConnectionState()))},this.log=Ol(null!==(r=n.loggerName)&&void 0!==r?r:$o.PCManager),this.loggerOptions=n,this.isPublisherConnectionRequired=!t,this.isSubscriberConnectionRequired=t,this.publisher=new U8(e,n),this.subscriber=new U8(e,n),this.publisher.onConnectionStateChange=this.updateState,this.subscriber.onConnectionStateChange=this.updateState,this.publisher.onIceConnectionStateChange=this.updateState,this.subscriber.onIceConnectionStateChange=this.updateState,this.publisher.onSignalingStatechange=this.updateState,this.subscriber.onSignalingStatechange=this.updateState,this.publisher.onIceCandidate=e=>{var t;null===(t=this.onIceCandidate)||void 0===t||t.call(this,e,Oo.PUBLISHER)},this.subscriber.onIceCandidate=e=>{var t;null===(t=this.onIceCandidate)||void 0===t||t.call(this,e,Oo.SUBSCRIBER)},this.subscriber.onDataChannel=e=>{var t;null===(t=this.onDataChannel)||void 0===t||t.call(this,e)},this.subscriber.onTrack=e=>{var t;null===(t=this.onTrack)||void 0===t||t.call(this,e)},this.publisher.onOffer=e=>{var t;null===(t=this.onPublisherOffer)||void 0===t||t.call(this,e)},this.state=Hn.NEW,this.connectionLock=new Ei,this.remoteOfferLock=new Ei}get logContext(){var e,t;return Object.assign({},null===(t=(e=this.loggerOptions).loggerContextCb)||void 0===t?void 0:t.call(e))}requirePublisher(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.isPublisherConnectionRequired=e,this.updateState()}requireSubscriber(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.isSubscriberConnectionRequired=e,this.updateState()}createAndSendPublisherOffer(e){return this.publisher.createAndSendOffer(e)}setPublisherAnswer(e){return this.publisher.setRemoteDescription(e)}removeTrack(e){return this.publisher.removeTrack(e)}close(){return J(this,void 0,void 0,(function*(){if(this.publisher&&"closed"!==this.publisher.getSignallingState()){const e=this.publisher;for(const t of e.getSenders())try{e.canRemoveTrack()&&e.removeTrack(t)}catch(e){this.log.warn("could not removeTrack",Object.assign(Object.assign({},this.logContext),{error:e}))}}yield Promise.all([this.publisher.close(),this.subscriber.close()]),this.updateState()}))}triggerIceRestart(){return J(this,void 0,void 0,(function*(){this.subscriber.restartingIce=!0,this.needsPublisher&&(yield this.createAndSendPublisherOffer({iceRestart:!0}))}))}addIceCandidate(e,t){return J(this,void 0,void 0,(function*(){t===Oo.PUBLISHER?yield this.publisher.addIceCandidate(e):yield this.subscriber.addIceCandidate(e)}))}createSubscriberAnswerFromOffer(e){return J(this,void 0,void 0,(function*(){this.log.debug("received server offer",Object.assign(Object.assign({},this.logContext),{RTCSdpType:e.type,sdp:e.sdp,signalingState:this.subscriber.getSignallingState().toString()}));const t=yield this.remoteOfferLock.lock();try{return yield this.subscriber.setRemoteDescription(e),yield this.subscriber.createAndSetAnswer()}finally{t()}}))}updateConfiguration(e,t){this.publisher.setConfiguration(e),this.subscriber.setConfiguration(e),t&&this.triggerIceRestart()}ensurePCTransportConnection(e,t){return J(this,void 0,void 0,(function*(){var n;const r=yield this.connectionLock.lock();try{this.isPublisherConnectionRequired&&"connected"!==this.publisher.getConnectionState()&&"connecting"!==this.publisher.getConnectionState()&&(this.log.debug("negotiation required, start negotiating",this.logContext),this.publisher.negotiate()),yield Promise.all(null===(n=this.requiredTransports)||void 0===n?void 0:n.map((n=>this.ensureTransportConnected(n,e,t))))}finally{r()}}))}negotiate(e){return J(this,void 0,void 0,(function*(){return new Promise(((t,n)=>J(this,void 0,void 0,(function*(){const r=setTimeout((()=>{n("negotiation timed out")}),this.peerConnectionTimeout);e.signal.addEventListener("abort",(()=>{clearTimeout(r),n("negotiation aborted")})),this.publisher.once(Bh.NegotiationStarted,(()=>{e.signal.aborted||this.publisher.once(Bh.NegotiationComplete,(()=>{clearTimeout(r),t()}))})),yield this.publisher.negotiate((e=>{clearTimeout(r),n(e)}))}))))}))}addPublisherTransceiver(e,t){return this.publisher.addTransceiver(e,t)}addPublisherTrack(e){return this.publisher.addTrack(e)}createPublisherDataChannel(e,t){return this.publisher.createDataChannel(e,t)}getConnectedAddress(e){return e===Oo.PUBLISHER||e===Oo.SUBSCRIBER?this.publisher.getConnectedAddress():this.requiredTransports[0].getConnectedAddress()}get requiredTransports(){const e=[];return this.isPublisherConnectionRequired&&e.push(this.publisher),this.isSubscriberConnectionRequired&&e.push(this.subscriber),e}ensureTransportConnected(e,t){return J(this,arguments,void 0,(function(e,t){var n=this;let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.peerConnectionTimeout;return function*(){if("connected"!==e.getConnectionState())return new Promise(((e,i)=>J(n,void 0,void 0,(function*(){const n=()=>{this.log.warn("abort transport connection",this.logContext),zr.clearTimeout(o),i(new en("room connection has been cancelled",kt.Cancelled))};null!=t&&t.signal.aborted&&n(),null==t||t.signal.addEventListener("abort",n);const o=zr.setTimeout((()=>{null==t||t.signal.removeEventListener("abort",n),i(new en("could not establish pc connection",kt.InternalError))}),r);for(;this.state!==Hn.CONNECTED;)if(yield Ji(50),null!=t&&t.signal.aborted)return void i(new en("room connection has been cancelled",kt.Cancelled));zr.clearTimeout(o),null==t||t.signal.removeEventListener("abort",n),e()}))))}()}))}}class Vn extends Error{constructor(e,t,n){super(t),this.code=e,this.message=H8(t,Vn.MAX_MESSAGE_BYTES),this.data=n?H8(n,Vn.MAX_DATA_BYTES):void 0}static fromProto(e){return new Vn(e.code,e.message,e.data)}toProto(){return new DB({code:this.code,message:this.message,data:this.data})}static builtIn(e,t){return new Vn(Vn.ErrorCode[e],Vn.ErrorMessage[e],t)}}Vn.MAX_MESSAGE_BYTES=256,Vn.MAX_DATA_BYTES=15360,Vn.ErrorCode={APPLICATION_ERROR:1500,CONNECTION_TIMEOUT:1501,RESPONSE_TIMEOUT:1502,RECIPIENT_DISCONNECTED:1503,RESPONSE_PAYLOAD_TOO_LARGE:1504,SEND_FAILED:1505,UNSUPPORTED_METHOD:1400,RECIPIENT_NOT_FOUND:1401,REQUEST_PAYLOAD_TOO_LARGE:1402,UNSUPPORTED_SERVER:1403,UNSUPPORTED_VERSION:1404},Vn.ErrorMessage={APPLICATION_ERROR:"Application error in method handler",CONNECTION_TIMEOUT:"Connection timeout",RESPONSE_TIMEOUT:"Response timeout",RECIPIENT_DISCONNECTED:"Recipient disconnected",RESPONSE_PAYLOAD_TOO_LARGE:"Response payload too large",SEND_FAILED:"Failed to send",UNSUPPORTED_METHOD:"Method not supported at destination",RECIPIENT_NOT_FOUND:"Recipient not found",REQUEST_PAYLOAD_TOO_LARGE:"Request payload too large",UNSUPPORTED_SERVER:"RPC not supported by server",UNSUPPORTED_VERSION:"Unsupported RPC version"};const YV=15360;function SL(e){return(new TextEncoder).encode(e).length}function H8(e,t){if(SL(e)<=t)return e;let n=0,r=e.length;const i=new TextEncoder;for(;n<r;){const o=Math.floor((n+r+1)/2);i.encode(e.slice(0,o)).length<=t?n=o:r=o-1}return e.slice(0,n)}const EL=2e3;function qE(e,t){if(!t)return 0;let n,r;return"bytesReceived"in e?(n=e.bytesReceived,r=t.bytesReceived):"bytesSent"in e&&(n=e.bytesSent,r=t.bytesSent),void 0===n||void 0===r||void 0===e.timestamp||void 0===t.timestamp?0:8*(n-r)*1e3/(e.timestamp-t.timestamp)}const dde=1e3;class KE extends ue{get sender(){return this._sender}set sender(e){this._sender=e}get constraints(){return this._constraints}constructor(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];super(e,t,arguments.length>4?arguments[4]:void 0),this.manuallyStopped=!1,this._isUpstreamPaused=!1,this.handleTrackMuteEvent=()=>this.debouncedTrackMuteHandler().catch((()=>this.log.debug("track mute bounce got cancelled by an unmute event",this.logContext))),this.debouncedTrackMuteHandler=_L((()=>J(this,void 0,void 0,(function*(){yield this.pauseUpstream()}))),5e3),this.handleTrackUnmuteEvent=()=>J(this,void 0,void 0,(function*(){this.debouncedTrackMuteHandler.cancel("unmute"),yield this.resumeUpstream()})),this.handleEnded=()=>{this.isInBackground&&(this.reacquireTrack=!0),this._mediaStreamTrack.removeEventListener("mute",this.handleTrackMuteEvent),this._mediaStreamTrack.removeEventListener("unmute",this.handleTrackUnmuteEvent),this.emit(Re.Ended,this)},this.reacquireTrack=!1,this.providedByUser=r,this.muteLock=new Ei,this.pauseUpstreamLock=new Ei,this.processorLock=new Ei,this.restartLock=new Ei,this.setMediaStreamTrack(e,!0),this._constraints=e.getConstraints(),n&&(this._constraints=n)}get id(){return this._mediaStreamTrack.id}get dimensions(){if(this.kind!==ue.Kind.Video)return;const{width:e,height:t}=this._mediaStreamTrack.getSettings();return e&&t?{width:e,height:t}:void 0}get isUpstreamPaused(){return this._isUpstreamPaused}get isUserProvided(){return this.providedByUser}get mediaStreamTrack(){var e,t;return null!==(t=null===(e=this.processor)||void 0===e?void 0:e.processedTrack)&&void 0!==t?t:this._mediaStreamTrack}get isLocal(){return!0}getSourceTrackSettings(){return this._mediaStreamTrack.getSettings()}setMediaStreamTrack(e,t){return J(this,void 0,void 0,(function*(){var n;if(e===this._mediaStreamTrack&&!t)return;let r;if(this._mediaStreamTrack&&(this.attachedElements.forEach((e=>{Hh(this._mediaStreamTrack,e)})),this.debouncedTrackMuteHandler.cancel("new-track"),this._mediaStreamTrack.removeEventListener("ended",this.handleEnded),this._mediaStreamTrack.removeEventListener("mute",this.handleTrackMuteEvent),this._mediaStreamTrack.removeEventListener("unmute",this.handleTrackUnmuteEvent)),this.mediaStream=new MediaStream([e]),e&&(e.addEventListener("ended",this.handleEnded),e.addEventListener("mute",this.handleTrackMuteEvent),e.addEventListener("unmute",this.handleTrackUnmuteEvent),this._constraints=e.getConstraints()),this.processor&&e){const t=yield this.processorLock.lock();try{if(this.log.debug("restarting processor",this.logContext),"unknown"===this.kind)throw TypeError("cannot set processor on track of unknown kind");this.processorElement&&(Sh(e,this.processorElement),this.processorElement.muted=!0),yield this.processor.restart({track:e,kind:this.kind,element:this.processorElement}),r=this.processor.processedTrack}finally{t()}}this.sender&&"closed"!==(null===(n=this.sender.transport)||void 0===n?void 0:n.state)&&(yield this.sender.replaceTrack(r??e)),!this.providedByUser&&this._mediaStreamTrack!==e&&this._mediaStreamTrack.stop(),this._mediaStreamTrack=e,e&&(this._mediaStreamTrack.enabled=!this.isMuted,yield this.resumeUpstream(),this.attachedElements.forEach((t=>{Sh(r??e,t)})))}))}waitForDimensions(){return J(this,arguments,void 0,(function(){var e=this;let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:dde;return function*(){var n;if(e.kind===ue.Kind.Audio)throw new Error("cannot get dimensions for audio tracks");"iOS"===(null===(n=Ho())||void 0===n?void 0:n.os)&&(yield Ji(10));const r=Date.now();for(;Date.now()-r<t;){const t=e.dimensions;if(t)return t;yield Ji(50)}throw new ml("unable to get track dimensions after timeout")}()}))}setDeviceId(e){return J(this,void 0,void 0,(function*(){return!!(this._constraints.deviceId===e&&this._mediaStreamTrack.getSettings().deviceId===Zc(e)||(this._constraints.deviceId=e,this.isMuted))||(yield this.restartTrack(),Zc(e)===this._mediaStreamTrack.getSettings().deviceId)}))}getDeviceId(){return J(this,arguments,void 0,(function(){var e=this;let t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return function*(){if(e.source===ue.Source.ScreenShare)return;const{deviceId:n,groupId:r}=e._mediaStreamTrack.getSettings(),i=e.kind===ue.Kind.Audio?"audioinput":"videoinput";return t?Mr.getInstance().normalizeDeviceId(i,n,r):n}()}))}mute(){return J(this,void 0,void 0,(function*(){return this.setTrackMuted(!0),this}))}unmute(){return J(this,void 0,void 0,(function*(){return this.setTrackMuted(!1),this}))}replaceTrack(e,t){return J(this,void 0,void 0,(function*(){if(!this.sender)throw new ml("unable to replace an unpublished track");let n,r;return"boolean"==typeof t?n=t:void 0!==t&&(n=t.userProvidedTrack,r=t.stopProcessor),this.providedByUser=n??!0,this.log.debug("replace MediaStreamTrack",this.logContext),yield this.setMediaStreamTrack(e),r&&this.processor&&(yield this.stopProcessor()),this}))}restart(e){return J(this,void 0,void 0,(function*(){this.manuallyStopped=!1;const t=yield this.restartLock.lock();try{e||(e=this._constraints);const{deviceId:t,facingMode:n}=e,r=Qce(e,["deviceId","facingMode"]);this.log.debug("restarting track with constraints",Object.assign(Object.assign({},this.logContext),{constraints:e}));const i={audio:!1,video:!1};this.kind===ue.Kind.Video?i.video=!t&&!n||{deviceId:t,facingMode:n}:i.audio=!t||{deviceId:t},this.attachedElements.forEach((e=>{Hh(this.mediaStreamTrack,e)})),this._mediaStreamTrack.removeEventListener("ended",this.handleEnded),this._mediaStreamTrack.stop();const o=(yield navigator.mediaDevices.getUserMedia(i)).getTracks()[0];return yield o.applyConstraints(r),o.addEventListener("ended",this.handleEnded),this.log.debug("re-acquired MediaStreamTrack",this.logContext),yield this.setMediaStreamTrack(o),this._constraints=e,this.emit(Re.Restarted,this),this.manuallyStopped&&(this.log.warn("track was stopped during a restart, stopping restarted track",this.logContext),this.stop()),this}finally{t()}}))}setTrackMuted(e){this.log.debug("setting ".concat(this.kind," track ").concat(e?"muted":"unmuted"),this.logContext),(this.isMuted!==e||this._mediaStreamTrack.enabled===e)&&(this.isMuted=e,this._mediaStreamTrack.enabled=!e,this.emit(e?Re.Muted:Re.Unmuted,this))}get needsReAcquisition(){return"live"!==this._mediaStreamTrack.readyState||this._mediaStreamTrack.muted||!this._mediaStreamTrack.enabled||this.reacquireTrack}handleAppVisibilityChanged(){const e=Object.create(null,{handleAppVisibilityChanged:{get:()=>super.handleAppVisibilityChanged}});return J(this,void 0,void 0,(function*(){yield e.handleAppVisibilityChanged.call(this),UV()&&(this.log.debug("visibility changed, is in Background: ".concat(this.isInBackground),this.logContext),!this.isInBackground&&this.needsReAcquisition&&!this.isUserProvided&&!this.isMuted&&(this.log.debug("track needs to be reacquired, restarting ".concat(this.source),this.logContext),yield this.restart(),this.reacquireTrack=!1))}))}stop(){var e;this.manuallyStopped=!0,super.stop(),this._mediaStreamTrack.removeEventListener("ended",this.handleEnded),this._mediaStreamTrack.removeEventListener("mute",this.handleTrackMuteEvent),this._mediaStreamTrack.removeEventListener("unmute",this.handleTrackUnmuteEvent),null===(e=this.processor)||void 0===e||e.destroy(),this.processor=void 0}pauseUpstream(){return J(this,void 0,void 0,(function*(){var e;const t=yield this.pauseUpstreamLock.lock();try{if(!0===this._isUpstreamPaused)return;if(!this.sender)return void this.log.warn("unable to pause upstream for an unpublished track",this.logContext);this._isUpstreamPaused=!0,this.emit(Re.UpstreamPaused,this);const t=Ho();if("Safari"===(null==t?void 0:t.name)&&Nd(t.version,"12.0")<0)throw new mL("pauseUpstream is not supported on Safari < 12.");"closed"!==(null===(e=this.sender.transport)||void 0===e?void 0:e.state)&&(yield this.sender.replaceTrack(null))}finally{t()}}))}resumeUpstream(){return J(this,void 0,void 0,(function*(){var e;const t=yield this.pauseUpstreamLock.lock();try{if(!1===this._isUpstreamPaused)return;if(!this.sender)return void this.log.warn("unable to resume upstream for an unpublished track",this.logContext);this._isUpstreamPaused=!1,this.emit(Re.UpstreamResumed,this),"closed"!==(null===(e=this.sender.transport)||void 0===e?void 0:e.state)&&(yield this.sender.replaceTrack(this.mediaStreamTrack))}finally{t()}}))}getRTCStatsReport(){return J(this,void 0,void 0,(function*(){var e;return null!==(e=this.sender)&&void 0!==e&&e.getStats?yield this.sender.getStats():void 0}))}setProcessor(e){return J(this,arguments,void 0,(function(e){var t=this;let n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return function*(){var r;const i=yield t.processorLock.lock();try{t.log.debug("setting up processor",t.logContext);const i=document.createElement(t.kind),o={kind:t.kind,track:t._mediaStreamTrack,element:i,audioContext:t.audioContext};if(yield e.init(o),t.log.debug("processor initialized",t.logContext),t.processor&&(yield t.stopProcessor()),"unknown"===t.kind)throw TypeError("cannot set processor on track of unknown kind");if(Sh(t._mediaStreamTrack,i),i.muted=!0,i.play().catch((e=>t.log.error("failed to play processor element",Object.assign(Object.assign({},t.logContext),{error:e})))),t.processor=e,t.processorElement=i,t.processor.processedTrack){for(const e of t.attachedElements)e!==t.processorElement&&n&&(Hh(t._mediaStreamTrack,e),Sh(t.processor.processedTrack,e));yield null===(r=t.sender)||void 0===r?void 0:r.replaceTrack(t.processor.processedTrack)}t.emit(Re.TrackProcessorUpdate,t.processor)}finally{i()}}()}))}getProcessor(){return this.processor}stopProcessor(){return J(this,arguments,void 0,(function(){var e=this;let t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return function*(){var n,r;e.processor&&(e.log.debug("stopping processor",e.logContext),null===(n=e.processor.processedTrack)||void 0===n||n.stop(),yield e.processor.destroy(),e.processor=void 0,t||(null===(r=e.processorElement)||void 0===r||r.remove(),e.processorElement=void 0),yield e._mediaStreamTrack.applyConstraints(e._constraints),yield e.setMediaStreamTrack(e._mediaStreamTrack,!0),e.emit(Re.TrackProcessorUpdate))}()}))}}class fS extends KE{get enhancedNoiseCancellation(){return this.isKrispNoiseFilterEnabled}constructor(e,t){let n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],r=arguments.length>3?arguments[3]:void 0,i=arguments.length>4?arguments[4]:void 0;super(e,ue.Kind.Audio,t,n,i),this.stopOnMute=!1,this.isKrispNoiseFilterEnabled=!1,this.monitorSender=()=>J(this,void 0,void 0,(function*(){if(!this.sender)return void(this._currentBitrate=0);let e;try{e=yield this.getSenderStats()}catch(e){return void this.log.error("could not get audio sender stats",Object.assign(Object.assign({},this.logContext),{error:e}))}e&&this.prevStats&&(this._currentBitrate=qE(e,this.prevStats)),this.prevStats=e})),this.handleKrispNoiseFilterEnable=()=>{this.isKrispNoiseFilterEnabled=!0,this.log.debug("Krisp noise filter enabled",this.logContext),this.emit(Re.AudioTrackFeatureUpdate,this,pa.TF_ENHANCED_NOISE_CANCELLATION,!0)},this.handleKrispNoiseFilterDisable=()=>{this.isKrispNoiseFilterEnabled=!1,this.log.debug("Krisp noise filter disabled",this.logContext),this.emit(Re.AudioTrackFeatureUpdate,this,pa.TF_ENHANCED_NOISE_CANCELLATION,!1)},this.audioContext=r,this.checkForSilence()}mute(){const e=Object.create(null,{mute:{get:()=>super.mute}});return J(this,void 0,void 0,(function*(){const t=yield this.muteLock.lock();try{return this.isMuted?(this.log.debug("Track already muted",this.logContext),this):(this.source===ue.Source.Microphone&&this.stopOnMute&&!this.isUserProvided&&(this.log.debug("stopping mic track",this.logContext),this._mediaStreamTrack.stop()),yield e.mute.call(this),this)}finally{t()}}))}unmute(){const e=Object.create(null,{unmute:{get:()=>super.unmute}});return J(this,void 0,void 0,(function*(){const t=yield this.muteLock.lock();try{if(!this.isMuted)return this.log.debug("Track already unmuted",this.logContext),this;const t=this._constraints.deviceId&&this._mediaStreamTrack.getSettings().deviceId!==Zc(this._constraints.deviceId);return this.source===ue.Source.Microphone&&(this.stopOnMute||"ended"===this._mediaStreamTrack.readyState||t)&&!this.isUserProvided&&(this.log.debug("reacquiring mic track",this.logContext),yield this.restartTrack()),yield e.unmute.call(this),this}finally{t()}}))}restartTrack(e){return J(this,void 0,void 0,(function*(){let t;if(e){const n=gL({audio:e});"boolean"!=typeof n.audio&&(t=n.audio)}yield this.restart(t)}))}restart(e){const t=Object.create(null,{restart:{get:()=>super.restart}});return J(this,void 0,void 0,(function*(){const n=yield t.restart.call(this,e);return this.checkForSilence(),n}))}startMonitor(){Wi()&&(this.monitorInterval||(this.monitorInterval=setInterval((()=>{this.monitorSender()}),EL)))}setProcessor(e){return J(this,void 0,void 0,(function*(){var t;const n=yield this.processorLock.lock();try{if(!Ca()&&!this.audioContext)throw Error("Audio context needs to be set on LocalAudioTrack in order to enable processors");this.processor&&(yield this.stopProcessor());const n={kind:this.kind,track:this._mediaStreamTrack,audioContext:this.audioContext};this.log.debug("setting up audio processor ".concat(e.name),this.logContext),yield e.init(n),this.processor=e,this.processor.processedTrack&&(yield null===(t=this.sender)||void 0===t?void 0:t.replaceTrack(this.processor.processedTrack),this.processor.processedTrack.addEventListener("enable-lk-krisp-noise-filter",this.handleKrispNoiseFilterEnable),this.processor.processedTrack.addEventListener("disable-lk-krisp-noise-filter",this.handleKrispNoiseFilterDisable)),this.emit(Re.TrackProcessorUpdate,this.processor)}finally{n()}}))}setAudioContext(e){this.audioContext=e}getSenderStats(){return J(this,void 0,void 0,(function*(){var e;if(null===(e=this.sender)||void 0===e||!e.getStats)return;let t;return(yield this.sender.getStats()).forEach((e=>{"outbound-rtp"===e.type&&(t={type:"audio",streamId:e.id,packetsSent:e.packetsSent,packetsLost:e.packetsLost,bytesSent:e.bytesSent,timestamp:e.timestamp,roundTripTime:e.roundTripTime,jitter:e.jitter})})),t}))}checkForSilence(){return J(this,void 0,void 0,(function*(){const e=yield VV(this);return e&&(this.isMuted||this.log.warn("silence detected on local audio track",this.logContext),this.emit(Re.AudioSilenceDetected)),e}))}}function fde(e,t,n){switch(e.kind){case"audio":return new fS(e,t,!1,void 0,n);case"video":return new Dv(e,t,!1,n);default:throw new ml("unsupported track type: ".concat(e.kind))}}const hde=Object.values(_a),pde=Object.values(s3),mde=Object.values(VE),gde=[_a.h180,_a.h360],vde=[s3.h180,s3.h360],yde=e=>[{scaleResolutionDownBy:2,fps:e.encoding.maxFramerate}].map((t=>{var n,r;return new Qt(Math.floor(e.width/t.scaleResolutionDownBy),Math.floor(e.height/t.scaleResolutionDownBy),Math.max(15e4,Math.floor(e.encoding.maxBitrate/(Math.pow(t.scaleResolutionDownBy,2)*((null!==(n=e.encoding.maxFramerate)&&void 0!==n?n:30)/(null!==(r=t.fps)&&void 0!==r?r:30))))),t.fps,e.encoding.priority)})),p3=["q","h","f"];function m3(e,t,n,r){var i,o;let s=null==r?void 0:r.videoEncoding;e&&(s=null==r?void 0:r.screenShareEncoding);const a=null==r?void 0:r.simulcast,l=null==r?void 0:r.scalabilityMode,c=null==r?void 0:r.videoCodec;if(!s&&!a&&!l||!t||!n)return[{}];s||(s=bde(e,t,n,c),bt.debug("using video encoding",s));const u=s.maxFramerate,d=new Qt(t,n,s.maxBitrate,s.maxFramerate,s.priority);if(l&&Xg(c)){const e=new hS(l),t=[];if(e.spatial>3)throw new Error("unsupported scalabilityMode: ".concat(l));const n=Ho();if(uu()||Ca()||"Chrome"===(null==n?void 0:n.name)&&Nd(null==n?void 0:n.version,"113")<0){const n="h"==e.suffix?2:3;for(let r=0;r<e.spatial;r+=1)t.push({rid:p3[2-r],maxBitrate:s.maxBitrate/Math.pow(n,r),maxFramerate:d.encoding.maxFramerate});t[0].scalabilityMode=l}else t.push({maxBitrate:s.maxBitrate,maxFramerate:d.encoding.maxFramerate,scalabilityMode:l});return d.encoding.priority&&(t[0].priority=d.encoding.priority,t[0].networkPriority=d.encoding.priority),bt.debug("using svc encoding",{encodings:t}),t}if(!a)return[s];let h,p=[];if(p=e?null!==(i=V8(null==r?void 0:r.screenShareSimulcastLayers))&&void 0!==i?i:B8(e,d):null!==(o=V8(null==r?void 0:r.videoSimulcastLayers))&&void 0!==o?o:B8(e,d),p.length>0){const e=p[0];p.length>1&&([,h]=p);const r=Math.max(t,n);if(r>=960&&h)return M2(t,n,[e,h,d],u);if(r>=480)return M2(t,n,[e,d],u)}return M2(t,n,[d])}function _de(e,t,n){var r,i,o,s;if(!n.backupCodec||!0===n.backupCodec||n.backupCodec.codec===n.videoCodec)return;t!==n.backupCodec.codec&&bt.warn("requested a different codec than specified as backup",{serverRequested:t,backup:n.backupCodec.codec}),n.videoCodec=t,n.videoEncoding=n.backupCodec.encoding;const a=e.mediaStreamTrack.getSettings(),l=null!==(r=a.width)&&void 0!==r?r:null===(i=e.dimensions)||void 0===i?void 0:i.width,c=null!==(o=a.height)&&void 0!==o?o:null===(s=e.dimensions)||void 0===s?void 0:s.height;return e.source===ue.Source.ScreenShare&&n.simulcast&&(n.simulcast=!1),m3(e.source===ue.Source.ScreenShare,l,c,n)}function bde(e,t,n,r){const i=Sde(e,t,n);let{encoding:o}=i[0];const s=Math.max(t,n);for(let e=0;e<i.length;e+=1){const t=i[e];if(o=t.encoding,t.width>=s)break}if(r)switch(r){case"av1":o=Object.assign({},o),o.maxBitrate=.7*o.maxBitrate;break;case"vp9":o=Object.assign({},o),o.maxBitrate=.85*o.maxBitrate}return o}function Sde(e,t,n){if(e)return mde;const r=t>n?t/n:n/t;return Math.abs(r-16/9)<Math.abs(r-4/3)?hde:pde}function B8(e,t){if(e)return yde(t);const{width:n,height:r}=t,i=n>r?n/r:r/n;return Math.abs(i-16/9)<Math.abs(i-4/3)?gde:vde}function M2(e,t,n,r){const i=[];if(n.forEach(((n,o)=>{if(o>=p3.length)return;const s=Math.min(e,t),a={rid:p3[o],scaleResolutionDownBy:Math.max(1,s/Math.min(n.width,n.height)),maxBitrate:n.encoding.maxBitrate},l=r&&n.encoding.maxFramerate?Math.min(r,n.encoding.maxFramerate):n.encoding.maxFramerate;l&&(a.maxFramerate=l);const c=fp()||0===o;n.encoding.priority&&c&&(a.priority=n.encoding.priority,a.networkPriority=n.encoding.priority),i.push(a)})),Ca()&&"ios"===$V()){let e;i.forEach((t=>{e?t.maxFramerate&&t.maxFramerate>e&&(e=t.maxFramerate):e=t.maxFramerate}));let t=!0;i.forEach((n=>{var r;n.maxFramerate!=e&&(t&&(t=!1,bt.info("Simulcast on iOS React-Native requires all encodings to share the same framerate.")),bt.info('Setting framerate of encoding "'.concat(null!==(r=n.rid)&&void 0!==r?r:"",'" to ').concat(e)),n.maxFramerate=e)}))}return i}function V8(e){if(e)return e.sort(((e,t)=>{const{encoding:n}=e,{encoding:r}=t;return n.maxBitrate>r.maxBitrate?1:n.maxBitrate<r.maxBitrate?-1:n.maxBitrate===r.maxBitrate&&n.maxFramerate&&r.maxFramerate?n.maxFramerate>r.maxFramerate?1:-1:0}))}class hS{constructor(e){const t=e.match(/^L(\d)T(\d)(h|_KEY|_KEY_SHIFT){0,1}$/);if(!t)throw new Error("invalid scalability mode");if(this.spatial=parseInt(t[1]),this.temporal=parseInt(t[2]),t.length>3)switch(t[3]){case"h":case"_KEY":case"_KEY_SHIFT":this.suffix=t[3]}}toString(){var e;return"L".concat(this.spatial,"T").concat(this.temporal).concat(null!==(e=this.suffix)&&void 0!==e?e:"")}}function Ede(e){return e.source===ue.Source.ScreenShare||e.constraints.height&&Zc(e.constraints.height)>=1080?"maintain-resolution":"balanced"}const wde=5e3;class Dv extends KE{get sender(){return this._sender}set sender(e){this._sender=e,this.degradationPreference&&this.setDegradationPreference(this.degradationPreference)}constructor(e,t){let n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],r=arguments.length>3?arguments[3]:void 0;super(e,ue.Kind.Video,t,n,r),this.simulcastCodecs=new Map,this.degradationPreference="balanced",this.monitorSender=()=>J(this,void 0,void 0,(function*(){if(!this.sender)return void(this._currentBitrate=0);let e;try{e=yield this.getSenderStats()}catch(e){return void this.log.error("could not get audio sender stats",Object.assign(Object.assign({},this.logContext),{error:e}))}const t=new Map(e.map((e=>[e.rid,e])));if(this.prevStats){let e=0;t.forEach(((t,n)=>{var r;const i=null===(r=this.prevStats)||void 0===r?void 0:r.get(n);e+=qE(t,i)})),this._currentBitrate=e}this.prevStats=t})),this.senderLock=new Ei}get isSimulcast(){return!!(this.sender&&this.sender.getParameters().encodings.length>1)}startMonitor(e){var t;if(this.signalClient=e,!Wi())return;const n=null===(t=this.sender)||void 0===t?void 0:t.getParameters();n&&(this.encodings=n.encodings),!this.monitorInterval&&(this.monitorInterval=setInterval((()=>{this.monitorSender()}),EL))}stop(){this._mediaStreamTrack.getConstraints(),this.simulcastCodecs.forEach((e=>{e.mediaStreamTrack.stop()})),super.stop()}pauseUpstream(){const e=Object.create(null,{pauseUpstream:{get:()=>super.pauseUpstream}});return J(this,void 0,void 0,(function*(){var t,n,r,i,o;yield e.pauseUpstream.call(this);try{for(var s,a=!0,l=jc(this.simulcastCodecs.values());!(t=(s=yield l.next()).done);a=!0)i=s.value,a=!1,yield null===(o=i.sender)||void 0===o?void 0:o.replaceTrack(null)}catch(e){n={error:e}}finally{try{!a&&!t&&(r=l.return)&&(yield r.call(l))}finally{if(n)throw n.error}}}))}resumeUpstream(){const e=Object.create(null,{resumeUpstream:{get:()=>super.resumeUpstream}});return J(this,void 0,void 0,(function*(){var t,n,r,i,o;yield e.resumeUpstream.call(this);try{for(var s,a=!0,l=jc(this.simulcastCodecs.values());!(t=(s=yield l.next()).done);a=!0){i=s.value,a=!1;const e=i;yield null===(o=e.sender)||void 0===o?void 0:o.replaceTrack(e.mediaStreamTrack)}}catch(e){n={error:e}}finally{try{!a&&!t&&(r=l.return)&&(yield r.call(l))}finally{if(n)throw n.error}}}))}mute(){const e=Object.create(null,{mute:{get:()=>super.mute}});return J(this,void 0,void 0,(function*(){const t=yield this.muteLock.lock();try{return this.isMuted?(this.log.debug("Track already muted",this.logContext),this):(this.source===ue.Source.Camera&&!this.isUserProvided&&(this.log.debug("stopping camera track",this.logContext),this._mediaStreamTrack.stop()),yield e.mute.call(this),this)}finally{t()}}))}unmute(){const e=Object.create(null,{unmute:{get:()=>super.unmute}});return J(this,void 0,void 0,(function*(){const t=yield this.muteLock.lock();try{return this.isMuted?(this.source===ue.Source.Camera&&!this.isUserProvided&&(this.log.debug("reacquiring camera track",this.logContext),yield this.restartTrack()),yield e.unmute.call(this),this):(this.log.debug("Track already unmuted",this.logContext),this)}finally{t()}}))}setTrackMuted(e){super.setTrackMuted(e);for(const t of this.simulcastCodecs.values())t.mediaStreamTrack.enabled=!e}getSenderStats(){return J(this,void 0,void 0,(function*(){var e;if(null===(e=this.sender)||void 0===e||!e.getStats)return[];const t=[],n=yield this.sender.getStats();return n.forEach((e=>{var r;if("outbound-rtp"===e.type){const i={type:"video",streamId:e.id,frameHeight:e.frameHeight,frameWidth:e.frameWidth,framesPerSecond:e.framesPerSecond,framesSent:e.framesSent,firCount:e.firCount,pliCount:e.pliCount,nackCount:e.nackCount,packetsSent:e.packetsSent,bytesSent:e.bytesSent,qualityLimitationReason:e.qualityLimitationReason,qualityLimitationDurations:e.qualityLimitationDurations,qualityLimitationResolutionChanges:e.qualityLimitationResolutionChanges,rid:null!==(r=e.rid)&&void 0!==r?r:e.id,retransmittedPacketsSent:e.retransmittedPacketsSent,targetBitrate:e.targetBitrate,timestamp:e.timestamp},o=n.get(e.remoteId);o&&(i.jitter=o.jitter,i.packetsLost=o.packetsLost,i.roundTripTime=o.roundTripTime),t.push(i)}})),t.sort(((e,t)=>{var n,r;return(null!==(n=t.frameWidth)&&void 0!==n?n:0)-(null!==(r=e.frameWidth)&&void 0!==r?r:0)})),t}))}setPublishingQuality(e){const t=[];for(let n=Hs.LOW;n<=Hs.HIGH;n+=1)t.push(new fL({quality:n,enabled:n<=e}));this.log.debug("setting publishing quality. max quality ".concat(e),this.logContext),this.setPublishingLayers(t)}restartTrack(e){return J(this,void 0,void 0,(function*(){var t,n,r,i,o;let s;if(e){const t=gL({video:e});"boolean"!=typeof t.video&&(s=t.video)}yield this.restart(s);try{for(var a,l=!0,c=jc(this.simulcastCodecs.values());!(t=(a=yield c.next()).done);l=!0){i=a.value,l=!1;const e=i;e.sender&&"closed"!==(null===(o=e.sender.transport)||void 0===o?void 0:o.state)&&(e.mediaStreamTrack=this.mediaStreamTrack.clone(),yield e.sender.replaceTrack(e.mediaStreamTrack))}}catch(e){n={error:e}}finally{try{!l&&!t&&(r=c.return)&&(yield r.call(c))}finally{if(n)throw n.error}}}))}setProcessor(e){const t=Object.create(null,{setProcessor:{get:()=>super.setProcessor}});return J(this,arguments,void 0,(function(e){var n=this;let r=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return function*(){var i,o,s,a,l,c;if(yield t.setProcessor.call(n,e,r),null!==(l=n.processor)&&void 0!==l&&l.processedTrack)try{for(var u,d=!0,h=jc(n.simulcastCodecs.values());!(i=(u=yield h.next()).done);d=!0)a=u.value,d=!1,yield null===(c=a.sender)||void 0===c?void 0:c.replaceTrack(n.processor.processedTrack)}catch(e){o={error:e}}finally{try{!d&&!i&&(s=h.return)&&(yield s.call(h))}finally{if(o)throw o.error}}}()}))}setDegradationPreference(e){return J(this,void 0,void 0,(function*(){if(this.degradationPreference=e,this.sender)try{this.log.debug("setting degradationPreference to ".concat(e),this.logContext);const t=this.sender.getParameters();t.degradationPreference=e,this.sender.setParameters(t)}catch(e){this.log.warn("failed to set degradationPreference",Object.assign({error:e},this.logContext))}}))}addSimulcastTrack(e,t){if(this.simulcastCodecs.has(e))return void this.log.error("".concat(e," already added, skipping adding simulcast codec"),this.logContext);const n={codec:e,mediaStreamTrack:this.mediaStreamTrack.clone(),sender:void 0,encodings:t};return this.simulcastCodecs.set(e,n),n}setSimulcastTrackSender(e,t){const n=this.simulcastCodecs.get(e);n&&(n.sender=t,setTimeout((()=>{this.subscribedCodecs&&this.setPublishingCodecs(this.subscribedCodecs)}),wde))}setPublishingCodecs(e){return J(this,void 0,void 0,(function*(){var t,n,r,i,o,s,a;if(this.log.debug("setting publishing codecs",Object.assign(Object.assign({},this.logContext),{codecs:e,currentCodec:this.codec})),!this.codec&&e.length>0)return yield this.setPublishingLayers(e[0].qualities),[];this.subscribedCodecs=e;const l=[];try{for(t=!0,n=jc(e);!(i=(r=yield n.next()).done);t=!0){a=r.value,t=!1;const e=a;if(this.codec&&this.codec!==e.codec){const t=this.simulcastCodecs.get(e.codec);if(this.log.debug("try setPublishingCodec for ".concat(e.codec),Object.assign(Object.assign({},this.logContext),{simulcastCodecInfo:t})),t&&t.sender)t.encodings&&(this.log.debug("try setPublishingLayersForSender ".concat(e.codec),this.logContext),yield q8(t.sender,t.encodings,e.qualities,this.senderLock,this.log,this.logContext));else for(const t of e.qualities)if(t.enabled){l.push(e.codec);break}}else yield this.setPublishingLayers(e.qualities)}}catch(e){o={error:e}}finally{try{!t&&!i&&(s=n.return)&&(yield s.call(n))}finally{if(o)throw o.error}}return l}))}setPublishingLayers(e){return J(this,void 0,void 0,(function*(){this.log.debug("setting publishing layers",Object.assign(Object.assign({},this.logContext),{qualities:e})),this.sender&&this.encodings&&(yield q8(this.sender,this.encodings,e,this.senderLock,this.log,this.logContext))}))}handleAppVisibilityChanged(){const e=Object.create(null,{handleAppVisibilityChanged:{get:()=>super.handleAppVisibilityChanged}});return J(this,void 0,void 0,(function*(){yield e.handleAppVisibilityChanged.call(this),UV()&&this.isInBackground&&this.source===ue.Source.Camera&&(this._mediaStreamTrack.enabled=!1)}))}}function q8(e,t,n,r,i,o){return J(this,void 0,void 0,(function*(){const s=yield r.lock();i.debug("setPublishingLayersForSender",Object.assign(Object.assign({},o),{sender:e,qualities:n,senderEncodings:t}));try{const r=e.getParameters(),{encodings:s}=r;if(!s)return;if(s.length!==t.length)return void i.warn("cannot set publishing layers, encodings mismatch",Object.assign(Object.assign({},o),{encodings:s,senderEncodings:t}));let a=!1;const l=Ho();if("Chrome"===(null==l?void 0:l.name)&&Nd(null==l?void 0:l.version,"133")>0&&s[0].scalabilityMode){const e=s[0],r=new hS(e.scalabilityMode);let i=Uh.OFF;if(n.forEach((e=>{e.enabled&&(i===Uh.OFF||e.quality>i)&&(i=e.quality)})),i===Uh.OFF)e.active&&(e.active=!1,a=!0);else if(!e.active||r.spatial!==i+1){a=!0,e.active=!0;const n=new hS(t[0].scalabilityMode);r.spatial=i+1,r.suffix=n.suffix,1===r.spatial&&(r.suffix=void 0),e.scalabilityMode=r.toString(),e.scaleResolutionDownBy=Math.pow(2,2-i),t[0].maxBitrate&&(e.maxBitrate=t[0].maxBitrate/(e.scaleResolutionDownBy*e.scaleResolutionDownBy))}}else s.forEach(((e,r)=>{var s;let l=null!==(s=e.rid)&&void 0!==s?s:"";""===l&&(l="q");const c=JV(l),u=n.find((e=>e.quality===c));u&&e.active!==u.enabled&&(a=!0,e.active=u.enabled,i.debug("setting layer ".concat(u.quality," to ").concat(e.active?"enabled":"disabled"),o),fp()&&(u.enabled?(e.scaleResolutionDownBy=t[r].scaleResolutionDownBy,e.maxBitrate=t[r].maxBitrate,e.maxFrameRate=t[r].maxFrameRate):(e.scaleResolutionDownBy=4,e.maxBitrate=10,e.maxFrameRate=2)))}));a&&(r.encodings=s,i.debug("setting encodings",Object.assign(Object.assign({},o),{encodings:r.encodings})),yield e.setParameters(r))}finally{s()}}))}function JV(e){switch(e){case"f":default:return Hs.HIGH;case"h":return Hs.MEDIUM;case"q":return Hs.LOW}}function K8(e,t,n,r){if(!n)return[new wd({quality:Hs.HIGH,width:e,height:t,bitrate:0,ssrc:0})];if(r){const r=n[0].scalabilityMode,i=new hS(r),o=[],s="h"==i.suffix?1.5:2,a="h"==i.suffix?2:3;for(let r=0;r<i.spatial;r+=1)o.push(new wd({quality:Math.min(Hs.HIGH,i.spatial-1)-r,width:Math.ceil(e/Math.pow(s,r)),height:Math.ceil(t/Math.pow(s,r)),bitrate:n[0].maxBitrate?Math.ceil(n[0].maxBitrate/Math.pow(a,r)):0,ssrc:0}));return o}return n.map((n=>{var r,i,o;const s=null!==(r=n.scaleResolutionDownBy)&&void 0!==r?r:1;let a=JV(null!==(i=n.rid)&&void 0!==i?i:"");return new wd({quality:a,width:Math.ceil(e/s),height:Math.ceil(t/s),bitrate:null!==(o=n.maxBitrate)&&void 0!==o?o:0,ssrc:0})}))}const G8="_lossy",W8="_reliable",Cde=2e3,A2="leave-reconnect";var bo;!function(e){e[e.New=0]="New",e[e.Connected=1]="Connected",e[e.Disconnected=2]="Disconnected",e[e.Reconnecting=3]="Reconnecting",e[e.Closed=4]="Closed"}(bo||(bo={}));class Tde extends Oa.EventEmitter{get isClosed(){return this._isClosed}get pendingReconnect(){return!!this.reconnectTimeout}constructor(e){var t;super(),this.options=e,this.rtcConfig={},this.peerConnectionTimeout=bL.peerConnectionTimeout,this.fullReconnectOnNext=!1,this.subscriberPrimary=!1,this.pcState=bo.New,this._isClosed=!0,this.pendingTrackResolvers={},this.reconnectAttempts=0,this.reconnectStart=0,this.attemptingReconnect=!1,this.joinAttempts=0,this.maxJoinAttempts=1,this.shouldFailNext=!1,this.log=bt,this.handleDataChannel=e=>J(this,[e],void 0,(function(e){var t=this;let{channel:n}=e;return function*(){if(n){if(n.label===W8)t.reliableDCSub=n;else{if(n.label!==G8)return;t.lossyDCSub=n}t.log.debug("on data channel ".concat(n.id,", ").concat(n.label),t.logContext),n.onmessage=t.handleDataMessage}}()})),this.handleDataMessage=e=>J(this,void 0,void 0,(function*(){var t,n;const r=yield this.dataProcessLock.lock();try{let r;if(e.data instanceof ArrayBuffer)r=e.data;else{if(!(e.data instanceof Blob))return void this.log.error("unsupported data type",Object.assign(Object.assign({},this.logContext),{data:e.data}));r=yield e.data.arrayBuffer()}const i=Fi.fromBinary(new Uint8Array(r));"speaker"===(null===(t=i.value)||void 0===t?void 0:t.case)?this.emit(Pe.ActiveSpeakersUpdate,i.value.value.speakers):("user"===(null===(n=i.value)||void 0===n?void 0:n.case)&&Ide(i,i.value.value),this.emit(Pe.DataPacketReceived,i))}finally{r()}})),this.handleDataError=e=>{const t=0===e.currentTarget.maxRetransmits?"lossy":"reliable";if(e instanceof ErrorEvent&&e.error){const{error:n}=e.error;this.log.error("DataChannel error on ".concat(t,": ").concat(e.message),Object.assign(Object.assign({},this.logContext),{error:n}))}else this.log.error("Unknown DataChannel error on ".concat(t),Object.assign(Object.assign({},this.logContext),{event:e}))},this.handleBufferedAmountLow=e=>{const t=0===e.currentTarget.maxRetransmits?Ot.LOSSY:Ot.RELIABLE;this.updateAndEmitDCBufferStatus(t)},this.handleDisconnect=(e,t)=>{if(this._isClosed)return;this.log.warn("".concat(e," disconnected"),this.logContext),0===this.reconnectAttempts&&(this.reconnectStart=Date.now());const n=e=>{this.log.warn("could not recover connection after ".concat(this.reconnectAttempts," attempts, ").concat(e,"ms. giving up"),this.logContext),this.emit(Pe.Disconnected),this.close()},r=Date.now()-this.reconnectStart;let i=this.getNextRetryDelay({elapsedMs:r,retryCount:this.reconnectAttempts});null!==i?(e===A2&&(i=0),this.log.debug("reconnecting in ".concat(i,"ms"),this.logContext),this.clearReconnectTimeout(),this.token&&this.regionUrlProvider&&this.regionUrlProvider.updateToken(this.token),this.reconnectTimeout=zr.setTimeout((()=>this.attemptReconnect(t).finally((()=>this.reconnectTimeout=void 0))),i)):n(r)},this.waitForRestarted=()=>new Promise(((e,t)=>{this.pcState===bo.Connected&&e();const n=()=>{this.off(Pe.Disconnected,r),e()},r=()=>{this.off(Pe.Restarted,n),t()};this.once(Pe.Restarted,n),this.once(Pe.Disconnected,r)})),this.updateAndEmitDCBufferStatus=e=>{const t=this.isBufferStatusLow(e);typeof t<"u"&&t!==this.dcBufferStatus.get(e)&&(this.dcBufferStatus.set(e,t),this.emit(Pe.DCBufferStatusChanged,t,e))},this.isBufferStatusLow=e=>{const t=this.dataChannelForKind(e);if(t)return t.bufferedAmount<=t.bufferedAmountLowThreshold},this.handleBrowserOnLine=()=>{this.client.currentState===gn.RECONNECTING&&(this.clearReconnectTimeout(),this.attemptReconnect(Wf.RR_SIGNAL_DISCONNECTED))},this.log=Ol(null!==(t=e.loggerName)&&void 0!==t?t:$o.Engine),this.loggerOptions={loggerName:e.loggerName,loggerContextCb:()=>this.logContext},this.client=new vL(void 0,this.loggerOptions),this.client.signalLatency=this.options.expSignalLatency,this.reconnectPolicy=this.options.reconnectPolicy,this.registerOnLineListener(),this.closingLock=new Ei,this.dataProcessLock=new Ei,this.dcBufferStatus=new Map([[Ot.LOSSY,!0],[Ot.RELIABLE,!0]]),this.client.onParticipantUpdate=e=>this.emit(Pe.ParticipantUpdate,e),this.client.onConnectionQuality=e=>this.emit(Pe.ConnectionQualityUpdate,e),this.client.onRoomUpdate=e=>this.emit(Pe.RoomUpdate,e),this.client.onSubscriptionError=e=>this.emit(Pe.SubscriptionError,e),this.client.onSubscriptionPermissionUpdate=e=>this.emit(Pe.SubscriptionPermissionUpdate,e),this.client.onSpeakersChanged=e=>this.emit(Pe.SpeakersChanged,e),this.client.onStreamStateUpdate=e=>this.emit(Pe.StreamStateChanged,e),this.client.onRequestResponse=e=>this.emit(Pe.SignalRequestResponse,e)}get logContext(){var e,t,n,r,i,o,s,a;return{room:null===(t=null===(e=this.latestJoinResponse)||void 0===e?void 0:e.room)||void 0===t?void 0:t.name,roomID:null===(r=null===(n=this.latestJoinResponse)||void 0===n?void 0:n.room)||void 0===r?void 0:r.sid,participant:null===(o=null===(i=this.latestJoinResponse)||void 0===i?void 0:i.participant)||void 0===o?void 0:o.identity,pID:null===(a=null===(s=this.latestJoinResponse)||void 0===s?void 0:s.participant)||void 0===a?void 0:a.sid}}join(e,t,n,r){return J(this,void 0,void 0,(function*(){this.url=e,this.token=t,this.signalOpts=n,this.maxJoinAttempts=n.maxRetries;try{this.joinAttempts+=1,this.setupSignalClientCallbacks();const i=yield this.client.join(e,t,n,r);return this._isClosed=!1,this.latestJoinResponse=i,this.subscriberPrimary=i.subscriberPrimary,this.pcManager||(yield this.configure(i)),(!this.subscriberPrimary||i.fastPublish)&&this.negotiate(),this.clientConfiguration=i.clientConfiguration,setTimeout((()=>{this.emit(Pe.SignalConnected)}),10),i}catch(i){if(i instanceof en&&i.reason===kt.ServerUnreachable&&(this.log.warn("Couldn't connect to server, attempt ".concat(this.joinAttempts," of ").concat(this.maxJoinAttempts),this.logContext),this.joinAttempts<this.maxJoinAttempts))return this.join(e,t,n,r);throw i}}))}close(){return J(this,void 0,void 0,(function*(){const e=yield this.closingLock.lock();if(this.isClosed)e();else try{this._isClosed=!0,this.joinAttempts=0,this.emit(Pe.Closing),this.removeAllListeners(),this.deregisterOnLineListener(),this.clearPendingReconnect(),yield this.cleanupPeerConnections(),yield this.cleanupClient()}finally{e()}}))}cleanupPeerConnections(){return J(this,void 0,void 0,(function*(){var e;yield null===(e=this.pcManager)||void 0===e?void 0:e.close(),this.pcManager=void 0;const t=e=>{e&&(e.close(),e.onbufferedamountlow=null,e.onclose=null,e.onclosing=null,e.onerror=null,e.onmessage=null,e.onopen=null)};t(this.lossyDC),t(this.lossyDCSub),t(this.reliableDC),t(this.reliableDCSub),this.lossyDC=void 0,this.lossyDCSub=void 0,this.reliableDC=void 0,this.reliableDCSub=void 0}))}cleanupClient(){return J(this,void 0,void 0,(function*(){yield this.client.close(),this.client.resetCallbacks()}))}addTrack(e){if(this.pendingTrackResolvers[e.cid])throw new ml("a track with the same ID has already been published");return new Promise(((t,n)=>{const r=setTimeout((()=>{delete this.pendingTrackResolvers[e.cid],n(new en("publication of local track timed out, no response from server",kt.InternalError))}),1e4);this.pendingTrackResolvers[e.cid]={resolve:e=>{clearTimeout(r),t(e)},reject:()=>{clearTimeout(r),n(new Error("Cancelled publication by calling unpublish"))}},this.client.sendAddTrack(e)}))}removeTrack(e){if(e.track&&this.pendingTrackResolvers[e.track.id]){const{reject:t}=this.pendingTrackResolvers[e.track.id];t&&t(),delete this.pendingTrackResolvers[e.track.id]}try{return this.pcManager.removeTrack(e),!0}catch(e){this.log.warn("failed to remove track",Object.assign(Object.assign({},this.logContext),{error:e}))}return!1}updateMuteStatus(e,t){this.client.sendMuteTrack(e,t)}get dataSubscriberReadyState(){var e;return null===(e=this.reliableDCSub)||void 0===e?void 0:e.readyState}getConnectedServerAddress(){return J(this,void 0,void 0,(function*(){var e;return null===(e=this.pcManager)||void 0===e?void 0:e.getConnectedAddress()}))}setRegionUrlProvider(e){this.regionUrlProvider=e}configure(e){return J(this,void 0,void 0,(function*(){var t,n;if(this.pcManager&&this.pcManager.currentState!==Hn.NEW)return;this.participantSid=null===(t=e.participant)||void 0===t?void 0:t.sid;const r=this.makeRTCConfiguration(e);this.pcManager=new ude(r,e.subscriberPrimary,this.loggerOptions),this.emit(Pe.TransportsCreated,this.pcManager.publisher,this.pcManager.subscriber),this.pcManager.onIceCandidate=(e,t)=>{this.client.sendIceCandidate(e,t)},this.pcManager.onPublisherOffer=e=>{this.client.sendOffer(e)},this.pcManager.onDataChannel=this.handleDataChannel,this.pcManager.onStateChange=(t,n,r)=>J(this,void 0,void 0,(function*(){if(this.log.debug("primary PC state changed ".concat(t),this.logContext),["closed","disconnected","failed"].includes(n)&&(this.publisherConnectionPromise=void 0),t===Hn.CONNECTED){const t=this.pcState===bo.New;this.pcState=bo.Connected,t&&this.emit(Pe.Connected,e)}else t===Hn.FAILED&&this.pcState===bo.Connected&&(this.pcState=bo.Disconnected,this.handleDisconnect("peerconnection failed","failed"===r?Wf.RR_SUBSCRIBER_FAILED:Wf.RR_PUBLISHER_FAILED));const i=this.client.isDisconnected||this.client.currentState===gn.RECONNECTING,o=[Hn.FAILED,Hn.CLOSING,Hn.CLOSED].includes(t);i&&o&&!this._isClosed&&this.emit(Pe.Offline)})),this.pcManager.onTrack=e=>{this.emit(Pe.MediaTrackAdded,e.track,e.streams[0],e.receiver)},Rde(null===(n=e.serverInfo)||void 0===n?void 0:n.protocol)||this.createDataChannels()}))}setupSignalClientCallbacks(){this.client.onAnswer=e=>J(this,void 0,void 0,(function*(){this.pcManager&&(this.log.debug("received server answer",Object.assign(Object.assign({},this.logContext),{RTCSdpType:e.type})),yield this.pcManager.setPublisherAnswer(e))})),this.client.onTrickle=(e,t)=>{this.pcManager&&(this.log.debug("got ICE candidate from peer",Object.assign(Object.assign({},this.logContext),{candidate:e,target:t})),this.pcManager.addIceCandidate(e,t))},this.client.onOffer=e=>J(this,void 0,void 0,(function*(){if(!this.pcManager)return;const t=yield this.pcManager.createSubscriberAnswerFromOffer(e);this.client.sendAnswer(t)})),this.client.onLocalTrackPublished=e=>{var t;if(this.log.debug("received trackPublishedResponse",Object.assign(Object.assign({},this.logContext),{cid:e.cid,track:null===(t=e.track)||void 0===t?void 0:t.sid})),!this.pendingTrackResolvers[e.cid])return void this.log.error("missing track resolver for ".concat(e.cid),Object.assign(Object.assign({},this.logContext),{cid:e.cid}));const{resolve:n}=this.pendingTrackResolvers[e.cid];delete this.pendingTrackResolvers[e.cid],n(e.track)},this.client.onLocalTrackUnpublished=e=>{this.emit(Pe.LocalTrackUnpublished,e)},this.client.onLocalTrackSubscribed=e=>{this.emit(Pe.LocalTrackSubscribed,e)},this.client.onTokenRefresh=e=>{this.token=e},this.client.onRemoteMuteChanged=(e,t)=>{this.emit(Pe.RemoteMute,e,t)},this.client.onSubscribedQualityUpdate=e=>{this.emit(Pe.SubscribedQualityUpdate,e)},this.client.onClose=()=>{this.handleDisconnect("signal",Wf.RR_SIGNAL_DISCONNECTED)},this.client.onLeave=e=>{switch(this.log.debug("client leave request",Object.assign(Object.assign({},this.logContext),{reason:null==e?void 0:e.reason})),e.regions&&this.regionUrlProvider&&(this.log.debug("updating regions",this.logContext),this.regionUrlProvider.setServerReportedRegions(e.regions)),e.action){case Fh.DISCONNECT:this.emit(Pe.Disconnected,null==e?void 0:e.reason),this.close();break;case Fh.RECONNECT:this.fullReconnectOnNext=!0,this.handleDisconnect(A2);break;case Fh.RESUME:this.handleDisconnect(A2)}}}makeRTCConfiguration(e){var t;const n=Object.assign({},this.rtcConfig);if(!(null===(t=this.signalOpts)||void 0===t)&&t.e2eeEnabled&&(this.log.debug("E2EE - setting up transports with insertable streams",this.logContext),n.encodedInsertableStreams=!0),e.iceServers&&!n.iceServers){const t=[];e.iceServers.forEach((e=>{const n={urls:e.urls};e.username&&(n.username=e.username),e.credential&&(n.credential=e.credential),t.push(n)})),n.iceServers=t}return e.clientConfiguration&&e.clientConfiguration.forceRelay===Mv.ENABLED&&(n.iceTransportPolicy="relay"),n.sdpSemantics="unified-plan",n.continualGatheringPolicy="gather_continually",n}createDataChannels(){this.pcManager&&(this.lossyDC&&(this.lossyDC.onmessage=null,this.lossyDC.onerror=null),this.reliableDC&&(this.reliableDC.onmessage=null,this.reliableDC.onerror=null),this.lossyDC=this.pcManager.createPublisherDataChannel(G8,{ordered:!0,maxRetransmits:0}),this.reliableDC=this.pcManager.createPublisherDataChannel(W8,{ordered:!0}),this.lossyDC.onmessage=this.handleDataMessage,this.reliableDC.onmessage=this.handleDataMessage,this.lossyDC.onerror=this.handleDataError,this.reliableDC.onerror=this.handleDataError,this.lossyDC.bufferedAmountLowThreshold=65535,this.reliableDC.bufferedAmountLowThreshold=65535,this.lossyDC.onbufferedamountlow=this.handleBufferedAmountLow,this.reliableDC.onbufferedamountlow=this.handleBufferedAmountLow)}createSender(e,t,n){return J(this,void 0,void 0,(function*(){if(o3())return yield this.createTransceiverRTCRtpSender(e,t,n);if(a3())return this.log.warn("using add-track fallback",this.logContext),yield this.createRTCRtpSender(e.mediaStreamTrack);throw new hr("Required webRTC APIs not supported on this device")}))}createSimulcastSender(e,t,n,r){return J(this,void 0,void 0,(function*(){if(o3())return this.createSimulcastTransceiverSender(e,t,n,r);if(a3())return this.log.debug("using add-track fallback",this.logContext),this.createRTCRtpSender(e.mediaStreamTrack);throw new hr("Cannot stream on this device")}))}createTransceiverRTCRtpSender(e,t,n){return J(this,void 0,void 0,(function*(){if(!this.pcManager)throw new hr("publisher is closed");const r=[];e.mediaStream&&r.push(e.mediaStream),Ap(e)&&(e.codec=t.videoCodec);const i={direction:"sendonly",streams:r};return n&&(i.sendEncodings=n),(yield this.pcManager.addPublisherTransceiver(e.mediaStreamTrack,i)).sender}))}createSimulcastTransceiverSender(e,t,n,r){return J(this,void 0,void 0,(function*(){if(!this.pcManager)throw new hr("publisher is closed");const i={direction:"sendonly"};r&&(i.sendEncodings=r);const o=yield this.pcManager.addPublisherTransceiver(t.mediaStreamTrack,i);if(n.videoCodec)return e.setSimulcastTrackSender(n.videoCodec,o.sender),o.sender}))}createRTCRtpSender(e){return J(this,void 0,void 0,(function*(){if(!this.pcManager)throw new hr("publisher is closed");return this.pcManager.addPublisherTrack(e)}))}attemptReconnect(e){return J(this,void 0,void 0,(function*(){var t,n,r;if(!this._isClosed){if(this.attemptingReconnect)return void bt.warn("already attempting reconnect, returning early",this.logContext);((null===(t=this.clientConfiguration)||void 0===t?void 0:t.resumeConnection)===Mv.DISABLED||(null!==(r=null===(n=this.pcManager)||void 0===n?void 0:n.currentState)&&void 0!==r?r:Hn.NEW)===Hn.NEW)&&(this.fullReconnectOnNext=!0);try{this.attemptingReconnect=!0,this.fullReconnectOnNext?yield this.restartConnection():yield this.resumeConnection(e),this.clearPendingReconnect(),this.fullReconnectOnNext=!1}catch(e){this.reconnectAttempts+=1;let t=!0;e instanceof hr?(this.log.debug("received unrecoverable error",Object.assign(Object.assign({},this.logContext),{error:e})),t=!1):e instanceof zf||(this.fullReconnectOnNext=!0),t?this.handleDisconnect("reconnect",Wf.RR_UNKNOWN):(this.log.info("could not recover connection after ".concat(this.reconnectAttempts," attempts, ").concat(Date.now()-this.reconnectStart,"ms. giving up"),this.logContext),this.emit(Pe.Disconnected),yield this.close())}finally{this.attemptingReconnect=!1}}}))}getNextRetryDelay(e){try{return this.reconnectPolicy.nextRetryDelayInMs(e)}catch(e){this.log.warn("encountered error in reconnect policy",Object.assign(Object.assign({},this.logContext),{error:e}))}return null}restartConnection(e){return J(this,void 0,void 0,(function*(){var t,n,r;try{if(!this.url||!this.token)throw new hr("could not reconnect, url or token not saved");let n;this.log.info("reconnecting, attempt: ".concat(this.reconnectAttempts),this.logContext),this.emit(Pe.Restarting),this.client.isDisconnected||(yield this.client.sendLeave()),yield this.cleanupPeerConnections(),yield this.cleanupClient();try{if(!this.signalOpts)throw this.log.warn("attempted connection restart, without signal options present",this.logContext),new zf;n=yield this.join(e??this.url,this.token,this.signalOpts)}catch(e){throw e instanceof en&&e.reason===kt.NotAllowed?new hr("could not reconnect, token might be expired"):new zf}if(this.shouldFailNext)throw this.shouldFailNext=!1,new Error("simulated failure");if(this.client.setReconnected(),this.emit(Pe.SignalRestarted,n),yield this.waitForPCReconnected(),this.client.currentState!==gn.CONNECTED)throw new zf("Signal connection got severed during reconnect");null===(t=this.regionUrlProvider)||void 0===t||t.resetAttempts(),this.emit(Pe.Restarted)}catch(e){const t=yield null===(n=this.regionUrlProvider)||void 0===n?void 0:n.getNextBestRegionUrl();if(t)return void(yield this.restartConnection(t));throw null===(r=this.regionUrlProvider)||void 0===r||r.resetAttempts(),e}}))}resumeConnection(e){return J(this,void 0,void 0,(function*(){var t;if(!this.url||!this.token)throw new hr("could not reconnect, url or token not saved");if(!this.pcManager)throw new hr("publisher and subscriber connections unset");let n;this.log.info("resuming signal connection, attempt ".concat(this.reconnectAttempts),this.logContext),this.emit(Pe.Resuming);try{this.setupSignalClientCallbacks(),n=yield this.client.reconnect(this.url,this.token,this.participantSid,e)}catch(e){let t="";throw e instanceof Error&&(t=e.message,this.log.error(e.message,Object.assign(Object.assign({},this.logContext),{error:e}))),e instanceof en&&e.reason===kt.NotAllowed?new hr("could not reconnect, token might be expired"):e instanceof en&&e.reason===kt.LeaveRequest?e:new zf(t)}if(this.emit(Pe.SignalResumed),n){const e=this.makeRTCConfiguration(n);this.pcManager.updateConfiguration(e)}else this.log.warn("Did not receive reconnect response",this.logContext);if(this.shouldFailNext)throw this.shouldFailNext=!1,new Error("simulated failure");if(yield this.pcManager.triggerIceRestart(),yield this.waitForPCReconnected(),this.client.currentState!==gn.CONNECTED)throw new zf("Signal connection got severed during reconnect");this.client.setReconnected(),"open"===(null===(t=this.reliableDC)||void 0===t?void 0:t.readyState)&&null===this.reliableDC.id&&this.createDataChannels(),this.emit(Pe.Resumed)}))}waitForPCInitialConnection(e,t){return J(this,void 0,void 0,(function*(){if(!this.pcManager)throw new hr("PC manager is closed");yield this.pcManager.ensurePCTransportConnection(t,e)}))}waitForPCReconnected(){return J(this,void 0,void 0,(function*(){this.pcState=bo.Reconnecting,this.log.debug("waiting for peer connection to reconnect",this.logContext);try{if(yield Ji(Cde),!this.pcManager)throw new hr("PC manager is closed");yield this.pcManager.ensurePCTransportConnection(void 0,this.peerConnectionTimeout),this.pcState=bo.Connected}catch(e){throw this.pcState=bo.Disconnected,new en("could not establish PC connection, ".concat(e.message),kt.InternalError)}}))}publishRpcResponse(e,t,n,r){return J(this,void 0,void 0,(function*(){const i=new Fi({destinationIdentities:[e],kind:Ot.RELIABLE,value:{case:"rpcResponse",value:new NB({requestId:t,value:r?{case:"error",value:r.toProto()}:{case:"payload",value:n??""}})}});yield this.sendDataPacket(i,Ot.RELIABLE)}))}publishRpcAck(e,t){return J(this,void 0,void 0,(function*(){const n=new Fi({destinationIdentities:[e],kind:Ot.RELIABLE,value:{case:"rpcAck",value:new AB({requestId:t})}});yield this.sendDataPacket(n,Ot.RELIABLE)}))}sendDataPacket(e,t){return J(this,void 0,void 0,(function*(){const n=e.toBinary();yield this.ensurePublisherConnected(t);const r=this.dataChannelForKind(t);r&&r.send(n),this.updateAndEmitDCBufferStatus(t)}))}waitForBufferStatusLow(e){return new Promise(((t,n)=>J(this,void 0,void 0,(function*(){if(this.isBufferStatusLow(e))t();else{const r=()=>n("Engine closed");for(this.once(Pe.Closing,r);!this.dcBufferStatus.get(e);)yield Ji(10);this.off(Pe.Closing,r),t()}}))))}ensureDataTransportConnected(e){return J(this,arguments,void 0,(function(e){var t=this;let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.subscriberPrimary;return function*(){var r;if(!t.pcManager)throw new hr("PC manager is closed");const i=n?t.pcManager.subscriber:t.pcManager.publisher,o=n?"Subscriber":"Publisher";if(!i)throw new en("".concat(o," connection not set"),kt.InternalError);let s=!1;!n&&!t.dataChannelForKind(e,n)&&(t.createDataChannels(),s=!0),!s&&!n&&!t.pcManager.publisher.isICEConnected&&"checking"!==t.pcManager.publisher.getICEConnectionState()&&(s=!0),s&&t.negotiate();const a=t.dataChannelForKind(e,n);if("open"===(null==a?void 0:a.readyState))return;const l=(new Date).getTime()+t.peerConnectionTimeout;for(;(new Date).getTime()<l;){if(i.isICEConnected&&"open"===(null===(r=t.dataChannelForKind(e,n))||void 0===r?void 0:r.readyState))return;yield Ji(50)}throw new en("could not establish ".concat(o," connection, state: ").concat(i.getICEConnectionState()),kt.InternalError)}()}))}ensurePublisherConnected(e){return J(this,void 0,void 0,(function*(){this.publisherConnectionPromise||(this.publisherConnectionPromise=this.ensureDataTransportConnected(e,!1)),yield this.publisherConnectionPromise}))}verifyTransport(){return!(!this.pcManager||this.pcManager.currentState!==Hn.CONNECTED||!this.client.ws||this.client.ws.readyState===WebSocket.CLOSED)}negotiate(){return J(this,void 0,void 0,(function*(){return new Promise(((e,t)=>J(this,void 0,void 0,(function*(){if(!this.pcManager)return void t(new i3("PC manager is closed"));this.pcManager.requirePublisher(),0==this.pcManager.publisher.getTransceivers().length&&!this.lossyDC&&!this.reliableDC&&this.createDataChannels();const n=new AbortController,r=()=>{n.abort(),this.log.debug("engine disconnected while negotiation was ongoing",this.logContext),e()};this.isClosed&&t("cannot negotiate on closed engine"),this.on(Pe.Closing,r),this.pcManager.publisher.once(Bh.RTPVideoPayloadTypes,(e=>{const t=new Map;e.forEach((e=>{const n=e.codec.toLowerCase();Due(n)&&t.set(e.payload,n)})),this.emit(Pe.RTPVideoMapUpdate,t)}));try{yield this.pcManager.negotiate(n),e()}catch(e){e instanceof i3&&(this.fullReconnectOnNext=!0),this.handleDisconnect("negotiation",Wf.RR_UNKNOWN),t(e)}finally{this.off(Pe.Closing,r)}}))))}))}dataChannelForKind(e,t){if(t){if(e===Ot.LOSSY)return this.lossyDCSub;if(e===Ot.RELIABLE)return this.reliableDCSub}else{if(e===Ot.LOSSY)return this.lossyDC;if(e===Ot.RELIABLE)return this.reliableDC}}sendSyncState(e,t){var n,r;if(!this.pcManager)return void this.log.warn("sync state cannot be sent without peer connection setup",this.logContext);const i=this.pcManager.subscriber.getLocalDescription(),o=this.pcManager.subscriber.getRemoteDescription(),s=null===(r=null===(n=this.signalOpts)||void 0===n?void 0:n.autoSubscribe)||void 0===r||r,a=new Array,l=new Array;e.forEach((e=>{e.isDesired!==s&&a.push(e.trackSid),e.isEnabled||l.push(e.trackSid)})),this.client.sendSyncState(new XB({answer:i?dS({sdp:i.sdp,type:i.type}):void 0,offer:o?dS({sdp:o.sdp,type:o.type}):void 0,subscription:new HE({trackSids:a,subscribe:!s,participantTracks:[]}),publishTracks:que(t),dataChannels:this.dataChannelsInfo(),trackSidsDisabled:l}))}failNext(){this.shouldFailNext=!0}dataChannelsInfo(){const e=[],t=(t,n)=>{void 0!==(null==t?void 0:t.id)&&null!==t.id&&e.push(new ZB({label:t.label,id:t.id,target:n}))};return t(this.dataChannelForKind(Ot.LOSSY),Oo.PUBLISHER),t(this.dataChannelForKind(Ot.RELIABLE),Oo.PUBLISHER),t(this.dataChannelForKind(Ot.LOSSY,!0),Oo.SUBSCRIBER),t(this.dataChannelForKind(Ot.RELIABLE,!0),Oo.SUBSCRIBER),e}clearReconnectTimeout(){this.reconnectTimeout&&zr.clearTimeout(this.reconnectTimeout)}clearPendingReconnect(){this.clearReconnectTimeout(),this.reconnectAttempts=0}registerOnLineListener(){Wi()&&window.addEventListener("online",this.handleBrowserOnLine)}deregisterOnLineListener(){Wi()&&window.removeEventListener("online",this.handleBrowserOnLine)}}class zf extends Error{}function Rde(e){return void 0!==e&&e>13}function Ide(e,t){const n=e.participantIdentity?e.participantIdentity:t.participantIdentity;e.participantIdentity=n,t.participantIdentity=n;const r=0!==e.destinationIdentities.length?e.destinationIdentities:t.destinationIdentities;e.destinationIdentities=r,t.destinationIdentities=r}class g3{constructor(e,t){this.lastUpdateAt=0,this.settingsCacheTime=3e3,this.attemptedRegions=[],this.serverUrl=new URL(e),this.token=t}updateToken(e){this.token=e}isCloud(){return c3(this.serverUrl)}getServerUrl(){return this.serverUrl}getNextBestRegionUrl(e){return J(this,void 0,void 0,(function*(){if(!this.isCloud())throw Error("region availability is only supported for LiveKit Cloud domains");(!this.regionSettings||Date.now()-this.lastUpdateAt>this.settingsCacheTime)&&(this.regionSettings=yield this.fetchRegionSettings(e));const t=this.regionSettings.regions.filter((e=>!this.attemptedRegions.find((t=>t.url===e.url))));if(t.length>0){const e=t[0];return this.attemptedRegions.push(e),bt.debug("next region: ".concat(e.region)),e.url}return null}))}resetAttempts(){this.attemptedRegions=[]}fetchRegionSettings(e){return J(this,void 0,void 0,(function*(){const t=yield fetch("".concat(kde(this.serverUrl),"/regions"),{headers:{authorization:"Bearer ".concat(this.token)},signal:e});if(t.ok){const e=yield t.json();return this.lastUpdateAt=Date.now(),e}throw new en("Could not fetch region settings: ".concat(t.statusText),401===t.status?kt.NotAllowed:kt.InternalError,t.status)}))}setServerReportedRegions(e){this.regionSettings=e,this.lastUpdateAt=Date.now()}}function kde(e){return"".concat(e.protocol.replace("ws","http"),"//").concat(e.host,"/settings")}class XV{get info(){return this._info}constructor(e,t,n){this.reader=t,this.totalByteSize=n,this._info=e,this.bytesReceived=0}}class xde extends XV{handleChunkReceived(e){var t;this.bytesReceived+=e.content.byteLength;const n=this.totalByteSize?this.bytesReceived/this.totalByteSize:void 0;null===(t=this.onProgress)||void 0===t||t.call(this,n)}[Symbol.asyncIterator](){const e=this.reader.getReader();return{next:()=>J(this,void 0,void 0,(function*(){try{const{done:t,value:n}=yield e.read();return t?{done:!0,value:void 0}:(this.handleChunkReceived(n),{done:!1,value:n.content})}catch{return{done:!0,value:void 0}}})),return(){return J(this,void 0,void 0,(function*(){return e.releaseLock(),{done:!0,value:void 0}}))}}}readAll(){return J(this,void 0,void 0,(function*(){var e,t,n,r;let i=new Set;try{for(var o,s=!0,a=jc(this);!(e=(o=yield a.next()).done);s=!0){r=o.value,s=!1;const e=r;i.add(e)}}catch(e){t={error:e}}finally{try{!s&&!e&&(n=a.return)&&(yield n.call(a))}finally{if(t)throw t.error}}return Array.from(i)}))}}class Pde extends XV{constructor(e,t,n){super(e,t,n),this.receivedChunks=new Map}handleChunkReceived(e){var t;const n=ib(e.chunkIndex),r=this.receivedChunks.get(n);if(r&&r.version>e.version)return;this.receivedChunks.set(n,e),this.bytesReceived+=e.content.byteLength;const i=this.totalByteSize?this.bytesReceived/this.totalByteSize:void 0;null===(t=this.onProgress)||void 0===t||t.call(this,i)}[Symbol.asyncIterator](){const e=this.reader.getReader(),t=new TextDecoder;return{next:()=>J(this,void 0,void 0,(function*(){try{const{done:n,value:r}=yield e.read();return n?{done:!0,value:void 0}:(this.handleChunkReceived(r),{done:!1,value:t.decode(r.content)})}catch{return{done:!0,value:void 0}}})),return(){return J(this,void 0,void 0,(function*(){return e.releaseLock(),{done:!0,value:void 0}}))}}}readAll(){return J(this,void 0,void 0,(function*(){var e,t,n,r;let i="";try{for(var o,s=!0,a=jc(this);!(e=(o=yield a.next()).done);s=!0)r=o.value,s=!1,i+=r}catch(e){t={error:e}}finally{try{!s&&!e&&(n=a.return)&&(yield n.call(a))}finally{if(t)throw t.error}}return i}))}}class ZV{constructor(e,t,n){this.writableStream=e,this.defaultWriter=e.getWriter(),this.onClose=n,this.info=t}write(e){return this.defaultWriter.write(e)}close(){return J(this,void 0,void 0,(function*(){var e;yield this.defaultWriter.close(),this.defaultWriter.releaseLock(),null===(e=this.onClose)||void 0===e||e.call(this)}))}}class Lde extends ZV{}class Ode extends ZV{}class wL extends ue{constructor(e,t,n,r,i){super(e,n,i),this.sid=t,this.receiver=r}get isLocal(){return!1}setMuted(e){this.isMuted!==e&&(this.isMuted=e,this._mediaStreamTrack.enabled=!e,this.emit(e?Re.Muted:Re.Unmuted,this))}setMediaStream(e){this.mediaStream=e;const t=n=>{n.track===this._mediaStreamTrack&&(e.removeEventListener("removetrack",t),this.receiver&&"playoutDelayHint"in this.receiver&&(this.receiver.playoutDelayHint=void 0),this.receiver=void 0,this._currentBitrate=0,this.emit(Re.Ended,this))};e.addEventListener("removetrack",t)}start(){this.startMonitor(),super.enable()}stop(){this.stopMonitor(),super.disable()}getRTCStatsReport(){return J(this,void 0,void 0,(function*(){var e;return null!==(e=this.receiver)&&void 0!==e&&e.getStats?yield this.receiver.getStats():void 0}))}setPlayoutDelay(e){this.receiver?"playoutDelayHint"in this.receiver?this.receiver.playoutDelayHint=e:this.log.warn("Playout delay not supported in this browser"):this.log.warn("Cannot set playout delay, track already ended")}getPlayoutDelay(){if(this.receiver){if("playoutDelayHint"in this.receiver)return this.receiver.playoutDelayHint;this.log.warn("Playout delay not supported in this browser")}else this.log.warn("Cannot get playout delay, track already ended");return 0}startMonitor(){this.monitorInterval||(this.monitorInterval=setInterval((()=>this.monitorReceiver()),EL)),Kue()&&this.registerTimeSyncUpdate()}registerTimeSyncUpdate(){const e=()=>{var t;this.timeSyncHandle=requestAnimationFrame((()=>e()));const n=null===(t=this.receiver)||void 0===t?void 0:t.getSynchronizationSources()[0];if(n){const{timestamp:e,rtpTimestamp:t}=n;t&&this.rtpTimestamp!==t&&(this.emit(Re.TimeSyncUpdate,{timestamp:e,rtpTimestamp:t}),this.rtpTimestamp=t)}};e()}}class QV extends wL{constructor(e,t,n,r,i,o){super(e,t,ue.Kind.Audio,n,o),this.monitorReceiver=()=>J(this,void 0,void 0,(function*(){if(!this.receiver)return void(this._currentBitrate=0);const e=yield this.getReceiverStats();e&&this.prevStats&&this.receiver&&(this._currentBitrate=qE(e,this.prevStats)),this.prevStats=e})),this.audioContext=r,this.webAudioPluginNodes=[],i&&(this.sinkId=i.deviceId)}setVolume(e){var t;for(const n of this.attachedElements)this.audioContext?null===(t=this.gainNode)||void 0===t||t.gain.setTargetAtTime(e,0,.1):n.volume=e;Ca()&&this._mediaStreamTrack._setVolume(e),this.elementVolume=e}getVolume(){if(this.elementVolume)return this.elementVolume;if(Ca())return 1;let e=0;return this.attachedElements.forEach((t=>{t.volume>e&&(e=t.volume)})),e}setSinkId(e){return J(this,void 0,void 0,(function*(){this.sinkId=e,yield Promise.all(this.attachedElements.map((t=>{if(l3(t))return t.setSinkId(e)})))}))}attach(e){const t=0===this.attachedElements.length;return e?super.attach(e):e=super.attach(),this.sinkId&&l3(e)&&e.setSinkId(this.sinkId),this.audioContext&&t&&(this.log.debug("using audio context mapping",this.logContext),this.connectWebAudio(this.audioContext,e),e.volume=0,e.muted=!0),this.elementVolume&&this.setVolume(this.elementVolume),e}detach(e){let t;return e?(t=super.detach(e),this.audioContext&&(this.attachedElements.length>0?this.connectWebAudio(this.audioContext,this.attachedElements[0]):this.disconnectWebAudio())):(t=super.detach(),this.disconnectWebAudio()),t}setAudioContext(e){this.audioContext=e,e&&this.attachedElements.length>0?this.connectWebAudio(e,this.attachedElements[0]):e||this.disconnectWebAudio()}setWebAudioPlugins(e){this.webAudioPluginNodes=e,this.attachedElements.length>0&&this.audioContext&&this.connectWebAudio(this.audioContext,this.attachedElements[0])}connectWebAudio(e,t){this.disconnectWebAudio(),this.sourceNode=e.createMediaStreamSource(t.srcObject);let n=this.sourceNode;this.webAudioPluginNodes.forEach((e=>{n.connect(e),n=e})),this.gainNode=e.createGain(),n.connect(this.gainNode),this.gainNode.connect(e.destination),this.elementVolume&&this.gainNode.gain.setTargetAtTime(this.elementVolume,0,.1),"running"!==e.state&&e.resume().then((()=>{"running"!==e.state&&this.emit(Re.AudioPlaybackFailed,new Error("Audio Context couldn't be started automatically"))})).catch((e=>{this.emit(Re.AudioPlaybackFailed,e)}))}disconnectWebAudio(){var e,t;null===(e=this.gainNode)||void 0===e||e.disconnect(),null===(t=this.sourceNode)||void 0===t||t.disconnect(),this.gainNode=void 0,this.sourceNode=void 0}getReceiverStats(){return J(this,void 0,void 0,(function*(){if(!this.receiver||!this.receiver.getStats)return;let e;return(yield this.receiver.getStats()).forEach((t=>{"inbound-rtp"===t.type&&(e={type:"audio",streamId:t.id,timestamp:t.timestamp,jitter:t.jitter,bytesReceived:t.bytesReceived,concealedSamples:t.concealedSamples,concealmentEvents:t.concealmentEvents,silentConcealedSamples:t.silentConcealedSamples,silentConcealmentEvents:t.silentConcealmentEvents,totalAudioEnergy:t.totalAudioEnergy,totalSamplesDuration:t.totalSamplesDuration})})),e}))}}const N2=100;class Mde extends wL{constructor(e,t,n,r,i){super(e,t,ue.Kind.Video,n,i),this.elementInfos=[],this.monitorReceiver=()=>J(this,void 0,void 0,(function*(){if(!this.receiver)return void(this._currentBitrate=0);const e=yield this.getReceiverStats();e&&this.prevStats&&this.receiver&&(this._currentBitrate=qE(e,this.prevStats)),this.prevStats=e})),this.debouncedHandleResize=_L((()=>{this.updateDimensions()}),N2),this.adaptiveStreamSettings=r}get isAdaptiveStream(){return void 0!==this.adaptiveStreamSettings}get mediaStreamTrack(){return this._mediaStreamTrack}setMuted(e){super.setMuted(e),this.attachedElements.forEach((t=>{e?Hh(this._mediaStreamTrack,t):Sh(this._mediaStreamTrack,t)}))}attach(e){if(e?super.attach(e):e=super.attach(),this.adaptiveStreamSettings&&void 0===this.elementInfos.find((t=>t.element===e))){const t=new Ade(e);this.observeElementInfo(t)}return e}observeElementInfo(e){this.adaptiveStreamSettings&&void 0===this.elementInfos.find((t=>t===e))?(e.handleResize=()=>{this.debouncedHandleResize()},e.handleVisibilityChanged=()=>{this.updateVisibility()},this.elementInfos.push(e),e.observe(),this.debouncedHandleResize(),this.updateVisibility()):this.log.warn("visibility resize observer not triggered",this.logContext)}stopObservingElementInfo(e){if(!this.isAdaptiveStream)return void this.log.warn("stopObservingElementInfo ignored",this.logContext);const t=this.elementInfos.filter((t=>t===e));for(const e of t)e.stopObserving();this.elementInfos=this.elementInfos.filter((t=>t!==e)),this.updateVisibility(),this.debouncedHandleResize()}detach(e){let t=[];if(e)return this.stopObservingElement(e),super.detach(e);t=super.detach();for(const e of t)this.stopObservingElement(e);return t}getDecoderImplementation(){var e;return null===(e=this.prevStats)||void 0===e?void 0:e.decoderImplementation}getReceiverStats(){return J(this,void 0,void 0,(function*(){if(!this.receiver||!this.receiver.getStats)return;const e=yield this.receiver.getStats();let t,n="",r=new Map;return e.forEach((e=>{"inbound-rtp"===e.type?(n=e.codecId,t={type:"video",streamId:e.id,framesDecoded:e.framesDecoded,framesDropped:e.framesDropped,framesReceived:e.framesReceived,packetsReceived:e.packetsReceived,packetsLost:e.packetsLost,frameWidth:e.frameWidth,frameHeight:e.frameHeight,pliCount:e.pliCount,firCount:e.firCount,nackCount:e.nackCount,jitter:e.jitter,timestamp:e.timestamp,bytesReceived:e.bytesReceived,decoderImplementation:e.decoderImplementation}):"codec"===e.type&&r.set(e.id,e)})),t&&""!==n&&r.get(n)&&(t.mimeType=r.get(n).mimeType),t}))}stopObservingElement(e){const t=this.elementInfos.filter((t=>t.element===e));for(const e of t)this.stopObservingElementInfo(e)}handleAppVisibilityChanged(){const e=Object.create(null,{handleAppVisibilityChanged:{get:()=>super.handleAppVisibilityChanged}});return J(this,void 0,void 0,(function*(){yield e.handleAppVisibilityChanged.call(this),this.isAdaptiveStream&&this.updateVisibility()}))}updateVisibility(){var e,t;const n=this.elementInfos.reduce(((e,t)=>Math.max(e,t.visibilityChangedAt||0)),0),r=!(null!==(t=null===(e=this.adaptiveStreamSettings)||void 0===e?void 0:e.pauseVideoInBackground)&&void 0!==t&&!t)&&this.isInBackground,i=this.elementInfos.some((e=>e.pictureInPicture)),o=this.elementInfos.some((e=>e.visible))&&!r||i;if(this.lastVisible!==o){if(!o&&Date.now()-n<N2)return void zr.setTimeout((()=>{this.updateVisibility()}),N2);this.lastVisible=o,this.emit(Re.VisibilityChanged,o,this)}}updateDimensions(){var e,t;let n=0,r=0;const i=this.getPixelDensity();for(const e of this.elementInfos){const t=e.width()*i,o=e.height()*i;t+o>n+r&&(n=t,r=o)}(null===(e=this.lastDimensions)||void 0===e?void 0:e.width)===n&&(null===(t=this.lastDimensions)||void 0===t?void 0:t.height)===r||(this.lastDimensions={width:n,height:r},this.emit(Re.VideoDimensionsChanged,this.lastDimensions,this))}getPixelDensity(){var e;const t=null===(e=this.adaptiveStreamSettings)||void 0===e?void 0:e.pixelDensity;return"screen"===t?I8():t||(I8()>2?2:1)}}class Ade{get visible(){return this.isPiP||this.isIntersecting}get pictureInPicture(){return this.isPiP}constructor(e,t){this.onVisibilityChanged=e=>{var t;const{target:n,isIntersecting:r}=e;n===this.element&&(this.isIntersecting=r,this.isPiP=og(this.element),this.visibilityChangedAt=Date.now(),null===(t=this.handleVisibilityChanged)||void 0===t||t.call(this))},this.onEnterPiP=()=>{var e,t,n;null===(t=null===(e=window.documentPictureInPicture)||void 0===e?void 0:e.window)||void 0===t||t.addEventListener("pagehide",this.onLeavePiP),this.isPiP=og(this.element),null===(n=this.handleVisibilityChanged)||void 0===n||n.call(this)},this.onLeavePiP=()=>{var e;this.isPiP=og(this.element),null===(e=this.handleVisibilityChanged)||void 0===e||e.call(this)},this.element=e,this.isIntersecting=t??v3(e),this.isPiP=Wi()&&og(e),this.visibilityChangedAt=0}width(){return this.element.clientWidth}height(){return this.element.clientHeight}observe(){var e,t,n;this.isIntersecting=v3(this.element),this.isPiP=og(this.element),this.element.handleResize=()=>{var e;null===(e=this.handleResize)||void 0===e||e.call(this)},this.element.handleVisibilityChanged=this.onVisibilityChanged,x8().observe(this.element),k8().observe(this.element),this.element.addEventListener("enterpictureinpicture",this.onEnterPiP),this.element.addEventListener("leavepictureinpicture",this.onLeavePiP),null===(e=window.documentPictureInPicture)||void 0===e||e.addEventListener("enter",this.onEnterPiP),null===(n=null===(t=window.documentPictureInPicture)||void 0===t?void 0:t.window)||void 0===n||n.addEventListener("pagehide",this.onLeavePiP)}stopObserving(){var e,t,n,r,i;null===(e=x8())||void 0===e||e.unobserve(this.element),null===(t=k8())||void 0===t||t.unobserve(this.element),this.element.removeEventListener("enterpictureinpicture",this.onEnterPiP),this.element.removeEventListener("leavepictureinpicture",this.onLeavePiP),null===(n=window.documentPictureInPicture)||void 0===n||n.removeEventListener("enter",this.onEnterPiP),null===(i=null===(r=window.documentPictureInPicture)||void 0===r?void 0:r.window)||void 0===i||i.removeEventListener("pagehide",this.onLeavePiP)}}function og(e){var t,n;return document.pictureInPictureElement===e||!(null===(t=window.documentPictureInPicture)||void 0===t||!t.window)&&v3(e,null===(n=window.documentPictureInPicture)||void 0===n?void 0:n.window)}function v3(e,t){const n=t||window;let r=e.offsetTop,i=e.offsetLeft;const o=e.offsetWidth,s=e.offsetHeight,{hidden:a}=e,{display:l}=getComputedStyle(e);for(;e.offsetParent;)r+=(e=e.offsetParent).offsetTop,i+=e.offsetLeft;return r<n.pageYOffset+n.innerHeight&&i<n.pageXOffset+n.innerWidth&&r+s>n.pageYOffset&&i+o>n.pageXOffset&&!a&&"none"!==l}class ul extends Oa.EventEmitter{constructor(e,t,n,r){var i;super(),this.metadataMuted=!1,this.encryption=gs.NONE,this.log=bt,this.handleMuted=()=>{this.emit(Re.Muted)},this.handleUnmuted=()=>{this.emit(Re.Unmuted)},this.log=Ol(null!==(i=null==r?void 0:r.loggerName)&&void 0!==i?i:$o.Publication),this.loggerContextCb=this.loggerContextCb,this.setMaxListeners(100),this.kind=e,this.trackSid=t,this.trackName=n,this.source=ue.Source.Unknown}setTrack(e){this.track&&(this.track.off(Re.Muted,this.handleMuted),this.track.off(Re.Unmuted,this.handleUnmuted)),this.track=e,e&&(e.on(Re.Muted,this.handleMuted),e.on(Re.Unmuted,this.handleUnmuted))}get logContext(){var e;return Object.assign(Object.assign({},null===(e=this.loggerContextCb)||void 0===e?void 0:e.call(this)),Gt(this))}get isMuted(){return this.metadataMuted}get isEnabled(){return!0}get isSubscribed(){return void 0!==this.track}get isEncrypted(){return this.encryption!==gs.NONE}get audioTrack(){if(Ml(this.track))return this.track}get videoTrack(){if(Ap(this.track))return this.track}updateInfo(e){this.trackSid=e.sid,this.trackName=e.name,this.source=ue.sourceFromProto(e.source),this.mimeType=e.mimeType,this.kind===ue.Kind.Video&&e.width>0&&(this.dimensions={width:e.width,height:e.height},this.simulcasted=e.simulcast),this.encryption=e.encryption,this.trackInfo=e,this.log.debug("update publication info",Object.assign(Object.assign({},this.logContext),{info:e}))}}!function(e){var t;(t=e.SubscriptionStatus||(e.SubscriptionStatus={})).Desired="desired",t.Subscribed="subscribed",t.Unsubscribed="unsubscribed",function(e){e.Allowed="allowed",e.NotAllowed="not_allowed"}(e.PermissionStatus||(e.PermissionStatus={}))}(ul||(ul={}));class y3 extends ul{get isUpstreamPaused(){var e;return null===(e=this.track)||void 0===e?void 0:e.isUpstreamPaused}constructor(e,t,n,r){super(e,t.sid,t.name,r),this.track=void 0,this.handleTrackEnded=()=>{this.emit(Re.Ended)},this.updateInfo(t),this.setTrack(n)}setTrack(e){this.track&&this.track.off(Re.Ended,this.handleTrackEnded),super.setTrack(e),e&&e.on(Re.Ended,this.handleTrackEnded)}get isMuted(){return this.track?this.track.isMuted:super.isMuted}get audioTrack(){return super.audioTrack}get videoTrack(){return super.videoTrack}get isLocal(){return!0}mute(){return J(this,void 0,void 0,(function*(){var e;return null===(e=this.track)||void 0===e?void 0:e.mute()}))}unmute(){return J(this,void 0,void 0,(function*(){var e;return null===(e=this.track)||void 0===e?void 0:e.unmute()}))}pauseUpstream(){return J(this,void 0,void 0,(function*(){var e;yield null===(e=this.track)||void 0===e?void 0:e.pauseUpstream()}))}resumeUpstream(){return J(this,void 0,void 0,(function*(){var e;yield null===(e=this.track)||void 0===e?void 0:e.resumeUpstream()}))}getTrackFeatures(){var e;if(Ml(this.track)){const t=this.track.getSourceTrackSettings(),n=new Set;return t.autoGainControl&&n.add(pa.TF_AUTO_GAIN_CONTROL),t.echoCancellation&&n.add(pa.TF_ECHO_CANCELLATION),t.noiseSuppression&&n.add(pa.TF_NOISE_SUPPRESSION),t.channelCount&&t.channelCount>1&&n.add(pa.TF_STEREO),!(null===(e=this.options)||void 0===e)&&e.dtx||n.add(pa.TF_NO_DTX),this.track.enhancedNoiseCancellation&&n.add(pa.TF_ENHANCED_NOISE_CANCELLATION),Array.from(n.values())}return[]}}function Ry(e,t){return J(this,void 0,void 0,(function*(){e??(e={});let n=!1;const{audioProcessor:r,videoProcessor:i,optionsWithoutProcessor:o}=KV(e);let s=o.audio,a=o.video;if(r&&"object"==typeof o.audio&&(o.audio.processor=r),i&&"object"==typeof o.video&&(o.video.processor=i),e.audio&&"object"==typeof o.audio&&"string"==typeof o.audio.deviceId){const e=o.audio.deviceId;o.audio.deviceId={exact:e},n=!0,s=Object.assign(Object.assign({},o.audio),{deviceId:{ideal:e}})}if(o.video&&"object"==typeof o.video&&"string"==typeof o.video.deviceId){const e=o.video.deviceId;o.video.deviceId={exact:e},n=!0,a=Object.assign(Object.assign({},o.video),{deviceId:{ideal:e}})}(!0===o.audio||"object"==typeof o.audio&&!o.audio.deviceId)&&(o.audio={deviceId:"default"}),(!0===o.video||"object"==typeof o.video&&!o.video.deviceId)&&(o.video={deviceId:"default"});const l=BV(o,WV,zV),c=gL(l),u=navigator.mediaDevices.getUserMedia(c);o.audio&&(Mr.userMediaPromiseMap.set("audioinput",u),u.catch((()=>Mr.userMediaPromiseMap.delete("audioinput")))),o.video&&(Mr.userMediaPromiseMap.set("videoinput",u),u.catch((()=>Mr.userMediaPromiseMap.delete("videoinput"))));try{const e=yield u;return yield Promise.all(e.getTracks().map((n=>J(this,void 0,void 0,(function*(){const o="audio"===n.kind;let s,a=o?l.audio:l.video;("boolean"==typeof a||!a)&&(a={});const u=o?c.audio:c.video;"boolean"!=typeof u&&(s=u);const d=n.getSettings().deviceId;null!=s&&s.deviceId&&Zc(s.deviceId)!==d?s.deviceId=d:s||(s={deviceId:d});const h=fde(n,s,t);return h.kind===ue.Kind.Video?h.source=ue.Source.Camera:h.kind===ue.Kind.Audio&&(h.source=ue.Source.Microphone),h.mediaStream=e,Ml(h)&&r?yield h.setProcessor(r):Ap(h)&&i&&(yield h.setProcessor(i)),h})))))}catch(r){if(!n)throw r;return Ry(Object.assign(Object.assign({},e),{audio:s,video:a}),t)}}))}function Nde(e){return J(this,void 0,void 0,(function*(){return(yield Ry({audio:!1,video:!0}))[0]}))}function Dde(e){return J(this,void 0,void 0,(function*(){return(yield Ry({audio:!0,video:!1}))[0]}))}var Uc;function jde(e){switch(e){case Ag.EXCELLENT:return Uc.Excellent;case Ag.GOOD:return Uc.Good;case Ag.POOR:return Uc.Poor;case Ag.LOST:return Uc.Lost;default:return Uc.Unknown}}!function(e){e.Excellent="excellent",e.Good="good",e.Poor="poor",e.Lost="lost",e.Unknown="unknown"}(Uc||(Uc={}));class eq extends Oa.EventEmitter{get logContext(){var e,t;return Object.assign({},null===(t=null===(e=this.loggerOptions)||void 0===e?void 0:e.loggerContextCb)||void 0===t?void 0:t.call(e))}get isEncrypted(){return this.trackPublications.size>0&&Array.from(this.trackPublications.values()).every((e=>e.isEncrypted))}get isAgent(){var e;return(null===(e=this.permissions)||void 0===e?void 0:e.agent)||this.kind===lS.AGENT}get kind(){return this._kind}get attributes(){return Object.freeze(Object.assign({},this._attributes))}constructor(e,t,n,r,i,o){let s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:lS.STANDARD;var a;super(),this.audioLevel=0,this.isSpeaking=!1,this._connectionQuality=Uc.Unknown,this.log=bt,this.log=Ol(null!==(a=null==o?void 0:o.loggerName)&&void 0!==a?a:$o.Participant),this.loggerOptions=o,this.setMaxListeners(100),this.sid=e,this.identity=t,this.name=n,this.metadata=r,this.audioTrackPublications=new Map,this.videoTrackPublications=new Map,this.trackPublications=new Map,this._kind=s,this._attributes=i??{}}getTrackPublications(){return Array.from(this.trackPublications.values())}getTrackPublication(e){for(const[,t]of this.trackPublications)if(t.source===e)return t}getTrackPublicationByName(e){for(const[,t]of this.trackPublications)if(t.trackName===e)return t}get connectionQuality(){return this._connectionQuality}get isCameraEnabled(){var e;const t=this.getTrackPublication(ue.Source.Camera);return!(null===(e=null==t?void 0:t.isMuted)||void 0===e||e)}get isMicrophoneEnabled(){var e;const t=this.getTrackPublication(ue.Source.Microphone);return!(null===(e=null==t?void 0:t.isMuted)||void 0===e||e)}get isScreenShareEnabled(){return!!this.getTrackPublication(ue.Source.ScreenShare)}get isLocal(){return!1}get joinedAt(){return this.participantInfo?new Date(1e3*Number.parseInt(this.participantInfo.joinedAt.toString())):new Date}updateInfo(e){return!(this.participantInfo&&this.participantInfo.sid===e.sid&&this.participantInfo.version>e.version)&&(this.identity=e.identity,this.sid=e.sid,this._setName(e.name),this._setMetadata(e.metadata),this._setAttributes(e.attributes),e.permission&&this.setPermissions(e.permission),this.participantInfo=e,this.log.trace("update participant info",Object.assign(Object.assign({},this.logContext),{info:e})),!0)}_setMetadata(e){const t=this.metadata!==e,n=this.metadata;this.metadata=e,t&&this.emit(oe.ParticipantMetadataChanged,n)}_setName(e){const t=this.name!==e;this.name=e,t&&this.emit(oe.ParticipantNameChanged,e)}_setAttributes(e){const t=Gue(this.attributes,e);this._attributes=e,Object.keys(t).length>0&&this.emit(oe.AttributesChanged,t)}setPermissions(e){var t,n,r,i,o,s;const a=this.permissions,l=e.canPublish!==(null===(t=this.permissions)||void 0===t?void 0:t.canPublish)||e.canSubscribe!==(null===(n=this.permissions)||void 0===n?void 0:n.canSubscribe)||e.canPublishData!==(null===(r=this.permissions)||void 0===r?void 0:r.canPublishData)||e.hidden!==(null===(i=this.permissions)||void 0===i?void 0:i.hidden)||e.recorder!==(null===(o=this.permissions)||void 0===o?void 0:o.recorder)||e.canPublishSources.length!==this.permissions.canPublishSources.length||e.canPublishSources.some(((e,t)=>{var n;return e!==(null===(n=this.permissions)||void 0===n?void 0:n.canPublishSources[t])}))||e.canSubscribeMetrics!==(null===(s=this.permissions)||void 0===s?void 0:s.canSubscribeMetrics);return this.permissions=e,l&&this.emit(oe.ParticipantPermissionsChanged,a),l}setIsSpeaking(e){e!==this.isSpeaking&&(this.isSpeaking=e,e&&(this.lastSpokeAt=new Date),this.emit(oe.IsSpeakingChanged,e))}setConnectionQuality(e){const t=this._connectionQuality;this._connectionQuality=jde(e),t!==this._connectionQuality&&this.emit(oe.ConnectionQualityChanged,this._connectionQuality)}setAudioContext(e){this.audioContext=e,this.audioTrackPublications.forEach((t=>Ml(t.track)&&t.track.setAudioContext(e)))}addTrackPublication(e){e.on(Re.Muted,(()=>{this.emit(oe.TrackMuted,e)})),e.on(Re.Unmuted,(()=>{this.emit(oe.TrackUnmuted,e)}));const t=e;switch(t.track&&(t.track.sid=e.trackSid),this.trackPublications.set(e.trackSid,e),e.kind){case ue.Kind.Audio:this.audioTrackPublications.set(e.trackSid,e);break;case ue.Kind.Video:this.videoTrackPublications.set(e.trackSid,e)}}}function Ude(e){var t,n,r;if(!e.participantSid&&!e.participantIdentity)throw new Error("Invalid track permission, must provide at least one of participantIdentity and participantSid");return new YB({participantIdentity:null!==(t=e.participantIdentity)&&void 0!==t?t:"",participantSid:null!==(n=e.participantSid)&&void 0!==n?n:"",allTracks:null!==(r=e.allowAll)&&void 0!==r&&r,trackSids:e.allowedTrackSids||[]})}const z8=15e3;class Fde extends eq{constructor(e,t,n,r,i){super(e,t,void 0,void 0,void 0,{loggerName:r.loggerName,loggerContextCb:()=>this.engine.logContext}),this.pendingPublishing=new Set,this.pendingPublishPromises=new Map,this.participantTrackPermissions=[],this.allParticipantsAllowedToSubscribe=!0,this.encryptionType=gs.NONE,this.enabledPublishVideoCodecs=[],this.pendingAcks=new Map,this.pendingResponses=new Map,this.handleReconnecting=()=>{this.reconnectFuture||(this.reconnectFuture=new HV)},this.handleReconnected=()=>{var e,t;null===(t=null===(e=this.reconnectFuture)||void 0===e?void 0:e.resolve)||void 0===t||t.call(e),this.reconnectFuture=void 0,this.updateTrackSubscriptionPermissions()},this.handleDisconnected=()=>{var e,t;this.reconnectFuture&&(this.reconnectFuture.promise.catch((e=>this.log.warn(e.message,this.logContext))),null===(t=null===(e=this.reconnectFuture)||void 0===e?void 0:e.reject)||void 0===t||t.call(e,"Got disconnected during reconnection attempt"),this.reconnectFuture=void 0)},this.handleSignalRequestResponse=e=>{const{requestId:t,reason:n,message:r}=e,i=this.pendingSignalRequests.get(t);i&&(n!==hL.OK&&i.reject(new w8(r,n)),this.pendingSignalRequests.delete(t))},this.handleDataPacket=e=>{switch(e.value.case){case"rpcResponse":let t=e.value.value,n=null,r=null;"payload"===t.value.case?n=t.value.value:"error"===t.value.case&&(r=Vn.fromProto(t.value.value)),this.handleIncomingRpcResponse(t.requestId,n,r);break;case"rpcAck":let i=e.value.value;this.handleIncomingRpcAck(i.requestId)}},this.updateTrackSubscriptionPermissions=()=>{this.log.debug("updating track subscription permissions",Object.assign(Object.assign({},this.logContext),{allParticipantsAllowed:this.allParticipantsAllowedToSubscribe,participantTrackPermissions:this.participantTrackPermissions})),this.engine.client.sendUpdateSubscriptionPermissions(this.allParticipantsAllowedToSubscribe,this.participantTrackPermissions.map((e=>Ude(e))))},this.onTrackUnmuted=e=>{this.onTrackMuted(e,e.isUpstreamPaused)},this.onTrackMuted=(e,t)=>{void 0===t&&(t=!0),e.sid?this.engine.updateMuteStatus(e.sid,t):this.log.error("could not update mute status for unpublished track",Object.assign(Object.assign({},this.logContext),Gt(e)))},this.onTrackUpstreamPaused=e=>{this.log.debug("upstream paused",Object.assign(Object.assign({},this.logContext),Gt(e))),this.onTrackMuted(e,!0)},this.onTrackUpstreamResumed=e=>{this.log.debug("upstream resumed",Object.assign(Object.assign({},this.logContext),Gt(e))),this.onTrackMuted(e,e.isMuted)},this.onTrackFeatureUpdate=e=>{const t=this.audioTrackPublications.get(e.sid);t?this.engine.client.sendUpdateLocalAudioTrack(t.trackSid,t.getTrackFeatures()):this.log.warn("Could not update local audio track settings, missing publication for track ".concat(e.sid),this.logContext)},this.handleSubscribedQualityUpdate=e=>J(this,void 0,void 0,(function*(){var t,n,r,i,o,s;if(null===(o=this.roomOptions)||void 0===o||!o.dynacast)return;const a=this.videoTrackPublications.get(e.trackSid);if(a)if(e.subscribedCodecs.length>0){if(!a.videoTrack)return;const o=yield a.videoTrack.setPublishingCodecs(e.subscribedCodecs);try{for(var l,c=!0,u=jc(o);!(t=(l=yield u.next()).done);c=!0){i=l.value,c=!1;const e=i;Tue(e)&&(this.log.debug("publish ".concat(e," for ").concat(a.videoTrack.sid),Object.assign(Object.assign({},this.logContext),Gt(a))),yield this.publishAdditionalCodecForTrack(a.videoTrack,e,a.options))}}catch(e){n={error:e}}finally{try{!c&&!t&&(r=u.return)&&(yield r.call(u))}finally{if(n)throw n.error}}}else e.subscribedQualities.length>0&&(yield null===(s=a.videoTrack)||void 0===s?void 0:s.setPublishingLayers(e.subscribedQualities));else this.log.warn("received subscribed quality update for unknown track",Object.assign(Object.assign({},this.logContext),{trackSid:e.trackSid}))})),this.handleLocalTrackUnpublished=e=>{const t=this.trackPublications.get(e.trackSid);t?this.unpublishTrack(t.track):this.log.warn("received unpublished event for unknown track",Object.assign(Object.assign({},this.logContext),{trackSid:e.trackSid}))},this.handleTrackEnded=e=>J(this,void 0,void 0,(function*(){if(e.source===ue.Source.ScreenShare||e.source===ue.Source.ScreenShareAudio)this.log.debug("unpublishing local track due to TrackEnded",Object.assign(Object.assign({},this.logContext),Gt(e))),this.unpublishTrack(e);else if(e.isUserProvided)yield e.mute();else if(dd(e)||bc(e))try{if(Wi())try{const t=yield null==navigator?void 0:navigator.permissions.query({name:e.source===ue.Source.Camera?"camera":"microphone"});if(t&&"denied"===t.state)throw this.log.warn("user has revoked access to ".concat(e.source),Object.assign(Object.assign({},this.logContext),Gt(e))),t.onchange=()=>{"denied"!==t.state&&(e.isMuted||e.restartTrack(),t.onchange=null)},new Error("GetUserMedia Permission denied")}catch{}e.isMuted||(this.log.debug("track ended, attempting to use a different device",Object.assign(Object.assign({},this.logContext),Gt(e))),dd(e)?yield e.restartTrack({deviceId:"default"}):yield e.restartTrack())}catch{this.log.warn("could not restart track, muting instead",Object.assign(Object.assign({},this.logContext),Gt(e))),yield e.mute()}})),this.audioTrackPublications=new Map,this.videoTrackPublications=new Map,this.trackPublications=new Map,this.engine=n,this.roomOptions=r,this.setupEngine(n),this.activeDeviceMap=new Map([["audioinput","default"],["videoinput","default"],["audiooutput","default"]]),this.pendingSignalRequests=new Map,this.rpcHandlers=i}get lastCameraError(){return this.cameraError}get lastMicrophoneError(){return this.microphoneError}get isE2EEEnabled(){return this.encryptionType!==gs.NONE}getTrackPublication(e){const t=super.getTrackPublication(e);if(t)return t}getTrackPublicationByName(e){const t=super.getTrackPublicationByName(e);if(t)return t}setupEngine(e){this.engine=e,this.engine.on(Pe.RemoteMute,((e,t)=>{const n=this.trackPublications.get(e);!n||!n.track||(t?n.mute():n.unmute())})),this.engine.on(Pe.Connected,this.handleReconnected).on(Pe.SignalRestarted,this.handleReconnected).on(Pe.SignalResumed,this.handleReconnected).on(Pe.Restarting,this.handleReconnecting).on(Pe.Resuming,this.handleReconnecting).on(Pe.LocalTrackUnpublished,this.handleLocalTrackUnpublished).on(Pe.SubscribedQualityUpdate,this.handleSubscribedQualityUpdate).on(Pe.Disconnected,this.handleDisconnected).on(Pe.SignalRequestResponse,this.handleSignalRequestResponse).on(Pe.DataPacketReceived,this.handleDataPacket)}setMetadata(e){return J(this,void 0,void 0,(function*(){yield this.requestMetadataUpdate({metadata:e})}))}setName(e){return J(this,void 0,void 0,(function*(){yield this.requestMetadataUpdate({name:e})}))}setAttributes(e){return J(this,void 0,void 0,(function*(){yield this.requestMetadataUpdate({attributes:e})}))}requestMetadataUpdate(e){return J(this,arguments,void 0,(function(e){var t=this;let{metadata:n,name:r,attributes:i}=e;return function*(){return new Promise(((e,o)=>J(t,void 0,void 0,(function*(){var t,s;try{let a=!1;const l=yield this.engine.client.sendUpdateLocalMetadata(null!==(t=n??this.metadata)&&void 0!==t?t:"",null!==(s=r??this.name)&&void 0!==s?s:"",i),c=performance.now();for(this.pendingSignalRequests.set(l,{resolve:e,reject:e=>{o(e),a=!0},values:{name:r,metadata:n,attributes:i}});performance.now()-c<5e3&&!a;){if((!r||this.name===r)&&(!n||this.metadata===n)&&(!i||Object.entries(i).every((e=>{let[t,n]=e;return this.attributes[t]===n||""===n&&!this.attributes[t]}))))return this.pendingSignalRequests.delete(l),void e();yield Ji(50)}o(new w8("Request to update local metadata timed out","TimeoutError"))}catch(e){e instanceof Error&&o(e)}}))))}()}))}setCameraEnabled(e,t,n){return this.setTrackEnabled(ue.Source.Camera,e,t,n)}setMicrophoneEnabled(e,t,n){return this.setTrackEnabled(ue.Source.Microphone,e,t,n)}setScreenShareEnabled(e,t,n){return this.setTrackEnabled(ue.Source.ScreenShare,e,t,n)}setPermissions(e){const t=this.permissions,n=super.setPermissions(e);return n&&t&&this.emit(oe.ParticipantPermissionsChanged,t),n}setE2EEEnabled(e){return J(this,void 0,void 0,(function*(){this.encryptionType=e?gs.GCM:gs.NONE,yield this.republishAllTracks(void 0,!1)}))}setTrackEnabled(e,t,n,r){return J(this,void 0,void 0,(function*(){var i,o;this.log.debug("setTrackEnabled",Object.assign(Object.assign({},this.logContext),{source:e,enabled:t})),this.republishPromise&&(yield this.republishPromise);let s=this.getTrackPublication(e);if(t)if(s)yield s.unmute();else{let t;if(this.pendingPublishing.has(e)){const t=yield this.waitForPendingPublicationOfSource(e);return t||this.log.info("waiting for pending publication promise timed out",Object.assign(Object.assign({},this.logContext),{source:e})),yield null==t?void 0:t.unmute(),t}this.pendingPublishing.add(e);try{switch(e){case ue.Source.Camera:t=yield this.createTracks({video:null===(i=n)||void 0===i||i});break;case ue.Source.Microphone:t=yield this.createTracks({audio:null===(o=n)||void 0===o||o});break;case ue.Source.ScreenShare:t=yield this.createScreenTracks(Object.assign({},n));break;default:throw new ml(e)}}catch(n){throw null==t||t.forEach((e=>{e.stop()})),n instanceof Error&&this.emit(oe.MediaDevicesError,n),this.pendingPublishing.delete(e),n}try{const e=[];for(const n of t)this.log.info("publishing track",Object.assign(Object.assign({},this.logContext),Gt(n))),e.push(this.publishTrack(n,r));[s]=yield Promise.all(e)}catch(e){throw null==t||t.forEach((e=>{e.stop()})),e}finally{this.pendingPublishing.delete(e)}}else if(!(null!=s&&s.track)&&this.pendingPublishing.has(e)&&(s=yield this.waitForPendingPublicationOfSource(e),s||this.log.info("waiting for pending publication promise timed out",Object.assign(Object.assign({},this.logContext),{source:e}))),s&&s.track)if(e===ue.Source.ScreenShare){s=yield this.unpublishTrack(s.track);const e=this.getTrackPublication(ue.Source.ScreenShareAudio);e&&e.track&&this.unpublishTrack(e.track)}else yield s.mute();return s}))}enableCameraAndMicrophone(){return J(this,void 0,void 0,(function*(){if(!this.pendingPublishing.has(ue.Source.Camera)&&!this.pendingPublishing.has(ue.Source.Microphone)){this.pendingPublishing.add(ue.Source.Camera),this.pendingPublishing.add(ue.Source.Microphone);try{const e=yield this.createTracks({audio:!0,video:!0});yield Promise.all(e.map((e=>this.publishTrack(e))))}finally{this.pendingPublishing.delete(ue.Source.Camera),this.pendingPublishing.delete(ue.Source.Microphone)}}}))}createTracks(e){return J(this,void 0,void 0,(function*(){var t,n;e??(e={});const r=BV(e,null===(t=this.roomOptions)||void 0===t?void 0:t.audioCaptureDefaults,null===(n=this.roomOptions)||void 0===n?void 0:n.videoCaptureDefaults);try{return(yield Ry(r,{loggerName:this.roomOptions.loggerName,loggerContextCb:()=>this.logContext})).map((e=>(Ml(e)&&(this.microphoneError=void 0,e.setAudioContext(this.audioContext),e.source=ue.Source.Microphone,this.emit(oe.AudioStreamAcquired)),Ap(e)&&(this.cameraError=void 0,e.source=ue.Source.Camera),e)))}catch(t){throw t instanceof Error&&(e.audio&&(this.microphoneError=t),e.video&&(this.cameraError=t)),t}}))}createScreenTracks(e){return J(this,void 0,void 0,(function*(){if(void 0===e&&(e={}),void 0===navigator.mediaDevices.getDisplayMedia)throw new mL("getDisplayMedia not supported");void 0===e.resolution&&!Lue()&&(e.resolution=VE.h1080fps30.resolution);const t=Vue(e),n=yield navigator.mediaDevices.getDisplayMedia(t),r=n.getVideoTracks();if(0===r.length)throw new ml("no video track found");const i=new Dv(r[0],void 0,!1,{loggerName:this.roomOptions.loggerName,loggerContextCb:()=>this.logContext});i.source=ue.Source.ScreenShare,e.contentHint&&(i.mediaStreamTrack.contentHint=e.contentHint);const o=[i];if(n.getAudioTracks().length>0){this.emit(oe.AudioStreamAcquired);const e=new fS(n.getAudioTracks()[0],void 0,!1,this.audioContext,{loggerName:this.roomOptions.loggerName,loggerContextCb:()=>this.logContext});e.source=ue.Source.ScreenShareAudio,o.push(e)}return o}))}publishTrack(e,t){return J(this,void 0,void 0,(function*(){return this.publishOrRepublishTrack(e,t)}))}publishOrRepublishTrack(e,t){return J(this,arguments,void 0,(function(e,t){var n=this;let r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return function*(){var i,o,s,a;let l,c;if(dd(e)&&e.setAudioContext(n.audioContext),yield null===(i=n.reconnectFuture)||void 0===i?void 0:i.promise,n.republishPromise&&!r&&(yield n.republishPromise),Cd(e)&&n.pendingPublishPromises.has(e)&&(yield n.pendingPublishPromises.get(e)),e instanceof MediaStreamTrack)l=e.getConstraints();else{let t;switch(l=e.constraints,e.source){case ue.Source.Microphone:t="audioinput";break;case ue.Source.Camera:t="videoinput"}t&&n.activeDeviceMap.has(t)&&(l=Object.assign(Object.assign({},l),{deviceId:n.activeDeviceMap.get(t)}))}if(e instanceof MediaStreamTrack)switch(e.kind){case"audio":e=new fS(e,l,!0,n.audioContext,{loggerName:n.roomOptions.loggerName,loggerContextCb:()=>n.logContext});break;case"video":e=new Dv(e,l,!0,{loggerName:n.roomOptions.loggerName,loggerContextCb:()=>n.logContext});break;default:throw new ml("unsupported MediaStreamTrack kind ".concat(e.kind))}else e.updateLoggerOptions({loggerName:n.roomOptions.loggerName,loggerContextCb:()=>n.logContext});if(n.trackPublications.forEach((t=>{t.track&&t.track===e&&(c=t)})),c)return n.log.warn("track has already been published, skipping",Object.assign(Object.assign({},n.logContext),Gt(c))),c;const u="channelCount"in e.mediaStreamTrack.getSettings()&&2===e.mediaStreamTrack.getSettings().channelCount||2===e.mediaStreamTrack.getConstraints().channelCount,d=null!==(o=null==t?void 0:t.forceStereo)&&void 0!==o?o:u;d&&(t||(t={}),void 0===t.dtx&&n.log.info("Opus DTX will be disabled for stereo tracks by default. Enable them explicitly to make it work.",Object.assign(Object.assign({},n.logContext),Gt(e))),void 0===t.red&&n.log.info("Opus RED will be disabled for stereo tracks by default. Enable them explicitly to make it work."),null!==(s=t.dtx)&&void 0!==s||(t.dtx=!1),null!==(a=t.red)&&void 0!==a||(t.red=!1));const h=Object.assign(Object.assign({},n.roomOptions.publishDefaults),t);!Oue()&&n.roomOptions.e2ee&&(n.log.info("End-to-end encryption is set up, simulcast publishing will be disabled on Safari versions and iOS browsers running iOS < v17.2",Object.assign({},n.logContext)),h.simulcast=!1),h.source&&(e.source=h.source);const p=new Promise(((t,r)=>J(n,void 0,void 0,(function*(){try{if(this.engine.client.currentState!==gn.CONNECTED){this.log.debug("deferring track publication until signal is connected",Object.assign(Object.assign({},this.logContext),{track:Gt(e)}));const n=()=>J(this,void 0,void 0,(function*(){try{const n=yield this.publish(e,h,d);t(n)}catch(e){r(e)}}));setTimeout((()=>{this.engine.off(Pe.SignalConnected,n),r(new E2("publishing rejected as engine not connected within timeout",408))}),15e3),this.engine.once(Pe.SignalConnected,n),this.engine.on(Pe.Closing,(()=>{this.engine.off(Pe.SignalConnected,n),r(new E2("publishing rejected as engine closed",499))}))}else try{const n=yield this.publish(e,h,d);t(n)}catch(e){r(e)}}catch(e){r(e)}}))));n.pendingPublishPromises.set(e,p);try{return yield p}catch(e){throw e}finally{n.pendingPublishPromises.delete(e)}}()}))}hasPermissionsToPublish(e){if(!this.permissions)return this.log.warn("no permissions present for publishing track",Object.assign(Object.assign({},this.logContext),Gt(e))),!1;const{canPublish:t,canPublishSources:n}=this.permissions;return!(!t||0!==n.length&&!n.map((e=>Wue(e))).includes(e.source))||(this.log.warn("insufficient permissions to publish",Object.assign(Object.assign({},this.logContext),Gt(e))),!1)}publish(e,t,n){return J(this,void 0,void 0,(function*(){var r,i,o,s,a,l,c,u,d,h;if(!this.hasPermissionsToPublish(e))throw new E2("failed to publish track, insufficient permissions",403);Array.from(this.trackPublications.values()).find((t=>Cd(e)&&t.source===e.source))&&e.source!==ue.Source.Unknown&&this.log.info("publishing a second track with the same source: ".concat(e.source),Object.assign(Object.assign({},this.logContext),Gt(e))),t.stopMicTrackOnMute&&Ml(e)&&(e.stopOnMute=!0),e.source===ue.Source.ScreenShare&&fp()&&(t.simulcast=!1),"av1"===t.videoCodec&&!kue()&&(t.videoCodec=void 0),"vp9"===t.videoCodec&&!xue()&&(t.videoCodec=void 0),void 0===t.videoCodec&&(t.videoCodec=h3),this.enabledPublishVideoCodecs.length>0&&(this.enabledPublishVideoCodecs.some((e=>t.videoCodec===sb(e.mime)))||(t.videoCodec=sb(this.enabledPublishVideoCodecs[0].mime)));const p=t.videoCodec;e.on(Re.Muted,this.onTrackMuted),e.on(Re.Unmuted,this.onTrackUnmuted),e.on(Re.Ended,this.handleTrackEnded),e.on(Re.UpstreamPaused,this.onTrackUpstreamPaused),e.on(Re.UpstreamResumed,this.onTrackUpstreamResumed),e.on(Re.AudioTrackFeatureUpdate,this.onTrackFeatureUpdate);const f=new Jk({cid:e.mediaStreamTrack.id,name:t.name,type:ue.kindToProto(e.kind),muted:e.isMuted,source:ue.sourceToProto(e.source),disableDtx:!(null===(r=t.dtx)||void 0===r||r),encryption:this.encryptionType,stereo:n,disableRed:this.isE2EEEnabled||!(null===(i=t.red)||void 0===i||i),stream:null==t?void 0:t.stream,backupCodecPolicy:null==t?void 0:t.backupCodecPolicy});let m;if(e.kind===ue.Kind.Video){let n={width:0,height:0};try{n=yield e.waitForDimensions()}catch{const t=null!==(s=null===(o=this.roomOptions.videoCaptureDefaults)||void 0===o?void 0:o.resolution)&&void 0!==s?s:_a.h720.resolution;n={width:t.width,height:t.height},this.log.error("could not determine track dimensions, using defaults",Object.assign(Object.assign(Object.assign({},this.logContext),Gt(e)),{dims:n}))}f.width=n.width,f.height=n.height,bc(e)&&(Xg(p)&&(e.source===ue.Source.ScreenShare&&(t.scalabilityMode="L1T3","contentHint"in e.mediaStreamTrack&&(e.mediaStreamTrack.contentHint="motion",this.log.info("forcing contentHint to motion for screenshare with SVC codecs",Object.assign(Object.assign({},this.logContext),Gt(e))))),t.scalabilityMode=null!==(a=t.scalabilityMode)&&void 0!==a?a:"L3T3_KEY"),f.simulcastCodecs=[new Yk({codec:p,cid:e.mediaStreamTrack.id})],!0===t.backupCodec&&(t.backupCodec={codec:h3}),t.backupCodec&&p!==t.backupCodec.codec&&f.encryption===gs.NONE&&(this.roomOptions.dynacast||(this.roomOptions.dynacast=!0),f.simulcastCodecs.push(new Yk({codec:t.backupCodec.codec,cid:""})))),m=m3(e.source===ue.Source.ScreenShare,f.width,f.height,t),f.layers=K8(f.width,f.height,m,Xg(t.videoCodec))}else e.kind===ue.Kind.Audio&&(m=[{maxBitrate:null===(l=t.audioPreset)||void 0===l?void 0:l.maxBitrate,priority:null!==(u=null===(c=t.audioPreset)||void 0===c?void 0:c.priority)&&void 0!==u?u:"high",networkPriority:null!==(h=null===(d=t.audioPreset)||void 0===d?void 0:d.priority)&&void 0!==h?h:"high"}]);if(!this.engine||this.engine.isClosed)throw new hr("cannot publish track when not connected");const v=()=>J(this,void 0,void 0,(function*(){var n,r,i;if(!this.engine.pcManager)throw new hr("pcManager is not ready");if(e.sender=yield this.engine.createSender(e,t,m),bc(e)&&(null!==(n=t.degradationPreference)&&void 0!==n||(t.degradationPreference=Ede(e)),e.setDegradationPreference(t.degradationPreference)),m)if(fp()&&e.kind===ue.Kind.Audio){let t;for(const n of this.engine.pcManager.publisher.getTransceivers())if(n.sender===e.sender){t=n;break}t&&this.engine.pcManager.publisher.setTrackCodecBitrate({transceiver:t,codec:"opus",maxbr:null!==(r=m[0])&&void 0!==r&&r.maxBitrate?m[0].maxBitrate/1e3:0})}else e.codec&&Xg(e.codec)&&null!==(i=m[0])&&void 0!==i&&i.maxBitrate&&this.engine.pcManager.publisher.setTrackCodecBitrate({cid:f.cid,codec:e.codec,maxbr:m[0].maxBitrate/1e3});yield this.engine.negotiate()}));let g;if(this.enabledPublishVideoCodecs.length>0)g=(yield Promise.all([this.engine.addTrack(f),v()]))[0];else{let n;if(g=yield this.engine.addTrack(f),g.codecs.forEach((e=>{void 0===n&&(n=e.mimeType)})),n&&e.kind===ue.Kind.Video){const r=sb(n);r!==p&&(this.log.debug("falling back to server selected codec",Object.assign(Object.assign(Object.assign({},this.logContext),Gt(e)),{codec:r})),t.videoCodec=r,m=m3(e.source===ue.Source.ScreenShare,f.width,f.height,t))}yield v()}const y=new y3(e.kind,g,e,{loggerName:this.roomOptions.loggerName,loggerContextCb:()=>this.logContext});return y.options=t,e.sid=g.sid,this.log.debug("publishing ".concat(e.kind," with encodings"),Object.assign(Object.assign({},this.logContext),{encodings:m,trackInfo:g})),bc(e)?e.startMonitor(this.engine.client):dd(e)&&e.startMonitor(),this.addTrackPublication(y),this.emit(oe.LocalTrackPublished,y),y}))}get isLocal(){return!0}publishAdditionalCodecForTrack(e,t,n){return J(this,void 0,void 0,(function*(){var r;if(this.encryptionType!==gs.NONE)return;let i;if(this.trackPublications.forEach((t=>{t.track&&t.track===e&&(i=t)})),!i)throw new ml("track is not published");if(!bc(e))throw new ml("track is not a video track");const o=Object.assign(Object.assign({},null===(r=this.roomOptions)||void 0===r?void 0:r.publishDefaults),n),s=_de(e,t,o);if(!s)return void this.log.info("backup codec has been disabled, ignoring request to add additional codec for track",Object.assign(Object.assign({},this.logContext),Gt(e)));const a=e.addSimulcastTrack(t,s);if(!a)return;const l=new Jk({cid:a.mediaStreamTrack.id,type:ue.kindToProto(e.kind),muted:e.isMuted,source:ue.sourceToProto(e.source),sid:e.sid,simulcastCodecs:[{codec:o.videoCodec,cid:a.mediaStreamTrack.id}]});if(l.layers=K8(l.width,l.height,s),!this.engine||this.engine.isClosed)throw new hr("cannot publish track when not connected");const c=(yield Promise.all([this.engine.addTrack(l),(()=>J(this,void 0,void 0,(function*(){yield this.engine.createSimulcastSender(e,a,o,s),yield this.engine.negotiate()})))()]))[0];this.log.debug("published ".concat(t," for track ").concat(e.sid),Object.assign(Object.assign({},this.logContext),{encodings:s,trackInfo:c}))}))}unpublishTrack(e,t){return J(this,void 0,void 0,(function*(){var n,r;if(Cd(e)){const t=this.pendingPublishPromises.get(e);t&&(this.log.info("awaiting publish promise before attempting to unpublish",Object.assign(Object.assign({},this.logContext),Gt(e))),yield t)}const i=this.getPublicationForTrack(e),o=i?Gt(i):void 0;if(this.log.debug("unpublishing track",Object.assign(Object.assign({},this.logContext),o)),!i||!i.track)return void this.log.warn("track was not unpublished because no publication was found",Object.assign(Object.assign({},this.logContext),o));(e=i.track).off(Re.Muted,this.onTrackMuted),e.off(Re.Unmuted,this.onTrackUnmuted),e.off(Re.Ended,this.handleTrackEnded),e.off(Re.UpstreamPaused,this.onTrackUpstreamPaused),e.off(Re.UpstreamResumed,this.onTrackUpstreamResumed),e.off(Re.AudioTrackFeatureUpdate,this.onTrackFeatureUpdate),void 0===t&&(t=null===(r=null===(n=this.roomOptions)||void 0===n?void 0:n.stopLocalTrackOnUnpublish)||void 0===r||r),t?e.stop():e.stopMonitor();let s=!1;const a=e.sender;if(e.sender=void 0,this.engine.pcManager&&this.engine.pcManager.currentState<Hn.FAILED&&a)try{for(const e of this.engine.pcManager.publisher.getTransceivers())e.sender===a&&(e.direction="inactive",s=!0);if(this.engine.removeTrack(a)&&(s=!0),bc(e)){for(const[,t]of e.simulcastCodecs)t.sender&&(this.engine.removeTrack(t.sender)&&(s=!0),t.sender=void 0);e.simulcastCodecs.clear()}}catch(e){this.log.warn("failed to unpublish track",Object.assign(Object.assign(Object.assign({},this.logContext),o),{error:e}))}switch(this.trackPublications.delete(i.trackSid),i.kind){case ue.Kind.Audio:this.audioTrackPublications.delete(i.trackSid);break;case ue.Kind.Video:this.videoTrackPublications.delete(i.trackSid)}return this.emit(oe.LocalTrackUnpublished,i),i.setTrack(void 0),s&&(yield this.engine.negotiate()),i}))}unpublishTracks(e){return J(this,void 0,void 0,(function*(){return(yield Promise.all(e.map((e=>this.unpublishTrack(e))))).filter((e=>!!e))}))}republishAllTracks(e){return J(this,arguments,void 0,(function(e){var t=this;let n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return function*(){t.republishPromise&&(yield t.republishPromise),t.republishPromise=new Promise(((r,i)=>J(t,void 0,void 0,(function*(){try{const t=[];this.trackPublications.forEach((n=>{n.track&&(e&&(n.options=Object.assign(Object.assign({},n.options),e)),t.push(n))})),yield Promise.all(t.map((e=>J(this,void 0,void 0,(function*(){const t=e.track;yield this.unpublishTrack(t,!1),n&&!t.isMuted&&t.source!==ue.Source.ScreenShare&&t.source!==ue.Source.ScreenShareAudio&&(dd(t)||bc(t))&&!t.isUserProvided&&(this.log.debug("restarting existing track",Object.assign(Object.assign({},this.logContext),{track:e.trackSid})),yield t.restartTrack()),yield this.publishOrRepublishTrack(t,e.options,!0)}))))),r()}catch(e){i(e)}finally{this.republishPromise=void 0}})))),yield t.republishPromise}()}))}publishData(e){return J(this,arguments,void 0,(function(e){var t=this;let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return function*(){const r=n.reliable?Ot.RELIABLE:Ot.LOSSY,i=n.destinationIdentities,o=n.topic,s=new Fi({kind:r,value:{case:"user",value:new LB({participantIdentity:t.identity,payload:e,destinationIdentities:i,topic:o})}});yield t.engine.sendDataPacket(s,r)}()}))}publishDtmf(e,t){return J(this,void 0,void 0,(function*(){const n=new Fi({kind:Ot.RELIABLE,value:{case:"sipDtmf",value:new OB({code:e,digit:t})}});yield this.engine.sendDataPacket(n,Ot.RELIABLE)}))}sendChatMessage(e,t){return J(this,void 0,void 0,(function*(){const n={id:crypto.randomUUID(),message:e,timestamp:Date.now(),attachedFiles:null==t?void 0:t.attachments},r=new Fi({value:{case:"chatMessage",value:new Vk(Object.assign(Object.assign({},n),{timestamp:kn.parse(n.timestamp)}))}});return yield this.engine.sendDataPacket(r,Ot.RELIABLE),this.emit(oe.ChatMessage,n),n}))}editChatMessage(e,t){return J(this,void 0,void 0,(function*(){const n=Object.assign(Object.assign({},t),{message:e,editTimestamp:Date.now()}),r=new Fi({value:{case:"chatMessage",value:new Vk(Object.assign(Object.assign({},n),{timestamp:kn.parse(n.timestamp),editTimestamp:kn.parse(n.editTimestamp)}))}});return yield this.engine.sendDataPacket(r,Ot.RELIABLE),this.emit(oe.ChatMessage,n),n}))}sendText(e,t){return J(this,void 0,void 0,(function*(){var n;const r=crypto.randomUUID(),i=(new TextEncoder).encode(e).byteLength,o=null===(n=null==t?void 0:t.attachments)||void 0===n?void 0:n.map((()=>crypto.randomUUID())),s=new Array(o?o.length+1:1).fill(0),a=(e,n)=>{var r;s[n]=e;const i=s.reduce(((e,t)=>e+t),0);null===(r=null==t?void 0:t.onProgress)||void 0===r||r.call(t,i)},l=yield this.streamText({streamId:r,totalSize:i,destinationIdentities:null==t?void 0:t.destinationIdentities,topic:null==t?void 0:t.topic,attachedStreamIds:o,attributes:null==t?void 0:t.attributes});return yield l.write(e),a(1,0),yield l.close(),null!=t&&t.attachments&&o&&(yield Promise.all(t.attachments.map(((e,n)=>J(this,void 0,void 0,(function*(){return this._sendFile(o[n],e,{topic:t.topic,mimeType:e.type,onProgress:e=>{a(e,n+1)}})})))))),l.info}))}streamText(e){return J(this,void 0,void 0,(function*(){var t,n;const r=null!==(t=null==e?void 0:e.streamId)&&void 0!==t?t:crypto.randomUUID(),i={id:r,mimeType:"text/plain",timestamp:Date.now(),topic:null!==(n=null==e?void 0:e.topic)&&void 0!==n?n:"",size:null==e?void 0:e.totalSize,attributes:null==e?void 0:e.attributes},o=new Kk({streamId:r,mimeType:i.mimeType,topic:i.topic,timestamp:ud(i.timestamp),totalLength:ud(null==e?void 0:e.totalSize),attributes:i.attributes,contentHeader:{case:"textHeader",value:new BB({version:null==e?void 0:e.version,attachedStreamIds:null==e?void 0:e.attachedStreamIds,replyToStreamId:null==e?void 0:e.replyToStreamId,operationType:"update"===(null==e?void 0:e.type)?qk.UPDATE:qk.CREATE})}}),s=null==e?void 0:e.destinationIdentities,a=new Fi({destinationIdentities:s,value:{case:"streamHeader",value:o}});yield this.engine.sendDataPacket(a,Ot.RELIABLE);let l=0;const c=this,u=new WritableStream({write(e){return J(this,void 0,void 0,(function*(){for(const t of Bue(e,z8)){yield c.engine.waitForBufferStatusLow(Ot.RELIABLE);const e=new Gk({content:t,streamId:r,chunkIndex:ud(l)}),n=new Fi({destinationIdentities:s,value:{case:"streamChunk",value:e}});yield c.engine.sendDataPacket(n,Ot.RELIABLE),l+=1}}))},close(){return J(this,void 0,void 0,(function*(){const e=new Wk({streamId:r}),t=new Fi({destinationIdentities:s,value:{case:"streamTrailer",value:e}});yield c.engine.sendDataPacket(t,Ot.RELIABLE)}))},abort(e){console.log("Sink error:",e)}});let d=()=>J(this,void 0,void 0,(function*(){yield h.close()}));c.engine.once(Pe.Closing,d);const h=new Lde(u,i,(()=>this.engine.off(Pe.Closing,d)));return h}))}sendFile(e,t){return J(this,void 0,void 0,(function*(){const n=crypto.randomUUID();return yield this._sendFile(n,e,t),{id:n}}))}_sendFile(e,t,n){return J(this,void 0,void 0,(function*(){var r;const i=yield this.streamBytes({streamId:e,totalSize:t.size,name:t.name,mimeType:null!==(r=null==n?void 0:n.mimeType)&&void 0!==r?r:t.type,topic:null==n?void 0:n.topic,destinationIdentities:null==n?void 0:n.destinationIdentities}),o=t.stream().getReader();for(;;){const{done:e,value:t}=yield o.read();if(e)break;yield i.write(t)}return yield i.close(),i.info}))}streamBytes(e){return J(this,void 0,void 0,(function*(){var t,n,r,i,o;const s=null!==(t=null==e?void 0:e.streamId)&&void 0!==t?t:crypto.randomUUID(),a=null==e?void 0:e.destinationIdentities,l={id:s,mimeType:null!==(n=null==e?void 0:e.mimeType)&&void 0!==n?n:"application/octet-stream",topic:null!==(r=null==e?void 0:e.topic)&&void 0!==r?r:"",timestamp:Date.now(),attributes:null==e?void 0:e.attributes,size:null==e?void 0:e.totalSize,name:null!==(i=null==e?void 0:e.name)&&void 0!==i?i:"unknown"},c=new Kk({totalLength:ud(null!==(o=l.size)&&void 0!==o?o:0),mimeType:l.mimeType,streamId:s,topic:l.topic,timestamp:ud(Date.now()),contentHeader:{case:"byteHeader",value:new VB({name:l.name})}}),u=new Fi({destinationIdentities:a,value:{case:"streamHeader",value:c}});yield this.engine.sendDataPacket(u,Ot.RELIABLE);let d=0;const h=new Ei,p=this.engine,f=this.log,m=new WritableStream({write(e){return J(this,void 0,void 0,(function*(){const t=yield h.lock();let n=0;try{for(;n<e.byteLength;){const t=e.slice(n,n+z8);yield p.waitForBufferStatusLow(Ot.RELIABLE);const r=new Fi({destinationIdentities:a,value:{case:"streamChunk",value:new Gk({content:t,streamId:s,chunkIndex:ud(d)})}});yield p.sendDataPacket(r,Ot.RELIABLE),d+=1,n+=t.byteLength}}finally{t()}}))},close(){return J(this,void 0,void 0,(function*(){const e=new Wk({streamId:s}),t=new Fi({destinationIdentities:a,value:{case:"streamTrailer",value:e}});yield p.sendDataPacket(t,Ot.RELIABLE)}))},abort(e){f.error("Sink error:",e)}});return new Ode(m,l)}))}performRpc(e){return J(this,arguments,void 0,(function(e){var t=this;let{destinationIdentity:n,method:r,payload:i,responseTimeout:o=1e4}=e;return function*(){return new Promise(((e,s)=>J(t,void 0,void 0,(function*(){var t,a,l,c;if(SL(i)>YV)return void s(Vn.builtIn("REQUEST_PAYLOAD_TOO_LARGE"));if(null!==(a=null===(t=this.engine.latestJoinResponse)||void 0===t?void 0:t.serverInfo)&&void 0!==a&&a.version&&Nd(null===(c=null===(l=this.engine.latestJoinResponse)||void 0===l?void 0:l.serverInfo)||void 0===c?void 0:c.version,"1.8.0")<0)return void s(Vn.builtIn("UNSUPPORTED_SERVER"));const u=crypto.randomUUID();yield this.publishRpcRequest(n,u,r,i,o-2e3);const d=setTimeout((()=>{this.pendingAcks.delete(u),s(Vn.builtIn("CONNECTION_TIMEOUT")),this.pendingResponses.delete(u),clearTimeout(h)}),2e3);this.pendingAcks.set(u,{resolve:()=>{clearTimeout(d)},participantIdentity:n});const h=setTimeout((()=>{this.pendingResponses.delete(u),s(Vn.builtIn("RESPONSE_TIMEOUT"))}),o);this.pendingResponses.set(u,{resolve:(t,n)=>{clearTimeout(h),this.pendingAcks.has(u)&&(console.warn("RPC response received before ack",u),this.pendingAcks.delete(u),clearTimeout(d)),n?s(n):e(t??"")},participantIdentity:n})}))))}()}))}registerRpcMethod(e,t){this.rpcHandlers.has(e)&&this.log.warn("you're overriding the RPC handler for method ".concat(e,", in the future this will throw an error")),this.rpcHandlers.set(e,t)}unregisterRpcMethod(e){this.rpcHandlers.delete(e)}setTrackSubscriptionPermissions(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];this.participantTrackPermissions=t,this.allParticipantsAllowedToSubscribe=e,this.engine.client.isDisconnected||this.updateTrackSubscriptionPermissions()}handleIncomingRpcAck(e){const t=this.pendingAcks.get(e);t?(t.resolve(),this.pendingAcks.delete(e)):console.error("Ack received for unexpected RPC request",e)}handleIncomingRpcResponse(e,t,n){const r=this.pendingResponses.get(e);r?(r.resolve(t,n),this.pendingResponses.delete(e)):console.error("Response received for unexpected RPC request",e)}publishRpcRequest(e,t,n,r,i){return J(this,void 0,void 0,(function*(){const o=new Fi({destinationIdentities:[e],kind:Ot.RELIABLE,value:{case:"rpcRequest",value:new MB({id:t,method:n,payload:r,responseTimeoutMs:i,version:1})}});yield this.engine.sendDataPacket(o,Ot.RELIABLE)}))}handleParticipantDisconnected(e){for(const[t,{participantIdentity:n}]of this.pendingAcks)n===e&&this.pendingAcks.delete(t);for(const[t,{participantIdentity:n,resolve:r}]of this.pendingResponses)n===e&&(r(null,Vn.builtIn("RECIPIENT_DISCONNECTED")),this.pendingResponses.delete(t))}setEnabledPublishCodecs(e){this.enabledPublishVideoCodecs=e.filter((e=>"video"===e.mime.split("/")[0].toLowerCase()))}updateInfo(e){return!(e.sid!==this.sid||!super.updateInfo(e))&&(e.tracks.forEach((e=>{var t,n;const r=this.trackPublications.get(e.sid);if(r){const i=r.isMuted||null!==(n=null===(t=r.track)||void 0===t?void 0:t.isUpstreamPaused)&&void 0!==n&&n;i!==e.muted&&(this.log.debug("updating server mute state after reconcile",Object.assign(Object.assign(Object.assign({},this.logContext),Gt(r)),{mutedOnServer:i})),this.engine.client.sendMuteTrack(e.sid,i))}})),!0)}getPublicationForTrack(e){let t;return this.trackPublications.forEach((n=>{const r=n.track;r&&(e instanceof MediaStreamTrack?(dd(r)||bc(r))&&r.mediaStreamTrack===e&&(t=n):e===r&&(t=n))})),t}waitForPendingPublicationOfSource(e){return J(this,void 0,void 0,(function*(){const t=Date.now();for(;Date.now()<t+1e4;){const t=Array.from(this.pendingPublishPromises.entries()).find((t=>{let[n]=t;return n.source===e}));if(t)return t[1];yield Ji(20)}}))}}class pS extends ul{constructor(e,t,n,r){super(e,t.sid,t.name,r),this.track=void 0,this.allowed=!0,this.disabled=!1,this.currentVideoQuality=Hs.HIGH,this.handleEnded=e=>{this.setTrack(void 0),this.emit(Re.Ended,e)},this.handleVisibilityChange=e=>{this.log.debug("adaptivestream video visibility ".concat(this.trackSid,", visible=").concat(e),this.logContext),this.disabled=!e,this.emitTrackUpdate()},this.handleVideoDimensionsChange=e=>{this.log.debug("adaptivestream video dimensions ".concat(e.width,"x").concat(e.height),this.logContext),this.videoDimensions=e,this.emitTrackUpdate()},this.subscribed=n,this.updateInfo(t)}setSubscribed(e){const t=this.subscriptionStatus,n=this.permissionStatus;this.subscribed=e,e&&(this.allowed=!0);const r=new HE({trackSids:[this.trackSid],subscribe:this.subscribed,participantTracks:[new jB({participantSid:"",trackSids:[this.trackSid]})]});this.emit(Re.UpdateSubscription,r),this.emitSubscriptionUpdateIfChanged(t),this.emitPermissionUpdateIfChanged(n)}get subscriptionStatus(){return!1===this.subscribed?ul.SubscriptionStatus.Unsubscribed:super.isSubscribed?ul.SubscriptionStatus.Subscribed:ul.SubscriptionStatus.Desired}get permissionStatus(){return this.allowed?ul.PermissionStatus.Allowed:ul.PermissionStatus.NotAllowed}get isSubscribed(){return!1!==this.subscribed&&super.isSubscribed}get isDesired(){return!1!==this.subscribed}get isEnabled(){return!this.disabled}get isLocal(){return!1}setEnabled(e){!this.isManualOperationAllowed()||this.disabled===!e||(this.disabled=!e,this.emitTrackUpdate())}setVideoQuality(e){!this.isManualOperationAllowed()||this.currentVideoQuality===e||(this.currentVideoQuality=e,this.videoDimensions=void 0,this.emitTrackUpdate())}setVideoDimensions(e){var t,n;this.isManualOperationAllowed()&&((null===(t=this.videoDimensions)||void 0===t?void 0:t.width)===e.width&&(null===(n=this.videoDimensions)||void 0===n?void 0:n.height)===e.height||(k2(this.track)&&(this.videoDimensions=e),this.currentVideoQuality=void 0,this.emitTrackUpdate()))}setVideoFPS(e){this.isManualOperationAllowed()&&k2(this.track)&&this.fps!==e&&(this.fps=e,this.emitTrackUpdate())}get videoQuality(){return this.currentVideoQuality}setTrack(e){const t=this.subscriptionStatus,n=this.permissionStatus,r=this.track;r!==e&&(r&&(r.off(Re.VideoDimensionsChanged,this.handleVideoDimensionsChange),r.off(Re.VisibilityChanged,this.handleVisibilityChange),r.off(Re.Ended,this.handleEnded),r.detach(),r.stopMonitor(),this.emit(Re.Unsubscribed,r)),super.setTrack(e),e&&(e.sid=this.trackSid,e.on(Re.VideoDimensionsChanged,this.handleVideoDimensionsChange),e.on(Re.VisibilityChanged,this.handleVisibilityChange),e.on(Re.Ended,this.handleEnded),this.emit(Re.Subscribed,e)),this.emitPermissionUpdateIfChanged(n),this.emitSubscriptionUpdateIfChanged(t))}setAllowed(e){const t=this.subscriptionStatus,n=this.permissionStatus;this.allowed=e,this.emitPermissionUpdateIfChanged(n),this.emitSubscriptionUpdateIfChanged(t)}setSubscriptionError(e){this.emit(Re.SubscriptionFailed,e)}updateInfo(e){super.updateInfo(e);const t=this.metadataMuted;this.metadataMuted=e.muted,this.track?this.track.setMuted(e.muted):t!==e.muted&&this.emit(e.muted?Re.Muted:Re.Unmuted)}emitSubscriptionUpdateIfChanged(e){const t=this.subscriptionStatus;e!==t&&this.emit(Re.SubscriptionStatusChanged,t,e)}emitPermissionUpdateIfChanged(e){this.permissionStatus!==e&&this.emit(Re.SubscriptionPermissionChanged,this.permissionStatus,e)}isManualOperationAllowed(){return this.kind===ue.Kind.Video&&this.isAdaptiveStream?(this.log.warn("adaptive stream is enabled, cannot change video track settings",this.logContext),!1):!!this.isDesired||(this.log.warn("cannot update track settings when not subscribed",this.logContext),!1)}get isAdaptiveStream(){return k2(this.track)&&this.track.isAdaptiveStream}emitTrackUpdate(){const e=new qB({trackSids:[this.trackSid],disabled:this.disabled,fps:this.fps});this.videoDimensions?(e.width=Math.ceil(this.videoDimensions.width),e.height=Math.ceil(this.videoDimensions.height)):void 0!==this.currentVideoQuality?e.quality=this.currentVideoQuality:e.quality=Hs.HIGH,this.emit(Re.UpdateSettings,e)}}class mS extends eq{static fromParticipantInfo(e,t,n){return new mS(e,t.sid,t.identity,t.name,t.metadata,t.attributes,n,t.kind)}get logContext(){return Object.assign(Object.assign({},super.logContext),{rpID:this.sid,remoteParticipant:this.identity})}constructor(e,t,n,r,i,o,s){super(t,n||"",r,i,o,s,arguments.length>7&&void 0!==arguments[7]?arguments[7]:lS.STANDARD),this.signalClient=e,this.trackPublications=new Map,this.audioTrackPublications=new Map,this.videoTrackPublications=new Map,this.volumeMap=new Map}addTrackPublication(e){super.addTrackPublication(e),e.on(Re.UpdateSettings,(t=>{this.log.debug("send update settings",Object.assign(Object.assign({},this.logContext),Gt(e))),this.signalClient.sendUpdateTrackSettings(t)})),e.on(Re.UpdateSubscription,(e=>{e.participantTracks.forEach((e=>{e.participantSid=this.sid})),this.signalClient.sendUpdateSubscription(e)})),e.on(Re.SubscriptionPermissionChanged,(t=>{this.emit(oe.TrackSubscriptionPermissionChanged,e,t)})),e.on(Re.SubscriptionStatusChanged,(t=>{this.emit(oe.TrackSubscriptionStatusChanged,e,t)})),e.on(Re.Subscribed,(t=>{this.emit(oe.TrackSubscribed,t,e)})),e.on(Re.Unsubscribed,(t=>{this.emit(oe.TrackUnsubscribed,t,e)})),e.on(Re.SubscriptionFailed,(t=>{this.emit(oe.TrackSubscriptionFailed,e.trackSid,t)}))}getTrackPublication(e){const t=super.getTrackPublication(e);if(t)return t}getTrackPublicationByName(e){const t=super.getTrackPublicationByName(e);if(t)return t}setVolume(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:ue.Source.Microphone;this.volumeMap.set(t,e);const n=this.getTrackPublication(t);n&&n.track&&n.track.setVolume(e)}getVolume(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:ue.Source.Microphone;const t=this.getTrackPublication(e);return t&&t.track?t.track.getVolume():this.volumeMap.get(e)}addSubscribedMediaTrack(e,t,n,r,i,o){let s=this.getTrackPublicationBySid(t);if(s||t.startsWith("TR")||this.trackPublications.forEach((t=>{!s&&e.kind===t.kind.toString()&&(s=t)})),!s)return 0===o?(this.log.error("could not find published track",Object.assign(Object.assign({},this.logContext),{trackSid:t})),void this.emit(oe.TrackSubscriptionFailed,t)):(void 0===o&&(o=20),void setTimeout((()=>{this.addSubscribedMediaTrack(e,t,n,r,i,o-1)}),150));if("ended"===e.readyState)return this.log.error("unable to subscribe because MediaStreamTrack is ended. Do not call MediaStreamTrack.stop()",Object.assign(Object.assign({},this.logContext),Gt(s))),void this.emit(oe.TrackSubscriptionFailed,t);let a;return a="video"===e.kind?new Mde(e,t,r,i):new QV(e,t,r,this.audioContext,this.audioOutput),a.source=s.source,a.isMuted=s.isMuted,a.setMediaStream(n),a.start(),s.setTrack(a),this.volumeMap.has(s.source)&&d3(a)&&Ml(a)&&a.setVolume(this.volumeMap.get(s.source)),s}get hasMetadata(){return!!this.participantInfo}getTrackPublicationBySid(e){return this.trackPublications.get(e)}updateInfo(e){if(!super.updateInfo(e))return!1;const t=new Map,n=new Map;return e.tracks.forEach((e=>{var r,i;let o=this.getTrackPublicationBySid(e.sid);if(o)o.updateInfo(e);else{const t=ue.kindFromProto(e.type);if(!t)return;o=new pS(t,e,null===(r=this.signalClient.connectOptions)||void 0===r?void 0:r.autoSubscribe,{loggerContextCb:()=>this.logContext,loggerName:null===(i=this.loggerOptions)||void 0===i?void 0:i.loggerName}),o.updateInfo(e),n.set(e.sid,o);const s=Array.from(this.trackPublications.values()).find((e=>e.source===(null==o?void 0:o.source)));s&&o.source!==ue.Source.Unknown&&this.log.debug("received a second track publication for ".concat(this.identity," with the same source: ").concat(o.source),Object.assign(Object.assign({},this.logContext),{oldTrack:Gt(s),newTrack:Gt(o)})),this.addTrackPublication(o)}t.set(e.sid,o)})),this.trackPublications.forEach((e=>{t.has(e.trackSid)||(this.log.trace("detected removed track on remote participant, unpublishing",Object.assign(Object.assign({},this.logContext),Gt(e))),this.unpublishTrack(e.trackSid,!0))})),n.forEach((e=>{this.emit(oe.TrackPublished,e)})),!0}unpublishTrack(e,t){const n=this.trackPublications.get(e);if(!n)return;const{track:r}=n;switch(r&&(r.stop(),n.setTrack(void 0)),this.trackPublications.delete(e),n.kind){case ue.Kind.Audio:this.audioTrackPublications.delete(e);break;case ue.Kind.Video:this.videoTrackPublications.delete(e)}t&&this.emit(oe.TrackUnpublished,n)}setAudioOutput(e){return J(this,void 0,void 0,(function*(){this.audioOutput=e;const t=[];this.audioTrackPublications.forEach((n=>{var r;Ml(n.track)&&d3(n.track)&&t.push(n.track.setSinkId(null!==(r=e.deviceId)&&void 0!==r?r:"default"))})),yield Promise.all(t)}))}emit(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return this.log.trace("participant event",Object.assign(Object.assign({},this.logContext),{event:e,args:n})),super.emit(e,...n)}}var St;!function(e){e.Disconnected="disconnected",e.Connecting="connecting",e.Connected="connected",e.Reconnecting="reconnecting",e.SignalReconnecting="signalReconnecting"}(St||(St={}));const $de=4e3;class Al extends Oa.EventEmitter{constructor(e){var t,n,r,i;if(super(),t=this,this.state=St.Disconnected,this.activeSpeakers=[],this.isE2EEEnabled=!1,this.audioEnabled=!0,this.isVideoPlaybackBlocked=!1,this.log=bt,this.bufferedEvents=[],this.isResuming=!1,this.byteStreamControllers=new Map,this.textStreamControllers=new Map,this.byteStreamHandlers=new Map,this.textStreamHandlers=new Map,this.rpcHandlers=new Map,this.connect=(e,t,n)=>J(this,void 0,void 0,(function*(){var r;if(!Pue())throw Ca()?Error("WebRTC isn't detected, have you called registerGlobals?"):Error("LiveKit doesn't seem to be supported on this browser. Try to update your browser and make sure no browser extensions are disabling webRTC.");const i=yield this.disconnectLock.lock();if(this.state===St.Connected)return this.log.info("already connected to room ".concat(this.name),this.logContext),i(),Promise.resolve();if(this.connectFuture)return i(),this.connectFuture.promise;this.setAndEmitConnectionState(St.Connecting),(null===(r=this.regionUrlProvider)||void 0===r?void 0:r.getServerUrl().toString())!==e&&(this.regionUrl=void 0,this.regionUrlProvider=void 0),c3(new URL(e))&&(void 0===this.regionUrlProvider?this.regionUrlProvider=new g3(e,t):this.regionUrlProvider.updateToken(t),this.regionUrlProvider.fetchRegionSettings().then((e=>{var t;null===(t=this.regionUrlProvider)||void 0===t||t.setServerReportedRegions(e)})).catch((e=>{this.log.warn("could not fetch region settings",Object.assign(Object.assign({},this.logContext),{error:e}))})));const o=(r,s,a)=>J(this,void 0,void 0,(function*(){var l,c;this.abortController&&this.abortController.abort();const u=new AbortController;this.abortController=u,null==i||i();try{yield this.attemptConnection(a??e,t,n,u),this.abortController=void 0,r()}catch(e){if(this.regionUrlProvider&&e instanceof en&&e.reason!==kt.Cancelled&&e.reason!==kt.NotAllowed){let t=null;try{t=yield this.regionUrlProvider.getNextBestRegionUrl(null===(l=this.abortController)||void 0===l?void 0:l.signal)}catch(e){if(e instanceof en&&(401===e.status||e.reason===kt.Cancelled))return this.handleDisconnect(this.options.stopLocalTrackOnUnpublish),void s(e)}!t||null!==(c=this.abortController)&&void 0!==c&&c.signal.aborted?(this.handleDisconnect(this.options.stopLocalTrackOnUnpublish,L8(e)),s(e)):(this.log.info("Initial connection failed with ConnectionError: ".concat(e.message,". Retrying with another region: ").concat(t),this.logContext),this.recreateEngine(),yield o(r,s,t))}else{let t=Ao.UNKNOWN_REASON;e instanceof en&&(t=L8(e)),this.handleDisconnect(this.options.stopLocalTrackOnUnpublish,t),s(e)}}})),s=this.regionUrl;return this.regionUrl=void 0,this.connectFuture=new HV(((e,t)=>{o(e,t,s)}),(()=>{this.clearConnectionFutures()})),this.connectFuture.promise})),this.connectSignal=(e,t,n,r,i,o)=>J(this,void 0,void 0,(function*(){var s,a,l;const c=yield n.join(e,t,{autoSubscribe:r.autoSubscribe,adaptiveStream:"object"==typeof i.adaptiveStream||i.adaptiveStream,maxRetries:r.maxRetries,e2eeEnabled:!!this.e2eeManager,websocketTimeout:r.websocketTimeout},o.signal);let u=c.serverInfo;if(u||(u={version:c.serverVersion,region:c.serverRegion}),this.serverInfo=u,this.log.debug("connected to Livekit Server ".concat(Object.entries(u).map((e=>{let[t,n]=e;return"".concat(t,": ").concat(n)})).join(", ")),{room:null===(s=c.room)||void 0===s?void 0:s.name,roomSid:null===(a=c.room)||void 0===a?void 0:a.sid,identity:null===(l=c.participant)||void 0===l?void 0:l.identity}),!u.version)throw new mue("unknown server version");return"0.15.1"===u.version&&this.options.dynacast&&(this.log.debug("disabling dynacast due to server version",this.logContext),i.dynacast=!1),c})),this.applyJoinResponse=e=>{const t=e.participant;if(this.localParticipant.sid=t.sid,this.localParticipant.identity=t.identity,this.localParticipant.setEnabledPublishCodecs(e.enabledPublishCodecs),this.options.e2ee&&this.e2eeManager)try{this.e2eeManager.setSifTrailer(e.sifTrailer)}catch(e){this.log.error(e instanceof Error?e.message:"Could not set SifTrailer",Object.assign(Object.assign({},this.logContext),{error:e}))}this.handleParticipantUpdates([t,...e.otherParticipants]),e.room&&this.handleRoomUpdate(e.room)},this.attemptConnection=(e,t,n,r)=>J(this,void 0,void 0,(function*(){var i,o;this.state===St.Reconnecting||this.isResuming||null!==(i=this.engine)&&void 0!==i&&i.pendingReconnect?(this.log.info("Reconnection attempt replaced by new connection attempt",this.logContext),this.recreateEngine()):this.maybeCreateEngine(),!(null===(o=this.regionUrlProvider)||void 0===o)&&o.isCloud()&&this.engine.setRegionUrlProvider(this.regionUrlProvider),this.acquireAudioContext(),this.connOptions=Object.assign(Object.assign({},bL),n),this.connOptions.rtcConfig&&(this.engine.rtcConfig=this.connOptions.rtcConfig),this.connOptions.peerConnectionTimeout&&(this.engine.peerConnectionTimeout=this.connOptions.peerConnectionTimeout);try{const n=yield this.connectSignal(e,t,this.engine,this.connOptions,this.options,r);this.applyJoinResponse(n),this.setupLocalParticipantEvents(),this.emit(le.SignalConnected)}catch(e){yield this.engine.close(),this.recreateEngine();const t=new en("could not establish signal connection",kt.ServerUnreachable);throw e instanceof Error&&(t.message="".concat(t.message,": ").concat(e.message)),e instanceof en&&(t.reason=e.reason,t.status=e.status),this.log.debug("error trying to establish signal connection",Object.assign(Object.assign({},this.logContext),{error:e})),t}if(r.signal.aborted)throw yield this.engine.close(),this.recreateEngine(),new en("Connection attempt aborted",kt.Cancelled);try{yield this.engine.waitForPCInitialConnection(this.connOptions.peerConnectionTimeout,r)}catch(e){throw yield this.engine.close(),this.recreateEngine(),e}Wi()&&this.options.disconnectOnPageLeave&&(window.addEventListener("pagehide",this.onPageLeave),window.addEventListener("beforeunload",this.onPageLeave)),Wi()&&document.addEventListener("freeze",this.onPageLeave),this.setAndEmitConnectionState(St.Connected),this.emit(le.Connected),this.registerConnectionReconcile()})),this.disconnect=function(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return J(t,[...n],void 0,(function(){var e=this;let t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return function*(){var n,r,i,o;const s=yield e.disconnectLock.lock();try{if(e.state===St.Disconnected)return void e.log.debug("already disconnected",e.logContext);e.log.info("disconnect from room",Object.assign({},e.logContext)),(e.state===St.Connecting||e.state===St.Reconnecting||e.isResuming)&&(e.log.warn("abort connection attempt",e.logContext),null===(n=e.abortController)||void 0===n||n.abort(),null===(i=null===(r=e.connectFuture)||void 0===r?void 0:r.reject)||void 0===i||i.call(r,new en("Client initiated disconnect",kt.Cancelled)),e.connectFuture=void 0),!(null===(o=e.engine)||void 0===o)&&o.client.isDisconnected||(yield e.engine.client.sendLeave()),e.engine&&(yield e.engine.close()),e.handleDisconnect(t,Ao.CLIENT_INITIATED),e.engine=void 0}finally{s()}}()}))},this.onPageLeave=()=>J(this,void 0,void 0,(function*(){this.log.info("Page leave detected, disconnecting",this.logContext),yield this.disconnect()})),this.startAudio=()=>J(this,void 0,void 0,(function*(){const e=[],t=Ho();if(t&&"iOS"===t.os){const t="livekit-dummy-audio-el";let n=document.getElementById(t);if(!n){n=document.createElement("audio"),n.id=t,n.autoplay=!0,n.hidden=!0;const e=I2();e.enabled=!0;const r=new MediaStream([e]);n.srcObject=r,document.addEventListener("visibilitychange",(()=>{n&&(n.srcObject=document.hidden?null:r,document.hidden||(this.log.debug("page visible again, triggering startAudio to resume playback and update playback status",this.logContext),this.startAudio()))})),document.body.append(n),this.once(le.Disconnected,(()=>{null==n||n.remove(),n=null}))}e.push(n)}this.remoteParticipants.forEach((t=>{t.audioTrackPublications.forEach((t=>{t.track&&t.track.attachedElements.forEach((t=>{e.push(t)}))}))}));try{yield Promise.all([this.acquireAudioContext(),...e.map((e=>(e.muted=!1,e.play())))]),this.handleAudioPlaybackStarted()}catch(e){throw this.handleAudioPlaybackFailed(e),e}})),this.startVideo=()=>J(this,void 0,void 0,(function*(){const e=[];for(const t of this.remoteParticipants.values())t.videoTrackPublications.forEach((t=>{var n;null===(n=t.track)||void 0===n||n.attachedElements.forEach((t=>{e.includes(t)||e.push(t)}))}));yield Promise.all(e.map((e=>e.play()))).then((()=>{this.handleVideoPlaybackStarted()})).catch((e=>{"NotAllowedError"===e.name?this.handleVideoPlaybackFailed():this.log.warn("Resuming video playback failed, make sure you call `startVideo` directly in a user gesture handler",this.logContext)}))})),this.handleRestarting=()=>{this.clearConnectionReconcile(),this.isResuming=!1;for(const e of this.remoteParticipants.values())this.handleParticipantDisconnected(e.identity,e);this.setAndEmitConnectionState(St.Reconnecting)&&this.emit(le.Reconnecting)},this.handleSignalRestarted=e=>J(this,void 0,void 0,(function*(){this.log.debug("signal reconnected to server, region ".concat(e.serverRegion),Object.assign(Object.assign({},this.logContext),{region:e.serverRegion})),this.bufferedEvents=[],this.applyJoinResponse(e);try{yield this.localParticipant.republishAllTracks(void 0,!0)}catch(e){this.log.error("error trying to re-publish tracks after reconnection",Object.assign(Object.assign({},this.logContext),{error:e}))}try{yield this.engine.waitForRestarted(),this.log.debug("fully reconnected to server",Object.assign(Object.assign({},this.logContext),{region:e.serverRegion}))}catch{return}this.setAndEmitConnectionState(St.Connected),this.emit(le.Reconnected),this.registerConnectionReconcile(),this.emitBufferedEvents()})),this.handleParticipantUpdates=e=>{e.forEach((e=>{var t;if(e.identity===this.localParticipant.identity)return void this.localParticipant.updateInfo(e);""===e.identity&&(e.identity=null!==(t=this.sidToIdentity.get(e.sid))&&void 0!==t?t:"");let n=this.remoteParticipants.get(e.identity);e.state===Bk.DISCONNECTED?this.handleParticipantDisconnected(e.identity,n):n=this.getOrCreateParticipant(e.identity,e)}))},this.handleActiveSpeakersUpdate=e=>{const t=[],n={};e.forEach((e=>{if(n[e.sid]=!0,e.sid===this.localParticipant.sid)this.localParticipant.audioLevel=e.level,this.localParticipant.setIsSpeaking(!0),t.push(this.localParticipant);else{const n=this.getRemoteParticipantBySid(e.sid);n&&(n.audioLevel=e.level,n.setIsSpeaking(!0),t.push(n))}})),n[this.localParticipant.sid]||(this.localParticipant.audioLevel=0,this.localParticipant.setIsSpeaking(!1)),this.remoteParticipants.forEach((e=>{n[e.sid]||(e.audioLevel=0,e.setIsSpeaking(!1))})),this.activeSpeakers=t,this.emitWhenConnected(le.ActiveSpeakersChanged,t)},this.handleSpeakersChanged=e=>{const t=new Map;this.activeSpeakers.forEach((e=>{const n=this.remoteParticipants.get(e.identity);n&&n.sid!==e.sid||t.set(e.sid,e)})),e.forEach((e=>{let n=this.getRemoteParticipantBySid(e.sid);e.sid===this.localParticipant.sid&&(n=this.localParticipant),n&&(n.audioLevel=e.level,n.setIsSpeaking(e.active),e.active?t.set(e.sid,n):t.delete(e.sid))}));const n=Array.from(t.values());n.sort(((e,t)=>t.audioLevel-e.audioLevel)),this.activeSpeakers=n,this.emitWhenConnected(le.ActiveSpeakersChanged,n)},this.handleStreamStateUpdate=e=>{e.streamStates.forEach((e=>{const t=this.getRemoteParticipantBySid(e.participantSid);if(!t)return;const n=t.getTrackPublicationBySid(e.trackSid);if(!n||!n.track)return;const r=ue.streamStateFromProto(e.state);r!==n.track.streamState&&(n.track.streamState=r,t.emit(oe.TrackStreamStateChanged,n,n.track.streamState),this.emitWhenConnected(le.TrackStreamStateChanged,n,n.track.streamState,t))}))},this.handleSubscriptionPermissionUpdate=e=>{const t=this.getRemoteParticipantBySid(e.participantSid);if(!t)return;const n=t.getTrackPublicationBySid(e.trackSid);n&&n.setAllowed(e.allowed)},this.handleSubscriptionError=e=>{const t=Array.from(this.remoteParticipants.values()).find((t=>t.trackPublications.has(e.trackSid)));if(!t)return;const n=t.getTrackPublicationBySid(e.trackSid);n&&n.setSubscriptionError(e.err)},this.handleDataPacket=e=>{const t=this.remoteParticipants.get(e.participantIdentity);if("user"===e.value.case)this.handleUserPacket(t,e.value.value,e.kind);else if("transcription"===e.value.case)this.handleTranscription(t,e.value.value);else if("sipDtmf"===e.value.case)this.handleSipDtmf(t,e.value.value);else if("chatMessage"===e.value.case)this.handleChatMessage(t,e.value.value);else if("metrics"===e.value.case)this.handleMetrics(e.value.value,t);else if("streamHeader"===e.value.case)this.handleStreamHeader(e.value.value,e.participantIdentity);else if("streamChunk"===e.value.case)this.handleStreamChunk(e.value.value);else if("streamTrailer"===e.value.case)this.handleStreamTrailer(e.value.value);else if("rpcRequest"===e.value.case){const t=e.value.value;this.handleIncomingRpcRequest(e.participantIdentity,t.id,t.method,t.payload,t.responseTimeoutMs,t.version)}},this.handleUserPacket=(e,t,n)=>{this.emit(le.DataReceived,t.payload,e,n,t.topic),null==e||e.emit(oe.DataReceived,t.payload,n)},this.handleSipDtmf=(e,t)=>{this.emit(le.SipDTMFReceived,t,e),null==e||e.emit(oe.SipDTMFReceived,t)},this.bufferedSegments=new Map,this.handleTranscription=(e,t)=>{const n=t.transcribedParticipantIdentity===this.localParticipant.identity?this.localParticipant:this.getParticipantByIdentity(t.transcribedParticipantIdentity),r=null==n?void 0:n.trackPublications.get(t.trackId),i=Uue(t,this.transcriptionReceivedTimes);null==r||r.emit(Re.TranscriptionReceived,i),null==n||n.emit(oe.TranscriptionReceived,i,r),this.emit(le.TranscriptionReceived,i,n,r)},this.handleChatMessage=(e,t)=>{const n=Fue(t);this.emit(le.ChatMessage,n,e)},this.handleMetrics=(e,t)=>{this.emit(le.MetricsReceived,e,t)},this.handleAudioPlaybackStarted=()=>{this.canPlaybackAudio||(this.audioEnabled=!0,this.emit(le.AudioPlaybackStatusChanged,!0))},this.handleAudioPlaybackFailed=e=>{this.log.warn("could not playback audio",Object.assign(Object.assign({},this.logContext),{error:e})),this.canPlaybackAudio&&(this.audioEnabled=!1,this.emit(le.AudioPlaybackStatusChanged,!1))},this.handleVideoPlaybackStarted=()=>{this.isVideoPlaybackBlocked&&(this.isVideoPlaybackBlocked=!1,this.emit(le.VideoPlaybackStatusChanged,!0))},this.handleVideoPlaybackFailed=()=>{this.isVideoPlaybackBlocked||(this.isVideoPlaybackBlocked=!0,this.emit(le.VideoPlaybackStatusChanged,!1))},this.handleDeviceChange=()=>J(this,void 0,void 0,(function*(){var e,t;const n=Mr.getInstance().previousDevices,r=yield Mr.getInstance().getDevices(void 0,!1),i=Ho();if("Chrome"===(null==i?void 0:i.name)&&"iOS"!==i.os)for(let e of r){const t=n.find((t=>t.deviceId===e.deviceId));t&&""!==t.label&&t.kind===e.kind&&t.label!==e.label&&"default"===this.getActiveDevice(e.kind)&&this.emit(le.ActiveDeviceChanged,e.kind,e.deviceId)}const o=["audiooutput","audioinput","videoinput"];for(let i of o){const o=r.filter((e=>e.kind===i)),s=this.getActiveDevice(i);s===(null===(e=n.filter((e=>e.kind===i))[0])||void 0===e?void 0:e.deviceId)&&o.length>0&&(null===(t=o[0])||void 0===t?void 0:t.deviceId)!==s?yield this.switchActiveDevice(i,o[0].deviceId):"audioinput"===i&&!uu()||"videoinput"===i||o.length>0&&!o.find((e=>e.deviceId===this.getActiveDevice(i)))&&(yield this.switchActiveDevice(i,o[0].deviceId))}this.emit(le.MediaDevicesChanged)})),this.handleRoomUpdate=e=>{const t=this.roomInfo;this.roomInfo=e,t&&t.metadata!==e.metadata&&this.emitWhenConnected(le.RoomMetadataChanged,e.metadata),(null==t?void 0:t.activeRecording)!==e.activeRecording&&this.emitWhenConnected(le.RecordingStatusChanged,e.activeRecording)},this.handleConnectionQualityUpdate=e=>{e.updates.forEach((e=>{if(e.participantSid===this.localParticipant.sid)return void this.localParticipant.setConnectionQuality(e.quality);const t=this.getRemoteParticipantBySid(e.participantSid);t&&t.setConnectionQuality(e.quality)}))},this.onLocalParticipantMetadataChanged=e=>{this.emit(le.ParticipantMetadataChanged,e,this.localParticipant)},this.onLocalParticipantNameChanged=e=>{this.emit(le.ParticipantNameChanged,e,this.localParticipant)},this.onLocalAttributesChanged=e=>{this.emit(le.ParticipantAttributesChanged,e,this.localParticipant)},this.onLocalTrackMuted=e=>{this.emit(le.TrackMuted,e,this.localParticipant)},this.onLocalTrackUnmuted=e=>{this.emit(le.TrackUnmuted,e,this.localParticipant)},this.onTrackProcessorUpdate=e=>{var t;null===(t=null==e?void 0:e.onPublish)||void 0===t||t.call(e,this)},this.onLocalTrackPublished=e=>J(this,void 0,void 0,(function*(){var t,n,r,i,o,s;null===(t=e.track)||void 0===t||t.on(Re.TrackProcessorUpdate,this.onTrackProcessorUpdate),null===(n=e.track)||void 0===n||n.on(Re.Restarted,this.onLocalTrackRestarted),null===(o=null===(i=null===(r=e.track)||void 0===r?void 0:r.getProcessor())||void 0===i?void 0:i.onPublish)||void 0===o||o.call(i,this),this.emit(le.LocalTrackPublished,e,this.localParticipant),dd(e.track)&&(yield e.track.checkForSilence())&&this.emit(le.LocalAudioSilenceDetected,e);const a=yield null===(s=e.track)||void 0===s?void 0:s.getDeviceId(!1),l=O8(e.source);l&&a&&a!==this.localParticipant.activeDeviceMap.get(l)&&(this.localParticipant.activeDeviceMap.set(l,a),this.emit(le.ActiveDeviceChanged,l,a))})),this.onLocalTrackUnpublished=e=>{var t,n;null===(t=e.track)||void 0===t||t.off(Re.TrackProcessorUpdate,this.onTrackProcessorUpdate),null===(n=e.track)||void 0===n||n.off(Re.Restarted,this.onLocalTrackRestarted),this.emit(le.LocalTrackUnpublished,e,this.localParticipant)},this.onLocalTrackRestarted=e=>J(this,void 0,void 0,(function*(){const t=yield e.getDeviceId(!1),n=O8(e.source);n&&t&&t!==this.localParticipant.activeDeviceMap.get(n)&&(this.log.debug("local track restarted, setting ".concat(n," ").concat(t," active"),this.logContext),this.localParticipant.activeDeviceMap.set(n,t),this.emit(le.ActiveDeviceChanged,n,t))})),this.onLocalConnectionQualityChanged=e=>{this.emit(le.ConnectionQualityChanged,e,this.localParticipant)},this.onMediaDevicesError=e=>{this.emit(le.MediaDevicesError,e)},this.onLocalParticipantPermissionsChanged=e=>{this.emit(le.ParticipantPermissionsChanged,e,this.localParticipant)},this.onLocalChatMessageSent=e=>{this.emit(le.ChatMessage,e,this.localParticipant)},this.setMaxListeners(100),this.remoteParticipants=new Map,this.sidToIdentity=new Map,this.options=Object.assign(Object.assign({},cde),e),this.log=Ol(null!==(n=this.options.loggerName)&&void 0!==n?n:$o.Room),this.transcriptionReceivedTimes=new Map,this.options.audioCaptureDefaults=Object.assign(Object.assign({},WV),null==e?void 0:e.audioCaptureDefaults),this.options.videoCaptureDefaults=Object.assign(Object.assign({},zV),null==e?void 0:e.videoCaptureDefaults),this.options.publishDefaults=Object.assign(Object.assign({},lde),null==e?void 0:e.publishDefaults),this.maybeCreateEngine(),this.disconnectLock=new Ei,this.localParticipant=new Fde("","",this.engine,this.options,this.rpcHandlers),this.options.videoCaptureDefaults.deviceId&&this.localParticipant.activeDeviceMap.set("videoinput",Zc(this.options.videoCaptureDefaults.deviceId)),this.options.audioCaptureDefaults.deviceId&&this.localParticipant.activeDeviceMap.set("audioinput",Zc(this.options.audioCaptureDefaults.deviceId)),!(null===(r=this.options.audioOutput)||void 0===r)&&r.deviceId&&this.switchActiveDevice("audiooutput",Zc(this.options.audioOutput.deviceId)).catch((e=>this.log.warn("Could not set audio output: ".concat(e.message),this.logContext))),this.options.e2ee&&this.setupE2EE(),Wi()){const e=new AbortController;null===(i=navigator.mediaDevices)||void 0===i||i.addEventListener("devicechange",this.handleDeviceChange,{signal:e.signal}),Al.cleanupRegistry&&Al.cleanupRegistry.register(this,(()=>{e.abort()}))}}registerTextStreamHandler(e,t){if(this.textStreamHandlers.has(e))throw new TypeError('A text stream handler for topic "'.concat(e,'" has already been set.'));this.textStreamHandlers.set(e,t)}unregisterTextStreamHandler(e){this.textStreamHandlers.delete(e)}registerByteStreamHandler(e,t){if(this.byteStreamHandlers.has(e))throw new TypeError('A byte stream handler for topic "'.concat(e,'" has already been set.'));this.byteStreamHandlers.set(e,t)}unregisterByteStreamHandler(e){this.byteStreamHandlers.delete(e)}registerRpcMethod(e,t){if(this.rpcHandlers.has(e))throw Error("RPC handler already registered for method ".concat(e,", unregisterRpcMethod before trying to register again"));this.rpcHandlers.set(e,t)}unregisterRpcMethod(e){this.rpcHandlers.delete(e)}handleIncomingRpcRequest(e,t,n,r,i,o){return J(this,void 0,void 0,(function*(){if(yield this.engine.publishRpcAck(e,t),1!==o)return void(yield this.engine.publishRpcResponse(e,t,null,Vn.builtIn("UNSUPPORTED_VERSION")));const s=this.rpcHandlers.get(n);if(!s)return void(yield this.engine.publishRpcResponse(e,t,null,Vn.builtIn("UNSUPPORTED_METHOD")));let a=null,l=null;try{const o=yield s({requestId:t,callerIdentity:e,payload:r,responseTimeout:i});SL(o)>YV?(a=Vn.builtIn("RESPONSE_PAYLOAD_TOO_LARGE"),console.warn("RPC Response payload too large for ".concat(n))):l=o}catch(e){e instanceof Vn?a=e:(console.warn("Uncaught error returned by RPC handler for ".concat(n,". Returning APPLICATION_ERROR instead."),e),a=Vn.builtIn("APPLICATION_ERROR"))}yield this.engine.publishRpcResponse(e,t,l,a)}))}setE2EEEnabled(e){return J(this,void 0,void 0,(function*(){if(!this.e2eeManager)throw Error("e2ee not configured, please set e2ee settings within the room options");yield Promise.all([this.localParticipant.setE2EEEnabled(e)]),""!==this.localParticipant.identity&&this.e2eeManager.setParticipantCryptorEnabled(e,this.localParticipant.identity)}))}setupE2EE(){var e;this.options.e2ee&&("e2eeManager"in this.options.e2ee?this.e2eeManager=this.options.e2ee.e2eeManager:this.e2eeManager=new zue(this.options.e2ee),this.e2eeManager.on(Bc.ParticipantEncryptionStatusChanged,((e,t)=>{Hue(t)&&(this.isE2EEEnabled=e),this.emit(le.ParticipantEncryptionStatusChanged,e,t)})),this.e2eeManager.on(Bc.EncryptionError,(e=>this.emit(le.EncryptionError,e))),null===(e=this.e2eeManager)||void 0===e||e.setup(this))}get logContext(){var e;return{room:this.name,roomID:null===(e=this.roomInfo)||void 0===e?void 0:e.sid,participant:this.localParticipant.identity,pID:this.localParticipant.sid}}get isRecording(){var e,t;return null!==(t=null===(e=this.roomInfo)||void 0===e?void 0:e.activeRecording)&&void 0!==t&&t}getSid(){return J(this,void 0,void 0,(function*(){return this.state===St.Disconnected?"":this.roomInfo&&""!==this.roomInfo.sid?this.roomInfo.sid:new Promise(((e,t)=>{const n=t=>{""!==t.sid&&(this.engine.off(Pe.RoomUpdate,n),e(t.sid))};this.engine.on(Pe.RoomUpdate,n),this.once(le.Disconnected,(()=>{this.engine.off(Pe.RoomUpdate,n),t("Room disconnected before room server id was available")}))}))}))}get name(){var e,t;return null!==(t=null===(e=this.roomInfo)||void 0===e?void 0:e.name)&&void 0!==t?t:""}get metadata(){var e;return null===(e=this.roomInfo)||void 0===e?void 0:e.metadata}get numParticipants(){var e,t;return null!==(t=null===(e=this.roomInfo)||void 0===e?void 0:e.numParticipants)&&void 0!==t?t:0}get numPublishers(){var e,t;return null!==(t=null===(e=this.roomInfo)||void 0===e?void 0:e.numPublishers)&&void 0!==t?t:0}maybeCreateEngine(){this.engine&&!this.engine.isClosed||(this.engine=new Tde(this.options),this.engine.on(Pe.ParticipantUpdate,this.handleParticipantUpdates).on(Pe.RoomUpdate,this.handleRoomUpdate).on(Pe.SpeakersChanged,this.handleSpeakersChanged).on(Pe.StreamStateChanged,this.handleStreamStateUpdate).on(Pe.ConnectionQualityUpdate,this.handleConnectionQualityUpdate).on(Pe.SubscriptionError,this.handleSubscriptionError).on(Pe.SubscriptionPermissionUpdate,this.handleSubscriptionPermissionUpdate).on(Pe.MediaTrackAdded,((e,t,n)=>{this.onTrackAdded(e,t,n)})).on(Pe.Disconnected,(e=>{this.handleDisconnect(this.options.stopLocalTrackOnUnpublish,e)})).on(Pe.ActiveSpeakersUpdate,this.handleActiveSpeakersUpdate).on(Pe.DataPacketReceived,this.handleDataPacket).on(Pe.Resuming,(()=>{this.clearConnectionReconcile(),this.isResuming=!0,this.log.info("Resuming signal connection",this.logContext),this.setAndEmitConnectionState(St.SignalReconnecting)&&this.emit(le.SignalReconnecting)})).on(Pe.Resumed,(()=>{this.registerConnectionReconcile(),this.isResuming=!1,this.log.info("Resumed signal connection",this.logContext),this.updateSubscriptions(),this.emitBufferedEvents(),this.setAndEmitConnectionState(St.Connected)&&this.emit(le.Reconnected)})).on(Pe.SignalResumed,(()=>{this.bufferedEvents=[],(this.state===St.Reconnecting||this.isResuming)&&this.sendSyncState()})).on(Pe.Restarting,this.handleRestarting).on(Pe.SignalRestarted,this.handleSignalRestarted).on(Pe.Offline,(()=>{this.setAndEmitConnectionState(St.Reconnecting)&&this.emit(le.Reconnecting)})).on(Pe.DCBufferStatusChanged,((e,t)=>{this.emit(le.DCBufferStatusChanged,e,t)})).on(Pe.LocalTrackSubscribed,(e=>{const t=this.localParticipant.getTrackPublications().find((t=>{let{trackSid:n}=t;return n===e}));t?(this.localParticipant.emit(oe.LocalTrackSubscribed,t),this.emitWhenConnected(le.LocalTrackSubscribed,t,this.localParticipant)):this.log.warn("could not find local track subscription for subscribed event",this.logContext)})),this.localParticipant&&this.localParticipant.setupEngine(this.engine),this.e2eeManager&&this.e2eeManager.setupEngine(this.engine))}static getLocalDevices(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return Mr.getInstance().getDevices(e,t)}prepareConnection(e,t){return J(this,void 0,void 0,(function*(){if(this.state===St.Disconnected){this.log.debug("prepareConnection to ".concat(e),this.logContext);try{if(c3(new URL(e))&&t){this.regionUrlProvider=new g3(e,t);const n=yield this.regionUrlProvider.getNextBestRegionUrl();n&&this.state===St.Disconnected&&(this.regionUrl=n,yield fetch(u3(n),{method:"HEAD"}),this.log.debug("prepared connection to ".concat(n),this.logContext))}else yield fetch(u3(e),{method:"HEAD"})}catch(e){this.log.warn("could not prepare connection",Object.assign(Object.assign({},this.logContext),{error:e}))}}}))}getParticipantByIdentity(e){return this.localParticipant.identity===e?this.localParticipant:this.remoteParticipants.get(e)}clearConnectionFutures(){this.connectFuture=void 0}simulateScenario(e,t){return J(this,void 0,void 0,(function*(){let n,r=()=>{};switch(e){case"signal-reconnect":yield this.engine.client.handleOnClose("simulate disconnect");break;case"speaker":n=new aa({scenario:{case:"speakerUpdate",value:3}});break;case"node-failure":n=new aa({scenario:{case:"nodeFailure",value:!0}});break;case"server-leave":n=new aa({scenario:{case:"serverLeave",value:!0}});break;case"migration":n=new aa({scenario:{case:"migration",value:!0}});break;case"resume-reconnect":this.engine.failNext(),yield this.engine.client.handleOnClose("simulate resume-disconnect");break;case"disconnect-signal-on-resume":r=()=>J(this,void 0,void 0,(function*(){yield this.engine.client.handleOnClose("simulate resume-disconnect")})),n=new aa({scenario:{case:"disconnectSignalOnResume",value:!0}});break;case"disconnect-signal-on-resume-no-messages":r=()=>J(this,void 0,void 0,(function*(){yield this.engine.client.handleOnClose("simulate resume-disconnect")})),n=new aa({scenario:{case:"disconnectSignalOnResumeNoMessages",value:!0}});break;case"full-reconnect":this.engine.fullReconnectOnNext=!0,yield this.engine.client.handleOnClose("simulate full-reconnect");break;case"force-tcp":case"force-tls":n=new aa({scenario:{case:"switchCandidateProtocol",value:"force-tls"===e?2:1}}),r=()=>J(this,void 0,void 0,(function*(){const e=this.engine.client.onLeave;e&&e(new BE({reason:Ao.CLIENT_INITIATED,action:Fh.RECONNECT}))}));break;case"subscriber-bandwidth":if(void 0===t||"number"!=typeof t)throw new Error("subscriber-bandwidth requires a number as argument");n=new aa({scenario:{case:"subscriberBandwidth",value:ud(t)}});break;case"leave-full-reconnect":n=new aa({scenario:{case:"leaveRequestFullReconnect",value:!0}})}n&&(yield this.engine.client.sendSimulateScenario(n),yield r())}))}get canPlaybackAudio(){return this.audioEnabled}get canPlaybackVideo(){return!this.isVideoPlaybackBlocked}getActiveDevice(e){return this.localParticipant.activeDeviceMap.get(e)}switchActiveDevice(e,t){return J(this,arguments,void 0,(function(e,t){var n=this;let r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return function*(){var i,o,s,a,l,c,u,d;let h=!0,p=!1;const f=r?{exact:t}:t;if("audioinput"===e){p=0===n.localParticipant.audioTrackPublications.size;const t=null!==(i=n.getActiveDevice(e))&&void 0!==i?i:n.options.audioCaptureDefaults.deviceId;n.options.audioCaptureDefaults.deviceId=f;const r=Array.from(n.localParticipant.audioTrackPublications.values()).filter((e=>e.source===ue.Source.Microphone));try{h=(yield Promise.all(r.map((e=>{var t;return null===(t=e.audioTrack)||void 0===t?void 0:t.setDeviceId(f)})))).every((e=>!0===e))}catch(e){throw n.options.audioCaptureDefaults.deviceId=t,e}}else if("videoinput"===e){p=0===n.localParticipant.videoTrackPublications.size;const t=null!==(o=n.getActiveDevice(e))&&void 0!==o?o:n.options.videoCaptureDefaults.deviceId;n.options.videoCaptureDefaults.deviceId=f;const r=Array.from(n.localParticipant.videoTrackPublications.values()).filter((e=>e.source===ue.Source.Camera));try{h=(yield Promise.all(r.map((e=>{var t;return null===(t=e.videoTrack)||void 0===t?void 0:t.setDeviceId(f)})))).every((e=>!0===e))}catch(e){throw n.options.videoCaptureDefaults.deviceId=t,e}}else if("audiooutput"===e){if(!l3()&&!n.options.webAudioMix||n.options.webAudioMix&&n.audioContext&&!("setSinkId"in n.audioContext))throw new Error("cannot switch audio output, setSinkId not supported");n.options.webAudioMix&&(t=null!==(s=yield Mr.getInstance().normalizeDeviceId("audiooutput",t))&&void 0!==s?s:""),null!==(a=(d=n.options).audioOutput)&&void 0!==a||(d.audioOutput={});const r=null!==(l=n.getActiveDevice(e))&&void 0!==l?l:n.options.audioOutput.deviceId;n.options.audioOutput.deviceId=t;try{n.options.webAudioMix&&(null===(c=n.audioContext)||void 0===c||c.setSinkId(t)),yield Promise.all(Array.from(n.remoteParticipants.values()).map((e=>e.setAudioOutput({deviceId:t}))))}catch(e){throw n.options.audioOutput.deviceId=r,e}}return(p||"audiooutput"===e)&&(n.localParticipant.activeDeviceMap.set(e,"audiooutput"===e&&(null===(u=n.options.audioOutput)||void 0===u?void 0:u.deviceId)||t),n.emit(le.ActiveDeviceChanged,e,t)),h}()}))}setupLocalParticipantEvents(){this.localParticipant.on(oe.ParticipantMetadataChanged,this.onLocalParticipantMetadataChanged).on(oe.ParticipantNameChanged,this.onLocalParticipantNameChanged).on(oe.AttributesChanged,this.onLocalAttributesChanged).on(oe.TrackMuted,this.onLocalTrackMuted).on(oe.TrackUnmuted,this.onLocalTrackUnmuted).on(oe.LocalTrackPublished,this.onLocalTrackPublished).on(oe.LocalTrackUnpublished,this.onLocalTrackUnpublished).on(oe.ConnectionQualityChanged,this.onLocalConnectionQualityChanged).on(oe.MediaDevicesError,this.onMediaDevicesError).on(oe.AudioStreamAcquired,this.startAudio).on(oe.ChatMessage,this.onLocalChatMessageSent).on(oe.ParticipantPermissionsChanged,this.onLocalParticipantPermissionsChanged)}recreateEngine(){var e;null===(e=this.engine)||void 0===e||e.close(),this.engine=void 0,this.isResuming=!1,this.remoteParticipants.clear(),this.sidToIdentity.clear(),this.bufferedEvents=[],this.maybeCreateEngine()}onTrackAdded(e,t,n){if(this.state===St.Connecting||this.state===St.Reconnecting){const r=()=>{this.onTrackAdded(e,t,n),i()},i=()=>{this.off(le.Reconnected,r),this.off(le.Connected,r),this.off(le.Disconnected,i)};return this.once(le.Reconnected,r),this.once(le.Connected,r),void this.once(le.Disconnected,i)}if(this.state===St.Disconnected)return void this.log.warn("skipping incoming track after Room disconnected",this.logContext);if("ended"===e.readyState)return void this.log.info("skipping incoming track as it already ended",this.logContext);const r=Iue(t.id),i=r[0];let o=r[1],s=e.id;if(o&&o.startsWith("TR")&&(s=o),i===this.localParticipant.sid)return void this.log.warn("tried to create RemoteParticipant for local participant",this.logContext);const a=Array.from(this.remoteParticipants.values()).find((e=>e.sid===i));if(!a)return void this.log.error("Tried to add a track for a participant, that's not present. Sid: ".concat(i),this.logContext);let l;this.options.adaptiveStream&&(l="object"==typeof this.options.adaptiveStream?this.options.adaptiveStream:{}),a.addSubscribedMediaTrack(e,s,t,n,l)}handleDisconnect(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=arguments.length>1?arguments[1]:void 0;var n;if(this.clearConnectionReconcile(),this.isResuming=!1,this.bufferedEvents=[],this.transcriptionReceivedTimes.clear(),this.state!==St.Disconnected){this.regionUrl=void 0;try{this.remoteParticipants.forEach((e=>{e.trackPublications.forEach((t=>{e.unpublishTrack(t.trackSid)}))})),this.localParticipant.trackPublications.forEach((t=>{var n,r,i;t.track&&this.localParticipant.unpublishTrack(t.track,e),e?(null===(n=t.track)||void 0===n||n.detach(),null===(r=t.track)||void 0===r||r.stop()):null===(i=t.track)||void 0===i||i.stopMonitor()})),this.localParticipant.off(oe.ParticipantMetadataChanged,this.onLocalParticipantMetadataChanged).off(oe.ParticipantNameChanged,this.onLocalParticipantNameChanged).off(oe.AttributesChanged,this.onLocalAttributesChanged).off(oe.TrackMuted,this.onLocalTrackMuted).off(oe.TrackUnmuted,this.onLocalTrackUnmuted).off(oe.LocalTrackPublished,this.onLocalTrackPublished).off(oe.LocalTrackUnpublished,this.onLocalTrackUnpublished).off(oe.ConnectionQualityChanged,this.onLocalConnectionQualityChanged).off(oe.MediaDevicesError,this.onMediaDevicesError).off(oe.AudioStreamAcquired,this.startAudio).off(oe.ChatMessage,this.onLocalChatMessageSent).off(oe.ParticipantPermissionsChanged,this.onLocalParticipantPermissionsChanged),this.localParticipant.trackPublications.clear(),this.localParticipant.videoTrackPublications.clear(),this.localParticipant.audioTrackPublications.clear(),this.remoteParticipants.clear(),this.sidToIdentity.clear(),this.activeSpeakers=[],this.audioContext&&"boolean"==typeof this.options.webAudioMix&&(this.audioContext.close(),this.audioContext=void 0),Wi()&&(window.removeEventListener("beforeunload",this.onPageLeave),window.removeEventListener("pagehide",this.onPageLeave),window.removeEventListener("freeze",this.onPageLeave),null===(n=navigator.mediaDevices)||void 0===n||n.removeEventListener("devicechange",this.handleDeviceChange))}finally{this.setAndEmitConnectionState(St.Disconnected),this.emit(le.Disconnected,t)}}}handleParticipantDisconnected(e,t){var n;this.remoteParticipants.delete(e),t&&(t.trackPublications.forEach((e=>{t.unpublishTrack(e.trackSid,!0)})),this.emit(le.ParticipantDisconnected,t),null===(n=this.localParticipant)||void 0===n||n.handleParticipantDisconnected(t.identity))}handleStreamHeader(e,t){return J(this,void 0,void 0,(function*(){var n;if("byteHeader"===e.contentHeader.case){const r=this.byteStreamHandlers.get(e.topic);if(!r)return void this.log.debug("ignoring incoming byte stream due to no handler for topic",e.topic);let i;const o={id:e.streamId,name:null!==(n=e.contentHeader.value.name)&&void 0!==n?n:"unknown",mimeType:e.mimeType,size:e.totalLength?Number(e.totalLength):void 0,topic:e.topic,timestamp:ib(e.timestamp),attributes:e.attributes},s=new ReadableStream({start:t=>{i=t,this.byteStreamControllers.set(e.streamId,{info:o,controller:i,startTime:Date.now()})}});r(new xde(o,s,ib(e.totalLength)),{identity:t})}else if("textHeader"===e.contentHeader.case){const n=this.textStreamHandlers.get(e.topic);if(!n)return void this.log.debug("ignoring incoming text stream due to no handler for topic",e.topic);let r;const i={id:e.streamId,mimeType:e.mimeType,size:e.totalLength?Number(e.totalLength):void 0,topic:e.topic,timestamp:Number(e.timestamp),attributes:e.attributes},o=new ReadableStream({start:t=>{r=t,this.textStreamControllers.set(e.streamId,{info:i,controller:r,startTime:Date.now()})}});n(new Pde(i,o,ib(e.totalLength)),{identity:t})}}))}handleStreamChunk(e){const t=this.byteStreamControllers.get(e.streamId);t&&e.content.length>0&&t.controller.enqueue(e);const n=this.textStreamControllers.get(e.streamId);n&&e.content.length>0&&n.controller.enqueue(e)}handleStreamTrailer(e){const t=this.textStreamControllers.get(e.streamId);t&&(t.info.attributes=Object.assign(Object.assign({},t.info.attributes),e.attributes),t.controller.close(),this.textStreamControllers.delete(e.streamId));const n=this.byteStreamControllers.get(e.streamId);n&&(n.info.attributes=Object.assign(Object.assign({},n.info.attributes),e.attributes),n.controller.close(),this.byteStreamControllers.delete(e.streamId))}acquireAudioContext(){return J(this,void 0,void 0,(function*(){var e,t;if("boolean"!=typeof this.options.webAudioMix&&this.options.webAudioMix.audioContext?this.audioContext=this.options.webAudioMix.audioContext:(!this.audioContext||"closed"===this.audioContext.state)&&(this.audioContext=null!==(e=qV())&&void 0!==e?e:void 0),this.options.webAudioMix&&this.remoteParticipants.forEach((e=>e.setAudioContext(this.audioContext))),this.localParticipant.setAudioContext(this.audioContext),this.audioContext&&"suspended"===this.audioContext.state)try{yield Promise.race([this.audioContext.resume(),Ji(200)])}catch(e){this.log.warn("Could not resume audio context",Object.assign(Object.assign({},this.logContext),{error:e}))}const n="running"===(null===(t=this.audioContext)||void 0===t?void 0:t.state);n!==this.canPlaybackAudio&&(this.audioEnabled=n,this.emit(le.AudioPlaybackStatusChanged,n))}))}createParticipant(e,t){var n;let r;return r=t?mS.fromParticipantInfo(this.engine.client,t,{loggerContextCb:()=>this.logContext,loggerName:this.options.loggerName}):new mS(this.engine.client,"",e,void 0,void 0,void 0,{loggerContextCb:()=>this.logContext,loggerName:this.options.loggerName}),this.options.webAudioMix&&r.setAudioContext(this.audioContext),!(null===(n=this.options.audioOutput)||void 0===n)&&n.deviceId&&r.setAudioOutput(this.options.audioOutput).catch((e=>this.log.warn("Could not set audio output: ".concat(e.message),this.logContext))),r}getOrCreateParticipant(e,t){if(this.remoteParticipants.has(e)){const n=this.remoteParticipants.get(e);return t&&n.updateInfo(t)&&this.sidToIdentity.set(t.sid,t.identity),n}const n=this.createParticipant(e,t);return this.remoteParticipants.set(e,n),this.sidToIdentity.set(t.sid,t.identity),this.emitWhenConnected(le.ParticipantConnected,n),n.on(oe.TrackPublished,(e=>{this.emitWhenConnected(le.TrackPublished,e,n)})).on(oe.TrackSubscribed,((e,t)=>{e.kind===ue.Kind.Audio?(e.on(Re.AudioPlaybackStarted,this.handleAudioPlaybackStarted),e.on(Re.AudioPlaybackFailed,this.handleAudioPlaybackFailed)):e.kind===ue.Kind.Video&&(e.on(Re.VideoPlaybackFailed,this.handleVideoPlaybackFailed),e.on(Re.VideoPlaybackStarted,this.handleVideoPlaybackStarted)),this.emit(le.TrackSubscribed,e,t,n)})).on(oe.TrackUnpublished,(e=>{this.emit(le.TrackUnpublished,e,n)})).on(oe.TrackUnsubscribed,((e,t)=>{this.emit(le.TrackUnsubscribed,e,t,n)})).on(oe.TrackMuted,(e=>{this.emitWhenConnected(le.TrackMuted,e,n)})).on(oe.TrackUnmuted,(e=>{this.emitWhenConnected(le.TrackUnmuted,e,n)})).on(oe.ParticipantMetadataChanged,(e=>{this.emitWhenConnected(le.ParticipantMetadataChanged,e,n)})).on(oe.ParticipantNameChanged,(e=>{this.emitWhenConnected(le.ParticipantNameChanged,e,n)})).on(oe.AttributesChanged,(e=>{this.emitWhenConnected(le.ParticipantAttributesChanged,e,n)})).on(oe.ConnectionQualityChanged,(e=>{this.emitWhenConnected(le.ConnectionQualityChanged,e,n)})).on(oe.ParticipantPermissionsChanged,(e=>{this.emitWhenConnected(le.ParticipantPermissionsChanged,e,n)})).on(oe.TrackSubscriptionStatusChanged,((e,t)=>{this.emitWhenConnected(le.TrackSubscriptionStatusChanged,e,t,n)})).on(oe.TrackSubscriptionFailed,((e,t)=>{this.emit(le.TrackSubscriptionFailed,e,n,t)})).on(oe.TrackSubscriptionPermissionChanged,((e,t)=>{this.emitWhenConnected(le.TrackSubscriptionPermissionChanged,e,t,n)})),t&&n.updateInfo(t),n}sendSyncState(){const e=Array.from(this.remoteParticipants.values()).reduce(((e,t)=>(e.push(...t.getTrackPublications()),e)),[]),t=this.localParticipant.getTrackPublications();this.engine.sendSyncState(e,t)}updateSubscriptions(){for(const e of this.remoteParticipants.values())for(const t of e.videoTrackPublications.values())t.isSubscribed&&$ue(t)&&t.emitTrackUpdate()}getRemoteParticipantBySid(e){const t=this.sidToIdentity.get(e);if(t)return this.remoteParticipants.get(t)}registerConnectionReconcile(){this.clearConnectionReconcile();let e=0;this.connectionReconcileInterval=zr.setInterval((()=>{this.engine&&!this.engine.isClosed&&this.engine.verifyTransport()?e=0:(e++,this.log.warn("detected connection state mismatch",Object.assign(Object.assign({},this.logContext),{numFailures:e,engine:this.engine?{closed:this.engine.isClosed,transportsConnected:this.engine.verifyTransport()}:void 0})),e>=3&&(this.recreateEngine(),this.handleDisconnect(this.options.stopLocalTrackOnUnpublish,Ao.STATE_MISMATCH)))}),$de)}clearConnectionReconcile(){this.connectionReconcileInterval&&zr.clearInterval(this.connectionReconcileInterval)}setAndEmitConnectionState(e){return e!==this.state&&(this.state=e,this.emit(le.ConnectionStateChanged,this.state),!0)}emitBufferedEvents(){this.bufferedEvents.forEach((e=>{let[t,n]=e;this.emit(t,...n)})),this.bufferedEvents=[]}emitWhenConnected(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];if(this.state===St.Reconnecting||this.isResuming||!this.engine||this.engine.pendingReconnect)this.bufferedEvents.push([e,n]);else if(this.state===St.Connected)return this.emit(e,...n);return!1}simulateParticipants(e){return J(this,void 0,void 0,(function*(){var t,n;const r=Object.assign({audio:!0,video:!0,useRealTracks:!1},e.publish),i=Object.assign({count:9,audio:!1,video:!0,aspectRatios:[1.66,1.7,1.3]},e.participants);if(this.handleDisconnect(),this.roomInfo=new lL({sid:"RM_SIMULATED",name:"simulated-room",emptyTimeout:0,maxParticipants:0,creationTime:kn.parse((new Date).getTime()),metadata:"",numParticipants:1,numPublishers:1,turnPassword:"",enabledCodecs:[],activeRecording:!1}),this.localParticipant.updateInfo(new Av({identity:"simulated-local",name:"local-name"})),this.setupLocalParticipantEvents(),this.emit(le.SignalConnected),this.emit(le.Connected),this.setAndEmitConnectionState(St.Connected),r.video){const e=new y3(ue.Kind.Video,new bh({source:or.CAMERA,sid:Math.floor(1e4*Math.random()).toString(),type:Lo.AUDIO,name:"video-dummy"}),new Dv(r.useRealTracks?(yield window.navigator.mediaDevices.getUserMedia({video:!0})).getVideoTracks()[0]:P8(160*(null!==(t=i.aspectRatios[0])&&void 0!==t?t:1),160,!0,!0),void 0,!1,{loggerName:this.options.loggerName,loggerContextCb:()=>this.logContext}),{loggerName:this.options.loggerName,loggerContextCb:()=>this.logContext});this.localParticipant.addTrackPublication(e),this.localParticipant.emit(oe.LocalTrackPublished,e)}if(r.audio){const e=new y3(ue.Kind.Audio,new bh({source:or.MICROPHONE,sid:Math.floor(1e4*Math.random()).toString(),type:Lo.AUDIO}),new fS(r.useRealTracks?(yield navigator.mediaDevices.getUserMedia({audio:!0})).getAudioTracks()[0]:I2(),void 0,!1,this.audioContext,{loggerName:this.options.loggerName,loggerContextCb:()=>this.logContext}),{loggerName:this.options.loggerName,loggerContextCb:()=>this.logContext});this.localParticipant.addTrackPublication(e),this.localParticipant.emit(oe.LocalTrackPublished,e)}for(let e=0;e<i.count-1;e+=1){let t=new Av({sid:Math.floor(1e4*Math.random()).toString(),identity:"simulated-".concat(e),state:Bk.ACTIVE,tracks:[],joinedAt:kn.parse(Date.now())});const r=this.getOrCreateParticipant(t.identity,t);if(i.video){const o=P8(160*(null!==(n=i.aspectRatios[e%i.aspectRatios.length])&&void 0!==n?n:1),160,!1,!0),s=new bh({source:or.CAMERA,sid:Math.floor(1e4*Math.random()).toString(),type:Lo.AUDIO});r.addSubscribedMediaTrack(o,s.sid,new MediaStream([o]),new RTCRtpReceiver),t.tracks=[...t.tracks,s]}if(i.audio){const e=I2(),n=new bh({source:or.MICROPHONE,sid:Math.floor(1e4*Math.random()).toString(),type:Lo.AUDIO});r.addSubscribedMediaTrack(e,n.sid,new MediaStream([e]),new RTCRtpReceiver),t.tracks=[...t.tracks,n]}r.updateInfo(t)}}))}emit(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];if(e!==le.ActiveSpeakersChanged&&e!==le.TranscriptionReceived){const t=tq(n).filter((e=>void 0!==e));this.log.debug("room event ".concat(e),Object.assign(Object.assign({},this.logContext),{event:e,args:t}))}return super.emit(e,...n)}}function tq(e){return e.map((e=>{if(e)return Array.isArray(e)?tq(e):"object"==typeof e?"logContext"in e?e.logContext:void 0:e}))}var To;Al.cleanupRegistry=typeof FinalizationRegistry<"u"&&new FinalizationRegistry((e=>{e()})),function(e){e[e.IDLE=0]="IDLE",e[e.RUNNING=1]="RUNNING",e[e.SKIPPED=2]="SKIPPED",e[e.SUCCESS=3]="SUCCESS",e[e.FAILED=4]="FAILED"}(To||(To={}));class Cu extends Oa.EventEmitter{constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};super(),this.status=To.IDLE,this.logs=[],this.options={},this.url=e,this.token=t,this.name=this.constructor.name,this.room=new Al(n.roomOptions),this.connectOptions=n.connectOptions,this.options=n}run(e){return J(this,void 0,void 0,(function*(){if(this.status!==To.IDLE)throw Error("check is running already");this.setStatus(To.RUNNING);try{yield this.perform()}catch(e){e instanceof Error&&(this.options.errorsAsWarnings?this.appendWarning(e.message):this.appendError(e.message))}return yield this.disconnect(),yield new Promise((e=>setTimeout(e,500))),this.status!==To.SKIPPED&&this.setStatus(this.isSuccess()?To.SUCCESS:To.FAILED),e&&e(),this.getInfo()}))}isSuccess(){return!this.logs.some((e=>"error"===e.level))}connect(e){return J(this,void 0,void 0,(function*(){return this.room.state===St.Connected||(e||(e=this.url),yield this.room.connect(e,this.token,this.connectOptions)),this.room}))}disconnect(){return J(this,void 0,void 0,(function*(){this.room&&this.room.state!==St.Disconnected&&(yield this.room.disconnect(),yield new Promise((e=>setTimeout(e,500))))}))}skip(){this.setStatus(To.SKIPPED)}switchProtocol(e){return J(this,void 0,void 0,(function*(){let t=!1,n=!1;if(this.room.on(le.Reconnecting,(()=>{t=!0})),this.room.once(le.Reconnected,(()=>{n=!0})),this.room.simulateScenario("force-".concat(e)),yield new Promise((e=>setTimeout(e,1e3))),!t)return;const r=Date.now()+1e4;for(;Date.now()<r;){if(n)return;yield Ji(100)}throw new Error("Could not reconnect using ".concat(e," protocol after 10 seconds"))}))}appendMessage(e){this.logs.push({level:"info",message:e}),this.emit("update",this.getInfo())}appendWarning(e){this.logs.push({level:"warning",message:e}),this.emit("update",this.getInfo())}appendError(e){this.logs.push({level:"error",message:e}),this.emit("update",this.getInfo())}setStatus(e){this.status=e,this.emit("update",this.getInfo())}get engine(){var e;return null===(e=this.room)||void 0===e?void 0:e.engine}getInfo(){return{logs:this.logs,name:this.name,status:this.status,description:this.description}}}class Hde extends Cu{get description(){return"Cloud regions"}perform(){return J(this,void 0,void 0,(function*(){const e=new g3(this.url,this.token);if(!e.isCloud())return void this.skip();const t=[],n=new Set;for(let r=0;r<3;r++){const r=yield e.getNextBestRegionUrl();if(!r)break;if(n.has(r))continue;n.add(r);const i=yield this.checkCloudRegion(r);this.appendMessage("".concat(i.region," RTT: ").concat(i.rtt,"ms, duration: ").concat(i.duration,"ms")),t.push(i)}t.sort(((e,t)=>.5*(e.duration-t.duration)+.5*(e.rtt-t.rtt)));const r=t[0];this.bestStats=r,this.appendMessage("best Cloud region: ".concat(r.region))}))}getInfo(){const e=super.getInfo();return e.data=this.bestStats,e}checkCloudRegion(e){return J(this,void 0,void 0,(function*(){var t,n;yield this.connect(e),"tcp"===this.options.protocol&&(yield this.switchProtocol("tcp"));const r=null===(t=this.room.serverInfo)||void 0===t?void 0:t.region;if(!r)throw new Error("Region not found");const i=yield this.room.localParticipant.streamText({topic:"test"}),o="A".repeat(1e3),s=Date.now();for(let e=0;e<1e3;e++)yield i.write(o);yield i.close();const a=Date.now(),l=yield null===(n=this.room.engine.pcManager)||void 0===n?void 0:n.publisher.getStats(),c={region:r,rtt:1e4,duration:a-s};return null==l||l.forEach((e=>{"candidate-pair"===e.type&&e.nominated&&(c.rtt=1e3*e.currentRoundTripTime)})),yield this.disconnect(),c}))}}const D2=1e4;class Bde extends Cu{get description(){return"Connection via UDP vs TCP"}perform(){return J(this,void 0,void 0,(function*(){const e=yield this.checkConnectionProtocol("udp"),t=yield this.checkConnectionProtocol("tcp");this.bestStats=e,e.qualityLimitationDurations.bandwidth-t.qualityLimitationDurations.bandwidth>.5||(e.packetsLost-t.packetsLost)/e.packetsSent>.01?(this.appendMessage("best connection quality via tcp"),this.bestStats=t):this.appendMessage("best connection quality via udp");const n=this.bestStats;this.appendMessage("upstream bitrate: ".concat((n.bitrateTotal/n.count/1e3/1e3).toFixed(2)," mbps")),this.appendMessage("RTT: ".concat((n.rttTotal/n.count*1e3).toFixed(2)," ms")),this.appendMessage("jitter: ".concat((n.jitterTotal/n.count*1e3).toFixed(2)," ms")),n.packetsLost>0&&this.appendWarning("packets lost: ".concat((n.packetsLost/n.packetsSent*100).toFixed(2),"%")),n.qualityLimitationDurations.bandwidth>1&&this.appendWarning("bandwidth limited ".concat((n.qualityLimitationDurations.bandwidth/10*100).toFixed(2),"%")),n.qualityLimitationDurations.cpu>0&&this.appendWarning("cpu limited ".concat((n.qualityLimitationDurations.cpu/10*100).toFixed(2),"%"))}))}getInfo(){const e=super.getInfo();return e.data=this.bestStats,e}checkConnectionProtocol(e){return J(this,void 0,void 0,(function*(){yield this.connect(),"tcp"===e?yield this.switchProtocol("tcp"):yield this.switchProtocol("udp");const t=document.createElement("canvas");t.width=1280,t.height=720;const n=t.getContext("2d");if(!n)throw new Error("Could not get canvas context");let r=0;const i=()=>{r=(r+1)%360,n.fillStyle="hsl(".concat(r,", 100%, 50%)"),n.fillRect(0,0,t.width,t.height),requestAnimationFrame(i)};i();const o=t.captureStream(30).getVideoTracks()[0],s=(yield this.room.localParticipant.publishTrack(o,{simulcast:!1,degradationPreference:"maintain-resolution",videoEncoding:{maxBitrate:2e6}})).track,a={protocol:e,packetsLost:0,packetsSent:0,qualityLimitationDurations:{},rttTotal:0,jitterTotal:0,bitrateTotal:0,count:0},l=setInterval((()=>J(this,void 0,void 0,(function*(){const e=yield s.getRTCStatsReport();null==e||e.forEach((e=>{"outbound-rtp"===e.type?(a.packetsSent=e.packetsSent,a.qualityLimitationDurations=e.qualityLimitationDurations,a.bitrateTotal+=e.targetBitrate,a.count++):"remote-inbound-rtp"===e.type&&(a.packetsLost=e.packetsLost,a.rttTotal+=e.roundTripTime,a.jitterTotal+=e.jitter)}))}))),1e3);return yield new Promise((e=>setTimeout(e,D2))),clearInterval(l),o.stop(),t.remove(),yield this.disconnect(),a}))}}class Vde extends Cu{get description(){return"Can publish audio"}perform(){return J(this,void 0,void 0,(function*(){var e;const t=yield this.connect(),n=yield Dde();if(yield VV(n,1e3))throw new Error("unable to detect audio from microphone");this.appendMessage("detected audio from microphone"),t.localParticipant.publishTrack(n),yield new Promise((e=>setTimeout(e,3e3)));const r=yield null===(e=n.sender)||void 0===e?void 0:e.getStats();if(!r)throw new Error("Could not get RTCStats");let i=0;if(r.forEach((e=>{"outbound-rtp"===e.type&&("audio"===e.kind||!e.kind&&"audio"===e.mediaType)&&(i=e.packetsSent)})),0===i)throw new Error("Could not determine packets are sent");this.appendMessage("published ".concat(i," audio packets"))}))}}class qde extends Cu{get description(){return"Can publish video"}perform(){return J(this,void 0,void 0,(function*(){var e;const t=yield this.connect(),n=yield Nde();yield this.checkForVideo(n.mediaStreamTrack),t.localParticipant.publishTrack(n),yield new Promise((e=>setTimeout(e,5e3)));const r=yield null===(e=n.sender)||void 0===e?void 0:e.getStats();if(!r)throw new Error("Could not get RTCStats");let i=0;if(r.forEach((e=>{"outbound-rtp"===e.type&&("video"===e.kind||!e.kind&&"video"===e.mediaType)&&(i+=e.packetsSent)})),0===i)throw new Error("Could not determine packets are sent");this.appendMessage("published ".concat(i," video packets"))}))}checkForVideo(e){return J(this,void 0,void 0,(function*(){const t=new MediaStream;t.addTrack(e.clone());const n=document.createElement("video");n.srcObject=t,n.muted=!0,yield new Promise((t=>{n.onplay=()=>{setTimeout((()=>{var r,i,o,s;const a=document.createElement("canvas"),l=e.getSettings(),c=null!==(i=null!==(r=l.width)&&void 0!==r?r:n.videoWidth)&&void 0!==i?i:1280,u=null!==(s=null!==(o=l.height)&&void 0!==o?o:n.videoHeight)&&void 0!==s?s:720;a.width=c,a.height=u;const d=a.getContext("2d");d.drawImage(n,0,0);const h=d.getImageData(0,0,a.width,a.height).data;let p=!0;for(let e=0;e<h.length;e+=4)if(0!==h[e]||0!==h[e+1]||0!==h[e+2]){p=!1;break}p?this.appendError("camera appears to be producing only black frames"):this.appendMessage("received video frames"),t()}),1e3)},n.play()})),n.remove()}))}}class Kde extends Cu{get description(){return"Resuming connection after interruption"}perform(){return J(this,void 0,void 0,(function*(){var e;const t=yield this.connect();let n,r=!1,i=!1;const o=new Promise((e=>{setTimeout(e,5e3),n=e})),s=()=>{r=!0};t.on(le.SignalReconnecting,s).on(le.Reconnecting,s).on(le.Reconnected,(()=>{i=!0,n(!0)})),null===(e=t.engine.client.ws)||void 0===e||e.close();const a=t.engine.client.onClose;if(a&&a(""),yield o,!r)throw new Error("Did not attempt to reconnect");if(!i||t.state!==St.Connected)throw this.appendWarning("reconnection is only possible in Redis-based configurations"),new Error("Not able to reconnect")}))}}class Gde extends Cu{get description(){return"Can connect via TURN"}perform(){return J(this,void 0,void 0,(function*(){var e,t;const n=new vL,r=yield n.join(this.url,this.token,{autoSubscribe:!0,maxRetries:0,e2eeEnabled:!1,websocketTimeout:15e3});let i=!1,o=!1,s=!1;for(let e of r.iceServers)for(let t of e.urls)t.startsWith("turn:")?(o=!0,s=!0):t.startsWith("turns:")&&(o=!0,s=!0,i=!0),t.startsWith("stun:")&&(s=!0);s?o&&!i&&this.appendWarning("TURN is configured server side, but TURN/TLS is unavailable."):this.appendWarning("No STUN servers configured on server side."),yield n.close(),null!==(t=null===(e=this.connectOptions)||void 0===e?void 0:e.rtcConfig)&&void 0!==t&&t.iceServers||o?yield this.room.connect(this.url,this.token,{rtcConfig:{iceTransportPolicy:"relay"}}):(this.appendWarning("No TURN servers configured."),this.skip(),yield new Promise((e=>setTimeout(e,0))))}))}}class Wde extends Cu{get description(){return"Establishing WebRTC connection"}perform(){return J(this,void 0,void 0,(function*(){let e=!1,t=!1;this.room.on(le.SignalConnected,(()=>{const n=this.room.engine.client.onTrickle;this.room.engine.client.onTrickle=(r,i)=>{if(r.candidate){const n=new RTCIceCandidate(r);let i="".concat(n.protocol," ").concat(n.address,":").concat(n.port," ").concat(n.type);n.address&&(zde(n.address)?i+=" (private)":"tcp"===n.protocol&&"passive"===n.tcpType?(e=!0,i+=" (passive)"):"udp"===n.protocol&&(t=!0)),this.appendMessage(i)}n&&n(r,i)},this.room.engine.pcManager&&(this.room.engine.pcManager.subscriber.onIceCandidateError=e=>{e instanceof RTCPeerConnectionIceErrorEvent&&this.appendWarning("error with ICE candidate: ".concat(e.errorCode," ").concat(e.errorText," ").concat(e.url))})}));try{yield this.connect(),bt.info("now the room is connected")}catch(e){throw this.appendWarning("ports need to be open on firewall in order to connect."),e}e||this.appendWarning("Server is not configured for ICE/TCP"),t||this.appendWarning("No public IPv4 UDP candidates were found. Your server is likely not configured correctly")}))}}function zde(e){const t=e.split(".");if(4===t.length){if("10"===t[0])return!0;if("192"===t[0]&&"168"===t[1])return!0;if("172"===t[0]){const e=parseInt(t[1],10);if(e>=16&&e<=31)return!0}}return!1}class Yde extends Cu{get description(){return"Connecting to signal connection via WebSocket"}perform(){return J(this,void 0,void 0,(function*(){var e,t,n;(this.url.startsWith("ws:")||this.url.startsWith("http:"))&&this.appendWarning("Server is insecure, clients may block connections to it");let r=new vL;const i=yield r.join(this.url,this.token,{autoSubscribe:!0,maxRetries:0,e2eeEnabled:!1,websocketTimeout:15e3});this.appendMessage("Connected to server, version ".concat(i.serverVersion,".")),(null===(e=i.serverInfo)||void 0===e?void 0:e.edition)===UB.Cloud&&!(null===(t=i.serverInfo)||void 0===t)&&t.region&&this.appendMessage("LiveKit Cloud: ".concat(null===(n=i.serverInfo)||void 0===n?void 0:n.region)),yield r.close()}))}}class sGe extends Oa.EventEmitter{constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};super(),this.options={},this.checkResults=new Map,this.url=e,this.token=t,this.options=n}getNextCheckId(){const e=this.checkResults.size;return this.checkResults.set(e,{logs:[],status:To.IDLE,name:"",description:""}),e}updateCheck(e,t){this.checkResults.set(e,t),this.emit("checkUpdate",e,t)}isSuccess(){return Array.from(this.checkResults.values()).every((e=>e.status!==To.FAILED))}getResults(){return Array.from(this.checkResults.values())}createAndRunCheck(e){return J(this,void 0,void 0,(function*(){const t=this.getNextCheckId(),n=new e(this.url,this.token,this.options),r=e=>{this.updateCheck(t,e)};n.on("update",r);const i=yield n.run();return n.off("update",r),i}))}checkWebsocket(){return J(this,void 0,void 0,(function*(){return this.createAndRunCheck(Yde)}))}checkWebRTC(){return J(this,void 0,void 0,(function*(){return this.createAndRunCheck(Wde)}))}checkTURN(){return J(this,void 0,void 0,(function*(){return this.createAndRunCheck(Gde)}))}checkReconnect(){return J(this,void 0,void 0,(function*(){return this.createAndRunCheck(Kde)}))}checkPublishAudio(){return J(this,void 0,void 0,(function*(){return this.createAndRunCheck(Vde)}))}checkPublishVideo(){return J(this,void 0,void 0,(function*(){return this.createAndRunCheck(qde)}))}checkConnectionProtocol(){return J(this,void 0,void 0,(function*(){const e=yield this.createAndRunCheck(Bde);if(e.data&&"protocol"in e.data){const t=e.data;this.options.protocol=t.protocol}return e}))}checkCloudRegion(){return J(this,void 0,void 0,(function*(){return this.createAndRunCheck(Hde)}))}}function CL(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};var n;const r=Cd(e)?e.mediaStreamTrack:e,i=r.getSettings();let o={facingMode:null!==(n=t.defaultFacingMode)&&void 0!==n?n:"user",confidence:"low"};if("facingMode"in i){const e=i.facingMode;bt.trace("rawFacingMode",{rawFacingMode:e}),e&&"string"==typeof e&&Zde(e)&&(o={facingMode:e,confidence:"high"})}if(["low","medium"].includes(o.confidence)){bt.trace("Try to get facing mode from device label: (".concat(r.label,")"));const e=Xde(r.label);void 0!==e&&(o=e)}return o}const Y8=new Map([["obs virtual camera",{facingMode:"environment",confidence:"medium"}]]),Jde=new Map([["iphone",{facingMode:"environment",confidence:"medium"}],["ipad",{facingMode:"environment",confidence:"medium"}]]);function Xde(e){var t;const n=e.trim().toLowerCase();if(""!==n)return Y8.has(n)?Y8.get(n):null===(t=Array.from(Jde.entries()).find((e=>{let[t]=e;return n.includes(t)})))||void 0===t?void 0:t[1]}function Zde(e){return void 0===e||["user","environment","left","right"].includes(e)}var J8,ag={};function Qde(){if(J8)return ag;J8=1,Object.defineProperty(ag,"__esModule",{value:!0}),ag.parse=function(e,t){const n=new o,r=e.length;if(r<2)return n;const i=(null==t?void 0:t.decode)||l;let c=0;do{const t=e.indexOf("=",c);if(-1===t)break;const o=e.indexOf(";",c),l=-1===o?r:o;if(t>l){c=e.lastIndexOf(";",t-1)+1;continue}const u=s(e,c,t),d=a(e,t,u),h=e.slice(u,d);if(void 0===n[h]){let r=s(e,t+1,l),o=a(e,l,r);const c=i(e.slice(r,o));n[h]=c}c=l+1}while(c<r);return n},ag.serialize=function(o,s,a){const l=(null==a?void 0:a.encode)||encodeURIComponent;if(!e.test(o))throw new TypeError(`argument name is invalid: ${o}`);const c=l(s);if(!t.test(c))throw new TypeError(`argument val is invalid: ${s}`);let u=o+"="+c;if(!a)return u;if(void 0!==a.maxAge){if(!Number.isInteger(a.maxAge))throw new TypeError(`option maxAge is invalid: ${a.maxAge}`);u+="; Max-Age="+a.maxAge}if(a.domain){if(!n.test(a.domain))throw new TypeError(`option domain is invalid: ${a.domain}`);u+="; Domain="+a.domain}if(a.path){if(!r.test(a.path))throw new TypeError(`option path is invalid: ${a.path}`);u+="; Path="+a.path}if(a.expires){if(!function(e){return"[object Date]"===i.call(e)}(a.expires)||!Number.isFinite(a.expires.valueOf()))throw new TypeError(`option expires is invalid: ${a.expires}`);u+="; Expires="+a.expires.toUTCString()}if(a.httpOnly&&(u+="; HttpOnly"),a.secure&&(u+="; Secure"),a.partitioned&&(u+="; Partitioned"),a.priority)switch("string"==typeof a.priority?a.priority.toLowerCase():void 0){case"low":u+="; Priority=Low";break;case"medium":u+="; Priority=Medium";break;case"high":u+="; Priority=High";break;default:throw new TypeError(`option priority is invalid: ${a.priority}`)}if(a.sameSite)switch("string"==typeof a.sameSite?a.sameSite.toLowerCase():a.sameSite){case!0:case"strict":u+="; SameSite=Strict";break;case"lax":u+="; SameSite=Lax";break;case"none":u+="; SameSite=None";break;default:throw new TypeError(`option sameSite is invalid: ${a.sameSite}`)}return u};const e=/^[\u0021-\u003A\u003C\u003E-\u007E]+$/,t=/^[\u0021-\u003A\u003C-\u007E]*$/,n=/^([.]?[a-z0-9]([a-z0-9-]{0,61}[a-z0-9])?)([.][a-z0-9]([a-z0-9-]{0,61}[a-z0-9])?)*$/i,r=/^[\u0020-\u003A\u003D-\u007E]*$/,i=Object.prototype.toString,o=(()=>{const e=function(){};return e.prototype=Object.create(null),e})();function s(e,t,n){do{const n=e.charCodeAt(t);if(32!==n&&9!==n)return t}while(++t<n);return n}function a(e,t,n){for(;t>n;){const n=e.charCodeAt(--t);if(32!==n&&9!==n)return t+1}return n}function l(e){if(-1===e.indexOf("%"))return e;try{return decodeURIComponent(e)}catch{return e}}return ag}Qde();var X8="popstate";function efe(e={}){return nfe((function(e,t){let{pathname:n,search:r,hash:i}=e.location;return _3("",{pathname:n,search:r,hash:i},t.state&&t.state.usr||null,t.state&&t.state.key||"default")}),(function(e,t){return"string"==typeof t?t:jv(t)}),null,e)}function Nn(e,t){if(!1===e||null===e||typeof e>"u")throw new Error(t)}function Ta(e,t){if(!e){typeof console<"u"&&console.warn(t);try{throw new Error(t)}catch{}}}function tfe(){return Math.random().toString(36).substring(2,10)}function Z8(e,t){return{usr:e.state,key:e.key,idx:t}}function _3(e,t,n=null,r){return{pathname:"string"==typeof e?e:e.pathname,search:"",hash:"",..."string"==typeof t?Np(t):t,state:n,key:t&&t.key||r||tfe()}}function jv({pathname:e="/",search:t="",hash:n=""}){return t&&"?"!==t&&(e+="?"===t.charAt(0)?t:"?"+t),n&&"#"!==n&&(e+="#"===n.charAt(0)?n:"#"+n),e}function Np(e){let t={};if(e){let n=e.indexOf("#");n>=0&&(t.hash=e.substring(n),e=e.substring(0,n));let r=e.indexOf("?");r>=0&&(t.search=e.substring(r),e=e.substring(0,r)),e&&(t.pathname=e)}return t}function nfe(e,t,n,r={}){let{window:i=document.defaultView,v5Compat:o=!1}=r,s=i.history,a="POP",l=null,c=u();function u(){return(s.state||{idx:null}).idx}function d(){a="POP";let e=u(),t=null==e?null:e-c;c=e,l&&l({action:a,location:p.location,delta:t})}function h(e){let t="null"!==i.location.origin?i.location.origin:i.location.href,n="string"==typeof e?e:jv(e);return n=n.replace(/ $/,"%20"),Nn(t,`No window.location.(origin|href) available to create URL for href: ${n}`),new URL(n,t)}null==c&&(c=0,s.replaceState({...s.state,idx:c},""));let p={get action(){return a},get location(){return e(i,s)},listen(e){if(l)throw new Error("A history only accepts one active listener");return i.addEventListener(X8,d),l=e,()=>{i.removeEventListener(X8,d),l=null}},createHref:e=>t(i,e),createURL:h,encodeLocation(e){let t=h(e);return{pathname:t.pathname,search:t.search,hash:t.hash}},push:function(e,t){a="PUSH";let n=_3(p.location,e,t);c=u()+1;let r=Z8(n,c),d=p.createHref(n);try{s.pushState(r,"",d)}catch(e){if(e instanceof DOMException&&"DataCloneError"===e.name)throw e;i.location.assign(d)}o&&l&&l({action:a,location:p.location,delta:1})},replace:function(e,t){a="REPLACE";let n=_3(p.location,e,t);c=u();let r=Z8(n,c),i=p.createHref(n);s.replaceState(r,"",i),o&&l&&l({action:a,location:p.location,delta:0})},go:e=>s.go(e)};return p}function TL(e,t,n="/"){return rfe(e,t,n,!1)}function rfe(e,t,n,r){let i=du(("string"==typeof t?Np(t):t).pathname||"/",n);if(null==i)return null;let o=nq(e);ife(o);let s=null;for(let e=0;null==s&&e<o.length;++e){let t=mfe(i);s=hfe(o[e],t,r)}return s}function nq(e,t=[],n=[],r=""){let i=(e,i,o)=>{let s={relativePath:void 0===o?e.path||"":o,caseSensitive:!0===e.caseSensitive,childrenIndex:i,route:e};s.relativePath.startsWith("/")&&(Nn(s.relativePath.startsWith(r),`Absolute route path "${s.relativePath}" nested under path "${r}" is not valid. An absolute child route path must start with the combined path of all its parent routes.`),s.relativePath=s.relativePath.slice(r.length));let a=wl([r,s.relativePath]),l=n.concat(s);e.children&&e.children.length>0&&(Nn(!0!==e.index,`Index routes must not have child routes. Please remove all child routes from route path "${a}".`),nq(e.children,t,l,a)),(null!=e.path||e.index)&&t.push({path:a,score:dfe(a,e.index),routesMeta:l})};return e.forEach(((e,t)=>{var n;if(""!==e.path&&null!=(n=e.path)&&n.includes("?"))for(let n of rq(e.path))i(e,t,n);else i(e,t)})),t}function rq(e){let t=e.split("/");if(0===t.length)return[];let[n,...r]=t,i=n.endsWith("?"),o=n.replace(/\?$/,"");if(0===r.length)return i?[o,""]:[o];let s=rq(r.join("/")),a=[];return a.push(...s.map((e=>""===e?o:[o,e].join("/")))),i&&a.push(...s),a.map((t=>e.startsWith("/")&&""===t?"/":t))}function ife(e){e.sort(((e,t)=>e.score!==t.score?t.score-e.score:ffe(e.routesMeta.map((e=>e.childrenIndex)),t.routesMeta.map((e=>e.childrenIndex)))))}var sfe=/^:[\w-]+$/,ofe=3,afe=2,lfe=1,cfe=10,ufe=-2,Q8=e=>"*"===e;function dfe(e,t){let n=e.split("/"),r=n.length;return n.some(Q8)&&(r+=ufe),t&&(r+=afe),n.filter((e=>!Q8(e))).reduce(((e,t)=>e+(sfe.test(t)?ofe:""===t?lfe:cfe)),r)}function ffe(e,t){return e.length===t.length&&e.slice(0,-1).every(((e,n)=>e===t[n]))?e[e.length-1]-t[t.length-1]:0}function hfe(e,t,n=!1){let{routesMeta:r}=e,i={},o="/",s=[];for(let e=0;e<r.length;++e){let a=r[e],l=e===r.length-1,c="/"===o?t:t.slice(o.length)||"/",u=gS({path:a.relativePath,caseSensitive:a.caseSensitive,end:l},c),d=a.route;if(!u&&l&&n&&!r[r.length-1].route.index&&(u=gS({path:a.relativePath,caseSensitive:a.caseSensitive,end:!1},c)),!u)return null;Object.assign(i,u.params),s.push({params:i,pathname:wl([o,u.pathname]),pathnameBase:_fe(wl([o,u.pathnameBase])),route:d}),"/"!==u.pathnameBase&&(o=wl([o,u.pathnameBase]))}return s}function gS(e,t){"string"==typeof e&&(e={path:e,caseSensitive:!1,end:!0});let[n,r]=pfe(e.path,e.caseSensitive,e.end),i=t.match(n);if(!i)return null;let o=i[0],s=o.replace(/(.)\/+$/,"$1"),a=i.slice(1);return{params:r.reduce(((e,{paramName:t,isOptional:n},r)=>{if("*"===t){let e=a[r]||"";s=o.slice(0,o.length-e.length).replace(/(.)\/+$/,"$1")}const i=a[r];return e[t]=n&&!i?void 0:(i||"").replace(/%2F/g,"/"),e}),{}),pathname:o,pathnameBase:s,pattern:e}}function pfe(e,t=!1,n=!0){Ta("*"===e||!e.endsWith("*")||e.endsWith("/*"),`Route path "${e}" will be treated as if it were "${e.replace(/\*$/,"/*")}" because the \`*\` character must always follow a \`/\` in the pattern. To get rid of this warning, please change the route path to "${e.replace(/\*$/,"/*")}".`);let r=[],i="^"+e.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,((e,t,n)=>(r.push({paramName:t,isOptional:null!=n}),n?"/?([^\\/]+)?":"/([^\\/]+)")));return e.endsWith("*")?(r.push({paramName:"*"}),i+="*"===e||"/*"===e?"(.*)$":"(?:\\/(.+)|\\/*)$"):n?i+="\\/*$":""!==e&&"/"!==e&&(i+="(?:(?=\\/|$))"),[new RegExp(i,t?void 0:"i"),r]}function mfe(e){try{return e.split("/").map((e=>decodeURIComponent(e).replace(/\//g,"%2F"))).join("/")}catch(t){return Ta(!1,`The URL path "${e}" could not be decoded because it is a malformed URL segment. This is probably due to a bad percent encoding (${t}).`),e}}function du(e,t){if("/"===t)return e;if(!e.toLowerCase().startsWith(t.toLowerCase()))return null;let n=t.endsWith("/")?t.length-1:t.length,r=e.charAt(n);return r&&"/"!==r?null:e.slice(n)||"/"}function gfe(e,t="/"){let{pathname:n,search:r="",hash:i=""}="string"==typeof e?Np(e):e;return{pathname:n?n.startsWith("/")?n:vfe(n,t):t,search:bfe(r),hash:Sfe(i)}}function vfe(e,t){let n=t.replace(/\/+$/,"").split("/");return e.split("/").forEach((e=>{".."===e?n.length>1&&n.pop():"."!==e&&n.push(e)})),n.length>1?n.join("/"):"/"}function j2(e,t,n,r){return`Cannot include a '${e}' character in a manually specified \`to.${t}\` field [${JSON.stringify(r)}].  Please separate it out to the \`to.${n}\` field. Alternatively you may provide the full path as a string in <Link to="..."> and the router will parse it for you.`}function yfe(e){return e.filter(((e,t)=>0===t||e.route.path&&e.route.path.length>0))}function iq(e){let t=yfe(e);return t.map(((e,n)=>n===t.length-1?e.pathname:e.pathnameBase))}function sq(e,t,n,r=!1){let i;"string"==typeof e?i=Np(e):(i={...e},Nn(!i.pathname||!i.pathname.includes("?"),j2("?","pathname","search",i)),Nn(!i.pathname||!i.pathname.includes("#"),j2("#","pathname","hash",i)),Nn(!i.search||!i.search.includes("#"),j2("#","search","hash",i)));let o,s=""===e||""===i.pathname,a=s?"/":i.pathname;if(null==a)o=n;else{let e=t.length-1;if(!r&&a.startsWith("..")){let t=a.split("/");for(;".."===t[0];)t.shift(),e-=1;i.pathname=t.join("/")}o=e>=0?t[e]:"/"}let l=gfe(i,o),c=a&&"/"!==a&&a.endsWith("/"),u=(s||"."===a)&&n.endsWith("/");return!l.pathname.endsWith("/")&&(c||u)&&(l.pathname+="/"),l}var wl=e=>e.join("/").replace(/\/\/+/g,"/"),_fe=e=>e.replace(/\/+$/,"").replace(/^\/*/,"/"),bfe=e=>e&&"?"!==e?e.startsWith("?")?e:"?"+e:"",Sfe=e=>e&&"#"!==e?e.startsWith("#")?e:"#"+e:"";function Efe(e){return null!=e&&"number"==typeof e.status&&"string"==typeof e.statusText&&"boolean"==typeof e.internal&&"data"in e}var oq=["POST","PUT","PATCH","DELETE"];new Set(oq);var wfe=["GET",...oq];new Set(wfe);var Dp=_.createContext(null);Dp.displayName="DataRouter";var GE=_.createContext(null);GE.displayName="DataRouterState";var aq=_.createContext({isTransitioning:!1});aq.displayName="ViewTransition";var Cfe=_.createContext(new Map);Cfe.displayName="Fetchers";var Tfe=_.createContext(null);Tfe.displayName="Await";var Ma=_.createContext(null);Ma.displayName="Navigation";var jp=_.createContext(null);jp.displayName="Location";var Bl=_.createContext({outlet:null,matches:[],isDataRoute:!1});Bl.displayName="Route";var RL=_.createContext(null);function lq(e,{relative:t}={}){Nn(Iy(),"useHref() may be used only in the context of a <Router> component.");let{basename:n,navigator:r}=_.useContext(Ma),{hash:i,pathname:o,search:s}=ky(e,{relative:t}),a=o;return"/"!==n&&(a="/"===o?n:wl([n,o])),r.createHref({pathname:a,search:s,hash:i})}function Iy(){return null!=_.useContext(jp)}function di(){return Nn(Iy(),"useLocation() may be used only in the context of a <Router> component."),_.useContext(jp).location}function Rfe(){return _.useContext(jp).navigationType}RL.displayName="RouteError";var cq="You should call navigate() in a React.useEffect(), not when your component is first rendered.";function uq(e){_.useContext(Ma).static||_.useLayoutEffect(e)}function Aa(){let{isDataRoute:e}=_.useContext(Bl);return e?Ffe():Ife()}function Ife(){Nn(Iy(),"useNavigate() may be used only in the context of a <Router> component.");let e=_.useContext(Dp),{basename:t,navigator:n}=_.useContext(Ma),{matches:r}=_.useContext(Bl),{pathname:i}=di(),o=JSON.stringify(iq(r)),s=_.useRef(!1);return uq((()=>{s.current=!0})),_.useCallback(((r,a={})=>{if(Ta(s.current,cq),!s.current)return;if("number"==typeof r)return void n.go(r);let l=sq(r,JSON.parse(o),i,"path"===a.relative);null==e&&"/"!==t&&(l.pathname="/"===l.pathname?t:wl([t,l.pathname])),(a.replace?n.replace:n.push)(l,a.state,a)}),[t,n,o,i,e])}function ky(e,{relative:t}={}){let{matches:n}=_.useContext(Bl),{pathname:r}=di(),i=JSON.stringify(iq(n));return _.useMemo((()=>sq(e,JSON.parse(i),r,"path"===t)),[e,i,r,t])}function kfe(e,t){return dq(e,t)}function dq(e,t,n,r){var i;Nn(Iy(),"useRoutes() may be used only in the context of a <Router> component.");let{navigator:o,static:s}=_.useContext(Ma),{matches:a}=_.useContext(Bl),l=a[a.length-1],c=l?l.params:{},u=l?l.pathname:"/",d=l?l.pathnameBase:"/",h=l&&l.route;{let e=h&&h.path||"";fq(u,!h||e.endsWith("*")||e.endsWith("*?"),`You rendered descendant <Routes> (or called \`useRoutes()\`) at "${u}" (under <Route path="${e}">) but the parent route path has no trailing "*". This means if you navigate deeper, the parent won't match anymore and therefore the child routes will never render.\n\nPlease change the parent <Route path="${e}"> to <Route path="${"/"===e?"*":`${e}/*`}">.`)}let p,f=di();if(t){let e="string"==typeof t?Np(t):t;Nn("/"===d||(null==(i=e.pathname)?void 0:i.startsWith(d)),`When overriding the location using \`<Routes location>\` or \`useRoutes(routes, location)\`, the location pathname must begin with the portion of the URL pathname that was matched by all parent routes. The current pathname base is "${d}" but pathname "${e.pathname}" was given in the \`location\` prop.`),p=e}else p=f;let m=p.pathname||"/",v=m;if("/"!==d){let e=d.replace(/^\//,"").split("/");v="/"+m.replace(/^\//,"").split("/").slice(e.length).join("/")}let g=!s&&n&&n.matches&&n.matches.length>0?n.matches:TL(e,{pathname:v});Ta(h||null!=g,`No routes matched location "${p.pathname}${p.search}${p.hash}" `),Ta(null==g||void 0!==g[g.length-1].route.element||void 0!==g[g.length-1].route.Component||void 0!==g[g.length-1].route.lazy,`Matched leaf route at location "${p.pathname}${p.search}${p.hash}" does not have an element or Component. This means it will render an <Outlet /> with a null value by default resulting in an "empty" page.`);let y=Mfe(g&&g.map((e=>Object.assign({},e,{params:Object.assign({},c,e.params),pathname:wl([d,o.encodeLocation?o.encodeLocation(e.pathname).pathname:e.pathname]),pathnameBase:"/"===e.pathnameBase?d:wl([d,o.encodeLocation?o.encodeLocation(e.pathnameBase).pathname:e.pathnameBase])}))),a,n,r);return t&&y?_.createElement(jp.Provider,{value:{location:{pathname:"/",search:"",hash:"",state:null,key:"default",...p},navigationType:"POP"}},y):y}function xfe(){let e=Ufe(),t=Efe(e)?`${e.status} ${e.statusText}`:e instanceof Error?e.message:JSON.stringify(e),n=e instanceof Error?e.stack:null,r="rgba(200,200,200, 0.5)",i={padding:"0.5rem",backgroundColor:r},o={padding:"2px 4px",backgroundColor:r},s=null;return console.error("Error handled by React Router default ErrorBoundary:",e),s=_.createElement(_.Fragment,null,_.createElement("p",null,"💿 Hey developer 👋"),_.createElement("p",null,"You can provide a way better UX than this when your app throws errors by providing your own ",_.createElement("code",{style:o},"ErrorBoundary")," or"," ",_.createElement("code",{style:o},"errorElement")," prop on your route.")),_.createElement(_.Fragment,null,_.createElement("h2",null,"Unexpected Application Error!"),_.createElement("h3",{style:{fontStyle:"italic"}},t),n?_.createElement("pre",{style:i},n):null,s)}_.createContext(null);var Pfe=_.createElement(xfe,null),Lfe=class extends _.Component{constructor(e){super(e),this.state={location:e.location,revalidation:e.revalidation,error:e.error}}static getDerivedStateFromError(e){return{error:e}}static getDerivedStateFromProps(e,t){return t.location!==e.location||"idle"!==t.revalidation&&"idle"===e.revalidation?{error:e.error,location:e.location,revalidation:e.revalidation}:{error:void 0!==e.error?e.error:t.error,location:t.location,revalidation:e.revalidation||t.revalidation}}componentDidCatch(e,t){console.error("React Router caught the following error during render",e,t)}render(){return void 0!==this.state.error?_.createElement(Bl.Provider,{value:this.props.routeContext},_.createElement(RL.Provider,{value:this.state.error,children:this.props.component})):this.props.children}};function Ofe({routeContext:e,match:t,children:n}){let r=_.useContext(Dp);return r&&r.static&&r.staticContext&&(t.route.errorElement||t.route.ErrorBoundary)&&(r.staticContext._deepestRenderedBoundaryId=t.route.id),_.createElement(Bl.Provider,{value:e},n)}function Mfe(e,t=[],n=null,r=null){if(null==e){if(!n)return null;if(n.errors)e=n.matches;else{if(0!==t.length||n.initialized||!(n.matches.length>0))return null;e=n.matches}}let i=e,o=null==n?void 0:n.errors;if(null!=o){let e=i.findIndex((e=>e.route.id&&void 0!==(null==o?void 0:o[e.route.id])));Nn(e>=0,`Could not find a matching route for errors on route IDs: ${Object.keys(o).join(",")}`),i=i.slice(0,Math.min(i.length,e+1))}let s=!1,a=-1;if(n)for(let e=0;e<i.length;e++){let t=i[e];if((t.route.HydrateFallback||t.route.hydrateFallbackElement)&&(a=e),t.route.id){let{loaderData:e,errors:r}=n,o=t.route.loader&&!e.hasOwnProperty(t.route.id)&&(!r||void 0===r[t.route.id]);if(t.route.lazy||o){s=!0,i=a>=0?i.slice(0,a+1):[i[0]];break}}}return i.reduceRight(((e,r,l)=>{let c,u=!1,d=null,h=null;n&&(c=o&&r.route.id?o[r.route.id]:void 0,d=r.route.errorElement||Pfe,s&&(a<0&&0===l?(fq("route-fallback",!1,"No `HydrateFallback` element provided to render during initial hydration"),u=!0,h=null):a===l&&(u=!0,h=r.route.hydrateFallbackElement||null)));let p=t.concat(i.slice(0,l+1)),f=()=>{let t;return t=c?d:u?h:r.route.Component?_.createElement(r.route.Component,null):r.route.element?r.route.element:e,_.createElement(Ofe,{match:r,routeContext:{outlet:e,matches:p,isDataRoute:null!=n},children:t})};return n&&(r.route.ErrorBoundary||r.route.errorElement||0===l)?_.createElement(Lfe,{location:n.location,revalidation:n.revalidation,component:d,error:c,children:f(),routeContext:{outlet:null,matches:p,isDataRoute:!0}}):f()}),null)}function IL(e){return`${e} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function Afe(e){let t=_.useContext(Dp);return Nn(t,IL(e)),t}function Nfe(e){let t=_.useContext(GE);return Nn(t,IL(e)),t}function Dfe(e){let t=_.useContext(Bl);return Nn(t,IL(e)),t}function kL(e){let t=Dfe(e),n=t.matches[t.matches.length-1];return Nn(n.route.id,`${e} can only be used on routes that contain a unique "id"`),n.route.id}function jfe(){return kL("useRouteId")}function Ufe(){var e;let t=_.useContext(RL),n=Nfe("useRouteError"),r=kL("useRouteError");return void 0!==t?t:null==(e=n.errors)?void 0:e[r]}function Ffe(){let{router:e}=Afe("useNavigate"),t=kL("useNavigate"),n=_.useRef(!1);return uq((()=>{n.current=!0})),_.useCallback((async(r,i={})=>{Ta(n.current,cq),n.current&&("number"==typeof r?e.navigate(r):await e.navigate(r,{fromRouteId:t,...i}))}),[e,t])}var e9={};function fq(e,t,n){!t&&!e9[e]&&(e9[e]=!0,Ta(!1,n))}function $fe({routes:e,future:t,state:n}){return dq(e,void 0,n,t)}function hq(e){Nn(!1,"A <Route> is only ever to be used as the child of <Routes> element, never rendered directly. Please wrap your <Route> in a <Routes>.")}function Hfe({basename:e="/",children:t=null,location:n,navigationType:r="POP",navigator:i,static:o=!1}){Nn(!Iy(),"You cannot render a <Router> inside another <Router>. You should never have more than one in your app.");let s=e.replace(/^\/*/,"/"),a=_.useMemo((()=>({basename:s,navigator:i,static:o,future:{}})),[s,i,o]);"string"==typeof n&&(n=Np(n));let{pathname:l="/",search:c="",hash:u="",state:d=null,key:h="default"}=n,p=_.useMemo((()=>{let e=du(l,s);return null==e?null:{location:{pathname:e,search:c,hash:u,state:d,key:h},navigationType:r}}),[s,l,c,u,d,h,r]);return Ta(null!=p,`<Router basename="${s}"> is not able to match the URL "${l}${c}${u}" because it does not start with the basename, so the <Router> won't render anything.`),null==p?null:_.createElement(Ma.Provider,{value:a},_.createElement(jp.Provider,{children:t,value:p}))}function Bfe({children:e,location:t}){return kfe(vS(e),t)}function vS(e,t=[]){let n=[];return _.Children.forEach(e,((e,r)=>{if(!_.isValidElement(e))return;let i=[...t,r];if(e.type===_.Fragment)return void n.push.apply(n,vS(e.props.children,i));Nn(e.type===hq,`[${"string"==typeof e.type?e.type:e.type.name}] is not a <Route> component. All component children of <Routes> must be a <Route> or <React.Fragment>`),Nn(!e.props.index||!e.props.children,"An index route cannot have child routes.");let o={id:e.props.id||i.join("-"),caseSensitive:e.props.caseSensitive,element:e.props.element,Component:e.props.Component,index:e.props.index,path:e.props.path,loader:e.props.loader,action:e.props.action,hydrateFallbackElement:e.props.hydrateFallbackElement,HydrateFallback:e.props.HydrateFallback,errorElement:e.props.errorElement,ErrorBoundary:e.props.ErrorBoundary,hasErrorBoundary:!0===e.props.hasErrorBoundary||null!=e.props.ErrorBoundary||null!=e.props.errorElement,shouldRevalidate:e.props.shouldRevalidate,handle:e.props.handle,lazy:e.props.lazy};e.props.children&&(o.children=vS(e.props.children,i)),n.push(o)})),n}_.memo($fe);var ob="get",ab="application/x-www-form-urlencoded";function WE(e){return null!=e&&"string"==typeof e.tagName}function Vfe(e){return WE(e)&&"button"===e.tagName.toLowerCase()}function qfe(e){return WE(e)&&"form"===e.tagName.toLowerCase()}function Kfe(e){return WE(e)&&"input"===e.tagName.toLowerCase()}function Gfe(e){return!!(e.metaKey||e.altKey||e.ctrlKey||e.shiftKey)}function Wfe(e,t){return!(0!==e.button||t&&"_self"!==t||Gfe(e))}var M1=null;function zfe(){if(null===M1)try{new FormData(document.createElement("form"),0),M1=!1}catch{M1=!0}return M1}var Yfe=new Set(["application/x-www-form-urlencoded","multipart/form-data","text/plain"]);function U2(e){return null==e||Yfe.has(e)?e:(Ta(!1,`"${e}" is not a valid \`encType\` for \`<Form>\`/\`<fetcher.Form>\` and will default to "${ab}"`),null)}function Jfe(e,t){let n,r,i,o,s;if(qfe(e)){let s=e.getAttribute("action");r=s?du(s,t):null,n=e.getAttribute("method")||ob,i=U2(e.getAttribute("enctype"))||ab,o=new FormData(e)}else if(Vfe(e)||Kfe(e)&&("submit"===e.type||"image"===e.type)){let s=e.form;if(null==s)throw new Error('Cannot submit a <button> or <input type="submit"> without a <form>');let a=e.getAttribute("formaction")||s.getAttribute("action");if(r=a?du(a,t):null,n=e.getAttribute("formmethod")||s.getAttribute("method")||ob,i=U2(e.getAttribute("formenctype"))||U2(s.getAttribute("enctype"))||ab,o=new FormData(s,e),!zfe()){let{name:t,type:n,value:r}=e;if("image"===n){let e=t?`${t}.`:"";o.append(`${e}x`,"0"),o.append(`${e}y`,"0")}else t&&o.append(t,r)}}else{if(WE(e))throw new Error('Cannot submit element that is not <form>, <button>, or <input type="submit|image">');n=ob,r=null,i=ab,s=e}return o&&"text/plain"===i&&(s=o,o=void 0),{action:r,method:n.toLowerCase(),encType:i,formData:o,body:s}}function xL(e,t){if(!1===e||null===e||typeof e>"u")throw new Error(t)}async function Xfe(e,t){if(e.id in t)return t[e.id];try{let n=await import(e.module);return t[e.id]=n,n}catch(t){return console.error(`Error loading route module \`${e.module}\`, reloading page...`),console.error(t),window.__reactRouterContext&&window.__reactRouterContext.isSpaMode,window.location.reload(),new Promise((()=>{}))}}function Zfe(e){return null!=e&&(null==e.href?"preload"===e.rel&&"string"==typeof e.imageSrcSet&&"string"==typeof e.imageSizes:"string"==typeof e.rel&&"string"==typeof e.href)}async function Qfe(e,t,n){return rhe((await Promise.all(e.map((async e=>{let r=t.routes[e.route.id];if(r){let e=await Xfe(r,n);return e.links?e.links():[]}return[]})))).flat(1).filter(Zfe).filter((e=>"stylesheet"===e.rel||"preload"===e.rel)).map((e=>"stylesheet"===e.rel?{...e,rel:"prefetch",as:"style"}:{...e,rel:"prefetch"})))}function t9(e,t,n,r,i,o){let s=(e,t)=>!n[t]||e.route.id!==n[t].route.id,a=(e,t)=>{var r;return n[t].pathname!==e.pathname||(null==(r=n[t].route.path)?void 0:r.endsWith("*"))&&n[t].params["*"]!==e.params["*"]};return"assets"===o?t.filter(((e,t)=>s(e,t)||a(e,t))):"data"===o?t.filter(((t,o)=>{var l;let c=r.routes[t.route.id];if(!c||!c.hasLoader)return!1;if(s(t,o)||a(t,o))return!0;if(t.route.shouldRevalidate){let r=t.route.shouldRevalidate({currentUrl:new URL(i.pathname+i.search+i.hash,window.origin),currentParams:(null==(l=n[0])?void 0:l.params)||{},nextUrl:new URL(e,window.origin),nextParams:t.params,defaultShouldRevalidate:!0});if("boolean"==typeof r)return r}return!0})):[]}function ehe(e,t,{includeHydrateFallback:n}={}){return the(e.map((e=>{let r=t.routes[e.route.id];if(!r)return[];let i=[r.module];return r.clientActionModule&&(i=i.concat(r.clientActionModule)),r.clientLoaderModule&&(i=i.concat(r.clientLoaderModule)),n&&r.hydrateFallbackModule&&(i=i.concat(r.hydrateFallbackModule)),r.imports&&(i=i.concat(r.imports)),i})).flat(1))}function the(e){return[...new Set(e)]}function nhe(e){let t={},n=Object.keys(e).sort();for(let r of n)t[r]=e[r];return t}function rhe(e,t){let n=new Set;return new Set(t),e.reduce(((e,t)=>{let r=JSON.stringify(nhe(t));return n.has(r)||(n.add(r),e.push({key:r,link:t})),e}),[])}function ihe(e){let t="string"==typeof e?new URL(e,typeof window>"u"?"server://singlefetch/":window.location.origin):e;return"/"===t.pathname?t.pathname="_root.data":t.pathname=`${t.pathname.replace(/\/$/,"")}.data`,t}function she(){let e=_.useContext(Dp);return xL(e,"You must render this element inside a <DataRouterContext.Provider> element"),e}function ohe(){let e=_.useContext(GE);return xL(e,"You must render this element inside a <DataRouterStateContext.Provider> element"),e}var PL=_.createContext(void 0);function pq(){let e=_.useContext(PL);return xL(e,"You must render this element inside a <HydratedRouter> element"),e}function ahe(e,t){let n=_.useContext(PL),[r,i]=_.useState(!1),[o,s]=_.useState(!1),{onFocus:a,onBlur:l,onMouseEnter:c,onMouseLeave:u,onTouchStart:d}=t,h=_.useRef(null);_.useEffect((()=>{if("render"===e&&s(!0),"viewport"===e){let e=new IntersectionObserver((e=>{e.forEach((e=>{s(e.isIntersecting)}))}),{threshold:.5});return h.current&&e.observe(h.current),()=>{e.disconnect()}}}),[e]),_.useEffect((()=>{if(r){let e=setTimeout((()=>{s(!0)}),100);return()=>{clearTimeout(e)}}}),[r]);let p=()=>{i(!0)},f=()=>{i(!1),s(!1)};return n?"intent"!==e?[o,h,{}]:[o,h,{onFocus:lg(a,p),onBlur:lg(l,f),onMouseEnter:lg(c,p),onMouseLeave:lg(u,f),onTouchStart:lg(d,p)}]:[!1,h,{}]}function lg(e,t){return n=>{e&&e(n),n.defaultPrevented||t(n)}}function lhe({page:e,...t}){let{router:n}=she(),r=_.useMemo((()=>TL(n.routes,e,n.basename)),[n.routes,e,n.basename]);return r?_.createElement(uhe,{page:e,matches:r,...t}):null}function che(e){let{manifest:t,routeModules:n}=pq(),[r,i]=_.useState([]);return _.useEffect((()=>{let r=!1;return Qfe(e,t,n).then((e=>{r||i(e)})),()=>{r=!0}}),[e,t,n]),r}function uhe({page:e,matches:t,...n}){let r=di(),{manifest:i,routeModules:o}=pq(),{loaderData:s,matches:a}=ohe(),l=_.useMemo((()=>t9(e,t,a,i,r,"data")),[e,t,a,i,r]),c=_.useMemo((()=>t9(e,t,a,i,r,"assets")),[e,t,a,i,r]),u=_.useMemo((()=>{if(e===r.pathname+r.search+r.hash)return[];let n=new Set,a=!1;if(t.forEach((e=>{var t;let r=i.routes[e.route.id];!r||!r.hasLoader||(!l.some((t=>t.route.id===e.route.id))&&e.route.id in s&&null!=(t=o[e.route.id])&&t.shouldRevalidate||r.hasClientLoader?a=!0:n.add(e.route.id))})),0===n.size)return[];let c=ihe(e);return a&&n.size>0&&c.searchParams.set("_routes",t.filter((e=>n.has(e.route.id))).map((e=>e.route.id)).join(",")),[c.pathname+c.search]}),[s,r,i,l,t,e,o]),d=_.useMemo((()=>ehe(c,i)),[c,i]),h=che(c);return _.createElement(_.Fragment,null,u.map((e=>_.createElement("link",{key:e,rel:"prefetch",as:"fetch",href:e,...n}))),d.map((e=>_.createElement("link",{key:e,rel:"modulepreload",href:e,...n}))),h.map((({key:e,link:t})=>_.createElement("link",{key:e,...t}))))}function dhe(...e){return t=>{e.forEach((e=>{"function"==typeof e?e(t):null!=e&&(e.current=t)}))}}PL.displayName="FrameworkContext";var mq=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";try{mq&&(window.__reactRouterVersion="7.2.0")}catch{}function fhe({basename:e,children:t,window:n}){let r=_.useRef();null==r.current&&(r.current=efe({window:n,v5Compat:!0}));let i=r.current,[o,s]=_.useState({action:i.action,location:i.location}),a=_.useCallback((e=>{_.startTransition((()=>s(e)))}),[s]);return _.useLayoutEffect((()=>i.listen(a)),[i,a]),_.createElement(Hfe,{basename:e,children:t,location:o.location,navigationType:o.action,navigator:i})}var gq=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,zE=_.forwardRef((function({onClick:e,discover:t="render",prefetch:n="none",relative:r,reloadDocument:i,replace:o,state:s,target:a,to:l,preventScrollReset:c,viewTransition:u,...d},h){let p,{basename:f}=_.useContext(Ma),m="string"==typeof l&&gq.test(l),v=!1;if("string"==typeof l&&m&&(p=l,mq))try{let e=new URL(window.location.href),t=l.startsWith("//")?new URL(e.protocol+l):new URL(l),n=du(t.pathname,f);t.origin===e.origin&&null!=n?l=n+t.search+t.hash:v=!0}catch{Ta(!1,`<Link to="${l}"> contains an invalid URL which will probably break when clicked - please update to a valid URL path.`)}let g=lq(l,{relative:r}),[y,b,w]=ahe(n,d),E=yq(l,{replace:o,state:s,target:a,preventScrollReset:c,relative:r,viewTransition:u});let S=_.createElement("a",{...d,...w,href:p||g,onClick:v||i?e:function(t){e&&e(t),t.defaultPrevented||E(t)},ref:dhe(h,b),target:a,"data-discover":m||"render"!==t?void 0:"true"});return y&&!m?_.createElement(_.Fragment,null,S,_.createElement(lhe,{page:g})):S}));zE.displayName="Link";var hhe=_.forwardRef((function({"aria-current":e="page",caseSensitive:t=!1,className:n="",end:r=!1,style:i,to:o,viewTransition:s,children:a,...l},c){let u=ky(o,{relative:l.relative}),d=di(),h=_.useContext(GE),{navigator:p,basename:f}=_.useContext(Ma),m=null!=h&&bhe(u)&&!0===s,v=p.encodeLocation?p.encodeLocation(u).pathname:u.pathname,g=d.pathname,y=h&&h.navigation&&h.navigation.location?h.navigation.location.pathname:null;t||(g=g.toLowerCase(),y=y?y.toLowerCase():null,v=v.toLowerCase()),y&&f&&(y=du(y,f)||y);const b="/"!==v&&v.endsWith("/")?v.length-1:v.length;let w,E=g===v||!r&&g.startsWith(v)&&"/"===g.charAt(b),S=null!=y&&(y===v||!r&&y.startsWith(v)&&"/"===y.charAt(v.length)),C={isActive:E,isPending:S,isTransitioning:m},k=E?e:void 0;w="function"==typeof n?n(C):[n,E?"active":null,S?"pending":null,m?"transitioning":null].filter(Boolean).join(" ");let T="function"==typeof i?i(C):i;return _.createElement(zE,{...l,"aria-current":k,className:w,ref:c,style:T,to:o,viewTransition:s},"function"==typeof a?a(C):a)}));hhe.displayName="NavLink";var phe=_.forwardRef((({discover:e="render",fetcherKey:t,navigate:n,reloadDocument:r,replace:i,state:o,method:s=ob,action:a,onSubmit:l,relative:c,preventScrollReset:u,viewTransition:d,...h},p)=>{let f=yhe(),m=_he(a,{relative:c}),v="get"===s.toLowerCase()?"get":"post",g="string"==typeof a&&gq.test(a);return _.createElement("form",{ref:p,method:v,action:m,onSubmit:r?l:e=>{if(l&&l(e),e.defaultPrevented)return;e.preventDefault();let r=e.nativeEvent.submitter,a=(null==r?void 0:r.getAttribute("formmethod"))||s;f(r||e.currentTarget,{fetcherKey:t,method:a,navigate:n,replace:i,state:o,relative:c,preventScrollReset:u,viewTransition:d})},...h,"data-discover":g||"render"!==e?void 0:"true"})}));function mhe(e){return`${e} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function vq(e){let t=_.useContext(Dp);return Nn(t,mhe(e)),t}function yq(e,{target:t,replace:n,state:r,preventScrollReset:i,relative:o,viewTransition:s}={}){let a=Aa(),l=di(),c=ky(e,{relative:o});return _.useCallback((u=>{if(Wfe(u,t)){u.preventDefault();let t=void 0!==n?n:jv(l)===jv(c);a(e,{replace:t,state:r,preventScrollReset:i,relative:o,viewTransition:s})}}),[l,a,c,n,r,t,e,i,o,s])}phe.displayName="Form";var ghe=0,vhe=()=>`__${String(++ghe)}__`;function yhe(){let{router:e}=vq("useSubmit"),{basename:t}=_.useContext(Ma),n=jfe();return _.useCallback((async(r,i={})=>{let{action:o,method:s,encType:a,formData:l,body:c}=Jfe(r,t);if(!1===i.navigate){let t=i.fetcherKey||vhe();await e.fetch(t,n,i.action||o,{preventScrollReset:i.preventScrollReset,formData:l,body:c,formMethod:i.method||s,formEncType:i.encType||a,flushSync:i.flushSync})}else await e.navigate(i.action||o,{preventScrollReset:i.preventScrollReset,formData:l,body:c,formMethod:i.method||s,formEncType:i.encType||a,replace:i.replace,state:i.state,fromRouteId:n,flushSync:i.flushSync,viewTransition:i.viewTransition})}),[e,t,n])}function _he(e,{relative:t}={}){let{basename:n}=_.useContext(Ma),r=_.useContext(Bl);Nn(r,"useFormAction must be used inside a RouteContext");let[i]=r.matches.slice(-1),o={...ky(e||".",{relative:t})},s=di();if(null==e){o.search=s.search;let e=new URLSearchParams(o.search),t=e.getAll("index");if(t.some((e=>""===e))){e.delete("index"),t.filter((e=>e)).forEach((t=>e.append("index",t)));let n=e.toString();o.search=n?`?${n}`:""}}return(!e||"."===e)&&i.route.index&&(o.search=o.search?o.search.replace(/^\?/,"?index&"):"?index"),"/"!==n&&(o.pathname="/"===o.pathname?n:wl([n,o.pathname])),jv(o)}function bhe(e,t={}){let n=_.useContext(aq);Nn(null!=n,"`useViewTransitionState` must be used within `react-router-dom`'s `RouterProvider`.  Did you accidentally import `RouterProvider` from `react-router`?");let{basename:r}=vq("useViewTransitionState"),i=ky(e,{relative:t.relative});if(!n.isTransitioning)return!1;let o=du(n.currentLocation.pathname,r)||n.currentLocation.pathname,s=du(n.nextLocation.pathname,r)||n.nextLocation.pathname;return null!=gS(i.pathname,s)||null!=gS(i.pathname,o)}new TextEncoder;var Up=uB();const _q=Ko(Up),pt=typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__,Td="8.55.0",Ft=globalThis;function YE(e,t,n){const r=n||Ft,i=r.__SENTRY__=r.__SENTRY__||{},o=i[Td]=i[Td]||{};return o[e]||(o[e]=t())}const Tu=typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__,She="Sentry Logger ",b3=["debug","info","warn","error","log","assert","trace"],yS={};function Zd(e){if(!("console"in Ft))return e();const t=Ft.console,n={},r=Object.keys(yS);r.forEach((e=>{const r=yS[e];n[e]=t[e],t[e]=r}));try{return e()}finally{r.forEach((e=>{t[e]=n[e]}))}}function Ehe(){let e=!1;const t={enable:()=>{e=!0},disable:()=>{e=!1},isEnabled:()=>e};return Tu?b3.forEach((n=>{t[n]=(...t)=>{e&&Zd((()=>{Ft.console[n](`${She}[${n}]:`,...t)}))}})):b3.forEach((e=>{t[e]=()=>{}})),t}const Me=YE("logger",Ehe),bq=50,Dd="?",n9=/\(error: (.*)\)/,r9=/captureMessage|captureException/;function Sq(...e){const t=e.sort(((e,t)=>e[0]-t[0])).map((e=>e[1]));return(e,n=0,r=0)=>{const i=[],o=e.split("\n");for(let e=n;e<o.length;e++){const n=o[e];if(n.length>1024)continue;const s=n9.test(n)?n.replace(n9,"$1"):n;if(!s.match(/\S*Error: /)){for(const e of t){const t=e(s);if(t){i.push(t);break}}if(i.length>=50+r)break}}return Che(i.slice(r))}}function whe(e){return Array.isArray(e)?Sq(...e):e}function Che(e){if(!e.length)return[];const t=Array.from(e);return/sentryWrapped/.test(A1(t).function||"")&&t.pop(),t.reverse(),r9.test(A1(t).function||"")&&(t.pop(),r9.test(A1(t).function||"")&&t.pop()),t.slice(0,50).map((e=>({...e,filename:e.filename||A1(t).filename,function:e.function||Dd})))}function A1(e){return e[e.length-1]||{}}const F2="<anonymous>";function Nl(e){try{return e&&"function"==typeof e&&e.name||F2}catch{return F2}}function i9(e){const t=e.exception;if(t){const e=[];try{return t.values.forEach((t=>{t.stacktrace.frames&&e.push(...t.stacktrace.frames)})),e}catch{return}}}const lb={},s9={};function Ru(e,t){lb[e]=lb[e]||[],lb[e].push(t)}function Iu(e,t){if(!s9[e]){s9[e]=!0;try{t()}catch(t){Tu&&Me.error(`Error while instrumenting ${e}`,t)}}}function Ks(e,t){const n=e&&lb[e];if(n)for(const r of n)try{r(t)}catch(t){Tu&&Me.error(`Error while triggering instrumentation handler.\nType: ${e}\nName: ${Nl(r)}\nError:`,t)}}let $2=null;function Eq(e){const t="error";Ru(t,e),Iu(t,The)}function The(){$2=Ft.onerror,Ft.onerror=function(e,t,n,r,i){return Ks("error",{column:r,error:i,line:n,msg:e,url:t}),!!$2&&$2.apply(this,arguments)},Ft.onerror.__SENTRY_INSTRUMENTED__=!0}let H2=null;function wq(e){const t="unhandledrejection";Ru(t,e),Iu(t,Rhe)}function Rhe(){H2=Ft.onunhandledrejection,Ft.onunhandledrejection=function(e){return Ks("unhandledrejection",e),!H2||H2.apply(this,arguments)},Ft.onunhandledrejection.__SENTRY_INSTRUMENTED__=!0}function Qd(){return LL(Ft),Ft}function LL(e){const t=e.__SENTRY__=e.__SENTRY__||{};return t.version=t.version||Td,t[Td]=t[Td]||{}}const Cq=Object.prototype.toString;function JE(e){switch(Cq.call(e)){case"[object Error]":case"[object Exception]":case"[object DOMException]":case"[object WebAssembly.Exception]":return!0;default:return Dl(e,Error)}}function Fp(e,t){return Cq.call(e)===`[object ${t}]`}function Tq(e){return Fp(e,"ErrorEvent")}function o9(e){return Fp(e,"DOMError")}function Ihe(e){return Fp(e,"DOMException")}function Cl(e){return Fp(e,"String")}function OL(e){return"object"==typeof e&&null!==e&&"__sentry_template_string__"in e&&"__sentry_template_values__"in e}function ML(e){return null===e||OL(e)||"object"!=typeof e&&"function"!=typeof e}function hp(e){return Fp(e,"Object")}function XE(e){return typeof Event<"u"&&Dl(e,Event)}function khe(e){return typeof Element<"u"&&Dl(e,Element)}function xhe(e){return Fp(e,"RegExp")}function ZE(e){return!(!e||!e.then||"function"!=typeof e.then)}function Phe(e){return hp(e)&&"nativeEvent"in e&&"preventDefault"in e&&"stopPropagation"in e}function Dl(e,t){try{return e instanceof t}catch{return!1}}function Rq(e){return!("object"!=typeof e||null===e||!e.__isVue&&!e._isVue)}const Vh=Ft,Lhe=80;function jd(e,t={}){if(!e)return"<unknown>";try{let n=e;const r=5,i=[];let o=0,s=0;const a=" > ",l=a.length;let c;const u=Array.isArray(t)?t:t.keyAttrs,d=!Array.isArray(t)&&t.maxStringLength||80;for(;n&&o++<r&&(c=Ohe(n,u),!("html"===c||o>1&&s+i.length*l+c.length>=d));)i.push(c),s+=c.length,n=n.parentNode;return i.reverse().join(a)}catch{return"<unknown>"}}function Ohe(e,t){const n=e,r=[];if(!n||!n.tagName)return"";if(Vh.HTMLElement&&n instanceof HTMLElement&&n.dataset){if(n.dataset.sentryComponent)return n.dataset.sentryComponent;if(n.dataset.sentryElement)return n.dataset.sentryElement}r.push(n.tagName.toLowerCase());const i=t&&t.length?t.filter((e=>n.getAttribute(e))).map((e=>[e,n.getAttribute(e)])):null;if(i&&i.length)i.forEach((e=>{r.push(`[${e[0]}="${e[1]}"]`)}));else{n.id&&r.push(`#${n.id}`);const e=n.className;if(e&&Cl(e)){const t=e.split(/\s+/);for(const e of t)r.push(`.${e}`)}}const o=["aria-label","type","name","title","alt"];for(const e of o){const t=n.getAttribute(e);t&&r.push(`[${e}="${t}"]`)}return r.join("")}function Mhe(){try{return Vh.document.location.href}catch{return""}}function Ahe(e){return Vh.document&&Vh.document.querySelector?Vh.document.querySelector(e):null}function Iq(e){if(!Vh.HTMLElement)return null;let t=e;for(let e=0;e<5;e++){if(!t)return null;if(t instanceof HTMLElement){if(t.dataset.sentryComponent)return t.dataset.sentryComponent;if(t.dataset.sentryElement)return t.dataset.sentryElement}t=t.parentNode}return null}function qh(e,t=0){return"string"!=typeof e||0===t||e.length<=t?e:`${e.slice(0,t)}...`}function a9(e,t){if(!Array.isArray(e))return"";const n=[];for(let t=0;t<e.length;t++){const r=e[t];try{Rq(r)?n.push("[VueViewModel]"):n.push(String(r))}catch{n.push("[value cannot be serialized]")}}return n.join(t)}function Nhe(e,t,n=!1){return!!Cl(e)&&(xhe(t)?t.test(e):!!Cl(t)&&(n?e===t:e.includes(t)))}function Rd(e,t=[],n=!1){return t.some((t=>Nhe(e,t,n)))}function ys(e,t,n){if(!(t in e))return;const r=e[t],i=n(r);"function"==typeof i&&kq(i,r);try{e[t]=i}catch{Tu&&Me.log(`Failed to replace method "${t}" in object`,e)}}function Xs(e,t,n){try{Object.defineProperty(e,t,{value:n,writable:!0,configurable:!0})}catch{Tu&&Me.log(`Failed to add non-enumerable property "${t}" to object`,e)}}function kq(e,t){try{const n=t.prototype||{};e.prototype=t.prototype=n,Xs(e,"__sentry_original__",t)}catch{}}function AL(e){return e.__sentry_original__}function xq(e){if(JE(e))return{message:e.message,name:e.name,stack:e.stack,...c9(e)};if(XE(e)){const t={type:e.type,target:l9(e.target),currentTarget:l9(e.currentTarget),...c9(e)};return typeof CustomEvent<"u"&&Dl(e,CustomEvent)&&(t.detail=e.detail),t}return e}function l9(e){try{return khe(e)?jd(e):Object.prototype.toString.call(e)}catch{return"<unknown>"}}function c9(e){if("object"==typeof e&&null!==e){const t={};for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t}return{}}function Dhe(e,t=40){const n=Object.keys(xq(e));n.sort();const r=n[0];if(!r)return"[object has no keys]";if(r.length>=t)return qh(r,t);for(let e=n.length;e>0;e--){const r=n.slice(0,e).join(", ");if(!(r.length>t))return e===n.length?r:qh(r,t)}return""}function Yr(e){return S3(e,new Map)}function S3(e,t){if(jhe(e)){const n=t.get(e);if(void 0!==n)return n;const r={};t.set(e,r);for(const n of Object.getOwnPropertyNames(e))typeof e[n]<"u"&&(r[n]=S3(e[n],t));return r}if(Array.isArray(e)){const n=t.get(e);if(void 0!==n)return n;const r=[];return t.set(e,r),e.forEach((e=>{r.push(S3(e,t))})),r}return e}function jhe(e){if(!hp(e))return!1;try{const t=Object.getPrototypeOf(e).constructor.name;return!t||"Object"===t}catch{return!0}}const Pq=1e3;function xy(){return Date.now()/Pq}function Uhe(){const{performance:e}=Ft;if(!e||!e.now)return xy;const t=Date.now()-e.now(),n=null==e.timeOrigin?t:e.timeOrigin;return()=>(n+e.now())/Pq}const Ti=Uhe(),es=(()=>{const{performance:e}=Ft;if(!e||!e.now)return;const t=36e5,n=e.now(),r=Date.now(),i=e.timeOrigin?Math.abs(e.timeOrigin+n-r):t,o=i<t,s=e.timing&&e.timing.navigationStart,a="number"==typeof s?Math.abs(s+n-r):t;return o||a<t?i<=a?e.timeOrigin:s:r})();function Gs(){const e=Ft,t=e.crypto||e.msCrypto;let n=()=>16*Math.random();try{if(t&&t.randomUUID)return t.randomUUID().replace(/-/g,"");t&&t.getRandomValues&&(n=()=>{const e=new Uint8Array(1);return t.getRandomValues(e),e[0]})}catch{}return"10000000100040008000100000000000".replace(/[018]/g,(e=>(e^(15&n())>>e/4).toString(16)))}function Lq(e){return e.exception&&e.exception.values?e.exception.values[0]:void 0}function Mc(e){const{message:t,event_id:n}=e;if(t)return t;const r=Lq(e);return r?r.type&&r.value?`${r.type}: ${r.value}`:r.type||r.value||n||"<unknown>":n||"<unknown>"}function E3(e,t,n){const r=e.exception=e.exception||{},i=r.values=r.values||[],o=i[0]=i[0]||{};o.value||(o.value=t||""),o.type||(o.type="Error")}function pp(e,t){const n=Lq(e);if(!n)return;const r=n.mechanism;if(n.mechanism={type:"generic",handled:!0,...r,...t},t&&"data"in t){const e={...r&&r.data,...t.data};n.mechanism.data=e}}function u9(e){if(Fhe(e))return!0;try{Xs(e,"__sentry_captured__",!0)}catch{}return!1}function Fhe(e){try{return e.__sentry_captured__}catch{}}var il;function Ud(e){return new Ns((t=>{t(e)}))}function _S(e){return new Ns(((t,n)=>{n(e)}))}!function(e){e[e.PENDING=0]="PENDING";e[e.RESOLVED=1]="RESOLVED";e[e.REJECTED=2]="REJECTED"}(il||(il={}));class Ns{constructor(e){Ns.prototype.__init.call(this),Ns.prototype.__init2.call(this),Ns.prototype.__init3.call(this),Ns.prototype.__init4.call(this),this._state=il.PENDING,this._handlers=[];try{e(this._resolve,this._reject)}catch(e){this._reject(e)}}then(e,t){return new Ns(((n,r)=>{this._handlers.push([!1,t=>{if(e)try{n(e(t))}catch(e){r(e)}else n(t)},e=>{if(t)try{n(t(e))}catch(e){r(e)}else r(e)}]),this._executeHandlers()}))}catch(e){return this.then((e=>e),e)}finally(e){return new Ns(((t,n)=>{let r,i;return this.then((t=>{i=!1,r=t,e&&e()}),(t=>{i=!0,r=t,e&&e()})).then((()=>{i?n(r):t(r)}))}))}__init(){this._resolve=e=>{this._setResult(il.RESOLVED,e)}}__init2(){this._reject=e=>{this._setResult(il.REJECTED,e)}}__init3(){this._setResult=(e,t)=>{if(this._state===il.PENDING){if(ZE(t))return void t.then(this._resolve,this._reject);this._state=e,this._value=t,this._executeHandlers()}}}__init4(){this._executeHandlers=()=>{if(this._state===il.PENDING)return;const e=this._handlers.slice();this._handlers=[],e.forEach((e=>{e[0]||(this._state===il.RESOLVED&&e[1](this._value),this._state===il.REJECTED&&e[2](this._value),e[0]=!0)}))}}}function $he(e){const t=Ti(),n={sid:Gs(),init:!0,timestamp:t,started:t,duration:0,status:"ok",errors:0,ignoreDuration:!1,toJSON:()=>Bhe(n)};return e&&mp(n,e),n}function mp(e,t={}){if(t.user&&(!e.ipAddress&&t.user.ip_address&&(e.ipAddress=t.user.ip_address),!e.did&&!t.did&&(e.did=t.user.id||t.user.email||t.user.username)),e.timestamp=t.timestamp||Ti(),t.abnormal_mechanism&&(e.abnormal_mechanism=t.abnormal_mechanism),t.ignoreDuration&&(e.ignoreDuration=t.ignoreDuration),t.sid&&(e.sid=32===t.sid.length?t.sid:Gs()),void 0!==t.init&&(e.init=t.init),!e.did&&t.did&&(e.did=`${t.did}`),"number"==typeof t.started&&(e.started=t.started),e.ignoreDuration)e.duration=void 0;else if("number"==typeof t.duration)e.duration=t.duration;else{const t=e.timestamp-e.started;e.duration=t>=0?t:0}t.release&&(e.release=t.release),t.environment&&(e.environment=t.environment),!e.ipAddress&&t.ipAddress&&(e.ipAddress=t.ipAddress),!e.userAgent&&t.userAgent&&(e.userAgent=t.userAgent),"number"==typeof t.errors&&(e.errors=t.errors),t.status&&(e.status=t.status)}function Hhe(e,t){let n={};"ok"===e.status&&(n={status:"exited"}),mp(e,n)}function Bhe(e){return Yr({sid:`${e.sid}`,init:e.init,started:new Date(1e3*e.started).toISOString(),timestamp:new Date(1e3*e.timestamp).toISOString(),status:e.status,errors:e.errors,did:"number"==typeof e.did||"string"==typeof e.did?`${e.did}`:void 0,duration:e.duration,abnormal_mechanism:e.abnormal_mechanism,attrs:{release:e.release,environment:e.environment,ip_address:e.ipAddress,user_agent:e.userAgent}})}function fu(){return Gs()}function hu(){return Gs().substring(16)}function QE(e,t,n=2){if(!t||"object"!=typeof t||n<=0)return t;if(e&&t&&0===Object.keys(t).length)return e;const r={...e};for(const e in t)Object.prototype.hasOwnProperty.call(t,e)&&(r[e]=QE(r[e],t[e],n-1));return r}const w3="_sentrySpan";function Uv(e,t){t?Xs(e,w3,t):delete e[w3]}function bS(e){return e[w3]}const Vhe=100;class NL{constructor(){this._notifyingListeners=!1,this._scopeListeners=[],this._eventProcessors=[],this._breadcrumbs=[],this._attachments=[],this._user={},this._tags={},this._extra={},this._contexts={},this._sdkProcessingMetadata={},this._propagationContext={traceId:fu(),spanId:hu()}}clone(){const e=new NL;return e._breadcrumbs=[...this._breadcrumbs],e._tags={...this._tags},e._extra={...this._extra},e._contexts={...this._contexts},this._contexts.flags&&(e._contexts.flags={values:[...this._contexts.flags.values]}),e._user=this._user,e._level=this._level,e._session=this._session,e._transactionName=this._transactionName,e._fingerprint=this._fingerprint,e._eventProcessors=[...this._eventProcessors],e._requestSession=this._requestSession,e._attachments=[...this._attachments],e._sdkProcessingMetadata={...this._sdkProcessingMetadata},e._propagationContext={...this._propagationContext},e._client=this._client,e._lastEventId=this._lastEventId,Uv(e,bS(this)),e}setClient(e){this._client=e}setLastEventId(e){this._lastEventId=e}getClient(){return this._client}lastEventId(){return this._lastEventId}addScopeListener(e){this._scopeListeners.push(e)}addEventProcessor(e){return this._eventProcessors.push(e),this}setUser(e){return this._user=e||{email:void 0,id:void 0,ip_address:void 0,username:void 0},this._session&&mp(this._session,{user:e}),this._notifyScopeListeners(),this}getUser(){return this._user}getRequestSession(){return this._requestSession}setRequestSession(e){return this._requestSession=e,this}setTags(e){return this._tags={...this._tags,...e},this._notifyScopeListeners(),this}setTag(e,t){return this._tags={...this._tags,[e]:t},this._notifyScopeListeners(),this}setExtras(e){return this._extra={...this._extra,...e},this._notifyScopeListeners(),this}setExtra(e,t){return this._extra={...this._extra,[e]:t},this._notifyScopeListeners(),this}setFingerprint(e){return this._fingerprint=e,this._notifyScopeListeners(),this}setLevel(e){return this._level=e,this._notifyScopeListeners(),this}setTransactionName(e){return this._transactionName=e,this._notifyScopeListeners(),this}setContext(e,t){return null===t?delete this._contexts[e]:this._contexts[e]=t,this._notifyScopeListeners(),this}setSession(e){return e?this._session=e:delete this._session,this._notifyScopeListeners(),this}getSession(){return this._session}update(e){if(!e)return this;const t="function"==typeof e?e(this):e,[n,r]=t instanceof pu?[t.getScopeData(),t.getRequestSession()]:hp(t)?[e,e.requestSession]:[],{tags:i,extra:o,user:s,contexts:a,level:l,fingerprint:c=[],propagationContext:u}=n||{};return this._tags={...this._tags,...i},this._extra={...this._extra,...o},this._contexts={...this._contexts,...a},s&&Object.keys(s).length&&(this._user=s),l&&(this._level=l),c.length&&(this._fingerprint=c),u&&(this._propagationContext=u),r&&(this._requestSession=r),this}clear(){return this._breadcrumbs=[],this._tags={},this._extra={},this._user={},this._contexts={},this._level=void 0,this._transactionName=void 0,this._fingerprint=void 0,this._requestSession=void 0,this._session=void 0,Uv(this,void 0),this._attachments=[],this.setPropagationContext({traceId:fu()}),this._notifyScopeListeners(),this}addBreadcrumb(e,t){const n="number"==typeof t?t:100;if(n<=0)return this;const r={timestamp:xy(),...e};return this._breadcrumbs.push(r),this._breadcrumbs.length>n&&(this._breadcrumbs=this._breadcrumbs.slice(-n),this._client&&this._client.recordDroppedEvent("buffer_overflow","log_item")),this._notifyScopeListeners(),this}getLastBreadcrumb(){return this._breadcrumbs[this._breadcrumbs.length-1]}clearBreadcrumbs(){return this._breadcrumbs=[],this._notifyScopeListeners(),this}addAttachment(e){return this._attachments.push(e),this}clearAttachments(){return this._attachments=[],this}getScopeData(){return{breadcrumbs:this._breadcrumbs,attachments:this._attachments,contexts:this._contexts,tags:this._tags,extra:this._extra,user:this._user,level:this._level,fingerprint:this._fingerprint||[],eventProcessors:this._eventProcessors,propagationContext:this._propagationContext,sdkProcessingMetadata:this._sdkProcessingMetadata,transactionName:this._transactionName,span:bS(this)}}setSDKProcessingMetadata(e){return this._sdkProcessingMetadata=QE(this._sdkProcessingMetadata,e,2),this}setPropagationContext(e){return this._propagationContext={spanId:hu(),...e},this}getPropagationContext(){return this._propagationContext}captureException(e,t){const n=t&&t.event_id?t.event_id:Gs();if(!this._client)return Me.warn("No client configured on scope - will not capture exception!"),n;const r=new Error("Sentry syntheticException");return this._client.captureException(e,{originalException:e,syntheticException:r,...t,event_id:n},this),n}captureMessage(e,t,n){const r=n&&n.event_id?n.event_id:Gs();if(!this._client)return Me.warn("No client configured on scope - will not capture message!"),r;const i=new Error(e);return this._client.captureMessage(e,t,{originalException:e,syntheticException:i,...n,event_id:r},this),r}captureEvent(e,t){const n=t&&t.event_id?t.event_id:Gs();return this._client?(this._client.captureEvent(e,{...t,event_id:n},this),n):(Me.warn("No client configured on scope - will not capture event!"),n)}_notifyScopeListeners(){this._notifyingListeners||(this._notifyingListeners=!0,this._scopeListeners.forEach((e=>{e(this)})),this._notifyingListeners=!1)}}const pu=NL;function qhe(){return YE("defaultCurrentScope",(()=>new pu))}function Khe(){return YE("defaultIsolationScope",(()=>new pu))}class Ghe{constructor(e,t){let n,r;n=e||new pu,r=t||new pu,this._stack=[{scope:n}],this._isolationScope=r}withScope(e){const t=this._pushScope();let n;try{n=e(t)}catch(e){throw this._popScope(),e}return ZE(n)?n.then((e=>(this._popScope(),e)),(e=>{throw this._popScope(),e})):(this._popScope(),n)}getClient(){return this.getStackTop().client}getScope(){return this.getStackTop().scope}getIsolationScope(){return this._isolationScope}getStackTop(){return this._stack[this._stack.length-1]}_pushScope(){const e=this.getScope().clone();return this._stack.push({client:this.getClient(),scope:e}),e}_popScope(){return!(this._stack.length<=1)&&!!this._stack.pop()}}function gp(){const e=LL(Qd());return e.stack=e.stack||new Ghe(qhe(),Khe())}function Whe(e){return gp().withScope(e)}function zhe(e,t){const n=gp();return n.withScope((()=>(n.getStackTop().scope=e,t(e))))}function d9(e){return gp().withScope((()=>e(gp().getIsolationScope())))}function Yhe(){return{withIsolationScope:d9,withScope:Whe,withSetScope:zhe,withSetIsolationScope:(e,t)=>d9(t),getCurrentScope:()=>gp().getScope(),getIsolationScope:()=>gp().getIsolationScope()}}function $p(e){const t=LL(e);return t.acs?t.acs:Yhe()}function an(){return $p(Qd()).getCurrentScope()}function Na(){return $p(Qd()).getIsolationScope()}function Jhe(){return YE("globalScope",(()=>new pu))}function ew(...e){const t=$p(Qd());if(2===e.length){const[n,r]=e;return n?t.withSetScope(n,r):t.withScope(r)}return t.withScope(e[0])}function qt(){return an().getClient()}function Xhe(e){const t=e.getPropagationContext(),{traceId:n,spanId:r,parentSpanId:i}=t;return Yr({trace_id:n,span_id:r,parent_span_id:i})}const Zhe="_sentryMetrics";function C3(e){const t=e[Zhe];if(!t)return;const n={};for(const[,[e,r]]of t)(n[e]||(n[e]=[])).push(Yr(r));return n}const Bs="sentry.source",Oq="sentry.sample_rate",jl="sentry.op",lr="sentry.origin",T3="sentry.idle_span_finish_reason",tw="sentry.measurement_unit",nw="sentry.measurement_value",f9="sentry.custom_span_name",Qhe="sentry.profile_id",DL="sentry.exclusive_time",epe=0,Mq=1,Ir=2;function tpe(e){if(e<400&&e>=100)return{code:1};if(e>=400&&e<500)switch(e){case 401:return{code:2,message:"unauthenticated"};case 403:return{code:2,message:"permission_denied"};case 404:return{code:2,message:"not_found"};case 409:return{code:2,message:"already_exists"};case 413:return{code:2,message:"failed_precondition"};case 429:return{code:2,message:"resource_exhausted"};case 499:return{code:2,message:"cancelled"};default:return{code:2,message:"invalid_argument"}}if(e>=500&&e<600)switch(e){case 501:return{code:2,message:"unimplemented"};case 503:return{code:2,message:"unavailable"};case 504:return{code:2,message:"deadline_exceeded"};default:return{code:2,message:"internal_error"}}return{code:2,message:"unknown_error"}}function Aq(e,t){e.setAttribute("http.response.status_code",t);const n=tpe(t);"unknown_error"!==n.message&&e.setStatus(n)}const jL="sentry-",npe=/^sentry-/,rpe=8192;function Nq(e){const t=spe(e);if(!t)return;const n=Object.entries(t).reduce(((e,[t,n])=>{if(t.match(npe)){e[t.slice(7)]=n}return e}),{});return Object.keys(n).length>0?n:void 0}function ipe(e){if(!e)return;return ope(Object.entries(e).reduce(((e,[t,n])=>(n&&(e[`${jL}${t}`]=n),e)),{}))}function spe(e){if(e&&(Cl(e)||Array.isArray(e)))return Array.isArray(e)?e.reduce(((e,t)=>{const n=h9(t);return Object.entries(n).forEach((([t,n])=>{e[t]=n})),e}),{}):h9(e)}function h9(e){return e.split(",").map((e=>e.split("=").map((e=>decodeURIComponent(e.trim()))))).reduce(((e,[t,n])=>(t&&n&&(e[t]=n),e)),{})}function ope(e){if(0!==Object.keys(e).length)return Object.entries(e).reduce(((e,[t,n],r)=>{const i=`${encodeURIComponent(t)}=${encodeURIComponent(n)}`,o=0===r?i:`${e},${i}`;return o.length>rpe?(Tu&&Me.warn(`Not adding key: ${t} with val: ${n} to baggage header due to exceeding baggage size limits.`),e):o}),"")}const Dq=new RegExp("^[ \\t]*([0-9a-f]{32})?-?([0-9a-f]{16})?-?([01])?[ \\t]*$");function ape(e){if(!e)return;const t=e.match(Dq);if(!t)return;let n;return"1"===t[3]?n=!0:"0"===t[3]&&(n=!1),{traceId:t[1],parentSampled:n,parentSpanId:t[2]}}function lpe(e,t){const n=ape(e),r=Nq(t);if(!n||!n.traceId)return{traceId:fu(),spanId:hu()};const{traceId:i,parentSpanId:o,parentSampled:s}=n;return{traceId:i,parentSpanId:o,spanId:hu(),sampled:s,dsc:r||{}}}function jq(e=fu(),t=hu(),n){let r="";return void 0!==n&&(r=n?"-1":"-0"),`${e}-${t}${r}`}const Uq=0,Fq=1;let p9=!1;function cpe(e){const{spanId:t,traceId:n}=e.spanContext(),{data:r,op:i,parent_span_id:o,status:s,origin:a}=Vt(e);return Yr({parent_span_id:o,span_id:t,trace_id:n,data:r,op:i,status:s,origin:a})}function upe(e){const{spanId:t,traceId:n,isRemote:r}=e.spanContext();return Yr({parent_span_id:r?t:Vt(e).parent_span_id,span_id:r?hu():t,trace_id:n})}function dpe(e){const{traceId:t,spanId:n}=e.spanContext();return jq(t,n,ef(e))}function Id(e){return"number"==typeof e?m9(e):Array.isArray(e)?e[0]+e[1]/1e9:e instanceof Date?m9(e.getTime()):Ti()}function m9(e){return e>9999999999?e/1e3:e}function Vt(e){if(hpe(e))return e.getSpanJSON();try{const{spanId:t,traceId:n}=e.spanContext();if(fpe(e)){const{attributes:r,startTime:i,name:o,endTime:s,parentSpanId:a,status:l}=e;return Yr({span_id:t,trace_id:n,data:r,description:o,parent_span_id:a,start_timestamp:Id(i),timestamp:Id(s)||void 0,status:$q(l),op:r[jl],origin:r[lr],_metrics_summary:C3(e)})}return{span_id:t,trace_id:n}}catch{return{}}}function fpe(e){const t=e;return!!(t.attributes&&t.startTime&&t.name&&t.endTime&&t.status)}function hpe(e){return"function"==typeof e.getSpanJSON}function ef(e){const{traceFlags:t}=e.spanContext();return 1===t}function $q(e){if(e&&0!==e.code)return 1===e.code?"ok":e.message||"unknown_error"}const kd="_sentryChildSpans",R3="_sentryRootSpan";function Hq(e,t){const n=e[R3]||e;Xs(t,R3,n),e[kd]?e[kd].add(t):Xs(e,kd,new Set([t]))}function ppe(e,t){e[kd]&&e[kd].delete(t)}function cb(e){const t=new Set;return function e(n){if(!t.has(n)&&ef(n)){t.add(n);const r=n[kd]?Array.from(n[kd]):[];for(const t of r)e(t)}}(e),Array.from(t)}function Xr(e){return e[R3]||e}function Zr(){const e=$p(Qd());return e.getActiveSpan?e.getActiveSpan():bS(an())}function Bq(){p9||(Zd((()=>{console.warn("[Sentry] Deprecation warning: Returning null from `beforeSendSpan` will be disallowed from SDK version 9.0.0 onwards. The callback will only support mutating spans. To drop certain spans, configure the respective integrations directly.")})),p9=!0)}let g9=!1;function mpe(){g9||(g9=!0,Eq(I3),wq(I3))}function I3(){const e=Zr(),t=e&&Xr(e);if(t){const e="internal_error";pt&&Me.log(`[Tracing] Root span: ${e} -> Global error occurred`),t.setStatus({code:2,message:e})}}I3.tag="sentry_tracingErrorCallback";const Vq="_sentryScope",qq="_sentryIsolationScope";function gpe(e,t,n){e&&(Xs(e,qq,n),Xs(e,Vq,t))}function v9(e){return{scope:e[Vq],isolationScope:e[qq]}}function mu(e){if("boolean"==typeof __SENTRY_TRACING__&&!__SENTRY_TRACING__)return!1;const t=qt(),n=e||t&&t.getOptions();return!!n&&(n.enableTracing||"tracesSampleRate"in n||"tracesSampler"in n)}class Hp{constructor(e={}){this._traceId=e.traceId||fu(),this._spanId=e.spanId||hu()}spanContext(){return{spanId:this._spanId,traceId:this._traceId,traceFlags:0}}end(e){}setAttribute(e,t){return this}setAttributes(e){return this}setStatus(e){return this}updateName(e){return this}isRecording(){return!1}addEvent(e,t,n){return this}addLink(e){return this}addLinks(e){return this}recordException(e,t){}}const UL="production",Kq="_frozenDsc";function y9(e,t){Xs(e,Kq,t)}function Gq(e,t){const n=t.getOptions(),{publicKey:r}=t.getDsn()||{},i=Yr({environment:n.environment||UL,release:n.release,public_key:r,trace_id:e});return t.emit("createDsc",i),i}function Wq(e,t){const n=t.getPropagationContext();return n.dsc||Gq(n.traceId,e)}function Bp(e){const t=qt();if(!t)return{};const n=Xr(e),r=n[Kq];if(r)return r;const i=n.spanContext().traceState,o=i&&i.get("sentry.dsc"),s=o&&Nq(o);if(s)return s;const a=Gq(e.spanContext().traceId,t),l=Vt(n),c=l.data||{},u=c[Oq];null!=u&&(a.sample_rate=`${u}`);const d=c[Bs],h=l.description;return"url"!==d&&h&&(a.transaction=h),mu()&&(a.sampled=String(ef(n))),t.emit("createDsc",a,n),a}function vpe(e){if(!pt)return;const{description:t="< unknown name >",op:n="< unknown op >",parent_span_id:r}=Vt(e),{spanId:i}=e.spanContext(),o=ef(e),s=Xr(e),a=s===e,l=`[Tracing] Starting ${o?"sampled":"unsampled"} ${a?"root ":""}span`,c=[`op: ${n}`,`name: ${t}`,`ID: ${i}`];if(r&&c.push(`parent ID: ${r}`),!a){const{op:e,description:t}=Vt(s);c.push(`root ID: ${s.spanContext().spanId}`),e&&c.push(`root op: ${e}`),t&&c.push(`root description: ${t}`)}Me.log(`${l}\n  ${c.join("\n  ")}`)}function ype(e){if(!pt)return;const{description:t="< unknown name >",op:n="< unknown op >"}=Vt(e),{spanId:r}=e.spanContext(),i=`[Tracing] Finishing "${n}" ${Xr(e)===e?"root ":""}span "${t}" with ID ${r}`;Me.log(i)}function zq(e){if("boolean"==typeof e)return Number(e);const t="string"==typeof e?parseFloat(e):e;if(!("number"!=typeof t||isNaN(t)||t<0||t>1))return t;pt&&Me.warn(`[Tracing] Given sample rate is invalid. Sample rate must be a boolean or a number between 0 and 1. Got ${JSON.stringify(e)} of type ${JSON.stringify(typeof e)}.`)}function _pe(e,t){if(!mu(e))return[!1];const n=Na().getScopeData().sdkProcessingMetadata.normalizedRequest,r={...t,normalizedRequest:t.normalizedRequest||n};let i;i="function"==typeof e.tracesSampler?e.tracesSampler(r):void 0!==r.parentSampled?r.parentSampled:typeof e.tracesSampleRate<"u"?e.tracesSampleRate:1;const o=zq(i);return void 0===o?(pt&&Me.warn("[Tracing] Discarding transaction because of invalid sample rate."),[!1]):o?Math.random()<o?[!0,o]:(pt&&Me.log(`[Tracing] Discarding transaction because it's not included in the random sample (sampling rate = ${Number(i)})`),[!1,o]):(pt&&Me.log("[Tracing] Discarding transaction because "+("function"==typeof e.tracesSampler?"tracesSampler returned 0 or false":"a negative sampling decision was inherited or tracesSampleRate is set to 0")),[!1,o])}const bpe=/^(?:(\w+):)\/\/(?:(\w+)(?::(\w+)?)?@)([\w.-]+)(?::(\d+))?\/(.+)/;function Spe(e){return"http"===e||"https"===e}function Vp(e,t=!1){const{host:n,path:r,pass:i,port:o,projectId:s,protocol:a,publicKey:l}=e;return`${a}://${l}${t&&i?`:${i}`:""}@${n}${o?`:${o}`:""}/${r&&`${r}/`}${s}`}function Epe(e){const t=bpe.exec(e);if(!t)return void Zd((()=>{console.error(`Invalid Sentry Dsn: ${e}`)}));const[n,r,i="",o="",s="",a=""]=t.slice(1);let l="",c=a;const u=c.split("/");if(u.length>1&&(l=u.slice(0,-1).join("/"),c=u.pop()),c){const e=c.match(/^\d+/);e&&(c=e[0])}return Yq({host:o,pass:i,path:l,projectId:c,port:s,protocol:n,publicKey:r})}function Yq(e){return{protocol:e.protocol,publicKey:e.publicKey||"",pass:e.pass||"",host:e.host,port:e.port||"",path:e.path||"",projectId:e.projectId}}function wpe(e){if(!Tu)return!0;const{port:t,projectId:n,protocol:r}=e;return!["protocol","publicKey","host","projectId"].find((t=>!e[t]&&(Me.error(`Invalid Sentry Dsn: ${t} missing`),!0)))&&(n.match(/^\d+$/)?Spe(r)?!t||!isNaN(parseInt(t,10))||(Me.error(`Invalid Sentry Dsn: Invalid port ${t}`),!1):(Me.error(`Invalid Sentry Dsn: Invalid protocol ${r}`),!1):(Me.error(`Invalid Sentry Dsn: Invalid projectId ${n}`),!1))}function Jq(e){const t="string"==typeof e?Epe(e):Yq(e);if(t&&wpe(t))return t}function Cpe(){const e="function"==typeof WeakSet,t=e?new WeakSet:[];return[function(n){if(e)return!!t.has(n)||(t.add(n),!1);for(let e=0;e<t.length;e++)if(t[e]===n)return!0;return t.push(n),!1},function(n){if(e)t.delete(n);else for(let e=0;e<t.length;e++)if(t[e]===n){t.splice(e,1);break}}]}function sl(e,t=100,n=1/0){try{return k3("",e,t,n)}catch(e){return{ERROR:`**non-serializable** (${e})`}}}function Xq(e,t=3,n=102400){const r=sl(e,t);return kpe(r)>n?Xq(e,t-1,n):r}function k3(e,t,n=1/0,r=1/0,i=Cpe()){const[o,s]=i;if(null==t||["boolean","string"].includes(typeof t)||"number"==typeof t&&Number.isFinite(t))return t;const a=Tpe(e,t);if(!a.startsWith("[object "))return a;if(t.__sentry_skip_normalization__)return t;const l="number"==typeof t.__sentry_override_normalization_depth__?t.__sentry_override_normalization_depth__:n;if(0===l)return a.replace("object ","");if(o(t))return"[Circular ~]";const c=t;if(c&&"function"==typeof c.toJSON)try{return k3("",c.toJSON(),l-1,r,i)}catch{}const u=Array.isArray(t)?[]:{};let d=0;const h=xq(t);for(const e in h){if(!Object.prototype.hasOwnProperty.call(h,e))continue;if(d>=r){u[e]="[MaxProperties ~]";break}const t=h[e];u[e]=k3(e,t,l-1,r,i),d++}return s(t),u}function Tpe(e,t){try{if("domain"===e&&t&&"object"==typeof t&&t._events)return"[Domain]";if("domainEmitter"===e)return"[DomainEmitter]";if(typeof global<"u"&&t===global)return"[Global]";if(typeof window<"u"&&t===window)return"[Window]";if(typeof document<"u"&&t===document)return"[Document]";if(Rq(t))return"[VueViewModel]";if(Phe(t))return"[SyntheticEvent]";if("number"==typeof t&&!Number.isFinite(t))return`[${t}]`;if("function"==typeof t)return`[Function: ${Nl(t)}]`;if("symbol"==typeof t)return`[${String(t)}]`;if("bigint"==typeof t)return`[BigInt: ${String(t)}]`;const n=Rpe(t);return/^HTML(\w*)Element$/.test(n)?`[HTMLElement: ${n}]`:`[object ${n}]`}catch(e){return`**non-serializable** (${e})`}}function Rpe(e){const t=Object.getPrototypeOf(e);return t?t.constructor.name:"null prototype"}function Ipe(e){return~-encodeURI(e).split(/%..|./).length}function kpe(e){return Ipe(JSON.stringify(e))}function qp(e,t=[]){return[e,t]}function xpe(e,t){const[n,r]=e;return[n,[...r,t]]}function _9(e,t){const n=e[1];for(const e of n){if(t(e,e[0].type))return!0}return!1}function x3(e){return Ft.__SENTRY__&&Ft.__SENTRY__.encodePolyfill?Ft.__SENTRY__.encodePolyfill(e):(new TextEncoder).encode(e)}function Ppe(e){const[t,n]=e;let r=JSON.stringify(t);function i(e){"string"==typeof r?r="string"==typeof e?r+e:[x3(r),e]:r.push("string"==typeof e?x3(e):e)}for(const e of n){const[t,n]=e;if(i(`\n${JSON.stringify(t)}\n`),"string"==typeof n||n instanceof Uint8Array)i(n);else{let e;try{e=JSON.stringify(n)}catch{e=JSON.stringify(sl(n))}i(e)}}return"string"==typeof r?r:Lpe(r)}function Lpe(e){const t=e.reduce(((e,t)=>e+t.length),0),n=new Uint8Array(t);let r=0;for(const t of e)n.set(t,r),r+=t.length;return n}function Ope(e){return[{type:"span"},e]}function Mpe(e){const t="string"==typeof e.data?x3(e.data):e.data;return[Yr({type:"attachment",length:t.length,filename:e.filename,content_type:e.contentType,attachment_type:e.attachmentType}),t]}const Ape={session:"session",sessions:"session",attachment:"attachment",transaction:"transaction",event:"error",client_report:"internal",user_report:"default",profile:"profile",profile_chunk:"profile",replay_event:"replay",replay_recording:"replay",check_in:"monitor",feedback:"feedback",span:"span",statsd:"metric_bucket",raw_security:"security"};function b9(e){return Ape[e]}function Zq(e){if(!e||!e.sdk)return;const{name:t,version:n}=e.sdk;return{name:t,version:n}}function Npe(e,t,n,r){const i=e.sdkProcessingMetadata&&e.sdkProcessingMetadata.dynamicSamplingContext;return{event_id:e.event_id,sent_at:(new Date).toISOString(),...t&&{sdk:t},...!!n&&r&&{dsn:Vp(r)},...i&&{trace:Yr({...i})}}}function Dpe(e,t){return t&&(e.sdk=e.sdk||{},e.sdk.name=e.sdk.name||t.name,e.sdk.version=e.sdk.version||t.version,e.sdk.integrations=[...e.sdk.integrations||[],...t.integrations||[]],e.sdk.packages=[...e.sdk.packages||[],...t.packages||[]]),e}function jpe(e,t,n,r){const i=Zq(n);return qp({sent_at:(new Date).toISOString(),...i&&{sdk:i},...!!r&&t&&{dsn:Vp(t)}},["aggregates"in e?[{type:"sessions"},e]:[{type:"session"},e.toJSON()]])}function Upe(e,t,n,r){const i=Zq(n),o=e.type&&"replay_event"!==e.type?e.type:"event";Dpe(e,n&&n.sdk);const s=Npe(e,i,r,t);return delete e.sdkProcessingMetadata,qp(s,[[{type:o},e]])}function Fpe(e,t){const n=Bp(e[0]),r=t&&t.getDsn(),i=t&&t.getOptions().tunnel,o={sent_at:(new Date).toISOString(),...(c=n,!!c.trace_id&&!!c.public_key&&{trace:n}),...!!i&&r&&{dsn:Vp(r)}},s=t&&t.getOptions().beforeSendSpan,a=s?e=>{const t=s(Vt(e));return t||Bq(),t}:e=>Vt(e),l=[];var c;for(const t of e){const e=a(t);e&&l.push(Ope(e))}return qp(o,l)}function $pe(e,t,n,r=Zr()){const i=r&&Xr(r);i&&(pt&&Me.log(`[Measurement] Setting measurement on root span: ${e} = ${t} ${n}`),i.addEvent(e,{[nw]:t,[tw]:n}))}function S9(e){if(!e||0===e.length)return;const t={};return e.forEach((e=>{const n=e.attributes||{},r=n[tw],i=n[nw];"string"==typeof r&&"number"==typeof i&&(t[e.name]={value:i,unit:r})})),t}const E9=1e3;class FL{constructor(e={}){this._traceId=e.traceId||fu(),this._spanId=e.spanId||hu(),this._startTime=e.startTimestamp||Ti(),this._attributes={},this.setAttributes({[lr]:"manual",[jl]:e.op,...e.attributes}),this._name=e.name,e.parentSpanId&&(this._parentSpanId=e.parentSpanId),"sampled"in e&&(this._sampled=e.sampled),e.endTimestamp&&(this._endTime=e.endTimestamp),this._events=[],this._isStandaloneSpan=e.isStandalone,this._endTime&&this._onSpanEnded()}addLink(e){return this}addLinks(e){return this}recordException(e,t){}spanContext(){const{_spanId:e,_traceId:t,_sampled:n}=this;return{spanId:e,traceId:t,traceFlags:n?1:0}}setAttribute(e,t){return void 0===t?delete this._attributes[e]:this._attributes[e]=t,this}setAttributes(e){return Object.keys(e).forEach((t=>this.setAttribute(t,e[t]))),this}updateStartTime(e){this._startTime=Id(e)}setStatus(e){return this._status=e,this}updateName(e){return this._name=e,this.setAttribute(Bs,"custom"),this}end(e){this._endTime||(this._endTime=Id(e),ype(this),this._onSpanEnded())}getSpanJSON(){return Yr({data:this._attributes,description:this._name,op:this._attributes[jl],parent_span_id:this._parentSpanId,span_id:this._spanId,start_timestamp:this._startTime,status:$q(this._status),timestamp:this._endTime,trace_id:this._traceId,origin:this._attributes[lr],_metrics_summary:C3(this),profile_id:this._attributes[Qhe],exclusive_time:this._attributes[DL],measurements:S9(this._events),is_segment:this._isStandaloneSpan&&Xr(this)===this||void 0,segment_id:this._isStandaloneSpan?Xr(this).spanContext().spanId:void 0})}isRecording(){return!this._endTime&&!!this._sampled}addEvent(e,t,n){pt&&Me.log("[Tracing] Adding an event to span:",e);const r=w9(t)?t:n||Ti(),i=w9(t)?{}:t||{},o={name:e,time:Id(r),attributes:i};return this._events.push(o),this}isStandaloneSpan(){return!!this._isStandaloneSpan}_onSpanEnded(){const e=qt();if(e&&e.emit("spanEnd",this),!this._isStandaloneSpan&&this!==Xr(this))return;if(this._isStandaloneSpan)return void(this._sampled?Bpe(Fpe([this],e)):(pt&&Me.log("[Tracing] Discarding standalone span because its trace was not chosen to be sampled."),e&&e.recordDroppedEvent("sample_rate","span")));const t=this._convertSpanToTransaction();t&&(v9(this).scope||an()).captureEvent(t)}_convertSpanToTransaction(){if(!C9(Vt(this)))return;this._name||(pt&&Me.warn("Transaction has no name, falling back to `<unlabeled transaction>`."),this._name="<unlabeled transaction>");const{scope:e,isolationScope:t}=v9(this),n=(e||an()).getClient()||qt();if(!0!==this._sampled)return pt&&Me.log("[Tracing] Discarding transaction because its trace was not chosen to be sampled."),void(n&&n.recordDroppedEvent("sample_rate","transaction"));const r=cb(this).filter((e=>e!==this&&!Hpe(e))).map((e=>Vt(e))).filter(C9),i=this._attributes[Bs];delete this._attributes[f9],r.forEach((e=>{e.data&&delete e.data[f9]}));const o={contexts:{trace:cpe(this)},spans:r.length>E9?r.sort(((e,t)=>e.start_timestamp-t.start_timestamp)).slice(0,E9):r,start_timestamp:this._startTime,timestamp:this._endTime,transaction:this._name,type:"transaction",sdkProcessingMetadata:{capturedSpanScope:e,capturedSpanIsolationScope:t,...Yr({dynamicSamplingContext:Bp(this)})},_metrics_summary:C3(this),...i&&{transaction_info:{source:i}}},s=S9(this._events);return s&&Object.keys(s).length&&(pt&&Me.log("[Measurements] Adding measurements to transaction event",JSON.stringify(s,void 0,2)),o.measurements=s),o}}function w9(e){return e&&"number"==typeof e||e instanceof Date||Array.isArray(e)}function C9(e){return!!(e.start_timestamp&&e.timestamp&&e.span_id&&e.trace_id)}function Hpe(e){return e instanceof FL&&e.isStandaloneSpan()}function Bpe(e){const t=qt();if(!t)return;const n=e[1];n&&0!==n.length?t.sendEnvelope(e):t.recordDroppedEvent("before_send","span")}const Qq="__SENTRY_SUPPRESS_TRACING__";function Py(e){const t=tK();if(t.startInactiveSpan)return t.startInactiveSpan(e);const n=qpe(e),{forceTransaction:r,parentSpan:i}=e;return(e.scope?t=>ew(e.scope,t):void 0!==i?e=>eK(i,e):e=>e())((()=>{const t=an(),i=Gpe(t);return e.onlyIfParent&&!i?new Hp:Vpe({parentSpan:i,spanArguments:n,forceTransaction:r,scope:t})}))}function eK(e,t){const n=tK();return n.withActiveSpan?n.withActiveSpan(e,t):ew((n=>(Uv(n,e||void 0),t(n))))}function Vpe({parentSpan:e,spanArguments:t,forceTransaction:n,scope:r}){if(!mu())return new Hp;const i=Na();let o;if(e&&!n)o=Kpe(e,r,t),Hq(e,o);else if(e){const n=Bp(e),{traceId:i,spanId:s}=e.spanContext(),a=ef(e);o=T9({traceId:i,parentSpanId:s,...t},r,a),y9(o,n)}else{const{traceId:e,dsc:n,parentSpanId:s,sampled:a}={...i.getPropagationContext(),...r.getPropagationContext()};o=T9({traceId:e,parentSpanId:s,...t},r,a),n&&y9(o,n)}return vpe(o),gpe(o,r,i),o}function qpe(e){const t={isStandalone:(e.experimental||{}).standalone,...e};if(e.startTime){const n={...t};return n.startTimestamp=Id(e.startTime),delete n.startTime,n}return t}function tK(){return $p(Qd())}function T9(e,t,n){const r=qt(),i=r&&r.getOptions()||{},{name:o="",attributes:s}=e,[a,l]=t.getScopeData().sdkProcessingMetadata[Qq]?[!1]:_pe(i,{name:o,parentSampled:n,attributes:s,transactionContext:{name:o,parentSampled:n}}),c=new FL({...e,attributes:{[Bs]:"custom",...e.attributes},sampled:a});return void 0!==l&&c.setAttribute(Oq,l),r&&r.emit("spanStart",c),c}function Kpe(e,t,n){const{spanId:r,traceId:i}=e.spanContext(),o=!t.getScopeData().sdkProcessingMetadata[Qq]&&ef(e),s=o?new FL({...n,parentSpanId:r,traceId:i,sampled:o}):new Hp({traceId:i});Hq(e,s);const a=qt();return a&&(a.emit("spanStart",s),n.endTimestamp&&a.emit("spanEnd",s)),s}function Gpe(e){const t=bS(e);if(!t)return;const n=qt();return(n?n.getOptions():{}).parentSpanIsAlwaysRootSpan?Xr(t):t}const ub={idleTimeout:1e3,finalTimeout:3e4,childSpanTimeout:15e3},Wpe="heartbeatFailed",zpe="idleTimeout",Ype="finalTimeout",Jpe="externalFinish";function nK(e,t={}){const n=new Map;let r,i=!1,o=Jpe,s=!t.disableAutoFinish;const a=[],{idleTimeout:l=ub.idleTimeout,finalTimeout:c=ub.finalTimeout,childSpanTimeout:u=ub.childSpanTimeout,beforeSpanEnd:d}=t,h=qt();if(!h||!mu())return new Hp;const p=an(),f=Zr(),m=Xpe(e);function v(){r&&(clearTimeout(r),r=void 0)}function g(e){v(),r=setTimeout((()=>{!i&&0===n.size&&s&&(o=zpe,m.end(e))}),l)}function y(e){r=setTimeout((()=>{!i&&s&&(o=Wpe,m.end(e))}),u)}function b(e){i=!0,n.clear(),a.forEach((e=>e())),Uv(p,f);const t=Vt(m),{start_timestamp:r}=t;if(!r)return;(t.data||{})[T3]||m.setAttribute(T3,o),Me.log(`[Tracing] Idle span "${t.op}" finished`);const s=cb(m).filter((e=>e!==m));let u=0;s.forEach((t=>{t.isRecording()&&(t.setStatus({code:2,message:"cancelled"}),t.end(e),pt&&Me.log("[Tracing] Cancelling span since span ended early",JSON.stringify(t,void 0,2)));const n=Vt(t),{timestamp:r=0,start_timestamp:i=0}=n,o=i<=e,s=r-i<=(c+l)/1e3;if(pt){const e=JSON.stringify(t,void 0,2);o?s||Me.log("[Tracing] Discarding span since it finished after idle span final timeout",e):Me.log("[Tracing] Discarding span since it happened after idle span was finished",e)}(!s||!o)&&(ppe(m,t),u++)})),u>0&&m.setAttribute("sentry.idle_span_discarded_spans",u)}return m.end=new Proxy(m.end,{apply(e,t,n){d&&d(m);const[r,...i]=n,o=Id(r||Ti()),s=cb(m).filter((e=>e!==m));if(!s.length)return b(o),Reflect.apply(e,t,[o,...i]);const a=s.map((e=>Vt(e).timestamp)).filter((e=>!!e)),l=a.length?Math.max(...a):void 0,u=Vt(m).start_timestamp,h=Math.min(u?u+c/1e3:1/0,Math.max(u||-1/0,Math.min(o,l||1/0)));return b(h),Reflect.apply(e,t,[h,...i])}}),a.push(h.on("spanStart",(e=>{i||e===m||Vt(e).timestamp||cb(m).includes(e)&&function(e){v(),n.set(e,!0),y(Ti()+u/1e3)}(e.spanContext().spanId)}))),a.push(h.on("spanEnd",(e=>{i||function(e){n.has(e)&&n.delete(e),0===n.size&&g(Ti()+l/1e3)}(e.spanContext().spanId)}))),a.push(h.on("idleSpanEnableAutoFinish",(e=>{e===m&&(s=!0,g(),n.size&&y())}))),t.disableAutoFinish||g(),setTimeout((()=>{i||(m.setStatus({code:2,message:"deadline_exceeded"}),o=Ype,m.end())}),c),m}function Xpe(e){const t=Py(e);return Uv(an(),t),pt&&Me.log("[Tracing] Started span is an idle span"),t}function P3(e,t,n,r=0){return new Ns(((i,o)=>{const s=e[r];if(null===t||"function"!=typeof s)i(t);else{const a=s({...t},n);pt&&s.id&&null===a&&Me.log(`Event processor "${s.id}" dropped event`),ZE(a)?a.then((t=>P3(e,t,n,r+1).then(i))).then(null,o):P3(e,a,n,r+1).then(i).then(null,o)}}))}let N1,R9,D1;function Zpe(e){const t=Ft._sentryDebugIds;if(!t)return{};const n=Object.keys(t);return D1&&n.length===R9||(R9=n.length,D1=n.reduce(((n,r)=>{N1||(N1={});const i=N1[r];if(i)n[i[0]]=i[1];else{const i=e(r);for(let e=i.length-1;e>=0;e--){const o=i[e],s=o&&o.filename,a=t[r];if(s&&a){n[s]=a,N1[r]=[s,a];break}}}return n}),{})),D1}function Qpe(e,t){const{fingerprint:n,span:r,breadcrumbs:i,sdkProcessingMetadata:o}=t;eme(e,t),r&&rme(e,r),ime(e,n),tme(e,i),nme(e,o)}function I9(e,t){const{extra:n,tags:r,user:i,contexts:o,level:s,sdkProcessingMetadata:a,breadcrumbs:l,fingerprint:c,eventProcessors:u,attachments:d,propagationContext:h,transactionName:p,span:f}=t;j1(e,"extra",n),j1(e,"tags",r),j1(e,"user",i),j1(e,"contexts",o),e.sdkProcessingMetadata=QE(e.sdkProcessingMetadata,a,2),s&&(e.level=s),p&&(e.transactionName=p),f&&(e.span=f),l.length&&(e.breadcrumbs=[...e.breadcrumbs,...l]),c.length&&(e.fingerprint=[...e.fingerprint,...c]),u.length&&(e.eventProcessors=[...e.eventProcessors,...u]),d.length&&(e.attachments=[...e.attachments,...d]),e.propagationContext={...e.propagationContext,...h}}function j1(e,t,n){e[t]=QE(e[t],n,1)}function eme(e,t){const{extra:n,tags:r,user:i,contexts:o,level:s,transactionName:a}=t,l=Yr(n);l&&Object.keys(l).length&&(e.extra={...l,...e.extra});const c=Yr(r);c&&Object.keys(c).length&&(e.tags={...c,...e.tags});const u=Yr(i);u&&Object.keys(u).length&&(e.user={...u,...e.user});const d=Yr(o);d&&Object.keys(d).length&&(e.contexts={...d,...e.contexts}),s&&(e.level=s),a&&"transaction"!==e.type&&(e.transaction=a)}function tme(e,t){const n=[...e.breadcrumbs||[],...t];e.breadcrumbs=n.length?n:void 0}function nme(e,t){e.sdkProcessingMetadata={...e.sdkProcessingMetadata,...t}}function rme(e,t){e.contexts={trace:upe(t),...e.contexts},e.sdkProcessingMetadata={dynamicSamplingContext:Bp(t),...e.sdkProcessingMetadata};const n=Vt(Xr(t)).description;n&&!e.transaction&&"transaction"===e.type&&(e.transaction=n)}function ime(e,t){e.fingerprint=e.fingerprint?Array.isArray(e.fingerprint)?e.fingerprint:[e.fingerprint]:[],t&&(e.fingerprint=e.fingerprint.concat(t)),e.fingerprint&&!e.fingerprint.length&&delete e.fingerprint}function sme(e,t,n,r,i,o){const{normalizeDepth:s=3,normalizeMaxBreadth:a=1e3}=e,l={...t,event_id:t.event_id||n.event_id||Gs(),timestamp:t.timestamp||xy()},c=n.integrations||e.integrations.map((e=>e.name));ome(l,e),cme(l,c),i&&i.emit("applyFrameMetadata",t),void 0===t.type&&ame(l,e.stackParser);const u=dme(r,n.captureContext);n.mechanism&&pp(l,n.mechanism);const d=i?i.getEventProcessors():[],h=Jhe().getScopeData();if(o){I9(h,o.getScopeData())}if(u){I9(h,u.getScopeData())}const p=[...n.attachments||[],...h.attachments];p.length&&(n.attachments=p),Qpe(l,h);return P3([...d,...h.eventProcessors],l,n).then((e=>(e&&lme(e),"number"==typeof s&&s>0?ume(e,s,a):e)))}function ome(e,t){const{environment:n,release:r,dist:i,maxValueLength:o=250}=t;e.environment=e.environment||n||UL,!e.release&&r&&(e.release=r),!e.dist&&i&&(e.dist=i),e.message&&(e.message=qh(e.message,o));const s=e.exception&&e.exception.values&&e.exception.values[0];s&&s.value&&(s.value=qh(s.value,o));const a=e.request;a&&a.url&&(a.url=qh(a.url,o))}function ame(e,t){const n=Zpe(t);try{e.exception.values.forEach((e=>{e.stacktrace.frames.forEach((e=>{n&&e.filename&&(e.debug_id=n[e.filename])}))}))}catch{}}function lme(e){const t={};try{e.exception.values.forEach((e=>{e.stacktrace.frames.forEach((e=>{e.debug_id&&(e.abs_path?t[e.abs_path]=e.debug_id:e.filename&&(t[e.filename]=e.debug_id),delete e.debug_id)}))}))}catch{}if(0===Object.keys(t).length)return;e.debug_meta=e.debug_meta||{},e.debug_meta.images=e.debug_meta.images||[];const n=e.debug_meta.images;Object.entries(t).forEach((([e,t])=>{n.push({type:"sourcemap",code_file:e,debug_id:t})}))}function cme(e,t){t.length>0&&(e.sdk=e.sdk||{},e.sdk.integrations=[...e.sdk.integrations||[],...t])}function ume(e,t,n){if(!e)return null;const r={...e,...e.breadcrumbs&&{breadcrumbs:e.breadcrumbs.map((e=>({...e,...e.data&&{data:sl(e.data,t,n)}})))},...e.user&&{user:sl(e.user,t,n)},...e.contexts&&{contexts:sl(e.contexts,t,n)},...e.extra&&{extra:sl(e.extra,t,n)}};return e.contexts&&e.contexts.trace&&r.contexts&&(r.contexts.trace=e.contexts.trace,e.contexts.trace.data&&(r.contexts.trace.data=sl(e.contexts.trace.data,t,n))),e.spans&&(r.spans=e.spans.map((e=>({...e,...e.data&&{data:sl(e.data,t,n)}})))),e.contexts&&e.contexts.flags&&r.contexts&&(r.contexts.flags=sl(e.contexts.flags,3,n)),r}function dme(e,t){if(!t)return e;const n=e?e.clone():new pu;return n.update(t),n}function fme(e){if(e)return hme(e)||mme(e)?{captureContext:e}:e}function hme(e){return e instanceof pu||"function"==typeof e}const pme=["user","level","extra","contexts","tags","fingerprint","requestSession","propagationContext"];function mme(e){return Object.keys(e).some((e=>pme.includes(e)))}function rw(e,t){return an().captureException(e,fme(t))}function gme(e,t){const n={captureContext:t};return an().captureMessage(e,void 0,n)}function rK(e,t){return an().captureEvent(e,t)}function vme(e,t){Na().setContext(e,t)}function yme(){return Na().lastEventId()}function _me(){const e=qt();return!!e&&!1!==e.getOptions().enabled&&!!e.getTransport()}function k9(e){const t=qt(),n=Na(),r=an(),{release:i,environment:o=UL}=t&&t.getOptions()||{},{userAgent:s}=Ft.navigator||{},a=$he({release:i,environment:o,user:r.getUser()||n.getUser(),...s&&{userAgent:s},...e}),l=n.getSession();return l&&"ok"===l.status&&mp(l,{status:"exited"}),iK(),n.setSession(a),r.setSession(a),a}function iK(){const e=Na(),t=an(),n=t.getSession()||e.getSession();n&&Hhe(n),sK(),e.setSession(),t.setSession()}function sK(){const e=Na(),t=an(),n=qt(),r=t.getSession()||e.getSession();r&&n&&n.captureSession(r)}function x9(e=!1){e?iK():sK()}const bme="7";function oK(e){const t=e.protocol?`${e.protocol}:`:"",n=e.port?`:${e.port}`:"";return`${t}//${e.host}${n}${e.path?`/${e.path}`:""}/api/`}function Sme(e){return`${oK(e)}${e.projectId}/envelope/`}function Eme(e,t){const n={sentry_version:"7"};return e.publicKey&&(n.sentry_key=e.publicKey),t&&(n.sentry_client=`${t.name}/${t.version}`),new URLSearchParams(n).toString()}function wme(e,t,n){return t||`${Sme(e)}?${Eme(e,n)}`}function Cme(e,t){const n=Jq(e);if(!n)return"";const r=`${oK(n)}embed/error-page/`;let i=`dsn=${Vp(n)}`;for(const e in t)if("dsn"!==e&&"onClose"!==e)if("user"===e){const e=t.user;if(!e)continue;e.name&&(i+=`&name=${encodeURIComponent(e.name)}`),e.email&&(i+=`&email=${encodeURIComponent(e.email)}`)}else i+=`&${encodeURIComponent(e)}=${encodeURIComponent(t[e])}`;return`${r}?${i}`}const P9=[];function Tme(e){const t={};return e.forEach((e=>{const{name:n}=e,r=t[n];r&&!r.isDefaultInstance&&e.isDefaultInstance||(t[n]=e)})),Object.values(t)}function Rme(e){const t=e.defaultIntegrations||[],n=e.integrations;let r;if(t.forEach((e=>{e.isDefaultInstance=!0})),Array.isArray(n))r=[...t,...n];else if("function"==typeof n){const e=n(t);r=Array.isArray(e)?e:[e]}else r=t;const i=Tme(r),o=i.findIndex((e=>"Debug"===e.name));if(o>-1){const[e]=i.splice(o,1);i.push(e)}return i}function Ime(e,t){const n={};return t.forEach((t=>{t&&aK(e,t,n)})),n}function L9(e,t){for(const n of t)n&&n.afterAllSetup&&n.afterAllSetup(e)}function aK(e,t,n){if(n[t.name])pt&&Me.log(`Integration skipped because it was already installed: ${t.name}`);else{if(n[t.name]=t,-1===P9.indexOf(t.name)&&"function"==typeof t.setupOnce&&(t.setupOnce(),P9.push(t.name)),t.setup&&"function"==typeof t.setup&&t.setup(e),"function"==typeof t.preprocessEvent){const n=t.preprocessEvent.bind(t);e.on("preprocessEvent",((t,r)=>n(t,r,e)))}if("function"==typeof t.processEvent){const n=t.processEvent.bind(t),r=Object.assign(((t,r)=>n(t,r,e)),{id:t.name});e.addEventProcessor(r)}pt&&Me.log(`Integration installed: ${t.name}`)}}function kme(e,t,n){return qp(t?{dsn:t}:{},[[{type:"client_report"},{timestamp:xy(),discarded_events:e}]])}class ko extends Error{constructor(e,t="warn"){super(e),this.message=e,this.logLevel=t}}const O9="Not capturing exception because it's already been captured.";class xme{constructor(e){if(this._options=e,this._integrations={},this._numProcessing=0,this._outcomes={},this._hooks={},this._eventProcessors=[],e.dsn?this._dsn=Jq(e.dsn):pt&&Me.warn("No DSN provided, client will not send events."),this._dsn){const t=wme(this._dsn,e.tunnel,e._metadata?e._metadata.sdk:void 0);this._transport=e.transport({tunnel:this._options.tunnel,recordDroppedEvent:this.recordDroppedEvent.bind(this),...e.transportOptions,url:t})}const t=["enableTracing","tracesSampleRate","tracesSampler"].find((t=>t in e&&null==e[t]));t&&Zd((()=>{console.warn(`[Sentry] Deprecation warning: \`${t}\` is set to undefined, which leads to tracing being enabled. In v9, a value of \`undefined\` will result in tracing being disabled.`)}))}captureException(e,t,n){const r=Gs();if(u9(e))return pt&&Me.log(O9),r;const i={event_id:r,...t};return this._process(this.eventFromException(e,i).then((e=>this._captureEvent(e,i,n)))),i.event_id}captureMessage(e,t,n,r){const i={event_id:Gs(),...n},o=OL(e)?e:String(e),s=ML(e)?this.eventFromMessage(o,t,i):this.eventFromException(e,i);return this._process(s.then((e=>this._captureEvent(e,i,r)))),i.event_id}captureEvent(e,t,n){const r=Gs();if(t&&t.originalException&&u9(t.originalException))return pt&&Me.log(O9),r;const i={event_id:r,...t},o=(e.sdkProcessingMetadata||{}).capturedSpanScope;return this._process(this._captureEvent(e,i,o||n)),i.event_id}captureSession(e){"string"!=typeof e.release?pt&&Me.warn("Discarded session because of missing or non-string release"):(this.sendSession(e),mp(e,{init:!1}))}getDsn(){return this._dsn}getOptions(){return this._options}getSdkMetadata(){return this._options._metadata}getTransport(){return this._transport}flush(e){const t=this._transport;return t?(this.emit("flush"),this._isClientDoneProcessing(e).then((n=>t.flush(e).then((e=>n&&e))))):Ud(!0)}close(e){return this.flush(e).then((e=>(this.getOptions().enabled=!1,this.emit("close"),e)))}getEventProcessors(){return this._eventProcessors}addEventProcessor(e){this._eventProcessors.push(e)}init(){(this._isEnabled()||this._options.integrations.some((({name:e})=>e.startsWith("Spotlight"))))&&this._setupIntegrations()}getIntegrationByName(e){return this._integrations[e]}addIntegration(e){const t=this._integrations[e.name];aK(this,e,this._integrations),t||L9(this,[e])}sendEvent(e,t={}){this.emit("beforeSendEvent",e,t);let n=Upe(e,this._dsn,this._options._metadata,this._options.tunnel);for(const e of t.attachments||[])n=xpe(n,Mpe(e));const r=this.sendEnvelope(n);r&&r.then((t=>this.emit("afterSendEvent",e,t)),null)}sendSession(e){const t=jpe(e,this._dsn,this._options._metadata,this._options.tunnel);this.sendEnvelope(t)}recordDroppedEvent(e,t,n){if(this._options.sendClientReports){const r="number"==typeof n?n:1,i=`${e}:${t}`;pt&&Me.log(`Recording outcome: "${i}"${r>1?` (${r} times)`:""}`),this._outcomes[i]=(this._outcomes[i]||0)+r}}on(e,t){const n=this._hooks[e]=this._hooks[e]||[];return n.push(t),()=>{const e=n.indexOf(t);e>-1&&n.splice(e,1)}}emit(e,...t){const n=this._hooks[e];n&&n.forEach((e=>e(...t)))}sendEnvelope(e){return this.emit("beforeEnvelope",e),this._isEnabled()&&this._transport?this._transport.send(e).then(null,(e=>(pt&&Me.error("Error while sending envelope:",e),e))):(pt&&Me.error("Transport disabled"),Ud({}))}_setupIntegrations(){const{integrations:e}=this._options;this._integrations=Ime(this,e),L9(this,e)}_updateSessionFromEvent(e,t){let n="fatal"===t.level,r=!1;const i=t.exception&&t.exception.values;if(i){r=!0;for(const e of i){const t=e.mechanism;if(t&&!1===t.handled){n=!0;break}}}const o="ok"===e.status;(o&&0===e.errors||o&&n)&&(mp(e,{...n&&{status:"crashed"},errors:e.errors||Number(r||n)}),this.captureSession(e))}_isClientDoneProcessing(e){return new Ns((t=>{let n=0;const r=setInterval((()=>{0==this._numProcessing?(clearInterval(r),t(!0)):(n+=1,e&&n>=e&&(clearInterval(r),t(!1)))}),1)}))}_isEnabled(){return!1!==this.getOptions().enabled&&void 0!==this._transport}_prepareEvent(e,t,n=an(),r=Na()){const i=this.getOptions(),o=Object.keys(this._integrations);return!t.integrations&&o.length>0&&(t.integrations=o),this.emit("preprocessEvent",e,t),e.type||r.setLastEventId(e.event_id||t.event_id),sme(i,e,t,n,this,r).then((e=>{if(null===e)return e;e.contexts={trace:Xhe(n),...e.contexts};const t=Wq(this,n);return e.sdkProcessingMetadata={dynamicSamplingContext:t,...e.sdkProcessingMetadata},e}))}_captureEvent(e,t={},n){return this._processEvent(e,t,n).then((e=>e.event_id),(e=>{pt&&(e instanceof ko&&"log"===e.logLevel?Me.log(e.message):Me.warn(e))}))}_processEvent(e,t,n){const r=this.getOptions(),{sampleRate:i}=r,o=cK(e),s=lK(e),a=e.type||"error",l=`before send for type \`${a}\``,c=typeof i>"u"?void 0:zq(i);if(s&&"number"==typeof c&&Math.random()>c)return this.recordDroppedEvent("sample_rate","error",e),_S(new ko(`Discarding event because it's not included in the random sample (sampling rate = ${i})`,"log"));const u="replay_event"===a?"replay":a,d=(e.sdkProcessingMetadata||{}).capturedSpanIsolationScope;return this._prepareEvent(e,t,n,d).then((n=>{if(null===n)throw this.recordDroppedEvent("event_processor",u,e),new ko("An event processor returned `null`, will not send event.","log");if(t.data&&!0===t.data.__sentry__)return n;return Pme(Lme(this,r,n,t),l)})).then((r=>{if(null===r){if(this.recordDroppedEvent("before_send",u,e),o){const t=1+(e.spans||[]).length;this.recordDroppedEvent("before_send","span",t)}throw new ko(`${l} returned \`null\`, will not send event.`,"log")}const i=n&&n.getSession();if(!o&&i&&this._updateSessionFromEvent(i,r),o){const e=(r.sdkProcessingMetadata&&r.sdkProcessingMetadata.spanCountBeforeProcessing||0)-(r.spans?r.spans.length:0);e>0&&this.recordDroppedEvent("before_send","span",e)}const s=r.transaction_info;if(o&&s&&r.transaction!==e.transaction){const e="custom";r.transaction_info={...s,source:e}}return this.sendEvent(r,t),r})).then(null,(e=>{throw e instanceof ko?e:(this.captureException(e,{data:{__sentry__:!0},originalException:e}),new ko(`Event processing pipeline threw an error, original event will not be sent. Details have been sent as a new event.\nReason: ${e}`))}))}_process(e){this._numProcessing++,e.then((e=>(this._numProcessing--,e)),(e=>(this._numProcessing--,e)))}_clearOutcomes(){const e=this._outcomes;return this._outcomes={},Object.entries(e).map((([e,t])=>{const[n,r]=e.split(":");return{reason:n,category:r,quantity:t}}))}_flushOutcomes(){pt&&Me.log("Flushing outcomes...");const e=this._clearOutcomes();if(0===e.length)return void(pt&&Me.log("No outcomes to send"));if(!this._dsn)return void(pt&&Me.log("No dsn provided, will not send outcomes"));pt&&Me.log("Sending outcomes:",e);const t=kme(e,this._options.tunnel&&Vp(this._dsn));this.sendEnvelope(t)}}function Pme(e,t){const n=`${t} must return \`null\` or a valid event.`;if(ZE(e))return e.then((e=>{if(!hp(e)&&null!==e)throw new ko(n);return e}),(e=>{throw new ko(`${t} rejected with ${e}`)}));if(!hp(e)&&null!==e)throw new ko(n);return e}function Lme(e,t,n,r){const{beforeSend:i,beforeSendTransaction:o,beforeSendSpan:s}=t;if(lK(n)&&i)return i(n,r);if(cK(n)){if(n.spans&&s){const t=[];for(const r of n.spans){const n=s(r);n?t.push(n):(Bq(),e.recordDroppedEvent("before_send","span"))}n.spans=t}if(o){if(n.spans){const e=n.spans.length;n.sdkProcessingMetadata={...n.sdkProcessingMetadata,spanCountBeforeProcessing:e}}return o(n,r)}}return n}function lK(e){return void 0===e.type}function cK(e){return"transaction"===e.type}function Ome(e,t){!0===t.debug&&(pt?Me.enable():Zd((()=>{console.warn("[Sentry] Cannot initialize SDK with `debug` option using a non-debug bundle.")}))),an().update(t.initialScope);const n=new e(t);return Mme(n),n.init(),n}function Mme(e){an().setClient(e)}function Ame(e){const t=[];function n(e){return t.splice(t.indexOf(e),1)[0]||Promise.resolve(void 0)}return{$:t,add:function(r){if(!(void 0===e||t.length<e))return _S(new ko("Not adding Promise because buffer limit was reached."));const i=r();return-1===t.indexOf(i)&&t.push(i),i.then((()=>n(i))).then(null,(()=>n(i).then(null,(()=>{})))),i},drain:function(e){return new Ns(((n,r)=>{let i=t.length;if(!i)return n(!0);const o=setTimeout((()=>{e&&e>0&&n(!1)}),e);t.forEach((e=>{Ud(e).then((()=>{--i||(clearTimeout(o),n(!0))}),r)}))}))}}}const Nme=6e4;function Dme(e,t=Date.now()){const n=parseInt(`${e}`,10);if(!isNaN(n))return 1e3*n;const r=Date.parse(`${e}`);return isNaN(r)?Nme:r-t}function jme(e,t){return e[t]||e.all||0}function Ume(e,t,n=Date.now()){return jme(e,t)>n}function Fme(e,{statusCode:t,headers:n},r=Date.now()){const i={...e},o=n&&n["x-sentry-rate-limits"],s=n&&n["retry-after"];if(o)for(const e of o.trim().split(",")){const[t,n,,,o]=e.split(":",5),s=parseInt(t,10),a=1e3*(isNaN(s)?60:s);if(n)for(const e of n.split(";"))"metric_bucket"===e?(!o||o.split(";").includes("custom"))&&(i[e]=r+a):i[e]=r+a;else i.all=r+a}else s?i.all=r+Dme(s,r):429===t&&(i.all=r+6e4);return i}const $me=64;function Hme(e,t,n=Ame(e.bufferSize||64)){let r={};return{send:function(i){const o=[];if(_9(i,((t,n)=>{const i=b9(n);if(Ume(r,i)){const r=M9(t,n);e.recordDroppedEvent("ratelimit_backoff",i,r)}else o.push(t)})),0===o.length)return Ud({});const s=qp(i[0],o),a=t=>{_9(s,((n,r)=>{const i=M9(n,r);e.recordDroppedEvent(t,b9(r),i)}))};return n.add((()=>t({body:Ppe(s)}).then((e=>(void 0!==e.statusCode&&(e.statusCode<200||e.statusCode>=300)&&pt&&Me.warn(`Sentry responded with status code ${e.statusCode} to sent event.`),r=Fme(r,e),e)),(e=>{throw a("network_error"),e})))).then((e=>e),(e=>{if(e instanceof ko)return pt&&Me.error("Skipped sending event because buffer is full."),a("queue_overflow"),Ud({});throw e}))},flush:e=>n.drain(e)}}function M9(e,t){if("event"===t||"transaction"===t)return Array.isArray(e)?e[1]:void 0}function uK(e,t,n=[t],r="npm"){const i=e._metadata||{};i.sdk||(i.sdk={name:`sentry.javascript.${t}`,packages:n.map((e=>({name:`${r}:@sentry/${e}`,version:Td}))),version:Td}),e._metadata=i}function dK(e={}){const t=qt();if(!_me()||!t)return{};const n=$p(Qd());if(n.getTraceData)return n.getTraceData(e);const r=an(),i=e.span||Zr(),o=i?dpe(i):Bme(r),s=ipe(i?Bp(i):Wq(t,r));return Dq.test(o)?{"sentry-trace":o,baggage:s}:(Me.warn("Invalid sentry-trace data. Cannot generate trace data"),{})}function Bme(e){const{traceId:t,sampled:n,spanId:r}=e.getPropagationContext();return jq(t,r,n)}const Vme=100;function Fd(e,t){const n=qt(),r=Na();if(!n)return;const{beforeBreadcrumb:i=null,maxBreadcrumbs:o=Vme}=n.getOptions();if(o<=0)return;const s={timestamp:xy(),...e},a=i?Zd((()=>i(s,t))):s;null!==a&&(n.emit&&n.emit("beforeAddBreadcrumb",a,t),r.addBreadcrumb(a,o))}let A9;const qme="FunctionToString",N9=new WeakMap,Kme=()=>({name:qme,setupOnce(){A9=Function.prototype.toString;try{Function.prototype.toString=function(...e){const t=AL(this),n=N9.has(qt())&&void 0!==t?t:this;return A9.apply(n,e)}}catch{}},setup(e){N9.set(e,!0)}}),Gme=Kme,Wme=[/^Script error\.?$/,/^Javascript error: Script error\.? on line 0$/,/^ResizeObserver loop completed with undelivered notifications.$/,/^Cannot redefine property: googletag$/,"undefined is not an object (evaluating 'a.L')",'can\'t redefine non-configurable property "solana"',"vv().getRestrictions is not a function. (In 'vv().getRestrictions(1,a)', 'vv().getRestrictions' is undefined)","Can't find variable: _AutofillCallbackHandler",/^Non-Error promise rejection captured with value: Object Not Found Matching Id:\d+, MethodName:simulateEvent, ParamCount:\d+$/],zme="InboundFilters",Yme=(e={})=>({name:zme,processEvent(t,n,r){const i=r.getOptions();return Zme(t,Xme(e,i))?null:t}}),Jme=Yme;function Xme(e={},t={}){return{allowUrls:[...e.allowUrls||[],...t.allowUrls||[]],denyUrls:[...e.denyUrls||[],...t.denyUrls||[]],ignoreErrors:[...e.ignoreErrors||[],...t.ignoreErrors||[],...e.disableErrorDefaults?[]:Wme],ignoreTransactions:[...e.ignoreTransactions||[],...t.ignoreTransactions||[]],ignoreInternal:void 0===e.ignoreInternal||e.ignoreInternal}}function Zme(e,t){return t.ignoreInternal&&ige(e)?(pt&&Me.warn(`Event dropped due to being internal Sentry Error.\nEvent: ${Mc(e)}`),!0):Qme(e,t.ignoreErrors)?(pt&&Me.warn(`Event dropped due to being matched by \`ignoreErrors\` option.\nEvent: ${Mc(e)}`),!0):oge(e)?(pt&&Me.warn(`Event dropped due to not having an error message, error type or stacktrace.\nEvent: ${Mc(e)}`),!0):ege(e,t.ignoreTransactions)?(pt&&Me.warn(`Event dropped due to being matched by \`ignoreTransactions\` option.\nEvent: ${Mc(e)}`),!0):tge(e,t.denyUrls)?(pt&&Me.warn(`Event dropped due to being matched by \`denyUrls\` option.\nEvent: ${Mc(e)}.\nUrl: ${SS(e)}`),!0):!nge(e,t.allowUrls)&&(pt&&Me.warn(`Event dropped due to not being matched by \`allowUrls\` option.\nEvent: ${Mc(e)}.\nUrl: ${SS(e)}`),!0)}function Qme(e,t){return!(e.type||!t||!t.length)&&rge(e).some((e=>Rd(e,t)))}function ege(e,t){if("transaction"!==e.type||!t||!t.length)return!1;const n=e.transaction;return!!n&&Rd(n,t)}function tge(e,t){if(!t||!t.length)return!1;const n=SS(e);return!!n&&Rd(n,t)}function nge(e,t){if(!t||!t.length)return!0;const n=SS(e);return!n||Rd(n,t)}function rge(e){const t=[];let n;e.message&&t.push(e.message);try{n=e.exception.values[e.exception.values.length-1]}catch{}return n&&n.value&&(t.push(n.value),n.type&&t.push(`${n.type}: ${n.value}`)),t}function ige(e){try{return"SentryError"===e.exception.values[0].type}catch{}return!1}function sge(e=[]){for(let t=e.length-1;t>=0;t--){const n=e[t];if(n&&"<anonymous>"!==n.filename&&"[native code]"!==n.filename)return n.filename||null}return null}function SS(e){try{let t;try{t=e.exception.values[0].stacktrace.frames}catch{}return t?sge(t):null}catch{return pt&&Me.error(`Cannot extract url for event ${Mc(e)}`),null}}function oge(e){return!(e.type||!e.exception||!e.exception.values||0===e.exception.values.length)&&(!e.message&&!e.exception.values.some((e=>e.stacktrace||e.type&&"Error"!==e.type||e.value)))}function age(e,t,n=250,r,i,o,s){if(!(o.exception&&o.exception.values&&s&&Dl(s.originalException,Error)))return;const a=o.exception.values.length>0?o.exception.values[o.exception.values.length-1]:void 0;a&&(o.exception.values=lge(L3(e,t,i,s.originalException,r,o.exception.values,a,0),n))}function L3(e,t,n,r,i,o,s,a){if(o.length>=n+1)return o;let l=[...o];if(Dl(r[i],Error)){D9(s,a);const o=e(t,r[i]),c=l.length;j9(o,i,c,a),l=L3(e,t,n,r[i],i,[o,...l],o,c)}return Array.isArray(r.errors)&&r.errors.forEach(((r,o)=>{if(Dl(r,Error)){D9(s,a);const c=e(t,r),u=l.length;j9(c,`errors[${o}]`,u,a),l=L3(e,t,n,r,i,[c,...l],c,u)}})),l}function D9(e,t){e.mechanism=e.mechanism||{type:"generic",handled:!0},e.mechanism={...e.mechanism,..."AggregateError"===e.type&&{is_exception_group:!0},exception_id:t}}function j9(e,t,n,r){e.mechanism=e.mechanism||{type:"generic",handled:!0},e.mechanism={...e.mechanism,type:"chained",source:t,exception_id:n,parent_id:r}}function lge(e,t){return e.map((e=>(e.value&&(e.value=qh(e.value,t)),e)))}function xd(e){if(!e)return{};const t=e.match(/^(([^:/?#]+):)?(\/\/([^/?#]*))?([^?#]*)(\?([^#]*))?(#(.*))?$/);if(!t)return{};const n=t[6]||"",r=t[8]||"";return{host:t[4],path:t[5],protocol:t[2],search:n,hash:r,relative:t[5]+n+r}}function U9(e){return e.split(/\\?\//).filter((e=>e.length>0&&","!==e)).length}function cge(e){const t="console";Ru(t,e),Iu(t,uge)}function uge(){"console"in Ft&&b3.forEach((function(e){e in Ft.console&&ys(Ft.console,e,(function(t){return yS[e]=t,function(...t){Ks("console",{args:t,level:e});const n=yS[e];n&&n.apply(Ft.console,t)}}))}))}function dge(e){return"warn"===e?"warning":["fatal","error","warning","log","info","debug"].includes(e)?e:"log"}const fge="Dedupe",hge=()=>{let e;return{name:fge,processEvent(t){if(t.type)return t;try{if(mge(t,e))return pt&&Me.warn("Event dropped due to being a duplicate of previously captured event."),null}catch{}return e=t}}},pge=hge;function mge(e,t){return!!t&&!(!gge(e,t)&&!vge(e,t))}function gge(e,t){const n=e.message,r=t.message;return!(!n&&!r||n&&!r||!n&&r||n!==r||!hK(e,t)||!fK(e,t))}function vge(e,t){const n=F9(t),r=F9(e);return!!(n&&r&&n.type===r.type&&n.value===r.value&&hK(e,t)&&fK(e,t))}function fK(e,t){let n=i9(e),r=i9(t);if(!n&&!r)return!0;if(n&&!r||!n&&r||r.length!==n.length)return!1;for(let e=0;e<r.length;e++){const t=r[e],i=n[e];if(t.filename!==i.filename||t.lineno!==i.lineno||t.colno!==i.colno||t.function!==i.function)return!1}return!0}function hK(e,t){let n=e.fingerprint,r=t.fingerprint;if(!n&&!r)return!0;if(n&&!r||!n&&r)return!1;try{return n.join("")===r.join("")}catch{return!1}}function F9(e){return e.exception&&e.exception.values&&e.exception.values[0]}function yge(e,t,n,r,i="auto.http.browser"){if(!e.fetchData)return;const o=mu()&&t(e.fetchData.url);if(e.endTimestamp&&o){const t=e.fetchData.__span;if(!t)return;const n=r[t];return void(n&&(Sge(n,e),delete r[t]))}const{method:s,url:a}=e.fetchData,l=bge(a),c=l?xd(l).host:void 0,u=!!Zr(),d=o&&u?Py({name:`${s} ${a}`,attributes:{url:a,type:"fetch","http.method":s,"http.url":l,"server.address":c,[lr]:i,[jl]:"http.client"}}):new Hp;if(e.fetchData.__span=d.spanContext().spanId,r[d.spanContext().spanId]=d,n(e.fetchData.url)){const t=e.args[0],n=e.args[1]||{},r=_ge(t,n,mu()&&u?d:void 0);r&&(e.args[1]=n,n.headers=r)}return d}function _ge(e,t,n){const r=dK({span:n}),i=r["sentry-trace"],o=r.baggage;if(!i)return;const s=t.headers||(Ege(e)?e.headers:void 0);if(s){if(wge(s)){const e=new Headers(s);if(e.set("sentry-trace",i),o){const t=e.get("baggage");if(t){const n=U1(t);e.set("baggage",n?`${n},${o}`:o)}else e.set("baggage",o)}return e}if(Array.isArray(s)){const e=[...s.filter((e=>!(Array.isArray(e)&&"sentry-trace"===e[0]))).map((e=>{if(Array.isArray(e)&&"baggage"===e[0]&&"string"==typeof e[1]){const[t,n,...r]=e;return[t,U1(n),...r]}return e})),["sentry-trace",i]];return o&&e.push(["baggage",o]),e}{const e="baggage"in s?s.baggage:void 0;let t=[];return Array.isArray(e)?t=e.map((e=>"string"==typeof e?U1(e):e)).filter((e=>""===e)):e&&t.push(U1(e)),o&&t.push(o),{...s,"sentry-trace":i,baggage:t.length>0?t.join(","):void 0}}}return{...r}}function bge(e){try{return new URL(e).href}catch{return}}function Sge(e,t){if(t.response){Aq(e,t.response.status);const n=t.response&&t.response.headers&&t.response.headers.get("content-length");if(n){const t=parseInt(n);t>0&&e.setAttribute("http.response_content_length",t)}}else t.error&&e.setStatus({code:2,message:"internal_error"});e.end()}function U1(e){return e.split(",").filter((e=>!e.split("=")[0].startsWith(jL))).join(",")}function Ege(e){return typeof Request<"u"&&Dl(e,Request)}function wge(e){return typeof Headers<"u"&&Dl(e,Headers)}function pK(e){if(void 0!==e)return e>=400&&e<500?"warning":e>=500?"error":void 0}const O3=Ft;function mK(){if(!("fetch"in O3))return!1;try{return new Headers,new Request("http://www.example.com"),new Response,!0}catch{return!1}}function M3(e){return e&&/^function\s+\w+\(\)\s+\{\s+\[native code\]\s+\}$/.test(e.toString())}function Cge(){if("string"==typeof EdgeRuntime)return!0;if(!mK())return!1;if(M3(O3.fetch))return!0;let e=!1;const t=O3.document;if(t&&"function"==typeof t.createElement)try{const n=t.createElement("iframe");n.hidden=!0,t.head.appendChild(n),n.contentWindow&&n.contentWindow.fetch&&(e=M3(n.contentWindow.fetch)),t.head.removeChild(n)}catch(e){Tu&&Me.warn("Could not create sandbox iframe for pure fetch check, bailing to window.fetch: ",e)}return e}function gK(e,t){const n="fetch";Ru(n,e),Iu(n,(()=>vK(void 0,t)))}function Tge(e){const t="fetch-body-resolved";Ru(t,e),Iu(t,(()=>vK(Ige)))}function vK(e,t=!1){t&&!Cge()||ys(Ft,"fetch",(function(t){return function(...n){const r=new Error,{method:i,url:o}=kge(n),s={args:n,fetchData:{method:i,url:o},startTimestamp:1e3*Ti(),virtualError:r};return e||Ks("fetch",{...s}),t.apply(Ft,n).then((async t=>(e?e(t):Ks("fetch",{...s,endTimestamp:1e3*Ti(),response:t}),t)),(e=>{throw Ks("fetch",{...s,endTimestamp:1e3*Ti(),error:e}),JE(e)&&void 0===e.stack&&(e.stack=r.stack,Xs(e,"framesToPop",1)),e}))}}))}async function Rge(e,t){if(e&&e.body){const n=e.body,r=n.getReader(),i=setTimeout((()=>{n.cancel().then(null,(()=>{}))}),9e4);let o=!0;for(;o;){let e;try{e=setTimeout((()=>{n.cancel().then(null,(()=>{}))}),5e3);const{done:i}=await r.read();clearTimeout(e),i&&(t(),o=!1)}catch{o=!1}finally{clearTimeout(e)}}clearTimeout(i),r.releaseLock(),n.cancel().then(null,(()=>{}))}}function Ige(e){let t;try{t=e.clone()}catch{return}Rge(t,(()=>{Ks("fetch-body-resolved",{endTimestamp:1e3*Ti(),response:e})}))}function A3(e,t){return!!e&&"object"==typeof e&&!!e[t]}function $9(e){return"string"==typeof e?e:e?A3(e,"url")?e.url:e.toString?e.toString():"":""}function kge(e){if(0===e.length)return{method:"GET",url:""};if(2===e.length){const[t,n]=e;return{url:$9(t),method:A3(n,"method")?String(n.method).toUpperCase():"GET"}}const t=e[0];return{url:$9(t),method:A3(t,"method")?String(t.method).toUpperCase():"GET"}}function xge(){return"npm"}const F1=Ft;function Pge(){const e=F1.chrome,t=e&&e.app&&e.app.runtime,n="history"in F1&&!!F1.history.pushState&&!!F1.history.replaceState;return!t&&n}const Qe=Ft;let N3=0;function yK(){return N3>0}function Lge(){N3++,setTimeout((()=>{N3--}))}function vp(e,t={}){if("function"!=typeof e)return e;try{const t=e.__sentry_wrapped__;if(t)return"function"==typeof t?t:e;if(AL(e))return e}catch{return e}const n=function(...n){try{const r=n.map((e=>vp(e,t)));return e.apply(this,r)}catch(e){throw Lge(),ew((r=>{r.addEventProcessor((e=>(t.mechanism&&(E3(e,void 0),pp(e,t.mechanism)),e.extra={...e.extra,arguments:n},e))),rw(e)})),e}};try{for(const t in e)Object.prototype.hasOwnProperty.call(e,t)&&(n[t]=e[t])}catch{}kq(n,e),Xs(e,"__sentry_wrapped__",n);try{Object.getOwnPropertyDescriptor(n,"name").configurable&&Object.defineProperty(n,"name",{get:()=>e.name})}catch{}return n}const bs=typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__;function $L(e,t){const n=HL(e,t),r={type:Dge(t),value:jge(t)};return n.length&&(r.stacktrace={frames:n}),void 0===r.type&&""===r.value&&(r.value="Unrecoverable error caught"),r}function Oge(e,t,n,r){const i=qt(),o=i&&i.getOptions().normalizeDepth,s=Bge(t),a={__serialized__:Xq(t,o)};if(s)return{exception:{values:[$L(e,s)]},extra:a};const l={exception:{values:[{type:XE(t)?t.constructor.name:r?"UnhandledRejection":"Error",value:$ge(t,{isUnhandledRejection:r})}]},extra:a};if(n){const t=HL(e,n);t.length&&(l.exception.values[0].stacktrace={frames:t})}return l}function B2(e,t){return{exception:{values:[$L(e,t)]}}}function HL(e,t){const n=t.stacktrace||t.stack||"",r=Age(t),i=Nge(t);try{return e(n,r,i)}catch{}return[]}const Mge=/Minified React error #\d+;/i;function Age(e){return e&&Mge.test(e.message)?1:0}function Nge(e){return"number"==typeof e.framesToPop?e.framesToPop:0}function _K(e){return typeof WebAssembly<"u"&&typeof WebAssembly.Exception<"u"&&e instanceof WebAssembly.Exception}function Dge(e){const t=e&&e.name;return!t&&_K(e)?e.message&&Array.isArray(e.message)&&2==e.message.length?e.message[0]:"WebAssembly.Exception":t}function jge(e){const t=e&&e.message;return t?t.error&&"string"==typeof t.error.message?t.error.message:_K(e)&&Array.isArray(e.message)&&2==e.message.length?e.message[1]:t:"No error message"}function Uge(e,t,n,r){const i=BL(e,t,n&&n.syntheticException||void 0,r);return pp(i),i.level="error",n&&n.event_id&&(i.event_id=n.event_id),Ud(i)}function Fge(e,t,n="info",r,i){const o=D3(e,t,r&&r.syntheticException||void 0,i);return o.level=n,r&&r.event_id&&(o.event_id=r.event_id),Ud(o)}function BL(e,t,n,r,i){let o;if(Tq(t)&&t.error)return B2(e,t.error);if(o9(t)||Ihe(t)){const i=t;if("stack"in t)o=B2(e,t);else{const t=i.name||(o9(i)?"DOMError":"DOMException"),s=i.message?`${t}: ${i.message}`:t;o=D3(e,s,n,r),E3(o,s)}return"code"in i&&(o.tags={...o.tags,"DOMException.code":`${i.code}`}),o}return JE(t)?B2(e,t):hp(t)||XE(t)?(o=Oge(e,t,n,i),pp(o,{synthetic:!0}),o):(o=D3(e,t,n,r),E3(o,`${t}`),pp(o,{synthetic:!0}),o)}function D3(e,t,n,r){const i={};if(r&&n){const r=HL(e,n);r.length&&(i.exception={values:[{value:t,stacktrace:{frames:r}}]}),pp(i,{synthetic:!0})}if(OL(t)){const{__sentry_template_string__:e,__sentry_template_values__:n}=t;return i.logentry={message:e,params:n},i}return i.message=t,i}function $ge(e,{isUnhandledRejection:t}){const n=Dhe(e),r=t?"promise rejection":"exception";return Tq(e)?`Event \`ErrorEvent\` captured as ${r} with message \`${e.message}\``:XE(e)?`Event \`${Hge(e)}\` (type=${e.type}) captured as ${r}`:`Object captured as ${r} with keys: ${n}`}function Hge(e){try{const t=Object.getPrototypeOf(e);return t?t.constructor.name:void 0}catch{}}function Bge(e){for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t)){const n=e[t];if(n instanceof Error)return n}}function Vge(e,{metadata:t,tunnel:n,dsn:r}){return qp({event_id:e.event_id,sent_at:(new Date).toISOString(),...t&&t.sdk&&{sdk:{name:t.sdk.name,version:t.sdk.version}},...!!n&&!!r&&{dsn:Vp(r)}},[qge(e)])}function qge(e){return[{type:"user_report"},e]}class Kge extends xme{constructor(e){const t={parentSpanIsAlwaysRootSpan:!0,...e};uK(t,"browser",["browser"],Qe.SENTRY_SDK_SOURCE||xge()),super(t),t.sendClientReports&&Qe.document&&Qe.document.addEventListener("visibilitychange",(()=>{"hidden"===Qe.document.visibilityState&&this._flushOutcomes()}))}eventFromException(e,t){return Uge(this._options.stackParser,e,t,this._options.attachStacktrace)}eventFromMessage(e,t="info",n){return Fge(this._options.stackParser,e,t,n,this._options.attachStacktrace)}captureUserFeedback(e){if(!this._isEnabled())return void(bs&&Me.warn("SDK not enabled, will not capture user feedback."));const t=Vge(e,{metadata:this.getSdkMetadata(),dsn:this.getDsn(),tunnel:this.getOptions().tunnel});this.sendEnvelope(t)}_prepareEvent(e,t,n){return e.platform=e.platform||"javascript",super._prepareEvent(e,t,n)}}const VL=typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__,Gge=(e,t)=>e>t[1]?"poor":e>t[0]?"needs-improvement":"good",Kp=(e,t,n,r)=>{let i,o;return s=>{t.value>=0&&(s||r)&&(o=t.value-(i||0),(o||void 0===i)&&(i=t.value,t.delta=o,t.rating=Gge(t.value,n),e(t)))}},nt=Ft,Wge=()=>`v4-${Date.now()}-${Math.floor(8999999999999*Math.random())+1e12}`,Ly=(e=!0)=>{const t=nt.performance&&nt.performance.getEntriesByType&&nt.performance.getEntriesByType("navigation")[0];if(!e||t&&t.responseStart>0&&t.responseStart<performance.now())return t},Oy=()=>{const e=Ly();return e&&e.activationStart||0},Gp=(e,t)=>{const n=Ly();let r="navigate";return n&&(nt.document&&nt.document.prerendering||Oy()>0?r="prerender":nt.document&&nt.document.wasDiscarded?r="restore":n.type&&(r=n.type.replace(/_/g,"-"))),{name:e,value:typeof t>"u"?-1:t,rating:"good",delta:0,entries:[],id:Wge(),navigationType:r}},tf=(e,t,n)=>{try{if(PerformanceObserver.supportedEntryTypes.includes(e)){const r=new PerformanceObserver((e=>{Promise.resolve().then((()=>{t(e.getEntries())}))}));return r.observe(Object.assign({type:e,buffered:!0},n||{})),r}}catch{}},Wp=e=>{const t=t=>{("pagehide"===t.type||nt.document&&"hidden"===nt.document.visibilityState)&&e(t)};nt.document&&(addEventListener("visibilitychange",t,!0),addEventListener("pagehide",t,!0))},iw=e=>{let t=!1;return()=>{t||(e(),t=!0)}};let Qg=-1;const zge=()=>"hidden"!==nt.document.visibilityState||nt.document.prerendering?1/0:0,ES=e=>{"hidden"===nt.document.visibilityState&&Qg>-1&&(Qg="visibilitychange"===e.type?e.timeStamp:0,Jge())},Yge=()=>{addEventListener("visibilitychange",ES,!0),addEventListener("prerenderingchange",ES,!0)},Jge=()=>{removeEventListener("visibilitychange",ES,!0),removeEventListener("prerenderingchange",ES,!0)},sw=()=>(nt.document&&Qg<0&&(Qg=zge(),Yge()),{get firstHiddenTime(){return Qg}}),My=e=>{nt.document&&nt.document.prerendering?addEventListener("prerenderingchange",(()=>e()),!0):e()},Xge=[1800,3e3],Zge=(e,t={})=>{My((()=>{const n=sw(),r=Gp("FCP");let i;const o=tf("paint",(e=>{e.forEach((e=>{"first-contentful-paint"===e.name&&(o.disconnect(),e.startTime<n.firstHiddenTime&&(r.value=Math.max(e.startTime-Oy(),0),r.entries.push(e),i(!0)))}))}));o&&(i=Kp(e,r,Xge,t.reportAllChanges))}))},Qge=[.1,.25],eve=(e,t={})=>{Zge(iw((()=>{const n=Gp("CLS",0);let r,i=0,o=[];const s=e=>{e.forEach((e=>{if(!e.hadRecentInput){const t=o[0],n=o[o.length-1];i&&t&&n&&e.startTime-n.startTime<1e3&&e.startTime-t.startTime<5e3?(i+=e.value,o.push(e)):(i=e.value,o=[e])}})),i>n.value&&(n.value=i,n.entries=o,r())},a=tf("layout-shift",s);a&&(r=Kp(e,n,Qge,t.reportAllChanges),Wp((()=>{s(a.takeRecords()),r(!0)})),setTimeout(r,0))})))},tve=[100,300],nve=(e,t={})=>{My((()=>{const n=sw(),r=Gp("FID");let i;const o=e=>{e.startTime<n.firstHiddenTime&&(r.value=e.processingStart-e.startTime,r.entries.push(e),i(!0))},s=e=>{e.forEach(o)},a=tf("first-input",s);i=Kp(e,r,tve,t.reportAllChanges),a&&Wp(iw((()=>{s(a.takeRecords()),a.disconnect()})))}))};let bK=0,V2=1/0,$1=0;const rve=e=>{e.forEach((e=>{e.interactionId&&(V2=Math.min(V2,e.interactionId),$1=Math.max($1,e.interactionId),bK=$1?($1-V2)/7+1:0)}))};let j3;const ive=()=>j3?bK:performance.interactionCount||0,sve=()=>{"interactionCount"in performance||j3||(j3=tf("event",rve,{type:"event",buffered:!0,durationThreshold:0}))},ol=[],q2=new Map,ove=40;let ave=0;const lve=()=>ive()-ave,cve=()=>{const e=Math.min(ol.length-1,Math.floor(lve()/50));return ol[e]},K2=10,uve=[],dve=e=>{if(uve.forEach((t=>t(e))),!e.interactionId&&"first-input"!==e.entryType)return;const t=ol[ol.length-1],n=q2.get(e.interactionId);if(n||ol.length<10||t&&e.duration>t.latency){if(n)e.duration>n.latency?(n.entries=[e],n.latency=e.duration):e.duration===n.latency&&e.startTime===(n.entries[0]&&n.entries[0].startTime)&&n.entries.push(e);else{const t={id:e.interactionId,latency:e.duration,entries:[e]};q2.set(t.id,t),ol.push(t)}ol.sort(((e,t)=>t.latency-e.latency)),ol.length>10&&ol.splice(10).forEach((e=>q2.delete(e.id)))}},SK=e=>{const t=nt.requestIdleCallback||nt.setTimeout;let n=-1;return e=iw(e),nt.document&&"hidden"===nt.document.visibilityState?e():(n=t(e),Wp(e)),n},fve=[200,500],hve=(e,t={})=>{"PerformanceEventTiming"in nt&&"interactionId"in PerformanceEventTiming.prototype&&My((()=>{sve();const n=Gp("INP");let r;const i=e=>{SK((()=>{e.forEach(dve);const t=cve();t&&t.latency!==n.value&&(n.value=t.latency,n.entries=t.entries,r())}))},o=tf("event",i,{durationThreshold:null!=t.durationThreshold?t.durationThreshold:40});r=Kp(e,n,fve,t.reportAllChanges),o&&(o.observe({type:"first-input",buffered:!0}),Wp((()=>{i(o.takeRecords()),r(!0)})))}))},pve=[2500,4e3],H9={},mve=(e,t={})=>{My((()=>{const n=sw(),r=Gp("LCP");let i;const o=e=>{t.reportAllChanges||(e=e.slice(-1)),e.forEach((e=>{e.startTime<n.firstHiddenTime&&(r.value=Math.max(e.startTime-Oy(),0),r.entries=[e],i())}))},s=tf("largest-contentful-paint",o);if(s){i=Kp(e,r,pve,t.reportAllChanges);const n=iw((()=>{H9[r.id]||(o(s.takeRecords()),s.disconnect(),H9[r.id]=!0,i(!0))}));["keydown","click"].forEach((e=>{nt.document&&addEventListener(e,(()=>SK(n)),{once:!0,capture:!0})})),Wp(n)}}))},gve=[800,1800],U3=e=>{nt.document&&nt.document.prerendering?My((()=>U3(e))):nt.document&&"complete"!==nt.document.readyState?addEventListener("load",(()=>U3(e)),!0):setTimeout(e,0)},vve=(e,t={})=>{const n=Gp("TTFB"),r=Kp(e,n,gve,t.reportAllChanges);U3((()=>{const e=Ly();e&&(n.value=Math.max(e.responseStart-Oy(),0),n.entries=[e],r(!0))}))},ev={},wS={};let EK,wK,CK,TK,RK;function IK(e,t=!1){return Ay("cls",e,Eve,EK,t)}function yve(e,t=!1){return Ay("lcp",e,Cve,CK,t)}function _ve(e){return Ay("fid",e,wve,wK)}function bve(e){return Ay("ttfb",e,Tve,TK)}function Sve(e){return Ay("inp",e,Rve,RK)}function Fv(e,t){return kK(e,t),wS[e]||(Ive(e),wS[e]=!0),xK(e,t)}function zp(e,t){const n=ev[e];if(n&&n.length)for(const r of n)try{r(t)}catch(t){VL&&Me.error(`Error while triggering instrumentation handler.\nType: ${e}\nName: ${Nl(r)}\nError:`,t)}}function Eve(){return eve((e=>{zp("cls",{metric:e}),EK=e}),{reportAllChanges:!0})}function wve(){return nve((e=>{zp("fid",{metric:e}),wK=e}))}function Cve(){return mve((e=>{zp("lcp",{metric:e}),CK=e}),{reportAllChanges:!0})}function Tve(){return vve((e=>{zp("ttfb",{metric:e}),TK=e}))}function Rve(){return hve((e=>{zp("inp",{metric:e}),RK=e}))}function Ay(e,t,n,r,i=!1){let o;return kK(e,t),wS[e]||(o=n(),wS[e]=!0),r&&t({metric:r}),xK(e,t,i?o:void 0)}function Ive(e){const t={};"event"===e&&(t.durationThreshold=0),tf(e,(t=>{zp(e,{entries:t})}),t)}function kK(e,t){ev[e]=ev[e]||[],ev[e].push(t)}function xK(e,t,n){return()=>{n&&n();const r=ev[e];if(!r)return;const i=r.indexOf(t);-1!==i&&r.splice(i,1)}}function kve(e){return"duration"in e}function G2(e){return"number"==typeof e&&isFinite(e)}function Ul(e,t,n,{...r}){const i=Vt(e).start_timestamp;return i&&i>t&&"function"==typeof e.updateStartTime&&e.updateStartTime(t),eK(e,(()=>{const e=Py({startTime:t,...r});return e&&e.end(n),e}))}function PK(e){const t=qt();if(!t)return;const{name:n,transaction:r,attributes:i,startTime:o}=e,{release:s,environment:a}=t.getOptions(),l=t.getIntegrationByName("Replay"),c=l&&l.getReplayId(),u=an(),d=u.getUser(),h=void 0!==d?d.email||d.id||d.ip_address:void 0;let p;try{p=u.getScopeData().contexts.profile.profile_id}catch{}return Py({name:n,attributes:{release:s,environment:a,user:h||void 0,profile_id:p||void 0,replay_id:c||void 0,transaction:r,"user_agent.original":nt.navigator&&nt.navigator.userAgent,...i},startTime:o,experimental:{standalone:!0}})}function qL(){return nt&&nt.addEventListener&&nt.performance}function Xn(e){return e/1e3}function LK(e){let t="unknown",n="unknown",r="";for(const i of e){if("/"===i){[t,n]=e.split("/");break}if(!isNaN(Number(i))){t="h"===r?"http":r,n=e.split(r)[1];break}r+=i}return r===e&&(t=r),{name:t,version:n}}function xve(){let e,t,n=0;if(!Lve())return;let r=!1;function i(){r||(r=!0,t&&Pve(n,e,t),o())}const o=IK((({metric:t})=>{const r=t.entries[t.entries.length-1];r&&(n=t.value,e=r)}),!0);Wp((()=>{i()})),setTimeout((()=>{const e=qt();if(!e)return;const n=e.on("startNavigationSpan",(()=>{i(),n&&n()})),r=Zr(),o=r&&Xr(r),s=o&&Vt(o);s&&"pageload"===s.op&&(t=o.spanContext().spanId)}),0)}function Pve(e,t,n){VL&&Me.log(`Sending CLS span (${e})`);const r=Xn((es||0)+(t&&t.startTime||0)),i=an().getScopeData().transactionName,o=PK({name:t?jd(t.sources[0]&&t.sources[0].node):"Layout shift",transaction:i,attributes:Yr({[lr]:"auto.http.browser.cls",[jl]:"ui.webvital.cls",[DL]:t&&t.duration||0,"sentry.pageload.span_id":n}),startTime:r});o&&(o.addEvent("cls",{[tw]:"",[nw]:e}),o.end(r))}function Lve(){try{return PerformanceObserver.supportedEntryTypes.includes("layout-shift")}catch{return!1}}const Ove=2147483647;let Ui,tv,B9=0,qr={};function Mve({recordClsStandaloneSpans:e}){const t=qL();if(t&&es){t.mark&&nt.performance.mark("sentry-tracing-init");const n=Fve(),r=Uve(),i=$ve(),o=e?xve():jve();return()=>{n(),r(),i(),o&&o()}}return()=>{}}function Ave(){Fv("longtask",(({entries:e})=>{const t=Zr();if(!t)return;const{op:n,start_timestamp:r}=Vt(t);for(const i of e){const e=Xn(es+i.startTime),o=Xn(i.duration);"navigation"===n&&r&&e<r||Ul(t,e,e+o,{name:"Main UI thread blocked",op:"ui.long-task",attributes:{[lr]:"auto.ui.browser.metrics"}})}}))}function Nve(){new PerformanceObserver((e=>{const t=Zr();if(t)for(const n of e.getEntries()){if(!n.scripts[0])continue;const e=Xn(es+n.startTime),{start_timestamp:r,op:i}=Vt(t);if("navigation"===i&&r&&e<r)continue;const o=Xn(n.duration),s={[lr]:"auto.ui.browser.metrics"},a=n.scripts[0],{invoker:l,invokerType:c,sourceURL:u,sourceFunctionName:d,sourceCharPosition:h}=a;s["browser.script.invoker"]=l,s["browser.script.invoker_type"]=c,u&&(s["code.filepath"]=u),d&&(s["code.function"]=d),-1!==h&&(s["browser.script.source_char_position"]=h),Ul(t,e,e+o,{name:"Main UI thread blocked",op:"ui.long-animation-frame",attributes:s})}})).observe({type:"long-animation-frame",buffered:!0})}function Dve(){Fv("event",(({entries:e})=>{const t=Zr();if(t)for(const n of e)if("click"===n.name){const e=Xn(es+n.startTime),r=Xn(n.duration),i={name:jd(n.target),op:`ui.interaction.${n.name}`,startTime:e,attributes:{[lr]:"auto.ui.browser.metrics"}},o=Iq(n.target);o&&(i.attributes["ui.component_name"]=o),Ul(t,e,e+r,i)}}))}function jve(){return IK((({metric:e})=>{const t=e.entries[e.entries.length-1];t&&(qr.cls={value:e.value,unit:""},tv=t)}),!0)}function Uve(){return yve((({metric:e})=>{const t=e.entries[e.entries.length-1];t&&(qr.lcp={value:e.value,unit:"millisecond"},Ui=t)}),!0)}function Fve(){return _ve((({metric:e})=>{const t=e.entries[e.entries.length-1];if(!t)return;const n=Xn(es),r=Xn(t.startTime);qr.fid={value:e.value,unit:"millisecond"},qr["mark.fid"]={value:n+r,unit:"second"}}))}function $ve(){return bve((({metric:e})=>{e.entries[e.entries.length-1]&&(qr.ttfb={value:e.value,unit:"millisecond"})}))}function Hve(e,t){const n=qL();if(!n||!n.getEntries||!es)return;const r=Xn(es),i=n.getEntries(),{op:o,start_timestamp:s}=Vt(e);if(i.slice(B9).forEach((t=>{const n=Xn(t.startTime),i=Xn(Math.max(0,t.duration));if(!("navigation"===o&&s&&r+n<s))switch(t.entryType){case"navigation":Vve(e,t,r);break;case"mark":case"paint":case"measure":{Bve(e,t,n,i,r);const o=sw(),s=t.startTime<o.firstHiddenTime;"first-paint"===t.name&&s&&(qr.fp={value:t.startTime,unit:"millisecond"}),"first-contentful-paint"===t.name&&s&&(qr.fcp={value:t.startTime,unit:"millisecond"});break}case"resource":Gve(e,t,t.name,n,i,r)}})),B9=Math.max(i.length-1,0),Wve(e),"pageload"===o){Yve(qr);const n=qr["mark.fid"];n&&qr.fid&&(Ul(e,n.value,n.value+Xn(qr.fid.value),{name:"first input delay",op:"ui.action",attributes:{[lr]:"auto.ui.browser.metrics"}}),delete qr["mark.fid"]),(!("fcp"in qr)||!t.recordClsOnPageloadSpan)&&delete qr.cls,Object.entries(qr).forEach((([e,t])=>{$pe(e,t.value,t.unit)})),e.setAttribute("performance.timeOrigin",r),e.setAttribute("performance.activationStart",Oy()),zve(e)}Ui=void 0,tv=void 0,qr={}}function Bve(e,t,n,r,i){const o=Ly(!1),s=Xn(o?o.requestStart:0),a=i+Math.max(n,s),l=i+n,c=l+r,u={[lr]:"auto.resource.browser.metrics"};return a!==l&&(u["sentry.browser.measure_happened_before_request"]=!0,u["sentry.browser.measure_start_time"]=a),Ul(e,a,c,{name:t.name,op:t.entryType,attributes:u}),a}function Vve(e,t,n){["unloadEvent","redirect","domContentLoadedEvent","loadEvent","connect"].forEach((r=>{H1(e,t,r,n)})),H1(e,t,"secureConnection",n,"TLS/SSL"),H1(e,t,"fetch",n,"cache"),H1(e,t,"domainLookup",n,"DNS"),Kve(e,t,n)}function H1(e,t,n,r,i=n){const o=t[qve(n)],s=t[`${n}Start`];!s||!o||Ul(e,r+Xn(s),r+Xn(o),{op:`browser.${i}`,name:t.name,attributes:{[lr]:"auto.ui.browser.metrics"}})}function qve(e){return"secureConnection"===e?"connectEnd":"fetch"===e?"domainLookupStart":`${e}End`}function Kve(e,t,n){const r=n+Xn(t.requestStart),i=n+Xn(t.responseEnd),o=n+Xn(t.responseStart);t.responseEnd&&(Ul(e,r,i,{op:"browser.request",name:t.name,attributes:{[lr]:"auto.ui.browser.metrics"}}),Ul(e,o,i,{op:"browser.response",name:t.name,attributes:{[lr]:"auto.ui.browser.metrics"}}))}function Gve(e,t,n,r,i,o){if("xmlhttprequest"===t.initiatorType||"fetch"===t.initiatorType)return;const s=xd(n),a={[lr]:"auto.resource.browser.metrics"};W2(a,t,"transferSize","http.response_transfer_size"),W2(a,t,"encodedBodySize","http.response_content_length"),W2(a,t,"decodedBodySize","http.decoded_response_content_length");const l=t.deliveryType;null!=l&&(a["http.response_delivery_type"]=l);const c=t.renderBlockingStatus;c&&(a["resource.render_blocking_status"]=c),s.protocol&&(a["url.scheme"]=s.protocol.split(":").pop()),s.host&&(a["server.address"]=s.host),a["url.same_origin"]=n.includes(nt.location.origin);const{name:u,version:d}=LK(t.nextHopProtocol);a["network.protocol.name"]=u,a["network.protocol.version"]=d;const h=o+r;Ul(e,h,h+i,{name:n.replace(nt.location.origin,""),op:t.initiatorType?`resource.${t.initiatorType}`:"resource.other",attributes:a})}function Wve(e){const t=nt.navigator;if(!t)return;const n=t.connection;n&&(n.effectiveType&&e.setAttribute("effectiveConnectionType",n.effectiveType),n.type&&e.setAttribute("connectionType",n.type),G2(n.rtt)&&(qr["connection.rtt"]={value:n.rtt,unit:"millisecond"})),G2(t.deviceMemory)&&e.setAttribute("deviceMemory",`${t.deviceMemory} GB`),G2(t.hardwareConcurrency)&&e.setAttribute("hardwareConcurrency",String(t.hardwareConcurrency))}function zve(e){Ui&&(Ui.element&&e.setAttribute("lcp.element",jd(Ui.element)),Ui.id&&e.setAttribute("lcp.id",Ui.id),Ui.url&&e.setAttribute("lcp.url",Ui.url.trim().slice(0,200)),null!=Ui.loadTime&&e.setAttribute("lcp.loadTime",Ui.loadTime),null!=Ui.renderTime&&e.setAttribute("lcp.renderTime",Ui.renderTime),e.setAttribute("lcp.size",Ui.size)),tv&&tv.sources&&tv.sources.forEach(((t,n)=>e.setAttribute(`cls.source.${n+1}`,jd(t.node))))}function W2(e,t,n,r){const i=t[n];null!=i&&i<Ove&&(e[r]=i)}function Yve(e){const t=Ly(!1);if(!t)return;const{responseStart:n,requestStart:r}=t;r<=n&&(e["ttfb.requestTime"]={value:n-r,unit:"millisecond"})}const Jve=1e3;let V9,F3,$3,B1;function Xve(e){Ru("dom",e),Iu("dom",Zve)}function Zve(){if(!nt.document)return;const e=Ks.bind(null,"dom"),t=q9(e,!0);nt.document.addEventListener("click",t,!1),nt.document.addEventListener("keypress",t,!1),["EventTarget","Node"].forEach((t=>{const n=nt[t],r=n&&n.prototype;!r||!r.hasOwnProperty||!r.hasOwnProperty("addEventListener")||(ys(r,"addEventListener",(function(t){return function(n,r,i){if("click"===n||"keypress"==n)try{const r=this.__sentry_instrumentation_handlers__=this.__sentry_instrumentation_handlers__||{},o=r[n]=r[n]||{refCount:0};if(!o.handler){const r=q9(e);o.handler=r,t.call(this,n,r,i)}o.refCount++}catch{}return t.call(this,n,r,i)}})),ys(r,"removeEventListener",(function(e){return function(t,n,r){if("click"===t||"keypress"==t)try{const n=this.__sentry_instrumentation_handlers__||{},i=n[t];i&&(i.refCount--,i.refCount<=0&&(e.call(this,t,i.handler,r),i.handler=void 0,delete n[t]),0===Object.keys(n).length&&delete this.__sentry_instrumentation_handlers__)}catch{}return e.call(this,t,n,r)}})))}))}function Qve(e){if(e.type!==F3)return!1;try{if(!e.target||e.target._sentryId!==$3)return!1}catch{}return!0}function eye(e,t){return"keypress"===e&&(!t||!t.tagName||!("INPUT"===t.tagName||"TEXTAREA"===t.tagName||t.isContentEditable))}function q9(e,t=!1){return n=>{if(!n||n._sentryCaptured)return;const r=tye(n);if(eye(n.type,r))return;Xs(n,"_sentryCaptured",!0),r&&!r._sentryId&&Xs(r,"_sentryId",Gs());const i="keypress"===n.type?"input":n.type;Qve(n)||(e({event:n,name:i,global:t}),F3=n.type,$3=r?r._sentryId:void 0),clearTimeout(V9),V9=nt.setTimeout((()=>{$3=void 0,F3=void 0}),Jve)}}function tye(e){try{return e.target}catch{return null}}function KL(e){const t="history";Ru(t,e),Iu(t,nye)}function nye(){if(!Pge())return;const e=nt.onpopstate;function t(e){return function(...t){const n=t.length>2?t[2]:void 0;if(n){const e=B1,t=String(n);B1=t,Ks("history",{from:e,to:t})}return e.apply(this,t)}}nt.onpopstate=function(...t){const n=nt.location.href,r=B1;if(B1=n,Ks("history",{from:r,to:n}),e)try{return e.apply(this,t)}catch{}},ys(nt.history,"pushState",t),ys(nt.history,"replaceState",t)}const db={};function rye(e){const t=db[e];if(t)return t;let n=nt[e];if(M3(n))return db[e]=n.bind(nt);const r=nt.document;if(r&&"function"==typeof r.createElement)try{const t=r.createElement("iframe");t.hidden=!0,r.head.appendChild(t);const i=t.contentWindow;i&&i[e]&&(n=i[e]),r.head.removeChild(t)}catch(t){VL&&Me.warn(`Could not create sandbox iframe for ${e} check, bailing to window.${e}: `,t)}return n&&(db[e]=n.bind(nt))}function K9(e){db[e]=void 0}const Eh="__sentry_xhr_v3__";function OK(e){Ru("xhr",e),Iu("xhr",iye)}function iye(){if(!nt.XMLHttpRequest)return;const e=XMLHttpRequest.prototype;e.open=new Proxy(e.open,{apply(e,t,n){const r=new Error,i=1e3*Ti(),o=Cl(n[0])?n[0].toUpperCase():void 0,s=sye(n[1]);if(!o||!s)return e.apply(t,n);t[Eh]={method:o,url:s,request_headers:{}},"POST"===o&&s.match(/sentry_key/)&&(t.__sentry_own_request__=!0);const a=()=>{const e=t[Eh];if(e&&4===t.readyState){try{e.status_code=t.status}catch{}Ks("xhr",{endTimestamp:1e3*Ti(),startTimestamp:i,xhr:t,virtualError:r})}};return"onreadystatechange"in t&&"function"==typeof t.onreadystatechange?t.onreadystatechange=new Proxy(t.onreadystatechange,{apply:(e,t,n)=>(a(),e.apply(t,n))}):t.addEventListener("readystatechange",a),t.setRequestHeader=new Proxy(t.setRequestHeader,{apply(e,t,n){const[r,i]=n,o=t[Eh];return o&&Cl(r)&&Cl(i)&&(o.request_headers[r.toLowerCase()]=i),e.apply(t,n)}}),e.apply(t,n)}}),e.send=new Proxy(e.send,{apply(e,t,n){const r=t[Eh];if(!r)return e.apply(t,n);void 0!==n[0]&&(r.body=n[0]);return Ks("xhr",{startTimestamp:1e3*Ti(),xhr:t}),e.apply(t,n)}})}function sye(e){if(Cl(e))return e;try{return e.toString()}catch{}}const z2=[],fb=new Map;function oye(){if(qL()&&es){const e=aye();return()=>{e()}}return()=>{}}const G9={click:"click",pointerdown:"click",pointerup:"click",mousedown:"click",mouseup:"click",touchstart:"click",touchend:"click",mouseover:"hover",mouseout:"hover",mouseenter:"hover",mouseleave:"hover",pointerover:"hover",pointerout:"hover",pointerenter:"hover",pointerleave:"hover",dragstart:"drag",dragend:"drag",drag:"drag",dragenter:"drag",dragleave:"drag",dragover:"drag",drop:"drag",keydown:"press",keyup:"press",keypress:"press",input:"press"};function aye(){return Sve((({metric:e})=>{if(null==e.value)return;const t=e.entries.find((t=>t.duration===e.value&&G9[t.name]));if(!t)return;const{interactionId:n}=t,r=G9[t.name],i=Xn(es+t.startTime),o=Xn(e.value),s=Zr(),a=s?Xr(s):void 0,l=(null!=n?fb.get(n):void 0)||a,c=l?Vt(l).description:an().getScopeData().transactionName,u=PK({name:jd(t.target),transaction:c,attributes:Yr({[lr]:"auto.http.browser.inp",[jl]:`ui.interaction.${r}`,[DL]:t.duration}),startTime:i});u&&(u.addEvent("inp",{[tw]:"millisecond",[nw]:e.value}),u.end(i+o))}))}function lye(e){const t=({entries:e})=>{const t=Zr(),n=t&&Xr(t);e.forEach((e=>{if(!kve(e)||!n)return;const t=e.interactionId;if(null!=t&&!fb.has(t)){if(z2.length>10){const e=z2.shift();fb.delete(e)}z2.push(t),fb.set(t,n)}}))};Fv("event",t),Fv("first-input",t)}function cye(e,t=rye("fetch")){let n=0,r=0;return Hme(e,(function(i){const o=i.body.length;n+=o,r++;const s={body:i.body,method:"POST",referrerPolicy:"origin",headers:e.headers,keepalive:n<=6e4&&r<15,...e.fetchOptions};if(!t)return K9("fetch"),_S("No fetch implementation available");try{return t(e.url,s).then((e=>(n-=o,r--,{statusCode:e.status,headers:{"x-sentry-rate-limits":e.headers.get("X-Sentry-Rate-Limits"),"retry-after":e.headers.get("Retry-After")}})))}catch(e){return K9("fetch"),n-=o,r--,_S(e)}}))}const uye=30,dye=50;function H3(e,t,n,r){const i={filename:e,function:"<anonymous>"===t?Dd:t,in_app:!0};return void 0!==n&&(i.lineno=n),void 0!==r&&(i.colno=r),i}const fye=/^\s*at (\S+?)(?::(\d+))(?::(\d+))\s*$/i,hye=/^\s*at (?:(.+?\)(?: \[.+\])?|.*?) ?\((?:address at )?)?(?:async )?((?:<anonymous>|[-a-z]+:|.*bundle|\/)?.*?)(?::(\d+))?(?::(\d+))?\)?\s*$/i,pye=/\((\S*)(?::(\d+))(?::(\d+))\)/,mye=e=>{const t=fye.exec(e);if(t){const[,e,n,r]=t;return H3(e,Dd,+n,+r)}const n=hye.exec(e);if(n){if(n[2]&&0===n[2].indexOf("eval")){const e=pye.exec(n[2]);e&&(n[2]=e[1],n[3]=e[2],n[4]=e[3])}const[e,t]=MK(n[1]||Dd,n[2]);return H3(t,e,n[3]?+n[3]:void 0,n[4]?+n[4]:void 0)}},gye=[30,mye],vye=/^\s*(.*?)(?:\((.*?)\))?(?:^|@)?((?:[-a-z]+)?:\/.*?|\[native code\]|[^@]*(?:bundle|\d+\.js)|\/[\w\-. /=]+)(?::(\d+))?(?::(\d+))?\s*$/i,yye=/(\S+) line (\d+)(?: > eval line \d+)* > eval/i,_ye=e=>{const t=vye.exec(e);if(t){if(t[3]&&t[3].indexOf(" > eval")>-1){const e=yye.exec(t[3]);e&&(t[1]=t[1]||"eval",t[3]=e[1],t[4]=e[2],t[5]="")}let e=t[3],n=t[1]||Dd;return[n,e]=MK(n,e),H3(e,n,t[4]?+t[4]:void 0,t[5]?+t[5]:void 0)}},bye=[50,_ye],Sye=[gye,bye],Eye=Sq(...Sye),MK=(e,t)=>{const n=-1!==e.indexOf("safari-extension"),r=-1!==e.indexOf("safari-web-extension");return n||r?[-1!==e.indexOf("@")?e.split("@")[0]:Dd,n?`safari-extension:${t}`:`safari-web-extension:${t}`]:[e,t]},V1=1024,wye="Breadcrumbs",Cye=(e={})=>{const t={console:!0,dom:!0,fetch:!0,history:!0,sentry:!0,xhr:!0,...e};return{name:wye,setup(e){t.console&&cge(kye(e)),t.dom&&Xve(Iye(e,t.dom)),t.xhr&&OK(xye(e)),t.fetch&&gK(Pye(e)),t.history&&KL(Lye(e)),t.sentry&&e.on("beforeSendEvent",Rye(e))}}},Tye=Cye;function Rye(e){return function(t){qt()===e&&Fd({category:"sentry."+("transaction"===t.type?"transaction":"event"),event_id:t.event_id,level:t.level,message:Mc(t)},{event:t})}}function Iye(e,t){return function(n){if(qt()!==e)return;let r,i,o="object"==typeof t?t.serializeAttribute:void 0,s="object"==typeof t&&"number"==typeof t.maxStringLength?t.maxStringLength:void 0;s&&s>V1&&(bs&&Me.warn(`\`dom.maxStringLength\` cannot exceed 1024, but a value of ${s} was configured. Sentry will use 1024 instead.`),s=V1),"string"==typeof o&&(o=[o]);try{const e=n.event,t=Oye(e)?e.target:e;r=jd(t,{keyAttrs:o,maxStringLength:s}),i=Iq(t)}catch{r="<unknown>"}if(0===r.length)return;const a={category:`ui.${n.name}`,message:r};i&&(a.data={"ui.component_name":i}),Fd(a,{event:n.event,name:n.name,global:n.global})}}function kye(e){return function(t){if(qt()!==e)return;const n={category:"console",data:{arguments:t.args,logger:"console"},level:dge(t.level),message:a9(t.args," ")};if("assert"===t.level){if(!1!==t.args[0])return;n.message=`Assertion failed: ${a9(t.args.slice(1)," ")||"console.assert"}`,n.data.arguments=t.args.slice(1)}Fd(n,{input:t.args,level:t.level})}}function xye(e){return function(t){if(qt()!==e)return;const{startTimestamp:n,endTimestamp:r}=t,i=t.xhr[Eh];if(!n||!r||!i)return;const{method:o,url:s,status_code:a,body:l}=i,c={method:o,url:s,status_code:a},u={xhr:t.xhr,input:l,startTimestamp:n,endTimestamp:r};Fd({category:"xhr",data:c,type:"http",level:pK(a)},u)}}function Pye(e){return function(t){if(qt()!==e)return;const{startTimestamp:n,endTimestamp:r}=t;if(r&&(!t.fetchData.url.match(/sentry_key/)||"POST"!==t.fetchData.method))if(t.error){Fd({category:"fetch",data:t.fetchData,level:"error",type:"http"},{data:t.error,input:t.args,startTimestamp:n,endTimestamp:r})}else{const e=t.response,i={...t.fetchData,status_code:e&&e.status},o={input:t.args,response:e,startTimestamp:n,endTimestamp:r};Fd({category:"fetch",data:i,type:"http",level:pK(i.status_code)},o)}}}function Lye(e){return function(t){if(qt()!==e)return;let n=t.from,r=t.to;const i=xd(Qe.location.href);let o=n?xd(n):void 0;const s=xd(r);(!o||!o.path)&&(o=i),i.protocol===s.protocol&&i.host===s.host&&(r=s.relative),i.protocol===o.protocol&&i.host===o.host&&(n=o.relative),Fd({category:"navigation",data:{from:n,to:r}})}}function Oye(e){return!!e&&!!e.target}const Mye=["EventTarget","Window","Node","ApplicationCache","AudioTrackList","BroadcastChannel","ChannelMergerNode","CryptoOperation","EventSource","FileReader","HTMLUnknownElement","IDBDatabase","IDBRequest","IDBTransaction","KeyOperation","MediaController","MessagePort","ModalWindow","Notification","SVGElementInstance","Screen","SharedWorker","TextTrack","TextTrackCue","TextTrackList","WebSocket","WebSocketWorker","Worker","XMLHttpRequest","XMLHttpRequestEventTarget","XMLHttpRequestUpload"],Aye="BrowserApiErrors",Nye=(e={})=>{const t={XMLHttpRequest:!0,eventTarget:!0,requestAnimationFrame:!0,setInterval:!0,setTimeout:!0,...e};return{name:Aye,setupOnce(){t.setTimeout&&ys(Qe,"setTimeout",W9),t.setInterval&&ys(Qe,"setInterval",W9),t.requestAnimationFrame&&ys(Qe,"requestAnimationFrame",jye),t.XMLHttpRequest&&"XMLHttpRequest"in Qe&&ys(XMLHttpRequest.prototype,"send",Uye);const e=t.eventTarget;e&&(Array.isArray(e)?e:Mye).forEach(Fye)}}},Dye=Nye;function W9(e){return function(...t){const n=t[0];return t[0]=vp(n,{mechanism:{data:{function:Nl(e)},handled:!1,type:"instrument"}}),e.apply(this,t)}}function jye(e){return function(t){return e.apply(this,[vp(t,{mechanism:{data:{function:"requestAnimationFrame",handler:Nl(e)},handled:!1,type:"instrument"}})])}}function Uye(e){return function(...t){const n=this;return["onload","onerror","onprogress","onreadystatechange"].forEach((e=>{e in n&&"function"==typeof n[e]&&ys(n,e,(function(t){const n={mechanism:{data:{function:e,handler:Nl(t)},handled:!1,type:"instrument"}},r=AL(t);return r&&(n.mechanism.data.handler=Nl(r)),vp(t,n)}))})),e.apply(this,t)}}function Fye(e){const t=Qe[e],n=t&&t.prototype;!n||!n.hasOwnProperty||!n.hasOwnProperty("addEventListener")||(ys(n,"addEventListener",(function(t){return function(n,r,i){try{$ye(r)&&(r.handleEvent=vp(r.handleEvent,{mechanism:{data:{function:"handleEvent",handler:Nl(r),target:e},handled:!1,type:"instrument"}}))}catch{}return t.apply(this,[n,vp(r,{mechanism:{data:{function:"addEventListener",handler:Nl(r),target:e},handled:!1,type:"instrument"}}),i])}})),ys(n,"removeEventListener",(function(e){return function(t,n,r){try{const i=n.__sentry_wrapped__;i&&e.call(this,t,i,r)}catch{}return e.call(this,t,n,r)}})))}function $ye(e){return"function"==typeof e.handleEvent}const Hye=()=>({name:"BrowserSession",setupOnce(){typeof Qe.document>"u"?bs&&Me.warn("Using the `browserSessionIntegration` in non-browser environments is not supported."):(k9({ignoreDuration:!0}),x9(),KL((({from:e,to:t})=>{void 0!==e&&e!==t&&(k9({ignoreDuration:!0}),x9())})))}}),Bye="GlobalHandlers",Vye=(e={})=>{const t={onerror:!0,onunhandledrejection:!0,...e};return{name:Bye,setupOnce(){Error.stackTraceLimit=50},setup(e){t.onerror&&(Kye(e),z9("onerror")),t.onunhandledrejection&&(Gye(e),z9("onunhandledrejection"))}}},qye=Vye;function Kye(e){Eq((t=>{const{stackParser:n,attachStacktrace:r}=AK();if(qt()!==e||yK())return;const{msg:i,url:o,line:s,column:a,error:l}=t,c=Yye(BL(n,l||i,void 0,r,!1),o,s,a);c.level="error",rK(c,{originalException:l,mechanism:{handled:!1,type:"onerror"}})}))}function Gye(e){wq((t=>{const{stackParser:n,attachStacktrace:r}=AK();if(qt()!==e||yK())return;const i=Wye(t),o=ML(i)?zye(i):BL(n,i,void 0,r,!0);o.level="error",rK(o,{originalException:i,mechanism:{handled:!1,type:"onunhandledrejection"}})}))}function Wye(e){if(ML(e))return e;try{if("reason"in e)return e.reason;if("detail"in e&&"reason"in e.detail)return e.detail.reason}catch{}return e}function zye(e){return{exception:{values:[{type:"UnhandledRejection",value:`Non-Error promise rejection captured with value: ${String(e)}`}]}}}function Yye(e,t,n,r){const i=e.exception=e.exception||{},o=i.values=i.values||[],s=o[0]=o[0]||{},a=s.stacktrace=s.stacktrace||{},l=a.frames=a.frames||[],c=r,u=n,d=Cl(t)&&t.length>0?t:Mhe();return 0===l.length&&l.push({colno:c,filename:d,function:Dd,in_app:!0,lineno:u}),e}function z9(e){bs&&Me.log(`Global Handler attached: ${e}`)}function AK(){const e=qt();return e&&e.getOptions()||{stackParser:()=>[],attachStacktrace:!1}}const Jye=()=>({name:"HttpContext",preprocessEvent(e){if(!Qe.navigator&&!Qe.location&&!Qe.document)return;const t=e.request&&e.request.url||Qe.location&&Qe.location.href,{referrer:n}=Qe.document||{},{userAgent:r}=Qe.navigator||{},i={...e.request&&e.request.headers,...n&&{Referer:n},...r&&{"User-Agent":r}},o={...e.request,...t&&{url:t},headers:i};e.request=o}}),Xye="cause",Zye=5,Qye="LinkedErrors",e0e=(e={})=>{const t=e.limit||5,n=e.key||Xye;return{name:Qye,preprocessEvent(e,r,i){const o=i.getOptions();age($L,o.stackParser,o.maxValueLength,n,t,e,r)}}},t0e=e0e;function n0e(e){const t=[Jme(),Gme(),Dye(),Tye(),qye(),t0e(),pge(),Jye()];return!1!==e.autoSessionTracking&&t.push(Hye()),t}function r0e(e={}){const t={defaultIntegrations:n0e(e),release:"string"==typeof __SENTRY_RELEASE__?__SENTRY_RELEASE__:Qe.SENTRY_RELEASE&&Qe.SENTRY_RELEASE.id?Qe.SENTRY_RELEASE.id:void 0,autoSessionTracking:!0,sendClientReports:!0};return null==e.defaultIntegrations&&delete e.defaultIntegrations,{...t,...e}}function i0e(){const e=typeof Qe.window<"u"&&Qe;if(!e)return!1;const t=e[e.chrome?"chrome":"browser"],n=t&&t.runtime&&t.runtime.id,r=Qe.location&&Qe.location.href||"",i=!!n&&Qe===Qe.top&&["chrome-extension:","moz-extension:","ms-browser-extension:","safari-web-extension:"].some((e=>r.startsWith(`${e}//`))),o=typeof e.nw<"u";return!!n&&!i&&!o}function s0e(e={}){const t=r0e(e);if(!t.skipBrowserExtensionCheck&&i0e())return void Zd((()=>{console.error("[Sentry] You cannot run Sentry this way in a browser extension, check: https://docs.sentry.io/platforms/javascript/best-practices/browser-extensions/")}));bs&&(mK()||Me.warn("No Fetch API detected. The Sentry SDK requires a Fetch API compatible environment to send events. Please add a Fetch API polyfill."));const n={...t,stackParser:whe(t.stackParser||Eye),integrations:Rme(t),transport:t.transport||cye};return Ome(Kge,n)}function Y9(e={}){if(!Qe.document)return void(bs&&Me.error("Global document not defined in showReportDialog call"));const t=an(),n=t.getClient(),r=n&&n.getDsn();if(!r)return void(bs&&Me.error("DSN not configured for showReportDialog call"));if(t&&(e.user={...t.getUser(),...e.user}),!e.eventId){const t=yme();t&&(e.eventId=t)}const i=Qe.document.createElement("script");i.async=!0,i.crossOrigin="anonymous",i.src=Cme(r,e),e.onLoad&&(i.onload=e.onLoad);const{onClose:o}=e;if(o){const e=t=>{if("__sentry_reportdialog_closed__"===t.data)try{o()}finally{Qe.removeEventListener("message",e)}};Qe.addEventListener("message",e)}const s=Qe.document.head||Qe.document.body;s?s.appendChild(i):bs&&Me.error("Not injecting report dialog. No injection point found in HTML")}const J9=new WeakMap,Y2=new Map,hb={traceFetch:!0,traceXHR:!0,enableHTTPTimings:!0,trackFetchStreamPerformance:!1};function o0e(e,t){const{traceFetch:n,traceXHR:r,trackFetchStreamPerformance:i,shouldCreateSpanForRequest:o,enableHTTPTimings:s,tracePropagationTargets:a}={traceFetch:hb.traceFetch,traceXHR:hb.traceXHR,trackFetchStreamPerformance:hb.trackFetchStreamPerformance,...t},l="function"==typeof o?o:e=>!0,c=e=>c0e(e,a),u={};n&&(e.addEventProcessor((e=>("transaction"===e.type&&e.spans&&e.spans.forEach((e=>{if("http.client"===e.op){const t=Y2.get(e.span_id);t&&(e.timestamp=t/1e3,Y2.delete(e.span_id))}})),e))),i&&Tge((e=>{if(e.response){const t=J9.get(e.response);t&&e.endTimestamp&&Y2.set(t,e.endTimestamp)}})),gK((e=>{const t=yge(e,l,c,u);if(e.response&&e.fetchData.__span&&J9.set(e.response,e.fetchData.__span),t){const n=NK(e.fetchData.url),r=n?xd(n).host:void 0;t.setAttributes({"http.url":n,"server.address":r})}s&&t&&X9(t)}))),r&&OK((e=>{const t=u0e(e,l,c,u);s&&t&&X9(t)}))}function a0e(e){return"resource"===e.entryType&&"initiatorType"in e&&"string"==typeof e.nextHopProtocol&&("fetch"===e.initiatorType||"xmlhttprequest"===e.initiatorType)}function X9(e){const{url:t}=Vt(e).data||{};if(!t||"string"!=typeof t)return;const n=Fv("resource",(({entries:r})=>{r.forEach((r=>{a0e(r)&&r.name.endsWith(t)&&(l0e(r).forEach((t=>e.setAttribute(...t))),setTimeout(n))}))}))}function ea(e=0){return((es||performance.timeOrigin)+e)/1e3}function l0e(e){const{name:t,version:n}=LK(e.nextHopProtocol),r=[];return r.push(["network.protocol.version",n],["network.protocol.name",t]),es?[...r,["http.request.redirect_start",ea(e.redirectStart)],["http.request.fetch_start",ea(e.fetchStart)],["http.request.domain_lookup_start",ea(e.domainLookupStart)],["http.request.domain_lookup_end",ea(e.domainLookupEnd)],["http.request.connect_start",ea(e.connectStart)],["http.request.secure_connection_start",ea(e.secureConnectionStart)],["http.request.connection_end",ea(e.connectEnd)],["http.request.request_start",ea(e.requestStart)],["http.request.response_start",ea(e.responseStart)],["http.request.response_end",ea(e.responseEnd)]]:r}function c0e(e,t){const n=Qe.location&&Qe.location.href;if(n){let r,i;try{r=new URL(e,n),i=new URL(n).origin}catch{return!1}const o=r.origin===i;return t?Rd(r.toString(),t)||o&&Rd(r.pathname,t):o}{const n=!!e.match(/^\/(?!\/)/);return t?Rd(e,t):n}}function u0e(e,t,n,r){const i=e.xhr,o=i&&i[Eh];if(!i||i.__sentry_own_request__||!o)return;const s=mu()&&t(o.url);if(e.endTimestamp&&s){const e=i.__sentry_xhr_span_id__;if(!e)return;const t=r[e];return void(t&&void 0!==o.status_code&&(Aq(t,o.status_code),t.end(),delete r[e]))}const a=NK(o.url),l=a?xd(a).host:void 0,c=!!Zr(),u=s&&c?Py({name:`${o.method} ${o.url}`,attributes:{type:"xhr","http.method":o.method,"http.url":a,url:o.url,"server.address":l,[lr]:"auto.http.browser",[jl]:"http.client"}}):new Hp;return i.__sentry_xhr_span_id__=u.spanContext().spanId,r[i.__sentry_xhr_span_id__]=u,n(o.url)&&d0e(i,mu()&&c?u:void 0),u}function d0e(e,t){const{"sentry-trace":n,baggage:r}=dK({span:t});n&&f0e(e,n,r)}function f0e(e,t,n){try{e.setRequestHeader("sentry-trace",t),n&&e.setRequestHeader("baggage",n)}catch{}}function NK(e){try{return new URL(e,Qe.location.origin).href}catch{return}}function h0e(){Qe&&Qe.document?Qe.document.addEventListener("visibilitychange",(()=>{const e=Zr();if(!e)return;const t=Xr(e);if(Qe.document.hidden&&t){const e="cancelled",{op:n,status:r}=Vt(t);bs&&Me.log(`[Tracing] Transaction: ${e} -> since tab moved to the background, op: ${n}`),r||t.setStatus({code:2,message:e}),t.setAttribute("sentry.cancellation_reason","document.hidden"),t.end()}})):bs&&Me.warn("[Tracing] Could not set up background tab detection due to lack of global document")}const p0e="BrowserTracing",m0e={...ub,instrumentNavigation:!0,instrumentPageLoad:!0,markBackgroundSpan:!0,enableLongTask:!0,enableLongAnimationFrame:!0,enableInp:!0,_experiments:{},...hb},g0e=(e={})=>{mpe();const{enableInp:t,enableLongTask:n,enableLongAnimationFrame:r,_experiments:{enableInteractions:i,enableStandaloneClsSpans:o},beforeStartSpan:s,idleTimeout:a,finalTimeout:l,childSpanTimeout:c,markBackgroundSpan:u,traceFetch:d,traceXHR:h,trackFetchStreamPerformance:p,shouldCreateSpanForRequest:f,enableHTTPTimings:m,instrumentPageLoad:v,instrumentNavigation:g}={...m0e,...e},y=Mve({recordClsStandaloneSpans:o||!1});t&&oye(),r&&Ft.PerformanceObserver&&PerformanceObserver.supportedEntryTypes&&PerformanceObserver.supportedEntryTypes.includes("long-animation-frame")?Nve():n&&Ave(),i&&Dve();const b={name:void 0,source:void 0};function _(e,t){const n="pageload"===t.op,r=s?s(t):t,i=r.attributes||{};t.name!==r.name&&(i[Bs]="custom",r.attributes=i),b.name=r.name,b.source=i[Bs];const u=nK(r,{idleTimeout:a,finalTimeout:l,childSpanTimeout:c,disableAutoFinish:n,beforeSpanEnd:e=>{y(),Hve(e,{recordClsOnPageloadSpan:!o})}});function d(){["interactive","complete"].includes(Qe.document.readyState)&&e.emit("idleSpanEnableAutoFinish",u)}return n&&Qe.document&&(Qe.document.addEventListener("readystatechange",(()=>{d()})),d()),u}return{name:p0e,afterAllSetup(e){let n,r=Qe.location&&Qe.location.href;function o(){n&&!Vt(n).timestamp&&(bs&&Me.log(`[Tracing] Finishing current active span with op: ${Vt(n).op}`),n.end())}e.on("startNavigationSpan",(t=>{qt()===e&&(o(),n=_(e,{op:"navigation",...t}))})),e.on("startPageLoadSpan",((t,r={})=>{if(qt()!==e)return;o();const i=lpe(r.sentryTrace||Z9("sentry-trace"),r.baggage||Z9("baggage"));an().setPropagationContext(i),n=_(e,{op:"pageload",...t})})),e.on("spanEnd",(e=>{const t=Vt(e).op;if(e!==Xr(e)||"navigation"!==t&&"pageload"!==t)return;const n=an(),r=n.getPropagationContext();n.setPropagationContext({...r,sampled:void 0!==r.sampled?r.sampled:ef(e),dsc:r.dsc||Bp(e)})})),Qe.location&&(v&&DK(e,{name:Qe.location.pathname,startTime:es?es/1e3:void 0,attributes:{[Bs]:"url",[lr]:"auto.pageload.browser"}}),g&&KL((({to:t,from:n})=>{void 0===n&&r&&-1!==r.indexOf(t)?r=void 0:n!==t&&(r=void 0,jK(e,{name:Qe.location.pathname,attributes:{[Bs]:"url",[lr]:"auto.navigation.browser"}}))}))),u&&h0e(),i&&v0e(a,l,c,b),t&&lye(),o0e(e,{traceFetch:d,traceXHR:h,trackFetchStreamPerformance:p,tracePropagationTargets:e.getOptions().tracePropagationTargets,shouldCreateSpanForRequest:f,enableHTTPTimings:m})}}};function DK(e,t,n){e.emit("startPageLoadSpan",t,n),an().setTransactionName(t.name);const r=Zr();return"pageload"===(r&&Vt(r).op)?r:void 0}function jK(e,t){Na().setPropagationContext({traceId:fu()}),an().setPropagationContext({traceId:fu()}),e.emit("startNavigationSpan",t),an().setTransactionName(t.name);const n=Zr();return"navigation"===(n&&Vt(n).op)?n:void 0}function Z9(e){const t=Ahe(`meta[name=${e}]`);return t?t.getAttribute("content"):void 0}function v0e(e,t,n,r){let i;Qe.document&&addEventListener("click",(()=>{const o="ui.action.click",s=Zr(),a=s&&Xr(s);if(a){const e=Vt(a).op;if(["navigation","pageload"].includes(e))return void(bs&&Me.warn(`[Tracing] Did not create ${o} span because a pageload or navigation span is in progress.`))}i&&(i.setAttribute(T3,"interactionInterrupted"),i.end(),i=void 0),r.name?i=nK({name:r.name,op:o,attributes:{[Bs]:r.source||"url"}},{idleTimeout:e,finalTimeout:t,childSpanTimeout:n}):bs&&Me.warn(`[Tracing] Did not create ${o} transaction because _latestRouteName is missing.`)}),{once:!1,capture:!0})}function y0e(e){const t={...e};return uK(t,"react"),vme("react",{version:_.version}),s0e(t)}function _0e(e){const t=e.match(/^([^.]+)/);return null!==t&&parseInt(t[0])>=17}function b0e(e,t){const n=new WeakSet;!function e(t,r){if(!n.has(t)){if(t.cause)return n.add(t),e(t.cause,r);t.cause=r}}(e,t)}function S0e(e,{componentStack:t},n){if(_0e(_.version)&&JE(e)&&t){const n=new Error(e.message);n.name=`React ErrorBoundary ${e.name}`,n.stack=t,b0e(e,n)}return rw(e,{...n,captureContext:{contexts:{react:{componentStack:t}}}})}var Q9,e7,X2,t7,J2={exports:{}},Kt={};function E0e(){if(Q9)return Kt;Q9=1;var e="function"==typeof Symbol&&Symbol.for,t=e?Symbol.for("react.element"):60103,n=e?Symbol.for("react.portal"):60106,r=e?Symbol.for("react.fragment"):60107,i=e?Symbol.for("react.strict_mode"):60108,o=e?Symbol.for("react.profiler"):60114,s=e?Symbol.for("react.provider"):60109,a=e?Symbol.for("react.context"):60110,l=e?Symbol.for("react.async_mode"):60111,c=e?Symbol.for("react.concurrent_mode"):60111,u=e?Symbol.for("react.forward_ref"):60112,d=e?Symbol.for("react.suspense"):60113,h=e?Symbol.for("react.suspense_list"):60120,p=e?Symbol.for("react.memo"):60115,f=e?Symbol.for("react.lazy"):60116,m=e?Symbol.for("react.block"):60121,v=e?Symbol.for("react.fundamental"):60117,g=e?Symbol.for("react.responder"):60118,y=e?Symbol.for("react.scope"):60119;function b(e){if("object"==typeof e&&null!==e){var h=e.$$typeof;switch(h){case t:switch(e=e.type){case l:case c:case r:case o:case i:case d:return e;default:switch(e=e&&e.$$typeof){case a:case u:case f:case p:case s:return e;default:return h}}case n:return h}}}function _(e){return b(e)===c}return Kt.AsyncMode=l,Kt.ConcurrentMode=c,Kt.ContextConsumer=a,Kt.ContextProvider=s,Kt.Element=t,Kt.ForwardRef=u,Kt.Fragment=r,Kt.Lazy=f,Kt.Memo=p,Kt.Portal=n,Kt.Profiler=o,Kt.StrictMode=i,Kt.Suspense=d,Kt.isAsyncMode=function(e){return _(e)||b(e)===l},Kt.isConcurrentMode=_,Kt.isContextConsumer=function(e){return b(e)===a},Kt.isContextProvider=function(e){return b(e)===s},Kt.isElement=function(e){return"object"==typeof e&&null!==e&&e.$$typeof===t},Kt.isForwardRef=function(e){return b(e)===u},Kt.isFragment=function(e){return b(e)===r},Kt.isLazy=function(e){return b(e)===f},Kt.isMemo=function(e){return b(e)===p},Kt.isPortal=function(e){return b(e)===n},Kt.isProfiler=function(e){return b(e)===o},Kt.isStrictMode=function(e){return b(e)===i},Kt.isSuspense=function(e){return b(e)===d},Kt.isValidElementType=function(e){return"string"==typeof e||"function"==typeof e||e===r||e===c||e===o||e===i||e===d||e===h||"object"==typeof e&&null!==e&&(e.$$typeof===f||e.$$typeof===p||e.$$typeof===s||e.$$typeof===a||e.$$typeof===u||e.$$typeof===v||e.$$typeof===g||e.$$typeof===y||e.$$typeof===m)},Kt.typeOf=b,Kt}function w0e(){return e7||(e7=1,J2.exports=E0e()),J2.exports}function C0e(){if(t7)return X2;t7=1;var e=w0e(),t={childContextTypes:!0,contextType:!0,contextTypes:!0,defaultProps:!0,displayName:!0,getDefaultProps:!0,getDerivedStateFromError:!0,getDerivedStateFromProps:!0,mixins:!0,propTypes:!0,type:!0},n={name:!0,length:!0,prototype:!0,caller:!0,callee:!0,arguments:!0,arity:!0},r={$$typeof:!0,compare:!0,defaultProps:!0,displayName:!0,propTypes:!0,type:!0},i={};function o(n){return e.isMemo(n)?r:i[n.$$typeof]||t}i[e.ForwardRef]={$$typeof:!0,render:!0,defaultProps:!0,displayName:!0,propTypes:!0},i[e.Memo]=r;var s=Object.defineProperty,a=Object.getOwnPropertyNames,l=Object.getOwnPropertySymbols,c=Object.getOwnPropertyDescriptor,u=Object.getPrototypeOf,d=Object.prototype;return X2=function e(t,r,i){if("string"!=typeof r){if(d){var h=u(r);h&&h!==d&&e(t,h,i)}var p=a(r);l&&(p=p.concat(l(r)));for(var f=o(t),m=o(r),v=0;v<p.length;++v){var g=p[v];if(!(n[g]||i&&i[g]||m&&m[g]||f&&f[g])){var y=c(r,g);try{s(t,g,y)}catch{}}}}return t},X2}var T0e=C0e();const R0e=Ko(T0e),UK=typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__,n7={componentStack:null,error:null,eventId:null};class ow extends _.Component{constructor(e){super(e),ow.prototype.__init.call(this),this.state=n7,this._openFallbackReportDialog=!0;const t=qt();t&&e.showDialog&&(this._openFallbackReportDialog=!1,this._cleanupHook=t.on("afterSendEvent",(t=>{!t.type&&this._lastEventId&&t.event_id===this._lastEventId&&Y9({...e.dialogOptions,eventId:this._lastEventId})})))}componentDidCatch(e,t){const{componentStack:n}=t,r=n??void 0,{beforeCapture:i,onError:o,showDialog:s,dialogOptions:a}=this.props;ew((l=>{i&&i(l,e,r);const c=null!=this.props.handled?this.props.handled:!!this.props.fallback,u=S0e(e,t,{mechanism:{handled:c}});o&&o(e,r,u),s&&(this._lastEventId=u,this._openFallbackReportDialog&&Y9({...a,eventId:u})),this.setState({error:e,componentStack:n,eventId:u})}))}componentDidMount(){const{onMount:e}=this.props;e&&e()}componentWillUnmount(){const{error:e,componentStack:t,eventId:n}=this.state,{onUnmount:r}=this.props;r&&r(e,t,n),this._cleanupHook&&(this._cleanupHook(),this._cleanupHook=void 0)}__init(){this.resetErrorBoundary=()=>{const{onReset:e}=this.props,{error:t,componentStack:n,eventId:r}=this.state;e&&e(t,n,r),this.setState(n7)}}render(){const{fallback:e,children:t}=this.props,n=this.state;if(n.error){let t;return t="function"==typeof e?_.createElement(e,{error:n.error,componentStack:n.componentStack,resetError:this.resetErrorBoundary,eventId:n.eventId}):e,_.isValidElement(t)?t:(e&&UK&&Me.warn("fallback did not produce a valid ReactElement"),null)}return"function"==typeof t?t():t}}let pb,mb,gb,vb,$d,wh=!1;const FK=new WeakSet,Z2=new Set;function I0e(e,t){const n=g0e({...e,instrumentPageLoad:!1,instrumentNavigation:!1}),{useEffect:r,useLocation:i,useNavigationType:o,createRoutesFromChildren:s,matchRoutes:a,stripBasename:l,instrumentPageLoad:c=!0,instrumentNavigation:u=!0}=e;return{...n,setup(){pb=r,mb=i,gb=o,$d=a,vb=s,wh=l||!1},afterAllSetup(e){n.afterAllSetup(e);const r=Qe&&Qe.location&&Qe.location.pathname;c&&r&&DK(e,{name:r,attributes:{[Bs]:"url",[jl]:"pageload",[lr]:`auto.pageload.react.reactrouter_v${t}`}}),u&&FK.add(e)}}}function k0e(e){const{location:t,routes:n,navigationType:r,version:i,matches:o,basename:s,allRoutes:a}=e,l=Array.isArray(o)?o:$d(n,t,s),c=qt();if(c&&FK.has(c)&&("PUSH"===r||"POP"===r)&&l){let e,r="url";const o=HK(t,a||n);o&&(e=$v(GL(a||n,t)),r="route"),(!o||!e)&&([e,r]=VK(n,t,l,s)),jK(c,{name:e,attributes:{[Bs]:r,[jl]:"navigation",[lr]:`auto.navigation.react.reactrouter_v${i}`}})}}function CS(e,t){if(!t||"/"===t||!e.toLowerCase().startsWith(t.toLowerCase()))return e;const n=t.endsWith("/")?t.length-1:t.length,r=e.charAt(n);return r&&"/"!==r?e:e.slice(n)||"/"}function x0e(e,t,n){const r=e||wh?CS(t,n):t;return["/"===r[r.length-1]||"/*"===r.slice(-2)?r.slice(0,-1):r,"route"]}function $K(e){return e.endsWith("*")}function r7(e,t){return $K(e)&&t.route.children&&t.route.children.length>0||!1}function P0e(e){return!(e.children||!e.element||!e.path||!e.path.endsWith("/*"))}function HK(e,t){const n=$d(t,e);if(n)for(const e of n)if(P0e(e.route)&&O0e(e))return!0;return!1}function BK(e,t=new Set){return t.has(e)||(t.add(e),e.children&&!e.index&&e.children.forEach((e=>{BK(e,t).forEach((e=>t.add(e)))}))),t}function L0e(e){return M0e(e.route.path||"")}function O0e(e){return e.params["*"]||""}function M0e(e){return"*"===e[e.length-1]?e.slice(0,-1):e}function nv(e){return"/"===e[e.length-1]?e.slice(0,-1):e}function $v(e){return"/"===e[0]?e:`/${e}`}function GL(e,t){const n=$d(e,t);if(!n||0===n.length)return"";for(const r of n)if(r.route.path&&"*"!==r.route.path){const n=L0e(r),i=CS(t.pathname,$v(r.pathnameBase));return nv(nv(n||"")+$v(GL(e.filter((e=>e!==r.route)),{pathname:i})))}return""}function VK(e,t,n,r=""){if(!e||0===e.length)return[wh?CS(t.pathname,r):t.pathname,"url"];let i="";if(n)for(const e of n){const n=e.route;if(n){if(n.index)return x0e(i,e.pathname,r);const o=n.path;if(o&&!r7(o,e)){const n="/"===o[0]||"/"===i[i.length-1]?o:`/${o}`;if(i=nv(i)+$v(n),nv(t.pathname)===nv(r+e.pathname))return U9(i)===U9(e.pathname)||$K(i)?(r7(i,e)&&(i=i.slice(0,-1)),[(wh?"":r)+i,"route"]):[(wh?"":r)+n,"route"]}}}return[wh?CS(t.pathname,r):t.pathname||"/","url"]}function A0e(e,t,n,r,i,o){const s=Array.isArray(r)?r:$d(o||n,t,i);if(s){let r,a="url";const l=HK(t,o||n);l&&(r=$v(GL(o||n,t)),a="route"),(!l||!r)&&([r,a]=VK(n,t,s,i)),an().setTransactionName(r||"/"),e&&(e.updateName(r),e.setAttribute(Bs,a))}}function N0e(e,t){if(!(pb&&mb&&gb&&vb&&$d))return UK&&Me.warn(`reactRouterV6Instrumentation was unable to wrap Routes because of one or more missing parameters.\n      useEffect: ${pb}. useLocation: ${mb}. useNavigationType: ${gb}.\n      createRoutesFromChildren: ${vb}. matchRoutes: ${$d}.`),e;const n=n=>{const r=_.useRef(!0),i=mb(),o=gb();return pb((()=>{const e=vb(n.children);r.current?(e.forEach((e=>{BK(e).forEach((e=>{Z2.add(e)}))})),A0e(D0e(),i,e,void 0,void 0,Array.from(Z2)),r.current=!1):k0e({location:i,routes:e,navigationType:o,version:t,allRoutes:Array.from(Z2)})}),[i,o]),_.createElement(e,{...n})};return R0e(n,e),n}function D0e(){const e=Zr(),t=e?Xr(e):void 0;if(!t)return;const n=Vt(t).op;return"navigation"===n||"pageload"===n?t:void 0}function j0e(e){return I0e(e,"7")}function U0e(e){return N0e(e,"7")}var i7,Q2={exports:{}};function F0e(){return i7||(i7=1,e=Q2,function(){var t={}.hasOwnProperty;function n(){for(var e="",t=0;t<arguments.length;t++){var n=arguments[t];n&&(e=i(e,r(n)))}return e}function r(e){if("string"==typeof e||"number"==typeof e)return e;if("object"!=typeof e)return"";if(Array.isArray(e))return n.apply(null,e);if(e.toString!==Object.prototype.toString&&!e.toString.toString().includes("[native code]"))return e.toString();var r="";for(var o in e)t.call(e,o)&&e[o]&&(r=i(r,o));return r}function i(e,t){return t?e?e+" "+t:e+t:e}e.exports?(n.default=n,e.exports=n):window.classNames=n}()),Q2.exports;var e}var $0e=F0e();const Ae=Ko($0e);function qK(e,t){return E.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:t,...e,children:E.jsx("path",{d:"m10.6 13.8-2.15-2.15a.948.948 0 0 0-.7-.275.948.948 0 0 0-.7.275.948.948 0 0 0-.275.7.95.95 0 0 0 .275.7L9.9 15.9c.2.2.433.3.7.3.267 0 .5-.1.7-.3l5.65-5.65a.948.948 0 0 0 .275-.7.948.948 0 0 0-.275-.7.948.948 0 0 0-.7-.275.948.948 0 0 0-.7.275L10.6 13.8ZM12 22a9.738 9.738 0 0 1-3.9-.788 10.099 10.099 0 0 1-3.175-2.137c-.9-.9-1.612-1.958-2.137-3.175A9.738 9.738 0 0 1 2 12a9.74 9.74 0 0 1 .788-3.9 10.099 10.099 0 0 1 2.137-3.175c.9-.9 1.958-1.612 3.175-2.137A9.738 9.738 0 0 1 12 2a9.74 9.74 0 0 1 3.9.788 10.098 10.098 0 0 1 3.175 2.137c.9.9 1.613 1.958 2.137 3.175A9.738 9.738 0 0 1 22 12a9.738 9.738 0 0 1-.788 3.9 10.098 10.098 0 0 1-2.137 3.175c-.9.9-1.958 1.613-3.175 2.137A9.738 9.738 0 0 1 12 22Zm0-2c2.233 0 4.125-.775 5.675-2.325C19.225 16.125 20 14.233 20 12c0-2.233-.775-4.125-2.325-5.675C16.125 4.775 14.233 4 12 4c-2.233 0-4.125.775-5.675 2.325C4.775 7.875 4 9.767 4 12c0 2.233.775 4.125 2.325 5.675C7.875 19.225 9.767 20 12 20Z"})})}qK.displayName="CheckCircleIcon";const H0e=_.forwardRef(qK);function KK(e,t){return E.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:t,...e,children:E.jsx("path",{d:"M12 17a.97.97 0 0 0 .713-.288A.968.968 0 0 0 13 16a.968.968 0 0 0-.287-.713A.968.968 0 0 0 12 15a.968.968 0 0 0-.713.287A.968.968 0 0 0 11 16c0 .283.096.52.287.712.192.192.43.288.713.288Zm0-4c.283 0 .52-.096.713-.287A.968.968 0 0 0 13 12V8a.967.967 0 0 0-.287-.713A.968.968 0 0 0 12 7a.968.968 0 0 0-.713.287A.967.967 0 0 0 11 8v4c0 .283.096.52.287.713.192.191.43.287.713.287Zm0 9a9.738 9.738 0 0 1-3.9-.788 10.099 10.099 0 0 1-3.175-2.137c-.9-.9-1.612-1.958-2.137-3.175A9.738 9.738 0 0 1 2 12a9.74 9.74 0 0 1 .788-3.9 10.099 10.099 0 0 1 2.137-3.175c.9-.9 1.958-1.612 3.175-2.137A9.738 9.738 0 0 1 12 2a9.74 9.74 0 0 1 3.9.788 10.098 10.098 0 0 1 3.175 2.137c.9.9 1.613 1.958 2.137 3.175A9.738 9.738 0 0 1 22 12a9.738 9.738 0 0 1-.788 3.9 10.098 10.098 0 0 1-2.137 3.175c-.9.9-1.958 1.613-3.175 2.137A9.738 9.738 0 0 1 12 22Z"})})}KK.displayName="ErrorIcon";const aw=_.forwardRef(KK);function GK(e,t){return E.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:t,...e,children:[E.jsx("path",{d:"M11.287 7.287A.968.968 0 0 1 12 7c.283 0 .52.096.713.287.191.192.287.43.287.713s-.096.52-.287.713A.968.968 0 0 1 12 9a.968.968 0 0 1-.713-.287A.967.967 0 0 1 11 8c0-.283.096-.52.287-.713Zm0 4A.968.968 0 0 1 12 11c.283 0 .52.096.713.287.191.192.287.43.287.713v4a.97.97 0 0 1-.287.712A.968.968 0 0 1 12 17a.968.968 0 0 1-.713-.288A.968.968 0 0 1 11 16v-4c0-.283.096-.52.287-.713Z"}),E.jsx("path",{fillRule:"evenodd",d:"M22 12c0 5.523-4.477 10-10 10S2 17.523 2 12 6.477 2 12 2s10 4.477 10 10Zm-2 0a8 8 0 1 1-16 0 8 8 0 0 1 16 0Z",clipRule:"evenodd"})]})}GK.displayName="InfoIcon";const B0e=_.forwardRef(GK);function WK(e,t){return E.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:t,...e,children:E.jsx("path",{d:"M6.293 6.293a1 1 0 0 1 1.414 0L12 10.586l4.293-4.293a1 1 0 1 1 1.414 1.414L13.414 12l4.293 4.293a1 1 0 0 1-1.414 1.414L12 13.414l-4.293 4.293a1 1 0 0 1-1.414-1.414L10.586 12 6.293 7.707a1 1 0 0 1 0-1.414Z"})})}WK.displayName="CloseIcon";const lw=_.forwardRef(WK),V0e="_alert_1bz08_19",q0e="_content_1bz08_46",K0e="_icon_1bz08_57",G0e="_actions_1bz08_73",Yf={alert:V0e,content:q0e,"text-content":"_text-content_1bz08_53",icon:K0e,actions:G0e},W0e="_typography_yh5dq_162",s7={"font-body-xs-regular":"_font-body-xs-regular_yh5dq_21","font-body-xs-semibold":"_font-body-xs-semibold_yh5dq_26","font-body-xs-medium":"_font-body-xs-medium_yh5dq_31","font-body-sm-regular":"_font-body-sm-regular_yh5dq_40","font-body-sm-semibold":"_font-body-sm-semibold_yh5dq_45","font-body-sm-medium":"_font-body-sm-medium_yh5dq_50","font-body-md-regular":"_font-body-md-regular_yh5dq_59","font-body-md-semibold":"_font-body-md-semibold_yh5dq_64","font-body-md-medium":"_font-body-md-medium_yh5dq_69","font-body-lg-regular":"_font-body-lg-regular_yh5dq_78","font-body-lg-semibold":"_font-body-lg-semibold_yh5dq_83","font-body-lg-medium":"_font-body-lg-medium_yh5dq_88","font-heading-sm-regular":"_font-heading-sm-regular_yh5dq_97","font-heading-sm-semibold":"_font-heading-sm-semibold_yh5dq_102","font-heading-sm-medium":"_font-heading-sm-medium_yh5dq_107","font-heading-md-regular":"_font-heading-md-regular_yh5dq_116","font-heading-md-semibold":"_font-heading-md-semibold_yh5dq_121","font-heading-lg-regular":"_font-heading-lg-regular_yh5dq_130","font-heading-lg-semibold":"_font-heading-lg-semibold_yh5dq_135","font-heading-xl-regular":"_font-heading-xl-regular_yh5dq_144","font-heading-xl-semibold":"_font-heading-xl-semibold_yh5dq_149",typography:W0e},zK=({as:e,children:t,type:n="body",weight:r="regular",size:i="md",className:o,...s})=>{const a=e||"p";return E.jsx(a,{...s,className:Ae(s7.typography,s7[`font-${n}-${i}-${r}`],o),children:t})},Jt=({as:e="p",children:t,...n})=>E.jsx(zK,{as:e,type:"body",...n,children:t}),z0e="_destructive_bh2qc_83",eR={"icon-button":"_icon-button_bh2qc_17","subtle-bg":"_subtle-bg_bh2qc_38",destructive:z0e},YK=_.forwardRef((function({as:e,children:t,className:n,disabled:r,...i},o){const s=e||"button",{onClick:a,onSubmit:l,onPointerDown:c,onPointerUp:u,onKeyDown:d,onKeyUp:h,onKeyPress:p,...f}=i,m=r?{}:{onClick:a,onSubmit:l,onPointerDown:c,onPointerUp:u,onKeyDown:d,onKeyUp:h,onKeyPress:p};return E.jsx(s,{...f,ref:o,className:n,role:"a"===e?"link":"button",tabIndex:0,...m,"aria-disabled":r,children:t})})),Y0e={"indicator-icon":"_indicator-icon_133tf_26"},J0e=_.forwardRef((function({children:e,className:t,size:n="100%",colour:r,indicator:i},o){const s=Ae(Y0e["indicator-icon"],t);return E.jsx("div",{ref:o,className:s,"data-indicator":i,style:{"--cpd-icon-button-size":n,"--cpd-color-icon-tertiary":r},children:we.Children.only(e)})})),JK=_.createContext(null);function WL(){const e=_.useContext(JK);if(null==e)throw new Error("Tooltip components must be wrapped in <Tooltip />");return e}function cw(){return typeof window<"u"}function Yp(e){return XK(e)?(e.nodeName||"").toLowerCase():"#document"}function Xi(e){var t;return(null==e||null==(t=e.ownerDocument)?void 0:t.defaultView)||window}function Da(e){var t;return null==(t=(XK(e)?e.ownerDocument:e.document)||window.document)?void 0:t.documentElement}function XK(e){return!!cw()&&(e instanceof Node||e instanceof Xi(e).Node)}function fn(e){return!!cw()&&(e instanceof Element||e instanceof Xi(e).Element)}function Ss(e){return!!cw()&&(e instanceof HTMLElement||e instanceof Xi(e).HTMLElement)}function B3(e){return!(!cw()||typeof ShadowRoot>"u")&&(e instanceof ShadowRoot||e instanceof Xi(e).ShadowRoot)}function Ny(e){const{overflow:t,overflowX:n,overflowY:r,display:i}=Es(e);return/auto|scroll|overlay|hidden|clip/.test(t+r+n)&&!["inline","contents"].includes(i)}function X0e(e){return["table","td","th"].includes(Yp(e))}function uw(e){return[":popover-open",":modal"].some((t=>{try{return e.matches(t)}catch{return!1}}))}function zL(e){const t=dw(),n=fn(e)?Es(e):e;return["transform","translate","scale","rotate","perspective"].some((e=>!!n[e]&&"none"!==n[e]))||!!n.containerType&&"normal"!==n.containerType||!t&&!!n.backdropFilter&&"none"!==n.backdropFilter||!t&&!!n.filter&&"none"!==n.filter||["transform","translate","scale","rotate","perspective","filter"].some((e=>(n.willChange||"").includes(e)))||["paint","layout","strict","content"].some((e=>(n.contain||"").includes(e)))}function Z0e(e){let t=Fl(e);for(;Ss(t)&&!Tl(t);){if(zL(t))return t;if(uw(t))return null;t=Fl(t)}return null}function dw(){return!(typeof CSS>"u"||!CSS.supports)&&CSS.supports("-webkit-backdrop-filter","none")}function Tl(e){return["html","body","#document"].includes(Yp(e))}function Es(e){return Xi(e).getComputedStyle(e)}function fw(e){return fn(e)?{scrollLeft:e.scrollLeft,scrollTop:e.scrollTop}:{scrollLeft:e.scrollX,scrollTop:e.scrollY}}function Fl(e){if("html"===Yp(e))return e;const t=e.assignedSlot||e.parentNode||B3(e)&&e.host||Da(e);return B3(t)?t.host:t}function ZK(e){const t=Fl(e);return Tl(t)?e.ownerDocument?e.ownerDocument.body:e.body:Ss(t)&&Ny(t)?t:ZK(t)}function Qc(e,t,n){var r;void 0===t&&(t=[]),void 0===n&&(n=!0);const i=ZK(e),o=i===(null==(r=e.ownerDocument)?void 0:r.body),s=Xi(i);if(o){const e=V3(s);return t.concat(s,s.visualViewport||[],Ny(i)?i:[],e&&n?Qc(e):[])}return t.concat(i,Qc(i,[],n))}function V3(e){return e.parent&&Object.getPrototypeOf(e.parent)?e.frameElement:null}function q3(e){let t=e.activeElement;for(;null!=(null==(n=t)||null==(n=n.shadowRoot)?void 0:n.activeElement);){var n;t=t.shadowRoot.activeElement}return t}function yp(e,t){if(!e||!t)return!1;const n=null==t.getRootNode?void 0:t.getRootNode();if(e.contains(t))return!0;if(n&&B3(n)){let n=t;for(;n;){if(e===n)return!0;n=n.parentNode||n.host}}return!1}function QK(){const e=navigator.userAgentData;return null!=e&&e.platform?e.platform:navigator.platform}function eG(){const e=navigator.userAgentData;return e&&Array.isArray(e.brands)?e.brands.map((e=>{let{brand:t,version:n}=e;return t+"/"+n})).join(" "):navigator.userAgent}function Q0e(e){return!t1e()&&(!o7()&&0===e.width&&0===e.height||o7()&&1===e.width&&1===e.height&&0===e.pressure&&0===e.detail&&"mouse"===e.pointerType||e.width<1&&e.height<1&&0===e.pressure&&0===e.detail&&"touch"===e.pointerType)}function tG(){return/apple/i.test(navigator.vendor)}function o7(){const e=/android/i;return e.test(QK())||e.test(eG())}function e1e(){return QK().toLowerCase().startsWith("mac")&&!navigator.maxTouchPoints}function t1e(){return eG().includes("jsdom/")}function K3(e,t){const n=["mouse","pen"];return n.push("",void 0),n.includes(e)}function n1e(e){return"nativeEvent"in e}function r1e(e){return e.matches("html,body")}function Vc(e){return(null==e?void 0:e.ownerDocument)||document}function tR(e,t){if(null==t)return!1;if("composedPath"in e)return e.composedPath().includes(t);const n=e;return null!=n.target&&t.contains(n.target)}function ph(e){return"composedPath"in e?e.composedPath()[0]:e.target}const i1e="input:not([type='hidden']):not([disabled]),[contenteditable]:not([contenteditable='false']),textarea:not([disabled])";function s1e(e){return Ss(e)&&e.matches(i1e)}const o1e=["top","right","bottom","left"],gu=Math.min,vs=Math.max,TS=Math.round,q1=Math.floor,wa=e=>({x:e,y:e}),a1e={left:"right",right:"left",bottom:"top",top:"bottom"},l1e={start:"end",end:"start"};function G3(e,t,n){return vs(e,gu(t,n))}function $l(e,t){return"function"==typeof e?e(t):e}function Hl(e){return e.split("-")[0]}function Jp(e){return e.split("-")[1]}function YL(e){return"x"===e?"y":"x"}function JL(e){return"y"===e?"height":"width"}function vu(e){return["top","bottom"].includes(Hl(e))?"y":"x"}function XL(e){return YL(vu(e))}function c1e(e,t,n){void 0===n&&(n=!1);const r=Jp(e),i=XL(e),o=JL(i);let s="x"===i?r===(n?"end":"start")?"right":"left":"start"===r?"bottom":"top";return t.reference[o]>t.floating[o]&&(s=RS(s)),[s,RS(s)]}function u1e(e){const t=RS(e);return[W3(e),t,W3(t)]}function W3(e){return e.replace(/start|end/g,(e=>l1e[e]))}function d1e(e,t,n){const r=["left","right"],i=["right","left"],o=["top","bottom"],s=["bottom","top"];switch(e){case"top":case"bottom":return n?t?i:r:t?r:i;case"left":case"right":return t?o:s;default:return[]}}function f1e(e,t,n,r){const i=Jp(e);let o=d1e(Hl(e),"start"===n,r);return i&&(o=o.map((e=>e+"-"+i)),t&&(o=o.concat(o.map(W3)))),o}function RS(e){return e.replace(/left|right|bottom|top/g,(e=>a1e[e]))}function h1e(e){return{top:0,right:0,bottom:0,left:0,...e}}function nG(e){return"number"!=typeof e?h1e(e):{top:e,right:e,bottom:e,left:e}}function IS(e){const{x:t,y:n,width:r,height:i}=e;return{width:r,height:i,top:n,left:t,right:t+r,bottom:n+i,x:t,y:n}}var p1e=["input:not([inert])","select:not([inert])","textarea:not([inert])","a[href]:not([inert])","button:not([inert])","[tabindex]:not(slot):not([inert])","audio[controls]:not([inert])","video[controls]:not([inert])",'[contenteditable]:not([contenteditable="false"]):not([inert])',"details>summary:first-of-type:not([inert])","details:not([inert])"],z3=p1e.join(","),rG=typeof Element>"u",Hv=rG?function(){}:Element.prototype.matches||Element.prototype.msMatchesSelector||Element.prototype.webkitMatchesSelector,kS=!rG&&Element.prototype.getRootNode?function(e){var t;return null==e||null===(t=e.getRootNode)||void 0===t?void 0:t.call(e)}:function(e){return null==e?void 0:e.ownerDocument},xS=function e(t,n){var r;void 0===n&&(n=!0);var i=null==t||null===(r=t.getAttribute)||void 0===r?void 0:r.call(t,"inert");return""===i||"true"===i||n&&t&&e(t.parentNode)},m1e=function(e){var t,n=null==e||null===(t=e.getAttribute)||void 0===t?void 0:t.call(e,"contenteditable");return""===n||"true"===n},g1e=function(e,t,n){if(xS(e))return[];var r=Array.prototype.slice.apply(e.querySelectorAll(z3));return t&&Hv.call(e,z3)&&r.unshift(e),r=r.filter(n)},v1e=function e(t,n,r){for(var i=[],o=Array.from(t);o.length;){var s=o.shift();if(!xS(s,!1))if("SLOT"===s.tagName){var a=s.assignedElements(),l=e(a.length?a:s.children,!0,r);r.flatten?i.push.apply(i,l):i.push({scopeParent:s,candidates:l})}else{Hv.call(s,z3)&&r.filter(s)&&(n||!t.includes(s))&&i.push(s);var c=s.shadowRoot||"function"==typeof r.getShadowRoot&&r.getShadowRoot(s),u=!xS(c,!1)&&(!r.shadowRootFilter||r.shadowRootFilter(s));if(c&&u){var d=e(!0===c?s.children:c.children,!0,r);r.flatten?i.push.apply(i,d):i.push({scopeParent:s,candidates:d})}else o.unshift.apply(o,s.children)}}return i},iG=function(e){return!isNaN(parseInt(e.getAttribute("tabindex"),10))},sG=function(e){if(!e)throw new Error("No node provided");return e.tabIndex<0&&(/^(AUDIO|VIDEO|DETAILS)$/.test(e.tagName)||m1e(e))&&!iG(e)?0:e.tabIndex},y1e=function(e,t){var n=sG(e);return n<0&&t&&!iG(e)?0:n},_1e=function(e,t){return e.tabIndex===t.tabIndex?e.documentOrder-t.documentOrder:e.tabIndex-t.tabIndex},oG=function(e){return"INPUT"===e.tagName},b1e=function(e){return oG(e)&&"hidden"===e.type},S1e=function(e){return"DETAILS"===e.tagName&&Array.prototype.slice.apply(e.children).some((function(e){return"SUMMARY"===e.tagName}))},E1e=function(e,t){for(var n=0;n<e.length;n++)if(e[n].checked&&e[n].form===t)return e[n]},w1e=function(e){if(!e.name)return!0;var t,n=e.form||kS(e),r=function(e){return n.querySelectorAll('input[type="radio"][name="'+e+'"]')};if(typeof window<"u"&&typeof window.CSS<"u"&&"function"==typeof window.CSS.escape)t=r(window.CSS.escape(e.name));else try{t=r(e.name)}catch(e){return console.error("Looks like you have a radio button with a name attribute containing invalid CSS selector characters and need the CSS.escape polyfill: %s",e.message),!1}var i=E1e(t,e.form);return!i||i===e},C1e=function(e){return oG(e)&&"radio"===e.type},T1e=function(e){return C1e(e)&&!w1e(e)},R1e=function(e){var t,n,r,i,o=e&&kS(e),s=null===(t=o)||void 0===t?void 0:t.host,a=!1;if(o&&o!==e)for(a=!!(null!==(n=s)&&void 0!==n&&null!==(r=n.ownerDocument)&&void 0!==r&&r.contains(s)||null!=e&&null!==(i=e.ownerDocument)&&void 0!==i&&i.contains(e));!a&&s;){var l,c,u;a=!(null===(c=s=null===(l=o=kS(s))||void 0===l?void 0:l.host)||void 0===c||null===(u=c.ownerDocument)||void 0===u||!u.contains(s))}return a},a7=function(e){var t=e.getBoundingClientRect(),n=t.width,r=t.height;return 0===n&&0===r},I1e=function(e,t){var n=t.displayCheck,r=t.getShadowRoot;if("hidden"===getComputedStyle(e).visibility)return!0;var i=Hv.call(e,"details>summary:first-of-type")?e.parentElement:e;if(Hv.call(i,"details:not([open]) *"))return!0;if(n&&"full"!==n&&"legacy-full"!==n){if("non-zero-area"===n)return a7(e)}else{if("function"==typeof r){for(var o=e;e;){var s=e.parentElement,a=kS(e);if(s&&!s.shadowRoot&&!0===r(s))return a7(e);e=e.assignedSlot?e.assignedSlot:s||a===e.ownerDocument?s:a.host}e=o}if(R1e(e))return!e.getClientRects().length;if("legacy-full"!==n)return!0}return!1},k1e=function(e){if(/^(INPUT|BUTTON|SELECT|TEXTAREA)$/.test(e.tagName))for(var t=e.parentElement;t;){if("FIELDSET"===t.tagName&&t.disabled){for(var n=0;n<t.children.length;n++){var r=t.children.item(n);if("LEGEND"===r.tagName)return!!Hv.call(t,"fieldset[disabled] *")||!r.contains(e)}return!0}t=t.parentElement}return!1},x1e=function(e,t){return!(t.disabled||xS(t)||b1e(t)||I1e(t,e)||S1e(t)||k1e(t))},l7=function(e,t){return!(T1e(t)||sG(t)<0||!x1e(e,t))},P1e=function(e){var t=parseInt(e.getAttribute("tabindex"),10);return!!(isNaN(t)||t>=0)},L1e=function e(t){var n=[],r=[];return t.forEach((function(t,i){var o=!!t.scopeParent,s=o?t.scopeParent:t,a=y1e(s,o),l=o?e(t.candidates):s;0===a?o?n.push.apply(n,l):n.push(s):r.push({documentOrder:i,tabIndex:a,item:t,isScope:o,content:l})})),r.sort(_1e).reduce((function(e,t){return t.isScope?e.push.apply(e,t.content):e.push(t.content),e}),[]).concat(n)},aG=function(e,t){var n;return n=(t=t||{}).getShadowRoot?v1e([e],t.includeContainer,{filter:l7.bind(null,t),flatten:!1,getShadowRoot:t.getShadowRoot,shadowRootFilter:P1e}):g1e(e,t.includeContainer,l7.bind(null,t)),L1e(n)};function c7(e,t,n){let{reference:r,floating:i}=e;const o=vu(t),s=XL(t),a=JL(s),l=Hl(t),c="y"===o,u=r.x+r.width/2-i.width/2,d=r.y+r.height/2-i.height/2,h=r[a]/2-i[a]/2;let p;switch(l){case"top":p={x:u,y:r.y-i.height};break;case"bottom":p={x:u,y:r.y+r.height};break;case"right":p={x:r.x+r.width,y:d};break;case"left":p={x:r.x-i.width,y:d};break;default:p={x:r.x,y:r.y}}switch(Jp(t)){case"start":p[s]-=h*(n&&c?-1:1);break;case"end":p[s]+=h*(n&&c?-1:1)}return p}const O1e=async(e,t,n)=>{const{placement:r="bottom",strategy:i="absolute",middleware:o=[],platform:s}=n,a=o.filter(Boolean),l=await(null==s.isRTL?void 0:s.isRTL(t));let c=await s.getElementRects({reference:e,floating:t,strategy:i}),{x:u,y:d}=c7(c,r,l),h=r,p={},f=0;for(let n=0;n<a.length;n++){const{name:o,fn:m}=a[n],{x:v,y:g,data:y,reset:b}=await m({x:u,y:d,initialPlacement:r,placement:h,strategy:i,middlewareData:p,rects:c,platform:s,elements:{reference:e,floating:t}});u=v??u,d=g??d,p={...p,[o]:{...p[o],...y}},b&&f<=50&&(f++,"object"==typeof b&&(b.placement&&(h=b.placement),b.rects&&(c=!0===b.rects?await s.getElementRects({reference:e,floating:t,strategy:i}):b.rects),({x:u,y:d}=c7(c,h,l))),n=-1)}return{x:u,y:d,placement:h,strategy:i,middlewareData:p}};async function Bv(e,t){var n;void 0===t&&(t={});const{x:r,y:i,platform:o,rects:s,elements:a,strategy:l}=e,{boundary:c="clippingAncestors",rootBoundary:u="viewport",elementContext:d="floating",altBoundary:h=!1,padding:p=0}=$l(t,e),f=nG(p),m=a[h?"floating"===d?"reference":"floating":d],v=IS(await o.getClippingRect({element:null==(n=await(null==o.isElement?void 0:o.isElement(m)))||n?m:m.contextElement||await(null==o.getDocumentElement?void 0:o.getDocumentElement(a.floating)),boundary:c,rootBoundary:u,strategy:l})),g="floating"===d?{x:r,y:i,width:s.floating.width,height:s.floating.height}:s.reference,y=await(null==o.getOffsetParent?void 0:o.getOffsetParent(a.floating)),b=await(null==o.isElement?void 0:o.isElement(y))&&await(null==o.getScale?void 0:o.getScale(y))||{x:1,y:1},_=IS(o.convertOffsetParentRelativeRectToViewportRelativeRect?await o.convertOffsetParentRelativeRectToViewportRelativeRect({elements:a,rect:g,offsetParent:y,strategy:l}):g);return{top:(v.top-_.top+f.top)/b.y,bottom:(_.bottom-v.bottom+f.bottom)/b.y,left:(v.left-_.left+f.left)/b.x,right:(_.right-v.right+f.right)/b.x}}const M1e=e=>({name:"arrow",options:e,async fn(t){const{x:n,y:r,placement:i,rects:o,platform:s,elements:a,middlewareData:l}=t,{element:c,padding:u=0}=$l(e,t)||{};if(null==c)return{};const d=nG(u),h={x:n,y:r},p=XL(i),f=JL(p),m=await s.getDimensions(c),v="y"===p,g=v?"top":"left",y=v?"bottom":"right",b=v?"clientHeight":"clientWidth",_=o.reference[f]+o.reference[p]-h[p]-o.floating[f],w=h[p]-o.reference[p],E=await(null==s.getOffsetParent?void 0:s.getOffsetParent(c));let S=E?E[b]:0;(!S||!await(null==s.isElement?void 0:s.isElement(E)))&&(S=a.floating[b]||o.floating[f]);const C=_/2-w/2,k=S/2-m[f]/2-1,T=gu(d[g],k),I=gu(d[y],k),R=T,x=S-m[f]-I,L=S/2-m[f]/2+C,P=G3(R,L,x),O=!l.arrow&&null!=Jp(i)&&L!==P&&o.reference[f]/2-(L<R?T:I)-m[f]/2<0,A=O?L<R?L-R:L-x:0;return{[p]:h[p]+A,data:{[p]:P,centerOffset:L-P-A,...O&&{alignmentOffset:A}},reset:O}}}),A1e=function(e){return void 0===e&&(e={}),{name:"flip",options:e,async fn(t){var n,r;const{placement:i,middlewareData:o,rects:s,initialPlacement:a,platform:l,elements:c}=t,{mainAxis:u=!0,crossAxis:d=!0,fallbackPlacements:h,fallbackStrategy:p="bestFit",fallbackAxisSideDirection:f="none",flipAlignment:m=!0,...v}=$l(e,t);if(null!=(n=o.arrow)&&n.alignmentOffset)return{};const g=Hl(i),y=vu(a),b=Hl(a)===a,_=await(null==l.isRTL?void 0:l.isRTL(c.floating)),w=h||(b||!m?[RS(a)]:u1e(a)),E="none"!==f;!h&&E&&w.push(...f1e(a,m,f,_));const S=[a,...w],C=await Bv(t,v),k=[];let T=(null==(r=o.flip)?void 0:r.overflows)||[];if(u&&k.push(C[g]),d){const e=c1e(i,s,_);k.push(C[e[0]],C[e[1]])}if(T=[...T,{placement:i,overflows:k}],!k.every((e=>e<=0))){var I,R;const e=((null==(I=o.flip)?void 0:I.index)||0)+1,t=S[e];if(t)return{data:{index:e,overflows:T},reset:{placement:t}};let n=null==(R=T.filter((e=>e.overflows[0]<=0)).sort(((e,t)=>e.overflows[1]-t.overflows[1]))[0])?void 0:R.placement;if(!n)switch(p){case"bestFit":{var x;const e=null==(x=T.filter((e=>{if(E){const t=vu(e.placement);return t===y||"y"===t}return!0})).map((e=>[e.placement,e.overflows.filter((e=>e>0)).reduce(((e,t)=>e+t),0)])).sort(((e,t)=>e[1]-t[1]))[0])?void 0:x[0];e&&(n=e);break}case"initialPlacement":n=a}if(i!==n)return{reset:{placement:n}}}return{}}}};function u7(e,t){return{top:e.top-t.height,right:e.right-t.width,bottom:e.bottom-t.height,left:e.left-t.width}}function d7(e){return o1e.some((t=>e[t]>=0))}const N1e=function(e){return void 0===e&&(e={}),{name:"hide",options:e,async fn(t){const{rects:n}=t,{strategy:r="referenceHidden",...i}=$l(e,t);switch(r){case"referenceHidden":{const e=u7(await Bv(t,{...i,elementContext:"reference"}),n.reference);return{data:{referenceHiddenOffsets:e,referenceHidden:d7(e)}}}case"escaped":{const e=u7(await Bv(t,{...i,altBoundary:!0}),n.floating);return{data:{escapedOffsets:e,escaped:d7(e)}}}default:return{}}}}};async function D1e(e,t){const{placement:n,platform:r,elements:i}=e,o=await(null==r.isRTL?void 0:r.isRTL(i.floating)),s=Hl(n),a=Jp(n),l="y"===vu(n),c=["left","top"].includes(s)?-1:1,u=o&&l?-1:1,d=$l(t,e);let{mainAxis:h,crossAxis:p,alignmentAxis:f}="number"==typeof d?{mainAxis:d,crossAxis:0,alignmentAxis:null}:{mainAxis:d.mainAxis||0,crossAxis:d.crossAxis||0,alignmentAxis:d.alignmentAxis};return a&&"number"==typeof f&&(p="end"===a?-1*f:f),l?{x:p*u,y:h*c}:{x:h*c,y:p*u}}const j1e=function(e){return void 0===e&&(e=0),{name:"offset",options:e,async fn(t){var n,r;const{x:i,y:o,placement:s,middlewareData:a}=t,l=await D1e(t,e);return s===(null==(n=a.offset)?void 0:n.placement)&&null!=(r=a.arrow)&&r.alignmentOffset?{}:{x:i+l.x,y:o+l.y,data:{...l,placement:s}}}}},U1e=function(e){return void 0===e&&(e={}),{name:"shift",options:e,async fn(t){const{x:n,y:r,placement:i}=t,{mainAxis:o=!0,crossAxis:s=!1,limiter:a={fn:e=>{let{x:t,y:n}=e;return{x:t,y:n}}},...l}=$l(e,t),c={x:n,y:r},u=await Bv(t,l),d=vu(Hl(i)),h=YL(d);let p=c[h],f=c[d];if(o){const e="y"===h?"bottom":"right";p=G3(p+u["y"===h?"top":"left"],p,p-u[e])}if(s){const e="y"===d?"bottom":"right";f=G3(f+u["y"===d?"top":"left"],f,f-u[e])}const m=a.fn({...t,[h]:p,[d]:f});return{...m,data:{x:m.x-n,y:m.y-r,enabled:{[h]:o,[d]:s}}}}}},F1e=function(e){return void 0===e&&(e={}),{options:e,fn(t){const{x:n,y:r,placement:i,rects:o,middlewareData:s}=t,{offset:a=0,mainAxis:l=!0,crossAxis:c=!0}=$l(e,t),u={x:n,y:r},d=vu(i),h=YL(d);let p=u[h],f=u[d];const m=$l(a,t),v="number"==typeof m?{mainAxis:m,crossAxis:0}:{mainAxis:0,crossAxis:0,...m};if(l){const e="y"===h?"height":"width",t=o.reference[h]-o.floating[e]+v.mainAxis,n=o.reference[h]+o.reference[e]-v.mainAxis;p<t?p=t:p>n&&(p=n)}if(c){var g,y;const e="y"===h?"width":"height",t=["top","left"].includes(Hl(i)),n=o.reference[d]-o.floating[e]+(t&&(null==(g=s.offset)?void 0:g[d])||0)+(t?0:v.crossAxis),r=o.reference[d]+o.reference[e]+(t?0:(null==(y=s.offset)?void 0:y[d])||0)-(t?v.crossAxis:0);f<n?f=n:f>r&&(f=r)}return{[h]:p,[d]:f}}}},$1e=function(e){return void 0===e&&(e={}),{name:"size",options:e,async fn(t){var n,r;const{placement:i,rects:o,platform:s,elements:a}=t,{apply:l=()=>{},...c}=$l(e,t),u=await Bv(t,c),d=Hl(i),h=Jp(i),p="y"===vu(i),{width:f,height:m}=o.floating;let v,g;"top"===d||"bottom"===d?(v=d,g=h===(await(null==s.isRTL?void 0:s.isRTL(a.floating))?"start":"end")?"left":"right"):(g=d,v="end"===h?"top":"bottom");const y=m-u.top-u.bottom,b=f-u.left-u.right,_=gu(m-u[v],y),w=gu(f-u[g],b),E=!t.middlewareData.shift;let S=_,C=w;if(null!=(n=t.middlewareData.shift)&&n.enabled.x&&(C=b),null!=(r=t.middlewareData.shift)&&r.enabled.y&&(S=y),E&&!h){const e=vs(u.left,0),t=vs(u.right,0),n=vs(u.top,0),r=vs(u.bottom,0);p?C=f-2*(0!==e||0!==t?e+t:vs(u.left,u.right)):S=m-2*(0!==n||0!==r?n+r:vs(u.top,u.bottom))}await l({...t,availableWidth:C,availableHeight:S});const k=await s.getDimensions(a.floating);return f!==k.width||m!==k.height?{reset:{rects:!0}}:{}}}};function lG(e){const t=Es(e);let n=parseFloat(t.width)||0,r=parseFloat(t.height)||0;const i=Ss(e),o=i?e.offsetWidth:n,s=i?e.offsetHeight:r,a=TS(n)!==o||TS(r)!==s;return a&&(n=o,r=s),{width:n,height:r,$:a}}function ZL(e){return fn(e)?e:e.contextElement}function Kh(e){const t=ZL(e);if(!Ss(t))return wa(1);const n=t.getBoundingClientRect(),{width:r,height:i,$:o}=lG(t);let s=(o?TS(n.width):n.width)/r,a=(o?TS(n.height):n.height)/i;return(!s||!Number.isFinite(s))&&(s=1),(!a||!Number.isFinite(a))&&(a=1),{x:s,y:a}}const H1e=wa(0);function cG(e){const t=Xi(e);return dw()&&t.visualViewport?{x:t.visualViewport.offsetLeft,y:t.visualViewport.offsetTop}:H1e}function B1e(e,t,n){return void 0===t&&(t=!1),!(!n||t&&n!==Xi(e))&&t}function Hd(e,t,n,r){void 0===t&&(t=!1),void 0===n&&(n=!1);const i=e.getBoundingClientRect(),o=ZL(e);let s=wa(1);t&&(r?fn(r)&&(s=Kh(r)):s=Kh(e));const a=B1e(o,n,r)?cG(o):wa(0);let l=(i.left+a.x)/s.x,c=(i.top+a.y)/s.y,u=i.width/s.x,d=i.height/s.y;if(o){const e=Xi(o),t=r&&fn(r)?Xi(r):r;let n=e,i=V3(n);for(;i&&r&&t!==n;){const e=Kh(i),t=i.getBoundingClientRect(),r=Es(i),o=t.left+(i.clientLeft+parseFloat(r.paddingLeft))*e.x,s=t.top+(i.clientTop+parseFloat(r.paddingTop))*e.y;l*=e.x,c*=e.y,u*=e.x,d*=e.y,l+=o,c+=s,n=Xi(i),i=V3(n)}}return IS({width:u,height:d,x:l,y:c})}function QL(e,t){const n=fw(e).scrollLeft;return t?t.left+n:Hd(Da(e)).left+n}function uG(e,t,n){void 0===n&&(n=!1);const r=e.getBoundingClientRect();return{x:r.left+t.scrollLeft-(n?0:QL(e,r)),y:r.top+t.scrollTop}}function V1e(e){let{elements:t,rect:n,offsetParent:r,strategy:i}=e;const o="fixed"===i,s=Da(r),a=!!t&&uw(t.floating);if(r===s||a&&o)return n;let l={scrollLeft:0,scrollTop:0},c=wa(1);const u=wa(0),d=Ss(r);if((d||!d&&!o)&&(("body"!==Yp(r)||Ny(s))&&(l=fw(r)),Ss(r))){const e=Hd(r);c=Kh(r),u.x=e.x+r.clientLeft,u.y=e.y+r.clientTop}const h=!s||d||o?wa(0):uG(s,l,!0);return{width:n.width*c.x,height:n.height*c.y,x:n.x*c.x-l.scrollLeft*c.x+u.x+h.x,y:n.y*c.y-l.scrollTop*c.y+u.y+h.y}}function q1e(e){return Array.from(e.getClientRects())}function K1e(e){const t=Da(e),n=fw(e),r=e.ownerDocument.body,i=vs(t.scrollWidth,t.clientWidth,r.scrollWidth,r.clientWidth),o=vs(t.scrollHeight,t.clientHeight,r.scrollHeight,r.clientHeight);let s=-n.scrollLeft+QL(e);const a=-n.scrollTop;return"rtl"===Es(r).direction&&(s+=vs(t.clientWidth,r.clientWidth)-i),{width:i,height:o,x:s,y:a}}function G1e(e,t){const n=Xi(e),r=Da(e),i=n.visualViewport;let o=r.clientWidth,s=r.clientHeight,a=0,l=0;if(i){o=i.width,s=i.height;const e=dw();(!e||e&&"fixed"===t)&&(a=i.offsetLeft,l=i.offsetTop)}return{width:o,height:s,x:a,y:l}}function W1e(e,t){const n=Hd(e,!0,"fixed"===t),r=n.top+e.clientTop,i=n.left+e.clientLeft,o=Ss(e)?Kh(e):wa(1);return{width:e.clientWidth*o.x,height:e.clientHeight*o.y,x:i*o.x,y:r*o.y}}function f7(e,t,n){let r;if("viewport"===t)r=G1e(e,n);else if("document"===t)r=K1e(Da(e));else if(fn(t))r=W1e(t,n);else{const n=cG(e);r={x:t.x-n.x,y:t.y-n.y,width:t.width,height:t.height}}return IS(r)}function dG(e,t){const n=Fl(e);return!(n===t||!fn(n)||Tl(n))&&("fixed"===Es(n).position||dG(n,t))}function z1e(e,t){const n=t.get(e);if(n)return n;let r=Qc(e,[],!1).filter((e=>fn(e)&&"body"!==Yp(e))),i=null;const o="fixed"===Es(e).position;let s=o?Fl(e):e;for(;fn(s)&&!Tl(s);){const t=Es(s),n=zL(s);!n&&"fixed"===t.position&&(i=null),(o?!n&&!i:!n&&"static"===t.position&&i&&["absolute","fixed"].includes(i.position)||Ny(s)&&!n&&dG(e,s))?r=r.filter((e=>e!==s)):i=t,s=Fl(s)}return t.set(e,r),r}function Y1e(e){let{element:t,boundary:n,rootBoundary:r,strategy:i}=e;const o=[..."clippingAncestors"===n?uw(t)?[]:z1e(t,this._c):[].concat(n),r],s=o[0],a=o.reduce(((e,n)=>{const r=f7(t,n,i);return e.top=vs(r.top,e.top),e.right=gu(r.right,e.right),e.bottom=gu(r.bottom,e.bottom),e.left=vs(r.left,e.left),e}),f7(t,s,i));return{width:a.right-a.left,height:a.bottom-a.top,x:a.left,y:a.top}}function J1e(e){const{width:t,height:n}=lG(e);return{width:t,height:n}}function X1e(e,t,n){const r=Ss(t),i=Da(t),o="fixed"===n,s=Hd(e,!0,o,t);let a={scrollLeft:0,scrollTop:0};const l=wa(0);if(r||!r&&!o)if(("body"!==Yp(t)||Ny(i))&&(a=fw(t)),r){const e=Hd(t,!0,o,t);l.x=e.x+t.clientLeft,l.y=e.y+t.clientTop}else i&&(l.x=QL(i));const c=!i||r||o?wa(0):uG(i,a);return{x:s.left+a.scrollLeft-l.x-c.x,y:s.top+a.scrollTop-l.y-c.y,width:s.width,height:s.height}}function nR(e){return"static"===Es(e).position}function h7(e,t){if(!Ss(e)||"fixed"===Es(e).position)return null;if(t)return t(e);let n=e.offsetParent;return Da(e)===n&&(n=n.ownerDocument.body),n}function fG(e,t){const n=Xi(e);if(uw(e))return n;if(!Ss(e)){let t=Fl(e);for(;t&&!Tl(t);){if(fn(t)&&!nR(t))return t;t=Fl(t)}return n}let r=h7(e,t);for(;r&&X0e(r)&&nR(r);)r=h7(r,t);return r&&Tl(r)&&nR(r)&&!zL(r)?n:r||Z0e(e)||n}const Z1e=async function(e){const t=this.getOffsetParent||fG,n=this.getDimensions,r=await n(e.floating);return{reference:X1e(e.reference,await t(e.floating),e.strategy),floating:{x:0,y:0,width:r.width,height:r.height}}};function Q1e(e){return"rtl"===Es(e).direction}const e_e={convertOffsetParentRelativeRectToViewportRelativeRect:V1e,getDocumentElement:Da,getClippingRect:Y1e,getOffsetParent:fG,getElementRects:Z1e,getClientRects:q1e,getDimensions:J1e,getScale:Kh,isElement:fn,isRTL:Q1e};function hG(e,t){return e.x===t.x&&e.y===t.y&&e.width===t.width&&e.height===t.height}function t_e(e,t){let n,r=null;const i=Da(e);function o(){var e;clearTimeout(n),null==(e=r)||e.disconnect(),r=null}return function s(a,l){void 0===a&&(a=!1),void 0===l&&(l=1),o();const c=e.getBoundingClientRect(),{left:u,top:d,width:h,height:p}=c;if(a||t(),!h||!p)return;const f={rootMargin:-q1(d)+"px "+-q1(i.clientWidth-(u+h))+"px "+-q1(i.clientHeight-(d+p))+"px "+-q1(u)+"px",threshold:vs(0,gu(1,l))||1};let m=!0;function v(t){const r=t[0].intersectionRatio;if(r!==l){if(!m)return s();r?s(!1,r):n=setTimeout((()=>{s(!1,1e-7)}),1e3)}1===r&&!hG(c,e.getBoundingClientRect())&&s(),m=!1}try{r=new IntersectionObserver(v,{...f,root:i.ownerDocument})}catch{r=new IntersectionObserver(v,f)}r.observe(e)}(!0),o}function pG(e,t,n,r){void 0===r&&(r={});const{ancestorScroll:i=!0,ancestorResize:o=!0,elementResize:s="function"==typeof ResizeObserver,layoutShift:a="function"==typeof IntersectionObserver,animationFrame:l=!1}=r,c=ZL(e),u=i||o?[...c?Qc(c):[],...Qc(t)]:[];u.forEach((e=>{i&&e.addEventListener("scroll",n,{passive:!0}),o&&e.addEventListener("resize",n)}));const d=c&&a?t_e(c,n):null;let h=-1,p=null;s&&(p=new ResizeObserver((e=>{let[r]=e;r&&r.target===c&&p&&(p.unobserve(t),cancelAnimationFrame(h),h=requestAnimationFrame((()=>{var e;null==(e=p)||e.observe(t)}))),n()})),c&&!l&&p.observe(c),p.observe(t));let f,m=l?Hd(e):null;return l&&function t(){const r=Hd(e);m&&!hG(m,r)&&n(),m=r,f=requestAnimationFrame(t)}(),n(),()=>{var e;u.forEach((e=>{i&&e.removeEventListener("scroll",n),o&&e.removeEventListener("resize",n)})),null==d||d(),null==(e=p)||e.disconnect(),p=null,l&&cancelAnimationFrame(f)}}const n_e=j1e,r_e=U1e,i_e=A1e,s_e=$1e,o_e=N1e,p7=M1e,a_e=F1e,l_e=(e,t,n)=>{const r=new Map,i={platform:e_e,...n},o={...i.platform,_c:r};return O1e(e,t,{...i,platform:o})};var yb=typeof document<"u"?_.useLayoutEffect:_.useEffect;function PS(e,t){if(e===t)return!0;if(typeof e!=typeof t)return!1;if("function"==typeof e&&e.toString()===t.toString())return!0;let n,r,i;if(e&&t&&"object"==typeof e){if(Array.isArray(e)){if(n=e.length,n!==t.length)return!1;for(r=n;0!=r--;)if(!PS(e[r],t[r]))return!1;return!0}if(i=Object.keys(e),n=i.length,n!==Object.keys(t).length)return!1;for(r=n;0!=r--;)if(!{}.hasOwnProperty.call(t,i[r]))return!1;for(r=n;0!=r--;){const n=i[r];if(!("_owner"===n&&e.$$typeof||PS(e[n],t[n])))return!1}return!0}return e!=e&&t!=t}function mG(e){return typeof window>"u"?1:(e.ownerDocument.defaultView||window).devicePixelRatio||1}function m7(e,t){const n=mG(e);return Math.round(t*n)/n}function rR(e){const t=_.useRef(e);return yb((()=>{t.current=e})),t}function gG(e){void 0===e&&(e={});const{placement:t="bottom",strategy:n="absolute",middleware:r=[],platform:i,elements:{reference:o,floating:s}={},transform:a=!0,whileElementsMounted:l,open:c}=e,[u,d]=_.useState({x:0,y:0,strategy:n,placement:t,middlewareData:{},isPositioned:!1}),[h,p]=_.useState(r);PS(h,r)||p(r);const[f,m]=_.useState(null),[v,g]=_.useState(null),y=_.useCallback((e=>{e!==S.current&&(S.current=e,m(e))}),[]),b=_.useCallback((e=>{e!==C.current&&(C.current=e,g(e))}),[]),w=o||f,E=s||v,S=_.useRef(null),C=_.useRef(null),k=_.useRef(u),T=null!=l,I=rR(l),R=rR(i),x=rR(c),L=_.useCallback((()=>{if(!S.current||!C.current)return;const e={placement:t,strategy:n,middleware:h};R.current&&(e.platform=R.current),l_e(S.current,C.current,e).then((e=>{const t={...e,isPositioned:!1!==x.current};P.current&&!PS(k.current,t)&&(k.current=t,Up.flushSync((()=>{d(t)})))}))}),[h,t,n,R,x]);yb((()=>{!1===c&&k.current.isPositioned&&(k.current.isPositioned=!1,d((e=>({...e,isPositioned:!1}))))}),[c]);const P=_.useRef(!1);yb((()=>(P.current=!0,()=>{P.current=!1})),[]),yb((()=>{if(w&&(S.current=w),E&&(C.current=E),w&&E){if(I.current)return I.current(w,E,L);L()}}),[w,E,L,I,T]);const O=_.useMemo((()=>({reference:S,floating:C,setReference:y,setFloating:b})),[y,b]),A=_.useMemo((()=>({reference:w,floating:E})),[w,E]),M=_.useMemo((()=>{const e={position:n,left:0,top:0};if(!A.floating)return e;const t=m7(A.floating,u.x),r=m7(A.floating,u.y);return a?{...e,transform:"translate("+t+"px, "+r+"px)",...mG(A.floating)>=1.5&&{willChange:"transform"}}:{position:n,left:t,top:r}}),[n,a,A.floating,u.x,u.y]);return _.useMemo((()=>({...u,update:L,refs:O,elements:A,floatingStyles:M})),[u,L,O,A,M])}const c_e=e=>({name:"arrow",options:e,fn(t){const{element:n,padding:r}="function"==typeof e?e(t):e;return n&&function(e){return{}.hasOwnProperty.call(e,"current")}(n)?null!=n.current?p7({element:n.current,padding:r}).fn(t):{}:n?p7({element:n,padding:r}).fn(t):{}}}),vG=(e,t)=>({...n_e(e),options:[e,t]}),yG=(e,t)=>({...r_e(e),options:[e,t]}),u_e=(e,t)=>({...a_e(e),options:[e,t]}),_G=(e,t)=>({...i_e(e),options:[e,t]}),d_e=(e,t)=>({...s_e(e),options:[e,t]}),f_e=(e,t)=>({...o_e(e),options:[e,t]}),bG=(e,t)=>({...c_e(e),options:[e,t]});function SG(e){return _.useMemo((()=>e.every((e=>null==e))?null:t=>{e.forEach((e=>{"function"==typeof e?e(t):null!=e&&(e.current=t)}))}),e)}const EG={...cB},h_e=EG.useInsertionEffect,p_e=h_e||(e=>e());function gl(e){const t=_.useRef((()=>{}));return p_e((()=>{t.current=e})),_.useCallback((function(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return null==t.current?void 0:t.current(...n)}),[])}var Ri=typeof document<"u"?_.useLayoutEffect:_.useEffect;let g7=!1,m_e=0;const v7=()=>"floating-ui-"+Math.random().toString(36).slice(2,6)+m_e++;function g_e(){const[e,t]=_.useState((()=>g7?v7():void 0));return Ri((()=>{null==e&&t(v7())}),[]),_.useEffect((()=>{g7=!0}),[]),e}const v_e=EG.useId,_p=v_e||g_e,y_e=_.forwardRef((function(e,t){const{context:{placement:n,elements:{floating:r},middlewareData:{arrow:i,shift:o}},width:s=14,height:a=7,tipRadius:l=0,strokeWidth:c=0,staticOffset:u,stroke:d,d:h,style:{transform:p,...f}={},...m}=e,v=_p(),[g,y]=_.useState(!1);if(Ri((()=>{r&&"rtl"===Es(r).direction&&y(!0)}),[r]),!r)return null;const[b,w]=n.split("-"),S="top"===b||"bottom"===b;let C=u;(S&&null!=o&&o.x||!S&&null!=o&&o.y)&&(C=null);const k=2*c,T=k/2,I=s/2*(l/-8+1),R=a/2*l/4,x=!!h,L=C&&"end"===w?"bottom":"top";let P=C&&"end"===w?"right":"left";C&&g&&(P="end"===w?"left":"right");const O=null!=(null==i?void 0:i.x)?C||i.x:"",A=null!=(null==i?void 0:i.y)?C||i.y:"",M=h||"M0,0 H"+s+" L"+(s-I)+","+(a-R)+" Q"+s/2+","+a+" "+I+","+(a-R)+" Z",N={top:x?"rotate(180deg)":"",left:x?"rotate(90deg)":"rotate(-90deg)",bottom:x?"":"rotate(180deg)",right:x?"rotate(-90deg)":"rotate(90deg)"}[b];return E.jsxs("svg",{...m,"aria-hidden":!0,ref:t,width:x?s:s+k,height:s,viewBox:"0 0 "+s+" "+(a>s?a:s),style:{position:"absolute",pointerEvents:"none",[P]:O,[L]:A,[b]:S||x?"100%":"calc(100% - "+k/2+"px)",transform:[N,p].filter((e=>!!e)).join(" "),...f},children:[k>0&&E.jsx("path",{clipPath:"url(#"+v+")",fill:"none",stroke:d,strokeWidth:k+(h?0:1),d:M}),E.jsx("path",{stroke:k&&!h?m.fill:"none",d:M}),E.jsx("clipPath",{id:v,children:E.jsx("rect",{x:-T,y:T*(x?-1:1),width:s+k,height:s})})]})}));function __e(){const e=new Map;return{emit(t,n){var r;null==(r=e.get(t))||r.forEach((e=>e(n)))},on(t,n){e.set(t,[...e.get(t)||[],n])},off(t,n){var r;e.set(t,(null==(r=e.get(t))?void 0:r.filter((e=>e!==n)))||[])}}}const b_e=_.createContext(null),S_e=_.createContext(null),e6=()=>{var e;return(null==(e=_.useContext(b_e))?void 0:e.id)||null},t6=()=>_.useContext(S_e);function Dy(e){return"data-floating-ui-"+e}function iR(e){const t=_.useRef(e);return Ri((()=>{t.current=e})),t}const y7=Dy("safe-polygon");function _b(e,t,n){return n&&!K3(n)?0:"number"==typeof e?e:null==e?void 0:e[t]}function E_e(e,t){void 0===t&&(t={});const{open:n,onOpenChange:r,dataRef:i,events:o,elements:s}=e,{enabled:a=!0,delay:l=0,handleClose:c=null,mouseOnly:u=!1,restMs:d=0,move:h=!0}=t,p=t6(),f=e6(),m=iR(c),v=iR(l),g=iR(n),y=_.useRef(),b=_.useRef(-1),w=_.useRef(),E=_.useRef(-1),S=_.useRef(!0),C=_.useRef(!1),k=_.useRef((()=>{})),T=_.useRef(!1),I=_.useCallback((()=>{var e;const t=null==(e=i.current.openEvent)?void 0:e.type;return(null==t?void 0:t.includes("mouse"))&&"mousedown"!==t}),[i]);_.useEffect((()=>{if(a)return o.on("openchange",e),()=>{o.off("openchange",e)};function e(e){let{open:t}=e;t||(clearTimeout(b.current),clearTimeout(E.current),S.current=!0,T.current=!1)}}),[a,o]),_.useEffect((()=>{if(!a||!m.current||!n)return;function e(e){I()&&r(!1,e,"hover")}const t=Vc(s.floating).documentElement;return t.addEventListener("mouseleave",e),()=>{t.removeEventListener("mouseleave",e)}}),[s.floating,n,r,a,m,I]);const R=_.useCallback((function(e,t,n){void 0===t&&(t=!0),void 0===n&&(n="hover");const i=_b(v.current,"close",y.current);i&&!w.current?(clearTimeout(b.current),b.current=window.setTimeout((()=>r(!1,e,n)),i)):t&&(clearTimeout(b.current),r(!1,e,n))}),[v,r]),x=gl((()=>{k.current(),w.current=void 0})),L=gl((()=>{if(C.current){const e=Vc(s.floating).body;e.style.pointerEvents="",e.removeAttribute(y7),C.current=!1}})),P=gl((()=>!!i.current.openEvent&&["click","mousedown"].includes(i.current.openEvent.type)));_.useEffect((()=>{if(a&&fn(s.domReference)){var e;const r=s.domReference;return n&&r.addEventListener("mouseleave",l),null==(e=s.floating)||e.addEventListener("mouseleave",l),h&&r.addEventListener("mousemove",t,{once:!0}),r.addEventListener("mouseenter",t),r.addEventListener("mouseleave",o),()=>{var e;n&&r.removeEventListener("mouseleave",l),null==(e=s.floating)||e.removeEventListener("mouseleave",l),h&&r.removeEventListener("mousemove",t),r.removeEventListener("mouseenter",t),r.removeEventListener("mouseleave",o)}}function t(e){if(clearTimeout(b.current),S.current=!1,u&&!K3(y.current)||d>0&&!_b(v.current,"open"))return;const t=_b(v.current,"open",y.current);t?b.current=window.setTimeout((()=>{g.current||r(!0,e,"hover")}),t):n||r(!0,e,"hover")}function o(e){if(P())return;k.current();const t=Vc(s.floating);if(clearTimeout(E.current),T.current=!1,m.current&&i.current.floatingContext){n||clearTimeout(b.current),w.current=m.current({...i.current.floatingContext,tree:p,x:e.clientX,y:e.clientY,onClose(){L(),x(),P()||R(e,!0,"safe-polygon")}});const r=w.current;return t.addEventListener("mousemove",r),void(k.current=()=>{t.removeEventListener("mousemove",r)})}("touch"!==y.current||!yp(s.floating,e.relatedTarget))&&R(e)}function l(e){P()||i.current.floatingContext&&(null==m.current||m.current({...i.current.floatingContext,tree:p,x:e.clientX,y:e.clientY,onClose(){L(),x(),P()||R(e)}})(e))}}),[s,a,e,u,d,h,R,x,L,r,n,g,p,v,m,i,P]),Ri((()=>{var e;if(a&&n&&null!=(e=m.current)&&e.__options.blockPointerEvents&&I()){C.current=!0;const e=s.floating;if(fn(s.domReference)&&e){var t;const n=Vc(s.floating).body;n.setAttribute(y7,"");const r=s.domReference,i=null==p||null==(t=p.nodesRef.current.find((e=>e.id===f)))||null==(t=t.context)?void 0:t.elements.floating;return i&&(i.style.pointerEvents=""),n.style.pointerEvents="none",r.style.pointerEvents="auto",e.style.pointerEvents="auto",()=>{n.style.pointerEvents="",r.style.pointerEvents="",e.style.pointerEvents=""}}}}),[a,n,f,s,p,m,I]),Ri((()=>{n||(y.current=void 0,T.current=!1,x(),L())}),[n,x,L]),_.useEffect((()=>()=>{x(),clearTimeout(b.current),clearTimeout(E.current),L()}),[a,s.domReference,x,L]);const O=_.useMemo((()=>{function e(e){y.current=e.pointerType}return{onPointerDown:e,onPointerEnter:e,onMouseMove(e){const{nativeEvent:t}=e;function i(){!S.current&&!g.current&&r(!0,t,"hover")}u&&!K3(y.current)||n||0===d||T.current&&e.movementX**2+e.movementY**2<2||(clearTimeout(E.current),"touch"===y.current?i():(T.current=!0,E.current=window.setTimeout(i,d)))}}}),[u,r,n,g,d]),A=_.useMemo((()=>({onMouseEnter(){clearTimeout(b.current)},onMouseLeave(e){P()||R(e.nativeEvent,!1)}})),[R,P]);return _.useMemo((()=>a?{reference:O,floating:A}:{}),[a,O,A])}const Y3=()=>{},wG=_.createContext({delay:0,initialDelay:0,timeoutMs:0,currentId:null,setCurrentId:Y3,setState:Y3,isInstantPhase:!1}),w_e=()=>_.useContext(wG);function C_e(e){const{children:t,delay:n,timeoutMs:r=0}=e,[i,o]=_.useReducer(((e,t)=>({...e,...t})),{delay:n,timeoutMs:r,initialDelay:n,currentId:null,isInstantPhase:!1}),s=_.useRef(null),a=_.useCallback((e=>{o({currentId:e})}),[]);return Ri((()=>{i.currentId?null===s.current?s.current=i.currentId:i.isInstantPhase||o({isInstantPhase:!0}):(i.isInstantPhase&&o({isInstantPhase:!1}),s.current=null)}),[i.currentId,i.isInstantPhase]),E.jsx(wG.Provider,{value:_.useMemo((()=>({...i,setState:o,setCurrentId:a})),[i,a]),children:t})}function T_e(e,t){void 0===t&&(t={});const{open:n,onOpenChange:r,floatingId:i}=e,{id:o,enabled:s=!0}=t,a=o??i,l=w_e(),{currentId:c,setCurrentId:u,initialDelay:d,setState:h,timeoutMs:p}=l;return Ri((()=>{s&&c&&(h({delay:{open:1,close:_b(d,"close")}}),c!==a&&r(!1))}),[s,a,r,h,c,d]),Ri((()=>{function e(){r(!1),h({delay:d,currentId:null})}if(s&&c&&!n&&c===a){if(p){const t=window.setTimeout(e,p);return()=>{clearTimeout(t)}}e()}}),[s,n,h,c,a,r,d,p]),Ri((()=>{s&&(u===Y3||!n||u(a))}),[s,n,u,a]),l}function sR(e,t){let n=e.filter((e=>{var n;return e.parentId===t&&(null==(n=e.context)?void 0:n.open)})),r=n;for(;r.length;)r=e.filter((e=>{var t;return null==(t=r)?void 0:t.some((t=>{var n;return e.parentId===t.id&&(null==(n=e.context)?void 0:n.open)}))})),n=n.concat(r);return n}const CG=()=>({getShadowRoot:!0,displayCheck:"function"==typeof ResizeObserver&&ResizeObserver.toString().includes("[native code]")?"full":"none"});function TG(e,t){const n=aG(e,CG());"prev"===t&&n.reverse();const r=n.indexOf(q3(Vc(e)));return n.slice(r+1)[0]}function R_e(){return TG(document.body,"next")}function I_e(){return TG(document.body,"prev")}function oR(e,t){const n=t||e.currentTarget,r=e.relatedTarget;return!r||!yp(n,r)}function k_e(e){aG(e,CG()).forEach((e=>{e.dataset.tabindex=e.getAttribute("tabindex")||"",e.setAttribute("tabindex","-1")}))}function _7(e){e.querySelectorAll("[data-tabindex]").forEach((e=>{const t=e.dataset.tabindex;delete e.dataset.tabindex,t?e.setAttribute("tabindex",t):e.removeAttribute("tabindex")}))}const RG={border:0,clip:"rect(0 0 0 0)",height:"1px",margin:"-1px",overflow:"hidden",padding:0,position:"fixed",whiteSpace:"nowrap",width:"1px",top:0,left:0};let x_e;function b7(e){"Tab"===e.key&&(e.target,clearTimeout(x_e))}const S7=_.forwardRef((function(e,t){const[n,r]=_.useState();Ri((()=>(tG()&&r("button"),document.addEventListener("keydown",b7),()=>{document.removeEventListener("keydown",b7)})),[]);const i={ref:t,tabIndex:0,role:n,"aria-hidden":!n||void 0,[Dy("focus-guard")]:"",style:RG};return E.jsx("span",{...e,...i})})),IG=_.createContext(null),E7=Dy("portal");function P_e(e){void 0===e&&(e={});const{id:t,root:n}=e,r=_p(),i=O_e(),[o,s]=_.useState(null),a=_.useRef(null);return Ri((()=>()=>{null==o||o.remove(),queueMicrotask((()=>{a.current=null}))}),[o]),Ri((()=>{if(!r||a.current)return;const e=t?document.getElementById(t):null;if(!e)return;const n=document.createElement("div");n.id=r,n.setAttribute(E7,""),e.appendChild(n),a.current=n,s(n)}),[t,r]),Ri((()=>{if(null===n||!r||a.current)return;let e=n||(null==i?void 0:i.portalNode);e&&!fn(e)&&(e=e.current),e=e||document.body;let o=null;t&&(o=document.createElement("div"),o.id=t,e.appendChild(o));const l=document.createElement("div");l.id=r,l.setAttribute(E7,""),e=o||e,e.appendChild(l),a.current=l,s(l)}),[t,n,r,i]),o}function L_e(e){const{children:t,id:n,root:r,preserveTabOrder:i=!0}=e,o=P_e({id:n,root:r}),[s,a]=_.useState(null),l=_.useRef(null),c=_.useRef(null),u=_.useRef(null),d=_.useRef(null),h=null==s?void 0:s.modal,p=null==s?void 0:s.open,f=!!s&&!s.modal&&s.open&&i&&!(!r&&!o);return _.useEffect((()=>{if(o&&i&&!h)return o.addEventListener("focusin",e,!0),o.addEventListener("focusout",e,!0),()=>{o.removeEventListener("focusin",e,!0),o.removeEventListener("focusout",e,!0)};function e(e){o&&oR(e)&&("focusin"===e.type?_7:k_e)(o)}}),[o,i,h]),_.useEffect((()=>{o&&(p||_7(o))}),[p,o]),E.jsxs(IG.Provider,{value:_.useMemo((()=>({preserveTabOrder:i,beforeOutsideRef:l,afterOutsideRef:c,beforeInsideRef:u,afterInsideRef:d,portalNode:o,setFocusManagerState:a})),[i,o]),children:[f&&o&&E.jsx(S7,{"data-type":"outside",ref:l,onFocus:e=>{if(oR(e,o)){var t;null==(t=u.current)||t.focus()}else{const e=I_e()||(null==s?void 0:s.domReference);null==e||e.focus()}}}),f&&o&&E.jsx("span",{"aria-owns":o.id,style:RG}),o&&Up.createPortal(t,o),f&&o&&E.jsx(S7,{"data-type":"outside",ref:c,onFocus:e=>{if(oR(e,o)){var t;null==(t=d.current)||t.focus()}else{const t=R_e()||(null==s?void 0:s.domReference);null==t||t.focus(),null!=s&&s.closeOnFocusOut&&(null==s||s.onOpenChange(!1,e.nativeEvent,"focus-out"))}}})]})}const O_e=()=>_.useContext(IG),M_e="data-floating-ui-focusable",A_e={pointerdown:"onPointerDown",mousedown:"onMouseDown",click:"onClick"},N_e={pointerdown:"onPointerDownCapture",mousedown:"onMouseDownCapture",click:"onClickCapture"},w7=e=>{var t,n;return{escapeKey:"boolean"==typeof e?e:null!=(t=null==e?void 0:e.escapeKey)&&t,outsidePress:"boolean"==typeof e?e:null==(n=null==e?void 0:e.outsidePress)||n}};function D_e(e,t){void 0===t&&(t={});const{open:n,onOpenChange:r,elements:i,dataRef:o}=e,{enabled:s=!0,escapeKey:a=!0,outsidePress:l=!0,outsidePressEvent:c="pointerdown",referencePress:u=!1,referencePressEvent:d="pointerdown",ancestorScroll:h=!1,bubbles:p,capture:f}=t,m=t6(),v=gl("function"==typeof l?l:()=>!1),g="function"==typeof l?v:l,y=_.useRef(!1),b=_.useRef(!1),{escapeKey:w,outsidePress:E}=w7(p),{escapeKey:S,outsidePress:C}=w7(f),k=_.useRef(!1),T=gl((e=>{var t;if(!n||!s||!a||"Escape"!==e.key||k.current)return;const i=null==(t=o.current.floatingContext)?void 0:t.nodeId,l=m?sR(m.nodesRef.current,i):[];if(!w&&(e.stopPropagation(),l.length>0)){let e=!0;if(l.forEach((t=>{var n;null==(n=t.context)||!n.open||t.context.dataRef.current.__escapeKeyBubbles||(e=!1)})),!e)return}r(!1,n1e(e)?e.nativeEvent:e,"escape-key")})),I=gl((e=>{var t;const n=()=>{var t;T(e),null==(t=ph(e))||t.removeEventListener("keydown",n)};null==(t=ph(e))||t.addEventListener("keydown",n)})),R=gl((e=>{var t;const n=y.current;y.current=!1;const s=b.current;if(b.current=!1,"click"===c&&s||n||"function"==typeof g&&!g(e))return;const a=ph(e),l="["+Dy("inert")+"]",u=Vc(i.floating).querySelectorAll(l);let d=fn(a)?a:null;for(;d&&!Tl(d);){const e=Fl(d);if(Tl(e)||!fn(e))break;d=e}if(u.length&&fn(a)&&!r1e(a)&&!yp(a,i.floating)&&Array.from(u).every((e=>!yp(d,e))))return;if(Ss(a)&&P){const t=Tl(a),n=Es(a),r=/auto|scroll/,i=t||r.test(n.overflowX),o=t||r.test(n.overflowY),s=i&&a.clientWidth>0&&a.scrollWidth>a.clientWidth,l=o&&a.clientHeight>0&&a.scrollHeight>a.clientHeight,c="rtl"===n.direction,u=l&&(c?e.offsetX<=a.offsetWidth-a.clientWidth:e.offsetX>a.clientWidth),d=s&&e.offsetY>a.clientHeight;if(u||d)return}const h=null==(t=o.current.floatingContext)?void 0:t.nodeId,p=m&&sR(m.nodesRef.current,h).some((t=>{var n;return tR(e,null==(n=t.context)?void 0:n.elements.floating)}));if(tR(e,i.floating)||tR(e,i.domReference)||p)return;const f=m?sR(m.nodesRef.current,h):[];if(f.length>0){let e=!0;if(f.forEach((t=>{var n;null==(n=t.context)||!n.open||t.context.dataRef.current.__outsidePressBubbles||(e=!1)})),!e)return}r(!1,e,"outside-press")})),x=gl((e=>{var t;const n=()=>{var t;R(e),null==(t=ph(e))||t.removeEventListener(c,n)};null==(t=ph(e))||t.addEventListener(c,n)}));_.useEffect((()=>{if(!n||!s)return;o.current.__escapeKeyBubbles=w,o.current.__outsidePressBubbles=E;let e=-1;function t(e){r(!1,e,"ancestor-scroll")}function l(){window.clearTimeout(e),k.current=!0}function u(){e=window.setTimeout((()=>{k.current=!1}),dw()?5:0)}const d=Vc(i.floating);a&&(d.addEventListener("keydown",S?I:T,S),d.addEventListener("compositionstart",l),d.addEventListener("compositionend",u)),g&&d.addEventListener(c,C?x:R,C);let p=[];return h&&(fn(i.domReference)&&(p=Qc(i.domReference)),fn(i.floating)&&(p=p.concat(Qc(i.floating))),!fn(i.reference)&&i.reference&&i.reference.contextElement&&(p=p.concat(Qc(i.reference.contextElement)))),p=p.filter((e=>{var t;return e!==(null==(t=d.defaultView)?void 0:t.visualViewport)})),p.forEach((e=>{e.addEventListener("scroll",t,{passive:!0})})),()=>{a&&(d.removeEventListener("keydown",S?I:T,S),d.removeEventListener("compositionstart",l),d.removeEventListener("compositionend",u)),g&&d.removeEventListener(c,C?x:R,C),p.forEach((e=>{e.removeEventListener("scroll",t)})),window.clearTimeout(e)}}),[o,i,a,g,c,n,r,h,s,w,E,T,S,I,R,C,x]),_.useEffect((()=>{y.current=!1}),[g,c]);const L=_.useMemo((()=>({onKeyDown:T,...u&&{[A_e[d]]:e=>{r(!1,e.nativeEvent,"reference-press")},..."click"!==d&&{onClick(e){r(!1,e.nativeEvent,"reference-press")}}}})),[T,r,u,d]),P=_.useMemo((()=>({onKeyDown:T,onMouseDown(){b.current=!0},onMouseUp(){b.current=!0},[N_e[c]]:()=>{y.current=!0}})),[T,c]);return _.useMemo((()=>s?{reference:L,floating:P}:{}),[s,L,P])}function j_e(e){const{open:t=!1,onOpenChange:n,elements:r}=e,i=_p(),o=_.useRef({}),[s]=_.useState((()=>__e())),a=null!=e6(),[l,c]=_.useState(r.reference),u=gl(((e,t,r)=>{o.current.openEvent=e?t:void 0,s.emit("openchange",{open:e,event:t,reason:r,nested:a}),null==n||n(e,t,r)})),d=_.useMemo((()=>({setPositionReference:c})),[]),h=_.useMemo((()=>({reference:l||r.reference||null,floating:r.floating||null,domReference:r.reference})),[l,r.reference,r.floating]);return _.useMemo((()=>({dataRef:o,open:t,onOpenChange:u,elements:h,events:s,floatingId:i,refs:d})),[t,u,h,s,i,d])}function U_e(e){void 0===e&&(e={});const{nodeId:t}=e,n=j_e({...e,elements:{reference:null,floating:null,...e.elements}}),r=e.rootContext||n,i=r.elements,[o,s]=_.useState(null),[a,l]=_.useState(null),c=(null==i?void 0:i.domReference)||o,u=_.useRef(null),d=t6();Ri((()=>{c&&(u.current=c)}),[c]);const h=gG({...e,elements:{...i,...a&&{reference:a}}}),p=_.useCallback((e=>{const t=fn(e)?{getBoundingClientRect:()=>e.getBoundingClientRect(),contextElement:e}:e;l(t),h.refs.setReference(t)}),[h.refs]),f=_.useCallback((e=>{(fn(e)||null===e)&&(u.current=e,s(e)),(fn(h.refs.reference.current)||null===h.refs.reference.current||null!==e&&!fn(e))&&h.refs.setReference(e)}),[h.refs]),m=_.useMemo((()=>({...h.refs,setReference:f,setPositionReference:p,domReference:u})),[h.refs,f,p]),v=_.useMemo((()=>({...h.elements,domReference:c})),[h.elements,c]),g=_.useMemo((()=>({...h,...r,refs:m,elements:v,nodeId:t})),[h,m,v,t,r]);return Ri((()=>{r.dataRef.current.floatingContext=g;const e=null==d?void 0:d.nodesRef.current.find((e=>e.id===t));e&&(e.context=g)})),_.useMemo((()=>({...h,context:g,refs:m,elements:v})),[h,m,v,g])}function F_e(e,t){void 0===t&&(t={});const{open:n,onOpenChange:r,events:i,dataRef:o,elements:s}=e,{enabled:a=!0,visibleOnly:l=!0}=t,c=_.useRef(!1),u=_.useRef(),d=_.useRef(!0);_.useEffect((()=>{if(!a)return;const e=Xi(s.domReference);function t(){!n&&Ss(s.domReference)&&s.domReference===q3(Vc(s.domReference))&&(c.current=!0)}function r(){d.current=!0}return e.addEventListener("blur",t),e.addEventListener("keydown",r,!0),()=>{e.removeEventListener("blur",t),e.removeEventListener("keydown",r,!0)}}),[s.domReference,n,a]),_.useEffect((()=>{if(a)return i.on("openchange",e),()=>{i.off("openchange",e)};function e(e){let{reason:t}=e;("reference-press"===t||"escape-key"===t)&&(c.current=!0)}}),[i,a]),_.useEffect((()=>()=>{clearTimeout(u.current)}),[]);const h=_.useMemo((()=>({onPointerDown(e){Q0e(e.nativeEvent)||(d.current=!1)},onMouseLeave(){c.current=!1},onFocus(e){if(c.current)return;const t=ph(e.nativeEvent);if(l&&fn(t))try{if(tG()&&e1e())throw Error();if(!t.matches(":focus-visible"))return}catch{if(!d.current&&!s1e(t))return}r(!0,e.nativeEvent,"focus")},onBlur(e){c.current=!1;const t=e.relatedTarget,n=e.nativeEvent,i=fn(t)&&t.hasAttribute(Dy("focus-guard"))&&"outside"===t.getAttribute("data-type");u.current=window.setTimeout((()=>{var e;const a=q3(s.domReference?s.domReference.ownerDocument:document);!t&&a===s.domReference||yp(null==(e=o.current.floatingContext)?void 0:e.refs.floating.current,a)||yp(s.domReference,a)||i||r(!1,n,"focus")}))}})),[o,s.domReference,r,l]);return _.useMemo((()=>a?{reference:h}:{}),[a,h])}const C7="active",T7="selected";function aR(e,t,n){const r=new Map,i="item"===n;let o=e;if(i&&e){const{[C7]:t,[T7]:n,...r}=e;o=r}return{..."floating"===n&&{tabIndex:-1,[M_e]:""},...o,...t.map((t=>{const r=t?t[n]:null;return"function"==typeof r?e?r(e):null:r})).concat(e).reduce(((e,t)=>(t&&Object.entries(t).forEach((t=>{let[n,o]=t;if(!i||![C7,T7].includes(n))if(0===n.indexOf("on")){var s;if(r.has(n)||r.set(n,[]),"function"==typeof o)null==(s=r.get(n))||s.push(o),e[n]=function(){for(var e,t=arguments.length,i=new Array(t),o=0;o<t;o++)i[o]=arguments[o];return null==(e=r.get(n))?void 0:e.map((e=>e(...i))).find((e=>void 0!==e))}}else e[n]=o})),e)),{})}}function $_e(e){void 0===e&&(e=[]);const t=e.map((e=>null==e?void 0:e.reference)),n=e.map((e=>null==e?void 0:e.floating)),r=e.map((e=>null==e?void 0:e.item)),i=_.useCallback((t=>aR(t,e,"reference")),t),o=_.useCallback((t=>aR(t,e,"floating")),n),s=_.useCallback((t=>aR(t,e,"item")),r);return _.useMemo((()=>({getReferenceProps:i,getFloatingProps:o,getItemProps:s})),[i,o,s])}const H_e=new Map([["select","listbox"],["combobox","listbox"],["label",!1]]);function B_e(e,t){var n;void 0===t&&(t={});const{open:r,floatingId:i}=e,{enabled:o=!0,role:s="dialog"}=t,a=null!=(n=H_e.get(s))?n:s,l=_p(),c=null!=e6(),u=_.useMemo((()=>"tooltip"===a||"label"===s?{["aria-"+("label"===s?"labelledby":"describedby")]:r?i:void 0}:{"aria-expanded":r?"true":"false","aria-haspopup":"alertdialog"===a?"dialog":a,"aria-controls":r?i:void 0,..."listbox"===a&&{role:"combobox"},..."menu"===a&&{id:l},..."menu"===a&&c&&{role:"menuitem"},..."select"===s&&{"aria-autocomplete":"none"},..."combobox"===s&&{"aria-autocomplete":"list"}}),[a,i,c,r,l,s]),d=_.useMemo((()=>{const e={id:i,...a&&{role:a}};return"tooltip"===a||"label"===s?e:{...e,..."menu"===a&&{"aria-labelledby":l}}}),[a,i,l,s]),h=_.useCallback((e=>{let{active:t,selected:n}=e;const r={role:"option",...t&&{id:i+"-option"}};switch(s){case"select":return{...r,"aria-selected":t&&n};case"combobox":return{...r,...t&&{"aria-selected":!0}}}return{}}),[i,s]);return _.useMemo((()=>o?{reference:u,floating:d,item:h}:{}),[o,u,d,h])}const V_e="_tooltip_1pslb_17",q_e="_invisible_1pslb_30",K_e="_caption_1pslb_37",G_e="_arrow_1pslb_42",bb={tooltip:V_e,invisible:q_e,caption:K_e,arrow:G_e},kG={open:300,close:0},xG=({children:e})=>E.jsx(C_e,{delay:kG,timeoutMs:300,children:e});function W_e({open:e,disabled:t=!1,onOpenChange:n,placement:r="bottom",isTriggerInteractive:i,caption:o,"aria-atomic":s,"aria-live":a,...l}){const c=_p(),u=_p(),d=_.useRef(null),[h,p]=_.useState(!1),f=!t&&(e??h),m=(t,r,i)=>{null==n||n(t,r,i),void 0===e&&p(t)},v=U_e({placement:r,open:f,onOpenChange:m,whileElementsMounted:pG,middleware:[vG(6),_G({crossAxis:r.includes("-"),fallbackAxisSideDirection:"start",padding:5}),yG({padding:5}),bG({element:d})]}),g=v.context,{delay:y,initialDelay:b}=T_e(g);if(b!==kG)throw new Error("Tooltips must be wrapped in a global <TooltipProvider>");const w=E_e(g,{move:!1,enabled:void 0===e,delay:i?y:{},mouseOnly:!0}),E=F_e(g,{enabled:void 0===e}),S=_.useRef(void 0);_.useEffect((()=>()=>window.clearTimeout(S.current)),[]);const C=_.useMemo((()=>{const e=()=>{void 0===S.current?S.current=window.setTimeout((()=>{m(!1),S.current=void 0}),1500):window.clearTimeout(S.current)};return{reference:{onTouchStart:()=>{void 0!==S.current&&window.clearTimeout(S.current),S.current=window.setTimeout((()=>{m(!0),S.current=void 0}),500)},onTouchEnd:e,onTouchCancel:e}}}),[]),k=D_e(g),T="label"in l?"label":"description",I=B_e(g,{enabled:"description"===T,role:"tooltip"}),R=$_e([w,E,C,k,I,_.useMemo((()=>"label"===T?{reference:{"aria-labelledby":c,"aria-describedby":o?u:void 0}}:{}),[T,c,u])]);return _.useMemo((()=>({labelId:c,captionId:o?u:void 0,caption:o,purpose:T,open:f,setOpen:m,tooltipProps:{"aria-atomic":s,"aria-live":a},...R,...v,arrowRef:d})),[c,u,o,I,f,m,R,v,d])}xG.displayName="TooltipProvider";const z_e=e=>"label"in e&&!!e.label;function ui({children:e,isTriggerInteractive:t=!0,nonInteractiveTriggerTabIndex:n=0,...r}){const i=W_e({isTriggerInteractive:t,...r});return E.jsxs(JK.Provider,{value:i,children:[E.jsx(X_e,{isTriggerInteractive:t,nonInteractiveTriggerTabIndex:n,children:e}),E.jsxs(J_e,{children:[E.jsx("span",{id:i.labelId,children:z_e(r)?r.label:r.description}),E.jsx(Y_e,{})]})]})}function Y_e(){const{caption:e,captionId:t}=WL();if(!e)return null;const n="string"==typeof e?"span":"div";return E.jsx(n,{id:t,className:Ae(bb.caption,"cpd-theme-dark"),children:e})}function J_e({children:e}){const{context:t,open:n,arrowRef:r,purpose:i,...o}=WL();return n||"label"===i?E.jsx(L_e,{children:E.jsxs("div",{ref:o.refs.setFloating,style:o.floatingStyles,...o.tooltipProps,...o.getFloatingProps(),className:Ae(bb.tooltip,{[bb.invisible]:"label"===i&&!n}),children:[E.jsx(y_e,{ref:r,context:t,width:10,height:6,className:bb.arrow}),e]})}):null}const X_e=({children:e,isTriggerInteractive:t,nonInteractiveTriggerTabIndex:n})=>{const r=WL(),i=null==e?void 0:e.ref,o=SG([r.refs.setReference,i]),s=_.useMemo((()=>{if(_.isValidElement(e)){if(t){const t=r.getReferenceProps({ref:o});return _.cloneElement(e,t)}{const t=r.getReferenceProps({ref:o,tabIndex:n}),{"aria-labelledby":i,"aria-describedby":s,...a}=t;return E.jsx("span",{tabIndex:n,...a,children:_.cloneElement(e,{"aria-labelledby":i,"aria-describedby":s})})}}}),[r,o,e]);if(!s)throw new Error("Tooltip anchor must be a single valid React element");return s},PG=_.forwardRef((function({children:e,className:t,indicator:n,size:r="32px",style:i,disabled:o,destructive:s,tooltip:a,subtleBackground:l,...c},u){const d=Ae(eR["icon-button"],t,{[eR.destructive]:s,[eR["subtle-bg"]]:l}),h=E.jsx(YK,{as:"button",ref:u,className:d,style:{"--cpd-icon-button-size":r,...i},disabled:o,...c,"data-indicator":n,children:E.jsx(J0e,{indicator:n,colour:o?"var(--cpd-color-icon-disabled)":void 0,children:we.Children.only(e)})});return a?E.jsx(ui,{label:a,children:h}):h})),Z_e=({type:e,title:t,children:n,className:r,actions:i,onClose:o,...s})=>{const a=Ae(Yf.alert,r),l=_.useCallback((t=>{switch(e){case"critical":return E.jsx(aw,{...t});case"info":return E.jsx(B0e,{...t});case"success":return E.jsx(H0e,{...t})}}),[e]);return E.jsxs("div",{...s,className:a,"data-type":e,children:[l({width:24,height:24,className:Yf.icon,"aria-hidden":!0}),E.jsxs("div",{className:Yf.content,children:[E.jsxs("div",{className:Yf["text-content"],children:[E.jsx(Jt,{size:"md",weight:"semibold",children:t}),E.jsx(Jt,{size:"sm",weight:"regular",children:n})]}),i&&E.jsx("div",{className:Yf.actions,children:i})]}),o&&E.jsx(PG,{onClick:o,"aria-label":"Close",role:"button",className:Yf.close,children:E.jsx(lw,{})})]})},Q_e="@",ebe="#",tbe="+",nbe=new Intl.Segmenter;function rbe(e){if(e.length<1)return"";const t=e[0];[Q_e,ebe,tbe].includes(t)&&(e=e.substring(1));const n=nbe.segment(e)[Symbol.iterator]().next();return n.done?"":n.value.segment}const ibe="_avatar_mcap2_17",sbe="_image_mcap2_50",lR={avatar:ibe,image:sbe,"avatar-imageless":"_avatar-imageless_mcap2_61"};function obe(e){return e.split("").reduce(((e,t)=>e+t.charCodeAt(0)),0)%6+1}function abe(e){return!!(e.onClick||e.onKeyDown||e.onKeyUp)}const lbe=_.forwardRef((function({src:e,id:t,name:n="",type:r="round",className:i="",size:o,style:s={},onError:a,...l},c){return we.createElement(abe(l)?"button":"span",{ref:c,role:"img","aria-label":t,...l,"data-type":r,"data-color":obe(t),className:Ae(lR.avatar,i,{[lR["avatar-imageless"]]:!e}),style:{...s,"--cpd-avatar-size":o}},E.jsx(we.Fragment,{children:e?E.jsx("img",{loading:"lazy",alt:"",src:e,referrerPolicy:"no-referrer",className:Ae(lR.image),"data-type":r,style:s,width:o,height:o,onError:a}):rbe(n)}))}));function We(e,t,{checkForDefaultPrevented:n=!0}={}){return function(r){if(null==e||e(r),!1===n||!r.defaultPrevented)return null==t?void 0:t(r)}}function cbe(e,t){const n=_.createContext(t),r=e=>{const{children:t,...r}=e,i=_.useMemo((()=>r),Object.values(r));return E.jsx(n.Provider,{value:i,children:t})};return r.displayName=e+"Provider",[r,function(r){const i=_.useContext(n);if(i)return i;if(void 0!==t)return t;throw new Error(`\`${r}\` must be used within \`${e}\``)}]}function ja(e,t=[]){let n=[];const r=()=>{const t=n.map((e=>_.createContext(e)));return function(n){const r=(null==n?void 0:n[e])||t;return _.useMemo((()=>({[`__scope${e}`]:{...n,[e]:r}})),[n,r])}};return r.scopeName=e,[function(t,r){const i=_.createContext(r),o=n.length;n=[...n,r];const s=t=>{var n;const{scope:r,children:s,...a}=t,l=(null==(n=null==r?void 0:r[e])?void 0:n[o])||i,c=_.useMemo((()=>a),Object.values(a));return E.jsx(l.Provider,{value:c,children:s})};return s.displayName=t+"Provider",[s,function(n,s){var a;const l=(null==(a=null==s?void 0:s[e])?void 0:a[o])||i,c=_.useContext(l);if(c)return c;if(void 0!==r)return r;throw new Error(`\`${n}\` must be used within \`${t}\``)}]},ube(r,...t)]}function ube(...e){const t=e[0];if(1===e.length)return t;const n=()=>{const n=e.map((e=>({useScope:e(),scopeName:e.scopeName})));return function(e){const r=n.reduce(((t,{useScope:n,scopeName:r})=>({...t,...n(e)[`__scope${r}`]})),{});return _.useMemo((()=>({[`__scope${t.scopeName}`]:r})),[r])}};return n.scopeName=t.scopeName,n}function R7(e,t){if("function"==typeof e)return e(t);null!=e&&(e.current=t)}function Ua(...e){return t=>{let n=!1;const r=e.map((e=>{const r=R7(e,t);return!n&&"function"==typeof r&&(n=!0),r}));if(n)return()=>{for(let t=0;t<r.length;t++){const n=r[t];"function"==typeof n?n():R7(e[t],null)}}}}function tn(...e){return _.useCallback(Ua(...e),e)}var bp=_.forwardRef(((e,t)=>{const{children:n,...r}=e,i=_.Children.toArray(n),o=i.find(fbe);if(o){const e=o.props.children,n=i.map((t=>t===o?_.Children.count(e)>1?_.Children.only(null):_.isValidElement(e)?e.props.children:null:t));return E.jsx(J3,{...r,ref:t,children:_.isValidElement(e)?_.cloneElement(e,void 0,n):null})}return E.jsx(J3,{...r,ref:t,children:n})}));bp.displayName="Slot";var J3=_.forwardRef(((e,t)=>{const{children:n,...r}=e;if(_.isValidElement(n)){const e=pbe(n);return _.cloneElement(n,{...hbe(r,n.props),ref:t?Ua(t,e):e})}return _.Children.count(n)>1?_.Children.only(null):null}));J3.displayName="SlotClone";var dbe=({children:e})=>E.jsx(E.Fragment,{children:e});function fbe(e){return _.isValidElement(e)&&e.type===dbe}function hbe(e,t){const n={...t};for(const r in t){const i=e[r],o=t[r];/^on[A-Z]/.test(r)?i&&o?n[r]=(...e)=>{o(...e),i(...e)}:i&&(n[r]=i):"style"===r?n[r]={...i,...o}:"className"===r&&(n[r]=[i,o].filter(Boolean).join(" "))}return{...e,...n}}function pbe(e){var t,n;let r=null==(t=Object.getOwnPropertyDescriptor(e.props,"ref"))?void 0:t.get,i=r&&"isReactWarning"in r&&r.isReactWarning;return i?e.ref:(r=null==(n=Object.getOwnPropertyDescriptor(e,"ref"))?void 0:n.get,i=r&&"isReactWarning"in r&&r.isReactWarning,i?e.props.ref:e.props.ref||e.ref)}var mbe=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","span","svg","ul"],er=mbe.reduce(((e,t)=>{const n=_.forwardRef(((e,n)=>{const{asChild:r,...i}=e,o=r?bp:t;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),E.jsx(o,{...i,ref:n})}));return n.displayName=`Primitive.${t}`,{...e,[t]:n}}),{});function gbe(e,t){e&&Up.flushSync((()=>e.dispatchEvent(t)))}function LG(e){const t=e+"CollectionProvider",[n,r]=ja(t),[i,o]=n(t,{collectionRef:{current:null},itemMap:new Map}),s=e=>{const{scope:t,children:n}=e,r=we.useRef(null),o=we.useRef(new Map).current;return E.jsx(i,{scope:t,itemMap:o,collectionRef:r,children:n})};s.displayName=t;const a=e+"CollectionSlot",l=we.forwardRef(((e,t)=>{const{scope:n,children:r}=e,i=tn(t,o(a,n).collectionRef);return E.jsx(bp,{ref:i,children:r})}));l.displayName=a;const c=e+"CollectionItemSlot",u="data-radix-collection-item",d=we.forwardRef(((e,t)=>{const{scope:n,children:r,...i}=e,s=we.useRef(null),a=tn(t,s),l=o(c,n);return we.useEffect((()=>(l.itemMap.set(s,{ref:s,...i}),()=>{l.itemMap.delete(s)}))),E.jsx(bp,{[u]:"",ref:a,children:r})}));return d.displayName=c,[{Provider:s,Slot:l,ItemSlot:d},function(t){const n=o(e+"CollectionConsumer",t);return we.useCallback((()=>{const e=n.collectionRef.current;if(!e)return[];const t=Array.from(e.querySelectorAll(`[${u}]`));return Array.from(n.itemMap.values()).sort(((e,n)=>t.indexOf(e.ref.current)-t.indexOf(n.ref.current)))}),[n.collectionRef,n.itemMap])},r]}var vbe=_.createContext(void 0);function n6(e){const t=_.useContext(vbe);return e||t||"ltr"}var OG=_.forwardRef(((e,t)=>{const{children:n,...r}=e,i=_.Children.toArray(n),o=i.find(_be);if(o){const e=o.props.children,n=i.map((t=>t===o?_.Children.count(e)>1?_.Children.only(null):_.isValidElement(e)?e.props.children:null:t));return E.jsx(X3,{...r,ref:t,children:_.isValidElement(e)?_.cloneElement(e,void 0,n):null})}return E.jsx(X3,{...r,ref:t,children:n})}));OG.displayName="Slot";var X3=_.forwardRef(((e,t)=>{const{children:n,...r}=e;if(_.isValidElement(n)){const e=Sbe(n),i=bbe(r,n.props);return n.type!==_.Fragment&&(i.ref=t?Ua(t,e):e),_.cloneElement(n,i)}return _.Children.count(n)>1?_.Children.only(null):null}));X3.displayName="SlotClone";var ybe=({children:e})=>E.jsx(E.Fragment,{children:e});function _be(e){return _.isValidElement(e)&&e.type===ybe}function bbe(e,t){const n={...t};for(const r in t){const i=e[r],o=t[r];/^on[A-Z]/.test(r)?i&&o?n[r]=(...e)=>{o(...e),i(...e)}:i&&(n[r]=i):"style"===r?n[r]={...i,...o}:"className"===r&&(n[r]=[i,o].filter(Boolean).join(" "))}return{...e,...n}}function Sbe(e){var t,n;let r=null==(t=Object.getOwnPropertyDescriptor(e.props,"ref"))?void 0:t.get,i=r&&"isReactWarning"in r&&r.isReactWarning;return i?e.ref:(r=null==(n=Object.getOwnPropertyDescriptor(e,"ref"))?void 0:n.get,i=r&&"isReactWarning"in r&&r.isReactWarning,i?e.props.ref:e.props.ref||e.ref)}var Ebe=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","span","svg","ul"],MG=Ebe.reduce(((e,t)=>{const n=_.forwardRef(((e,n)=>{const{asChild:r,...i}=e,o=r?OG:t;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),E.jsx(o,{...i,ref:n})}));return n.displayName=`Primitive.${t}`,{...e,[t]:n}}),{});function wbe(e,t){e&&Up.flushSync((()=>e.dispatchEvent(t)))}function ts(e){const t=_.useRef(e);return _.useEffect((()=>{t.current=e})),_.useMemo((()=>(...e)=>{var n;return null==(n=t.current)?void 0:n.call(t,...e)}),[])}function Cbe(e,t=(null==globalThis?void 0:globalThis.document)){const n=ts(e);_.useEffect((()=>{const e=e=>{"Escape"===e.key&&n(e)};return t.addEventListener("keydown",e,{capture:!0}),()=>t.removeEventListener("keydown",e,{capture:!0})}),[n,t])}var I7,Tbe="DismissableLayer",Z3="dismissableLayer.update",Rbe="dismissableLayer.pointerDownOutside",Ibe="dismissableLayer.focusOutside",AG=_.createContext({layers:new Set,layersWithOutsidePointerEventsDisabled:new Set,branches:new Set}),r6=_.forwardRef(((e,t)=>{const{disableOutsidePointerEvents:n=!1,onEscapeKeyDown:r,onPointerDownOutside:i,onFocusOutside:o,onInteractOutside:s,onDismiss:a,...l}=e,c=_.useContext(AG),[u,d]=_.useState(null),h=(null==u?void 0:u.ownerDocument)??(null==globalThis?void 0:globalThis.document),[,p]=_.useState({}),f=tn(t,(e=>d(e))),m=Array.from(c.layers),[v]=[...c.layersWithOutsidePointerEventsDisabled].slice(-1),g=m.indexOf(v),y=u?m.indexOf(u):-1,b=c.layersWithOutsidePointerEventsDisabled.size>0,w=y>=g,S=Pbe((e=>{const t=e.target,n=[...c.branches].some((e=>e.contains(t)));!w||n||(null==i||i(e),null==s||s(e),e.defaultPrevented||null==a||a())}),h),C=Lbe((e=>{const t=e.target;[...c.branches].some((e=>e.contains(t)))||(null==o||o(e),null==s||s(e),e.defaultPrevented||null==a||a())}),h);return Cbe((e=>{y===c.layers.size-1&&(null==r||r(e),!e.defaultPrevented&&a&&(e.preventDefault(),a()))}),h),_.useEffect((()=>{if(u)return n&&(0===c.layersWithOutsidePointerEventsDisabled.size&&(I7=h.body.style.pointerEvents,h.body.style.pointerEvents="none"),c.layersWithOutsidePointerEventsDisabled.add(u)),c.layers.add(u),k7(),()=>{n&&1===c.layersWithOutsidePointerEventsDisabled.size&&(h.body.style.pointerEvents=I7)}}),[u,h,n,c]),_.useEffect((()=>()=>{u&&(c.layers.delete(u),c.layersWithOutsidePointerEventsDisabled.delete(u),k7())}),[u,c]),_.useEffect((()=>{const e=()=>p({});return document.addEventListener(Z3,e),()=>document.removeEventListener(Z3,e)}),[]),E.jsx(MG.div,{...l,ref:f,style:{pointerEvents:b?w?"auto":"none":void 0,...e.style},onFocusCapture:We(e.onFocusCapture,C.onFocusCapture),onBlurCapture:We(e.onBlurCapture,C.onBlurCapture),onPointerDownCapture:We(e.onPointerDownCapture,S.onPointerDownCapture)})}));r6.displayName=Tbe;var kbe="DismissableLayerBranch",xbe=_.forwardRef(((e,t)=>{const n=_.useContext(AG),r=_.useRef(null),i=tn(t,r);return _.useEffect((()=>{const e=r.current;if(e)return n.branches.add(e),()=>{n.branches.delete(e)}}),[n.branches]),E.jsx(MG.div,{...e,ref:i})}));function Pbe(e,t=(null==globalThis?void 0:globalThis.document)){const n=ts(e),r=_.useRef(!1),i=_.useRef((()=>{}));return _.useEffect((()=>{const e=e=>{if(e.target&&!r.current){let r=function(){NG(Rbe,n,o,{discrete:!0})};const o={originalEvent:e};"touch"===e.pointerType?(t.removeEventListener("click",i.current),i.current=r,t.addEventListener("click",i.current,{once:!0})):r()}else t.removeEventListener("click",i.current);r.current=!1},o=window.setTimeout((()=>{t.addEventListener("pointerdown",e)}),0);return()=>{window.clearTimeout(o),t.removeEventListener("pointerdown",e),t.removeEventListener("click",i.current)}}),[t,n]),{onPointerDownCapture:()=>r.current=!0}}function Lbe(e,t=(null==globalThis?void 0:globalThis.document)){const n=ts(e),r=_.useRef(!1);return _.useEffect((()=>{const e=e=>{e.target&&!r.current&&NG(Ibe,n,{originalEvent:e},{discrete:!1})};return t.addEventListener("focusin",e),()=>t.removeEventListener("focusin",e)}),[t,n]),{onFocusCapture:()=>r.current=!0,onBlurCapture:()=>r.current=!1}}function k7(){const e=new CustomEvent(Z3);document.dispatchEvent(e)}function NG(e,t,n,{discrete:r}){const i=n.originalEvent.target,o=new CustomEvent(e,{bubbles:!1,cancelable:!0,detail:n});t&&i.addEventListener(e,t,{once:!0}),r?wbe(i,o):i.dispatchEvent(o)}xbe.displayName=kbe;var cR=0;function DG(){_.useEffect((()=>{const e=document.querySelectorAll("[data-radix-focus-guard]");return document.body.insertAdjacentElement("afterbegin",e[0]??x7()),document.body.insertAdjacentElement("beforeend",e[1]??x7()),cR++,()=>{1===cR&&document.querySelectorAll("[data-radix-focus-guard]").forEach((e=>e.remove())),cR--}}),[])}function x7(){const e=document.createElement("span");return e.setAttribute("data-radix-focus-guard",""),e.tabIndex=0,e.style.outline="none",e.style.opacity="0",e.style.position="fixed",e.style.pointerEvents="none",e}var uR="focusScope.autoFocusOnMount",dR="focusScope.autoFocusOnUnmount",P7={bubbles:!1,cancelable:!0},Obe="FocusScope",jG=_.forwardRef(((e,t)=>{const{loop:n=!1,trapped:r=!1,onMountAutoFocus:i,onUnmountAutoFocus:o,...s}=e,[a,l]=_.useState(null),c=ts(i),u=ts(o),d=_.useRef(null),h=tn(t,(e=>l(e))),p=_.useRef({paused:!1,pause(){this.paused=!0},resume(){this.paused=!1}}).current;_.useEffect((()=>{if(r){let e=function(e){if(p.paused||!a)return;const t=e.target;a.contains(t)?d.current=t:Pc(d.current,{select:!0})},t=function(e){if(p.paused||!a)return;const t=e.relatedTarget;null!==t&&(a.contains(t)||Pc(d.current,{select:!0}))},n=function(e){if(document.activeElement===document.body)for(const t of e)t.removedNodes.length>0&&Pc(a)};document.addEventListener("focusin",e),document.addEventListener("focusout",t);const r=new MutationObserver(n);return a&&r.observe(a,{childList:!0,subtree:!0}),()=>{document.removeEventListener("focusin",e),document.removeEventListener("focusout",t),r.disconnect()}}}),[r,a,p.paused]),_.useEffect((()=>{if(a){O7.add(p);const e=document.activeElement;if(!a.contains(e)){const t=new CustomEvent(uR,P7);a.addEventListener(uR,c),a.dispatchEvent(t),t.defaultPrevented||(Mbe(Ube(UG(a)),{select:!0}),document.activeElement===e&&Pc(a))}return()=>{a.removeEventListener(uR,c),setTimeout((()=>{const t=new CustomEvent(dR,P7);a.addEventListener(dR,u),a.dispatchEvent(t),t.defaultPrevented||Pc(e??document.body,{select:!0}),a.removeEventListener(dR,u),O7.remove(p)}),0)}}}),[a,c,u,p]);const f=_.useCallback((e=>{if(!n&&!r||p.paused)return;const t="Tab"===e.key&&!e.altKey&&!e.ctrlKey&&!e.metaKey,i=document.activeElement;if(t&&i){const t=e.currentTarget,[r,o]=Abe(t);r&&o?e.shiftKey||i!==o?e.shiftKey&&i===r&&(e.preventDefault(),n&&Pc(o,{select:!0})):(e.preventDefault(),n&&Pc(r,{select:!0})):i===t&&e.preventDefault()}}),[n,r,p.paused]);return E.jsx(er.div,{tabIndex:-1,...s,ref:h,onKeyDown:f})}));function Mbe(e,{select:t=!1}={}){const n=document.activeElement;for(const r of e)if(Pc(r,{select:t}),document.activeElement!==n)return}function Abe(e){const t=UG(e);return[L7(t,e),L7(t.reverse(),e)]}function UG(e){const t=[],n=document.createTreeWalker(e,NodeFilter.SHOW_ELEMENT,{acceptNode:e=>{const t="INPUT"===e.tagName&&"hidden"===e.type;return e.disabled||e.hidden||t?NodeFilter.FILTER_SKIP:e.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;n.nextNode();)t.push(n.currentNode);return t}function L7(e,t){for(const n of e)if(!Nbe(n,{upTo:t}))return n}function Nbe(e,{upTo:t}){if("hidden"===getComputedStyle(e).visibility)return!0;for(;e;){if(void 0!==t&&e===t)return!1;if("none"===getComputedStyle(e).display)return!0;e=e.parentElement}return!1}function Dbe(e){return e instanceof HTMLInputElement&&"select"in e}function Pc(e,{select:t=!1}={}){if(e&&e.focus){const n=document.activeElement;e.focus({preventScroll:!0}),e!==n&&Dbe(e)&&t&&e.select()}}jG.displayName=Obe;var O7=jbe();function jbe(){let e=[];return{add(t){const n=e[0];t!==n&&(null==n||n.pause()),e=M7(e,t),e.unshift(t)},remove(t){var n;e=M7(e,t),null==(n=e[0])||n.resume()}}}function M7(e,t){const n=[...e],r=n.indexOf(t);return-1!==r&&n.splice(r,1),n}function Ube(e){return e.filter((e=>"A"!==e.tagName))}var yu=null!=globalThis&&globalThis.document?_.useLayoutEffect:()=>{},Fbe=cB.useId||(()=>{}),$be=0;function Rl(e){const[t,n]=_.useState(Fbe());return yu((()=>{n((e=>e??String($be++)))}),[e]),e||(t?`radix-${t}`:"")}var Hbe="Arrow",FG=_.forwardRef(((e,t)=>{const{children:n,width:r=10,height:i=5,...o}=e;return E.jsx(er.svg,{...o,ref:t,width:r,height:i,viewBox:"0 0 30 10",preserveAspectRatio:"none",children:e.asChild?n:E.jsx("polygon",{points:"0,0 30,0 15,10"})})}));FG.displayName=Hbe;var Bbe=FG;function $G(e){const[t,n]=_.useState(void 0);return yu((()=>{if(e){n({width:e.offsetWidth,height:e.offsetHeight});const t=new ResizeObserver((t=>{if(!Array.isArray(t)||!t.length)return;const r=t[0];let i,o;if("borderBoxSize"in r){const e=r.borderBoxSize,t=Array.isArray(e)?e[0]:e;i=t.inlineSize,o=t.blockSize}else i=e.offsetWidth,o=e.offsetHeight;n({width:i,height:o})}));return t.observe(e,{box:"border-box"}),()=>t.unobserve(e)}n(void 0)}),[e]),t}var i6="Popper",[HG,BG]=ja(i6),[Vbe,VG]=HG(i6),qG=e=>{const{__scopePopper:t,children:n}=e,[r,i]=_.useState(null);return E.jsx(Vbe,{scope:t,anchor:r,onAnchorChange:i,children:n})};qG.displayName=i6;var KG="PopperAnchor",GG=_.forwardRef(((e,t)=>{const{__scopePopper:n,virtualRef:r,...i}=e,o=VG(KG,n),s=_.useRef(null),a=tn(t,s);return _.useEffect((()=>{o.onAnchorChange((null==r?void 0:r.current)||s.current)})),r?null:E.jsx(er.div,{...i,ref:a})}));GG.displayName=KG;var s6="PopperContent",[qbe,Kbe]=HG(s6),WG=_.forwardRef(((e,t)=>{var n,r,i,o,s,a;const{__scopePopper:l,side:c="bottom",sideOffset:u=0,align:d="center",alignOffset:h=0,arrowPadding:p=0,avoidCollisions:f=!0,collisionBoundary:m=[],collisionPadding:v=0,sticky:g="partial",hideWhenDetached:y=!1,updatePositionStrategy:b="optimized",onPlaced:w,...S}=e,C=VG(s6,l),[k,T]=_.useState(null),I=tn(t,(e=>T(e))),[R,x]=_.useState(null),L=$G(R),P=(null==L?void 0:L.width)??0,O=(null==L?void 0:L.height)??0,A=c+("center"!==d?"-"+d:""),M="number"==typeof v?v:{top:0,right:0,bottom:0,left:0,...v},N=Array.isArray(m)?m:[m],D=N.length>0,j={padding:M,boundary:N.filter(Wbe),altBoundary:D},{refs:U,floatingStyles:F,placement:H,isPositioned:B,middlewareData:$}=gG({strategy:"fixed",placement:A,whileElementsMounted:(...e)=>pG(...e,{animationFrame:"always"===b}),elements:{reference:C.anchor},middleware:[vG({mainAxis:u+O,alignmentAxis:h}),f&&yG({mainAxis:!0,crossAxis:!1,limiter:"partial"===g?u_e():void 0,...j}),f&&_G({...j}),d_e({...j,apply:({elements:e,rects:t,availableWidth:n,availableHeight:r})=>{const{width:i,height:o}=t.reference,s=e.floating.style;s.setProperty("--radix-popper-available-width",`${n}px`),s.setProperty("--radix-popper-available-height",`${r}px`),s.setProperty("--radix-popper-anchor-width",`${i}px`),s.setProperty("--radix-popper-anchor-height",`${o}px`)}}),R&&bG({element:R,padding:p}),zbe({arrowWidth:P,arrowHeight:O}),y&&f_e({strategy:"referenceHidden",...j})]}),[V,q]=JG(H),K=ts(w);yu((()=>{B&&(null==K||K())}),[B,K]);const G=null==(n=$.arrow)?void 0:n.x,W=null==(r=$.arrow)?void 0:r.y,z=0!==(null==(i=$.arrow)?void 0:i.centerOffset),[J,Y]=_.useState();return yu((()=>{k&&Y(window.getComputedStyle(k).zIndex)}),[k]),E.jsx("div",{ref:U.setFloating,"data-radix-popper-content-wrapper":"",style:{...F,transform:B?F.transform:"translate(0, -200%)",minWidth:"max-content",zIndex:J,"--radix-popper-transform-origin":[null==(o=$.transformOrigin)?void 0:o.x,null==(s=$.transformOrigin)?void 0:s.y].join(" "),...(null==(a=$.hide)?void 0:a.referenceHidden)&&{visibility:"hidden",pointerEvents:"none"}},dir:e.dir,children:E.jsx(qbe,{scope:l,placedSide:V,onArrowChange:x,arrowX:G,arrowY:W,shouldHideArrow:z,children:E.jsx(er.div,{"data-side":V,"data-align":q,...S,ref:I,style:{...S.style,animation:B?void 0:"none"}})})})}));WG.displayName=s6;var zG="PopperArrow",Gbe={top:"bottom",right:"left",bottom:"top",left:"right"},YG=_.forwardRef((function(e,t){const{__scopePopper:n,...r}=e,i=Kbe(zG,n),o=Gbe[i.placedSide];return E.jsx("span",{ref:i.onArrowChange,style:{position:"absolute",left:i.arrowX,top:i.arrowY,[o]:0,transformOrigin:{top:"",right:"0 0",bottom:"center 0",left:"100% 0"}[i.placedSide],transform:{top:"translateY(100%)",right:"translateY(50%) rotate(90deg) translateX(-50%)",bottom:"rotate(180deg)",left:"translateY(50%) rotate(-90deg) translateX(50%)"}[i.placedSide],visibility:i.shouldHideArrow?"hidden":void 0},children:E.jsx(Bbe,{...r,ref:t,style:{...r.style,display:"block"}})})}));function Wbe(e){return null!==e}YG.displayName=zG;var zbe=e=>({name:"transformOrigin",options:e,fn(t){var n,r,i;const{placement:o,rects:s,middlewareData:a}=t,l=0!==(null==(n=a.arrow)?void 0:n.centerOffset),c=l?0:e.arrowWidth,u=l?0:e.arrowHeight,[d,h]=JG(o),p={start:"0%",center:"50%",end:"100%"}[h],f=((null==(r=a.arrow)?void 0:r.x)??0)+c/2,m=((null==(i=a.arrow)?void 0:i.y)??0)+u/2;let v="",g="";return"bottom"===d?(v=l?p:`${f}px`,g=-u+"px"):"top"===d?(v=l?p:`${f}px`,g=`${s.floating.height+u}px`):"right"===d?(v=-u+"px",g=l?p:`${m}px`):"left"===d&&(v=`${s.floating.width+u}px`,g=l?p:`${m}px`),{data:{x:v,y:g}}}});function JG(e){const[t,n="center"]=e.split("-");return[t,n]}var Ybe=qG,Jbe=GG,Xbe=WG,Zbe=YG,Qbe="Portal",XG=_.forwardRef(((e,t)=>{var n;const{container:r,...i}=e,[o,s]=_.useState(!1);yu((()=>s(!0)),[]);const a=r||o&&(null==(n=null==globalThis?void 0:globalThis.document)?void 0:n.body);return a?_q.createPortal(E.jsx(er.div,{...i,ref:t}),a):null}));function eSe(e,t){return _.useReducer(((e,n)=>t[e][n]??e),e)}XG.displayName=Qbe;var ku=e=>{const{present:t,children:n}=e,r=tSe(t),i="function"==typeof n?n({present:r.isPresent}):_.Children.only(n),o=tn(r.ref,nSe(i));return"function"==typeof n||r.isPresent?_.cloneElement(i,{ref:o}):null};function tSe(e){const[t,n]=_.useState(),r=_.useRef({}),i=_.useRef(e),o=_.useRef("none"),s=e?"mounted":"unmounted",[a,l]=eSe(s,{mounted:{UNMOUNT:"unmounted",ANIMATION_OUT:"unmountSuspended"},unmountSuspended:{MOUNT:"mounted",ANIMATION_END:"unmounted"},unmounted:{MOUNT:"mounted"}});return _.useEffect((()=>{const e=K1(r.current);o.current="mounted"===a?e:"none"}),[a]),yu((()=>{const t=r.current,n=i.current;if(n!==e){const r=o.current,s=K1(t);e?l("MOUNT"):"none"===s||"none"===(null==t?void 0:t.display)?l("UNMOUNT"):l(n&&r!==s?"ANIMATION_OUT":"UNMOUNT"),i.current=e}}),[e,l]),yu((()=>{if(t){let e;const n=t.ownerDocument.defaultView??window,s=o=>{const s=K1(r.current).includes(o.animationName);if(o.target===t&&s&&(l("ANIMATION_END"),!i.current)){const r=t.style.animationFillMode;t.style.animationFillMode="forwards",e=n.setTimeout((()=>{"forwards"===t.style.animationFillMode&&(t.style.animationFillMode=r)}))}},a=e=>{e.target===t&&(o.current=K1(r.current))};return t.addEventListener("animationstart",a),t.addEventListener("animationcancel",s),t.addEventListener("animationend",s),()=>{n.clearTimeout(e),t.removeEventListener("animationstart",a),t.removeEventListener("animationcancel",s),t.removeEventListener("animationend",s)}}l("ANIMATION_END")}),[t,l]),{isPresent:["mounted","unmountSuspended"].includes(a),ref:_.useCallback((e=>{e&&(r.current=getComputedStyle(e)),n(e)}),[])}}function K1(e){return(null==e?void 0:e.animationName)||"none"}function nSe(e){var t,n;let r=null==(t=Object.getOwnPropertyDescriptor(e.props,"ref"))?void 0:t.get,i=r&&"isReactWarning"in r&&r.isReactWarning;return i?e.ref:(r=null==(n=Object.getOwnPropertyDescriptor(e,"ref"))?void 0:n.get,i=r&&"isReactWarning"in r&&r.isReactWarning,i?e.props.ref:e.props.ref||e.ref)}function hw({prop:e,defaultProp:t,onChange:n=()=>{}}){const[r,i]=rSe({defaultProp:t,onChange:n}),o=void 0!==e,s=o?e:r,a=ts(n);return[s,_.useCallback((t=>{if(o){const n="function"==typeof t?t(e):t;n!==e&&a(n)}else i(t)}),[o,e,i,a])]}function rSe({defaultProp:e,onChange:t}){const n=_.useState(e),[r]=n,i=_.useRef(r),o=ts(t);return _.useEffect((()=>{i.current!==r&&(o(r),i.current=r)}),[r,i,o]),n}ku.displayName="Presence";var fR="rovingFocusGroup.onEntryFocus",iSe={bubbles:!1,cancelable:!0},pw="RovingFocusGroup",[Q3,ZG,sSe]=LG(pw),[oSe,QG]=ja(pw,[sSe]),[aSe,lSe]=oSe(pw),eW=_.forwardRef(((e,t)=>E.jsx(Q3.Provider,{scope:e.__scopeRovingFocusGroup,children:E.jsx(Q3.Slot,{scope:e.__scopeRovingFocusGroup,children:E.jsx(cSe,{...e,ref:t})})})));eW.displayName=pw;var cSe=_.forwardRef(((e,t)=>{const{__scopeRovingFocusGroup:n,orientation:r,loop:i=!1,dir:o,currentTabStopId:s,defaultCurrentTabStopId:a,onCurrentTabStopIdChange:l,onEntryFocus:c,preventScrollOnEntryFocus:u=!1,...d}=e,h=_.useRef(null),p=tn(t,h),f=n6(o),[m=null,v]=hw({prop:s,defaultProp:a,onChange:l}),[g,y]=_.useState(!1),b=ts(c),w=ZG(n),S=_.useRef(!1),[C,k]=_.useState(0);return _.useEffect((()=>{const e=h.current;if(e)return e.addEventListener(fR,b),()=>e.removeEventListener(fR,b)}),[b]),E.jsx(aSe,{scope:n,orientation:r,dir:f,loop:i,currentTabStopId:m,onItemFocus:_.useCallback((e=>v(e)),[v]),onItemShiftTab:_.useCallback((()=>y(!0)),[]),onFocusableItemAdd:_.useCallback((()=>k((e=>e+1))),[]),onFocusableItemRemove:_.useCallback((()=>k((e=>e-1))),[]),children:E.jsx(er.div,{tabIndex:g||0===C?-1:0,"data-orientation":r,...d,ref:p,style:{outline:"none",...e.style},onMouseDown:We(e.onMouseDown,(()=>{S.current=!0})),onFocus:We(e.onFocus,(e=>{const t=!S.current;if(e.target===e.currentTarget&&t&&!g){const t=new CustomEvent(fR,iSe);if(e.currentTarget.dispatchEvent(t),!t.defaultPrevented){const e=w().filter((e=>e.focusable));rW([e.find((e=>e.active)),e.find((e=>e.id===m)),...e].filter(Boolean).map((e=>e.ref.current)),u)}}S.current=!1})),onBlur:We(e.onBlur,(()=>y(!1)))})})})),tW="RovingFocusGroupItem",nW=_.forwardRef(((e,t)=>{const{__scopeRovingFocusGroup:n,focusable:r=!0,active:i=!1,tabStopId:o,...s}=e,a=Rl(),l=o||a,c=lSe(tW,n),u=c.currentTabStopId===l,d=ZG(n),{onFocusableItemAdd:h,onFocusableItemRemove:p}=c;return _.useEffect((()=>{if(r)return h(),()=>p()}),[r,h,p]),E.jsx(Q3.ItemSlot,{scope:n,id:l,focusable:r,active:i,children:E.jsx(er.span,{tabIndex:u?0:-1,"data-orientation":c.orientation,...s,ref:t,onMouseDown:We(e.onMouseDown,(e=>{r?c.onItemFocus(l):e.preventDefault()})),onFocus:We(e.onFocus,(()=>c.onItemFocus(l))),onKeyDown:We(e.onKeyDown,(e=>{if("Tab"===e.key&&e.shiftKey)return void c.onItemShiftTab();if(e.target!==e.currentTarget)return;const t=fSe(e,c.orientation,c.dir);if(void 0!==t){if(e.metaKey||e.ctrlKey||e.altKey||e.shiftKey)return;e.preventDefault();let n=d().filter((e=>e.focusable)).map((e=>e.ref.current));if("last"===t)n.reverse();else if("prev"===t||"next"===t){"prev"===t&&n.reverse();const r=n.indexOf(e.currentTarget);n=c.loop?hSe(n,r+1):n.slice(r+1)}setTimeout((()=>rW(n)))}}))})})}));nW.displayName=tW;var uSe={ArrowLeft:"prev",ArrowUp:"prev",ArrowRight:"next",ArrowDown:"next",PageUp:"first",Home:"first",PageDown:"last",End:"last"};function dSe(e,t){return"rtl"!==t?e:"ArrowLeft"===e?"ArrowRight":"ArrowRight"===e?"ArrowLeft":e}function fSe(e,t,n){const r=dSe(e.key,n);if(!("vertical"===t&&["ArrowLeft","ArrowRight"].includes(r)||"horizontal"===t&&["ArrowUp","ArrowDown"].includes(r)))return uSe[r]}function rW(e,t=!1){const n=document.activeElement;for(const r of e)if(r===n||(r.focus({preventScroll:t}),document.activeElement!==n))return}function hSe(e,t){return e.map(((n,r)=>e[(t+r)%e.length]))}var pSe=eW,mSe=nW,gSe=function(e){return typeof document>"u"?null:(Array.isArray(e)?e[0]:e).ownerDocument.body},Jf=new WeakMap,G1=new WeakMap,W1={},hR=0,iW=function(e){return e&&(e.host||iW(e.parentNode))},vSe=function(e,t){return t.map((function(t){if(e.contains(t))return t;var n=iW(t);return n&&e.contains(n)?n:(console.error("aria-hidden",t,"in not contained inside",e,". Doing nothing"),null)})).filter((function(e){return!!e}))},ySe=function(e,t,n,r){var i=vSe(t,Array.isArray(e)?e:[e]);W1[n]||(W1[n]=new WeakMap);var o=W1[n],s=[],a=new Set,l=new Set(i),c=function(e){!e||a.has(e)||(a.add(e),c(e.parentNode))};i.forEach(c);var u=function(e){!e||l.has(e)||Array.prototype.forEach.call(e.children,(function(e){if(a.has(e))u(e);else try{var t=e.getAttribute(r),i=null!==t&&"false"!==t,l=(Jf.get(e)||0)+1,c=(o.get(e)||0)+1;Jf.set(e,l),o.set(e,c),s.push(e),1===l&&i&&G1.set(e,!0),1===c&&e.setAttribute(n,"true"),i||e.setAttribute(r,"true")}catch(t){console.error("aria-hidden: cannot operate on ",e,t)}}))};return u(t),a.clear(),hR++,function(){s.forEach((function(e){var t=Jf.get(e)-1,i=o.get(e)-1;Jf.set(e,t),o.set(e,i),t||(G1.has(e)||e.removeAttribute(r),G1.delete(e)),i||e.removeAttribute(n)})),--hR||(Jf=new WeakMap,Jf=new WeakMap,G1=new WeakMap,W1={})}},sW=function(e,t,n){void 0===n&&(n="data-aria-hidden");var r=Array.from(Array.isArray(e)?e:[e]),i=gSe(e);return i?(r.push.apply(r,Array.from(i.querySelectorAll("[aria-live]"))),ySe(r,i,n,"aria-hidden")):function(){return null}},ex=function(e,t){return(ex=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)};function no(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}ex(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}var Nr=function(){return Nr=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},Nr.apply(this,arguments)};function jy(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n}function oW(e,t,n,r){var i,o=arguments.length,s=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(s=(o<3?i(s):o>3?i(t,n,s):i(t,n))||s);return o>3&&s&&Object.defineProperty(t,n,s),s}function aW(e,t){return function(n,r){t(n,r,e)}}function lW(e,t,n,r,i,o){function s(e){if(void 0!==e&&"function"!=typeof e)throw new TypeError("Function expected");return e}for(var a,l=r.kind,c="getter"===l?"get":"setter"===l?"set":"value",u=!t&&e?r.static?e:e.prototype:null,d=t||(u?Object.getOwnPropertyDescriptor(u,r.name):{}),h=!1,p=n.length-1;p>=0;p--){var f={};for(var m in r)f[m]="access"===m?{}:r[m];for(var m in r.access)f.access[m]=r.access[m];f.addInitializer=function(e){if(h)throw new TypeError("Cannot add initializers after decoration has completed");o.push(s(e||null))};var v=(0,n[p])("accessor"===l?{get:d.get,set:d.set}:d[c],f);if("accessor"===l){if(void 0===v)continue;if(null===v||"object"!=typeof v)throw new TypeError("Object expected");(a=s(v.get))&&(d.get=a),(a=s(v.set))&&(d.set=a),(a=s(v.init))&&i.unshift(a)}else(a=s(v))&&("field"===l?i.unshift(a):d[c]=a)}u&&Object.defineProperty(u,r.name,d),h=!0}function cW(e,t,n){for(var r=arguments.length>2,i=0;i<t.length;i++)n=r?t[i].call(e,n):t[i].call(e);return r?n:void 0}function uW(e){return"symbol"==typeof e?e:"".concat(e)}function dW(e,t,n){return"symbol"==typeof t&&(t=t.description?"[".concat(t.description,"]"):""),Object.defineProperty(e,"name",{configurable:!0,value:n?"".concat(n," ",t):t})}function fW(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)}function o6(e,t,n,r){return new(n||(n=Promise))((function(i,o){function s(e){try{l(r.next(e))}catch(e){o(e)}}function a(e){try{l(r.throw(e))}catch(e){o(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(s,a)}l((r=r.apply(e,t||[])).next())}))}function mw(e,t){var n,r,i,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]},s=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return s.next=a(0),s.throw=a(1),s.return=a(2),"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function a(a){return function(l){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;s&&(s=0,a[0]&&(o=0)),o;)try{if(n=1,r&&(i=2&a[0]?r.return:a[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,a[1])).done)return i;switch(r=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,r=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!(i=(i=o.trys).length>0&&i[i.length-1])&&(6===a[0]||2===a[0])){o=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){o.label=a[1];break}if(6===a[0]&&o.label<i[1]){o.label=i[1],i=a;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(a);break}i[2]&&o.ops.pop(),o.trys.pop();continue}a=t.call(e,o)}catch(e){a=[6,e],r=0}finally{n=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,l])}}}var gw=Object.create?function(e,t,n,r){void 0===r&&(r=n);var i=Object.getOwnPropertyDescriptor(t,n);(!i||("get"in i?!t.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,r,i)}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]};function hW(e,t){for(var n in e)"default"!==n&&!Object.prototype.hasOwnProperty.call(t,n)&&gw(t,e,n)}function _u(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function Zs(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,i,o=n.call(e),s=[];try{for(;(void 0===t||t-- >0)&&!(r=o.next()).done;)s.push(r.value)}catch(e){i={error:e}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return s}function pW(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(Zs(arguments[t]));return e}function mW(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;var r=Array(e),i=0;for(t=0;t<n;t++)for(var o=arguments[t],s=0,a=o.length;s<a;s++,i++)r[i]=o[s];return r}function Qs(e,t,n){if(n||2===arguments.length)for(var r,i=0,o=t.length;i<o;i++)(r||!(i in t))&&(r||(r=Array.prototype.slice.call(t,0,i)),r[i]=t[i]);return e.concat(r||Array.prototype.slice.call(t))}function Il(e){return this instanceof Il?(this.v=e,this):new Il(e)}function a6(e,t,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r,i=n.apply(e,t||[]),o=[];return r=Object.create(("function"==typeof AsyncIterator?AsyncIterator:Object).prototype),s("next"),s("throw"),s("return",(function(e){return function(t){return Promise.resolve(t).then(e,c)}})),r[Symbol.asyncIterator]=function(){return this},r;function s(e,t){i[e]&&(r[e]=function(t){return new Promise((function(n,r){o.push([e,t,n,r])>1||a(e,t)}))},t&&(r[e]=t(r[e])))}function a(e,t){try{!function(e){e.value instanceof Il?Promise.resolve(e.value.v).then(l,c):u(o[0][2],e)}(i[e](t))}catch(e){u(o[0][3],e)}}function l(e){a("next",e)}function c(e){a("throw",e)}function u(e,t){e(t),o.shift(),o.length&&a(o[0][0],o[0][1])}}function gW(e){var t,n;return t={},r("next"),r("throw",(function(e){throw e})),r("return"),t[Symbol.iterator]=function(){return this},t;function r(r,i){t[r]=e[r]?function(t){return(n=!n)?{value:Il(e[r](t)),done:!1}:i?i(t):t}:i}}function l6(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t,n=e[Symbol.asyncIterator];return n?n.call(e):(e="function"==typeof _u?_u(e):e[Symbol.iterator](),t={},r("next"),r("throw"),r("return"),t[Symbol.asyncIterator]=function(){return this},t);function r(n){t[n]=e[n]&&function(t){return new Promise((function(r,i){(function(e,t,n,r){Promise.resolve(r).then((function(t){e({value:t,done:n})}),t)})(r,i,(t=e[n](t)).done,t.value)}))}}}function vW(e,t){return Object.defineProperty?Object.defineProperty(e,"raw",{value:t}):e.raw=t,e}var _Se=Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t},tx=function(e){return(tx=Object.getOwnPropertyNames||function(e){var t=[];for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[t.length]=n);return t})(e)};function yW(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n=tx(e),r=0;r<n.length;r++)"default"!==n[r]&&gw(t,e,n[r]);return _Se(t,e),t}function _W(e){return e&&e.__esModule?e:{default:e}}function bW(e,t,n,r){if("a"===n&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?r:"a"===n?r.call(e):r?r.value:t.get(e)}function SW(e,t,n,r,i){if("m"===r)throw new TypeError("Private method is not writable");if("a"===r&&!i)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!i:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===r?i.call(e,n):i?i.value=n:t.set(e,n),n}function EW(e,t){if(null===t||"object"!=typeof t&&"function"!=typeof t)throw new TypeError("Cannot use 'in' operator on non-object");return"function"==typeof e?t===e:e.has(t)}function wW(e,t,n){if(null!=t){if("object"!=typeof t&&"function"!=typeof t)throw new TypeError("Object expected.");var r,i;if(n){if(!Symbol.asyncDispose)throw new TypeError("Symbol.asyncDispose is not defined.");r=t[Symbol.asyncDispose]}if(void 0===r){if(!Symbol.dispose)throw new TypeError("Symbol.dispose is not defined.");r=t[Symbol.dispose],n&&(i=r)}if("function"!=typeof r)throw new TypeError("Object not disposable.");i&&(r=function(){try{i.call(this)}catch(e){return Promise.reject(e)}}),e.stack.push({value:t,dispose:r,async:n})}else n&&e.stack.push({async:!0});return t}var bSe="function"==typeof SuppressedError?SuppressedError:function(e,t,n){var r=new Error(n);return r.name="SuppressedError",r.error=e,r.suppressed=t,r};function CW(e){function t(t){e.error=e.hasError?new bSe(t,e.error,"An error was suppressed during disposal."):t,e.hasError=!0}var n,r=0;return function i(){for(;n=e.stack.pop();)try{if(!n.async&&1===r)return r=0,e.stack.push(n),Promise.resolve().then(i);if(n.dispose){var o=n.dispose.call(n.value);if(n.async)return r|=2,Promise.resolve(o).then(i,(function(e){return t(e),i()}))}else r|=1}catch(e){t(e)}if(1===r)return e.hasError?Promise.reject(e.error):Promise.resolve();if(e.hasError)throw e.error}()}function TW(e,t){return"string"==typeof e&&/^\.\.?\//.test(e)?e.replace(/\.(tsx)$|((?:\.d)?)((?:\.[^./]+?)?)\.([cm]?)ts$/i,(function(e,n,r,i,o){return n?t?".jsx":".js":!r||i&&o?r+i+"."+o.toLowerCase()+"js":e})):e}const SSe={__extends:no,__assign:Nr,__rest:jy,__decorate:oW,__param:aW,__esDecorate:lW,__runInitializers:cW,__propKey:uW,__setFunctionName:dW,__metadata:fW,__awaiter:o6,__generator:mw,__createBinding:gw,__exportStar:hW,__values:_u,__read:Zs,__spread:pW,__spreadArrays:mW,__spreadArray:Qs,__await:Il,__asyncGenerator:a6,__asyncDelegator:gW,__asyncValues:l6,__makeTemplateObject:vW,__importStar:yW,__importDefault:_W,__classPrivateFieldGet:bW,__classPrivateFieldSet:SW,__classPrivateFieldIn:EW,__addDisposableResource:wW,__disposeResources:CW,__rewriteRelativeImportExtension:TW},oGe=Object.freeze(Object.defineProperty({__proto__:null,__addDisposableResource:wW,get __assign(){return Nr},__asyncDelegator:gW,__asyncGenerator:a6,__asyncValues:l6,__await:Il,__awaiter:o6,__classPrivateFieldGet:bW,__classPrivateFieldIn:EW,__classPrivateFieldSet:SW,__createBinding:gw,__decorate:oW,__disposeResources:CW,__esDecorate:lW,__exportStar:hW,__extends:no,__generator:mw,__importDefault:_W,__importStar:yW,__makeTemplateObject:vW,__metadata:fW,__param:aW,__propKey:uW,__read:Zs,__rest:jy,__rewriteRelativeImportExtension:TW,__runInitializers:cW,__setFunctionName:dW,__spread:pW,__spreadArray:Qs,__spreadArrays:mW,__values:_u,default:SSe},Symbol.toStringTag,{value:"Module"}));var rv="right-scroll-bar-position",iv="width-before-scroll-bar",ESe="with-scroll-bars-hidden",wSe="--removed-body-scroll-bar-size";function pR(e,t){return"function"==typeof e?e(t):e&&(e.current=t),e}function CSe(e,t){var n=_.useState((function(){return{value:e,callback:t,facade:{get current(){return n.value},set current(e){var t=n.value;t!==e&&(n.value=e,n.callback(e,t))}}}}))[0];return n.callback=t,n.facade}var TSe=typeof window<"u"?_.useLayoutEffect:_.useEffect,A7=new WeakMap;function RW(e,t){var n=CSe(null,(function(t){return e.forEach((function(e){return pR(e,t)}))}));return TSe((function(){var t=A7.get(n);if(t){var r=new Set(t),i=new Set(e),o=n.current;r.forEach((function(e){i.has(e)||pR(e,null)})),i.forEach((function(e){r.has(e)||pR(e,o)}))}A7.set(n,e)}),[e]),n}function RSe(e){return e}function ISe(e,t){void 0===t&&(t=RSe);var n=[],r=!1;return{read:function(){if(r)throw new Error("Sidecar: could not `read` from an `assigned` medium. `read` could be used only with `useMedium`.");return n.length?n[n.length-1]:e},useMedium:function(e){var i=t(e,r);return n.push(i),function(){n=n.filter((function(e){return e!==i}))}},assignSyncMedium:function(e){for(r=!0;n.length;){var t=n;n=[],t.forEach(e)}n={push:function(t){return e(t)},filter:function(){return n}}},assignMedium:function(e){r=!0;var t=[];if(n.length){var i=n;n=[],i.forEach(e),t=n}var o=function(){var n=t;t=[],n.forEach(e)},s=function(){return Promise.resolve().then(o)};s(),n={push:function(e){t.push(e),s()},filter:function(e){return t=t.filter(e),n}}}}}function IW(e){void 0===e&&(e={});var t=ISe(null);return t.options=Nr({async:!0,ssr:!1},e),t}var kW=function(e){var t=e.sideCar,n=jy(e,["sideCar"]);if(!t)throw new Error("Sidecar: please provide `sideCar` property to import the right car");var r=t.read();if(!r)throw new Error("Sidecar medium not found");return _.createElement(r,Nr({},n))};function xW(e,t){return e.useMedium(t),kW}kW.isSideCarExport=!0;var PW=IW(),mR=function(){},vw=_.forwardRef((function(e,t){var n=_.useRef(null),r=_.useState({onScrollCapture:mR,onWheelCapture:mR,onTouchMoveCapture:mR}),i=r[0],o=r[1],s=e.forwardProps,a=e.children,l=e.className,c=e.removeScrollBar,u=e.enabled,d=e.shards,h=e.sideCar,p=e.noIsolation,f=e.inert,m=e.allowPinchZoom,v=e.as,g=void 0===v?"div":v,y=e.gapMode,b=jy(e,["forwardProps","children","className","removeScrollBar","enabled","shards","sideCar","noIsolation","inert","allowPinchZoom","as","gapMode"]),w=h,E=RW([n,t]),S=Nr(Nr({},b),i);return _.createElement(_.Fragment,null,u&&_.createElement(w,{sideCar:PW,removeScrollBar:c,shards:d,noIsolation:p,inert:f,setCallbacks:o,allowPinchZoom:!!m,lockRef:n,gapMode:y}),s?_.cloneElement(_.Children.only(a),Nr(Nr({},S),{ref:E})):_.createElement(g,Nr({},S,{className:l,ref:E}),a))}));vw.defaultProps={enabled:!0,removeScrollBar:!0,inert:!1},vw.classNames={fullWidth:iv,zeroRight:rv};var kSe=function(){if(typeof __webpack_nonce__<"u")return __webpack_nonce__};function xSe(){if(!document)return null;var e=document.createElement("style");e.type="text/css";var t=kSe();return t&&e.setAttribute("nonce",t),e}function PSe(e,t){e.styleSheet?e.styleSheet.cssText=t:e.appendChild(document.createTextNode(t))}function LSe(e){(document.head||document.getElementsByTagName("head")[0]).appendChild(e)}var OSe=function(){var e=0,t=null;return{add:function(n){0==e&&(t=xSe())&&(PSe(t,n),LSe(t)),e++},remove:function(){! --e&&t&&(t.parentNode&&t.parentNode.removeChild(t),t=null)}}},MSe=function(){var e=OSe();return function(t,n){_.useEffect((function(){return e.add(t),function(){e.remove()}}),[t&&n])}},c6=function(){var e=MSe();return function(t){var n=t.styles,r=t.dynamic;return e(n,r),null}},ASe={left:0,top:0,right:0,gap:0},gR=function(e){return parseInt(e||"",10)||0},NSe=function(e){var t=window.getComputedStyle(document.body),n=t["padding"===e?"paddingLeft":"marginLeft"],r=t["padding"===e?"paddingTop":"marginTop"],i=t["padding"===e?"paddingRight":"marginRight"];return[gR(n),gR(r),gR(i)]},DSe=function(e){if(void 0===e&&(e="margin"),typeof window>"u")return ASe;var t=NSe(e),n=document.documentElement.clientWidth,r=window.innerWidth;return{left:t[0],top:t[1],right:t[2],gap:Math.max(0,r-n+t[2]-t[0])}},jSe=c6(),Gh="data-scroll-locked",USe=function(e,t,n,r){var i=e.left,o=e.top,s=e.right,a=e.gap;return void 0===n&&(n="margin"),"\n  .".concat(ESe," {\n   overflow: hidden ").concat(r,";\n   padding-right: ").concat(a,"px ").concat(r,";\n  }\n  body[").concat(Gh,"] {\n    overflow: hidden ").concat(r,";\n    overscroll-behavior: contain;\n    ").concat([t&&"position: relative ".concat(r,";"),"margin"===n&&"\n    padding-left: ".concat(i,"px;\n    padding-top: ").concat(o,"px;\n    padding-right: ").concat(s,"px;\n    margin-left:0;\n    margin-top:0;\n    margin-right: ").concat(a,"px ").concat(r,";\n    "),"padding"===n&&"padding-right: ".concat(a,"px ").concat(r,";")].filter(Boolean).join(""),"\n  }\n  \n  .").concat(rv," {\n    right: ").concat(a,"px ").concat(r,";\n  }\n  \n  .").concat(iv," {\n    margin-right: ").concat(a,"px ").concat(r,";\n  }\n  \n  .").concat(rv," .").concat(rv," {\n    right: 0 ").concat(r,";\n  }\n  \n  .").concat(iv," .").concat(iv," {\n    margin-right: 0 ").concat(r,";\n  }\n  \n  body[").concat(Gh,"] {\n    ").concat(wSe,": ").concat(a,"px;\n  }\n")},N7=function(){var e=parseInt(document.body.getAttribute(Gh)||"0",10);return isFinite(e)?e:0},FSe=function(){_.useEffect((function(){return document.body.setAttribute(Gh,(N7()+1).toString()),function(){var e=N7()-1;e<=0?document.body.removeAttribute(Gh):document.body.setAttribute(Gh,e.toString())}}),[])},LW=function(e){var t=e.noRelative,n=e.noImportant,r=e.gapMode,i=void 0===r?"margin":r;FSe();var o=_.useMemo((function(){return DSe(i)}),[i]);return _.createElement(jSe,{styles:USe(o,!t,i,n?"":"!important")})},nx=!1;if(typeof window<"u")try{var z1=Object.defineProperty({},"passive",{get:function(){return nx=!0,!0}});window.addEventListener("test",z1,z1),window.removeEventListener("test",z1,z1)}catch{nx=!1}var Xf=!!nx&&{passive:!1},$Se=function(e){return"TEXTAREA"===e.tagName},OW=function(e,t){if(!(e instanceof Element))return!1;var n=window.getComputedStyle(e);return"hidden"!==n[t]&&!(n.overflowY===n.overflowX&&!$Se(e)&&"visible"===n[t])},HSe=function(e){return OW(e,"overflowY")},BSe=function(e){return OW(e,"overflowX")},D7=function(e,t){var n=t.ownerDocument,r=t;do{if(typeof ShadowRoot<"u"&&r instanceof ShadowRoot&&(r=r.host),MW(e,r)){var i=AW(e,r);if(i[1]>i[2])return!0}r=r.parentNode}while(r&&r!==n.body);return!1},VSe=function(e){return[e.scrollTop,e.scrollHeight,e.clientHeight]},qSe=function(e){return[e.scrollLeft,e.scrollWidth,e.clientWidth]},MW=function(e,t){return"v"===e?HSe(t):BSe(t)},AW=function(e,t){return"v"===e?VSe(t):qSe(t)},KSe=function(e,t){return"h"===e&&"rtl"===t?-1:1},GSe=function(e,t,n,r,i){var o=KSe(e,window.getComputedStyle(t).direction),s=o*r,a=n.target,l=t.contains(a),c=!1,u=s>0,d=0,h=0;do{var p=AW(e,a),f=p[0],m=p[1]-p[2]-o*f;(f||m)&&MW(e,a)&&(d+=m,h+=f),a=a instanceof ShadowRoot?a.host:a.parentNode}while(!l&&a!==document.body||l&&(t.contains(a)||t===a));return(u&&Math.abs(d)<1||!u&&Math.abs(h)<1)&&(c=!0),c},Y1=function(e){return"changedTouches"in e?[e.changedTouches[0].clientX,e.changedTouches[0].clientY]:[0,0]},j7=function(e){return[e.deltaX,e.deltaY]},U7=function(e){return e&&"current"in e?e.current:e},WSe=function(e,t){return e[0]===t[0]&&e[1]===t[1]},zSe=function(e){return"\n  .block-interactivity-".concat(e," {pointer-events: none;}\n  .allow-interactivity-").concat(e," {pointer-events: all;}\n")},YSe=0,Zf=[];function JSe(e){var t=_.useRef([]),n=_.useRef([0,0]),r=_.useRef(),i=_.useState(YSe++)[0],o=_.useState(c6)[0],s=_.useRef(e);_.useEffect((function(){s.current=e}),[e]),_.useEffect((function(){if(e.inert){document.body.classList.add("block-interactivity-".concat(i));var t=Qs([e.lockRef.current],(e.shards||[]).map(U7),!0).filter(Boolean);return t.forEach((function(e){return e.classList.add("allow-interactivity-".concat(i))})),function(){document.body.classList.remove("block-interactivity-".concat(i)),t.forEach((function(e){return e.classList.remove("allow-interactivity-".concat(i))}))}}}),[e.inert,e.lockRef.current,e.shards]);var a=_.useCallback((function(e,t){if("touches"in e&&2===e.touches.length||"wheel"===e.type&&e.ctrlKey)return!s.current.allowPinchZoom;var i,o=Y1(e),a=n.current,l="deltaX"in e?e.deltaX:a[0]-o[0],c="deltaY"in e?e.deltaY:a[1]-o[1],u=e.target,d=Math.abs(l)>Math.abs(c)?"h":"v";if("touches"in e&&"h"===d&&"range"===u.type)return!1;var h=D7(d,u);if(!h)return!0;if(h?i=d:(i="v"===d?"h":"v",h=D7(d,u)),!h)return!1;if(!r.current&&"changedTouches"in e&&(l||c)&&(r.current=i),!i)return!0;var p=r.current||i;return GSe(p,t,e,"h"===p?l:c)}),[]),l=_.useCallback((function(e){var n=e;if(Zf.length&&Zf[Zf.length-1]===o){var r="deltaY"in n?j7(n):Y1(n),i=t.current.filter((function(e){return e.name===n.type&&(e.target===n.target||n.target===e.shadowParent)&&WSe(e.delta,r)}))[0];if(i&&i.should)return void(n.cancelable&&n.preventDefault());if(!i){var l=(s.current.shards||[]).map(U7).filter(Boolean).filter((function(e){return e.contains(n.target)}));(l.length>0?a(n,l[0]):!s.current.noIsolation)&&n.cancelable&&n.preventDefault()}}}),[]),c=_.useCallback((function(e,n,r,i){var o={name:e,delta:n,target:r,should:i,shadowParent:XSe(r)};t.current.push(o),setTimeout((function(){t.current=t.current.filter((function(e){return e!==o}))}),1)}),[]),u=_.useCallback((function(e){n.current=Y1(e),r.current=void 0}),[]),d=_.useCallback((function(t){c(t.type,j7(t),t.target,a(t,e.lockRef.current))}),[]),h=_.useCallback((function(t){c(t.type,Y1(t),t.target,a(t,e.lockRef.current))}),[]);_.useEffect((function(){return Zf.push(o),e.setCallbacks({onScrollCapture:d,onWheelCapture:d,onTouchMoveCapture:h}),document.addEventListener("wheel",l,Xf),document.addEventListener("touchmove",l,Xf),document.addEventListener("touchstart",u,Xf),function(){Zf=Zf.filter((function(e){return e!==o})),document.removeEventListener("wheel",l,Xf),document.removeEventListener("touchmove",l,Xf),document.removeEventListener("touchstart",u,Xf)}}),[]);var p=e.removeScrollBar,f=e.inert;return _.createElement(_.Fragment,null,f?_.createElement(o,{styles:zSe(i)}):null,p?_.createElement(LW,{gapMode:e.gapMode}):null)}function XSe(e){for(var t=null;null!==e;)e instanceof ShadowRoot&&(t=e.host,e=e.host),e=e.parentNode;return t}const ZSe=xW(PW,JSe);var NW=_.forwardRef((function(e,t){return _.createElement(vw,Nr({},e,{ref:t,sideCar:ZSe}))}));NW.classNames=vw.classNames;var rx=["Enter"," "],QSe=["ArrowDown","PageUp","Home"],DW=["ArrowUp","PageDown","End"],eEe=[...QSe,...DW],tEe={ltr:[...rx,"ArrowRight"],rtl:[...rx,"ArrowLeft"]},nEe={ltr:["ArrowLeft"],rtl:["ArrowRight"]},Uy="Menu",[Vv,rEe,iEe]=LG(Uy),[nf,yw]=ja(Uy,[iEe,BG,QG]),_w=BG(),jW=QG(),[sEe,rf]=nf(Uy),[oEe,Fy]=nf(Uy),UW=e=>{const{__scopeMenu:t,open:n=!1,children:r,dir:i,onOpenChange:o,modal:s=!0}=e,a=_w(t),[l,c]=_.useState(null),u=_.useRef(!1),d=ts(o),h=n6(i);return _.useEffect((()=>{const e=()=>{u.current=!0,document.addEventListener("pointerdown",t,{capture:!0,once:!0}),document.addEventListener("pointermove",t,{capture:!0,once:!0})},t=()=>u.current=!1;return document.addEventListener("keydown",e,{capture:!0}),()=>{document.removeEventListener("keydown",e,{capture:!0}),document.removeEventListener("pointerdown",t,{capture:!0}),document.removeEventListener("pointermove",t,{capture:!0})}}),[]),E.jsx(Ybe,{...a,children:E.jsx(sEe,{scope:t,open:n,onOpenChange:d,content:l,onContentChange:c,children:E.jsx(oEe,{scope:t,onClose:_.useCallback((()=>d(!1)),[d]),isUsingKeyboardRef:u,dir:h,modal:s,children:r})})})};UW.displayName=Uy;var aEe="MenuAnchor",u6=_.forwardRef(((e,t)=>{const{__scopeMenu:n,...r}=e,i=_w(n);return E.jsx(Jbe,{...i,...r,ref:t})}));u6.displayName=aEe;var d6="MenuPortal",[lEe,FW]=nf(d6,{forceMount:void 0}),$W=e=>{const{__scopeMenu:t,forceMount:n,children:r,container:i}=e,o=rf(d6,t);return E.jsx(lEe,{scope:t,forceMount:n,children:E.jsx(ku,{present:n||o.open,children:E.jsx(XG,{asChild:!0,container:i,children:r})})})};$W.displayName=d6;var Ws="MenuContent",[cEe,f6]=nf(Ws),HW=_.forwardRef(((e,t)=>{const n=FW(Ws,e.__scopeMenu),{forceMount:r=n.forceMount,...i}=e,o=rf(Ws,e.__scopeMenu),s=Fy(Ws,e.__scopeMenu);return E.jsx(Vv.Provider,{scope:e.__scopeMenu,children:E.jsx(ku,{present:r||o.open,children:E.jsx(Vv.Slot,{scope:e.__scopeMenu,children:s.modal?E.jsx(uEe,{...i,ref:t}):E.jsx(dEe,{...i,ref:t})})})})})),uEe=_.forwardRef(((e,t)=>{const n=rf(Ws,e.__scopeMenu),r=_.useRef(null),i=tn(t,r);return _.useEffect((()=>{const e=r.current;if(e)return sW(e)}),[]),E.jsx(h6,{...e,ref:i,trapFocus:n.open,disableOutsidePointerEvents:n.open,disableOutsideScroll:!0,onFocusOutside:We(e.onFocusOutside,(e=>e.preventDefault()),{checkForDefaultPrevented:!1}),onDismiss:()=>n.onOpenChange(!1)})})),dEe=_.forwardRef(((e,t)=>{const n=rf(Ws,e.__scopeMenu);return E.jsx(h6,{...e,ref:t,trapFocus:!1,disableOutsidePointerEvents:!1,disableOutsideScroll:!1,onDismiss:()=>n.onOpenChange(!1)})})),h6=_.forwardRef(((e,t)=>{const{__scopeMenu:n,loop:r=!1,trapFocus:i,onOpenAutoFocus:o,onCloseAutoFocus:s,disableOutsidePointerEvents:a,onEntryFocus:l,onEscapeKeyDown:c,onPointerDownOutside:u,onFocusOutside:d,onInteractOutside:h,onDismiss:p,disableOutsideScroll:f,...m}=e,v=rf(Ws,n),g=Fy(Ws,n),y=_w(n),b=jW(n),w=rEe(n),[S,C]=_.useState(null),k=_.useRef(null),T=tn(t,k,v.onContentChange),I=_.useRef(0),R=_.useRef(""),x=_.useRef(0),L=_.useRef(null),P=_.useRef("right"),O=_.useRef(0),A=f?NW:_.Fragment,M=f?{as:bp,allowPinchZoom:!0}:void 0;_.useEffect((()=>()=>window.clearTimeout(I.current)),[]),DG();const N=_.useCallback((e=>{var t,n;return P.current===(null==(t=L.current)?void 0:t.side)&&TEe(e,null==(n=L.current)?void 0:n.area)}),[]);return E.jsx(cEe,{scope:n,searchRef:R,onItemEnter:_.useCallback((e=>{N(e)&&e.preventDefault()}),[N]),onItemLeave:_.useCallback((e=>{var t;N(e)||(null==(t=k.current)||t.focus(),C(null))}),[N]),onTriggerLeave:_.useCallback((e=>{N(e)&&e.preventDefault()}),[N]),pointerGraceTimerRef:x,onPointerGraceIntentChange:_.useCallback((e=>{L.current=e}),[]),children:E.jsx(A,{...M,children:E.jsx(jG,{asChild:!0,trapped:i,onMountAutoFocus:We(o,(e=>{var t;e.preventDefault(),null==(t=k.current)||t.focus({preventScroll:!0})})),onUnmountAutoFocus:s,children:E.jsx(r6,{asChild:!0,disableOutsidePointerEvents:a,onEscapeKeyDown:c,onPointerDownOutside:u,onFocusOutside:d,onInteractOutside:h,onDismiss:p,children:E.jsx(pSe,{asChild:!0,...b,dir:g.dir,orientation:"vertical",loop:r,currentTabStopId:S,onCurrentTabStopIdChange:C,onEntryFocus:We(l,(e=>{g.isUsingKeyboardRef.current||e.preventDefault()})),preventScrollOnEntryFocus:!0,children:E.jsx(Xbe,{role:"menu","aria-orientation":"vertical","data-state":rz(v.open),"data-radix-menu-content":"",dir:g.dir,...y,...m,ref:T,style:{outline:"none",...m.style},onKeyDown:We(m.onKeyDown,(e=>{const t=e.target.closest("[data-radix-menu-content]")===e.currentTarget,n=e.ctrlKey||e.altKey||e.metaKey,r=1===e.key.length;t&&("Tab"===e.key&&e.preventDefault(),!n&&r&&(e=>{var t,n;const r=R.current+e,i=w().filter((e=>!e.disabled)),o=document.activeElement,s=null==(t=i.find((e=>e.ref.current===o)))?void 0:t.textValue,a=wEe(i.map((e=>e.textValue)),r,s),l=null==(n=i.find((e=>e.textValue===a)))?void 0:n.ref.current;(function e(t){R.current=t,window.clearTimeout(I.current),""!==t&&(I.current=window.setTimeout((()=>e("")),1e3))})(r),l&&setTimeout((()=>l.focus()))})(e.key));const i=k.current;if(e.target!==i||!eEe.includes(e.key))return;e.preventDefault();const o=w().filter((e=>!e.disabled)).map((e=>e.ref.current));DW.includes(e.key)&&o.reverse(),SEe(o)})),onBlur:We(e.onBlur,(e=>{e.currentTarget.contains(e.target)||(window.clearTimeout(I.current),R.current="")})),onPointerMove:We(e.onPointerMove,qv((e=>{const t=e.target,n=O.current!==e.clientX;if(e.currentTarget.contains(t)&&n){const t=e.clientX>O.current?"right":"left";P.current=t,O.current=e.clientX}})))})})})})})})}));HW.displayName=Ws;var fEe="MenuGroup",p6=_.forwardRef(((e,t)=>{const{__scopeMenu:n,...r}=e;return E.jsx(er.div,{role:"group",...r,ref:t})}));p6.displayName=fEe;var hEe="MenuLabel",BW=_.forwardRef(((e,t)=>{const{__scopeMenu:n,...r}=e;return E.jsx(er.div,{...r,ref:t})}));BW.displayName=hEe;var LS="MenuItem",F7="menu.itemSelect",bw=_.forwardRef(((e,t)=>{const{disabled:n=!1,onSelect:r,...i}=e,o=_.useRef(null),s=Fy(LS,e.__scopeMenu),a=f6(LS,e.__scopeMenu),l=tn(t,o),c=_.useRef(!1);return E.jsx(VW,{...i,ref:l,disabled:n,onClick:We(e.onClick,(()=>{const e=o.current;if(!n&&e){const t=new CustomEvent(F7,{bubbles:!0,cancelable:!0});e.addEventListener(F7,(e=>null==r?void 0:r(e)),{once:!0}),gbe(e,t),t.defaultPrevented?c.current=!1:s.onClose()}})),onPointerDown:t=>{var n;null==(n=e.onPointerDown)||n.call(e,t),c.current=!0},onPointerUp:We(e.onPointerUp,(e=>{var t;c.current||null==(t=e.currentTarget)||t.click()})),onKeyDown:We(e.onKeyDown,(e=>{const t=""!==a.searchRef.current;n||t&&" "===e.key||rx.includes(e.key)&&(e.currentTarget.click(),e.preventDefault())}))})}));bw.displayName=LS;var VW=_.forwardRef(((e,t)=>{const{__scopeMenu:n,disabled:r=!1,textValue:i,...o}=e,s=f6(LS,n),a=jW(n),l=_.useRef(null),c=tn(t,l),[u,d]=_.useState(!1),[h,p]=_.useState("");return _.useEffect((()=>{const e=l.current;e&&p((e.textContent??"").trim())}),[o.children]),E.jsx(Vv.ItemSlot,{scope:n,disabled:r,textValue:i??h,children:E.jsx(mSe,{asChild:!0,...a,focusable:!r,children:E.jsx(er.div,{role:"menuitem","data-highlighted":u?"":void 0,"aria-disabled":r||void 0,"data-disabled":r?"":void 0,...o,ref:c,onPointerMove:We(e.onPointerMove,qv((e=>{r?s.onItemLeave(e):(s.onItemEnter(e),e.defaultPrevented||e.currentTarget.focus({preventScroll:!0}))}))),onPointerLeave:We(e.onPointerLeave,qv((e=>s.onItemLeave(e)))),onFocus:We(e.onFocus,(()=>d(!0))),onBlur:We(e.onBlur,(()=>d(!1)))})})})})),pEe="MenuCheckboxItem",qW=_.forwardRef(((e,t)=>{const{checked:n=!1,onCheckedChange:r,...i}=e;return E.jsx(YW,{scope:e.__scopeMenu,checked:n,children:E.jsx(bw,{role:"menuitemcheckbox","aria-checked":OS(n)?"mixed":n,...i,ref:t,"data-state":g6(n),onSelect:We(i.onSelect,(()=>null==r?void 0:r(!!OS(n)||!n)),{checkForDefaultPrevented:!1})})})}));qW.displayName=pEe;var KW="MenuRadioGroup",[mEe,gEe]=nf(KW,{value:void 0,onValueChange:()=>{}}),GW=_.forwardRef(((e,t)=>{const{value:n,onValueChange:r,...i}=e,o=ts(r);return E.jsx(mEe,{scope:e.__scopeMenu,value:n,onValueChange:o,children:E.jsx(p6,{...i,ref:t})})}));GW.displayName=KW;var WW="MenuRadioItem",zW=_.forwardRef(((e,t)=>{const{value:n,...r}=e,i=gEe(WW,e.__scopeMenu),o=n===i.value;return E.jsx(YW,{scope:e.__scopeMenu,checked:o,children:E.jsx(bw,{role:"menuitemradio","aria-checked":o,...r,ref:t,"data-state":g6(o),onSelect:We(r.onSelect,(()=>{var e;return null==(e=i.onValueChange)?void 0:e.call(i,n)}),{checkForDefaultPrevented:!1})})})}));zW.displayName=WW;var m6="MenuItemIndicator",[YW,vEe]=nf(m6,{checked:!1}),JW=_.forwardRef(((e,t)=>{const{__scopeMenu:n,forceMount:r,...i}=e,o=vEe(m6,n);return E.jsx(ku,{present:r||OS(o.checked)||!0===o.checked,children:E.jsx(er.span,{...i,ref:t,"data-state":g6(o.checked)})})}));JW.displayName=m6;var yEe="MenuSeparator",XW=_.forwardRef(((e,t)=>{const{__scopeMenu:n,...r}=e;return E.jsx(er.div,{role:"separator","aria-orientation":"horizontal",...r,ref:t})}));XW.displayName=yEe;var _Ee="MenuArrow",ZW=_.forwardRef(((e,t)=>{const{__scopeMenu:n,...r}=e,i=_w(n);return E.jsx(Zbe,{...i,...r,ref:t})}));ZW.displayName=_Ee;var bEe="MenuSub",[aGe,QW]=nf(bEe),Ng="MenuSubTrigger",ez=_.forwardRef(((e,t)=>{const n=rf(Ng,e.__scopeMenu),r=Fy(Ng,e.__scopeMenu),i=QW(Ng,e.__scopeMenu),o=f6(Ng,e.__scopeMenu),s=_.useRef(null),{pointerGraceTimerRef:a,onPointerGraceIntentChange:l}=o,c={__scopeMenu:e.__scopeMenu},u=_.useCallback((()=>{s.current&&window.clearTimeout(s.current),s.current=null}),[]);return _.useEffect((()=>u),[u]),_.useEffect((()=>{const e=a.current;return()=>{window.clearTimeout(e),l(null)}}),[a,l]),E.jsx(u6,{asChild:!0,...c,children:E.jsx(VW,{id:i.triggerId,"aria-haspopup":"menu","aria-expanded":n.open,"aria-controls":i.contentId,"data-state":rz(n.open),...e,ref:Ua(t,i.onTriggerChange),onClick:t=>{var r;null==(r=e.onClick)||r.call(e,t),!e.disabled&&!t.defaultPrevented&&(t.currentTarget.focus(),n.open||n.onOpenChange(!0))},onPointerMove:We(e.onPointerMove,qv((t=>{o.onItemEnter(t),!t.defaultPrevented&&!e.disabled&&!n.open&&!s.current&&(o.onPointerGraceIntentChange(null),s.current=window.setTimeout((()=>{n.onOpenChange(!0),u()}),100))}))),onPointerLeave:We(e.onPointerLeave,qv((e=>{var t,r;u();const i=null==(t=n.content)?void 0:t.getBoundingClientRect();if(i){const t=null==(r=n.content)?void 0:r.dataset.side,s="right"===t,l=s?-5:5,c=i[s?"left":"right"],u=i[s?"right":"left"];o.onPointerGraceIntentChange({area:[{x:e.clientX+l,y:e.clientY},{x:c,y:i.top},{x:u,y:i.top},{x:u,y:i.bottom},{x:c,y:i.bottom}],side:t}),window.clearTimeout(a.current),a.current=window.setTimeout((()=>o.onPointerGraceIntentChange(null)),300)}else{if(o.onTriggerLeave(e),e.defaultPrevented)return;o.onPointerGraceIntentChange(null)}}))),onKeyDown:We(e.onKeyDown,(t=>{var i;const s=""!==o.searchRef.current;e.disabled||s&&" "===t.key||tEe[r.dir].includes(t.key)&&(n.onOpenChange(!0),null==(i=n.content)||i.focus(),t.preventDefault())}))})})}));ez.displayName=Ng;var tz="MenuSubContent",nz=_.forwardRef(((e,t)=>{const n=FW(Ws,e.__scopeMenu),{forceMount:r=n.forceMount,...i}=e,o=rf(Ws,e.__scopeMenu),s=Fy(Ws,e.__scopeMenu),a=QW(tz,e.__scopeMenu),l=_.useRef(null),c=tn(t,l);return E.jsx(Vv.Provider,{scope:e.__scopeMenu,children:E.jsx(ku,{present:r||o.open,children:E.jsx(Vv.Slot,{scope:e.__scopeMenu,children:E.jsx(h6,{id:a.contentId,"aria-labelledby":a.triggerId,...i,ref:c,align:"start",side:"rtl"===s.dir?"left":"right",disableOutsidePointerEvents:!1,disableOutsideScroll:!1,trapFocus:!1,onOpenAutoFocus:e=>{var t;s.isUsingKeyboardRef.current&&(null==(t=l.current)||t.focus()),e.preventDefault()},onCloseAutoFocus:e=>e.preventDefault(),onFocusOutside:We(e.onFocusOutside,(e=>{e.target!==a.trigger&&o.onOpenChange(!1)})),onEscapeKeyDown:We(e.onEscapeKeyDown,(e=>{s.onClose(),e.preventDefault()})),onKeyDown:We(e.onKeyDown,(e=>{var t;const n=e.currentTarget.contains(e.target),r=nEe[s.dir].includes(e.key);n&&r&&(o.onOpenChange(!1),null==(t=a.trigger)||t.focus(),e.preventDefault())}))})})})})}));function rz(e){return e?"open":"closed"}function OS(e){return"indeterminate"===e}function g6(e){return OS(e)?"indeterminate":e?"checked":"unchecked"}function SEe(e){const t=document.activeElement;for(const n of e)if(n===t||(n.focus(),document.activeElement!==t))return}function EEe(e,t){return e.map(((n,r)=>e[(t+r)%e.length]))}function wEe(e,t,n){const r=t.length>1&&Array.from(t).every((e=>e===t[0]))?t[0]:t,i=n?e.indexOf(n):-1;let o=EEe(e,Math.max(i,0));1===r.length&&(o=o.filter((e=>e!==n)));const s=o.find((e=>e.toLowerCase().startsWith(r.toLowerCase())));return s!==n?s:void 0}function CEe(e,t){const{x:n,y:r}=e;let i=!1;for(let e=0,o=t.length-1;e<t.length;o=e++){const s=t[e].x,a=t[e].y,l=t[o].x,c=t[o].y;a>r!=c>r&&n<(l-s)*(r-a)/(c-a)+s&&(i=!i)}return i}function TEe(e,t){if(!t)return!1;return CEe({x:e.clientX,y:e.clientY},t)}function qv(e){return t=>"mouse"===t.pointerType?e(t):void 0}nz.displayName=tz;var iz=UW,sz=u6,oz=$W,az=HW,lz=p6,cz=BW,uz=bw,dz=qW,fz=GW,hz=zW,pz=JW,mz=XW,gz=ZW,vz=ez,yz=nz,v6="ContextMenu",[REe,lGe]=ja(v6,[yw]),Ii=yw(),[IEe,_z]=REe(v6),bz=e=>{const{__scopeContextMenu:t,children:n,onOpenChange:r,dir:i,modal:o=!0}=e,[s,a]=_.useState(!1),l=Ii(t),c=ts(r),u=_.useCallback((e=>{a(e),c(e)}),[c]);return E.jsx(IEe,{scope:t,open:s,onOpenChange:u,modal:o,children:E.jsx(iz,{...l,dir:i,open:s,onOpenChange:u,modal:o,children:n})})};bz.displayName=v6;var Sz="ContextMenuTrigger",Ez=_.forwardRef(((e,t)=>{const{__scopeContextMenu:n,disabled:r=!1,...i}=e,o=_z(Sz,n),s=Ii(n),a=_.useRef({x:0,y:0}),l=_.useRef({getBoundingClientRect:()=>DOMRect.fromRect({width:0,height:0,...a.current})}),c=_.useRef(0),u=_.useCallback((()=>window.clearTimeout(c.current)),[]),d=e=>{a.current={x:e.clientX,y:e.clientY},o.onOpenChange(!0)};return _.useEffect((()=>u),[u]),_.useEffect((()=>{r&&u()}),[r,u]),E.jsxs(E.Fragment,{children:[E.jsx(sz,{...s,virtualRef:l}),E.jsx(er.span,{"data-state":o.open?"open":"closed","data-disabled":r?"":void 0,...i,ref:t,style:{WebkitTouchCallout:"none",...e.style},onContextMenu:r?e.onContextMenu:We(e.onContextMenu,(e=>{u(),d(e),e.preventDefault()})),onPointerDown:r?e.onPointerDown:We(e.onPointerDown,J1((e=>{u(),c.current=window.setTimeout((()=>d(e)),700)}))),onPointerMove:r?e.onPointerMove:We(e.onPointerMove,J1(u)),onPointerCancel:r?e.onPointerCancel:We(e.onPointerCancel,J1(u)),onPointerUp:r?e.onPointerUp:We(e.onPointerUp,J1(u))})]})}));Ez.displayName=Sz;var kEe="ContextMenuPortal",wz=e=>{const{__scopeContextMenu:t,...n}=e,r=Ii(t);return E.jsx(oz,{...r,...n})};wz.displayName=kEe;var Cz="ContextMenuContent",Tz=_.forwardRef(((e,t)=>{const{__scopeContextMenu:n,...r}=e,i=_z(Cz,n),o=Ii(n),s=_.useRef(!1);return E.jsx(az,{...o,...r,ref:t,side:"right",sideOffset:2,align:"start",onCloseAutoFocus:t=>{var n;null==(n=e.onCloseAutoFocus)||n.call(e,t),!t.defaultPrevented&&s.current&&t.preventDefault(),s.current=!1},onInteractOutside:t=>{var n;null==(n=e.onInteractOutside)||n.call(e,t),!t.defaultPrevented&&!i.modal&&(s.current=!0)},style:{...e.style,"--radix-context-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-context-menu-content-available-width":"var(--radix-popper-available-width)","--radix-context-menu-content-available-height":"var(--radix-popper-available-height)","--radix-context-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-context-menu-trigger-height":"var(--radix-popper-anchor-height)"}})}));Tz.displayName=Cz;var xEe="ContextMenuGroup",PEe=_.forwardRef(((e,t)=>{const{__scopeContextMenu:n,...r}=e,i=Ii(n);return E.jsx(lz,{...i,...r,ref:t})}));PEe.displayName=xEe;var LEe="ContextMenuLabel",OEe=_.forwardRef(((e,t)=>{const{__scopeContextMenu:n,...r}=e,i=Ii(n);return E.jsx(cz,{...i,...r,ref:t})}));OEe.displayName=LEe;var MEe="ContextMenuItem",Rz=_.forwardRef(((e,t)=>{const{__scopeContextMenu:n,...r}=e,i=Ii(n);return E.jsx(uz,{...i,...r,ref:t})}));Rz.displayName=MEe;var AEe="ContextMenuCheckboxItem",NEe=_.forwardRef(((e,t)=>{const{__scopeContextMenu:n,...r}=e,i=Ii(n);return E.jsx(dz,{...i,...r,ref:t})}));NEe.displayName=AEe;var DEe="ContextMenuRadioGroup",jEe=_.forwardRef(((e,t)=>{const{__scopeContextMenu:n,...r}=e,i=Ii(n);return E.jsx(fz,{...i,...r,ref:t})}));jEe.displayName=DEe;var UEe="ContextMenuRadioItem",FEe=_.forwardRef(((e,t)=>{const{__scopeContextMenu:n,...r}=e,i=Ii(n);return E.jsx(hz,{...i,...r,ref:t})}));FEe.displayName=UEe;var $Ee="ContextMenuItemIndicator",HEe=_.forwardRef(((e,t)=>{const{__scopeContextMenu:n,...r}=e,i=Ii(n);return E.jsx(pz,{...i,...r,ref:t})}));HEe.displayName=$Ee;var BEe="ContextMenuSeparator",VEe=_.forwardRef(((e,t)=>{const{__scopeContextMenu:n,...r}=e,i=Ii(n);return E.jsx(mz,{...i,...r,ref:t})}));VEe.displayName=BEe;var qEe="ContextMenuArrow",KEe=_.forwardRef(((e,t)=>{const{__scopeContextMenu:n,...r}=e,i=Ii(n);return E.jsx(gz,{...i,...r,ref:t})}));KEe.displayName=qEe;var GEe="ContextMenuSubTrigger",WEe=_.forwardRef(((e,t)=>{const{__scopeContextMenu:n,...r}=e,i=Ii(n);return E.jsx(vz,{...i,...r,ref:t})}));WEe.displayName=GEe;var zEe="ContextMenuSubContent",YEe=_.forwardRef(((e,t)=>{const{__scopeContextMenu:n,...r}=e,i=Ii(n);return E.jsx(yz,{...i,...r,ref:t,style:{...e.style,"--radix-context-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-context-menu-content-available-width":"var(--radix-popper-available-width)","--radix-context-menu-content-available-height":"var(--radix-popper-available-height)","--radix-context-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-context-menu-trigger-height":"var(--radix-popper-anchor-height)"}})}));function J1(e){return t=>"mouse"!==t.pointerType?e(t):void 0}YEe.displayName=zEe;var $7=bz,JEe=Ez,XEe=wz,ZEe=Tz;const QEe="_menu_1x5h1_17",ewe="_title_1x5h1_83",Iz={menu:QEe,title:ewe},twe=({title:e,id:t})=>E.jsx(Jt,{as:"h3",id:t,className:Iz.title,size:"sm",weight:"semibold",children:e}),y6=_.forwardRef((({title:e,showTitle:t=!0,className:n,children:r,...i},o)=>{const s=_.useId();return E.jsxs("div",{role:"menu",ref:o,"aria-label":t?void 0:e,"aria-labelledby":t?s:void 0,className:Ae(n,Iz.menu),...i,children:[t&&E.jsx(twe,{title:e,id:s}),r]})}));y6.displayName="FloatingMenu";var kz=_.forwardRef(((e,t)=>{const{children:n,...r}=e,i=_.Children.toArray(n),o=i.find(rwe);if(o){const e=o.props.children,n=i.map((t=>t===o?_.Children.count(e)>1?_.Children.only(null):_.isValidElement(e)?e.props.children:null:t));return E.jsx(ix,{...r,ref:t,children:_.isValidElement(e)?_.cloneElement(e,void 0,n):null})}return E.jsx(ix,{...r,ref:t,children:n})}));kz.displayName="Slot";var ix=_.forwardRef(((e,t)=>{const{children:n,...r}=e;if(_.isValidElement(n)){const e=swe(n),i=iwe(r,n.props);return n.type!==_.Fragment&&(i.ref=t?Ua(t,e):e),_.cloneElement(n,i)}return _.Children.count(n)>1?_.Children.only(null):null}));ix.displayName="SlotClone";var nwe=({children:e})=>E.jsx(E.Fragment,{children:e});function rwe(e){return _.isValidElement(e)&&e.type===nwe}function iwe(e,t){const n={...t};for(const r in t){const i=e[r],o=t[r];/^on[A-Z]/.test(r)?i&&o?n[r]=(...e)=>{o(...e),i(...e)}:i&&(n[r]=i):"style"===r?n[r]={...i,...o}:"className"===r&&(n[r]=[i,o].filter(Boolean).join(" "))}return{...e,...n}}function swe(e){var t,n;let r=null==(t=Object.getOwnPropertyDescriptor(e.props,"ref"))?void 0:t.get,i=r&&"isReactWarning"in r&&r.isReactWarning;return i?e.ref:(r=null==(n=Object.getOwnPropertyDescriptor(e,"ref"))?void 0:n.get,i=r&&"isReactWarning"in r&&r.isReactWarning,i?e.props.ref:e.props.ref||e.ref)}var owe=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","span","svg","ul"],awe=owe.reduce(((e,t)=>{const n=_.forwardRef(((e,n)=>{const{asChild:r,...i}=e,o=r?kz:t;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),E.jsx(o,{...i,ref:n})}));return n.displayName=`Primitive.${t}`,{...e,[t]:n}}),{}),vR="focusScope.autoFocusOnMount",yR="focusScope.autoFocusOnUnmount",H7={bubbles:!1,cancelable:!0},lwe="FocusScope",xz=_.forwardRef(((e,t)=>{const{loop:n=!1,trapped:r=!1,onMountAutoFocus:i,onUnmountAutoFocus:o,...s}=e,[a,l]=_.useState(null),c=ts(i),u=ts(o),d=_.useRef(null),h=tn(t,(e=>l(e))),p=_.useRef({paused:!1,pause(){this.paused=!0},resume(){this.paused=!1}}).current;_.useEffect((()=>{if(r){let e=function(e){if(p.paused||!a)return;const t=e.target;a.contains(t)?d.current=t:Lc(d.current,{select:!0})},t=function(e){if(p.paused||!a)return;const t=e.relatedTarget;null!==t&&(a.contains(t)||Lc(d.current,{select:!0}))},n=function(e){if(document.activeElement===document.body)for(const t of e)t.removedNodes.length>0&&Lc(a)};document.addEventListener("focusin",e),document.addEventListener("focusout",t);const r=new MutationObserver(n);return a&&r.observe(a,{childList:!0,subtree:!0}),()=>{document.removeEventListener("focusin",e),document.removeEventListener("focusout",t),r.disconnect()}}}),[r,a,p.paused]),_.useEffect((()=>{if(a){V7.add(p);const e=document.activeElement;if(!a.contains(e)){const t=new CustomEvent(vR,H7);a.addEventListener(vR,c),a.dispatchEvent(t),t.defaultPrevented||(cwe(pwe(Pz(a)),{select:!0}),document.activeElement===e&&Lc(a))}return()=>{a.removeEventListener(vR,c),setTimeout((()=>{const t=new CustomEvent(yR,H7);a.addEventListener(yR,u),a.dispatchEvent(t),t.defaultPrevented||Lc(e??document.body,{select:!0}),a.removeEventListener(yR,u),V7.remove(p)}),0)}}}),[a,c,u,p]);const f=_.useCallback((e=>{if(!n&&!r||p.paused)return;const t="Tab"===e.key&&!e.altKey&&!e.ctrlKey&&!e.metaKey,i=document.activeElement;if(t&&i){const t=e.currentTarget,[r,o]=uwe(t);r&&o?e.shiftKey||i!==o?e.shiftKey&&i===r&&(e.preventDefault(),n&&Lc(o,{select:!0})):(e.preventDefault(),n&&Lc(r,{select:!0})):i===t&&e.preventDefault()}}),[n,r,p.paused]);return E.jsx(awe.div,{tabIndex:-1,...s,ref:h,onKeyDown:f})}));function cwe(e,{select:t=!1}={}){const n=document.activeElement;for(const r of e)if(Lc(r,{select:t}),document.activeElement!==n)return}function uwe(e){const t=Pz(e);return[B7(t,e),B7(t.reverse(),e)]}function Pz(e){const t=[],n=document.createTreeWalker(e,NodeFilter.SHOW_ELEMENT,{acceptNode:e=>{const t="INPUT"===e.tagName&&"hidden"===e.type;return e.disabled||e.hidden||t?NodeFilter.FILTER_SKIP:e.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;n.nextNode();)t.push(n.currentNode);return t}function B7(e,t){for(const n of e)if(!dwe(n,{upTo:t}))return n}function dwe(e,{upTo:t}){if("hidden"===getComputedStyle(e).visibility)return!0;for(;e;){if(void 0!==t&&e===t)return!1;if("none"===getComputedStyle(e).display)return!0;e=e.parentElement}return!1}function fwe(e){return e instanceof HTMLInputElement&&"select"in e}function Lc(e,{select:t=!1}={}){if(e&&e.focus){const n=document.activeElement;e.focus({preventScroll:!0}),e!==n&&fwe(e)&&t&&e.select()}}xz.displayName=lwe;var V7=hwe();function hwe(){let e=[];return{add(t){const n=e[0];t!==n&&(null==n||n.pause()),e=q7(e,t),e.unshift(t)},remove(t){var n;e=q7(e,t),null==(n=e[0])||n.resume()}}}function q7(e,t){const n=[...e],r=n.indexOf(t);return-1!==r&&n.splice(r,1),n}function pwe(e){return e.filter((e=>"A"!==e.tagName))}var Lz=_.forwardRef(((e,t)=>{const{children:n,...r}=e,i=_.Children.toArray(n),o=i.find(gwe);if(o){const e=o.props.children,n=i.map((t=>t===o?_.Children.count(e)>1?_.Children.only(null):_.isValidElement(e)?e.props.children:null:t));return E.jsx(sx,{...r,ref:t,children:_.isValidElement(e)?_.cloneElement(e,void 0,n):null})}return E.jsx(sx,{...r,ref:t,children:n})}));Lz.displayName="Slot";var sx=_.forwardRef(((e,t)=>{const{children:n,...r}=e;if(_.isValidElement(n)){const e=ywe(n),i=vwe(r,n.props);return n.type!==_.Fragment&&(i.ref=t?Ua(t,e):e),_.cloneElement(n,i)}return _.Children.count(n)>1?_.Children.only(null):null}));sx.displayName="SlotClone";var mwe=({children:e})=>E.jsx(E.Fragment,{children:e});function gwe(e){return _.isValidElement(e)&&e.type===mwe}function vwe(e,t){const n={...t};for(const r in t){const i=e[r],o=t[r];/^on[A-Z]/.test(r)?i&&o?n[r]=(...e)=>{o(...e),i(...e)}:i&&(n[r]=i):"style"===r?n[r]={...i,...o}:"className"===r&&(n[r]=[i,o].filter(Boolean).join(" "))}return{...e,...n}}function ywe(e){var t,n;let r=null==(t=Object.getOwnPropertyDescriptor(e.props,"ref"))?void 0:t.get,i=r&&"isReactWarning"in r&&r.isReactWarning;return i?e.ref:(r=null==(n=Object.getOwnPropertyDescriptor(e,"ref"))?void 0:n.get,i=r&&"isReactWarning"in r&&r.isReactWarning,i?e.props.ref:e.props.ref||e.ref)}var _we=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","span","svg","ul"],bwe=_we.reduce(((e,t)=>{const n=_.forwardRef(((e,n)=>{const{asChild:r,...i}=e,o=r?Lz:t;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),E.jsx(o,{...i,ref:n})}));return n.displayName=`Primitive.${t}`,{...e,[t]:n}}),{}),Swe="Portal",Oz=_.forwardRef(((e,t)=>{var n;const{container:r,...i}=e,[o,s]=_.useState(!1);yu((()=>s(!0)),[]);const a=r||o&&(null==(n=null==globalThis?void 0:globalThis.document)?void 0:n.body);return a?_q.createPortal(E.jsx(bwe.div,{...i,ref:t}),a):null}));Oz.displayName=Swe;var _6=_.forwardRef(((e,t)=>{const{children:n,...r}=e,i=_.Children.toArray(n),o=i.find(wwe);if(o){const e=o.props.children,n=i.map((t=>t===o?_.Children.count(e)>1?_.Children.only(null):_.isValidElement(e)?e.props.children:null:t));return E.jsx(ox,{...r,ref:t,children:_.isValidElement(e)?_.cloneElement(e,void 0,n):null})}return E.jsx(ox,{...r,ref:t,children:n})}));_6.displayName="Slot";var ox=_.forwardRef(((e,t)=>{const{children:n,...r}=e;if(_.isValidElement(n)){const e=Twe(n),i=Cwe(r,n.props);return n.type!==_.Fragment&&(i.ref=t?Ua(t,e):e),_.cloneElement(n,i)}return _.Children.count(n)>1?_.Children.only(null):null}));ox.displayName="SlotClone";var Ewe=({children:e})=>E.jsx(E.Fragment,{children:e});function wwe(e){return _.isValidElement(e)&&e.type===Ewe}function Cwe(e,t){const n={...t};for(const r in t){const i=e[r],o=t[r];/^on[A-Z]/.test(r)?i&&o?n[r]=(...e)=>{o(...e),i(...e)}:i&&(n[r]=i):"style"===r?n[r]={...i,...o}:"className"===r&&(n[r]=[i,o].filter(Boolean).join(" "))}return{...e,...n}}function Twe(e){var t,n;let r=null==(t=Object.getOwnPropertyDescriptor(e.props,"ref"))?void 0:t.get,i=r&&"isReactWarning"in r&&r.isReactWarning;return i?e.ref:(r=null==(n=Object.getOwnPropertyDescriptor(e,"ref"))?void 0:n.get,i=r&&"isReactWarning"in r&&r.isReactWarning,i?e.props.ref:e.props.ref||e.ref)}var Rwe=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","span","svg","ul"],$y=Rwe.reduce(((e,t)=>{const n=_.forwardRef(((e,n)=>{const{asChild:r,...i}=e,o=r?_6:t;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),E.jsx(o,{...i,ref:n})}));return n.displayName=`Primitive.${t}`,{...e,[t]:n}}),{}),Mz=IW(),_R=function(){},Sw=_.forwardRef((function(e,t){var n=_.useRef(null),r=_.useState({onScrollCapture:_R,onWheelCapture:_R,onTouchMoveCapture:_R}),i=r[0],o=r[1],s=e.forwardProps,a=e.children,l=e.className,c=e.removeScrollBar,u=e.enabled,d=e.shards,h=e.sideCar,p=e.noIsolation,f=e.inert,m=e.allowPinchZoom,v=e.as,g=void 0===v?"div":v,y=e.gapMode,b=jy(e,["forwardProps","children","className","removeScrollBar","enabled","shards","sideCar","noIsolation","inert","allowPinchZoom","as","gapMode"]),w=h,E=RW([n,t]),S=Nr(Nr({},b),i);return _.createElement(_.Fragment,null,u&&_.createElement(w,{sideCar:Mz,removeScrollBar:c,shards:d,noIsolation:p,inert:f,setCallbacks:o,allowPinchZoom:!!m,lockRef:n,gapMode:y}),s?_.cloneElement(_.Children.only(a),Nr(Nr({},S),{ref:E})):_.createElement(g,Nr({},S,{className:l,ref:E}),a))}));Sw.defaultProps={enabled:!0,removeScrollBar:!0,inert:!1},Sw.classNames={fullWidth:iv,zeroRight:rv};var ax=!1;if(typeof window<"u")try{var X1=Object.defineProperty({},"passive",{get:function(){return ax=!0,!0}});window.addEventListener("test",X1,X1),window.removeEventListener("test",X1,X1)}catch{ax=!1}var Qf=!!ax&&{passive:!1},Iwe=function(e){return"TEXTAREA"===e.tagName},Az=function(e,t){if(!(e instanceof Element))return!1;var n=window.getComputedStyle(e);return"hidden"!==n[t]&&!(n.overflowY===n.overflowX&&!Iwe(e)&&"visible"===n[t])},kwe=function(e){return Az(e,"overflowY")},xwe=function(e){return Az(e,"overflowX")},K7=function(e,t){var n=t.ownerDocument,r=t;do{if(typeof ShadowRoot<"u"&&r instanceof ShadowRoot&&(r=r.host),Nz(e,r)){var i=Dz(e,r);if(i[1]>i[2])return!0}r=r.parentNode}while(r&&r!==n.body);return!1},Pwe=function(e){return[e.scrollTop,e.scrollHeight,e.clientHeight]},Lwe=function(e){return[e.scrollLeft,e.scrollWidth,e.clientWidth]},Nz=function(e,t){return"v"===e?kwe(t):xwe(t)},Dz=function(e,t){return"v"===e?Pwe(t):Lwe(t)},Owe=function(e,t){return"h"===e&&"rtl"===t?-1:1},Mwe=function(e,t,n,r,i){var o=Owe(e,window.getComputedStyle(t).direction),s=o*r,a=n.target,l=t.contains(a),c=!1,u=s>0,d=0,h=0;do{var p=Dz(e,a),f=p[0],m=p[1]-p[2]-o*f;(f||m)&&Nz(e,a)&&(d+=m,h+=f),a=a instanceof ShadowRoot?a.host:a.parentNode}while(!l&&a!==document.body||l&&(t.contains(a)||t===a));return(u&&Math.abs(d)<1||!u&&Math.abs(h)<1)&&(c=!0),c},Z1=function(e){return"changedTouches"in e?[e.changedTouches[0].clientX,e.changedTouches[0].clientY]:[0,0]},G7=function(e){return[e.deltaX,e.deltaY]},W7=function(e){return e&&"current"in e?e.current:e},Awe=function(e,t){return e[0]===t[0]&&e[1]===t[1]},Nwe=function(e){return"\n  .block-interactivity-".concat(e," {pointer-events: none;}\n  .allow-interactivity-").concat(e," {pointer-events: all;}\n")},Dwe=0,eh=[];function jwe(e){var t=_.useRef([]),n=_.useRef([0,0]),r=_.useRef(),i=_.useState(Dwe++)[0],o=_.useState(c6)[0],s=_.useRef(e);_.useEffect((function(){s.current=e}),[e]),_.useEffect((function(){if(e.inert){document.body.classList.add("block-interactivity-".concat(i));var t=Qs([e.lockRef.current],(e.shards||[]).map(W7),!0).filter(Boolean);return t.forEach((function(e){return e.classList.add("allow-interactivity-".concat(i))})),function(){document.body.classList.remove("block-interactivity-".concat(i)),t.forEach((function(e){return e.classList.remove("allow-interactivity-".concat(i))}))}}}),[e.inert,e.lockRef.current,e.shards]);var a=_.useCallback((function(e,t){if("touches"in e&&2===e.touches.length||"wheel"===e.type&&e.ctrlKey)return!s.current.allowPinchZoom;var i,o=Z1(e),a=n.current,l="deltaX"in e?e.deltaX:a[0]-o[0],c="deltaY"in e?e.deltaY:a[1]-o[1],u=e.target,d=Math.abs(l)>Math.abs(c)?"h":"v";if("touches"in e&&"h"===d&&"range"===u.type)return!1;var h=K7(d,u);if(!h)return!0;if(h?i=d:(i="v"===d?"h":"v",h=K7(d,u)),!h)return!1;if(!r.current&&"changedTouches"in e&&(l||c)&&(r.current=i),!i)return!0;var p=r.current||i;return Mwe(p,t,e,"h"===p?l:c)}),[]),l=_.useCallback((function(e){var n=e;if(eh.length&&eh[eh.length-1]===o){var r="deltaY"in n?G7(n):Z1(n),i=t.current.filter((function(e){return e.name===n.type&&(e.target===n.target||n.target===e.shadowParent)&&Awe(e.delta,r)}))[0];if(i&&i.should)return void(n.cancelable&&n.preventDefault());if(!i){var l=(s.current.shards||[]).map(W7).filter(Boolean).filter((function(e){return e.contains(n.target)}));(l.length>0?a(n,l[0]):!s.current.noIsolation)&&n.cancelable&&n.preventDefault()}}}),[]),c=_.useCallback((function(e,n,r,i){var o={name:e,delta:n,target:r,should:i,shadowParent:Uwe(r)};t.current.push(o),setTimeout((function(){t.current=t.current.filter((function(e){return e!==o}))}),1)}),[]),u=_.useCallback((function(e){n.current=Z1(e),r.current=void 0}),[]),d=_.useCallback((function(t){c(t.type,G7(t),t.target,a(t,e.lockRef.current))}),[]),h=_.useCallback((function(t){c(t.type,Z1(t),t.target,a(t,e.lockRef.current))}),[]);_.useEffect((function(){return eh.push(o),e.setCallbacks({onScrollCapture:d,onWheelCapture:d,onTouchMoveCapture:h}),document.addEventListener("wheel",l,Qf),document.addEventListener("touchmove",l,Qf),document.addEventListener("touchstart",u,Qf),function(){eh=eh.filter((function(e){return e!==o})),document.removeEventListener("wheel",l,Qf),document.removeEventListener("touchmove",l,Qf),document.removeEventListener("touchstart",u,Qf)}}),[]);var p=e.removeScrollBar,f=e.inert;return _.createElement(_.Fragment,null,f?_.createElement(o,{styles:Nwe(i)}):null,p?_.createElement(LW,{gapMode:e.gapMode}):null)}function Uwe(e){for(var t=null;null!==e;)e instanceof ShadowRoot&&(t=e.host,e=e.host),e=e.parentNode;return t}const Fwe=xW(Mz,jwe);var jz=_.forwardRef((function(e,t){return _.createElement(Sw,Nr({},e,{ref:t,sideCar:Fwe}))}));jz.classNames=Sw.classNames;var b6="Dialog",[Uz,cGe]=ja(b6),[$we,Go]=Uz(b6),Fz=e=>{const{__scopeDialog:t,children:n,open:r,defaultOpen:i,onOpenChange:o,modal:s=!0}=e,a=_.useRef(null),l=_.useRef(null),[c=!1,u]=hw({prop:r,defaultProp:i,onChange:o});return E.jsx($we,{scope:t,triggerRef:a,contentRef:l,contentId:Rl(),titleId:Rl(),descriptionId:Rl(),open:c,onOpenChange:u,onOpenToggle:_.useCallback((()=>u((e=>!e))),[u]),modal:s,children:n})};Fz.displayName=b6;var $z="DialogTrigger",Hz=_.forwardRef(((e,t)=>{const{__scopeDialog:n,...r}=e,i=Go($z,n),o=tn(t,i.triggerRef);return E.jsx($y.button,{type:"button","aria-haspopup":"dialog","aria-expanded":i.open,"aria-controls":i.contentId,"data-state":w6(i.open),...r,ref:o,onClick:We(e.onClick,i.onOpenToggle)})}));Hz.displayName=$z;var S6="DialogPortal",[Hwe,Bz]=Uz(S6,{forceMount:void 0}),Vz=e=>{const{__scopeDialog:t,forceMount:n,children:r,container:i}=e,o=Go(S6,t);return E.jsx(Hwe,{scope:t,forceMount:n,children:_.Children.map(r,(e=>E.jsx(ku,{present:n||o.open,children:E.jsx(Oz,{asChild:!0,container:i,children:e})})))})};Vz.displayName=S6;var MS="DialogOverlay",qz=_.forwardRef(((e,t)=>{const n=Bz(MS,e.__scopeDialog),{forceMount:r=n.forceMount,...i}=e,o=Go(MS,e.__scopeDialog);return o.modal?E.jsx(ku,{present:r||o.open,children:E.jsx(Bwe,{...i,ref:t})}):null}));qz.displayName=MS;var Bwe=_.forwardRef(((e,t)=>{const{__scopeDialog:n,...r}=e,i=Go(MS,n);return E.jsx(jz,{as:_6,allowPinchZoom:!0,shards:[i.contentRef],children:E.jsx($y.div,{"data-state":w6(i.open),...r,ref:t,style:{pointerEvents:"auto",...r.style}})})})),Bd="DialogContent",Kz=_.forwardRef(((e,t)=>{const n=Bz(Bd,e.__scopeDialog),{forceMount:r=n.forceMount,...i}=e,o=Go(Bd,e.__scopeDialog);return E.jsx(ku,{present:r||o.open,children:o.modal?E.jsx(Vwe,{...i,ref:t}):E.jsx(qwe,{...i,ref:t})})}));Kz.displayName=Bd;var Vwe=_.forwardRef(((e,t)=>{const n=Go(Bd,e.__scopeDialog),r=_.useRef(null),i=tn(t,n.contentRef,r);return _.useEffect((()=>{const e=r.current;if(e)return sW(e)}),[]),E.jsx(Gz,{...e,ref:i,trapFocus:n.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:We(e.onCloseAutoFocus,(e=>{var t;e.preventDefault(),null==(t=n.triggerRef.current)||t.focus()})),onPointerDownOutside:We(e.onPointerDownOutside,(e=>{const t=e.detail.originalEvent,n=0===t.button&&!0===t.ctrlKey;(2===t.button||n)&&e.preventDefault()})),onFocusOutside:We(e.onFocusOutside,(e=>e.preventDefault()))})})),qwe=_.forwardRef(((e,t)=>{const n=Go(Bd,e.__scopeDialog),r=_.useRef(!1),i=_.useRef(!1);return E.jsx(Gz,{...e,ref:t,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:t=>{var o,s;null==(o=e.onCloseAutoFocus)||o.call(e,t),t.defaultPrevented||(r.current||null==(s=n.triggerRef.current)||s.focus(),t.preventDefault()),r.current=!1,i.current=!1},onInteractOutside:t=>{var o,s;null==(o=e.onInteractOutside)||o.call(e,t),t.defaultPrevented||(r.current=!0,"pointerdown"===t.detail.originalEvent.type&&(i.current=!0));const a=t.target;(null==(s=n.triggerRef.current)?void 0:s.contains(a))&&t.preventDefault(),"focusin"===t.detail.originalEvent.type&&i.current&&t.preventDefault()}})})),Gz=_.forwardRef(((e,t)=>{const{__scopeDialog:n,trapFocus:r,onOpenAutoFocus:i,onCloseAutoFocus:o,...s}=e,a=Go(Bd,n),l=_.useRef(null),c=tn(t,l);return DG(),E.jsxs(E.Fragment,{children:[E.jsx(xz,{asChild:!0,loop:!0,trapped:r,onMountAutoFocus:i,onUnmountAutoFocus:o,children:E.jsx(r6,{role:"dialog",id:a.contentId,"aria-describedby":a.descriptionId,"aria-labelledby":a.titleId,"data-state":w6(a.open),...s,ref:c,onDismiss:()=>a.onOpenChange(!1)})}),E.jsxs(E.Fragment,{children:[E.jsx(Gwe,{titleId:a.titleId}),E.jsx(zwe,{contentRef:l,descriptionId:a.descriptionId})]})]})})),E6="DialogTitle",Wz=_.forwardRef(((e,t)=>{const{__scopeDialog:n,...r}=e,i=Go(E6,n);return E.jsx($y.h2,{id:i.titleId,...r,ref:t})}));Wz.displayName=E6;var zz="DialogDescription",Kwe=_.forwardRef(((e,t)=>{const{__scopeDialog:n,...r}=e,i=Go(zz,n);return E.jsx($y.p,{id:i.descriptionId,...r,ref:t})}));Kwe.displayName=zz;var Yz="DialogClose",Jz=_.forwardRef(((e,t)=>{const{__scopeDialog:n,...r}=e,i=Go(Yz,n);return E.jsx($y.button,{type:"button",...r,ref:t,onClick:We(e.onClick,(()=>i.onOpenChange(!1)))})}));function w6(e){return e?"open":"closed"}Jz.displayName=Yz;var Xz="DialogTitleWarning",[uGe,Zz]=cbe(Xz,{contentName:Bd,titleName:E6,docsSlug:"dialog"}),Gwe=({titleId:e})=>{const t=Zz(Xz),n=`\`${t.contentName}\` requires a \`${t.titleName}\` for the component to be accessible for screen reader users.\n\nIf you want to hide the \`${t.titleName}\`, you can wrap it with our VisuallyHidden component.\n\nFor more information, see https://radix-ui.com/primitives/docs/components/${t.docsSlug}`;return _.useEffect((()=>{e&&(document.getElementById(e)||console.error(n))}),[n,e]),null},Wwe="DialogDescriptionWarning",zwe=({contentRef:e,descriptionId:t})=>{const n=`Warning: Missing \`Description\` or \`aria-describedby={undefined}\` for {${Zz(Wwe).contentName}}.`;return _.useEffect((()=>{var r;const i=null==(r=e.current)?void 0:r.getAttribute("aria-describedby");t&&i&&(document.getElementById(t)||console.warn(n))}),[n,e,t]),null},C6=Fz,Ywe=Hz,T6=Vz,R6=qz,I6=Kz,k6=Wz,Qz=Jz;function Jwe(e){if(typeof document>"u")return;let t=document.head||document.getElementsByTagName("head")[0],n=document.createElement("style");n.type="text/css",t.appendChild(n),n.styleSheet?n.styleSheet.cssText=e:n.appendChild(document.createTextNode(e))}const eY=we.createContext({drawerRef:{current:null},overlayRef:{current:null},onPress:()=>{},onRelease:()=>{},onDrag:()=>{},onNestedDrag:()=>{},onNestedOpenChange:()=>{},onNestedRelease:()=>{},openProp:void 0,dismissible:!1,isOpen:!1,isDragging:!1,keyboardIsOpen:{current:!1},snapPointsOffset:null,snapPoints:null,handleOnly:!1,modal:!1,shouldFade:!1,activeSnapPoint:null,onOpenChange:()=>{},setActiveSnapPoint:()=>{},closeDrawer:()=>{},direction:"bottom",shouldAnimate:{current:!0},shouldScaleBackground:!1,setBackgroundColorOnScale:!0,noBodyStyles:!1,container:null,autoFocus:!1}),Hy=()=>{const e=we.useContext(eY);if(!e)throw new Error("useDrawerContext must be used within a Drawer.Root");return e};function Xwe(){const e=navigator.userAgent;return typeof window<"u"&&(/Firefox/.test(e)&&/Mobile/.test(e)||/FxiOS/.test(e))}function Zwe(){return x6(/^Mac/)}function Qwe(){return x6(/^iPhone/)}function z7(){return/^((?!chrome|android).)*safari/i.test(navigator.userAgent)}function eCe(){return x6(/^iPad/)||Zwe()&&navigator.maxTouchPoints>1}function tY(){return Qwe()||eCe()}function x6(e){return typeof window<"u"&&null!=window.navigator?e.test(window.navigator.platform):void 0}Jwe("[data-vaul-drawer]{touch-action:none;will-change:transform;transition:transform .5s cubic-bezier(.32, .72, 0, 1);animation-duration:.5s;animation-timing-function:cubic-bezier(0.32,0.72,0,1)}[data-vaul-drawer][data-vaul-snap-points=false][data-vaul-drawer-direction=bottom][data-state=open]{animation-name:slideFromBottom}[data-vaul-drawer][data-vaul-snap-points=false][data-vaul-drawer-direction=bottom][data-state=closed]{animation-name:slideToBottom}[data-vaul-drawer][data-vaul-snap-points=false][data-vaul-drawer-direction=top][data-state=open]{animation-name:slideFromTop}[data-vaul-drawer][data-vaul-snap-points=false][data-vaul-drawer-direction=top][data-state=closed]{animation-name:slideToTop}[data-vaul-drawer][data-vaul-snap-points=false][data-vaul-drawer-direction=left][data-state=open]{animation-name:slideFromLeft}[data-vaul-drawer][data-vaul-snap-points=false][data-vaul-drawer-direction=left][data-state=closed]{animation-name:slideToLeft}[data-vaul-drawer][data-vaul-snap-points=false][data-vaul-drawer-direction=right][data-state=open]{animation-name:slideFromRight}[data-vaul-drawer][data-vaul-snap-points=false][data-vaul-drawer-direction=right][data-state=closed]{animation-name:slideToRight}[data-vaul-drawer][data-vaul-snap-points=true][data-vaul-drawer-direction=bottom]{transform:translate3d(0,var(--initial-transform,100%),0)}[data-vaul-drawer][data-vaul-snap-points=true][data-vaul-drawer-direction=top]{transform:translate3d(0,calc(var(--initial-transform,100%) * -1),0)}[data-vaul-drawer][data-vaul-snap-points=true][data-vaul-drawer-direction=left]{transform:translate3d(calc(var(--initial-transform,100%) * -1),0,0)}[data-vaul-drawer][data-vaul-snap-points=true][data-vaul-drawer-direction=right]{transform:translate3d(var(--initial-transform,100%),0,0)}[data-vaul-drawer][data-vaul-delayed-snap-points=true][data-vaul-drawer-direction=top]{transform:translate3d(0,var(--snap-point-height,0),0)}[data-vaul-drawer][data-vaul-delayed-snap-points=true][data-vaul-drawer-direction=bottom]{transform:translate3d(0,var(--snap-point-height,0),0)}[data-vaul-drawer][data-vaul-delayed-snap-points=true][data-vaul-drawer-direction=left]{transform:translate3d(var(--snap-point-height,0),0,0)}[data-vaul-drawer][data-vaul-delayed-snap-points=true][data-vaul-drawer-direction=right]{transform:translate3d(var(--snap-point-height,0),0,0)}[data-vaul-overlay][data-vaul-snap-points=false]{animation-duration:.5s;animation-timing-function:cubic-bezier(0.32,0.72,0,1)}[data-vaul-overlay][data-vaul-snap-points=false][data-state=open]{animation-name:fadeIn}[data-vaul-overlay][data-state=closed]{animation-name:fadeOut}[data-vaul-animate=false]{animation:none!important}[data-vaul-overlay][data-vaul-snap-points=true]{opacity:0;transition:opacity .5s cubic-bezier(.32, .72, 0, 1)}[data-vaul-overlay][data-vaul-snap-points=true]{opacity:1}[data-vaul-drawer]:not([data-vaul-custom-container=true])::after{content:'';position:absolute;background:inherit;background-color:inherit}[data-vaul-drawer][data-vaul-drawer-direction=top]::after{top:initial;bottom:100%;left:0;right:0;height:200%}[data-vaul-drawer][data-vaul-drawer-direction=bottom]::after{top:100%;bottom:initial;left:0;right:0;height:200%}[data-vaul-drawer][data-vaul-drawer-direction=left]::after{left:initial;right:100%;top:0;bottom:0;width:200%}[data-vaul-drawer][data-vaul-drawer-direction=right]::after{left:100%;right:initial;top:0;bottom:0;width:200%}[data-vaul-overlay][data-vaul-snap-points=true]:not([data-vaul-snap-points-overlay=true]):not(\n[data-state=closed]\n){opacity:0}[data-vaul-overlay][data-vaul-snap-points-overlay=true]{opacity:1}[data-vaul-handle]{display:block;position:relative;opacity:.7;background:#e2e2e4;margin-left:auto;margin-right:auto;height:5px;width:32px;border-radius:1rem;touch-action:pan-y}[data-vaul-handle]:active,[data-vaul-handle]:hover{opacity:1}[data-vaul-handle-hitarea]{position:absolute;left:50%;top:50%;transform:translate(-50%,-50%);width:max(100%,2.75rem);height:max(100%,2.75rem);touch-action:inherit}@media (hover:hover) and (pointer:fine){[data-vaul-drawer]{user-select:none}}@media (pointer:fine){[data-vaul-handle-hitarea]:{width:100%;height:100%}}@keyframes fadeIn{from{opacity:0}to{opacity:1}}@keyframes fadeOut{to{opacity:0}}@keyframes slideFromBottom{from{transform:translate3d(0,var(--initial-transform,100%),0)}to{transform:translate3d(0,0,0)}}@keyframes slideToBottom{to{transform:translate3d(0,var(--initial-transform,100%),0)}}@keyframes slideFromTop{from{transform:translate3d(0,calc(var(--initial-transform,100%) * -1),0)}to{transform:translate3d(0,0,0)}}@keyframes slideToTop{to{transform:translate3d(0,calc(var(--initial-transform,100%) * -1),0)}}@keyframes slideFromLeft{from{transform:translate3d(calc(var(--initial-transform,100%) * -1),0,0)}to{transform:translate3d(0,0,0)}}@keyframes slideToLeft{to{transform:translate3d(calc(var(--initial-transform,100%) * -1),0,0)}}@keyframes slideFromRight{from{transform:translate3d(var(--initial-transform,100%),0,0)}to{transform:translate3d(0,0,0)}}@keyframes slideToRight{to{transform:translate3d(var(--initial-transform,100%),0,0)}}");const tCe=24,nCe=typeof window<"u"?_.useLayoutEffect:_.useEffect;function Y7(...e){return(...t)=>{for(let n of e)"function"==typeof n&&n(...t)}}const bR=typeof document<"u"&&window.visualViewport;function J7(e){let t=window.getComputedStyle(e);return/(auto|scroll)/.test(t.overflow+t.overflowX+t.overflowY)}function nY(e){for(J7(e)&&(e=e.parentElement);e&&!J7(e);)e=e.parentElement;return e||document.scrollingElement||document.documentElement}const rCe=new Set(["checkbox","radio","range","color","file","image","button","submit","reset"]);let SR,Q1=0;function iCe(e={}){let{isDisabled:t}=e;nCe((()=>{if(!t)return Q1++,1===Q1&&tY()&&(SR=sCe()),()=>{Q1--,0===Q1&&(null==SR||SR())}}),[t])}function sCe(){let e,t=0,n=window.pageXOffset,r=window.pageYOffset,i=Y7(oCe(document.documentElement,"paddingRight",window.innerWidth-document.documentElement.clientWidth+"px"));window.scrollTo(0,0);let o=Y7(cg(document,"touchstart",(n=>{e=nY(n.target),(e!==document.documentElement||e!==document.body)&&(t=n.changedTouches[0].pageY)}),{passive:!1,capture:!0}),cg(document,"touchmove",(n=>{if(!e||e===document.documentElement||e===document.body)return void n.preventDefault();let r=n.changedTouches[0].pageY,i=e.scrollTop,o=e.scrollHeight-e.clientHeight;0!==o&&((i<=0&&r>t||i>=o&&r<t)&&n.preventDefault(),t=r)}),{passive:!1,capture:!0}),cg(document,"touchend",(e=>{let t=e.target;lx(t)&&t!==document.activeElement&&(e.preventDefault(),t.style.transform="translateY(-2000px)",t.focus(),requestAnimationFrame((()=>{t.style.transform=""})))}),{passive:!1,capture:!0}),cg(document,"focus",(e=>{let t=e.target;lx(t)&&(t.style.transform="translateY(-2000px)",requestAnimationFrame((()=>{t.style.transform="",bR&&(bR.height<window.innerHeight?requestAnimationFrame((()=>{X7(t)})):bR.addEventListener("resize",(()=>X7(t)),{once:!0}))})))}),!0),cg(window,"scroll",(()=>{window.scrollTo(0,0)})));return()=>{i(),o(),window.scrollTo(n,r)}}function oCe(e,t,n){let r=e.style[t];return e.style[t]=n,()=>{e.style[t]=r}}function cg(e,t,n,r){return e.addEventListener(t,n,r),()=>{e.removeEventListener(t,n,r)}}function X7(e){let t=document.scrollingElement||document.documentElement;for(;e&&e!==t;){let t=nY(e);if(t!==document.documentElement&&t!==document.body&&t!==e){let n=t.getBoundingClientRect().top,r=e.getBoundingClientRect().top;e.getBoundingClientRect().bottom>t.getBoundingClientRect().bottom+24&&(t.scrollTop+=r-n)}e=t.parentElement}}function lx(e){return e instanceof HTMLInputElement&&!rCe.has(e.type)||e instanceof HTMLTextAreaElement||e instanceof HTMLElement&&e.isContentEditable}function aCe(e,t){"function"==typeof e?e(t):null!=e&&(e.current=t)}function lCe(...e){return t=>e.forEach((e=>aCe(e,t)))}function rY(...e){return _.useCallback(lCe(...e),e)}const iY=new WeakMap;function pr(e,t,n=!1){if(!(e&&e instanceof HTMLElement))return;let r={};Object.entries(t).forEach((([t,n])=>{t.startsWith("--")?e.style.setProperty(t,n):(r[t]=e.style[t],e.style[t]=n)})),!n&&iY.set(e,r)}function cCe(e,t){if(!(e&&e instanceof HTMLElement))return;let n=iY.get(e);n&&(e.style[t]=n[t])}const sr=e=>{switch(e){case"top":case"bottom":return!0;case"left":case"right":return!1;default:return e}};function e_(e,t){if(!e)return null;const n=window.getComputedStyle(e),r=n.transform||n.webkitTransform||n.mozTransform;let i=r.match(/^matrix3d\((.+)\)$/);return i?parseFloat(i[1].split(", ")[sr(t)?13:12]):(i=r.match(/^matrix\((.+)\)$/),i?parseFloat(i[1].split(", ")[sr(t)?5:4]):null)}function uCe(e){return 8*(Math.log(e+1)-2)}function ER(e,t){if(!e)return()=>{};const n=e.style.cssText;return Object.assign(e.style,t),()=>{e.style.cssText=n}}function dCe(...e){return(...t)=>{for(const n of e)"function"==typeof n&&n(...t)}}const Mn={DURATION:.5,EASE:[.32,.72,0,1]},sY=.4,fCe=.25,hCe=100,oY=8,t_=16,cx=26,wR="vaul-dragging";function aY(e){const t=we.useRef(e);return we.useEffect((()=>{t.current=e})),we.useMemo((()=>(...e)=>null==t.current?void 0:t.current.call(t,...e)),[])}function pCe({defaultProp:e,onChange:t}){const n=we.useState(e),[r]=n,i=we.useRef(r),o=aY(t);return we.useEffect((()=>{i.current!==r&&(o(r),i.current=r)}),[r,i,o]),n}function lY({prop:e,defaultProp:t,onChange:n=()=>{}}){const[r,i]=pCe({defaultProp:t,onChange:n}),o=void 0!==e,s=o?e:r,a=aY(n);return[s,we.useCallback((t=>{if(o){const n="function"==typeof t?t(e):t;n!==e&&a(n)}else i(t)}),[o,e,i,a])]}function mCe({activeSnapPointProp:e,setActiveSnapPointProp:t,snapPoints:n,drawerRef:r,overlayRef:i,fadeFromIndex:o,onSnapPointChange:s,direction:a="bottom",container:l,snapToSequentialPoint:c}){const[u,d]=lY({prop:e,defaultProp:null==n?void 0:n[0],onChange:t}),[h,p]=we.useState(typeof window<"u"?{innerWidth:window.innerWidth,innerHeight:window.innerHeight}:void 0);we.useEffect((()=>{function e(){p({innerWidth:window.innerWidth,innerHeight:window.innerHeight})}return window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)}),[]);const f=we.useMemo((()=>u===(null==n?void 0:n[n.length-1])||null),[n,u]),m=we.useMemo((()=>{var e;return null!=(e=null==n?void 0:n.findIndex((e=>e===u)))?e:null}),[n,u]),v=n&&n.length>0&&(o||0===o)&&!Number.isNaN(o)&&n[o]===u||!n,g=we.useMemo((()=>{const e=l?{width:l.getBoundingClientRect().width,height:l.getBoundingClientRect().height}:typeof window<"u"?{width:window.innerWidth,height:window.innerHeight}:{width:0,height:0};var t;return null!=(t=null==n?void 0:n.map((t=>{const n="string"==typeof t;let r=0;if(n&&(r=parseInt(t,10)),sr(a)){const i=n?r:h?t*e.height:0;return h?"bottom"===a?e.height-i:-e.height+i:i}const i=n?r:h?t*e.width:0;return h?"right"===a?e.width-i:-e.width+i:i})))?t:[]}),[n,h,l]),y=we.useMemo((()=>null!==m?null==g?void 0:g[m]:null),[g,m]),b=we.useCallback((e=>{var t;const l=null!=(t=null==g?void 0:g.findIndex((t=>t===e)))?t:null;s(l),pr(r.current,{transition:`transform ${Mn.DURATION}s cubic-bezier(${Mn.EASE.join(",")})`,transform:sr(a)?`translate3d(0, ${e}px, 0)`:`translate3d(${e}px, 0, 0)`}),g&&l!==g.length-1&&void 0!==o&&l!==o&&l<o?pr(i.current,{transition:`opacity ${Mn.DURATION}s cubic-bezier(${Mn.EASE.join(",")})`,opacity:"0"}):pr(i.current,{transition:`opacity ${Mn.DURATION}s cubic-bezier(${Mn.EASE.join(",")})`,opacity:"1"}),d(null==n?void 0:n[Math.max(l,0)])}),[r.current,n,g,o,i,d]);return we.useEffect((()=>{if(u||e){var t;const r=null!=(t=null==n?void 0:n.findIndex((t=>t===e||t===u)))?t:-1;g&&-1!==r&&"number"==typeof g[r]&&b(g[r])}}),[u,e,n,g,b]),{isLastSnapPoint:f,activeSnapPoint:u,shouldFade:v,getPercentageDragged:function(e,t){if(!n||"number"!=typeof m||!g||void 0===o)return null;const r=m===o-1;if(m>=o&&t)return 0;if(r&&!t)return 1;if(!v&&!r)return null;const i=r?m+1:m-1,s=r?g[i]-g[i-1]:g[i+1]-g[i],a=e/Math.abs(s);return r?1-a:a},setActiveSnapPoint:d,activeSnapPointIndex:m,onRelease:function({draggedDistance:e,closeDrawer:t,velocity:r,dismissible:s}){if(void 0===o)return;const l="bottom"===a||"right"===a?(y??0)-e:(y??0)+e,u=0===m,d=e>0;if(m===o-1&&pr(i.current,{transition:`opacity ${Mn.DURATION}s cubic-bezier(${Mn.EASE.join(",")})`}),!c&&r>2&&!d)return void(s?t():b(g[0]));if(!c&&r>2&&d&&g&&n)return void b(g[n.length-1]);const h=null==g?void 0:g.reduce(((e,t)=>"number"!=typeof e||"number"!=typeof t?e:Math.abs(t-l)<Math.abs(e-l)?t:e)),p=sr(a)?window.innerHeight:window.innerWidth;if(r>sY&&Math.abs(e)<.4*p){const e=d?1:-1;if(e>0&&f&&n)return void b(g[n.length-1]);if(u&&e<0&&s&&t(),null===m)return;b(g[m+e])}else b(h)},onDrag:function({draggedDistance:e}){if(null===y)return;const t="bottom"===a||"right"===a?y-e:y+e;("bottom"===a||"right"===a)&&t<g[g.length-1]||("top"===a||"left"===a)&&t>g[g.length-1]||pr(r.current,{transform:sr(a)?`translate3d(0, ${t}px, 0)`:`translate3d(${t}px, 0, 0)`})},snapPointsOffset:g}}const gCe=()=>()=>{};function vCe(){const{direction:e,isOpen:t,shouldScaleBackground:n,setBackgroundColorOnScale:r,noBodyStyles:i}=Hy(),o=we.useRef(null),s=_.useMemo((()=>document.body.style.backgroundColor),[]);function a(){return(window.innerWidth-26)/window.innerWidth}we.useEffect((()=>{if(t&&n){o.current&&clearTimeout(o.current);const t=document.querySelector("[data-vaul-drawer-wrapper]")||document.querySelector("[vaul-drawer-wrapper]");if(!t)return;dCe(r&&!i?ER(document.body,{background:"black"}):gCe,ER(t,{transformOrigin:sr(e)?"top":"left",transitionProperty:"transform, border-radius",transitionDuration:`${Mn.DURATION}s`,transitionTimingFunction:`cubic-bezier(${Mn.EASE.join(",")})`}));const n=ER(t,{borderRadius:"8px",overflow:"hidden",...sr(e)?{transform:`scale(${a()}) translate3d(0, calc(env(safe-area-inset-top) + 14px), 0)`}:{transform:`scale(${a()}) translate3d(calc(env(safe-area-inset-top) + 14px), 0, 0)`}});return()=>{n(),o.current=window.setTimeout((()=>{s?document.body.style.background=s:document.body.style.removeProperty("background")}),1e3*Mn.DURATION)}}}),[t,n,s])}let ug=null;function yCe({isOpen:e,modal:t,nested:n,hasBeenOpened:r,preventScrollRestoration:i,noBodyStyles:o}){const[s,a]=we.useState((()=>typeof window<"u"?window.location.href:"")),l=we.useRef(0),c=we.useCallback((()=>{if(z7()&&null===ug&&e&&!o){ug={position:document.body.style.position,top:document.body.style.top,left:document.body.style.left,height:document.body.style.height,right:"unset"};const{scrollX:e,innerHeight:t}=window;document.body.style.setProperty("position","fixed","important"),Object.assign(document.body.style,{top:-l.current+"px",left:-e+"px",right:"0px",height:"auto"}),window.setTimeout((()=>window.requestAnimationFrame((()=>{const e=t-window.innerHeight;e&&l.current>=t&&(document.body.style.top=-(l.current+e)+"px")}))),300)}}),[e]),u=we.useCallback((()=>{if(z7()&&null!==ug&&!o){const e=-parseInt(document.body.style.top,10),t=-parseInt(document.body.style.left,10);Object.assign(document.body.style,ug),window.requestAnimationFrame((()=>{i&&s!==window.location.href?a(window.location.href):window.scrollTo(t,e)})),ug=null}}),[s]);return we.useEffect((()=>{function e(){l.current=window.scrollY}return e(),window.addEventListener("scroll",e),()=>{window.removeEventListener("scroll",e)}}),[]),we.useEffect((()=>{if(t)return()=>{typeof document>"u"||document.querySelector("[data-vaul-drawer]")||u()}}),[t,u]),we.useEffect((()=>{n||!r||(e?(!window.matchMedia("(display-mode: standalone)").matches&&c(),t||window.setTimeout((()=>{u()}),500)):u())}),[e,r,s,t,n,c,u]),{restorePositionSetting:u}}function _Ce({open:e,onOpenChange:t,children:n,onDrag:r,onRelease:i,snapPoints:o,shouldScaleBackground:s=!1,setBackgroundColorOnScale:a=!0,closeThreshold:l=fCe,scrollLockTimeout:c=100,dismissible:u=!0,handleOnly:d=!1,fadeFromIndex:h=o&&o.length-1,activeSnapPoint:p,setActiveSnapPoint:f,fixed:m,modal:v=!0,onClose:g,nested:y,noBodyStyles:b=!1,direction:_="bottom",defaultOpen:w=!1,disablePreventScroll:E=!0,snapToSequentialPoint:S=!1,preventScrollRestoration:C=!1,repositionInputs:k=!0,onAnimationEnd:T,container:I,autoFocus:R=!1}){var x,L;const[P=!1,O]=lY({defaultProp:w,prop:e,onChange:e=>{null==t||t(e),!e&&!y&&ce(),setTimeout((()=>{null==T||T(e)}),1e3*Mn.DURATION),e&&!v&&typeof window<"u"&&window.requestAnimationFrame((()=>{document.body.style.pointerEvents="auto"})),e||(document.body.style.pointerEvents="auto")}}),[A,M]=we.useState(!1),[N,D]=we.useState(!1),[j,U]=we.useState(!1),F=we.useRef(null),H=we.useRef(null),B=we.useRef(null),$=we.useRef(null),V=we.useRef(null),q=we.useRef(!1),K=we.useRef(null),G=we.useRef(0),W=we.useRef(!1),z=we.useRef(!w),J=we.useRef(0),Y=we.useRef(null),Q=we.useRef((null==(x=Y.current)?void 0:x.getBoundingClientRect().height)||0),Z=we.useRef((null==(L=Y.current)?void 0:L.getBoundingClientRect().width)||0),X=we.useRef(0),ee=we.useCallback((e=>{o&&e===oe.length-1&&(H.current=new Date)}),[]),{activeSnapPoint:te,activeSnapPointIndex:ne,setActiveSnapPoint:re,onRelease:ie,snapPointsOffset:oe,onDrag:se,shouldFade:ae,getPercentageDragged:le}=mCe({snapPoints:o,activeSnapPointProp:p,setActiveSnapPointProp:f,drawerRef:Y,fadeFromIndex:h,overlayRef:F,onSnapPointChange:ee,direction:_,container:I,snapToSequentialPoint:S});iCe({isDisabled:!P||N||!v||j||!A||!k||!E});const{restorePositionSetting:ce}=yCe({isOpen:P,modal:v,nested:y??!1,hasBeenOpened:A,preventScrollRestoration:C,noBodyStyles:b});function ue(){return(window.innerWidth-26)/window.innerWidth}function de(e,t){var n;let r=e;const i=null==(n=window.getSelection())?void 0:n.toString(),o=Y.current?e_(Y.current,_):null,s=new Date;if("SELECT"===r.tagName||r.hasAttribute("data-vaul-no-drag")||r.closest("[data-vaul-no-drag]"))return!1;if("right"===_||"left"===_)return!0;if(H.current&&s.getTime()-H.current.getTime()<500)return!1;if(null!==o&&("bottom"===_?o>0:o<0))return!0;if(i&&i.length>0)return!1;if(V.current&&s.getTime()-V.current.getTime()<c&&0===o||t)return V.current=s,!1;for(;r;){if(r.scrollHeight>r.clientHeight){if(0!==r.scrollTop)return V.current=new Date,!1;if("dialog"===r.getAttribute("role"))return!0}r=r.parentNode}return!0}function he(e){!N||!Y.current||(Y.current.classList.remove(wR),q.current=!1,D(!1),$.current=new Date),null==g||g(),e||O(!1),setTimeout((()=>{o&&re(o[0])}),1e3*Mn.DURATION)}function pe(){if(!Y.current)return;const e=document.querySelector("[data-vaul-drawer-wrapper]"),t=e_(Y.current,_);pr(Y.current,{transform:"translate3d(0, 0, 0)",transition:`transform ${Mn.DURATION}s cubic-bezier(${Mn.EASE.join(",")})`}),pr(F.current,{transition:`opacity ${Mn.DURATION}s cubic-bezier(${Mn.EASE.join(",")})`,opacity:"1"}),s&&t&&t>0&&P&&pr(e,{borderRadius:"8px",overflow:"hidden",...sr(_)?{transform:`scale(${ue()}) translate3d(0, calc(env(safe-area-inset-top) + 14px), 0)`,transformOrigin:"top"}:{transform:`scale(${ue()}) translate3d(calc(env(safe-area-inset-top) + 14px), 0, 0)`,transformOrigin:"left"},transitionProperty:"transform, border-radius",transitionDuration:`${Mn.DURATION}s`,transitionTimingFunction:`cubic-bezier(${Mn.EASE.join(",")})`},!0)}return we.useEffect((()=>{window.requestAnimationFrame((()=>{z.current=!0}))}),[]),we.useEffect((()=>{var e;function t(){if(!Y.current||!k)return;if(lx(document.activeElement)||W.current){var e;const t=(null==(e=window.visualViewport)?void 0:e.height)||0,n=window.innerHeight;let r=n-t;const i=Y.current.getBoundingClientRect().height||0,s=i>.8*n;X.current||(X.current=i);const a=Y.current.getBoundingClientRect().top;if(Math.abs(J.current-r)>60&&(W.current=!W.current),o&&o.length>0&&oe&&ne){r+=oe[ne]||0}if(J.current=r,i>t||W.current){const e=Y.current.getBoundingClientRect().height;let n=e;e>t&&(n=t-(s?a:26)),Y.current.style.height=m?e-Math.max(r,0)+"px":`${Math.max(n,t-a)}px`}else Xwe()||(Y.current.style.height=`${X.current}px`);o&&o.length>0&&!W.current?Y.current.style.bottom="0px":Y.current.style.bottom=`${Math.max(r,0)}px`}}return null==(e=window.visualViewport)||e.addEventListener("resize",t),()=>{var e;return null==(e=window.visualViewport)?void 0:e.removeEventListener("resize",t)}}),[ne,o,oe]),we.useEffect((()=>(P&&(pr(document.documentElement,{scrollBehavior:"auto"}),H.current=new Date),()=>{cCe(document.documentElement,"scrollBehavior")})),[P]),we.useEffect((()=>{v||window.requestAnimationFrame((()=>{document.body.style.pointerEvents="auto"}))}),[v]),we.createElement(C6,{defaultOpen:w,onOpenChange:e=>{!u&&!e||(e?M(!0):he(!0),O(e))},open:P},we.createElement(eY.Provider,{value:{activeSnapPoint:te,snapPoints:o,setActiveSnapPoint:re,drawerRef:Y,overlayRef:F,onOpenChange:t,onPress:function(e){var t,n;!u&&!o||Y.current&&!Y.current.contains(e.target)||(Q.current=(null==(t=Y.current)?void 0:t.getBoundingClientRect().height)||0,Z.current=(null==(n=Y.current)?void 0:n.getBoundingClientRect().width)||0,D(!0),B.current=new Date,tY()&&window.addEventListener("touchend",(()=>q.current=!1),{once:!0}),e.target.setPointerCapture(e.pointerId),G.current=sr(_)?e.pageY:e.pageX)},onRelease:function(e){if(!N||!Y.current)return;Y.current.classList.remove(wR),q.current=!1,D(!1),$.current=new Date;const t=e_(Y.current,_);if(!e||!de(e.target,!1)||!t||Number.isNaN(t)||null===B.current)return;const n=$.current.getTime()-B.current.getTime(),r=G.current-(sr(_)?e.pageY:e.pageX),s=Math.abs(r)/n;if(s>.05&&(U(!0),setTimeout((()=>{U(!1)}),200)),o)return ie({draggedDistance:r*("bottom"===_||"right"===_?1:-1),closeDrawer:he,velocity:s,dismissible:u}),void(null==i||i(e,!0));if("bottom"===_||"right"===_?r>0:r<0)return pe(),void(null==i||i(e,!0));if(s>sY)return he(),void(null==i||i(e,!1));var a;const c=Math.min(null!=(a=Y.current.getBoundingClientRect().height)?a:0,window.innerHeight);var d;const h=Math.min(null!=(d=Y.current.getBoundingClientRect().width)?d:0,window.innerWidth),p="left"===_||"right"===_;if(Math.abs(t)>=(p?h:c)*l)return he(),void(null==i||i(e,!1));null==i||i(e,!0),pe()},onDrag:function(e){if(Y.current&&N){const t="bottom"===_||"right"===_?1:-1,n=(G.current-(sr(_)?e.pageY:e.pageX))*t,i=n>0,a=o&&!u&&!i;if(a&&0===ne)return;const l=Math.abs(n),c=document.querySelector("[data-vaul-drawer-wrapper]");let d=l/("bottom"===_||"top"===_?Q.current:Z.current);const p=le(l,i);if(null!==p&&(d=p),a&&d>=1||!q.current&&!de(e.target,i))return;if(Y.current.classList.add(wR),q.current=!0,pr(Y.current,{transition:"none"}),pr(F.current,{transition:"none"}),o&&se({draggedDistance:n}),i&&!o){const e=uCe(n),r=Math.min(-1*e,0)*t;return void pr(Y.current,{transform:sr(_)?`translate3d(0, ${r}px, 0)`:`translate3d(${r}px, 0, 0)`})}const f=1-d;if((ae||h&&ne===h-1)&&(null==r||r(e,d),pr(F.current,{opacity:`${f}`,transition:"none"},!0)),c&&F.current&&s){const e=Math.min(ue()+d*(1-ue()),1),t=8-8*d,n=Math.max(0,14-14*d);pr(c,{borderRadius:`${t}px`,transform:sr(_)?`scale(${e}) translate3d(0, ${n}px, 0)`:`scale(${e}) translate3d(${n}px, 0, 0)`,transition:"none"},!0)}if(!o){const e=l*t;pr(Y.current,{transform:sr(_)?`translate3d(0, ${e}px, 0)`:`translate3d(${e}px, 0, 0)`})}}},dismissible:u,shouldAnimate:z,handleOnly:d,isOpen:P,isDragging:N,shouldFade:ae,closeDrawer:he,onNestedDrag:function(e,t){if(t<0)return;const n=(window.innerWidth-16)/window.innerWidth,r=n+t*(1-n),i=16*t-16;pr(Y.current,{transform:sr(_)?`scale(${r}) translate3d(0, ${i}px, 0)`:`scale(${r}) translate3d(${i}px, 0, 0)`,transition:"none"})},onNestedOpenChange:function(e){const t=e?(window.innerWidth-16)/window.innerWidth:1,n=e?-16:0;K.current&&window.clearTimeout(K.current),pr(Y.current,{transition:`transform ${Mn.DURATION}s cubic-bezier(${Mn.EASE.join(",")})`,transform:sr(_)?`scale(${t}) translate3d(0, ${n}px, 0)`:`scale(${t}) translate3d(${n}px, 0, 0)`}),!e&&Y.current&&(K.current=setTimeout((()=>{const e=e_(Y.current,_);pr(Y.current,{transition:"none",transform:sr(_)?`translate3d(0, ${e}px, 0)`:`translate3d(${e}px, 0, 0)`})}),500))},onNestedRelease:function(e,t){const n=sr(_)?window.innerHeight:window.innerWidth,r=t?(n-16)/n:1,i=t?-16:0;t&&pr(Y.current,{transition:`transform ${Mn.DURATION}s cubic-bezier(${Mn.EASE.join(",")})`,transform:sr(_)?`scale(${r}) translate3d(0, ${i}px, 0)`:`scale(${r}) translate3d(${i}px, 0, 0)`})},keyboardIsOpen:W,modal:v,snapPointsOffset:oe,activeSnapPointIndex:ne,direction:_,shouldScaleBackground:s,setBackgroundColorOnScale:a,noBodyStyles:b,container:I,autoFocus:R}},n))}const cY=we.forwardRef((function({...e},t){const{overlayRef:n,snapPoints:r,onRelease:i,shouldFade:o,isOpen:s,modal:a,shouldAnimate:l}=Hy(),c=rY(t,n),u=r&&r.length>0;if(!a)return null;const d=we.useCallback((e=>i(e)),[i]);return we.createElement(R6,{onMouseUp:d,ref:c,"data-vaul-overlay":"","data-vaul-snap-points":s&&u?"true":"false","data-vaul-snap-points-overlay":s&&o?"true":"false","data-vaul-animate":null!=l&&l.current?"true":"false",...e})}));cY.displayName="Drawer.Overlay";const uY=we.forwardRef((function({onPointerDownOutside:e,style:t,onOpenAutoFocus:n,...r},i){const{drawerRef:o,onPress:s,onRelease:a,onDrag:l,keyboardIsOpen:c,snapPointsOffset:u,activeSnapPointIndex:d,modal:h,isOpen:p,direction:f,snapPoints:m,container:v,handleOnly:g,shouldAnimate:y,autoFocus:b}=Hy(),[_,w]=we.useState(!1),E=rY(i,o),S=we.useRef(null),C=we.useRef(null),k=we.useRef(!1),T=m&&m.length>0;vCe();function I(e){S.current=null,k.current=!1,a(e)}return we.useEffect((()=>{T&&window.requestAnimationFrame((()=>{w(!0)}))}),[]),we.createElement(I6,{"data-vaul-drawer-direction":f,"data-vaul-drawer":"","data-vaul-delayed-snap-points":_?"true":"false","data-vaul-snap-points":p&&T?"true":"false","data-vaul-custom-container":v?"true":"false","data-vaul-animate":null!=y&&y.current?"true":"false",...r,ref:E,style:u&&u.length>0?{"--snap-point-height":`${u[d??0]}px`,...t}:t,onPointerDown:e=>{g||(null==r.onPointerDown||r.onPointerDown.call(r,e),S.current={x:e.pageX,y:e.pageY},s(e))},onOpenAutoFocus:e=>{null==n||n(e),b||e.preventDefault()},onPointerDownOutside:t=>{null==e||e(t),h&&!t.defaultPrevented?c.current&&(c.current=!1):t.preventDefault()},onFocusOutside:e=>{h||e.preventDefault()},onPointerMove:e=>{if(C.current=e,g||(null==r.onPointerMove||r.onPointerMove.call(r,e),!S.current))return;const t=e.pageY-S.current.y,n=e.pageX-S.current.x,i="touch"===e.pointerType?10:2;((e,t,n=0)=>{if(k.current)return!0;const r=Math.abs(e.y),i=Math.abs(e.x),o=i>r,s=["bottom","right"].includes(t)?1:-1;if("left"===t||"right"===t){if(!(e.x*s<0)&&i>=0&&i<=n)return o}else if(!(e.y*s<0)&&r>=0&&r<=n)return!o;return k.current=!0,!0})({x:n,y:t},f,i)?l(e):(Math.abs(n)>i||Math.abs(t)>i)&&(S.current=null)},onPointerUp:e=>{null==r.onPointerUp||r.onPointerUp.call(r,e),S.current=null,k.current=!1,a(e)},onPointerOut:e=>{null==r.onPointerOut||r.onPointerOut.call(r,e),I(C.current)},onContextMenu:e=>{null==r.onContextMenu||r.onContextMenu.call(r,e),C.current&&I(C.current)}})}));uY.displayName="Drawer.Content";const bCe=250,SCe=120,ECe=we.forwardRef((function({preventCycle:e=!1,children:t,...n},r){const{closeDrawer:i,isDragging:o,snapPoints:s,activeSnapPoint:a,setActiveSnapPoint:l,dismissible:c,handleOnly:u,isOpen:d,onPress:h,onDrag:p}=Hy(),f=we.useRef(null),m=we.useRef(!1);function v(){f.current&&window.clearTimeout(f.current),m.current=!1}return we.createElement("div",{onClick:function(){m.current?v():window.setTimeout((()=>{!function(){if(o||e||m.current)return void v();if(v(),!s||0===s.length)return void(c||i());if(a===s[s.length-1]&&c)return void i();const t=s.findIndex((e=>e===a));if(-1===t)return;const n=s[t+1];l(n)}()}),120)},onPointerCancel:v,onPointerDown:e=>{u&&h(e),f.current=window.setTimeout((()=>{m.current=!0}),250)},onPointerMove:e=>{u&&p(e)},ref:r,"data-vaul-drawer-visible":d?"true":"false","data-vaul-handle":"","aria-hidden":"true",...n},we.createElement("span",{"data-vaul-handle-hitarea":"","aria-hidden":"true"},t))}));function wCe(e){const t=Hy(),{container:n=t.container,...r}=e;return we.createElement(T6,{container:n,...r})}ECe.displayName="Drawer.Handle";const Ki={Root:_Ce,Content:uY,Overlay:cY,Trigger:Ywe,Portal:wCe,Title:k6},CCe="_bg_gd68h_17",TCe="_drawer_gd68h_26",RCe="_body_gd68h_60",AS={bg:CCe,drawer:TCe,body:RCe},P6=_.createContext(null);function L6(){var e;const t=null==(e=globalThis.navigator)?void 0:e.userAgent;return/android/i.test(t)?"android":/iPad|iPhone|iPod|Mac/.test(t)&&"ontouchend"in document?"ios":"other"}const O6=_.forwardRef((({title:e,children:t,className:n,...r},i)=>E.jsx("div",{ref:i,className:Ae(n,AS.drawer),"aria-label":e,"data-platform":L6(),...r,role:"menu",children:E.jsx("div",{className:AS.body,children:t})})));O6.displayName="DrawerMenu";const ICe=({onSelect:e,children:t})=>E.jsx(Rz,{onSelect:e??void 0,asChild:!0,children:t}),kCe=({title:e,onOpenChange:t,trigger:n,hasAccessibleAlternative:r,children:i})=>{const[o,s]=_.useState(!1),a=_.useCallback((e=>{s(e),null==t||t(e)}),[s,t]),l=L6(),c="android"===l||"ios"===l,u=_.useMemo((()=>({MenuItemWrapper:c?null:ICe,onOpenChange:a})),[a]),d=E.jsx(P6.Provider,{value:u,children:i}),h=E.jsx(JEe,{"aria-haspopup":"menu",tabIndex:r?void 0:0,asChild:!0,children:n});return c?E.jsxs(E.Fragment,{children:[E.jsx($7,{onOpenChange:a,children:h}),E.jsx(Ki.Root,{open:o,onOpenChange:a,children:E.jsxs(Ki.Portal,{children:[E.jsx(Ki.Overlay,{className:Ae(AS.bg)}),E.jsx(Ki.Content,{asChild:!0,children:E.jsx(O6,{title:e,children:d})})]})})]}):E.jsxs($7,{onOpenChange:a,children:[h,E.jsx(XEe,{children:E.jsx(ZEe,{asChild:!0,children:E.jsx(y6,{title:e,children:d})})})]})},xCe="_glass_1x9g9_17",PCe={glass:xCe},dY=_.forwardRef((({children:e,className:t,...n},r)=>E.jsx("div",{ref:r,className:Ae(t,PCe.glass),...n,children:_.Children.only(e)})));dY.displayName="Glass";const xu=({as:e="h1",children:t,...n})=>E.jsx(zK,{as:e,type:"heading",...n,children:t}),LCe="_link_ue21z_17",OCe={link:LCe},MCe=_.forwardRef((function({children:e,className:t,kind:n="primary",size:r="medium",...i},o){return E.jsx("a",{ref:o,...i,rel:"noreferrer noopener",className:Ae(OCe.link,t),"data-kind":n,"data-size":r,children:e})}));var M6="DropdownMenu",[ACe,dGe]=ja(M6,[yw]),ki=yw(),[NCe,fY]=ACe(M6),hY=e=>{const{__scopeDropdownMenu:t,children:n,dir:r,open:i,defaultOpen:o,onOpenChange:s,modal:a=!0}=e,l=ki(t),c=_.useRef(null),[u=!1,d]=hw({prop:i,defaultProp:o,onChange:s});return E.jsx(NCe,{scope:t,triggerId:Rl(),triggerRef:c,contentId:Rl(),open:u,onOpenChange:d,onOpenToggle:_.useCallback((()=>d((e=>!e))),[d]),modal:a,children:E.jsx(iz,{...l,open:u,onOpenChange:d,dir:r,modal:a,children:n})})};hY.displayName=M6;var pY="DropdownMenuTrigger",mY=_.forwardRef(((e,t)=>{const{__scopeDropdownMenu:n,disabled:r=!1,...i}=e,o=fY(pY,n),s=ki(n);return E.jsx(sz,{asChild:!0,...s,children:E.jsx(er.button,{type:"button",id:o.triggerId,"aria-haspopup":"menu","aria-expanded":o.open,"aria-controls":o.open?o.contentId:void 0,"data-state":o.open?"open":"closed","data-disabled":r?"":void 0,disabled:r,...i,ref:Ua(t,o.triggerRef),onPointerDown:We(e.onPointerDown,(e=>{!r&&0===e.button&&!1===e.ctrlKey&&(o.onOpenToggle(),o.open||e.preventDefault())})),onKeyDown:We(e.onKeyDown,(e=>{r||(["Enter"," "].includes(e.key)&&o.onOpenToggle(),"ArrowDown"===e.key&&o.onOpenChange(!0),["Enter"," ","ArrowDown"].includes(e.key)&&e.preventDefault())}))})})}));mY.displayName=pY;var DCe="DropdownMenuPortal",gY=e=>{const{__scopeDropdownMenu:t,...n}=e,r=ki(t);return E.jsx(oz,{...r,...n})};gY.displayName=DCe;var vY="DropdownMenuContent",yY=_.forwardRef(((e,t)=>{const{__scopeDropdownMenu:n,...r}=e,i=fY(vY,n),o=ki(n),s=_.useRef(!1);return E.jsx(az,{id:i.contentId,"aria-labelledby":i.triggerId,...o,...r,ref:t,onCloseAutoFocus:We(e.onCloseAutoFocus,(e=>{var t;s.current||null==(t=i.triggerRef.current)||t.focus(),s.current=!1,e.preventDefault()})),onInteractOutside:We(e.onInteractOutside,(e=>{const t=e.detail.originalEvent,n=0===t.button&&!0===t.ctrlKey,r=2===t.button||n;(!i.modal||r)&&(s.current=!0)})),style:{...e.style,"--radix-dropdown-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-dropdown-menu-content-available-width":"var(--radix-popper-available-width)","--radix-dropdown-menu-content-available-height":"var(--radix-popper-available-height)","--radix-dropdown-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-dropdown-menu-trigger-height":"var(--radix-popper-anchor-height)"}})}));yY.displayName=vY;var jCe="DropdownMenuGroup",UCe=_.forwardRef(((e,t)=>{const{__scopeDropdownMenu:n,...r}=e,i=ki(n);return E.jsx(lz,{...i,...r,ref:t})}));UCe.displayName=jCe;var FCe="DropdownMenuLabel",$Ce=_.forwardRef(((e,t)=>{const{__scopeDropdownMenu:n,...r}=e,i=ki(n);return E.jsx(cz,{...i,...r,ref:t})}));$Ce.displayName=FCe;var HCe="DropdownMenuItem",_Y=_.forwardRef(((e,t)=>{const{__scopeDropdownMenu:n,...r}=e,i=ki(n);return E.jsx(uz,{...i,...r,ref:t})}));_Y.displayName=HCe;var BCe="DropdownMenuCheckboxItem",VCe=_.forwardRef(((e,t)=>{const{__scopeDropdownMenu:n,...r}=e,i=ki(n);return E.jsx(dz,{...i,...r,ref:t})}));VCe.displayName=BCe;var qCe="DropdownMenuRadioGroup",KCe=_.forwardRef(((e,t)=>{const{__scopeDropdownMenu:n,...r}=e,i=ki(n);return E.jsx(fz,{...i,...r,ref:t})}));KCe.displayName=qCe;var GCe="DropdownMenuRadioItem",WCe=_.forwardRef(((e,t)=>{const{__scopeDropdownMenu:n,...r}=e,i=ki(n);return E.jsx(hz,{...i,...r,ref:t})}));WCe.displayName=GCe;var zCe="DropdownMenuItemIndicator",YCe=_.forwardRef(((e,t)=>{const{__scopeDropdownMenu:n,...r}=e,i=ki(n);return E.jsx(pz,{...i,...r,ref:t})}));YCe.displayName=zCe;var JCe="DropdownMenuSeparator",XCe=_.forwardRef(((e,t)=>{const{__scopeDropdownMenu:n,...r}=e,i=ki(n);return E.jsx(mz,{...i,...r,ref:t})}));XCe.displayName=JCe;var ZCe="DropdownMenuArrow",QCe=_.forwardRef(((e,t)=>{const{__scopeDropdownMenu:n,...r}=e,i=ki(n);return E.jsx(gz,{...i,...r,ref:t})}));QCe.displayName=ZCe;var eTe="DropdownMenuSubTrigger",tTe=_.forwardRef(((e,t)=>{const{__scopeDropdownMenu:n,...r}=e,i=ki(n);return E.jsx(vz,{...i,...r,ref:t})}));tTe.displayName=eTe;var nTe="DropdownMenuSubContent",rTe=_.forwardRef(((e,t)=>{const{__scopeDropdownMenu:n,...r}=e,i=ki(n);return E.jsx(yz,{...i,...r,ref:t,style:{...e.style,"--radix-dropdown-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-dropdown-menu-content-available-width":"var(--radix-popper-available-width)","--radix-dropdown-menu-content-available-height":"var(--radix-popper-available-height)","--radix-dropdown-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-dropdown-menu-trigger-height":"var(--radix-popper-anchor-height)"}})}));rTe.displayName=nTe;var iTe=hY,sTe=mY,oTe=gY,aTe=yY;const lTe=({onSelect:e,children:t})=>E.jsx(_Y,{onSelect:e??void 0,asChild:!0,children:t}),A6=({title:e,showTitle:t=!0,open:n,onOpenChange:r,trigger:i,children:o,side:s="bottom",align:a="center"})=>{const l=L6(),c="android"===l||"ios"===l,u=_.useMemo((()=>({MenuItemWrapper:c?null:lTe,onOpenChange:r})),[r]),d=E.jsx(P6.Provider,{value:u,children:o});return c?E.jsxs(Ki.Root,{open:n,onOpenChange:r,children:[E.jsx(Ki.Trigger,{asChild:!0,children:i}),E.jsxs(Ki.Portal,{children:[E.jsx(Ki.Overlay,{className:Ae(AS.bg)}),E.jsx(Ki.Content,{asChild:!0,children:E.jsx(O6,{title:e,children:d})})]})]}):E.jsxs(iTe,{open:n,onOpenChange:r,children:[E.jsx(sTe,{asChild:!0,children:i}),E.jsx(oTe,{children:E.jsx(aTe,{asChild:!0,side:s,align:a,sideOffset:8,onCloseAutoFocus:e=>{e.preventDefault()},children:E.jsx(y6,{title:e,showTitle:t,children:d})})})]})},cTe="_item_8j2l6_17",uTe="_interactive_8j2l6_35",dTe="_icon_8j2l6_43",fTe="_label_8j2l6_52",hTe="_disabled_8j2l6_118",Sc={item:cTe,interactive:uTe,"no-label":"_no-label_8j2l6_39",icon:dTe,label:fTe,"nav-hint":"_nav-hint_8j2l6_59",disabled:hTe};function bY(e,t){return E.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:t,...e,children:E.jsx("path",{d:"M8.7 17.3a.948.948 0 0 1-.275-.7.95.95 0 0 1 .275-.7l3.9-3.9-3.9-3.9a.948.948 0 0 1-.275-.7.95.95 0 0 1 .275-.7.948.948 0 0 1 .7-.275.95.95 0 0 1 .7.275l4.6 4.6c.1.1.17.208.213.325.041.117.062.242.062.375s-.02.258-.063.375a.877.877 0 0 1-.212.325l-4.6 4.6a.948.948 0 0 1-.7.275.948.948 0 0 1-.7-.275Z"})})}bY.displayName="ChevronRightIcon";const SY=_.forwardRef(bY),Sp=({as:e,className:t,Icon:n,label:r,labelProps:i,onSelect:o,kind:s="primary",children:a,onClick:l,disabled:c,...u})=>{const d=e??"button",h=_.useContext(P6),p=_.useCallback((e=>{if(null==l||l(e),null!==o&&null==(null==h?void 0:h.MenuItemWrapper)){const e=new CustomEvent("menu.itemSelect",{bubbles:!0,cancelable:!0});o(e),e.defaultPrevented||null==h||h.onOpenChange(!1)}}),[h,o]),f=_.isValidElement(n),m=n,v=n,g=E.jsxs(d,{role:"menuitem",...u,className:Ae(t,Sc.item,{[Sc.interactive]:null!==o,[Sc["no-label"]]:null===r,[Sc.disabled]:c}),"data-kind":s,onClick:p,disabled:"button"===d?c:void 0,"aria-disabled":"button"===d?void 0:c,children:[f?E.jsx(bp,{className:Sc.icon,children:m}):E.jsx(v,{width:24,height:24,className:Sc.icon,"aria-hidden":!0}),null!==r&&E.jsx(Jt,{className:Sc.label,size:"md",weight:"medium",as:"span",...i,children:r}),("button"===d||"a"===d)&&E.jsx(SY,{width:8,height:24,className:Sc["nav-hint"],"aria-hidden":!0,viewBox:"8 0 8 24"}),a]});return null==(null==h?void 0:h.MenuItemWrapper)||null===o?g:E.jsx(h.MenuItemWrapper,{onSelect:o,children:g})};var pTe="Label",EY=_.forwardRef(((e,t)=>E.jsx(er.label,{...e,ref:t,onMouseDown:t=>{var n;t.target.closest("button, input, select, textarea")||(null==(n=e.onMouseDown)||n.call(e,t),!t.defaultPrevented&&t.detail>1&&t.preventDefault())}})));EY.displayName=pTe;var[N6,fGe]=ja("Form"),D6="Form",[mTe,By]=N6(D6),[gTe,wY]=N6(D6),CY=_.forwardRef(((e,t)=>{const{__scopeForm:n,onClearServerErrors:r=()=>{},...i}=e,o=tn(t,_.useRef(null)),[s,a]=_.useState({}),l=_.useCallback((e=>s[e]),[s]),c=_.useCallback(((e,t)=>a((n=>({...n,[e]:{...n[e]??{},...t}})))),[]),u=_.useCallback((e=>{a((t=>({...t,[e]:void 0}))),g((t=>({...t,[e]:{}})))}),[]),[d,h]=_.useState({}),p=_.useCallback((e=>d[e]??[]),[d]),f=_.useCallback(((e,t)=>{h((n=>({...n,[e]:[...n[e]??[],t]})))}),[]),m=_.useCallback(((e,t)=>{h((n=>({...n,[e]:(n[e]??[]).filter((e=>e.id!==t))})))}),[]),[v,g]=_.useState({}),y=_.useCallback((e=>v[e]??{}),[v]),b=_.useCallback(((e,t)=>{g((n=>({...n,[e]:{...n[e]??{},...t}})))}),[]),[w,S]=_.useState({}),C=_.useCallback(((e,t)=>{S((n=>{const r=new Set(n[e]).add(t);return{...n,[e]:r}}))}),[]),k=_.useCallback(((e,t)=>{S((n=>{const r=new Set(n[e]);return r.delete(t),{...n,[e]:r}}))}),[]),T=_.useCallback((e=>Array.from(w[e]??[]).join(" ")||void 0),[w]);return E.jsx(mTe,{scope:n,getFieldValidity:l,onFieldValidityChange:c,getFieldCustomMatcherEntries:p,onFieldCustomMatcherEntryAdd:f,onFieldCustomMatcherEntryRemove:m,getFieldCustomErrors:y,onFieldCustomErrorsChange:b,onFieldValiditionClear:u,children:E.jsx(gTe,{scope:n,onFieldMessageIdAdd:C,onFieldMessageIdRemove:k,getFieldDescription:T,children:E.jsx(er.form,{...i,ref:o,onInvalid:We(e.onInvalid,(e=>{const t=kY(e.currentTarget);t===e.target&&t.focus(),e.preventDefault()})),onSubmit:We(e.onSubmit,r,{checkForDefaultPrevented:!1}),onReset:We(e.onReset,r)})})})}));CY.displayName=D6;var j6="FormField",[vTe,U6]=N6(j6),TY=_.forwardRef(((e,t)=>{const{__scopeForm:n,name:r,serverInvalid:i=!1,...o}=e,s=By(j6,n).getFieldValidity(r),a=Rl();return E.jsx(vTe,{scope:n,id:a,name:r,serverInvalid:i,children:E.jsx(er.div,{"data-valid":$6(s,i),"data-invalid":H6(s,i),...o,ref:t})})}));TY.displayName=j6;var ux="FormLabel",RY=_.forwardRef(((e,t)=>{const{__scopeForm:n,...r}=e,i=By(ux,n),o=U6(ux,n),s=r.htmlFor||o.id,a=i.getFieldValidity(o.name);return E.jsx(EY,{"data-valid":$6(a,o.serverInvalid),"data-invalid":H6(a,o.serverInvalid),...r,ref:t,htmlFor:s})}));RY.displayName=ux;var Sb="FormControl",IY=_.forwardRef(((e,t)=>{const{__scopeForm:n,...r}=e,i=By(Sb,n),o=U6(Sb,n),s=wY(Sb,n),a=_.useRef(null),l=tn(t,a),c=r.name||o.name,u=r.id||o.id,d=i.getFieldCustomMatcherEntries(c),{onFieldValidityChange:h,onFieldCustomErrorsChange:p,onFieldValiditionClear:f}=i,m=_.useCallback((async e=>{if(xY(e.validity)){const t=CR(e.validity);return void h(c,t)}const t=e.form?new FormData(e.form):new FormData,n=[e.value,t],r=[],i=[];d.forEach((e=>{ITe(e,n)?i.push(e):kTe(e)&&r.push(e)}));const o=r.map((({id:e,match:t})=>[e,t(...n)])),s=Object.fromEntries(o),a=Object.values(s).some(Boolean),l=a;e.setCustomValidity(l?Kv:"");const u=CR(e.validity);if(h(c,u),p(c,s),!a&&i.length>0){const t=i.map((({id:e,match:t})=>t(...n).then((t=>[e,t])))),r=await Promise.all(t),o=Object.fromEntries(r),s=Object.values(o).some(Boolean);e.setCustomValidity(s?Kv:"");const a=CR(e.validity);h(c,a),p(c,o)}}),[d,c,p,h]);_.useEffect((()=>{const e=a.current;if(e){const t=()=>m(e);return e.addEventListener("change",t),()=>e.removeEventListener("change",t)}}),[m]);const v=_.useCallback((()=>{const e=a.current;e&&(e.setCustomValidity(""),f(c))}),[c,f]);_.useEffect((()=>{var e;const t=null==(e=a.current)?void 0:e.form;if(t)return t.addEventListener("reset",v),()=>t.removeEventListener("reset",v)}),[v]),_.useEffect((()=>{const e=a.current,t=null==e?void 0:e.closest("form");if(t&&o.serverInvalid){const n=kY(t);n===e&&n.focus()}}),[o.serverInvalid]);const g=i.getFieldValidity(c);return E.jsx(er.input,{"data-valid":$6(g,o.serverInvalid),"data-invalid":H6(g,o.serverInvalid),"aria-invalid":!!o.serverInvalid||void 0,"aria-describedby":s.getFieldDescription(c),title:"",...r,ref:l,id:u,name:c,onInvalid:We(e.onInvalid,(e=>{const t=e.currentTarget;m(t)})),onChange:We(e.onChange,(e=>{v()}))})}));IY.displayName=Sb;var Kv="This value is not valid",yTe={badInput:Kv,patternMismatch:"This value does not match the required pattern",rangeOverflow:"This value is too large",rangeUnderflow:"This value is too small",stepMismatch:"This value does not match the required step",tooLong:"This value is too long",tooShort:"This value is too short",typeMismatch:"This value does not match the required type",valid:void 0,valueMissing:"This value is missing"},Vy="FormMessage",_Te=_.forwardRef(((e,t)=>{const{match:n,name:r,...i}=e,o=U6(Vy,e.__scopeForm),s=r??o.name;return void 0===n?E.jsx(F6,{...i,ref:t,name:s,children:e.children||Kv}):"function"==typeof n?E.jsx(STe,{match:n,...i,ref:t,name:s}):E.jsx(bTe,{match:n,...i,ref:t,name:s})}));_Te.displayName=Vy;var bTe=_.forwardRef(((e,t)=>{const{match:n,forceMatch:r=!1,name:i,children:o,...s}=e,a=By(Vy,s.__scopeForm).getFieldValidity(i);return r||(null==a?void 0:a[n])?E.jsx(F6,{ref:t,...s,name:i,children:o??yTe[n]}):null})),STe=_.forwardRef(((e,t)=>{const{match:n,forceMatch:r=!1,name:i,id:o,children:s,...a}=e,l=By(Vy,a.__scopeForm),c=tn(t,_.useRef(null)),u=Rl(),d=o??u,h=_.useMemo((()=>({id:d,match:n})),[d,n]),{onFieldCustomMatcherEntryAdd:p,onFieldCustomMatcherEntryRemove:f}=l;_.useEffect((()=>(p(i,h),()=>f(i,h.id))),[h,i,p,f]);const m=l.getFieldValidity(i),v=l.getFieldCustomErrors(i)[d];return r||m&&!xY(m)&&v?E.jsx(F6,{id:d,ref:c,...a,name:i,children:s??Kv}):null})),F6=_.forwardRef(((e,t)=>{const{__scopeForm:n,id:r,name:i,...o}=e,s=wY(Vy,n),a=Rl(),l=r??a,{onFieldMessageIdAdd:c,onFieldMessageIdRemove:u}=s;return _.useEffect((()=>(c(i,l),()=>u(i,l))),[i,l,c,u]),E.jsx(er.span,{id:l,...o,ref:t})})),ETe="FormSubmit",wTe=_.forwardRef(((e,t)=>{const{__scopeForm:n,...r}=e;return E.jsx(er.button,{type:"submit",...r,ref:t})}));function CR(e){const t={};for(const n in e)t[n]=e[n];return t}function CTe(e){return e instanceof HTMLElement}function TTe(e){return"validity"in e}function RTe(e){return TTe(e)&&(!1===e.validity.valid||"true"===e.getAttribute("aria-invalid"))}function kY(e){const t=e.elements,[n]=Array.from(t).filter(CTe).filter(RTe);return n}function ITe(e,t){return"AsyncFunction"===e.match.constructor.name||xTe(e.match,t)}function kTe(e){return"Function"===e.match.constructor.name}function xTe(e,t){return e(...t)instanceof Promise}function xY(e){let t=!1;for(const n in e){if("valid"!==n&&"customError"!==n&&e[n]){t=!0;break}}return t}function $6(e,t){if(!0===(null==e?void 0:e.valid)&&!t)return!0}function H6(e,t){if(!1===(null==e?void 0:e.valid)||t)return!0}wTe.displayName=ETe;var PTe=CY,LTe=TY,OTe=RY,PY=IY;const MTe="_root_ssths_24",ATe="_label_ssths_67",sv={root:MTe,"inline-field":"_inline-field_ssths_40","inline-field-body":"_inline-field-body_ssths_46","inline-field-control":"_inline-field-control_ssths_52",label:ATe},NTe=_.forwardRef((function({children:e,...t},n){const r=Ae(sv.label,t.className);return E.jsx(OTe,{ref:n,...t,className:r,children:e})}));var DTe="Separator",Z7="horizontal",jTe=["horizontal","vertical"],LY=_.forwardRef(((e,t)=>{const{decorative:n,orientation:r=Z7,...i}=e,o=UTe(r)?r:Z7,s=n?{role:"none"}:{"aria-orientation":"vertical"===o?o:void 0,role:"separator"};return E.jsx(er.div,{"data-orientation":o,...s,...i,ref:t})}));function UTe(e){return jTe.includes(e)}LY.displayName=DTe;var FTe=LY;const $Te="_separator_144s5_17",HTe={separator:$Te},Q7="--cpd-separator-spacing",OY=_.forwardRef((({className:e,spacing:t,kind:n="primary",...r},i)=>{const o=Ae(HTe.separator,e),s=_.useRef(null),a=SG([s,i]);return _.useEffect((()=>{var e;const n=null==(e=s.current)?void 0:e.style;t?null==n||n.setProperty(Q7,t):null==n||n.removeProperty(Q7)}),[t]),E.jsx(FTe,{...r,className:o,ref:a,"data-kind":n})}));OY.displayName="Separator";const BTe="_container_qnvru_18",VTe="_input_qnvru_32",qTe="_ui_qnvru_42",TR={container:BTe,input:VTe,ui:qTe},MY=_.forwardRef((function({className:e,...t},n){const r=Ae(TR.container,e);return E.jsxs("div",{className:r,children:[E.jsx("input",{ref:n,className:TR.input,...t,type:"checkbox"}),E.jsx("div",{className:TR.ui})]})}));_.forwardRef((function(e,t){return E.jsx(PY,{asChild:!0,children:E.jsx(MY,{ref:t,...e})})}));const B6=_.forwardRef((function({className:e,Icon:t,label:n,onSelect:r,checked:i,disabled:o},s){const a=_.useId(),l=_.useCallback((()=>{}),[]);return E.jsx(Sp,{as:"div",role:"menuitemcheckbox","aria-checked":i,className:e,Icon:t,label:n,onSelect:r,disabled:o,children:E.jsx(MY,{id:a,ref:s,"aria-hidden":!0,checked:i,disabled:o,onChange:l})})})),eD=_.forwardRef((function({children:e,...t},n){const r=Ae(sv.root,t.className);return E.jsx(PTe,{ref:n,...t,className:r,children:e})})),KTe=_.forwardRef((function({className:e,control:t,children:n,...r},i){const o=Ae(sv["inline-field"],e);return E.jsxs(LTe,{ref:i,...r,className:o,children:[E.jsx("div",{className:sv["inline-field-control"],children:t}),E.jsx("div",{className:sv["inline-field-body"],children:n})]})})),GTe="_icon_1ye7b_27",WTe={icon:GTe};function AY(e,t){return E.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:t,...e,children:E.jsx("path",{fillRule:"evenodd",d:"M12 4.031a8 8 0 1 0 8 8 1 1 0 0 1 2 0c0 5.523-4.477 10-10 10s-10-4.477-10-10 4.477-10 10-10a1 1 0 1 1 0 2Z",clipRule:"evenodd"})})}AY.displayName="SpinnerIcon";const zTe=_.forwardRef(AY),YTe=_.forwardRef((function({size:e=20,...t},n){return E.jsx(zTe,{ref:n,className:WTe.icon,style:{width:e,height:e},...t})})),JTe="_button_i91xf_17",XTe="_destructive_i91xf_116",dg={button:JTe,"icon-only":"_icon-only_i91xf_59","has-icon":"_has-icon_i91xf_66",destructive:XTe},At=_.forwardRef((function({as:e,kind:t="primary",size:n="lg",children:r,className:i,iconOnly:o,Icon:s,destructive:a,disabled:l,...c},u){const[d,h]="destructive"===t?["secondary",!0]:[t,a],p=Ae(dg.button,i,{[dg["has-icon"]]:s,[dg["icon-only"]]:o,[dg.destructive]:h}),f=o&&"lg"===n?24:20;return E.jsxs(YK,{...c,as:e||"button",ref:u,className:p,"data-size":n,"data-kind":d,tabIndex:0,disabled:l,children:[s&&E.jsx(s,{width:f,height:f,className:dg.icon,"aria-hidden":!0}),r]})}));function NY(e,t){return E.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:t,...e,children:E.jsx("path",{d:"M12 16c1.25 0 2.313-.438 3.188-1.313.874-.874 1.312-1.937 1.312-3.187 0-1.25-.438-2.313-1.313-3.188C14.313 7.439 13.25 7 12 7c-1.25 0-2.312.438-3.187 1.313C7.938 9.187 7.5 10.25 7.5 11.5c0 1.25.438 2.313 1.313 3.188C9.688 15.562 10.75 16 12 16Zm0-1.8c-.75 0-1.387-.262-1.912-.787A2.604 2.604 0 0 1 9.3 11.5c0-.75.263-1.387.787-1.912A2.604 2.604 0 0 1 12 8.8c.75 0 1.387.262 1.912.787.525.526.788 1.163.788 1.913s-.262 1.387-.787 1.912A2.604 2.604 0 0 1 12 14.2Zm0 4.8c-2.317 0-4.433-.613-6.35-1.837-1.917-1.226-3.367-2.88-4.35-4.963a.812.812 0 0 1-.1-.313 2.93 2.93 0 0 1 0-.774.812.812 0 0 1 .1-.313c.983-2.083 2.433-3.738 4.35-4.963C7.567 4.614 9.683 4 12 4c2.317 0 4.433.612 6.35 1.838 1.917 1.224 3.367 2.879 4.35 4.962a.81.81 0 0 1 .1.313 2.925 2.925 0 0 1 0 .774.81.81 0 0 1-.1.313c-.983 2.083-2.433 3.738-4.35 4.963C16.433 18.387 14.317 19 12 19Zm0-2a9.544 9.544 0 0 0 5.188-1.488A9.773 9.773 0 0 0 20.8 11.5a9.773 9.773 0 0 0-3.613-4.013A9.544 9.544 0 0 0 12 6a9.545 9.545 0 0 0-5.187 1.487A9.773 9.773 0 0 0 3.2 11.5a9.773 9.773 0 0 0 3.613 4.012A9.544 9.544 0 0 0 12 17Z"})})}NY.displayName="VisibilityOnIcon";const ZTe=_.forwardRef(NY);function DY(e,t){return E.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:t,...e,children:E.jsx("path",{d:"M9.55 17.575c-.133 0-.258-.02-.375-.063a.876.876 0 0 1-.325-.212L4.55 13c-.183-.183-.27-.42-.263-.713.009-.291.105-.529.288-.712a.948.948 0 0 1 .7-.275.95.95 0 0 1 .7.275L9.55 15.15l8.475-8.475c.183-.183.42-.275.713-.275.291 0 .529.092.712.275.183.183.275.42.275.713 0 .291-.092.529-.275.712l-9.2 9.2c-.1.1-.208.17-.325.212a1.106 1.106 0 0 1-.375.063Z"})})}DY.displayName="CheckIcon";const jY=_.forwardRef(DY),QTe="_container_1vw5h_18",e2e="_input_1vw5h_26",t2e="_ui_1vw5h_27",RR={container:QTe,input:e2e,ui:t2e},n2e=_.forwardRef((function({className:e,...t},n){const r=Ae(RR.container,e);return E.jsxs("div",{className:r,children:[E.jsx("input",{ref:n,...t,className:RR.input,type:"radio"}),E.jsx("div",{className:RR.ui})]})})),r2e=_.forwardRef((function(e,t){return E.jsx(PY,{asChild:!0,children:E.jsx(n2e,{ref:t,...e})})})),i2e="_content_md016_17",s2e="_destructive_md016_43",o2e="_success_md016_48",IR={content:i2e,destructive:s2e,success:o2e};function a2e({className:e,size:t="large",destructive:n=!1,success:r=!1,children:i}){return E.jsx("div",{className:Ae(IR.content,e,{[IR.destructive]:n,[IR.success]:r}),"data-size":t,children:we.Children.only(i)})}const Gv={"nav-bar":"_nav-bar_135dy_16","nav-bar-items":"_nav-bar-items_135dy_22","nav-tab":"_nav-tab_135dy_33","nav-item":"_nav-item_135dy_55"},l2e=({children:e,className:t,role:n,"aria-label":r,...i})=>{const o=Ae(t,Gv["nav-bar"]),s="tablist"!==n?{role:"navigation","aria-label":r}:{role:"presentation"},a="tablist"===n?{role:"tablist","aria-label":r}:{};return E.jsx("nav",{...s,...i,className:o,children:E.jsx("ul",{...a,className:Gv["nav-bar-items"],children:e})})},c2e=_.forwardRef((function({children:e,href:t,onClick:n,...r},i){return E.jsx("a",{href:t,onClick:n,className:Gv["nav-item"],...r,ref:i,children:e})})),u2e=_.forwardRef((function({children:e,disabled:t,onClick:n,...r},i){return E.jsx("button",{onClick:n,className:Gv["nav-item"],disabled:t,ref:i,...r,children:e})})),d2e=e=>"href"in e&&!!e.href,f2e=_.forwardRef((function(e,t){const n=e["aria-controls"],r=n?{"aria-controls":n,role:"tab","aria-selected":e.active}:{"aria-current":!!e.active||void 0},i={...e};let o;if(delete i.active,d2e(i)){const e=t;o=E.jsx(c2e,{...i,...r,ref:e})}else{const e=t;o=E.jsx(u2e,{...i,...r,ref:e})}return E.jsx("li",{className:Gv["nav-tab"],"data-current":!!e.active||void 0,role:"presentation",children:o})}));function UY(e,t){return E.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:t,...e,children:E.jsx("path",{d:"M12 14.95c-.133 0-.258-.02-.375-.063a.876.876 0 0 1-.325-.212l-4.6-4.6a.948.948 0 0 1-.275-.7.95.95 0 0 1 .275-.7.948.948 0 0 1 .7-.275.95.95 0 0 1 .7.275l3.9 3.9 3.9-3.9a.948.948 0 0 1 .7-.275.95.95 0 0 1 .7.275.948.948 0 0 1 .275.7.948.948 0 0 1-.275.7l-4.6 4.6c-.1.1-.208.17-.325.212a1.106 1.106 0 0 1-.375.063Z"})})}UY.displayName="ChevronDownIcon";const h2e=_.forwardRef(UY);function FY(e,t){return E.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:t,...e,children:E.jsx("path",{d:"m13.3 17.3-4.6-4.6a.877.877 0 0 1-.213-.325A1.106 1.106 0 0 1 8.425 12c0-.133.02-.258.062-.375A.878.878 0 0 1 8.7 11.3l4.6-4.6a.948.948 0 0 1 .7-.275.95.95 0 0 1 .7.275.948.948 0 0 1 .275.7.948.948 0 0 1-.275.7L10.8 12l3.9 3.9a.949.949 0 0 1 .275.7.948.948 0 0 1-.275.7.948.948 0 0 1-.7.275.948.948 0 0 1-.7-.275Z"})})}FY.displayName="ChevronLeftIcon";const p2e=_.forwardRef(FY);var kR,tD;function m2e(){return tD||(tD=1,kR={area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0}),kR}var g2e=m2e();const v2e=Ko(g2e);var y2e=/\s([^'"/\s><]+?)[\s/>]|([^\s=]+)=\s?(".*?"|'.*?')/g;function nD(e){var t={type:"tag",name:"",voidElement:!1,attrs:{},children:[]},n=e.match(/<\/?([^\s]+?)[/\s>]/);if(n&&(t.name=n[1],(v2e[n[1]]||"/"===e.charAt(e.length-2))&&(t.voidElement=!0),t.name.startsWith("!--"))){var r=e.indexOf("--\x3e");return{type:"comment",comment:-1!==r?e.slice(4,r):""}}for(var i=new RegExp(y2e),o=null;null!==(o=i.exec(e));)if(o[0].trim())if(o[1]){var s=o[1].trim(),a=[s,""];s.indexOf("=")>-1&&(a=s.split("=")),t.attrs[a[0]]=a[1],i.lastIndex--}else o[2]&&(t.attrs[o[2]]=o[3].trim().substring(1,o[3].length-1));return t}var _2e=/<[a-zA-Z0-9\-\!\/](?:"[^"]*"|'[^']*'|[^'">])*>/g,b2e=/^\s*$/,S2e=Object.create(null);function $Y(e,t){switch(t.type){case"text":return e+t.content;case"tag":return e+="<"+t.name+(t.attrs?function(e){var t=[];for(var n in e)t.push(n+'="'+e[n]+'"');return t.length?" "+t.join(" "):""}(t.attrs):"")+(t.voidElement?"/>":">"),t.voidElement?e:e+t.children.reduce($Y,"")+"</"+t.name+">";case"comment":return e+"\x3c!--"+t.comment+"--\x3e"}}var E2e={parse:function(e,t){t||(t={}),t.components||(t.components=S2e);var n,r=[],i=[],o=-1,s=!1;if(0!==e.indexOf("<")){var a=e.indexOf("<");r.push({type:"text",content:-1===a?e:e.substring(0,a)})}return e.replace(_2e,(function(a,l){if(s){if(a!=="</"+n.name+">")return;s=!1}var c,u="/"!==a.charAt(1),d=a.startsWith("\x3c!--"),h=l+a.length,p=e.charAt(h);if(d){var f=nD(a);return o<0?(r.push(f),r):((c=i[o]).children.push(f),r)}if(u&&(o++,"tag"===(n=nD(a)).type&&t.components[n.name]&&(n.type="component",s=!0),n.voidElement||s||!p||"<"===p||n.children.push({type:"text",content:e.slice(h,e.indexOf("<",h))}),0===o&&r.push(n),(c=i[o-1])&&c.children.push(n),i[o]=n),(!u||n.voidElement)&&(o>-1&&(n.voidElement||n.name===a.slice(2,-1))&&(o--,n=-1===o?r:i[o]),!s&&"<"!==p&&p)){c=-1===o?r:i[o].children;var m=e.indexOf("<",h),v=e.slice(h,-1===m?void 0:m);b2e.test(v)&&(v=" "),(m>-1&&o+c.length>=0||" "!==v)&&c.push({type:"text",content:v})}})),r},stringify:function(e){return e.reduce((function(e,t){return e+$Y("",t)}),"")}};const Eb=(e,t,n,r)=>{var i,o,s,a;const l=[n,{code:t,...r||{}}];if(null!=(o=null==(i=null==e?void 0:e.services)?void 0:i.logger)&&o.forward)return e.services.logger.forward(l,"warn","react-i18next::",!0);zs(l[0])&&(l[0]=`react-i18next:: ${l[0]}`),null!=(a=null==(s=null==e?void 0:e.services)?void 0:s.logger)&&a.warn?e.services.logger.warn(...l):null!=console&&console.warn&&console.warn(...l)},rD={},Wv=(e,t,n,r)=>{zs(n)&&rD[n]||(zs(n)&&(rD[n]=new Date),Eb(e,t,n,r))},HY=(e,t)=>()=>{if(e.isInitialized)t();else{const n=()=>{setTimeout((()=>{e.off("initialized",n)}),0),t()};e.on("initialized",n)}},dx=(e,t,n)=>{e.loadNamespaces(t,HY(e,n))},iD=(e,t,n,r)=>{if(zs(n)&&(n=[n]),e.options.preload&&e.options.preload.indexOf(t)>-1)return dx(e,n,r);n.forEach((t=>{e.options.ns.indexOf(t)<0&&e.options.ns.push(t)})),e.loadLanguages(t,HY(e,r))},w2e=(e,t,n={})=>t.languages&&t.languages.length?t.hasLoadedNamespace(e,{lng:n.lng,precheck:(t,r)=>{var i;if((null==(i=n.bindI18n)?void 0:i.indexOf("languageChanging"))>-1&&t.services.backendConnector.backend&&t.isLanguageChangingTo&&!r(t.isLanguageChangingTo,e))return!1}}):(Wv(t,"NO_LANGUAGES","i18n.languages were undefined or empty",{languages:t.languages}),!0),zs=e=>"string"==typeof e,vd=e=>"object"==typeof e&&null!==e,C2e=/&(?:amp|#38|lt|#60|gt|#62|apos|#39|quot|#34|nbsp|#160|copy|#169|reg|#174|hellip|#8230|#x2F|#47);/g,T2e={"&amp;":"&","&#38;":"&","&lt;":"<","&#60;":"<","&gt;":">","&#62;":">","&apos;":"'","&#39;":"'","&quot;":'"',"&#34;":'"',"&nbsp;":" ","&#160;":" ","&copy;":"©","&#169;":"©","&reg;":"®","&#174;":"®","&hellip;":"…","&#8230;":"…","&#x2F;":"/","&#47;":"/"},R2e=e=>T2e[e],I2e=e=>e.replace(C2e,R2e);let fx={bindI18n:"languageChanged",bindI18nStore:"",transEmptyNodeValue:"",transSupportBasicHtmlNodes:!0,transWrapTextNodes:"",transKeepBasicHtmlNodesFor:["br","strong","i","p"],useSuspense:!0,unescape:I2e};const k2e=(e={})=>{fx={...fx,...e}},BY=()=>fx;let VY;const x2e=e=>{VY=e},V6=()=>VY,xR=(e,t)=>{var n;if(!e)return!1;const r=(null==(n=e.props)?void 0:n.children)??e.children;return t?r.length>0:!!r},PR=e=>{var t,n;if(!e)return[];const r=(null==(t=e.props)?void 0:t.children)??e.children;return null!=(n=e.props)&&n.i18nIsDynamicList?Ch(r):r},P2e=e=>Array.isArray(e)&&e.every(_.isValidElement),Ch=e=>Array.isArray(e)?e:[e],L2e=(e,t)=>{const n={...t};return n.props=Object.assign(e.props,t.props),n},qY=(e,t,n,r)=>{if(!e)return"";let i="";const o=Ch(e),s=null!=t&&t.transSupportBasicHtmlNodes?t.transKeepBasicHtmlNodesFor??[]:[];return o.forEach(((e,o)=>{if(zs(e))i+=`${e}`;else if(_.isValidElement(e)){const{props:a,type:l}=e,c=Object.keys(a).length,u=s.indexOf(l)>-1,d=a.children;if(!d&&u&&!c)return void(i+=`<${l}/>`);if(!d&&(!u||c)||a.i18nIsDynamicList)return void(i+=`<${o}></${o}>`);if(u&&1===c&&zs(d))return void(i+=`<${l}>${d}</${l}>`);const h=qY(d,t,n,r);i+=`<${o}>${h}</${o}>`}else if(null!==e)if(vd(e)){const{format:t,...o}=e,s=Object.keys(o);if(1===s.length){const e=t?`${s[0]}, ${t}`:s[0];return void(i+=`{{${e}}}`)}Eb(n,"TRANS_INVALID_OBJ","Invalid child - Object should only have keys {{ value, format }} (format is optional).",{i18nKey:r,child:e})}else Eb(n,"TRANS_INVALID_VAR","Passed in a variable like {number} - pass variables for interpolation as full objects like {{number}}.",{i18nKey:r,child:e});else Eb(n,"TRANS_NULL_VALUE","Passed in a null value as child",{i18nKey:r})})),i},O2e=(e,t,n,r,i,o)=>{if(""===t)return[];const s=r.transKeepBasicHtmlNodesFor||[],a=t&&new RegExp(s.map((e=>`<${e}`)).join("|")).test(t);if(!e&&!a&&!o)return[t];const l={},c=e=>{Ch(e).forEach((e=>{zs(e)||(xR(e)?c(PR(e)):vd(e)&&!_.isValidElement(e)&&Object.assign(l,e))}))};c(e);const u=E2e.parse(`<0>${t}</0>`),d={...l,...i},h=(e,t,n)=>{var r;const i=PR(e),o=f(i,t.children,n);return P2e(i)&&0===o.length||null!=(r=e.props)&&r.i18nIsDynamicList?i:o},p=(e,t,n,r,i)=>{e.dummy?(e.children=t,n.push(_.cloneElement(e,{key:r},i?void 0:t))):n.push(..._.Children.map([e],(e=>{const n={...e.props};return delete n.i18nIsDynamicList,_.createElement(e.type,{...n,key:r,ref:e.ref},i?null:t)})))},f=(t,i,l)=>{const c=Ch(t);return Ch(i).reduce(((t,i,u)=>{var m,v;const g=(null==(v=null==(m=i.children)?void 0:m[0])?void 0:v.content)&&n.services.interpolator.interpolate(i.children[0].content,d,n.language);if("tag"===i.type){let o=c[parseInt(i.name,10)];1===l.length&&!o&&(o=l[0][i.name]),o||(o={});const m=0!==Object.keys(i.attrs).length?L2e({props:i.attrs},o):o,v=_.isValidElement(m),y=v&&xR(i,!0)&&!i.voidElement,b=a&&vd(m)&&m.dummy&&!v,w=vd(e)&&Object.hasOwnProperty.call(e,i.name);if(zs(m)){const e=n.services.interpolator.interpolate(m,d,n.language);t.push(e)}else if(xR(m)||y){const e=h(m,i,l);p(m,e,t,u)}else if(b){const e=f(c,i.children,l);p(m,e,t,u)}else if(Number.isNaN(parseFloat(i.name)))if(w){const e=h(m,i,l);p(m,e,t,u,i.voidElement)}else if(r.transSupportBasicHtmlNodes&&s.indexOf(i.name)>-1)if(i.voidElement)t.push(_.createElement(i.name,{key:`${i.name}-${u}`}));else{const e=f(c,i.children,l);t.push(_.createElement(i.name,{key:`${i.name}-${u}`},e))}else if(i.voidElement)t.push(`<${i.name} />`);else{const e=f(c,i.children,l);t.push(`<${i.name}>${e}</${i.name}>`)}else if(vd(m)&&!v){const e=i.children[0]?g:null;e&&t.push(e)}else p(m,g,t,u,1!==i.children.length||!g)}else if("text"===i.type){const e=r.transWrapTextNodes,s=o?r.unescape(n.services.interpolator.interpolate(i.content,d,n.language)):n.services.interpolator.interpolate(i.content,d,n.language);e?t.push(_.createElement(e,{key:`${i.name}-${u}`},s)):t.push(s)}return t}),[])},m=f([{dummy:!0,children:e||[]}],u,Ch(e||[]));return PR(m[0])},KY=(e,t,n)=>{const r=e.key||t,i=_.cloneElement(e,{key:r});if(!i.props||!i.props.children||n.indexOf(`${t}/>`)<0&&n.indexOf(`${t} />`)<0)return i;return _.createElement((function(){return _.createElement(_.Fragment,null,i)}),{key:r})},M2e=(e,t)=>e.map(((e,n)=>KY(e,n,t))),A2e=(e,t)=>{const n={};return Object.keys(e).forEach((r=>{Object.assign(n,{[r]:KY(e[r],r,t)})})),n},N2e=(e,t,n,r)=>e?Array.isArray(e)?M2e(e,t):vd(e)?A2e(e,t):(Wv(n,"TRANS_INVALID_COMPONENTS",'<Trans /> "components" prop expects an object or array',{i18nKey:r}),null):null;function D2e({children:e,count:t,parent:n,i18nKey:r,context:i,tOptions:o={},values:s,defaults:a,components:l,ns:c,i18n:u,t:d,shouldUnescape:h,...p}){var f,m,v,g,y,b;const w=u||V6();if(!w)return Wv(w,"NO_I18NEXT_INSTANCE","Trans: You need to pass in an i18next instance using i18nextReactModule",{i18nKey:r}),e;const E=d||w.t.bind(w)||(e=>e),S={...BY(),...null==(f=w.options)?void 0:f.react};let C=c||E.ns||(null==(m=w.options)?void 0:m.defaultNS);C=zs(C)?[C]:C||["translation"];const k=qY(e,S,w,r),T=a||k||S.transEmptyNodeValue||r,{hashTransKey:I}=S,R=r||(I?I(k||T):k||T);null!=(g=null==(v=w.options)?void 0:v.interpolation)&&g.defaultVariables&&(s=s&&Object.keys(s).length>0?{...s,...w.options.interpolation.defaultVariables}:{...w.options.interpolation.defaultVariables});const x=!s&&(void 0===t||null!=(b=null==(y=w.options)?void 0:y.interpolation)&&b.alwaysFormat)&&e?{interpolation:{...o.interpolation,prefix:"#$?",suffix:"?$#"}}:o.interpolation,L={...o,context:i||o.context,count:t,...s,...x,defaultValue:T,ns:C},P=R?E(R,L):T,O=N2e(l,P,w,r),A=O2e(O||e,P,w,S,L,h),M=n??S.defaultTransParent;return M?_.createElement(M,p,A):A}const j2e={type:"3rdParty",init(e){k2e(e.options.react),x2e(e)}},GY=_.createContext();class U2e{constructor(){this.usedNamespaces={}}addUsedNamespaces(e){e.forEach((e=>{this.usedNamespaces[e]||(this.usedNamespaces[e]=!0)}))}getUsedNamespaces(){return Object.keys(this.usedNamespaces)}}function Zi({children:e,count:t,parent:n,i18nKey:r,context:i,tOptions:o={},values:s,defaults:a,components:l,ns:c,i18n:u,t:d,shouldUnescape:h,...p}){var f;const{i18n:m,defaultNS:v}=_.useContext(GY)||{},g=u||m||V6(),y=d||(null==g?void 0:g.t.bind(g));return D2e({children:e,count:t,parent:n,i18nKey:r,context:i,tOptions:o,values:s,defaults:a,components:l,ns:c||(null==y?void 0:y.ns)||v||(null==(f=null==g?void 0:g.options)?void 0:f.defaultNS),i18n:g,t:d,shouldUnescape:h,...p})}const F2e=(e,t)=>{const n=_.useRef();return _.useEffect((()=>{n.current=e}),[e,t]),n.current},WY=(e,t,n,r)=>e.getFixedT(t,n,r),$2e=(e,t,n,r)=>_.useCallback(WY(e,t,n,r),[e,t,n,r]),ze=(e,t={})=>{var n,r,i,o;const{i18n:s}=t,{i18n:a,defaultNS:l}=_.useContext(GY)||{},c=s||a||V6();if(c&&!c.reportNamespaces&&(c.reportNamespaces=new U2e),!c){Wv(c,"NO_I18NEXT_INSTANCE","useTranslation: You will need to pass in an i18next instance by using initReactI18next");const e=(e,t)=>zs(t)?t:vd(t)&&zs(t.defaultValue)?t.defaultValue:Array.isArray(e)?e[e.length-1]:e,t=[e,{},!1];return t.t=e,t.i18n={},t.ready=!1,t}null!=(n=c.options.react)&&n.wait&&Wv(c,"DEPRECATED_OPTION","useTranslation: It seems you are still using the old wait option, you may migrate to the new useSuspense behaviour.");const u={...BY(),...c.options.react,...t},{useSuspense:d,keyPrefix:h}=u;let p=l||(null==(r=c.options)?void 0:r.defaultNS);p=zs(p)?[p]:p||["translation"],null==(o=(i=c.reportNamespaces).addUsedNamespaces)||o.call(i,p);const f=(c.isInitialized||c.initializedStoreOnce)&&p.every((e=>w2e(e,c,u))),m=$2e(c,t.lng||null,"fallback"===u.nsMode?p:p[0],h),v=()=>m,g=()=>WY(c,t.lng||null,"fallback"===u.nsMode?p:p[0],h),[y,b]=_.useState(v);let w=p.join();t.lng&&(w=`${t.lng}${w}`);const E=F2e(w),S=_.useRef(!0);_.useEffect((()=>{const{bindI18n:e,bindI18nStore:n}=u;S.current=!0,!f&&!d&&(t.lng?iD(c,t.lng,p,(()=>{S.current&&b(g)})):dx(c,p,(()=>{S.current&&b(g)}))),f&&E&&E!==w&&S.current&&b(g);const r=()=>{S.current&&b(g)};return e&&(null==c||c.on(e,r)),n&&(null==c||c.store.on(n,r)),()=>{S.current=!1,c&&(null==e||e.split(" ").forEach((e=>c.off(e,r)))),n&&c&&n.split(" ").forEach((e=>c.store.off(e,r)))}}),[c,w]),_.useEffect((()=>{S.current&&f&&b(v)}),[c,h,f]);const C=[y,c,f];if(C.t=y,C.i18n=c,C.ready=f,f||!f&&!d)return C;throw new Promise((e=>{t.lng?iD(c,t.lng,p,(()=>e())):dx(c,p,(()=>e()))}))};function zY(e,t){return E.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:t,...e,children:E.jsx("path",{fillRule:"evenodd",d:"m12 4.236-6 3V12c0 5.156 4.239 7.254 6 7.898 1.761-.644 6-2.742 6-7.898V7.236l-6-3Zm-.894-1.789a2 2 0 0 1 1.788 0l6 3A2 2 0 0 1 20 7.236V12c0 6.742-5.773 9.246-7.51 9.846-.32.111-.66.111-.98 0C9.774 21.246 4 18.742 4 12V7.236a2 2 0 0 1 1.106-1.789l6-3Z",clipRule:"evenodd"})})}zY.displayName="AdminIcon";const H2e=_.forwardRef(zY);function YY(e,t){return E.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:t,...e,children:E.jsx("path",{d:"m12 10.775-3.9 3.9a.948.948 0 0 1-.7.275.948.948 0 0 1-.7-.275.948.948 0 0 1-.275-.7.95.95 0 0 1 .275-.7l4.6-4.6c.1-.1.208-.17.325-.213.117-.041.242-.062.375-.062s.258.02.375.062a.877.877 0 0 1 .325.213l4.6 4.6a.948.948 0 0 1 .275.7.949.949 0 0 1-.275.7.948.948 0 0 1-.7.275.948.948 0 0 1-.7-.275l-3.9-3.9Z"})})}YY.displayName="ChevronUpIcon";const B2e=_.forwardRef(YY);function JY(e,t){return E.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:t,...e,children:E.jsx("path",{d:"M12 11.034a.996.996 0 0 0 .29.702l.005.005c.18.18.43.29.705.29h8a1 1 0 1 0 0-2h-5.586L22 3.446a1 1 0 0 0-1.414-1.415L14 8.617V3.031a1 1 0 1 0-2 0v8.003Zm0 1.963a.997.997 0 0 0-.29-.702l-.005-.004A.997.997 0 0 0 11 12H3a1 1 0 0 0 0 2h5.586L2 20.586A1 1 0 1 0 3.414 22L10 15.414V21a1 1 0 1 0 2 0v-8.003Z"})})}JY.displayName="CollapseIcon";const V2e=_.forwardRef(JY);function XY(e,t){return E.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:t,...e,children:E.jsx("path",{d:"M7 21c-.55 0-1.02-.196-1.412-.587A1.926 1.926 0 0 1 5 19V6a.968.968 0 0 1-.713-.287A.968.968 0 0 1 4 5c0-.283.096-.52.287-.713A.968.968 0 0 1 5 4h4a.97.97 0 0 1 .287-.712A.968.968 0 0 1 10 3h4a.97.97 0 0 1 .713.288A.968.968 0 0 1 15 4h4a.97.97 0 0 1 .712.287c.192.192.288.43.288.713s-.096.52-.288.713A.968.968 0 0 1 19 6v13c0 .55-.196 1.02-.587 1.413A1.926 1.926 0 0 1 17 21H7ZM7 6v13h10V6H7Zm2 10c0 .283.096.52.287.712.192.192.43.288.713.288s.52-.096.713-.288A.968.968 0 0 0 11 16V9a.967.967 0 0 0-.287-.713A.968.968 0 0 0 10 8a.968.968 0 0 0-.713.287A.968.968 0 0 0 9 9v7Zm4 0c0 .283.096.52.287.712.192.192.43.288.713.288s.52-.096.713-.288A.968.968 0 0 0 15 16V9a.967.967 0 0 0-.287-.713A.968.968 0 0 0 14 8a.968.968 0 0 0-.713.287A.967.967 0 0 0 13 9v7Z"})})}XY.displayName="DeleteIcon";const q2e=_.forwardRef(XY);function ZY(e,t){return E.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:t,...e,children:E.jsx("path",{fillRule:"evenodd",d:"M15.706 2.637a2 2 0 0 1 2.829 0l2.828 2.828a2 2 0 0 1 0 2.829L9.605 20.052a1 1 0 0 1-.465.263L3.483 21.73a1 1 0 0 1-1.212-1.212l1.414-5.657a1 1 0 0 1 .263-.465L15.706 2.637Zm1.224 7.262L14.102 7.07l-8.544 8.544-.943 3.77 3.771-.942L16.93 9.9Z",clipRule:"evenodd"})})}ZY.displayName="EditIcon";const sD=_.forwardRef(ZY);function QY(e,t){return E.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:t,...e,children:E.jsx("path",{d:"m2.765 16.02-2.47-2.416A1.018 1.018 0 0 1 0 12.852c0-.304.098-.555.295-.751a15.64 15.64 0 0 1 5.316-3.786A15.89 15.89 0 0 1 12 7c2.237 0 4.367.443 6.39 1.329a15.977 15.977 0 0 1 5.315 3.772c.197.196.295.447.295.751 0 .305-.098.555-.295.752l-2.47 2.416a1.047 1.047 0 0 1-1.396.108l-3.114-2.363a1.067 1.067 0 0 1-.322-.376 1.066 1.066 0 0 1-.108-.483v-2.27a13.593 13.593 0 0 0-2.12-.524C13.459 9.996 12 9.937 12 9.937s-1.459.059-2.175.175c-.715.116-1.422.29-2.12.523v2.271c0 .179-.036.34-.108.483a1.066 1.066 0 0 1-.322.376l-3.114 2.363a1.047 1.047 0 0 1-1.396-.107Z"})})}QY.displayName="EndCallIcon";const eJ=_.forwardRef(QY);function tJ(e,t){return E.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:t,...e,children:E.jsx("path",{d:"M21 3.997a.996.996 0 0 0-.29-.702l-.005-.004A.997.997 0 0 0 20 3h-8a1 1 0 1 0 0 2h5.586L5 17.586V12a1 1 0 1 0-2 0v8.003a.997.997 0 0 0 .29.702l.005.004c.18.18.43.291.705.291h8a1 1 0 1 0 0-2H6.414L19 6.414V12a1 1 0 1 0 2 0V3.997Z"})})}tJ.displayName="ExpandIcon";const nJ=_.forwardRef(tJ);function rJ(e,t){return E.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:t,...e,children:E.jsx("path",{d:"M4 11a.967.967 0 0 1-.712-.287A.968.968 0 0 1 3 10V4c0-.283.096-.52.288-.712A.968.968 0 0 1 4 3h6a.97.97 0 0 1 .713.288A.968.968 0 0 1 11 4v6c0 .283-.096.52-.287.713A.968.968 0 0 1 10 11H4Zm5-2V5H5v4h4Zm5 12a.968.968 0 0 1-.713-.288A.968.968 0 0 1 13 20v-6c0-.283.096-.52.287-.713A.968.968 0 0 1 14 13h6a.97.97 0 0 1 .712.287c.192.192.288.43.288.713v6c0 .283-.096.52-.288.712A.968.968 0 0 1 20 21h-6Zm5-2v-4h-4v4h4ZM4 21a.967.967 0 0 1-.712-.288A.968.968 0 0 1 3 20v-6a.97.97 0 0 1 .288-.713A.967.967 0 0 1 4 13h6c.283 0 .52.096.713.287.191.192.287.43.287.713v6a.97.97 0 0 1-.287.712A.968.968 0 0 1 10 21H4Zm5-2v-4H5v4h4Zm5-8a.968.968 0 0 1-.713-.287A.968.968 0 0 1 13 10V4a.97.97 0 0 1 .287-.712A.968.968 0 0 1 14 3h6c.283 0 .52.096.712.288A.965.965 0 0 1 21 4v6a.97.97 0 0 1-.288.713A.968.968 0 0 1 20 11h-6Zm5-2V5h-4v4h4Z"})})}rJ.displayName="GridIcon";const K2e=_.forwardRef(rJ);function iJ(e,t){return E.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:t,...e,children:[E.jsx("path",{d:"M16.712 6.713A.968.968 0 0 1 16 7a.968.968 0 0 1-.713-.287A.967.967 0 0 1 15 6c0-.283.096-.52.287-.713A.968.968 0 0 1 16 5a.97.97 0 0 1 .712.287c.192.192.288.43.288.713s-.096.52-.288.713Z"}),E.jsx("path",{fillRule:"evenodd",d:"M6 2a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V4a2 2 0 0 0-2-2H6Zm12 2H6v4h12V4ZM6 12v-2h12v2H6Zm0 2v2h12v-2H6Zm0 6v-2h12v2H6Z",clipRule:"evenodd"})]})}iJ.displayName="HostIcon";const G2e=_.forwardRef(iJ);function sJ(e,t){return E.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:t,...e,children:E.jsx("path",{d:"M12 19.071c-.978.978-2.157 1.467-3.536 1.467-1.378 0-2.557-.489-3.535-1.467-.978-.978-1.467-2.157-1.467-3.536 0-1.378.489-2.557 1.467-3.535L7.05 9.879c.2-.2.436-.3.707-.3.271 0 .507.1.707.3.2.2.301.436.301.707 0 .27-.1.506-.3.707l-2.122 2.121a2.893 2.893 0 0 0-.884 2.122c0 .824.295 1.532.884 2.12.59.59 1.296.885 2.121.885s1.533-.295 2.122-.884l2.121-2.121c.2-.2.436-.301.707-.301.271 0 .507.1.707.3.2.2.3.437.3.708 0 .27-.1.506-.3.707L12 19.07Zm-1.414-4.243c-.2.2-.436.3-.707.3a.967.967 0 0 1-.707-.3.969.969 0 0 1-.301-.707c0-.27.1-.507.3-.707l4.243-4.242c.2-.2.436-.301.707-.301.271 0 .507.1.707.3.2.2.3.437.3.708 0 .27-.1.506-.3.707l-4.242 4.242Zm6.364-.707c-.2.2-.436.3-.707.3a.968.968 0 0 1-.707-.3.969.969 0 0 1-.301-.707c0-.27.1-.507.3-.707l2.122-2.121c.59-.59.884-1.297.884-2.122s-.295-1.532-.884-2.12a2.893 2.893 0 0 0-2.121-.885c-.825 0-1.532.295-2.122.884l-2.121 2.121c-.2.2-.436.301-.707.301a.968.968 0 0 1-.707-.3.97.97 0 0 1-.3-.708c0-.27.1-.506.3-.707L12 4.93c.978-.978 2.157-1.467 3.536-1.467 1.378 0 2.557.489 3.535 1.467.978.978 1.467 2.157 1.467 3.535 0 1.38-.489 2.558-1.467 3.536l-2.121 2.121Z"})})}sJ.displayName="LinkIcon";const W2e=_.forwardRef(sJ);function oJ(e,t){return E.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:t,...e,children:E.jsx("path",{d:"M6 22c-.55 0-1.02-.196-1.413-.587A1.926 1.926 0 0 1 4 20V10c0-.55.196-1.02.587-1.412.212-.212.446-.366.703-.463L1.333 4.167a1 1 0 0 1 1.414-1.414L7 7.006v-.012l13 13v.012l1.247 1.247a1 1 0 0 1-1.414 1.414l-.896-.896A1.935 1.935 0 0 1 18 22H6Zm14-4.834V10c0-.55-.196-1.02-.587-1.412A1.926 1.926 0 0 0 18 8h-1V6c0-1.383-.488-2.563-1.463-3.538C14.563 1.487 13.383 1 12 1s-2.563.488-3.538 1.462A4.876 4.876 0 0 0 7.243 4.41L9 6.166V6c0-.833.292-1.542.875-2.125A2.893 2.893 0 0 1 12 3c.833 0 1.542.292 2.125.875S15 5.167 15 6v2h-4.166L20 17.166Z"})})}oJ.displayName="LockOffIcon";const z2e=_.forwardRef(oJ);function aJ(e,t){return E.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:t,...e,children:E.jsx("path",{d:"M6 22c-.55 0-1.02-.196-1.412-.587A1.926 1.926 0 0 1 4 20V10c0-.55.196-1.02.588-1.412A1.926 1.926 0 0 1 6 8h1V6c0-1.383.487-2.563 1.463-3.538C9.438 1.487 10.617 1 12 1s2.563.488 3.537 1.462C16.512 3.438 17 4.617 17 6v2h1c.55 0 1.02.196 1.413.588.391.391.587.862.587 1.412v10c0 .55-.196 1.02-.587 1.413A1.926 1.926 0 0 1 18 22H6ZM9 8h6V6c0-.833-.292-1.542-.875-2.125A2.893 2.893 0 0 0 12 3c-.833 0-1.542.292-2.125.875A2.893 2.893 0 0 0 9 6v2Z"})})}aJ.displayName="LockSolidIcon";const Y2e=_.forwardRef(aJ);function lJ(e,t){return E.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:t,...e,children:E.jsx("path",{d:"M8 8v-.006l6.831 6.832-.002.002 1.414 1.415.003-.003 1.414 1.414-.003.003L20.5 20.5a1 1 0 0 1-1.414 1.414l-3.022-3.022A7.949 7.949 0 0 1 13 19.938V21a1 1 0 0 1-2 0v-1.062A8.001 8.001 0 0 1 4 12a1 1 0 1 1 2 0 6 6 0 0 0 8.587 5.415l-1.55-1.55A4.005 4.005 0 0 1 8 12v-1.172L2.086 4.914A1 1 0 0 1 3.5 3.5L8 8Zm9.417 6.583 1.478 1.477A7.963 7.963 0 0 0 20 12a1 1 0 0 0-2 0c0 .925-.21 1.8-.583 2.583ZM8.073 5.238l7.793 7.793c.087-.329.134-.674.134-1.031V6a4 4 0 0 0-7.927-.762Z"})})}lJ.displayName="MicOffSolidIcon";const cJ=_.forwardRef(lJ);function uJ(e,t){return E.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:t,...e,children:[E.jsx("path",{fillRule:"evenodd",d:"M8 8v-.006l2 2V10l3.414 3.414.003-.003 1.414 1.415-.002.002 1.414 1.415.003-.003 1.414 1.414-.003.003L20.5 20.5a1 1 0 0 1-1.414 1.414l-3.022-3.022A7.947 7.947 0 0 1 13 19.938V21a1 1 0 1 1-2 0v-1.062A8.001 8.001 0 0 1 4 12a1 1 0 1 1 2 0 6 6 0 0 0 8.587 5.415l-1.55-1.55A4.005 4.005 0 0 1 8 12v-1.172L2.086 4.914A1 1 0 0 1 3.5 3.5L8 8Z",clipRule:"evenodd"}),E.jsx("path",{d:"M14 6v5.166l1.866 1.866c.087-.33.134-.675.134-1.032V6a4 4 0 0 0-7.928-.762L10 7.166V6a2 2 0 1 1 4 0Zm3.417 8.583 1.477 1.477A7.963 7.963 0 0 0 20 12a1 1 0 1 0-2 0c0 .925-.21 1.8-.583 2.583Z"})]})}uJ.displayName="MicOffIcon";const J2e=_.forwardRef(uJ);function dJ(e,t){return E.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:t,...e,children:[E.jsx("path",{d:"M8 6a4 4 0 1 1 8 0v6a4 4 0 0 1-8 0V6Z"}),E.jsx("path",{d:"M5 11a1 1 0 0 1 1 1 6 6 0 0 0 12 0 1 1 0 1 1 2 0 8.001 8.001 0 0 1-7 7.938V21a1 1 0 1 1-2 0v-1.062A8.001 8.001 0 0 1 4 12a1 1 0 0 1 1-1Z"})]})}dJ.displayName="MicOnSolidIcon";const q6=_.forwardRef(dJ);function fJ(e,t){return E.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:t,...e,children:E.jsx("path",{d:"M3.5 3.5a1 1 0 1 0-1.414 1.414l4.113 4.114a5.484 5.484 0 0 0-.184 1.069A5.002 5.002 0 0 0 7 20h10.172l1.914 1.914A1 1 0 0 0 20.5 20.5l-.979-.979.004-.002L7.145 7.14l-.002.004L3.5 3.5Zm18.5 12a4.48 4.48 0 0 1-.928 2.738L8.637 5.803A5.474 5.474 0 0 1 11.5 5a5.49 5.49 0 0 1 4.25 2.008 4 4 0 0 1 4.187 4.708A4.497 4.497 0 0 1 22 15.5Z"})})}fJ.displayName="OfflineIcon";const X2e=_.forwardRef(fJ);function hJ(e,t){return E.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:t,...e,children:E.jsx("path",{d:"M6 14c-.55 0-1.02-.196-1.412-.588A1.926 1.926 0 0 1 4 12c0-.55.196-1.02.588-1.412A1.926 1.926 0 0 1 6 10c.55 0 1.02.196 1.412.588.392.391.588.862.588 1.412 0 .55-.196 1.02-.588 1.412A1.926 1.926 0 0 1 6 14Zm6 0c-.55 0-1.02-.196-1.412-.588A1.926 1.926 0 0 1 10 12c0-.55.196-1.02.588-1.412A1.926 1.926 0 0 1 12 10c.55 0 1.02.196 1.412.588.392.391.588.862.588 1.412 0 .55-.196 1.02-.588 1.412A1.926 1.926 0 0 1 12 14Zm6 0c-.55 0-1.02-.196-1.413-.588A1.926 1.926 0 0 1 16 12c0-.55.196-1.02.587-1.412A1.926 1.926 0 0 1 18 10c.55 0 1.02.196 1.413.588.391.391.587.862.587 1.412 0 .55-.196 1.02-.587 1.412A1.926 1.926 0 0 1 18 14Z"})})}hJ.displayName="OverflowHorizontalIcon";const Z2e=_.forwardRef(hJ);function pJ(e,t){return E.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:t,...e,children:[E.jsx("path",{d:"M5 3h6a1 1 0 1 1 0 2H5v14h14v-6a1 1 0 1 1 2 0v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2Z"}),E.jsx("path",{d:"M15 3h5a1 1 0 0 1 1 1v5a1 1 0 1 1-2 0V6.414l-6.293 6.293a1 1 0 0 1-1.414-1.414L17.586 5H15a1 1 0 1 1 0-2Z"})]})}pJ.displayName="PopOutIcon";const mJ=_.forwardRef(pJ);function gJ(e,t){return E.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:t,...e,children:E.jsx("path",{d:"M11 3a1 1 0 1 1 2 0v8.5a.5.5 0 0 0 1 0V4a1 1 0 1 1 2 0v10.2l3.284-2.597a1.081 1.081 0 0 1 1.47 1.577c-.613.673-1.214 1.367-1.818 2.064-1.267 1.463-2.541 2.934-3.944 4.235A6 6 0 0 1 5 15V7a1 1 0 0 1 2 0v5.5a.5.5 0 0 0 1 0V4a1 1 0 0 1 2 0v7.5a.5.5 0 0 0 1 0V3Z"})})}gJ.displayName="RaisedHandSolidIcon";const vJ=_.forwardRef(gJ);function yJ(e,t){return E.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:t,...e,children:E.jsx("path",{fillRule:"evenodd",d:"M12 22c5.523 0 10-4.477 10-10S17.523 2 12 2 2 6.477 2 12s4.477 10 10 10Zm3.536-6.464a1 1 0 0 0-1.415-1.415A2.988 2.988 0 0 1 12 15a2.988 2.988 0 0 1-2.121-.879 1 1 0 1 0-1.414 1.415A4.987 4.987 0 0 0 12 17c1.38 0 2.632-.56 3.536-1.464ZM10 10.5a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0Zm5.5 1.5a1.5 1.5 0 1 0 0-3 1.5 1.5 0 0 0 0 3Z",clipRule:"evenodd"})})}yJ.displayName="ReactionSolidIcon";const Q2e=_.forwardRef(yJ);function _J(e,t){return E.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:t,...e,children:E.jsx("path",{d:"M12.731 2C13.432 2 14 2.568 14 3.269c0 .578.396 1.074.935 1.286.085.034.17.07.253.106.531.23 1.162.16 1.572-.25a1.269 1.269 0 0 1 1.794 0l1.034 1.035a1.269 1.269 0 0 1 0 1.794c-.41.41-.48 1.04-.248 1.572.036.084.07.168.105.253.212.539.708.935 1.286.935.701 0 1.269.568 1.269 1.269v1.462c0 .701-.568 1.269-1.269 1.269-.578 0-1.074.396-1.287.935-.033.085-.068.17-.104.253-.232.531-.161 1.162.248 1.572a1.269 1.269 0 0 1 0 1.794l-1.034 1.034a1.269 1.269 0 0 1-1.794 0c-.41-.41-1.04-.48-1.572-.248a7.935 7.935 0 0 1-.253.105c-.539.212-.935.708-.935 1.286 0 .701-.568 1.269-1.269 1.269H11.27c-.702 0-1.27-.568-1.27-1.269 0-.578-.396-1.074-.935-1.287a7.975 7.975 0 0 1-.253-.104c-.531-.232-1.162-.161-1.572.248a1.269 1.269 0 0 1-1.794 0l-1.034-1.034a1.269 1.269 0 0 1 0-1.794c.41-.41.48-1.04.249-1.572a7.89 7.89 0 0 1-.106-.253C4.343 14.396 3.847 14 3.27 14 2.568 14 2 13.432 2 12.731V11.27c0-.702.568-1.27 1.269-1.27.578 0 1.074-.396 1.286-.935.034-.085.07-.17.106-.253.23-.531.16-1.162-.25-1.572a1.269 1.269 0 0 1 0-1.794l1.035-1.034a1.269 1.269 0 0 1 1.794 0c.41.41 1.04.48 1.572.249a7.93 7.93 0 0 1 .253-.106c.539-.212.935-.708.935-1.286C10 2.568 10.568 2 11.269 2h1.462ZM12 16a4 4 0 1 0 0-8 4 4 0 0 0 0 8Z"})})}_J.displayName="SettingsSolidIcon";const eRe=_.forwardRef(_J);function bJ(e,t){return E.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:t,...e,children:E.jsx("path",{d:"M1.288 20.712A.965.965 0 0 0 2 21h20c.283 0 .52-.096.712-.288A.968.968 0 0 0 23 20a.968.968 0 0 0-.288-.712A.968.968 0 0 0 22 19H2a.967.967 0 0 0-.712.288A.968.968 0 0 0 1 20c0 .283.096.52.288.712Zm1.299-3.299A1.926 1.926 0 0 1 2 16V5c0-.55.196-1.02.587-1.413A1.926 1.926 0 0 1 4 3h16c.55 0 1.02.196 1.413.587.39.393.587.863.587 1.413v11c0 .55-.196 1.02-.587 1.413A1.926 1.926 0 0 1 20 18H4c-.55 0-1.02-.196-1.413-.587Zm10.12-10.12a1 1 0 0 0-1.414 0l-2.5 2.5a1 1 0 0 0 1.414 1.414l.793-.793V13a1 1 0 1 0 2 0v-2.586l.793.793a1 1 0 0 0 1.414-1.414l-2.5-2.5Z"})})}bJ.displayName="ShareScreenSolidIcon";const tRe=_.forwardRef(bJ);function SJ(e,t){return E.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:t,...e,children:E.jsx("path",{d:"M12 16a.968.968 0 0 1-.713-.287A.967.967 0 0 1 11 15V7.85L9.125 9.725c-.2.2-.433.3-.7.3-.267 0-.508-.108-.725-.325a.93.93 0 0 1-.288-.712A.977.977 0 0 1 7.7 8.3l3.6-3.6c.1-.1.208-.17.325-.212.117-.042.242-.063.375-.063s.258.02.375.063a.877.877 0 0 1 .325.212l3.6 3.6c.2.2.296.438.287.713a.977.977 0 0 1-.287.687c-.2.2-.438.304-.713.313a.93.93 0 0 1-.712-.288L13 7.85V15c0 .283-.096.52-.287.713A.968.968 0 0 1 12 16Zm-6 4c-.55 0-1.02-.196-1.412-.587A1.926 1.926 0 0 1 4 18v-2c0-.283.096-.52.287-.713A.968.968 0 0 1 5 15c.283 0 .52.096.713.287.191.192.287.43.287.713v2h12v-2a.97.97 0 0 1 .288-.713A.968.968 0 0 1 19 15a.97.97 0 0 1 .712.287c.192.192.288.43.288.713v2c0 .55-.196 1.02-.587 1.413A1.926 1.926 0 0 1 18 20H6Z"})})}SJ.displayName="ShareIcon";const nRe=_.forwardRef(SJ);function EJ(e,t){return E.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:t,...e,children:E.jsx("path",{d:"M5 5h14v8h-5a1 1 0 0 0-1 1v5H5V5Zm10 14v-4h4v4h-4ZM5 21h14a2 2 0 0 0 2-2V5a2 2 0 0 0-2-2H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2Z"})})}EJ.displayName="SpotlightIcon";const rRe=_.forwardRef(EJ);function wJ(e,t){return E.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:t,...e,children:[E.jsx("path",{d:"M16.293 2.293a1 1 0 0 1 1.414 0l2 2a1 1 0 0 1 0 1.414l-2 2a1 1 0 1 1-1.414-1.414L16.586 6H6a2 2 0 0 0-2 2v7a1 1 0 1 1-2 0V8a4 4 0 0 1 4-4h10.586l-.293-.293a1 1 0 0 1 0-1.414ZM18 18H7.414l.293-.293a1 1 0 1 0-1.414-1.414l-2 2a1 1 0 0 0 0 1.414l2 2a1 1 0 0 0 1.414-1.414L7.414 20H18a4 4 0 0 0 4-4V9a1 1 0 1 0-2 0v7a2 2 0 0 1-2 2Z"}),E.jsx("path",{d:"M12 15a3 3 0 1 0 0-6 3 3 0 0 0 0 6Z"})]})}wJ.displayName="SwitchCameraSolidIcon";const iRe=_.forwardRef(wJ);function CJ(e,t){return E.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:t,...e,children:E.jsx("path",{d:"M12.999 13.011v-.004.005Zm-9.412 7.402C3.98 20.803 4.45 21 5 21h14c.55 0 1.02-.196 1.413-.587A1.93 1.93 0 0 0 21 19V5c0-.55-.196-1.02-.587-1.413A1.926 1.926 0 0 0 19 3H5c-.55 0-1.02.196-1.413.587A1.926 1.926 0 0 0 3 5v14c0 .55.196 1.02.587 1.413ZM12 9a1 1 0 0 0-1 1 1 1 0 1 1-2 0 3 3 0 1 1 4.44 2.633 1.404 1.404 0 0 0-.383.288.3.3 0 0 0-.057.085A1 1 0 0 1 11 13c0-.58.253-1.047.539-1.38.281-.33.63-.572.94-.742A1 1 0 0 0 12 9Zm1 7a1 1 0 1 1-2 0 1 1 0 0 1 2 0Z"})})}CJ.displayName="UnknownSolidIcon";const sRe=_.forwardRef(CJ);function TJ(e,t){return E.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:t,...e,children:E.jsx("path",{d:"M10 12c-1.1 0-2.042-.392-2.825-1.175C6.392 10.042 6 9.1 6 8s.392-2.042 1.175-2.825C7.958 4.392 8.9 4 10 4s2.042.392 2.825 1.175C13.608 5.958 14 6.9 14 8s-.392 2.042-1.175 2.825C12.042 11.608 11.1 12 10 12Zm-8 6v-.8c0-.567.146-1.087.438-1.563A2.911 2.911 0 0 1 3.6 14.55a14.843 14.843 0 0 1 3.15-1.163A13.76 13.76 0 0 1 10 13c1.1 0 2.183.13 3.25.387 1.067.259 2.117.646 3.15 1.163.483.25.87.612 1.163 1.087.291.476.437.996.437 1.563v.8c0 .55-.196 1.02-.587 1.413A1.926 1.926 0 0 1 16 20H4c-.55 0-1.02-.196-1.413-.587A1.926 1.926 0 0 1 2 18Zm2 0h12v-.8a.973.973 0 0 0-.5-.85c-.9-.45-1.808-.787-2.725-1.012a11.6 11.6 0 0 0-5.55 0c-.917.225-1.825.562-2.725 1.012a.973.973 0 0 0-.5.85v.8Zm6-8c.55 0 1.02-.196 1.412-.588C11.804 9.021 12 8.55 12 8c0-.55-.196-1.02-.588-1.412A1.926 1.926 0 0 0 10 6c-.55 0-1.02.196-1.412.588A1.926 1.926 0 0 0 8 8c0 .55.196 1.02.588 1.412.391.392.862.588 1.412.588Zm7 1h2v2c0 .283.096.52.288.713.191.191.429.287.712.287s.52-.096.712-.287A.968.968 0 0 0 21 13v-2h2a.97.97 0 0 0 .712-.287A.968.968 0 0 0 24 10a.967.967 0 0 0-.288-.713A.968.968 0 0 0 23 9h-2V7a.967.967 0 0 0-.288-.713A.968.968 0 0 0 20 6a.968.968 0 0 0-.712.287A.967.967 0 0 0 19 7v2h-2a.968.968 0 0 0-.712.287A.967.967 0 0 0 16 10c0 .283.096.52.288.713A.968.968 0 0 0 17 11Z"})})}TJ.displayName="UserAddIcon";const oRe=_.forwardRef(TJ);function RJ(e,t){return E.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:t,...e,children:[E.jsx("path",{d:"M9.175 13.825C9.958 14.608 10.9 15 12 15s2.042-.392 2.825-1.175C15.608 13.042 16 12.1 16 11s-.392-2.042-1.175-2.825C14.042 7.392 13.1 7 12 7s-2.042.392-2.825 1.175C8.392 8.958 8 9.9 8 11s.392 2.042 1.175 2.825Zm4.237-1.412A1.926 1.926 0 0 1 12 13c-.55 0-1.02-.196-1.412-.588A1.926 1.926 0 0 1 10 11c0-.55.196-1.02.588-1.412A1.926 1.926 0 0 1 12 9c.55 0 1.02.196 1.412.588.392.391.588.862.588 1.412 0 .55-.196 1.02-.588 1.412Z"}),E.jsx("path",{d:"M22 12c0 5.523-4.477 10-10 10S2 17.523 2 12 6.477 2 12 2s10 4.477 10 10Zm-2 0a8 8 0 1 0-16 0 8 8 0 0 0 16 0Z"}),E.jsx("path",{d:"M16.23 18.792a12.47 12.47 0 0 0-1.455-.455 11.6 11.6 0 0 0-5.55 0c-.487.12-.972.271-1.455.455a8.04 8.04 0 0 1-1.729-1.454c.89-.412 1.794-.729 2.709-.95A13.76 13.76 0 0 1 12 16c1.1 0 2.183.13 3.25.387a14.78 14.78 0 0 1 2.709.95 8.042 8.042 0 0 1-1.73 1.455Z"})]})}RJ.displayName="UserProfileIcon";const IJ=_.forwardRef(RJ);function kJ(e,t){return E.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:t,...e,children:E.jsx("path",{d:"M2.747 2.753 4.35 4.355l.007-.003L18 17.994v.012l3.247 3.247a1 1 0 0 1-1.414 1.414l-2.898-2.898A1.992 1.992 0 0 1 16 20H6a4 4 0 0 1-4-4V8c0-.892.292-1.715.785-2.38L1.333 4.166a1 1 0 0 1 1.414-1.414ZM18 15.166 6.834 4H16a2 2 0 0 1 2 2v4.286l3.35-2.871a1 1 0 0 1 1.65.76v7.65a1 1 0 0 1-1.65.76L18 13.715v1.45Z"})})}kJ.displayName="VideoCallOffSolidIcon";const aRe=_.forwardRef(kJ);function xJ(e,t){return E.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:t,...e,children:E.jsx("path",{d:"M6 4h10a2 2 0 0 1 2 2v4.286l3.35-2.871a1 1 0 0 1 1.65.76v7.65a1 1 0 0 1-1.65.76L18 13.715V18a2 2 0 0 1-2 2H6a4 4 0 0 1-4-4V8a4 4 0 0 1 4-4Z"})})}xJ.displayName="VideoCallSolidIcon";const PJ=_.forwardRef(xJ);function LJ(e,t){return E.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:t,...e,children:E.jsx("path",{d:"M3.5 3.5a1 1 0 1 0-1.414 1.414L5.172 8H5a2 2 0 0 0-2 2v4a2 2 0 0 0 2 2h2l3.293 3.293c.63.63 1.707.184 1.707-.707v-3.758l7.086 7.086A1 1 0 0 0 20.5 20.5l-2.136-2.136.003-.003-1.414-1.414-.003.003-1.414-1.414.003-.003-1.415-1.415-.002.003L12 12v-.006L7.503 7.497 7.5 7.5l-4-4Zm11.496 8.662 1.661 1.66c.222-.564.343-1.18.343-1.822 0-1.38-.56-2.632-1.464-3.536a1 1 0 1 0-1.414 1.414 2.987 2.987 0 0 1 .874 2.284Zm3.164 3.164 1.462 1.462A8.961 8.961 0 0 0 21 12a8.975 8.975 0 0 0-2.636-6.364A1 1 0 0 0 16.95 7.05 6.975 6.975 0 0 1 19 12a6.966 6.966 0 0 1-.84 3.326ZM8.917 6.083 12 9.166V5.414c0-.89-1.077-1.337-1.707-.707L8.917 6.083Z"})})}LJ.displayName="VolumeOffSolidIcon";const lRe=_.forwardRef(LJ);function OJ(e,t){return E.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:t,...e,children:E.jsx("path",{d:"m3.5 3.5 4 4 .003-.003L8.917 8.91l-.003.003L10 10v-.006l2 2V12l2.122 2.121.002-.003 1.415 1.415-.003.003 1.414 1.414.003-.003 1.414 1.414-.003.003L20.5 20.5a1 1 0 0 1-1.414 1.414L12 14.828v3.758c0 .89-1.077 1.337-1.707.707L7 16H5a2 2 0 0 1-2-2v-4a2 2 0 0 1 2-2h.172L2.086 4.914A1 1 0 0 1 3.5 3.5ZM7.172 10H5v4h2.828L10 16.17v-3.343L7.172 10Zm7.824 2.162 1.661 1.66c.222-.564.343-1.18.343-1.822 0-1.38-.56-2.632-1.464-3.536a1 1 0 1 0-1.414 1.414 2.987 2.987 0 0 1 .874 2.284Zm3.164 3.164 1.462 1.462A8.961 8.961 0 0 0 21 12a8.975 8.975 0 0 0-2.636-6.364A1 1 0 0 0 16.95 7.05 6.975 6.975 0 0 1 19 12a6.966 6.966 0 0 1-.84 3.326ZM8.917 6.083 12 9.166V5.414c0-.89-1.077-1.337-1.707-.707L8.917 6.083Z"})})}OJ.displayName="VolumeOffIcon";const cRe=_.forwardRef(OJ);function MJ(e,t){return E.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:t,...e,children:[E.jsx("path",{d:"M3 10a2 2 0 0 1 2-2h2l3.293-3.293c.63-.63 1.707-.184 1.707.707v13.172c0 .89-1.077 1.337-1.707.707L7 16H5a2 2 0 0 1-2-2v-4Zm4.828 4L10 16.172V7.828L7.828 10H5v4h2.828Zm6.293-5.536a1 1 0 0 1 1.415 0A4.988 4.988 0 0 1 17 12c0 1.38-.56 2.632-1.464 3.535a1 1 0 1 1-1.415-1.414 2.987 2.987 0 0 0 .88-2.121c0-.829-.335-1.578-.88-2.122a1 1 0 0 1 0-1.414Z"}),E.jsx("path",{d:"M18.364 5.636A1 1 0 1 0 16.95 7.05 6.975 6.975 0 0 1 19 12a6.975 6.975 0 0 1-2.05 4.95 1 1 0 0 0 1.414 1.414A8.975 8.975 0 0 0 21 12a8.975 8.975 0 0 0-2.636-6.364Z"})]})}MJ.displayName="VolumeOnIcon";const uRe=_.forwardRef(MJ);function AJ(e,t){return E.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:t,...e,children:E.jsx("path",{d:"M4 20c-.55 0-1.02-.196-1.413-.587A1.926 1.926 0 0 1 2 18V6c0-.55.196-1.02.587-1.412A1.926 1.926 0 0 1 4 4h16c.55 0 1.02.196 1.413.588.391.391.587.862.587 1.412v12c0 .55-.196 1.02-.587 1.413A1.926 1.926 0 0 1 20 20H4Zm0-2h16V8H4v10Z"})})}AJ.displayName="WebBrowserIcon";const dRe=_.forwardRef(AJ),fRe="_header_p1omj_8",hRe="_nav_p1omj_18",pRe="_headerLogo_p1omj_26",mRe="_leftNav_p1omj_33",gRe="_hideMobile_p1omj_33",vRe="_rightNav_p1omj_45",yRe="_roomHeaderInfo_p1omj_61",_Re="_roomAvatar_p1omj_76",bRe="_nameLine_p1omj_81",SRe="_participantsLine_p1omj_100",Vs={header:fRe,nav:hRe,headerLogo:pRe,leftNav:mRe,hideMobile:gRe,rightNav:vRe,roomHeaderInfo:yRe,roomAvatar:_Re,nameLine:bRe,participantsLine:SRe},ERe=(e,t)=>_.createElement("svg",{width:260,height:30,viewBox:"0 0 260 30",fill:"none",xmlns:"http://www.w3.org/2000/svg",ref:t,...e},_.createElement("desc",null,"Element Call (Beta)"),_.createElement("circle",{cx:15,cy:15,r:13,fill:"white"}),_.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M15 30C23.2843 30 30 23.2843 30 15C30 6.71573 23.2843 0 15 0C6.71573 0 0 6.71573 0 15C0 23.2843 6.71573 30 15 30ZM12.2579 6.98923C12.2579 6.38376 12.7497 5.89292 13.3565 5.89292C17.4687 5.89292 20.8024 9.21967 20.8024 13.3234C20.8024 13.9289 20.3106 14.4197 19.7038 14.4197C19.0971 14.4197 18.6052 13.9289 18.6052 13.3234C18.6052 10.4306 16.2553 8.08554 13.3565 8.08554C12.7497 8.08554 12.2579 7.59471 12.2579 6.98923ZM24.1066 13.3235C24.1066 12.7181 23.6148 12.2272 23.008 12.2272C22.4013 12.2272 21.9094 12.7181 21.9094 13.3235C21.9094 16.2163 19.5595 18.5614 16.6607 18.5614C16.0539 18.5614 15.5621 19.0523 15.5621 19.6577C15.5621 20.2632 16.0539 20.754 16.6607 20.754C20.7729 20.754 24.1066 17.4273 24.1066 13.3235ZM17.7601 23.011C17.7601 23.6164 17.2682 24.1073 16.6615 24.1073C12.5492 24.1073 9.21553 20.7805 9.21553 16.6768C9.21553 16.0713 9.70739 15.5805 10.3141 15.5805C10.9209 15.5805 11.4127 16.0713 11.4127 16.6768C11.4127 19.5696 13.7627 21.9146 16.6615 21.9146C17.2682 21.9146 17.7601 22.4055 17.7601 23.011ZM5.89281 16.6769C5.89281 17.2824 6.38466 17.7732 6.9914 17.7732C7.59813 17.7732 8.08999 17.2824 8.08999 16.6769C8.08999 13.7841 10.4399 11.439 13.3388 11.439C13.9455 11.439 14.4373 10.9482 14.4373 10.3427C14.4373 9.73722 13.9455 9.24639 13.3388 9.24639C9.22647 9.24639 5.89281 12.5731 5.89281 16.6769Z",fill:"#0DBD8B"}),_.createElement("path",{d:"M53.5406 17.258H42.8052C42.932 18.3814 43.3397 19.2782 44.0282 19.9486C44.7167 20.6009 45.6227 20.927 46.746 20.927C47.4889 20.927 48.1593 20.7459 48.7572 20.3835C49.3551 20.0211 49.7809 19.5319 50.0346 18.9159H53.296C52.8611 20.3472 52.0458 21.5068 50.8499 22.3947C49.6722 23.2644 48.2771 23.6992 46.6645 23.6992C44.5627 23.6992 42.8596 23.0016 41.555 21.6065C40.2686 20.2114 39.6254 18.4448 39.6254 16.3068C39.6254 14.2231 40.2776 12.4747 41.5822 11.0614C42.8867 9.64814 44.5718 8.94151 46.6373 8.94151C48.7029 8.94151 50.3698 9.63908 51.6381 11.0342C52.9245 12.4112 53.5677 14.1506 53.5677 16.2524L53.5406 17.258ZM46.6373 11.5778C45.6227 11.5778 44.7801 11.8767 44.1098 12.4747C43.4394 13.0726 43.0226 13.8698 42.8596 14.8663H50.3607C50.2158 13.8698 49.8172 13.0726 49.1649 12.4747C48.5126 11.8767 47.6701 11.5778 46.6373 11.5778Z",fill:"currentColor"}),_.createElement("path",{d:"M55.7934 19.1605V2.9895H59.0276V19.2148C59.0276 19.9396 59.4262 20.302 60.2234 20.302L60.7941 20.2748V23.3459C60.4861 23.4003 60.16 23.4274 59.8157 23.4274C58.4206 23.4274 57.3969 23.0741 56.7446 22.3675C56.1104 21.6609 55.7934 20.5919 55.7934 19.1605Z",fill:"currentColor"}),_.createElement("path",{d:"M75.8563 17.258H65.121C65.2478 18.3814 65.6555 19.2782 66.344 19.9486C67.0325 20.6009 67.9384 20.927 69.0618 20.927C69.8047 20.927 70.4751 20.7459 71.073 20.3835C71.6709 20.0211 72.0967 19.5319 72.3503 18.9159H75.6117C75.1769 20.3472 74.3615 21.5068 73.1657 22.3947C71.988 23.2644 70.5928 23.6992 68.9803 23.6992C66.8785 23.6992 65.1753 23.0016 63.8708 21.6065C62.5843 20.2114 61.9411 18.4448 61.9411 16.3068C61.9411 14.2231 62.5934 12.4747 63.898 11.0614C65.2025 9.64814 66.8875 8.94151 68.9531 8.94151C71.0186 8.94151 72.6855 9.63908 73.9539 11.0342C75.2403 12.4112 75.8835 14.1506 75.8835 16.2524L75.8563 17.258ZM68.9531 11.5778C67.9384 11.5778 67.0959 11.8767 66.4255 12.4747C65.7551 13.0726 65.3384 13.8698 65.1753 14.8663H72.6765C72.5315 13.8698 72.1329 13.0726 71.4806 12.4747C70.8284 11.8767 69.9859 11.5778 68.9531 11.5778Z",fill:"currentColor"}),_.createElement("path",{d:"M90.448 15.274V23.3731H87.2138V14.9207C87.2138 12.7827 86.326 11.7137 84.5503 11.7137C83.59 11.7137 82.82 12.0217 82.2402 12.6377C81.6785 13.2538 81.3977 14.0963 81.3977 15.1653V23.3731H78.1635V9.26764H81.1531V11.1429C81.4973 10.5088 82.0228 9.98333 82.7294 9.5666C83.436 9.14987 84.3148 8.94151 85.3657 8.94151C87.3225 8.94151 88.7358 9.68438 89.6055 11.1701C90.8013 9.68438 92.3958 8.94151 94.3888 8.94151C96.0376 8.94151 97.3059 9.45789 98.1937 10.4907C99.0816 11.5053 99.5255 12.8461 99.5255 14.513V23.3731H96.2913V14.9207C96.2913 12.7827 95.4035 11.7137 93.6278 11.7137C92.6494 11.7137 91.8703 12.0308 91.2905 12.6649C90.7288 13.2809 90.448 14.1506 90.448 15.274Z",fill:"currentColor"}),_.createElement("path",{d:"M115.61 17.258H104.874C105.001 18.3814 105.409 19.2782 106.097 19.9486C106.786 20.6009 107.692 20.927 108.815 20.927C109.558 20.927 110.228 20.7459 110.826 20.3835C111.424 20.0211 111.85 19.5319 112.104 18.9159H115.365C114.93 20.3472 114.115 21.5068 112.919 22.3947C111.741 23.2644 110.346 23.6992 108.734 23.6992C106.632 23.6992 104.929 23.0016 103.624 21.6065C102.338 20.2114 101.694 18.4448 101.694 16.3068C101.694 14.2231 102.347 12.4747 103.651 11.0614C104.956 9.64814 106.641 8.94151 108.706 8.94151C110.772 8.94151 112.439 9.63908 113.707 11.0342C114.994 12.4112 115.637 14.1506 115.637 16.2524L115.61 17.258ZM108.706 11.5778C107.692 11.5778 106.849 11.8767 106.179 12.4747C105.508 13.0726 105.092 13.8698 104.929 14.8663H112.43C112.285 13.8698 111.886 13.0726 111.234 12.4747C110.582 11.8767 109.739 11.5778 108.706 11.5778Z",fill:"currentColor"}),_.createElement("path",{d:"M120.906 9.26764V11.1429C121.232 10.5269 121.767 10.0105 122.51 9.59378C123.271 9.15893 124.186 8.94151 125.255 8.94151C126.922 8.94151 128.208 9.44883 129.114 10.4635C130.038 11.4781 130.5 12.828 130.5 14.513V23.3731H127.266V14.9207C127.266 13.9242 127.03 13.1451 126.559 12.5834C126.106 12.0036 125.409 11.7137 124.467 11.7137C123.434 11.7137 122.619 12.0217 122.021 12.6377C121.441 13.2538 121.151 14.1053 121.151 15.1925V23.3731H117.917V9.26764H120.906Z",fill:"currentColor"}),_.createElement("path",{d:"M139.946 20.4922V23.2915C139.547 23.4003 138.985 23.4546 138.261 23.4546C135.507 23.4546 134.13 22.0685 134.13 19.2964V11.8496H131.982V9.26764H134.13V5.5986H137.364V9.26764H140V11.8496H137.364V18.9702C137.364 20.0755 137.889 20.6281 138.94 20.6281L139.946 20.4922Z",fill:"currentColor"}),_.createElement("path",{d:"M148.304 20.864C146.768 19.184 146 17.056 146 14.48C146 11.904 146.768 9.784 148.304 8.12C149.856 6.44 151.896 5.6 154.424 5.6C156.504 5.6 158.264 6.176 159.704 7.328C161.144 8.48 162.064 10.024 162.464 11.96H160.616C160.28 10.52 159.552 9.376 158.432 8.528C157.312 7.68 155.976 7.256 154.424 7.256C152.44 7.256 150.84 7.92 149.624 9.248C148.424 10.576 147.824 12.32 147.824 14.48C147.824 16.64 148.424 18.384 149.624 19.712C150.84 21.04 152.44 21.704 154.424 21.704C155.976 21.704 157.312 21.28 158.432 20.432C159.552 19.584 160.28 18.44 160.616 17H162.464C162.064 18.936 161.144 20.48 159.704 21.632C158.264 22.784 156.504 23.36 154.424 23.36C151.896 23.36 149.856 22.528 148.304 20.864Z",fill:"currentColor"}),_.createElement("path",{d:"M173.63 17.192C171.438 17.192 169.942 17.24 169.142 17.336C168.358 17.416 167.782 17.552 167.414 17.744C166.758 18.112 166.43 18.704 166.43 19.52C166.43 21.088 167.358 21.872 169.214 21.872C170.638 21.872 171.726 21.552 172.478 20.912C173.246 20.272 173.63 19.416 173.63 18.344V17.192ZM169.022 23.288C167.63 23.288 166.566 22.952 165.83 22.28C165.11 21.592 164.75 20.688 164.75 19.568C164.75 18.832 164.942 18.176 165.326 17.6C165.726 17.024 166.27 16.6 166.958 16.328C167.534 16.104 168.278 15.96 169.19 15.896C170.102 15.816 171.582 15.776 173.63 15.776V14.984C173.63 12.968 172.478 11.96 170.174 11.96C168.19 11.96 167.038 12.768 166.718 14.384H165.062C165.238 13.2 165.742 12.256 166.574 11.552C167.422 10.848 168.646 10.496 170.246 10.496C171.958 10.496 173.23 10.896 174.062 11.696C174.91 12.496 175.334 13.6 175.334 15.008V23H173.702V21.224C172.854 22.6 171.294 23.288 169.022 23.288Z",fill:"currentColor"}),_.createElement("path",{d:"M179.418 20.312V5H181.122V20.12C181.122 20.616 181.202 20.96 181.362 21.152C181.538 21.344 181.85 21.44 182.298 21.44L182.778 21.392V22.952C182.506 23 182.21 23.024 181.89 23.024C180.242 23.024 179.418 22.12 179.418 20.312Z",fill:"currentColor"}),_.createElement("path",{d:"M185.582 20.312V5H187.286V20.12C187.286 20.616 187.366 20.96 187.526 21.152C187.702 21.344 188.014 21.44 188.462 21.44L188.942 21.392V22.952C188.67 23 188.374 23.024 188.054 23.024C186.406 23.024 185.582 22.12 185.582 20.312Z",fill:"currentColor"}),_.createElement("path",{d:"M201 10C201 5.58172 204.582 2 209 2H252C256.418 2 260 5.58172 260 10V20C260 24.4183 256.418 28 252 28H209C204.582 28 201 24.4183 201 20V10Z",fill:"#368BD6"}),_.createElement("path",{d:"M212.076 20H216.492C218.99 20 220.215 18.7269 220.215 17.0277C220.215 15.3764 219.043 14.407 217.882 14.3484V14.2418C218.947 13.9915 219.789 13.2457 219.789 11.9194C219.789 10.2947 218.617 9.09091 216.252 9.09091H212.076V20ZM214.052 18.3487V15.1527H216.231C217.451 15.1527 218.207 15.8984 218.207 16.8732C218.207 17.7415 217.61 18.3487 216.178 18.3487H214.052ZM214.052 13.7305V10.7209H216.05C217.211 10.7209 217.813 11.3335 217.813 12.1751C217.813 13.1339 217.035 13.7305 216.007 13.7305H214.052ZM221.934 20H229.072V18.3434H223.911V15.3658H228.662V13.7092H223.911V10.7475H229.03V9.09091H221.934V20ZM230.566 10.7475H233.938V20H235.898V10.7475H239.27V9.09091H230.566V10.7475ZM241.031 20L241.931 17.31H246.032L246.938 20H249.047L245.201 9.09091H242.762L238.921 20H241.031ZM242.464 15.7227L243.939 11.3281H244.024L245.5 15.7227H242.464Z",fill:"white"})),wRe=_.forwardRef(ERe);var Xp=(e=>(e.XS="xs",e.SM="sm",e.MD="md",e.LG="lg",e.XL="xl",e))(Xp||{});const CRe=new Map([["xs",22],["sm",32],["md",36],["lg",42],["xl",90]]);function TRe(e,t,n=96){const r=Math.floor(n*window.devicePixelRatio),i=Math.floor(n*window.devicePixelRatio),o=n<=96?"crop":"scale";return t?e.mxcUrlToHttp(t,r,i,o,!1,!0,!0):null}const Zp=({className:e,id:t,name:n,src:r,size:i="md",style:o,...s})=>{const a=nm(),l=_.useMemo((()=>Object.values(Xp).includes(i)?CRe.get(i):i),[i]),[c,u]=_.useState(void 0);return _.useEffect((()=>{if("valid"!==(null==a?void 0:a.state))return;const{authenticated:e,supportedFeatures:t}=a,n=null==e?void 0:e.client;if(!(n&&r&&l&&t.thumbnails))return;const i=n.getAccessToken();if(!i)return;const o=TRe(n,r,l);if(!o)return void u(void 0);let s;return fetch(o,{headers:{Authorization:`Bearer ${i}`}}).then((async e=>e.blob())).then((e=>{s=URL.createObjectURL(e),u(s)})).catch((e=>{u(void 0)})),()=>{s&&URL.revokeObjectURL(s)}}),[a,r,l]),E.jsx(lbe,{className:e,id:t,name:n,size:`${l}px`,src:c,style:o,...s})},RRe="_lock_zf62g_8",IRe={lock:RRe},kRe=({encrypted:e})=>{const{t}=ze(),n=e?Y2e:z2e,r=t(e?"common.encrypted":"common.unencrypted");return E.jsx(ui,{label:r,placement:"right",isTriggerInteractive:!1,children:E.jsx(n,{width:16,height:16,className:IRe.lock,"data-encrypted":e})})};function ov(e,t,n,r){_.useEffect((()=>{if(e)return e.addEventListener(t,n,r),()=>e.removeEventListener(t,n,r)}),[e,t,n,r])}function Ew(e,t,n){_.useEffect((()=>(e.on(t,n),()=>{e.off(t,n)})),[e,t,n])}function ww(e){const t=_.useMemo((()=>window.matchMedia(e)),[e]),[n,r]=_.useState(0);return ov(t,"change",_.useCallback((()=>r((e=>e+1))),[r])),_.useMemo((()=>t.matches),[t,n])}const Pu=_.forwardRef((({children:e,className:t,...n},r)=>E.jsx("header",{ref:r,className:Ae(Vs.header,t),...n,children:e})));Pu.displayName="Header";const sf=({children:e,className:t,hideMobile:n,...r})=>E.jsx("div",{className:Ae(Vs.nav,Vs.leftNav,{[Vs.hideMobile]:n},t),...r,children:e}),of=({children:e,className:t,hideMobile:n,...r})=>E.jsx("div",{className:Ae(Vs.nav,Vs.rightNav,{[Vs.hideMobile]:n},t),...r,children:e}),Vd=({className:e})=>{const{t}=ze();return E.jsx(zE,{className:Ae(Vs.headerLogo,e),to:"/","aria-label":t("header_label"),children:E.jsx(wRe,{})})},NJ=({id:e,name:t,avatarUrl:n,encrypted:r,participantCount:i})=>{const{t:o}=ze(),s=ww("(max-width: 550px)")?"sm":"lg";return E.jsxs("div",{className:Vs.roomHeaderInfo,"data-size":s,children:[E.jsx(Zp,{className:Vs.roomAvatar,id:e,name:t,size:"sm"===s?Xp.SM:56,src:n??void 0}),E.jsxs("div",{className:Vs.nameLine,children:[E.jsx(xu,{type:"sm"===s?"body":"heading",size:"sm"===s?"lg":"md",weight:"semibold","data-testid":"roomHeader_roomName",children:t}),E.jsx(kRe,{encrypted:r})]}),(i??0)>0&&E.jsxs("div",{className:Vs.participantsLine,children:[E.jsx(IJ,{width:20,height:20,"aria-label":o("header_participants_label")}),E.jsx(Jt,{as:"span",size:"sm",weight:"medium","data-testid":"roomHeader_participants_count",children:o("participant_count",{count:i??0})})]})]})},xRe="_page_fvtgn_8",PRe="_container_fvtgn_20",LRe="_content_fvtgn_28",LR={page:xRe,container:PRe,content:LRe};var DJ="object"==typeof global&&global&&global.Object===Object&&global,ORe="object"==typeof self&&self&&self.Object===Object&&self,af=DJ||ORe||Function("return this")(),NS=af.Symbol,jJ=Object.prototype,MRe=jJ.hasOwnProperty,ARe=jJ.toString,fg=NS?NS.toStringTag:void 0;function NRe(e){var t=MRe.call(e,fg),n=e[fg];try{e[fg]=void 0;var r=!0}catch{}var i=ARe.call(e);return r&&(t?e[fg]=n:delete e[fg]),i}var DRe=Object.prototype,jRe=DRe.toString;function URe(e){return jRe.call(e)}var FRe="[object Null]",$Re="[object Undefined]",oD=NS?NS.toStringTag:void 0;function qy(e){return null==e?void 0===e?$Re:FRe:oD&&oD in Object(e)?NRe(e):URe(e)}function Qp(e){return null!=e&&"object"==typeof e}var HRe="[object Symbol]";function BRe(e){return"symbol"==typeof e||Qp(e)&&qy(e)==HRe}var hx=Array.isArray,VRe=/\s/;function qRe(e){for(var t=e.length;t--&&VRe.test(e.charAt(t)););return t}var KRe=/^\s+/;function GRe(e){return e&&e.slice(0,qRe(e)+1).replace(KRe,"")}function Bo(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)}var aD=NaN,WRe=/^[-+]0x[0-9a-f]+$/i,zRe=/^0b[01]+$/i,YRe=/^0o[0-7]+$/i,JRe=parseInt;function lD(e){if("number"==typeof e)return e;if(BRe(e))return aD;if(Bo(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=Bo(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=GRe(e);var n=zRe.test(e);return n||YRe.test(e)?JRe(e.slice(2),n?2:8):WRe.test(e)?aD:+e}function UJ(e){return e}var XRe="[object AsyncFunction]",ZRe="[object Function]",QRe="[object GeneratorFunction]",eIe="[object Proxy]";function K6(e){if(!Bo(e))return!1;var t=qy(e);return t==ZRe||t==QRe||t==XRe||t==eIe}var OR=af["__core-js_shared__"],cD=function(){var e=/[^.]+$/.exec(OR&&OR.keys&&OR.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}();function tIe(e){return!!cD&&cD in e}var nIe=Function.prototype,rIe=nIe.toString;function iIe(e){if(null!=e){try{return rIe.call(e)}catch{}try{return e+""}catch{}}return""}var sIe=/[\\^$.*+?()[\]{}|]/g,oIe=/^\[object .+?Constructor\]$/,aIe=Function.prototype,lIe=Object.prototype,cIe=aIe.toString,uIe=lIe.hasOwnProperty,dIe=RegExp("^"+cIe.call(uIe).replace(sIe,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function fIe(e){return!(!Bo(e)||tIe(e))&&(K6(e)?dIe:oIe).test(iIe(e))}function hIe(e,t){return null==e?void 0:e[t]}function G6(e,t){var n=hIe(e,t);return fIe(n)?n:void 0}var uD=Object.create,pIe=function(){function e(){}return function(t){if(!Bo(t))return{};if(uD)return uD(t);e.prototype=t;var n=new e;return e.prototype=void 0,n}}();function mIe(e,t,n){switch(n.length){case 0:return e.call(t);case 1:return e.call(t,n[0]);case 2:return e.call(t,n[0],n[1]);case 3:return e.call(t,n[0],n[1],n[2])}return e.apply(t,n)}function gIe(e,t){var n=-1,r=e.length;for(t||(t=Array(r));++n<r;)t[n]=e[n];return t}var vIe=800,yIe=16,_Ie=Date.now;function bIe(e){var t=0,n=0;return function(){var r=_Ie(),i=yIe-(r-n);if(n=r,i>0){if(++t>=vIe)return arguments[0]}else t=0;return e.apply(void 0,arguments)}}function SIe(e){return function(){return e}}var DS=function(){try{var e=G6(Object,"defineProperty");return e({},"",{}),e}catch{}}(),EIe=DS?function(e,t){return DS(e,"toString",{configurable:!0,enumerable:!1,value:SIe(t),writable:!0})}:UJ,wIe=bIe(EIe),CIe=9007199254740991,TIe=/^(?:0|[1-9]\d*)$/;function FJ(e,t){var n=typeof e;return!!(t=t??CIe)&&("number"==n||"symbol"!=n&&TIe.test(e))&&e>-1&&e%1==0&&e<t}function W6(e,t,n){"__proto__"==t&&DS?DS(e,t,{configurable:!0,enumerable:!0,value:n,writable:!0}):e[t]=n}function Cw(e,t){return e===t||e!=e&&t!=t}var RIe=Object.prototype,IIe=RIe.hasOwnProperty;function kIe(e,t,n){var r=e[t];(!IIe.call(e,t)||!Cw(r,n)||void 0===n&&!(t in e))&&W6(e,t,n)}function xIe(e,t,n,r){var i=!n;n||(n={});for(var o=-1,s=t.length;++o<s;){var a=t[o],l=void 0;void 0===l&&(l=e[a]),i?W6(n,a,l):kIe(n,a,l)}return n}var dD=Math.max;function PIe(e,t,n){return t=dD(void 0===t?e.length-1:t,0),function(){for(var r=arguments,i=-1,o=dD(r.length-t,0),s=Array(o);++i<o;)s[i]=r[t+i];i=-1;for(var a=Array(t+1);++i<t;)a[i]=r[i];return a[t]=n(s),mIe(e,this,a)}}function LIe(e,t){return wIe(PIe(e,t,UJ),e+"")}var OIe=9007199254740991;function $J(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=OIe}function z6(e){return null!=e&&$J(e.length)&&!K6(e)}function MIe(e,t,n){if(!Bo(n))return!1;var r=typeof t;return!!("number"==r?z6(n)&&FJ(t,n.length):"string"==r&&t in n)&&Cw(n[t],e)}function AIe(e){return LIe((function(t,n){var r=-1,i=n.length,o=i>1?n[i-1]:void 0,s=i>2?n[2]:void 0;for(o=e.length>3&&"function"==typeof o?(i--,o):void 0,s&&MIe(n[0],n[1],s)&&(o=i<3?void 0:o,i=1),t=Object(t);++r<i;){var a=n[r];a&&e(t,a,r,o)}return t}))}var NIe=Object.prototype;function HJ(e){var t=e&&e.constructor;return e===("function"==typeof t&&t.prototype||NIe)}function DIe(e,t){for(var n=-1,r=Array(e);++n<e;)r[n]=t(n);return r}var jIe="[object Arguments]";function fD(e){return Qp(e)&&qy(e)==jIe}var BJ=Object.prototype,UIe=BJ.hasOwnProperty,FIe=BJ.propertyIsEnumerable,px=fD(function(){return arguments}())?fD:function(e){return Qp(e)&&UIe.call(e,"callee")&&!FIe.call(e,"callee")};function $Ie(){return!1}var VJ="object"==typeof exports&&exports&&!exports.nodeType&&exports,hD=VJ&&"object"==typeof module&&module&&!module.nodeType&&module,HIe=hD&&hD.exports===VJ,pD=HIe?af.Buffer:void 0,BIe=pD?pD.isBuffer:void 0,qJ=BIe||$Ie,VIe="[object Arguments]",qIe="[object Array]",KIe="[object Boolean]",GIe="[object Date]",WIe="[object Error]",zIe="[object Function]",YIe="[object Map]",JIe="[object Number]",XIe="[object Object]",ZIe="[object RegExp]",QIe="[object Set]",eke="[object String]",tke="[object WeakMap]",nke="[object ArrayBuffer]",rke="[object DataView]",ike="[object Float32Array]",ske="[object Float64Array]",oke="[object Int8Array]",ake="[object Int16Array]",lke="[object Int32Array]",cke="[object Uint8Array]",uke="[object Uint8ClampedArray]",dke="[object Uint16Array]",fke="[object Uint32Array]",vn={};function hke(e){return Qp(e)&&$J(e.length)&&!!vn[qy(e)]}function pke(e){return function(t){return e(t)}}vn[ike]=vn[ske]=vn[oke]=vn[ake]=vn[lke]=vn[cke]=vn[uke]=vn[dke]=vn[fke]=!0,vn[VIe]=vn[qIe]=vn[nke]=vn[KIe]=vn[rke]=vn[GIe]=vn[WIe]=vn[zIe]=vn[YIe]=vn[JIe]=vn[XIe]=vn[ZIe]=vn[QIe]=vn[eke]=vn[tke]=!1;var KJ="object"==typeof exports&&exports&&!exports.nodeType&&exports,av=KJ&&"object"==typeof module&&module&&!module.nodeType&&module,mke=av&&av.exports===KJ,MR=mke&&DJ.process,mD=function(){try{return av&&av.require&&av.require("util").types||MR&&MR.binding&&MR.binding("util")}catch{}}(),gD=mD&&mD.isTypedArray,GJ=gD?pke(gD):hke;function gke(e,t){var n=hx(e),r=!n&&px(e),i=!n&&!r&&qJ(e),o=!n&&!r&&!i&&GJ(e),s=n||r||i||o,a=s?DIe(e.length,String):[],l=a.length;for(var c in e)s&&("length"==c||i&&("offset"==c||"parent"==c)||o&&("buffer"==c||"byteLength"==c||"byteOffset"==c)||FJ(c,l))||a.push(c);return a}function vke(e,t){return function(n){return e(t(n))}}function yke(e){var t=[];if(null!=e)for(var n in Object(e))t.push(n);return t}var _ke=Object.prototype,bke=_ke.hasOwnProperty;function Ske(e){if(!Bo(e))return yke(e);var t=HJ(e),n=[];for(var r in e)"constructor"==r&&(t||!bke.call(e,r))||n.push(r);return n}function WJ(e){return z6(e)?gke(e):Ske(e)}var zv=G6(Object,"create");function Eke(){this.__data__=zv?zv(null):{},this.size=0}function wke(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t}var Cke="__lodash_hash_undefined__",Tke=Object.prototype,Rke=Tke.hasOwnProperty;function Ike(e){var t=this.__data__;if(zv){var n=t[e];return n===Cke?void 0:n}return Rke.call(t,e)?t[e]:void 0}var kke=Object.prototype,xke=kke.hasOwnProperty;function Pke(e){var t=this.__data__;return zv?void 0!==t[e]:xke.call(t,e)}var Lke="__lodash_hash_undefined__";function Oke(e,t){var n=this.__data__;return this.size+=this.has(e)?0:1,n[e]=zv&&void 0===t?Lke:t,this}function qd(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}function Mke(){this.__data__=[],this.size=0}function Tw(e,t){for(var n=e.length;n--;)if(Cw(e[n][0],t))return n;return-1}qd.prototype.clear=Eke,qd.prototype.delete=wke,qd.prototype.get=Ike,qd.prototype.has=Pke,qd.prototype.set=Oke;var Ake=Array.prototype,Nke=Ake.splice;function Dke(e){var t=this.__data__,n=Tw(t,e);return!(n<0)&&(n==t.length-1?t.pop():Nke.call(t,n,1),--this.size,!0)}function jke(e){var t=this.__data__,n=Tw(t,e);return n<0?void 0:t[n][1]}function Uke(e){return Tw(this.__data__,e)>-1}function Fke(e,t){var n=this.__data__,r=Tw(n,e);return r<0?(++this.size,n.push([e,t])):n[r][1]=t,this}function Vl(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}Vl.prototype.clear=Mke,Vl.prototype.delete=Dke,Vl.prototype.get=jke,Vl.prototype.has=Uke,Vl.prototype.set=Fke;var zJ=G6(af,"Map");function $ke(){this.size=0,this.__data__={hash:new qd,map:new(zJ||Vl),string:new qd}}function Hke(e){var t=typeof e;return"string"==t||"number"==t||"symbol"==t||"boolean"==t?"__proto__"!==e:null===e}function Rw(e,t){var n=e.__data__;return Hke(t)?n["string"==typeof t?"string":"hash"]:n.map}function Bke(e){var t=Rw(this,e).delete(e);return this.size-=t?1:0,t}function Vke(e){return Rw(this,e).get(e)}function qke(e){return Rw(this,e).has(e)}function Kke(e,t){var n=Rw(this,e),r=n.size;return n.set(e,t),this.size+=n.size==r?0:1,this}function em(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}em.prototype.clear=$ke,em.prototype.delete=Bke,em.prototype.get=Vke,em.prototype.has=qke,em.prototype.set=Kke;var YJ=vke(Object.getPrototypeOf,Object),Gke="[object Object]",Wke=Function.prototype,zke=Object.prototype,JJ=Wke.toString,Yke=zke.hasOwnProperty,Jke=JJ.call(Object);function Xke(e){if(!Qp(e)||qy(e)!=Gke)return!1;var t=YJ(e);if(null===t)return!0;var n=Yke.call(t,"constructor")&&t.constructor;return"function"==typeof n&&n instanceof n&&JJ.call(n)==Jke}function Zke(){this.__data__=new Vl,this.size=0}function Qke(e){var t=this.__data__,n=t.delete(e);return this.size=t.size,n}function e3e(e){return this.__data__.get(e)}function t3e(e){return this.__data__.has(e)}var n3e=200;function r3e(e,t){var n=this.__data__;if(n instanceof Vl){var r=n.__data__;if(!zJ||r.length<n3e-1)return r.push([e,t]),this.size=++n.size,this;n=this.__data__=new em(r)}return n.set(e,t),this.size=n.size,this}function tm(e){var t=this.__data__=new Vl(e);this.size=t.size}tm.prototype.clear=Zke,tm.prototype.delete=Qke,tm.prototype.get=e3e,tm.prototype.has=t3e,tm.prototype.set=r3e;var XJ="object"==typeof exports&&exports&&!exports.nodeType&&exports,vD=XJ&&"object"==typeof module&&module&&!module.nodeType&&module,i3e=vD&&vD.exports===XJ,yD=i3e?af.Buffer:void 0;function s3e(e,t){return e.slice()}yD&&yD.allocUnsafe;var _D=af.Uint8Array;function o3e(e){var t=new e.constructor(e.byteLength);return new _D(t).set(new _D(e)),t}function a3e(e,t){var n=o3e(e.buffer);return new e.constructor(n,e.byteOffset,e.length)}function l3e(e){return"function"!=typeof e.constructor||HJ(e)?{}:pIe(YJ(e))}function c3e(e){return function(e,t,n){for(var r=-1,i=Object(e),o=n(e),s=o.length;s--;){var a=o[++r];if(!1===t(i[a],a,i))break}return e}}var u3e=c3e(),AR=function(){return af.Date.now()},d3e="Expected a function",f3e=Math.max,h3e=Math.min;function p3e(e,t,n){var r,i,o,s,a,l,c=0,u=!1,d=!1,h=!0;if("function"!=typeof e)throw new TypeError(d3e);function p(t){var n=r,o=i;return r=i=void 0,c=t,s=e.apply(o,n)}function f(e){var n=e-l;return void 0===l||n>=t||n<0||d&&e-c>=o}function m(){var e=AR();if(f(e))return v(e);a=setTimeout(m,function(e){var n=t-(e-l);return d?h3e(n,o-(e-c)):n}(e))}function v(e){return a=void 0,h&&r?p(e):(r=i=void 0,s)}function g(){var e=AR(),n=f(e);if(r=arguments,i=this,l=e,n){if(void 0===a)return function(e){return c=e,a=setTimeout(m,t),u?p(e):s}(l);if(d)return clearTimeout(a),a=setTimeout(m,t),p(l)}return void 0===a&&(a=setTimeout(m,t)),s}return t=lD(t)||0,Bo(n)&&(u=!!n.leading,o=(d="maxWait"in n)?f3e(lD(n.maxWait)||0,t):o,h="trailing"in n?!!n.trailing:h),g.cancel=function(){void 0!==a&&clearTimeout(a),c=0,r=l=i=a=void 0},g.flush=function(){return void 0===a?s:v(AR())},g}function mx(e,t,n){(void 0!==n&&!Cw(e[t],n)||void 0===n&&!(t in e))&&W6(e,t,n)}function m3e(e){return Qp(e)&&z6(e)}function gx(e,t){if(("constructor"!==t||"function"!=typeof e[t])&&"__proto__"!=t)return e[t]}function g3e(e){return xIe(e,WJ(e))}function v3e(e,t,n,r,i,o,s){var a=gx(e,n),l=gx(t,n),c=s.get(l);if(c)mx(e,n,c);else{var u=o?o(a,l,n+"",e,t,s):void 0,d=void 0===u;if(d){var h=hx(l),p=!h&&qJ(l),f=!h&&!p&&GJ(l);u=l,h||p||f?hx(a)?u=a:m3e(a)?u=gIe(a):p?(d=!1,u=s3e(l)):f?(d=!1,u=a3e(l)):u=[]:Xke(l)||px(l)?(u=a,px(a)?u=g3e(a):(!Bo(a)||K6(a))&&(u=l3e(l))):d=!1}d&&(s.set(l,u),i(u,l,r,o,s),s.delete(l)),mx(e,n,u)}}function ZJ(e,t,n,r,i){e!==t&&u3e(t,(function(o,s){if(i||(i=new tm),Bo(o))v3e(e,t,s,n,ZJ,r,i);else{var a=r?r(gx(e,s),o,s+"",e,t,i):void 0;void 0===a&&(a=o),mx(e,s,a)}}),WJ)}var y3e=AIe((function(e,t,n){ZJ(e,t,n)})),_3e="Expected a function";function b3e(e,t,n){var r=!0,i=!0;if("function"!=typeof e)throw new TypeError(_3e);return Bo(n)&&(r=!("leading"in n)&&r,i="trailing"in n||i),p3e(e,t,{leading:r,maxWait:t,trailing:i})}const vx={default_server_config:{"m.homeserver":{base_url:"http://localhost:8008",server_name:"localhost"}},features:{feature_use_device_session_member_events:!0},ssla:"https://static.element.io/legal/element-software-and-services-license-agreement-uk-1.pdf",media_devices:{enable_audio:!0,enable_video:!0},app_prompt:!0};function Y6(e){return!(e.ok||e.url.startsWith("file:")&&0===e.status)}class Bt{static get(){var e;if(null==(e=this.internalInstance)||!e.config)throw new Error("Config instance read before config got initialized");return this.internalInstance.config}static async init(){var e;if(null==(e=Bt.internalInstance)||!e.initPromise){const e=new Bt;let t;Bt.internalInstance=e,t=window.location.pathname.endsWith("/room/")||window.location.pathname.endsWith("/room")?new URL("/config.json",window.location.href).href:"config.json",Bt.internalInstance.initPromise=S3e(t).then((t=>{e.config=y3e({},vx,t)}))}return Bt.internalInstance.initPromise}static initDefault(){Bt.internalInstance=new Bt,Bt.internalInstance.config={...vx}}static defaultHomeserverUrl(){var e;return Jr().homeserver??(null==(e=Bt.get().default_server_config)?void 0:e["m.homeserver"].base_url)}static defaultServerName(){var e;const t=Jr().homeserver;return t?new URL(t).hostname:null==(e=Bt.get().default_server_config)?void 0:e["m.homeserver"].server_name}}async function S3e(e){const t=await fetch(e);return Y6(t)?vx:t.json()}var Ut=(e=>(e[e.NONE=0]="NONE",e[e.PER_PARTICIPANT=1]="PER_PARTICIPANT",e[e.SHARED_KEY=2]="SHARED_KEY",e))(Ut||{}),QJ=(e=>(e.StartNewCall="start_call",e.JoinExistingCall="join_existing",e.Unknown="unknown",e))(QJ||{});function E3e(e,t){const n=e.indexOf("?"),r=t(new URLSearchParams(-1===n?"":e.substring(n)));return`${e.substring(0,n)}?${r.toString()}`}class eX{constructor(e,t){this.queryParams=new URLSearchParams(e);const n=t.indexOf("?");this.fragmentParams=new URLSearchParams(-1===n?"":t.substring(n))}getParam(e){return this.fragmentParams.get(e)??this.queryParams.get(e)}getAllParams(e){return[...this.fragmentParams.getAll(e),...this.queryParams.getAll(e)]}getFlagParam(e,t=!1){const n=this.getParam(e);return null===n?t:"false"!==n}}const Jr=(e=window.location.search,t=window.location.hash)=>{const n=new eX(e,t),r=parseFloat(n.getParam("fontScale")??"");let i=n.getParam("intent");(!i||!Object.values(QJ).includes(i))&&(i="unknown");const o=n.getParam("widgetId"),s=n.getParam("parentUrl"),a=!!o&&!!s;return{widgetId:o,parentUrl:s,roomId:n.getParam("roomId"),password:n.getParam("password"),confineToRoom:n.getFlagParam("confineToRoom")||n.getFlagParam("embed"),appPrompt:n.getFlagParam("appPrompt",!0),preload:!!a&&n.getFlagParam("preload"),hideHeader:n.getFlagParam("hideHeader"),showControls:n.getFlagParam("showControls",!0),hideScreensharing:n.getFlagParam("hideScreensharing"),e2eEnabled:n.getFlagParam("enableE2EE",!0),userId:a?n.getParam("userId"):null,displayName:n.getParam("displayName"),deviceId:a?n.getParam("deviceId"):null,baseUrl:a?n.getParam("baseUrl"):null,lang:n.getParam("lang"),fonts:n.getAllParams("font"),fontScale:Number.isNaN(r)?null:r,allowIceFallback:n.getFlagParam("allowIceFallback"),perParticipantE2EE:n.getFlagParam("perParticipantE2EE"),skipLobby:n.getFlagParam("skipLobby",a&&"start_call"===i),returnToLobby:!!a&&n.getFlagParam("returnToLobby"),theme:n.getParam("theme"),viaServers:a?null:n.getParam("viaServers"),homeserver:a?null:n.getParam("homeserver"),intent:i,posthogApiHost:n.getParam("posthogApiHost"),posthogApiKey:n.getParam("posthogApiKey"),posthogUserId:n.getParam("posthogUserId")??n.getParam("analyticsID"),rageshakeSubmitUrl:n.getParam("rageshakeSubmitUrl"),sentryDsn:n.getParam("sentryDsn"),sentryEnvironment:n.getParam("sentryEnvironment")}},Lu=()=>{const{search:e,hash:t}=di();return _.useMemo((()=>Jr(e,t)),[e,t])};function w3e(e,t,n){let r=null;const i=(e=e.substring(1)).split("/"),o="room"==i[0],s=i.length>1;""===n||n.startsWith("#?")?(s&&o&&(r=i[1]),o||(r=i[0])):r=n,r=(null==r?void 0:r.split("?")[0])??null,r&&(r.length<=1?r=null:(r.startsWith("#")||(r=`#${r}`),r.includes(":")||(r=`${r}:${Bt.defaultServerName()}`)));const a=new eX(t,n);let l=a.getParam("roomId");return null!=l&&l.startsWith("!")&&l.includes("")||(l=null),{roomAlias:r,roomId:l,viaServers:a.getAllParams("viaServers")}}const C3e=()=>{const{pathname:e,search:t,hash:n}=di();return _.useMemo((()=>w3e(e,t,n)),[e,t,n])};function T3e(e,t,n){const r=new URLSearchParams;switch(null==t?void 0:t.kind){case Ut.SHARED_KEY:{const e=encodeURIComponent(t.secret);e!==t.secret&&A.info("Encoded call password used non URL-safe chars: buggy client?"),r.set("password",e);break}case Ut.PER_PARTICIPANT:r.set("perParticipantE2EE","true")}return r.set("roomId",e),r}const R3e="_rageshakeControl_65ekp_8",bD={rageshakeControl:R3e},SD=5242880,I3e=2e3,k3e=3;class x3e extends xP{constructor(){super(...arguments),this.logs="",this.log=(e,...t)=>{let n=`${(new Date).toISOString()} ${e} ${(t=t.map((e=>e instanceof DOMException?e.message+` (${e.name} | ${e.code})`:e instanceof Error?e.message+(e.stack?`\n${e.stack}`:""):"object"==typeof e?JSON.stringify(e,N3e()):e))).join(" ")}\n`;n=n.replace(/token=[a-zA-Z0-9-]+/gm,"token=xxxxx"),this.logs+=n,this.emit("log")}}popLogs(){const e=this.logs;return this.logs="",e}peekLogs(){return this.logs}}class P3e{constructor(e,t){this.indexedDB=e,this.loggerInstance=t,this.index=0,this.onLoggerLog=()=>{this.db&&this.throttledFlush()},this.throttledFlush=b3e((()=>this.flush),I3e,{leading:!1,trailing:!0}),this.flush=async()=>this.flushPromise?(this.flushAgainPromise||(this.flushAgainPromise=this.flushPromise.then(this.flush).then((()=>{this.flushAgainPromise=void 0}))),this.flushAgainPromise):(this.flushPromise=new Promise(((e,t)=>{if(!this.db)return void t(new Error("No connected database"));const n=this.loggerInstance.popLogs();if(0===n.length)return void e();const r=this.db.transaction(["logs","logslastmod"],"readwrite"),i=r.objectStore("logs");r.oncomplete=()=>{e()},r.onerror=e=>{var n;A.error("Failed to flush logs : ",e),t(new Error("Failed to write logs: "+(null==(n=null==r?void 0:r.error)?void 0:n.message)))},i.add(this.generateLogEntry(n)),r.objectStore("logslastmod").put(this.generateLastModifiedTime())})).then((()=>{this.flushPromise=void 0})),this.flushPromise),this.id="instance-"+_s(16),t.on("log",this.onLoggerLog),window.addEventListener("beforeunload",(()=>{this.flush().catch((e=>A.error("Failed to flush logs before unload",e)))}))}async connect(){const e=this.indexedDB.open("logs");return new Promise(((t,n)=>{e.onsuccess=()=>{this.db=e.result,t()},e.onerror=()=>{var t;const r="Failed to open log database: "+(null==(t=null==e?void 0:e.error)?void 0:t.name);A.error(r),n(new Error(r))},e.onupgradeneeded=()=>{const t=e.result,n=t.createObjectStore("logs",{keyPath:["id","index"]});n.createIndex("id","id",{unique:!1}),n.add(this.generateLogEntry(new Date+" ::: Log database was created.")),t.createObjectStore("logslastmod",{keyPath:"id"}).add(this.generateLastModifiedTime())}}))}async consume(){const e=this.db;if(!e)return Promise.reject(new Error("No connected database"));async function t(t,n){const r=e.transaction("logs","readonly").objectStore("logs");return new Promise(((e,i)=>{const o=r.index("id").openCursor(IDBKeyRange.only(t),"prev");let s="";o.onerror=()=>{var e;i(new Error("Query failed: "+(null==(e=null==o?void 0:o.error)?void 0:e.message)))},o.onsuccess=()=>{const t=o.result;t?(s=t.value.lines+s,s.length>=n?e(s):t.continue()):e(s)}}))}const n=await async function(){return L3e(e.transaction("logslastmod","readonly").objectStore("logslastmod"),void 0,(e=>({id:e.value.id,ts:e.value.ts}))).then((e=>e.sort(((e,t)=>t.ts-e.ts)).map((e=>e.id))))}();let r=[];const i=[];let o=0;for(let e=0;e<n.length;e++){const s=await t(n[e],SD-o);if(i.push({lines:s,id:n[e]}),o+=s.length,o>=SD){r=n.slice(e+1).map((e=>parseInt(e,10)));break}}return r.length>0&&(A.log("Removing logs: ",r),Promise.all(r.map((async t=>async function(t){return new Promise(((n,r)=>{const i=e.transaction(["logs","logslastmod"],"readwrite"),o=i.objectStore("logs"),s=o.index("id").openKeyCursor(IDBKeyRange.only(t));s.onsuccess=()=>{const e=s.result;e&&(o.delete(e.primaryKey),e.continue())},i.oncomplete=()=>{n()},i.onerror=()=>{var e;r(new Error(`Failed to delete logs for '${t}' : ${null==(e=null==i?void 0:i.error)?void 0:e.message}`))},i.objectStore("logslastmod").delete(t)}))}(t)))).then((()=>{A.log(`Removed ${r.length} old logs.`)}),(e=>{A.error(e)}))),i}generateLogEntry(e){return{id:this.id,lines:e,index:this.index++}}generateLastModifiedTime(){return{id:this.id,ts:Date.now()}}}async function L3e(e,t,n){const r=e.openCursor(t);return new Promise(((e,t)=>{const i=[];r.onerror=()=>{var e;t(new Error("Query failed: "+(null==(e=null==r?void 0:r.error)?void 0:e.message)))},r.onsuccess=()=>{const t=r.result;t?(i.push(n(t)),t.continue()):e(i)}}))}async function O3e(){return global.mx_rage_logger=new x3e,D3e(A,global.mx_rage_logger.log),["trace","debug","info","warn","error"].forEach((e=>{const t=window.console[e];if(!t)return;const n=`${e.toUpperCase()} matrix_sdk`;window.console[e]=(...r)=>{t(...r),"string"==typeof r[0]&&r[0].startsWith(n)&&global.mx_rage_logger.log(J6[e],"matrix_sdk",...r)}})),M3e()}async function M3e(){if(global.mx_rage_initStoragePromise)return global.mx_rage_initStoragePromise;let e;A.log("Configuring rageshake persistence...");try{e=window.indexedDB}catch(e){A.warn("Could not get indexDB from window.",e)}return e?(global.mx_rage_store=new P3e(e,global.mx_rage_logger),global.mx_rage_initStoragePromise=global.mx_rage_store.connect(),global.mx_rage_initStoragePromise):(global.mx_rage_initStoragePromise=Promise.resolve(),global.mx_rage_initStoragePromise)}async function A3e(){if(!global.mx_rage_logger)throw new Error("No console logger, did you forget to call init()?");return global.mx_rage_store?(await global.mx_rage_store.flush(),global.mx_rage_store.consume()):[{lines:global.mx_rage_logger.peekLogs(),id:"-"}]}const N3e=()=>{const e=new WeakSet,t=new WeakMap;return function(n,r){if("object"==typeof r&&null!==r){if(e.has(r))return"<$ cycle-trimmed $>";e.add(r);let n=0;if(this&&(n=t.get(this)??0),t.set(r,n+1),n>3)return"<$ object-pruned $>"}return r}};var J6=(e=>(e[e.trace=0]="trace",e[e.debug=1]="debug",e[e.info=2]="info",e[e.warn=3]="warn",e[e.error=4]="error",e[e.silent=5]="silent",e))(J6||{});function D3e(e,t){const n=e,r=n.methodFactory;n.methodFactory=function(e,n,i){const o=r(e,n,i),s=J6[e],a=s>=n&&s<5;return(...e)=>{o.apply(this,e),a&&t(s,null==i?void 0:i.toString(),...e)}},n.setLevel(n.getLevel())}var j3e="object"==typeof globalThis?globalThis:"object"==typeof self?self:"object"==typeof window?window:"object"==typeof global?global:{},yd="1.9.0",ED=/^(\d+)\.(\d+)\.(\d+)(-(.+))?$/;function U3e(e){var t=new Set([e]),n=new Set,r=e.match(ED);if(!r)return function(){return!1};var i=+r[1],o=+r[2],s=+r[3];if(null!=r[4])return function(t){return t===e};function a(e){return n.add(e),!1}function l(e){return t.add(e),!0}return function(e){if(t.has(e))return!0;if(n.has(e))return!1;var r=e.match(ED);if(!r)return a(e);var c=+r[1],u=+r[2],d=+r[3];return null!=r[4]||i!==c?a(e):0===i?o===u&&s<=d?l(e):a(e):o<=u?l(e):a(e)}}var F3e=U3e(yd),$3e=yd.split(".")[0],Yv=Symbol.for("opentelemetry.js.api."+$3e),Jv=j3e;function Iw(e,t,n,r){var i;void 0===r&&(r=!1);var o=Jv[Yv]=null!==(i=Jv[Yv])&&void 0!==i?i:{version:yd};if(!r&&o[e]){var s=new Error("@opentelemetry/api: Attempted duplicate registration of API: "+e);return n.error(s.stack||s.message),!1}if(o.version!==yd){s=new Error("@opentelemetry/api: Registration of version v"+o.version+" for "+e+" does not match previously registered API v"+yd);return n.error(s.stack||s.message),!1}return o[e]=t,n.debug("@opentelemetry/api: Registered a global for "+e+" v"+yd+"."),!0}function Ep(e){var t,n,r=null===(t=Jv[Yv])||void 0===t?void 0:t.version;if(r&&F3e(r))return null===(n=Jv[Yv])||void 0===n?void 0:n[e]}function kw(e,t){t.debug("@opentelemetry/api: Unregistering a global for "+e+" v"+yd+".");var n=Jv[Yv];n&&delete n[e]}var Yn,H3e=function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,i,o=n.call(e),s=[];try{for(;(void 0===t||t-- >0)&&!(r=o.next()).done;)s.push(r.value)}catch(e){i={error:e}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return s},B3e=function(e,t,n){if(n||2===arguments.length)for(var r,i=0,o=t.length;i<o;i++)(r||!(i in t))&&(r||(r=Array.prototype.slice.call(t,0,i)),r[i]=t[i]);return e.concat(r||Array.prototype.slice.call(t))},V3e=function(){function e(e){this._namespace=e.namespace||"DiagComponentLogger"}return e.prototype.debug=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return hg("debug",this._namespace,e)},e.prototype.error=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return hg("error",this._namespace,e)},e.prototype.info=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return hg("info",this._namespace,e)},e.prototype.warn=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return hg("warn",this._namespace,e)},e.prototype.verbose=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return hg("verbose",this._namespace,e)},e}();function hg(e,t,n){var r=Ep("diag");if(r)return n.unshift(t),r[e].apply(r,B3e([],H3e(n),!1))}function q3e(e,t){function n(n,r){var i=t[n];return"function"==typeof i&&e>=r?i.bind(t):function(){}}return e<Yn.NONE?e=Yn.NONE:e>Yn.ALL&&(e=Yn.ALL),t=t||{},{error:n("error",Yn.ERROR),warn:n("warn",Yn.WARN),info:n("info",Yn.INFO),debug:n("debug",Yn.DEBUG),verbose:n("verbose",Yn.VERBOSE)}}!function(e){e[e.NONE=0]="NONE",e[e.ERROR=30]="ERROR",e[e.WARN=50]="WARN",e[e.INFO=60]="INFO",e[e.DEBUG=70]="DEBUG",e[e.VERBOSE=80]="VERBOSE",e[e.ALL=9999]="ALL"}(Yn||(Yn={}));var K3e=function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,i,o=n.call(e),s=[];try{for(;(void 0===t||t-- >0)&&!(r=o.next()).done;)s.push(r.value)}catch(e){i={error:e}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return s},G3e=function(e,t,n){if(n||2===arguments.length)for(var r,i=0,o=t.length;i<o;i++)(r||!(i in t))&&(r||(r=Array.prototype.slice.call(t,0,i)),r[i]=t[i]);return e.concat(r||Array.prototype.slice.call(t))},W3e="diag",bu=function(){function e(){function e(e){return function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];var r=Ep("diag");if(r)return r[e].apply(r,G3e([],K3e(t),!1))}}var t=this;t.setLogger=function(e,n){var r,i,o;if(void 0===n&&(n={logLevel:Yn.INFO}),e===t){var s=new Error("Cannot use diag as the logger for itself. Please use a DiagLogger implementation like ConsoleDiagLogger or a custom implementation");return t.error(null!==(r=s.stack)&&void 0!==r?r:s.message),!1}"number"==typeof n&&(n={logLevel:n});var a=Ep("diag"),l=q3e(null!==(i=n.logLevel)&&void 0!==i?i:Yn.INFO,e);if(a&&!n.suppressOverrideMessage){var c=null!==(o=(new Error).stack)&&void 0!==o?o:"<failed to generate stacktrace>";a.warn("Current logger will be overwritten from "+c),l.warn("Current logger will overwrite one already registered from "+c)}return Iw("diag",l,t,!0)},t.disable=function(){kw(W3e,t)},t.createComponentLogger=function(e){return new V3e(e)},t.verbose=e("verbose"),t.debug=e("debug"),t.info=e("info"),t.warn=e("warn"),t.error=e("error")}return e.instance=function(){return this._instance||(this._instance=new e),this._instance},e}(),z3e=function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,i,o=n.call(e),s=[];try{for(;(void 0===t||t-- >0)&&!(r=o.next()).done;)s.push(r.value)}catch(e){i={error:e}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return s},Y3e=function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},J3e=function(){function e(e){this._entries=e?new Map(e):new Map}return e.prototype.getEntry=function(e){var t=this._entries.get(e);if(t)return Object.assign({},t)},e.prototype.getAllEntries=function(){return Array.from(this._entries.entries()).map((function(e){var t=z3e(e,2);return[t[0],t[1]]}))},e.prototype.setEntry=function(t,n){var r=new e(this._entries);return r._entries.set(t,n),r},e.prototype.removeEntry=function(t){var n=new e(this._entries);return n._entries.delete(t),n},e.prototype.removeEntries=function(){for(var t,n,r=[],i=0;i<arguments.length;i++)r[i]=arguments[i];var o=new e(this._entries);try{for(var s=Y3e(r),a=s.next();!a.done;a=s.next()){var l=a.value;o._entries.delete(l)}}catch(e){t={error:e}}finally{try{a&&!a.done&&(n=s.return)&&n.call(s)}finally{if(t)throw t.error}}return o},e.prototype.clear=function(){return new e},e}(),X3e=Symbol("BaggageEntryMetadata"),Z3e=bu.instance();function Q3e(e){return void 0===e&&(e={}),new J3e(new Map(Object.entries(e)))}function exe(e){return"string"!=typeof e&&(Z3e.error("Cannot create baggage metadata from unknown type: "+typeof e),e=""),{__TYPE__:X3e,toString:function(){return e}}}function X6(e){return Symbol.for(e)}var Ra,txe=function e(t){var n=this;n._currentContext=t?new Map(t):new Map,n.getValue=function(e){return n._currentContext.get(e)},n.setValue=function(t,r){var i=new e(n._currentContext);return i._currentContext.set(t,r),i},n.deleteValue=function(t){var r=new e(n._currentContext);return r._currentContext.delete(t),r}},mh=new txe,nxe={get:function(e,t){if(null!=e)return e[t]},keys:function(e){return null==e?[]:Object.keys(e)}},rxe={set:function(e,t,n){null!=e&&(e[t]=n)}},ixe=function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,i,o=n.call(e),s=[];try{for(;(void 0===t||t-- >0)&&!(r=o.next()).done;)s.push(r.value)}catch(e){i={error:e}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return s},sxe=function(e,t,n){if(n||2===arguments.length)for(var r,i=0,o=t.length;i<o;i++)(r||!(i in t))&&(r||(r=Array.prototype.slice.call(t,0,i)),r[i]=t[i]);return e.concat(r||Array.prototype.slice.call(t))},oxe=function(){function e(){}return e.prototype.active=function(){return mh},e.prototype.with=function(e,t,n){for(var r=[],i=3;i<arguments.length;i++)r[i-3]=arguments[i];return t.call.apply(t,sxe([n],ixe(r),!1))},e.prototype.bind=function(e,t){return t},e.prototype.enable=function(){return this},e.prototype.disable=function(){return this},e}(),axe=function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,i,o=n.call(e),s=[];try{for(;(void 0===t||t-- >0)&&!(r=o.next()).done;)s.push(r.value)}catch(e){i={error:e}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return s},lxe=function(e,t,n){if(n||2===arguments.length)for(var r,i=0,o=t.length;i<o;i++)(r||!(i in t))&&(r||(r=Array.prototype.slice.call(t,0,i)),r[i]=t[i]);return e.concat(r||Array.prototype.slice.call(t))},NR="context",cxe=new oxe,xw=function(){function e(){}return e.getInstance=function(){return this._instance||(this._instance=new e),this._instance},e.prototype.setGlobalContextManager=function(e){return Iw(NR,e,bu.instance())},e.prototype.active=function(){return this._getContextManager().active()},e.prototype.with=function(e,t,n){for(var r,i=[],o=3;o<arguments.length;o++)i[o-3]=arguments[o];return(r=this._getContextManager()).with.apply(r,lxe([e,t,n],axe(i),!1))},e.prototype.bind=function(e,t){return this._getContextManager().bind(e,t)},e.prototype._getContextManager=function(){return Ep(NR)||cxe},e.prototype.disable=function(){this._getContextManager().disable(),kw(NR,bu.instance())},e}();!function(e){e[e.NONE=0]="NONE",e[e.SAMPLED=1]="SAMPLED"}(Ra||(Ra={}));var tX="0000000000000000",nX="00000000000000000000000000000000",rX={traceId:nX,spanId:tX,traceFlags:Ra.NONE},lv=function(){function e(e){void 0===e&&(e=rX),this._spanContext=e}return e.prototype.spanContext=function(){return this._spanContext},e.prototype.setAttribute=function(e,t){return this},e.prototype.setAttributes=function(e){return this},e.prototype.addEvent=function(e,t){return this},e.prototype.addLink=function(e){return this},e.prototype.addLinks=function(e){return this},e.prototype.setStatus=function(e){return this},e.prototype.updateName=function(e){return this},e.prototype.end=function(e){},e.prototype.isRecording=function(){return!1},e.prototype.recordException=function(e,t){},e}(),Z6=X6("OpenTelemetry Context Key SPAN");function Q6(e){return e.getValue(Z6)||void 0}function uxe(){return Q6(xw.getInstance().active())}function e4(e,t){return e.setValue(Z6,t)}function dxe(e){return e.deleteValue(Z6)}function fxe(e,t){return e4(e,new lv(t))}function iX(e){var t;return null===(t=Q6(e))||void 0===t?void 0:t.spanContext()}var hxe=/^([0-9a-f]{32})$/i,pxe=/^[0-9a-f]{16}$/i;function sX(e){return hxe.test(e)&&e!==nX}function mxe(e){return pxe.test(e)&&e!==tX}function Pw(e){return sX(e.traceId)&&mxe(e.spanId)}function gxe(e){return new lv(e)}var DR=xw.getInstance(),oX=function(){function e(){}return e.prototype.startSpan=function(e,t,n){if(void 0===n&&(n=DR.active()),!(null==t||!t.root))return new lv;var r=n&&iX(n);return vxe(r)&&Pw(r)?new lv(r):new lv},e.prototype.startActiveSpan=function(e,t,n,r){var i,o,s;if(!(arguments.length<2)){2===arguments.length?s=t:3===arguments.length?(i=t,s=n):(i=t,o=n,s=r);var a=o??DR.active(),l=this.startSpan(e,i,a),c=e4(a,l);return DR.with(c,s,void 0,l)}},e}();function vxe(e){return"object"==typeof e&&"string"==typeof e.spanId&&"string"==typeof e.traceId&&"number"==typeof e.traceFlags}var jS,yx,_x,yxe=new oX,_xe=function(){function e(e,t,n,r){this._provider=e,this.name=t,this.version=n,this.options=r}return e.prototype.startSpan=function(e,t,n){return this._getTracer().startSpan(e,t,n)},e.prototype.startActiveSpan=function(e,t,n,r){var i=this._getTracer();return Reflect.apply(i.startActiveSpan,i,arguments)},e.prototype._getTracer=function(){if(this._delegate)return this._delegate;var e=this._provider.getDelegateTracer(this.name,this.version,this.options);return e?(this._delegate=e,this._delegate):yxe},e}(),bxe=function(){function e(){}return e.prototype.getTracer=function(e,t,n){return new oX},e}(),Sxe=new bxe,wD=function(){function e(){}return e.prototype.getTracer=function(e,t,n){var r;return null!==(r=this.getDelegateTracer(e,t,n))&&void 0!==r?r:new _xe(this,e,t,n)},e.prototype.getDelegate=function(){var e;return null!==(e=this._delegate)&&void 0!==e?e:Sxe},e.prototype.setDelegate=function(e){this._delegate=e},e.prototype.getDelegateTracer=function(e,t,n){var r;return null===(r=this._delegate)||void 0===r?void 0:r.getTracer(e,t,n)},e}();!function(e){e[e.NOT_RECORD=0]="NOT_RECORD",e[e.RECORD=1]="RECORD",e[e.RECORD_AND_SAMPLED=2]="RECORD_AND_SAMPLED"}(jS||(jS={})),function(e){e[e.INTERNAL=0]="INTERNAL",e[e.SERVER=1]="SERVER",e[e.CLIENT=2]="CLIENT",e[e.PRODUCER=3]="PRODUCER",e[e.CONSUMER=4]="CONSUMER"}(yx||(yx={})),function(e){e[e.UNSET=0]="UNSET",e[e.OK=1]="OK",e[e.ERROR=2]="ERROR"}(_x||(_x={}));var eu=xw.getInstance(),It=bu.instance(),Exe=function(){function e(){}return e.prototype.inject=function(e,t){},e.prototype.extract=function(e,t){return e},e.prototype.fields=function(){return[]},e}(),t4=X6("OpenTelemetry Baggage Key");function aX(e){return e.getValue(t4)||void 0}function wxe(){return aX(xw.getInstance().active())}function Cxe(e,t){return e.setValue(t4,t)}function Txe(e){return e.deleteValue(t4)}var jR="propagation",Rxe=new Exe,Ixe=function(){function e(){this.createBaggage=Q3e,this.getBaggage=aX,this.getActiveBaggage=wxe,this.setBaggage=Cxe,this.deleteBaggage=Txe}return e.getInstance=function(){return this._instance||(this._instance=new e),this._instance},e.prototype.setGlobalPropagator=function(e){return Iw(jR,e,bu.instance())},e.prototype.inject=function(e,t,n){return void 0===n&&(n=rxe),this._getGlobalPropagator().inject(e,t,n)},e.prototype.extract=function(e,t,n){return void 0===n&&(n=nxe),this._getGlobalPropagator().extract(e,t,n)},e.prototype.fields=function(){return this._getGlobalPropagator().fields()},e.prototype.disable=function(){kw(jR,bu.instance())},e.prototype._getGlobalPropagator=function(){return Ep(jR)||Rxe},e}(),wb=Ixe.getInstance(),UR="trace",kxe=function(){function e(){this._proxyTracerProvider=new wD,this.wrapSpanContext=gxe,this.isSpanContextValid=Pw,this.deleteSpan=dxe,this.getSpan=Q6,this.getActiveSpan=uxe,this.getSpanContext=iX,this.setSpan=e4,this.setSpanContext=fxe}return e.getInstance=function(){return this._instance||(this._instance=new e),this._instance},e.prototype.setGlobalTracerProvider=function(e){var t=Iw(UR,this._proxyTracerProvider,bu.instance());return t&&this._proxyTracerProvider.setDelegate(e),t},e.prototype.getTracerProvider=function(){return Ep(UR)||this._proxyTracerProvider},e.prototype.getTracer=function(e,t){return this.getTracerProvider().getTracer(e,t)},e.prototype.disable=function(){kw(UR,bu.instance()),this._proxyTracerProvider=new wD},e}(),xo=kxe.getInstance();const FR={trace:xo};var lX=X6("OpenTelemetry SDK Context Key SUPPRESS_TRACING");function cX(e){return e.setValue(lX,!0)}function n4(e){return!0===e.getValue(lX)}var xxe="=",bx=";",Sx=",",$R="baggage",Pxe=180,Lxe=4096,Oxe=8192,Mxe=function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,i,o=n.call(e),s=[];try{for(;(void 0===t||t-- >0)&&!(r=o.next()).done;)s.push(r.value)}catch(e){i={error:e}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return s};function Axe(e){return e.reduce((function(e,t){var n=""+e+(""!==e?Sx:"")+t;return n.length>Oxe?e:n}),"")}function Nxe(e){return e.getAllEntries().map((function(e){var t=Mxe(e,2),n=t[0],r=t[1],i=encodeURIComponent(n)+"="+encodeURIComponent(r.value);return void 0!==r.metadata&&(i+=bx+r.metadata.toString()),i}))}function Dxe(e){var t=e.split(bx);if(!(t.length<=0)){var n=t.shift();if(n){var r=n.indexOf(xxe);if(!(r<=0)){var i,o=decodeURIComponent(n.substring(0,r).trim()),s=decodeURIComponent(n.substring(r+1).trim());return t.length>0&&(i=exe(t.join(bx))),{key:o,value:s,metadata:i}}}}}var jxe=function(){function e(){}return e.prototype.inject=function(e,t,n){var r=wb.getBaggage(e);if(r&&!n4(e)){var i=Axe(Nxe(r).filter((function(e){return e.length<=Lxe})).slice(0,Pxe));i.length>0&&n.set(t,$R,i)}},e.prototype.extract=function(e,t,n){var r=n.get(t,$R),i=Array.isArray(r)?r.join(Sx):r;if(!i)return e;var o={};return 0===i.length?e:(i.split(Sx).forEach((function(e){var t=Dxe(e);if(t){var n={value:t.value};t.metadata&&(n.metadata=t.metadata),o[t.key]=n}})),0===Object.entries(o).length?e:wb.setBaggage(e,wb.createBaggage(o)))},e.prototype.fields=function(){return[$R]},e}(),uX=function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},Uxe=function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,i,o=n.call(e),s=[];try{for(;(void 0===t||t-- >0)&&!(r=o.next()).done;)s.push(r.value)}catch(e){i={error:e}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return s};function Cb(e){var t,n,r={};if("object"!=typeof e||null==e)return r;try{for(var i=uX(Object.entries(e)),o=i.next();!o.done;o=i.next()){var s=Uxe(o.value,2),a=s[0],l=s[1];Fxe(a)?dX(l)?Array.isArray(l)?r[a]=l.slice():r[a]=l:It.warn("Invalid attribute value set for key: "+a):It.warn("Invalid attribute key: "+a)}}catch(e){t={error:e}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(t)throw t.error}}return r}function Fxe(e){return"string"==typeof e&&e.length>0}function dX(e){return null==e||(Array.isArray(e)?$xe(e):fX(e))}function $xe(e){var t,n,r;try{for(var i=uX(e),o=i.next();!o.done;o=i.next()){var s=o.value;if(null!=s){if(!r){if(fX(s)){r=typeof s;continue}return!1}if(typeof s!==r)return!1}}}catch(e){t={error:e}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(t)throw t.error}}return!0}function fX(e){switch(typeof e){case"number":case"boolean":case"string":return!0}return!1}function Hxe(){return function(e){It.error(Bxe(e))}}function Bxe(e){return"string"==typeof e?e:JSON.stringify(Vxe(e))}function Vxe(e){for(var t={},n=e;null!==n;)Object.getOwnPropertyNames(n).forEach((function(e){if(!t[e]){var r=n[e];r&&(t[e]=String(r))}})),n=Object.getPrototypeOf(n);return t}var ma,qxe=Hxe();function kl(e){try{qxe(e)}catch{}}!function(e){e.AlwaysOff="always_off",e.AlwaysOn="always_on",e.ParentBasedAlwaysOff="parentbased_always_off",e.ParentBasedAlwaysOn="parentbased_always_on",e.ParentBasedTraceIdRatio="parentbased_traceidratio",e.TraceIdRatio="traceidratio"}(ma||(ma={}));var Kxe=",",Gxe=["OTEL_SDK_DISABLED"];function Wxe(e){return Gxe.indexOf(e)>-1}var zxe=["OTEL_BSP_EXPORT_TIMEOUT","OTEL_BSP_MAX_EXPORT_BATCH_SIZE","OTEL_BSP_MAX_QUEUE_SIZE","OTEL_BSP_SCHEDULE_DELAY","OTEL_BLRP_EXPORT_TIMEOUT","OTEL_BLRP_MAX_EXPORT_BATCH_SIZE","OTEL_BLRP_MAX_QUEUE_SIZE","OTEL_BLRP_SCHEDULE_DELAY","OTEL_ATTRIBUTE_VALUE_LENGTH_LIMIT","OTEL_ATTRIBUTE_COUNT_LIMIT","OTEL_SPAN_ATTRIBUTE_VALUE_LENGTH_LIMIT","OTEL_SPAN_ATTRIBUTE_COUNT_LIMIT","OTEL_LOGRECORD_ATTRIBUTE_VALUE_LENGTH_LIMIT","OTEL_LOGRECORD_ATTRIBUTE_COUNT_LIMIT","OTEL_SPAN_EVENT_COUNT_LIMIT","OTEL_SPAN_LINK_COUNT_LIMIT","OTEL_SPAN_ATTRIBUTE_PER_EVENT_COUNT_LIMIT","OTEL_SPAN_ATTRIBUTE_PER_LINK_COUNT_LIMIT","OTEL_EXPORTER_OTLP_TIMEOUT","OTEL_EXPORTER_OTLP_TRACES_TIMEOUT","OTEL_EXPORTER_OTLP_METRICS_TIMEOUT","OTEL_EXPORTER_OTLP_LOGS_TIMEOUT","OTEL_EXPORTER_JAEGER_AGENT_PORT"];function Yxe(e){return zxe.indexOf(e)>-1}var Jxe=["OTEL_NO_PATCH_MODULES","OTEL_PROPAGATORS","OTEL_SEMCONV_STABILITY_OPT_IN"];function Xxe(e){return Jxe.indexOf(e)>-1}var Tb=1/0,Rb=128,Zxe=128,Qxe=128,hX={OTEL_SDK_DISABLED:!1,CONTAINER_NAME:"",ECS_CONTAINER_METADATA_URI_V4:"",ECS_CONTAINER_METADATA_URI:"",HOSTNAME:"",KUBERNETES_SERVICE_HOST:"",NAMESPACE:"",OTEL_BSP_EXPORT_TIMEOUT:3e4,OTEL_BSP_MAX_EXPORT_BATCH_SIZE:512,OTEL_BSP_MAX_QUEUE_SIZE:2048,OTEL_BSP_SCHEDULE_DELAY:5e3,OTEL_BLRP_EXPORT_TIMEOUT:3e4,OTEL_BLRP_MAX_EXPORT_BATCH_SIZE:512,OTEL_BLRP_MAX_QUEUE_SIZE:2048,OTEL_BLRP_SCHEDULE_DELAY:5e3,OTEL_EXPORTER_JAEGER_AGENT_HOST:"",OTEL_EXPORTER_JAEGER_AGENT_PORT:6832,OTEL_EXPORTER_JAEGER_ENDPOINT:"",OTEL_EXPORTER_JAEGER_PASSWORD:"",OTEL_EXPORTER_JAEGER_USER:"",OTEL_EXPORTER_OTLP_ENDPOINT:"",OTEL_EXPORTER_OTLP_TRACES_ENDPOINT:"",OTEL_EXPORTER_OTLP_METRICS_ENDPOINT:"",OTEL_EXPORTER_OTLP_LOGS_ENDPOINT:"",OTEL_EXPORTER_OTLP_HEADERS:"",OTEL_EXPORTER_OTLP_TRACES_HEADERS:"",OTEL_EXPORTER_OTLP_METRICS_HEADERS:"",OTEL_EXPORTER_OTLP_LOGS_HEADERS:"",OTEL_EXPORTER_OTLP_TIMEOUT:1e4,OTEL_EXPORTER_OTLP_TRACES_TIMEOUT:1e4,OTEL_EXPORTER_OTLP_METRICS_TIMEOUT:1e4,OTEL_EXPORTER_OTLP_LOGS_TIMEOUT:1e4,OTEL_EXPORTER_ZIPKIN_ENDPOINT:"http://localhost:9411/api/v2/spans",OTEL_LOG_LEVEL:Yn.INFO,OTEL_NO_PATCH_MODULES:[],OTEL_PROPAGATORS:["tracecontext","baggage"],OTEL_RESOURCE_ATTRIBUTES:"",OTEL_SERVICE_NAME:"",OTEL_ATTRIBUTE_VALUE_LENGTH_LIMIT:Tb,OTEL_ATTRIBUTE_COUNT_LIMIT:Rb,OTEL_SPAN_ATTRIBUTE_VALUE_LENGTH_LIMIT:Tb,OTEL_SPAN_ATTRIBUTE_COUNT_LIMIT:Rb,OTEL_LOGRECORD_ATTRIBUTE_VALUE_LENGTH_LIMIT:Tb,OTEL_LOGRECORD_ATTRIBUTE_COUNT_LIMIT:Rb,OTEL_SPAN_EVENT_COUNT_LIMIT:128,OTEL_SPAN_LINK_COUNT_LIMIT:128,OTEL_SPAN_ATTRIBUTE_PER_EVENT_COUNT_LIMIT:Zxe,OTEL_SPAN_ATTRIBUTE_PER_LINK_COUNT_LIMIT:Qxe,OTEL_TRACES_EXPORTER:"",OTEL_TRACES_SAMPLER:ma.ParentBasedAlwaysOn,OTEL_TRACES_SAMPLER_ARG:"",OTEL_LOGS_EXPORTER:"",OTEL_EXPORTER_OTLP_INSECURE:"",OTEL_EXPORTER_OTLP_TRACES_INSECURE:"",OTEL_EXPORTER_OTLP_METRICS_INSECURE:"",OTEL_EXPORTER_OTLP_LOGS_INSECURE:"",OTEL_EXPORTER_OTLP_CERTIFICATE:"",OTEL_EXPORTER_OTLP_TRACES_CERTIFICATE:"",OTEL_EXPORTER_OTLP_METRICS_CERTIFICATE:"",OTEL_EXPORTER_OTLP_LOGS_CERTIFICATE:"",OTEL_EXPORTER_OTLP_COMPRESSION:"",OTEL_EXPORTER_OTLP_TRACES_COMPRESSION:"",OTEL_EXPORTER_OTLP_METRICS_COMPRESSION:"",OTEL_EXPORTER_OTLP_LOGS_COMPRESSION:"",OTEL_EXPORTER_OTLP_CLIENT_KEY:"",OTEL_EXPORTER_OTLP_TRACES_CLIENT_KEY:"",OTEL_EXPORTER_OTLP_METRICS_CLIENT_KEY:"",OTEL_EXPORTER_OTLP_LOGS_CLIENT_KEY:"",OTEL_EXPORTER_OTLP_CLIENT_CERTIFICATE:"",OTEL_EXPORTER_OTLP_TRACES_CLIENT_CERTIFICATE:"",OTEL_EXPORTER_OTLP_METRICS_CLIENT_CERTIFICATE:"",OTEL_EXPORTER_OTLP_LOGS_CLIENT_CERTIFICATE:"",OTEL_EXPORTER_OTLP_PROTOCOL:"http/protobuf",OTEL_EXPORTER_OTLP_TRACES_PROTOCOL:"http/protobuf",OTEL_EXPORTER_OTLP_METRICS_PROTOCOL:"http/protobuf",OTEL_EXPORTER_OTLP_LOGS_PROTOCOL:"http/protobuf",OTEL_EXPORTER_OTLP_METRICS_TEMPORALITY_PREFERENCE:"cumulative",OTEL_SEMCONV_STABILITY_OPT_IN:[]};function ePe(e,t,n){if(!(typeof n[e]>"u")){var r=String(n[e]);t[e]="true"===r.toLowerCase()}}function tPe(e,t,n,r,i){if(void 0===r&&(r=-1/0),void 0===i&&(i=1/0),typeof n[e]<"u"){var o=Number(n[e]);isNaN(o)||(t[e]=o<r?r:o>i?i:o)}}function nPe(e,t,n,r){void 0===r&&(r=Kxe);var i=n[e];"string"==typeof i&&(t[e]=i.split(r).map((function(e){return e.trim()})))}var rPe={ALL:Yn.ALL,VERBOSE:Yn.VERBOSE,DEBUG:Yn.DEBUG,INFO:Yn.INFO,WARN:Yn.WARN,ERROR:Yn.ERROR,NONE:Yn.NONE};function iPe(e,t,n){var r=n[e];if("string"==typeof r){var i=rPe[r.toUpperCase()];null!=i&&(t[e]=i)}}function pX(e){var t={};for(var n in hX){var r=n;if("OTEL_LOG_LEVEL"===r)iPe(r,t,e);else if(Wxe(r))ePe(r,t,e);else if(Yxe(r))tPe(r,t,e);else if(Xxe(r))nPe(r,t,e);else{var i=e[r];typeof i<"u"&&null!==i&&(t[r]=String(i))}}return t}var mX="object"==typeof globalThis?globalThis:"object"==typeof self?self:"object"==typeof window?window:"object"==typeof global?global:{};function Xv(){var e=pX(mX);return Object.assign({},hX,e)}function sPe(){return pX(mX)}function CD(e){return e>=48&&e<=57?e-48:e>=97&&e<=102?e-87:e-55}function r4(e){for(var t=new Uint8Array(e.length/2),n=0,r=0;r<e.length;r+=2){var i=CD(e.charCodeAt(r)),o=CD(e.charCodeAt(r+1));t[n++]=i<<4|o}return t}var th,Ro,Wh=performance,oPe="1.30.1",aPe="process.runtime.name",lPe="telemetry.sdk.name",cPe="telemetry.sdk.language",uPe="telemetry.sdk.version",dPe=aPe,fPe=lPe,hPe=cPe,pPe=uPe,mPe="webjs",gPe=mPe,HR=((th={})[fPe]="opentelemetry",th[dPe]="browser",th[hPe]=gPe,th[pPe]=oPe,th),vPe=9,yPe=6,_Pe=Math.pow(10,yPe),US=Math.pow(10,vPe);function Th(e){var t=e/1e3;return[Math.trunc(t),Math.round(e%1e3*_Pe)]}function gX(){var e=Wh.timeOrigin;if("number"!=typeof e){var t=Wh;e=t.timing&&t.timing.fetchStart}return e}function bPe(e){return yX(Th(gX()),Th("number"==typeof e?e:Wh.now()))}function SPe(e,t){var n=t[0]-e[0],r=t[1]-e[1];return r<0&&(n-=1,r+=US),[n,r]}function EPe(e){return e[0]*US+e[1]}function TD(e){return 1e3*e[0]+e[1]/1e6}function BR(e){return 1e6*e[0]+e[1]/1e3}function vX(e){return Array.isArray(e)&&2===e.length&&"number"==typeof e[0]&&"number"==typeof e[1]}function RD(e){return vX(e)||"number"==typeof e||e instanceof Date}function yX(e,t){var n=[e[0]+t[0],e[1]+t[1]];return n[1]>=US&&(n[1]-=US,n[0]+=1),n}!function(e){e[e.SUCCESS=0]="SUCCESS",e[e.FAILED=1]="FAILED"}(Ro||(Ro={}));var wPe=function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},CPe=function(){function e(e){var t;void 0===e&&(e={}),this._propagators=null!==(t=e.propagators)&&void 0!==t?t:[],this._fields=Array.from(new Set(this._propagators.map((function(e){return"function"==typeof e.fields?e.fields():[]})).reduce((function(e,t){return e.concat(t)}),[])))}return e.prototype.inject=function(e,t,n){var r,i;try{for(var o=wPe(this._propagators),s=o.next();!s.done;s=o.next()){var a=s.value;try{a.inject(e,t,n)}catch(e){It.warn("Failed to inject with "+a.constructor.name+". Err: "+e.message)}}}catch(e){r={error:e}}finally{try{s&&!s.done&&(i=o.return)&&i.call(o)}finally{if(r)throw r.error}}},e.prototype.extract=function(e,t,n){return this._propagators.reduce((function(e,r){try{return r.extract(e,t,n)}catch(e){It.warn("Failed to extract with "+r.constructor.name+". Err: "+e.message)}return e}),e)},e.prototype.fields=function(){return this._fields.slice()},e}(),Ex="[_0-9a-z-*/]",TPe="[a-z]"+Ex+"{0,255}",RPe="[a-z0-9]"+Ex+"{0,240}@[a-z]"+Ex+"{0,13}",IPe=new RegExp("^(?:"+TPe+"|"+RPe+")$"),kPe=/^[ -~]{0,255}[!-~]$/,xPe=/,|=/;function PPe(e){return IPe.test(e)}function LPe(e){return kPe.test(e)&&!xPe.test(e)}var ID=32,OPe=512,kD=",",xD="=",MPe=function(){function e(e){this._internalState=new Map,e&&this._parse(e)}return e.prototype.set=function(e,t){var n=this._clone();return n._internalState.has(e)&&n._internalState.delete(e),n._internalState.set(e,t),n},e.prototype.unset=function(e){var t=this._clone();return t._internalState.delete(e),t},e.prototype.get=function(e){return this._internalState.get(e)},e.prototype.serialize=function(){var e=this;return this._keys().reduce((function(t,n){return t.push(n+xD+e.get(n)),t}),[]).join(kD)},e.prototype._parse=function(e){e.length>OPe||(this._internalState=e.split(kD).reverse().reduce((function(e,t){var n=t.trim(),r=n.indexOf(xD);if(-1!==r){var i=n.slice(0,r),o=n.slice(r+1,t.length);PPe(i)&&LPe(o)&&e.set(i,o)}return e}),new Map),this._internalState.size>ID&&(this._internalState=new Map(Array.from(this._internalState.entries()).reverse().slice(0,ID))))},e.prototype._keys=function(){return Array.from(this._internalState.keys()).reverse()},e.prototype._clone=function(){var t=new e;return t._internalState=new Map(this._internalState),t},e}(),VR="traceparent",qR="tracestate",APe="00",NPe="(?!ff)[\\da-f]{2}",DPe="(?![0]{32})[\\da-f]{32}",jPe="(?![0]{16})[\\da-f]{16}",UPe="[\\da-f]{2}",FPe=new RegExp("^\\s?("+NPe+")-("+DPe+")-("+jPe+")-("+UPe+")(-.*)?\\s?$");function $Pe(e){var t=FPe.exec(e);return!t||"00"===t[1]&&t[5]?null:{traceId:t[2],spanId:t[3],traceFlags:parseInt(t[4],16)}}var HPe=function(){function e(){}return e.prototype.inject=function(e,t,n){var r=xo.getSpanContext(e);if(r&&!n4(e)&&Pw(r)){var i=APe+"-"+r.traceId+"-"+r.spanId+"-0"+Number(r.traceFlags||Ra.NONE).toString(16);n.set(t,VR,i),r.traceState&&n.set(t,qR,r.traceState.serialize())}},e.prototype.extract=function(e,t,n){var r=n.get(t,VR);if(!r)return e;var i=Array.isArray(r)?r[0]:r;if("string"!=typeof i)return e;var o=$Pe(i);if(!o)return e;o.isRemote=!0;var s=n.get(t,qR);if(s){var a=Array.isArray(s)?s.join(","):s;o.traceState=new MPe("string"==typeof a?a:void 0)}return xo.setSpanContext(e,o)},e.prototype.fields=function(){return[VR,qR]},e}(),BPe="[object Object]",VPe="[object Null]",qPe="[object Undefined]",KPe=Function.prototype,_X=KPe.toString,GPe=_X.call(Object),WPe=zPe(Object.getPrototypeOf,Object),bX=Object.prototype,SX=bX.hasOwnProperty,fd=Symbol?Symbol.toStringTag:void 0,EX=bX.toString;function zPe(e,t){return function(n){return e(t(n))}}function PD(e){if(!YPe(e)||JPe(e)!==BPe)return!1;var t=WPe(e);if(null===t)return!0;var n=SX.call(t,"constructor")&&t.constructor;return"function"==typeof n&&n instanceof n&&_X.call(n)===GPe}function YPe(e){return null!=e&&"object"==typeof e}function JPe(e){return null==e?void 0===e?qPe:VPe:fd&&fd in Object(e)?XPe(e):ZPe(e)}function XPe(e){var t=SX.call(e,fd),n=e[fd],r=!1;try{e[fd]=void 0,r=!0}catch{}var i=EX.call(e);return r&&(t?e[fd]=n:delete e[fd]),i}function ZPe(e){return EX.call(e)}var QPe=20;function eLe(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];for(var n=e.shift(),r=new WeakMap;e.length>0;)n=wX(n,e.shift(),0,r);return n}function KR(e){return FS(e)?e.slice():e}function wX(e,t,n,r){var i;if(void 0===n&&(n=0),!(n>QPe)){if(n++,Ib(e)||Ib(t)||CX(t))i=KR(t);else if(FS(e)){if(i=e.slice(),FS(t))for(var o=0,s=t.length;o<s;o++)i.push(KR(t[o]));else if(pg(t))for(o=0,s=(a=Object.keys(t)).length;o<s;o++){i[l=a[o]]=KR(t[l])}}else if(pg(e))if(pg(t)){if(!tLe(e,t))return t;i=Object.assign({},e);var a;for(o=0,s=(a=Object.keys(t)).length;o<s;o++){var l,c=t[l=a[o]];if(Ib(c))typeof c>"u"?delete i[l]:i[l]=c;else{var u=i[l],d=c;if(LD(e,l,r)||LD(t,l,r))delete i[l];else{if(pg(u)&&pg(d)){var h=r.get(u)||[],p=r.get(d)||[];h.push({obj:e,key:l}),p.push({obj:t,key:l}),r.set(u,h),r.set(d,p)}i[l]=wX(i[l],c,n,r)}}}}else i=t;return i}}function LD(e,t,n){for(var r=n.get(e[t])||[],i=0,o=r.length;i<o;i++){var s=r[i];if(s.key===t&&s.obj===e)return!0}return!1}function FS(e){return Array.isArray(e)}function CX(e){return"function"==typeof e}function pg(e){return!Ib(e)&&!FS(e)&&!CX(e)&&"object"==typeof e}function Ib(e){return"string"==typeof e||"number"==typeof e||"boolean"==typeof e||typeof e>"u"||e instanceof Date||e instanceof RegExp||null===e}function tLe(e,t){return!(!PD(e)||!PD(t))}var nLe=function(){function e(){var e=this;this._promise=new Promise((function(t,n){e._resolve=t,e._reject=n}))}return Object.defineProperty(e.prototype,"promise",{get:function(){return this._promise},enumerable:!1,configurable:!0}),e.prototype.resolve=function(e){this._resolve(e)},e.prototype.reject=function(e){this._reject(e)},e}(),rLe=function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,i,o=n.call(e),s=[];try{for(;(void 0===t||t-- >0)&&!(r=o.next()).done;)s.push(r.value)}catch(e){i={error:e}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return s},iLe=function(e,t,n){if(n||2===arguments.length)for(var r,i=0,o=t.length;i<o;i++)(r||!(i in t))&&(r||(r=Array.prototype.slice.call(t,0,i)),r[i]=t[i]);return e.concat(r||Array.prototype.slice.call(t))},TX=function(){function e(e,t){this._callback=e,this._that=t,this._isCalled=!1,this._deferred=new nLe}return Object.defineProperty(e.prototype,"isCalled",{get:function(){return this._isCalled},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"promise",{get:function(){return this._deferred.promise},enumerable:!1,configurable:!0}),e.prototype.call=function(){for(var e,t=this,n=[],r=0;r<arguments.length;r++)n[r]=arguments[r];if(!this._isCalled){this._isCalled=!0;try{Promise.resolve((e=this._callback).call.apply(e,iLe([this._that],rLe(n),!1))).then((function(e){return t._deferred.resolve(e)}),(function(e){return t._deferred.reject(e)}))}catch(e){this._deferred.reject(e)}}return this._deferred.promise},e}();function sLe(e,t){return new Promise((function(n){eu.with(cX(eu.active()),(function(){e.export(t,(function(e){n(e)}))}))}))}var wp,oLe={_export:sLe},aLe="exception.type",lLe="exception.message",cLe="exception.stacktrace",GR=aLe,WR=lLe,uLe=cLe,dLe="exception",wx=function(){return wx=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},wx.apply(this,arguments)},fLe=function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},OD=function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,i,o=n.call(e),s=[];try{for(;(void 0===t||t-- >0)&&!(r=o.next()).done;)s.push(r.value)}catch(e){i={error:e}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return s},hLe=function(e,t,n){if(n||2===arguments.length)for(var r,i=0,o=t.length;i<o;i++)(r||!(i in t))&&(r||(r=Array.prototype.slice.call(t,0,i)),r[i]=t[i]);return e.concat(r||Array.prototype.slice.call(t))},pLe=function(){function e(e,t,n,r,i,o,s,a,l,c){void 0===s&&(s=[]),this.attributes={},this.links=[],this.events=[],this._droppedAttributesCount=0,this._droppedEventsCount=0,this._droppedLinksCount=0,this.status={code:_x.UNSET},this.endTime=[0,0],this._ended=!1,this._duration=[-1,-1],this.name=n,this._spanContext=r,this.parentSpanId=o,this.kind=i,this.links=s;var u=Date.now();this._performanceStartTime=Wh.now(),this._performanceOffset=u-(this._performanceStartTime+gX()),this._startTimeProvided=null!=a,this.startTime=this._getTime(a??u),this.resource=e.resource,this.instrumentationLibrary=e.instrumentationLibrary,this._spanLimits=e.getSpanLimits(),this._attributeValueLengthLimit=this._spanLimits.attributeValueLengthLimit||0,null!=c&&this.setAttributes(c),this._spanProcessor=e.getActiveSpanProcessor(),this._spanProcessor.onStart(this,t)}return e.prototype.spanContext=function(){return this._spanContext},e.prototype.setAttribute=function(e,t){return null==t||this._isSpanEnded()?this:0===e.length?(It.warn("Invalid attribute key: "+e),this):dX(t)?Object.keys(this.attributes).length>=this._spanLimits.attributeCountLimit&&!Object.prototype.hasOwnProperty.call(this.attributes,e)?(this._droppedAttributesCount++,this):(this.attributes[e]=this._truncateToSize(t),this):(It.warn("Invalid attribute value set for key: "+e),this)},e.prototype.setAttributes=function(e){var t,n;try{for(var r=fLe(Object.entries(e)),i=r.next();!i.done;i=r.next()){var o=OD(i.value,2),s=o[0],a=o[1];this.setAttribute(s,a)}}catch(e){t={error:e}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(t)throw t.error}}return this},e.prototype.addEvent=function(e,t,n){if(this._isSpanEnded())return this;if(0===this._spanLimits.eventCountLimit)return It.warn("No events allowed."),this._droppedEventsCount++,this;this.events.length>=this._spanLimits.eventCountLimit&&(0===this._droppedEventsCount&&It.debug("Dropping extra events."),this.events.shift(),this._droppedEventsCount++),RD(t)&&(RD(n)||(n=t),t=void 0);var r=Cb(t);return this.events.push({name:e,attributes:r,time:this._getTime(n),droppedAttributesCount:0}),this},e.prototype.addLink=function(e){return this.links.push(e),this},e.prototype.addLinks=function(e){var t;return(t=this.links).push.apply(t,hLe([],OD(e),!1)),this},e.prototype.setStatus=function(e){return this._isSpanEnded()||(this.status=wx({},e),null!=this.status.message&&"string"!=typeof e.message&&(It.warn("Dropping invalid status.message of type '"+typeof e.message+"', expected 'string'"),delete this.status.message)),this},e.prototype.updateName=function(e){return this._isSpanEnded()||(this.name=e),this},e.prototype.end=function(e){this._isSpanEnded()?It.error(this.name+" "+this._spanContext.traceId+"-"+this._spanContext.spanId+" - You can only call end() on a span once."):(this._ended=!0,this.endTime=this._getTime(e),this._duration=SPe(this.startTime,this.endTime),this._duration[0]<0&&(It.warn("Inconsistent start and end time, startTime > endTime. Setting span duration to 0ms.",this.startTime,this.endTime),this.endTime=this.startTime.slice(),this._duration=[0,0]),this._droppedEventsCount>0&&It.warn("Dropped "+this._droppedEventsCount+" events because eventCountLimit reached"),this._spanProcessor.onEnd(this))},e.prototype._getTime=function(e){if("number"==typeof e&&e<=Wh.now())return bPe(e+this._performanceOffset);if("number"==typeof e)return Th(e);if(e instanceof Date)return Th(e.getTime());if(vX(e))return e;if(this._startTimeProvided)return Th(Date.now());var t=Wh.now()-this._performanceStartTime;return yX(this.startTime,Th(t))},e.prototype.isRecording=function(){return!1===this._ended},e.prototype.recordException=function(e,t){var n={};"string"==typeof e?n[WR]=e:e&&(e.code?n[GR]=e.code.toString():e.name&&(n[GR]=e.name),e.message&&(n[WR]=e.message),e.stack&&(n[uLe]=e.stack)),n[GR]||n[WR]?this.addEvent(dLe,n,t):It.warn("Failed to record an exception "+e)},Object.defineProperty(e.prototype,"duration",{get:function(){return this._duration},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"ended",{get:function(){return this._ended},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"droppedAttributesCount",{get:function(){return this._droppedAttributesCount},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"droppedEventsCount",{get:function(){return this._droppedEventsCount},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"droppedLinksCount",{get:function(){return this._droppedLinksCount},enumerable:!1,configurable:!0}),e.prototype._isSpanEnded=function(){return this._ended&&It.warn("Can not execute the operation on ended Span {traceId: "+this._spanContext.traceId+", spanId: "+this._spanContext.spanId+"}"),this._ended},e.prototype._truncateToLimitUtil=function(e,t){return e.length<=t?e:e.substring(0,t)},e.prototype._truncateToSize=function(e){var t=this,n=this._attributeValueLengthLimit;return n<=0?(It.warn("Attribute value limit must be positive, got "+n),e):"string"==typeof e?this._truncateToLimitUtil(e,n):Array.isArray(e)?e.map((function(e){return"string"==typeof e?t._truncateToLimitUtil(e,n):e})):e},e}();!function(e){e[e.NOT_RECORD=0]="NOT_RECORD",e[e.RECORD=1]="RECORD",e[e.RECORD_AND_SAMPLED=2]="RECORD_AND_SAMPLED"}(wp||(wp={}));var $S=function(){function e(){}return e.prototype.shouldSample=function(){return{decision:wp.NOT_RECORD}},e.prototype.toString=function(){return"AlwaysOffSampler"},e}(),zh=function(){function e(){}return e.prototype.shouldSample=function(){return{decision:wp.RECORD_AND_SAMPLED}},e.prototype.toString=function(){return"AlwaysOnSampler"},e}(),zR=function(){function e(e){var t,n,r,i;this._root=e.root,this._root||(kl(new Error("ParentBasedSampler must have a root sampler configured")),this._root=new zh),this._remoteParentSampled=null!==(t=e.remoteParentSampled)&&void 0!==t?t:new zh,this._remoteParentNotSampled=null!==(n=e.remoteParentNotSampled)&&void 0!==n?n:new $S,this._localParentSampled=null!==(r=e.localParentSampled)&&void 0!==r?r:new zh,this._localParentNotSampled=null!==(i=e.localParentNotSampled)&&void 0!==i?i:new $S}return e.prototype.shouldSample=function(e,t,n,r,i,o){var s=xo.getSpanContext(e);return s&&Pw(s)?s.isRemote?s.traceFlags&Ra.SAMPLED?this._remoteParentSampled.shouldSample(e,t,n,r,i,o):this._remoteParentNotSampled.shouldSample(e,t,n,r,i,o):s.traceFlags&Ra.SAMPLED?this._localParentSampled.shouldSample(e,t,n,r,i,o):this._localParentNotSampled.shouldSample(e,t,n,r,i,o):this._root.shouldSample(e,t,n,r,i,o)},e.prototype.toString=function(){return"ParentBased{root="+this._root.toString()+", remoteParentSampled="+this._remoteParentSampled.toString()+", remoteParentNotSampled="+this._remoteParentNotSampled.toString()+", localParentSampled="+this._localParentSampled.toString()+", localParentNotSampled="+this._localParentNotSampled.toString()+"}"},e}(),MD=function(){function e(e){void 0===e&&(e=0),this._ratio=e,this._ratio=this._normalize(e),this._upperBound=Math.floor(4294967295*this._ratio)}return e.prototype.shouldSample=function(e,t){return{decision:sX(t)&&this._accumulate(t)<this._upperBound?wp.RECORD_AND_SAMPLED:wp.NOT_RECORD}},e.prototype.toString=function(){return"TraceIdRatioBased{"+this._ratio+"}"},e.prototype._normalize=function(e){return"number"!=typeof e||isNaN(e)?0:e>=1?1:e<=0?0:e},e.prototype._accumulate=function(e){for(var t=0,n=0;n<e.length/8;n++){var r=8*n;t=(t^parseInt(e.slice(r,r+8),16))>>>0}return t},e}(),mLe=ma.AlwaysOn,nh=1;function RX(){var e=Xv();return{sampler:IX(e),forceFlushTimeoutMillis:3e4,generalLimits:{attributeValueLengthLimit:e.OTEL_ATTRIBUTE_VALUE_LENGTH_LIMIT,attributeCountLimit:e.OTEL_ATTRIBUTE_COUNT_LIMIT},spanLimits:{attributeValueLengthLimit:e.OTEL_SPAN_ATTRIBUTE_VALUE_LENGTH_LIMIT,attributeCountLimit:e.OTEL_SPAN_ATTRIBUTE_COUNT_LIMIT,linkCountLimit:e.OTEL_SPAN_LINK_COUNT_LIMIT,eventCountLimit:e.OTEL_SPAN_EVENT_COUNT_LIMIT,attributePerEventCountLimit:e.OTEL_SPAN_ATTRIBUTE_PER_EVENT_COUNT_LIMIT,attributePerLinkCountLimit:e.OTEL_SPAN_ATTRIBUTE_PER_LINK_COUNT_LIMIT},mergeResourceWithDefaults:!0}}function IX(e){switch(void 0===e&&(e=Xv()),e.OTEL_TRACES_SAMPLER){case ma.AlwaysOn:return new zh;case ma.AlwaysOff:return new $S;case ma.ParentBasedAlwaysOn:return new zR({root:new zh});case ma.ParentBasedAlwaysOff:return new zR({root:new $S});case ma.TraceIdRatio:return new MD(AD(e));case ma.ParentBasedTraceIdRatio:return new zR({root:new MD(AD(e))});default:return It.error('OTEL_TRACES_SAMPLER value "'+e.OTEL_TRACES_SAMPLER+" invalid, defaulting to "+mLe+'".'),new zh}}function AD(e){if(void 0===e.OTEL_TRACES_SAMPLER_ARG||""===e.OTEL_TRACES_SAMPLER_ARG)return It.error("OTEL_TRACES_SAMPLER_ARG is blank, defaulting to "+nh+"."),nh;var t=Number(e.OTEL_TRACES_SAMPLER_ARG);return isNaN(t)?(It.error("OTEL_TRACES_SAMPLER_ARG="+e.OTEL_TRACES_SAMPLER_ARG+" was given, but it is invalid, defaulting to "+nh+"."),nh):t<0||t>1?(It.error("OTEL_TRACES_SAMPLER_ARG="+e.OTEL_TRACES_SAMPLER_ARG+" was given, but it is out of range ([0..1]), defaulting to "+nh+"."),nh):t}function gLe(e){var t={sampler:IX()},n=RX(),r=Object.assign({},n,t,e);return r.generalLimits=Object.assign({},n.generalLimits,e.generalLimits||{}),r.spanLimits=Object.assign({},n.spanLimits,e.spanLimits||{}),r}function vLe(e){var t,n,r,i,o,s,a,l,c,u,d,h,p=Object.assign({},e.spanLimits),f=sPe();return p.attributeCountLimit=null!==(s=null!==(o=null!==(i=null!==(n=null===(t=e.spanLimits)||void 0===t?void 0:t.attributeCountLimit)&&void 0!==n?n:null===(r=e.generalLimits)||void 0===r?void 0:r.attributeCountLimit)&&void 0!==i?i:f.OTEL_SPAN_ATTRIBUTE_COUNT_LIMIT)&&void 0!==o?o:f.OTEL_ATTRIBUTE_COUNT_LIMIT)&&void 0!==s?s:Rb,p.attributeValueLengthLimit=null!==(h=null!==(d=null!==(u=null!==(l=null===(a=e.spanLimits)||void 0===a?void 0:a.attributeValueLengthLimit)&&void 0!==l?l:null===(c=e.generalLimits)||void 0===c?void 0:c.attributeValueLengthLimit)&&void 0!==u?u:f.OTEL_SPAN_ATTRIBUTE_VALUE_LENGTH_LIMIT)&&void 0!==d?d:f.OTEL_ATTRIBUTE_VALUE_LENGTH_LIMIT)&&void 0!==h?h:Tb,Object.assign({},e,{spanLimits:p})}var yLe=function(){function e(e,t){this._exporter=e,this._isExporting=!1,this._finishedSpans=[],this._droppedSpansCount=0;var n=Xv();this._maxExportBatchSize="number"==typeof(null==t?void 0:t.maxExportBatchSize)?t.maxExportBatchSize:n.OTEL_BSP_MAX_EXPORT_BATCH_SIZE,this._maxQueueSize="number"==typeof(null==t?void 0:t.maxQueueSize)?t.maxQueueSize:n.OTEL_BSP_MAX_QUEUE_SIZE,this._scheduledDelayMillis="number"==typeof(null==t?void 0:t.scheduledDelayMillis)?t.scheduledDelayMillis:n.OTEL_BSP_SCHEDULE_DELAY,this._exportTimeoutMillis="number"==typeof(null==t?void 0:t.exportTimeoutMillis)?t.exportTimeoutMillis:n.OTEL_BSP_EXPORT_TIMEOUT,this._shutdownOnce=new TX(this._shutdown,this),this._maxExportBatchSize>this._maxQueueSize&&(It.warn("BatchSpanProcessor: maxExportBatchSize must be smaller or equal to maxQueueSize, setting maxExportBatchSize to match maxQueueSize"),this._maxExportBatchSize=this._maxQueueSize)}return e.prototype.forceFlush=function(){return this._shutdownOnce.isCalled?this._shutdownOnce.promise:this._flushAll()},e.prototype.onStart=function(e,t){},e.prototype.onEnd=function(e){this._shutdownOnce.isCalled||e.spanContext().traceFlags&Ra.SAMPLED&&this._addToBuffer(e)},e.prototype.shutdown=function(){return this._shutdownOnce.call()},e.prototype._shutdown=function(){var e=this;return Promise.resolve().then((function(){return e.onShutdown()})).then((function(){return e._flushAll()})).then((function(){return e._exporter.shutdown()}))},e.prototype._addToBuffer=function(e){if(this._finishedSpans.length>=this._maxQueueSize)return 0===this._droppedSpansCount&&It.debug("maxQueueSize reached, dropping spans"),void this._droppedSpansCount++;this._droppedSpansCount>0&&(It.warn("Dropped "+this._droppedSpansCount+" spans because maxQueueSize reached"),this._droppedSpansCount=0),this._finishedSpans.push(e),this._maybeStartTimer()},e.prototype._flushAll=function(){var e=this;return new Promise((function(t,n){for(var r=[],i=0,o=Math.ceil(e._finishedSpans.length/e._maxExportBatchSize);i<o;i++)r.push(e._flushOneBatch());Promise.all(r).then((function(){t()})).catch(n)}))},e.prototype._flushOneBatch=function(){var e=this;return this._clearTimer(),0===this._finishedSpans.length?Promise.resolve():new Promise((function(t,n){var r=setTimeout((function(){n(new Error("Timeout"))}),e._exportTimeoutMillis);eu.with(cX(eu.active()),(function(){var i;e._finishedSpans.length<=e._maxExportBatchSize?(i=e._finishedSpans,e._finishedSpans=[]):i=e._finishedSpans.splice(0,e._maxExportBatchSize);for(var o=function(){return e._exporter.export(i,(function(e){var i;clearTimeout(r),e.code===Ro.SUCCESS?t():n(null!==(i=e.error)&&void 0!==i?i:new Error("BatchSpanProcessor: span export failed"))}))},s=null,a=0,l=i.length;a<l;a++){var c=i[a];c.resource.asyncAttributesPending&&c.resource.waitForAsyncAttributes&&(s??(s=[]),s.push(c.resource.waitForAsyncAttributes()))}null===s?o():Promise.all(s).then(o,(function(e){kl(e),n(e)}))}))}))},e.prototype._maybeStartTimer=function(){var e=this;if(!this._isExporting){var t=function(){e._isExporting=!0,e._flushOneBatch().finally((function(){e._isExporting=!1,e._finishedSpans.length>0&&(e._clearTimer(),e._maybeStartTimer())})).catch((function(t){e._isExporting=!1,kl(t)}))};if(this._finishedSpans.length>=this._maxExportBatchSize)return t();void 0===this._timer&&(this._timer=setTimeout((function(){return t()}),this._scheduledDelayMillis),this._timer)}},e.prototype._clearTimer=function(){void 0!==this._timer&&(clearTimeout(this._timer),this._timer=void 0)},e}(),_Le=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),bLe=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.onInit(n),r}return _Le(t,e),t.prototype.onInit=function(e){var t=this;!0!==(null==e?void 0:e.disableAutoFlushOnDocumentHide)&&typeof document<"u"&&(this._visibilityChangeListener=function(){"hidden"===document.visibilityState&&t.forceFlush().catch((function(e){kl(e)}))},this._pageHideListener=function(){t.forceFlush().catch((function(e){kl(e)}))},document.addEventListener("visibilitychange",this._visibilityChangeListener),document.addEventListener("pagehide",this._pageHideListener))},t.prototype.onShutdown=function(){typeof document<"u"&&(this._visibilityChangeListener&&document.removeEventListener("visibilitychange",this._visibilityChangeListener),this._pageHideListener&&document.removeEventListener("pagehide",this._pageHideListener))},t}(yLe),SLe=8,ELe=16,wLe=function(){this.generateTraceId=ND(ELe),this.generateSpanId=ND(SLe)},n_=Array(32);function ND(e){return function(){for(var t=0;t<2*e;t++)n_[t]=Math.floor(16*Math.random())+48,n_[t]>=58&&(n_[t]+=39);return String.fromCharCode.apply(null,n_.slice(0,2*e))}}var CLe=function(){function e(e,t,n){this._tracerProvider=n;var r=gLe(t);this._sampler=r.sampler,this._generalLimits=r.generalLimits,this._spanLimits=r.spanLimits,this._idGenerator=t.idGenerator||new wLe,this.resource=n.resource,this.instrumentationLibrary=e}return e.prototype.startSpan=function(e,t,n){var r,i,o;void 0===t&&(t={}),void 0===n&&(n=eu.active()),t.root&&(n=xo.deleteSpan(n));var s=xo.getSpan(n);if(n4(n))return It.debug("Instrumentation suppressed, returning Noop Span"),xo.wrapSpanContext(rX);var a,l,c,u=null==s?void 0:s.spanContext(),d=this._idGenerator.generateSpanId();u&&xo.isSpanContextValid(u)?(a=u.traceId,l=u.traceState,c=u.spanId):a=this._idGenerator.generateTraceId();var h=null!==(r=t.kind)&&void 0!==r?r:yx.INTERNAL,p=(null!==(i=t.links)&&void 0!==i?i:[]).map((function(e){return{context:e.context,attributes:Cb(e.attributes)}})),f=Cb(t.attributes),m=this._sampler.shouldSample(n,a,e,h,f,p);l=null!==(o=m.traceState)&&void 0!==o?o:l;var v={traceId:a,spanId:d,traceFlags:m.decision===jS.RECORD_AND_SAMPLED?Ra.SAMPLED:Ra.NONE,traceState:l};if(m.decision===jS.NOT_RECORD)return It.debug("Recording is off, propagating context in a non-recording span"),xo.wrapSpanContext(v);var g=Cb(Object.assign(f,m.attributes));return new pLe(this,n,e,v,h,c,p,t.startTime,void 0,g)},e.prototype.startActiveSpan=function(e,t,n,r){var i,o,s;if(!(arguments.length<2)){2===arguments.length?s=t:3===arguments.length?(i=t,s=n):(i=t,o=n,s=r);var a=o??eu.active(),l=this.startSpan(e,i,a),c=xo.setSpan(a,l);return eu.with(c,s,void 0,l)}},e.prototype.getGeneralLimits=function(){return this._generalLimits},e.prototype.getSpanLimits=function(){return this._spanLimits},e.prototype.getActiveSpanProcessor=function(){return this._tracerProvider.getActiveSpanProcessor()},e}(),TLe="service.name",RLe="telemetry.sdk.name",ILe="telemetry.sdk.language",kLe="telemetry.sdk.version",xLe=TLe,DD=RLe,jD=ILe,UD=kLe;function PLe(){return"unknown_service"}var hd,Ac=function(){return Ac=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},Ac.apply(this,arguments)},LLe=function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function s(e){try{l(r.next(e))}catch(e){o(e)}}function a(e){try{l(r.throw(e))}catch(e){o(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(s,a)}l((r=r.apply(e,t||[])).next())}))},OLe=function(e,t){var n,r,i,o,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,r=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!(i=(i=s.trys).length>0&&i[i.length-1])&&(6===o[0]||2===o[0])){s=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){s.label=o[1];break}if(6===o[0]&&s.label<i[1]){s.label=i[1],i=o;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(o);break}i[2]&&s.ops.pop(),s.trys.pop();continue}o=t.call(e,s)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}},MLe=function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,i,o=n.call(e),s=[];try{for(;(void 0===t||t-- >0)&&!(r=o.next()).done;)s.push(r.value)}catch(e){i={error:e}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return s},Cx=function(){function e(e,t){var n,r=this;this._attributes=e,this.asyncAttributesPending=null!=t,this._syncAttributes=null!==(n=this._attributes)&&void 0!==n?n:{},this._asyncAttributesPromise=null==t?void 0:t.then((function(e){return r._attributes=Object.assign({},r._attributes,e),r.asyncAttributesPending=!1,e}),(function(e){return It.debug("a resource's async attributes promise rejected: %s",e),r.asyncAttributesPending=!1,{}}))}return e.empty=function(){return e.EMPTY},e.default=function(){var t;return new e(((t={})[xLe]=PLe(),t[jD]=HR[jD],t[DD]=HR[DD],t[UD]=HR[UD],t))},Object.defineProperty(e.prototype,"attributes",{get:function(){var e;return this.asyncAttributesPending&&It.error("Accessing resource attributes before async attributes settled"),null!==(e=this._attributes)&&void 0!==e?e:{}},enumerable:!1,configurable:!0}),e.prototype.waitForAsyncAttributes=function(){return LLe(this,void 0,void 0,(function(){return OLe(this,(function(e){switch(e.label){case 0:return this.asyncAttributesPending?[4,this._asyncAttributesPromise]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}}))}))},e.prototype.merge=function(t){var n,r=this;if(!t)return this;var i=Ac(Ac({},this._syncAttributes),null!==(n=t._syncAttributes)&&void 0!==n?n:t.attributes);return this._asyncAttributesPromise||t._asyncAttributesPromise?new e(i,Promise.all([this._asyncAttributesPromise,t._asyncAttributesPromise]).then((function(e){var n,i=MLe(e,2),o=i[0],s=i[1];return Ac(Ac(Ac(Ac({},r._syncAttributes),o),null!==(n=t._syncAttributes)&&void 0!==n?n:t.attributes),s)}))):new e(i)},e.EMPTY=new e({}),e}(),r_=function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},FD=function(){function e(e){this._spanProcessors=e}return e.prototype.forceFlush=function(){var e,t,n=[];try{for(var r=r_(this._spanProcessors),i=r.next();!i.done;i=r.next()){var o=i.value;n.push(o.forceFlush())}}catch(t){e={error:t}}finally{try{i&&!i.done&&(t=r.return)&&t.call(r)}finally{if(e)throw e.error}}return new Promise((function(e){Promise.all(n).then((function(){e()})).catch((function(t){kl(t||new Error("MultiSpanProcessor: forceFlush failed")),e()}))}))},e.prototype.onStart=function(e,t){var n,r;try{for(var i=r_(this._spanProcessors),o=i.next();!o.done;o=i.next()){o.value.onStart(e,t)}}catch(e){n={error:e}}finally{try{o&&!o.done&&(r=i.return)&&r.call(i)}finally{if(n)throw n.error}}},e.prototype.onEnd=function(e){var t,n;try{for(var r=r_(this._spanProcessors),i=r.next();!i.done;i=r.next()){i.value.onEnd(e)}}catch(e){t={error:e}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(t)throw t.error}}},e.prototype.shutdown=function(){var e,t,n=[];try{for(var r=r_(this._spanProcessors),i=r.next();!i.done;i=r.next()){var o=i.value;n.push(o.shutdown())}}catch(t){e={error:t}}finally{try{i&&!i.done&&(t=r.return)&&t.call(r)}finally{if(e)throw e.error}}return new Promise((function(e,t){Promise.all(n).then((function(){e()}),t)}))},e}(),ALe=function(){function e(){}return e.prototype.onStart=function(e,t){},e.prototype.onEnd=function(e){},e.prototype.shutdown=function(){return Promise.resolve()},e.prototype.forceFlush=function(){return Promise.resolve()},e}(),NLe=function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,i,o=n.call(e),s=[];try{for(;(void 0===t||t-- >0)&&!(r=o.next()).done;)s.push(r.value)}catch(e){i={error:e}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return s},DLe=function(e,t,n){if(n||2===arguments.length)for(var r,i=0,o=t.length;i<o;i++)(r||!(i in t))&&(r||(r=Array.prototype.slice.call(t,0,i)),r[i]=t[i]);return e.concat(r||Array.prototype.slice.call(t))};!function(e){e[e.resolved=0]="resolved",e[e.timeout=1]="timeout",e[e.error=2]="error",e[e.unresolved=3]="unresolved"}(hd||(hd={}));var jLe=function(){function e(e){var t,n;void 0===e&&(e={}),this._registeredSpanProcessors=[],this._tracers=new Map;var r=eLe({},RX(),vLe(e));if(this.resource=null!==(t=r.resource)&&void 0!==t?t:Cx.empty(),r.mergeResourceWithDefaults&&(this.resource=Cx.default().merge(this.resource)),this._config=Object.assign({},r,{resource:this.resource}),null!==(n=e.spanProcessors)&&void 0!==n&&n.length)this._registeredSpanProcessors=DLe([],NLe(e.spanProcessors),!1),this.activeSpanProcessor=new FD(this._registeredSpanProcessors);else{var i=this._buildExporterFromEnv();if(void 0!==i){var o=new bLe(i);this.activeSpanProcessor=o}else this.activeSpanProcessor=new ALe}}return e.prototype.getTracer=function(e,t,n){var r=e+"@"+(t||"")+":"+((null==n?void 0:n.schemaUrl)||"");return this._tracers.has(r)||this._tracers.set(r,new CLe({name:e,version:t,schemaUrl:null==n?void 0:n.schemaUrl},this._config,this)),this._tracers.get(r)},e.prototype.addSpanProcessor=function(e){0===this._registeredSpanProcessors.length&&this.activeSpanProcessor.shutdown().catch((function(e){return It.error("Error while trying to shutdown current span processor",e)})),this._registeredSpanProcessors.push(e),this.activeSpanProcessor=new FD(this._registeredSpanProcessors)},e.prototype.getActiveSpanProcessor=function(){return this.activeSpanProcessor},e.prototype.register=function(e){void 0===e&&(e={}),xo.setGlobalTracerProvider(this),void 0===e.propagator&&(e.propagator=this._buildPropagatorFromEnv()),e.contextManager&&eu.setGlobalContextManager(e.contextManager),e.propagator&&wb.setGlobalPropagator(e.propagator)},e.prototype.forceFlush=function(){var e=this._config.forceFlushTimeoutMillis,t=this._registeredSpanProcessors.map((function(t){return new Promise((function(n){var r,i=setTimeout((function(){n(new Error("Span processor did not completed within timeout period of "+e+" ms")),r=hd.timeout}),e);t.forceFlush().then((function(){clearTimeout(i),r!==hd.timeout&&(r=hd.resolved,n(r))})).catch((function(e){clearTimeout(i),r=hd.error,n(e)}))}))}));return new Promise((function(e,n){Promise.all(t).then((function(t){var r=t.filter((function(e){return e!==hd.resolved}));r.length>0?n(r):e()})).catch((function(e){return n([e])}))}))},e.prototype.shutdown=function(){return this.activeSpanProcessor.shutdown()},e.prototype._getPropagator=function(e){var t;return null===(t=this.constructor._registeredPropagators.get(e))||void 0===t?void 0:t()},e.prototype._getSpanExporter=function(e){var t;return null===(t=this.constructor._registeredExporters.get(e))||void 0===t?void 0:t()},e.prototype._buildPropagatorFromEnv=function(){var e=this,t=Array.from(new Set(Xv().OTEL_PROPAGATORS)),n=t.map((function(t){var n=e._getPropagator(t);return n||It.warn('Propagator "'+t+'" requested through environment variable is unavailable.'),n})).reduce((function(e,t){return t&&e.push(t),e}),[]);if(0!==n.length)return 1===t.length?n[0]:new CPe({propagators:n})},e.prototype._buildExporterFromEnv=function(){var e=Xv().OTEL_TRACES_EXPORTER;if("none"!==e&&""!==e){var t=this._getSpanExporter(e);return t||It.error('Exporter "'+e+'" requested through environment variable is unavailable.'),t}},e._registeredPropagators=new Map([["tracecontext",function(){return new HPe}],["baggage",function(){return new jxe}]]),e._registeredExporters=new Map,e}(),ULe=function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function s(e){try{l(r.next(e))}catch(e){o(e)}}function a(e){try{l(r.throw(e))}catch(e){o(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(s,a)}l((r=r.apply(e,t||[])).next())}))},FLe=function(e,t){var n,r,i,o,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,r=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!(i=(i=s.trys).length>0&&i[i.length-1])&&(6===o[0]||2===o[0])){s=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){s.label=o[1];break}if(6===o[0]&&s.label<i[1]){s.label=i[1],i=o;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(o);break}i[2]&&s.ops.pop(),s.trys.pop();continue}o=t.call(e,s)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}},$Le=function(){function e(e){this._exporter=e,this._shutdownOnce=new TX(this._shutdown,this),this._unresolvedExports=new Set}return e.prototype.forceFlush=function(){return ULe(this,void 0,void 0,(function(){return FLe(this,(function(e){switch(e.label){case 0:return[4,Promise.all(Array.from(this._unresolvedExports))];case 1:return e.sent(),this._exporter.forceFlush?[4,this._exporter.forceFlush()]:[3,3];case 2:e.sent(),e.label=3;case 3:return[2]}}))}))},e.prototype.onStart=function(e,t){},e.prototype.onEnd=function(e){var t,n,r=this;if(!this._shutdownOnce.isCalled&&e.spanContext().traceFlags&Ra.SAMPLED){var i=function(){return oLe._export(r._exporter,[e]).then((function(e){var t;e.code!==Ro.SUCCESS&&kl(null!==(t=e.error)&&void 0!==t?t:new Error("SimpleSpanProcessor: span export failed (status "+e+")"))})).catch((function(e){kl(e)}))};if(e.resource.asyncAttributesPending){var o=null===(n=(t=e.resource).waitForAsyncAttributes)||void 0===n?void 0:n.call(t).then((function(){return null!=o&&r._unresolvedExports.delete(o),i()}),(function(e){return kl(e)}));null!=o&&this._unresolvedExports.add(o)}else i()}},e.prototype.shutdown=function(){return this._shutdownOnce.call()},e.prototype._shutdown=function(){return this._exporter.shutdown()},e}(),HLe=function(){function e(e){this._delegate=e}return e.prototype.export=function(e,t){this._delegate.export(e,t)},e.prototype.forceFlush=function(){return this._delegate.forceFlush()},e.prototype.shutdown=function(){return this._delegate.shutdown()},e}(),BLe=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),$D=function(e){function t(t,n,r){var i=e.call(this,t)||this;return i.name="OTLPExporterError",i.data=r,i.code=n,i}return BLe(t,e),t}(Error);function VLe(e){if(!Number.isNaN(e)&&Number.isFinite(e)&&e>0)return e;throw new Error("Configuration: timeoutMillis is invalid, expected number greater than 0 (actual: '"+e+"')")}function qLe(e){if(null!=e)return function(){return e}}function KLe(e,t,n){var r,i,o,s,a,l;return{timeoutMillis:VLe(null!==(i=null!==(r=e.timeoutMillis)&&void 0!==r?r:t.timeoutMillis)&&void 0!==i?i:n.timeoutMillis),concurrencyLimit:null!==(s=null!==(o=e.concurrencyLimit)&&void 0!==o?o:t.concurrencyLimit)&&void 0!==s?s:n.concurrencyLimit,compression:null!==(l=null!==(a=e.compression)&&void 0!==a?a:t.compression)&&void 0!==l?l:n.compression}}function GLe(){return{timeoutMillis:1e4,concurrencyLimit:30,compression:"none"}}var WLe=function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function s(e){try{l(r.next(e))}catch(e){o(e)}}function a(e){try{l(r.throw(e))}catch(e){o(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(s,a)}l((r=r.apply(e,t||[])).next())}))},zLe=function(e,t){var n,r,i,o,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,r=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!(i=(i=s.trys).length>0&&i[i.length-1])&&(6===o[0]||2===o[0])){s=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){s.label=o[1];break}if(6===o[0]&&s.label<i[1]){s.label=i[1],i=o;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(o);break}i[2]&&s.ops.pop(),s.trys.pop();continue}o=t.call(e,s)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}},YLe=function(){function e(e){this._sendingPromises=[],this._concurrencyLimit=e}return e.prototype.pushPromise=function(e){var t=this;if(this.hasReachedLimit())throw new Error("Concurrency Limit reached");this._sendingPromises.push(e);var n=function(){var n=t._sendingPromises.indexOf(e);t._sendingPromises.splice(n,1)};e.then(n,n)},e.prototype.hasReachedLimit=function(){return this._sendingPromises.length>=this._concurrencyLimit},e.prototype.awaitAll=function(){return WLe(this,void 0,void 0,(function(){return zLe(this,(function(e){switch(e.label){case 0:return[4,Promise.all(this._sendingPromises)];case 1:return e.sent(),[2]}}))}))},e}();function JLe(e){return new YLe(e.concurrencyLimit)}function XLe(e){return Object.prototype.hasOwnProperty.call(e,"partialSuccess")}function ZLe(){return{handleResponse:function(e){null==e||!XLe(e)||null==e.partialSuccess||0===Object.keys(e.partialSuccess).length||It.warn("Received Partial Success response:",JSON.stringify(e.partialSuccess))}}}var QLe=function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function s(e){try{l(r.next(e))}catch(e){o(e)}}function a(e){try{l(r.throw(e))}catch(e){o(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(s,a)}l((r=r.apply(e,t||[])).next())}))},e6e=function(e,t){var n,r,i,o,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,r=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!(i=(i=s.trys).length>0&&i[i.length-1])&&(6===o[0]||2===o[0])){s=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){s.label=o[1];break}if(6===o[0]&&s.label<i[1]){s.label=i[1],i=o;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(o);break}i[2]&&s.ops.pop(),s.trys.pop();continue}o=t.call(e,s)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}},t6e=function(){function e(e,t,n,r,i){this._transport=e,this._serializer=t,this._responseHandler=n,this._promiseQueue=r,this._timeout=i,this._diagLogger=It.createComponentLogger({namespace:"OTLPExportDelegate"})}return e.prototype.export=function(e,t){var n=this;if(this._diagLogger.debug("items to be sent",e),this._promiseQueue.hasReachedLimit())t({code:Ro.FAILED,error:new Error("Concurrent export limit reached")});else{var r=this._serializer.serializeRequest(e);null!=r?this._promiseQueue.pushPromise(this._transport.send(r,this._timeout).then((function(e){if("success"!==e.status)"failure"===e.status&&e.error?t({code:Ro.FAILED,error:e.error}):"retryable"===e.status?t({code:Ro.FAILED,error:new $D("Export failed with retryable status")}):t({code:Ro.FAILED,error:new $D("Export failed with unknown error")});else{if(null!=e.data)try{n._responseHandler.handleResponse(n._serializer.deserializeResponse(e.data))}catch(t){n._diagLogger.warn("Export succeeded but could not deserialize response - is the response specification compliant?",t,e.data)}t({code:Ro.SUCCESS})}}),(function(e){return t({code:Ro.FAILED,error:e})}))):t({code:Ro.FAILED,error:new Error("Nothing to send")})}},e.prototype.forceFlush=function(){return this._promiseQueue.awaitAll()},e.prototype.shutdown=function(){return QLe(this,void 0,void 0,(function(){return e6e(this,(function(e){switch(e.label){case 0:return this._diagLogger.debug("shutdown started"),[4,this.forceFlush()];case 1:return e.sent(),this._transport.shutdown(),[2]}}))}))},e}();function n6e(e,t){return new t6e(e.transport,e.serializer,ZLe(),e.promiseHandler,t.timeout)}function kX(e,t,n){return n6e({transport:n,serializer:t,promiseHandler:JLe(e)},{timeout:e.timeoutMillis})}function xX(e){var t=BigInt(1e9);return BigInt(e[0])*t+BigInt(e[1])}function r6e(e){return{low:Number(BigInt.asUintN(32,e)),high:Number(BigInt.asUintN(32,e>>BigInt(32)))}}function PX(e){return r6e(xX(e))}function i6e(e){return xX(e).toString()}var s6e=typeof BigInt<"u"?i6e:EPe;function HD(e){return e}function LX(e){if(void 0!==e)return r4(e)}var o6e={encodeHrTime:PX,encodeSpanContext:r4,encodeOptionalSpanContext:LX};function a6e(e){var t,n;if(void 0===e)return o6e;var r=null===(t=e.useLongBits)||void 0===t||t,i=null!==(n=e.useHex)&&void 0!==n&&n;return{encodeHrTime:r?PX:s6e,encodeSpanContext:i?HD:r4,encodeOptionalSpanContext:i?HD:LX}}var l6e=function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,i,o=n.call(e),s=[];try{for(;(void 0===t||t-- >0)&&!(r=o.next()).done;)s.push(r.value)}catch(e){i={error:e}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return s};function c6e(e){return{attributes:Lw(e.attributes),droppedAttributesCount:0}}function u6e(e){return{name:e.name,version:e.version}}function Lw(e){return Object.keys(e).map((function(t){return OX(t,e[t])}))}function OX(e,t){return{key:e,value:MX(t)}}function MX(e){var t=typeof e;return"string"===t?{stringValue:e}:"number"===t?Number.isInteger(e)?{intValue:e}:{doubleValue:e}:"boolean"===t?{boolValue:e}:e instanceof Uint8Array?{bytesValue:e}:Array.isArray(e)?{arrayValue:{values:e.map(MX)}}:"object"===t&&null!=e?{kvlistValue:{values:Object.entries(e).map((function(e){var t=l6e(e,2);return OX(t[0],t[1])}))}}:{}}var d6e=function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},f6e=function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,i,o=n.call(e),s=[];try{for(;(void 0===t||t-- >0)&&!(r=o.next()).done;)s.push(r.value)}catch(e){i={error:e}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return s};function h6e(e,t){var n,r=e.spanContext(),i=e.status;return{traceId:t.encodeSpanContext(r.traceId),spanId:t.encodeSpanContext(r.spanId),parentSpanId:t.encodeOptionalSpanContext(e.parentSpanId),traceState:null===(n=r.traceState)||void 0===n?void 0:n.serialize(),name:e.name,kind:null==e.kind?0:e.kind+1,startTimeUnixNano:t.encodeHrTime(e.startTime),endTimeUnixNano:t.encodeHrTime(e.endTime),attributes:Lw(e.attributes),droppedAttributesCount:e.droppedAttributesCount,events:e.events.map((function(e){return m6e(e,t)})),droppedEventsCount:e.droppedEventsCount,status:{code:i.code,message:i.message},links:e.links.map((function(e){return p6e(e,t)})),droppedLinksCount:e.droppedLinksCount}}function p6e(e,t){var n;return{attributes:e.attributes?Lw(e.attributes):[],spanId:t.encodeSpanContext(e.context.spanId),traceId:t.encodeSpanContext(e.context.traceId),traceState:null===(n=e.context.traceState)||void 0===n?void 0:n.serialize(),droppedAttributesCount:e.droppedAttributesCount||0}}function m6e(e,t){return{attributes:e.attributes?Lw(e.attributes):[],name:e.name,timeUnixNano:t.encodeHrTime(e.time),droppedAttributesCount:e.droppedAttributesCount||0}}function g6e(e,t){return{resourceSpans:y6e(e,a6e(t))}}function v6e(e){var t,n,r=new Map;try{for(var i=d6e(e),o=i.next();!o.done;o=i.next()){var s=o.value,a=r.get(s.resource);a||(a=new Map,r.set(s.resource,a));var l=s.instrumentationLibrary.name+"@"+(s.instrumentationLibrary.version||"")+":"+(s.instrumentationLibrary.schemaUrl||""),c=a.get(l);c||(c=[],a.set(l,c)),c.push(s)}}catch(e){t={error:e}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(t)throw t.error}}return r}function y6e(e,t){for(var n=[],r=v6e(e).entries(),i=r.next();!i.done;){for(var o=f6e(i.value,2),s=o[0],a=[],l=o[1].values(),c=l.next();!c.done;){var u=c.value;if(u.length>0){var d=u.map((function(e){return h6e(e,t)}));a.push({scope:u6e(u[0].instrumentationLibrary),spans:d,schemaUrl:u[0].instrumentationLibrary.schemaUrl})}c=l.next()}var h={resource:c6e(s),scopeSpans:a,schemaUrl:void 0};n.push(h),i=r.next()}return n}var _6e={serializeRequest:function(e){var t=g6e(e,{useHex:!0,useLongBits:!1});return(new TextEncoder).encode(JSON.stringify(t))},deserializeResponse:function(e){var t=new TextDecoder;return JSON.parse(t.decode(e))}},b6e=function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function s(e){try{l(r.next(e))}catch(e){o(e)}}function a(e){try{l(r.throw(e))}catch(e){o(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(s,a)}l((r=r.apply(e,t||[])).next())}))},S6e=function(e,t){var n,r,i,o,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,r=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!(i=(i=s.trys).length>0&&i[i.length-1])&&(6===o[0]||2===o[0])){s=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){s.label=o[1];break}if(6===o[0]&&s.label<i[1]){s.label=i[1],i=o;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(o);break}i[2]&&s.ops.pop(),s.trys.pop();continue}o=t.call(e,s)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}},E6e=5,w6e=1e3,C6e=5e3,T6e=1.5,BD=.2;function R6e(){return Math.random()*(2*BD)-BD}var I6e=function(){function e(e){this._transport=e}return e.prototype.retry=function(e,t,n){var r=this;return new Promise((function(i,o){setTimeout((function(){r._transport.send(e,t).then(i,o)}),n)}))},e.prototype.send=function(e,t){var n;return b6e(this,void 0,void 0,(function(){var r,i,o,s,a,l,c;return S6e(this,(function(u){switch(u.label){case 0:return r=Date.now()+t,[4,this._transport.send(e,t)];case 1:i=u.sent(),o=E6e,s=w6e,u.label=2;case 2:return"retryable"===i.status&&o>0?(o--,a=Math.max(Math.min(s,C6e)+R6e(),0),s*=T6e,l=null!==(n=i.retryInMillis)&&void 0!==n?n:a,c=r-Date.now(),l>c?[2,i]:[4,this.retry(e,c,l)]):[3,4];case 3:return i=u.sent(),[3,2];case 4:return[2,i]}}))}))},e.prototype.shutdown=function(){return this._transport.shutdown()},e}();function AX(e){return new I6e(e.transport)}function k6e(e){return[429,502,503,504].includes(e)}function x6e(e){if(null!=e){var t=Number.parseInt(e,10);if(Number.isInteger(t))return t>0?1e3*t:-1;var n=new Date(e).getTime()-Date.now();return n>=0?n:0}}var P6e=function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,i,o=n.call(e),s=[];try{for(;(void 0===t||t-- >0)&&!(r=o.next()).done;)s.push(r.value)}catch(e){i={error:e}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return s},L6e=function(){function e(e){this._parameters=e}return e.prototype.send=function(e,t){var n=this;return new Promise((function(r){var i=new XMLHttpRequest;i.timeout=t,i.open("POST",n._parameters.url);var o=n._parameters.headers();Object.entries(o).forEach((function(e){var t=P6e(e,2),n=t[0],r=t[1];i.setRequestHeader(n,r)})),i.ontimeout=function(e){r({status:"failure",error:new Error("XHR request timed out")})},i.onreadystatechange=function(){i.status>=200&&i.status<=299?(It.debug("XHR success"),r({status:"success"})):i.status&&k6e(i.status)?r({status:"retryable",retryInMillis:x6e(i.getResponseHeader("Retry-After"))}):0!==i.status&&r({status:"failure",error:new Error("XHR request failed with non-retryable status")})},i.onabort=function(){r({status:"failure",error:new Error("XHR request aborted")})},i.onerror=function(){r({status:"failure",error:new Error("XHR request errored")})},i.send(e)}))},e.prototype.shutdown=function(){},e}();function O6e(e){return new L6e(e)}var M6e=function(){function e(e){this._params=e}return e.prototype.send=function(e){var t=this;return new Promise((function(n){navigator.sendBeacon(t._params.url,new Blob([e],{type:t._params.blobType}))?(It.debug("SendBeacon success"),n({status:"success"})):n({status:"failure",error:new Error("SendBeacon failed")})}))},e.prototype.shutdown=function(){},e}();function A6e(e){return new M6e(e)}function N6e(e,t){return kX(e,t,AX({transport:O6e(e)}))}function D6e(e,t){return kX(e,t,AX({transport:A6e({url:e.url,blobType:e.headers()["Content-Type"]})}))}var j6e=function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,i,o=n.call(e),s=[];try{for(;(void 0===t||t-- >0)&&!(r=o.next()).done;)s.push(r.value)}catch(e){i={error:e}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return s};function U6e(e){return function(){var t,n={};return Object.entries(null!==(t=null==e?void 0:e())&&void 0!==t?t:{}).forEach((function(e){var t=j6e(e,2),r=t[0],i=t[1];typeof i<"u"?n[r]=String(i):It.warn('Header "'+r+'" has invalid value ('+i+") and will be ignored")})),n}}var Kd=function(){return Kd=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},Kd.apply(this,arguments)};function F6e(e,t,n){var r=Kd({},n()),i={};return function(){return null!=t&&Object.assign(i,t()),null!=e&&Object.assign(i,e()),Object.assign(i,r)}}function $6e(e){if(null!=e)try{return new URL(e),e}catch{throw new Error("Configuration: Could not parse user-provided export URL: '"+e+"'")}}function H6e(e,t,n){var r,i,o,s;return Kd(Kd({},KLe(e,t,n)),{headers:F6e(U6e(e.headers),t.headers,n.headers),url:null!==(i=null!==(r=$6e(e.url))&&void 0!==r?r:t.url)&&void 0!==i?i:n.url,agentOptions:null!==(s=null!==(o=e.agentOptions)&&void 0!==o?o:t.agentOptions)&&void 0!==s?s:n.agentOptions})}function B6e(e,t){return Kd(Kd({},GLe()),{headers:function(){return e},url:"http://localhost:4318/"+t,agentOptions:{keepAlive:!0}})}function V6e(e,t,n){return H6e({url:e.url,timeoutMillis:e.timeoutMillis,headers:qLe(e.headers),concurrencyLimit:e.concurrencyLimit},{},B6e(n,t))}function q6e(e,t,n,r){var i=!!e.headers||"function"!=typeof navigator.sendBeacon,o=V6e(e,n,r);return i?N6e(o,t):D6e(o,t)}var K6e=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),G6e=function(e){function t(t){return void 0===t&&(t={}),e.call(this,q6e(t,_6e,"v1/traces",{"Content-Type":"application/json"}))||this}return K6e(t,e),t}(HLe),W6e=function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,i,o=n.call(e),s=[];try{for(;(void 0===t||t-- >0)&&!(r=o.next()).done;)s.push(r.value)}catch(e){i={error:e}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return s},z6e=function(e,t,n){if(n||2===arguments.length)for(var r,i=0,o=t.length;i<o;i++)(r||!(i in t))&&(r||(r=Array.prototype.slice.call(t,0,i)),r[i]=t[i]);return e.concat(r||Array.prototype.slice.call(t))},Y6e=function(){function e(){this._enabled=!1,this._currentContext=mh}return e.prototype._bindFunction=function(e,t){void 0===e&&(e=mh);var n=this,r=function(){for(var r=this,i=[],o=0;o<arguments.length;o++)i[o]=arguments[o];return n.with(e,(function(){return t.apply(r,i)}))};return Object.defineProperty(r,"length",{enumerable:!1,configurable:!0,writable:!1,value:t.length}),r},e.prototype.active=function(){return this._currentContext},e.prototype.bind=function(e,t){return void 0===e&&(e=this.active()),"function"==typeof t?this._bindFunction(e,t):t},e.prototype.disable=function(){return this._currentContext=mh,this._enabled=!1,this},e.prototype.enable=function(){return this._enabled||(this._enabled=!0,this._currentContext=mh),this},e.prototype.with=function(e,t,n){for(var r=[],i=3;i<arguments.length;i++)r[i-3]=arguments[i];var o=this._currentContext;this._currentContext=e||mh;try{return t.call.apply(t,z6e([n],W6e(r),!1))}finally{this._currentContext=o}},e}(),J6e=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),X6e=function(e){function t(t){void 0===t&&(t={});var n=e.call(this,t)||this;if(t.contextManager)throw"contextManager should be defined in register method not in constructor";if(t.propagator)throw"propagator should be defined in register method not in constructor";return n}return J6e(t,e),t.prototype.register=function(t){void 0===t&&(t={}),void 0===t.contextManager&&(t.contextManager=new Y6e),t.contextManager&&t.contextManager.enable(),e.prototype.register.call(this,t)},t}(jLe);function Z6e(e){for(var t={},n=e.length,r=0;r<n;r++){var i=e[r];i&&(t[String(i).toUpperCase().replace(/[-.]/g,"_")]=i)}return t}var Q6e="cloud.provider",e4e="cloud.account.id",t4e="cloud.region",n4e="cloud.availability_zone",r4e="cloud.platform",i4e="aws.ecs.container.arn",s4e="aws.ecs.cluster.arn",o4e="aws.ecs.launchtype",a4e="aws.ecs.task.arn",l4e="aws.ecs.task.family",c4e="aws.ecs.task.revision",u4e="aws.eks.cluster.arn",d4e="aws.log.group.names",f4e="aws.log.group.arns",h4e="aws.log.stream.names",p4e="aws.log.stream.arns",m4e="container.name",g4e="container.id",v4e="container.runtime",y4e="container.image.name",_4e="container.image.tag",b4e="deployment.environment",S4e="device.id",E4e="device.model.identifier",w4e="device.model.name",C4e="faas.name",T4e="faas.id",R4e="faas.version",I4e="faas.instance",k4e="faas.max_memory",x4e="host.id",P4e="host.name",L4e="host.type",O4e="host.arch",M4e="host.image.name",A4e="host.image.id",N4e="host.image.version",D4e="k8s.cluster.name",j4e="k8s.node.name",U4e="k8s.node.uid",F4e="k8s.namespace.name",$4e="k8s.pod.uid",H4e="k8s.pod.name",B4e="k8s.container.name",V4e="k8s.replicaset.uid",q4e="k8s.replicaset.name",K4e="k8s.deployment.uid",G4e="k8s.deployment.name",W4e="k8s.statefulset.uid",z4e="k8s.statefulset.name",Y4e="k8s.daemonset.uid",J4e="k8s.daemonset.name",X4e="k8s.job.uid",Z4e="k8s.job.name",Q4e="k8s.cronjob.uid",eOe="k8s.cronjob.name",tOe="os.type",nOe="os.description",rOe="os.name",iOe="os.version",sOe="process.pid",oOe="process.executable.name",aOe="process.executable.path",lOe="process.command",cOe="process.command_line",uOe="process.command_args",dOe="process.owner",fOe="process.runtime.name",hOe="process.runtime.version",pOe="process.runtime.description",mOe="service.name",gOe="service.namespace",vOe="service.instance.id",yOe="service.version",_Oe="telemetry.sdk.name",bOe="telemetry.sdk.language",SOe="telemetry.sdk.version",EOe="telemetry.auto.version",wOe="webengine.name",COe="webengine.version",TOe="webengine.description",ROe=Z6e([Q6e,e4e,t4e,n4e,r4e,i4e,s4e,o4e,a4e,l4e,c4e,u4e,d4e,f4e,h4e,p4e,m4e,g4e,v4e,y4e,_4e,b4e,S4e,E4e,w4e,C4e,T4e,R4e,I4e,k4e,x4e,P4e,L4e,O4e,M4e,A4e,N4e,D4e,j4e,U4e,F4e,$4e,H4e,B4e,V4e,q4e,K4e,G4e,W4e,z4e,Y4e,J4e,X4e,Z4e,Q4e,eOe,tOe,nOe,rOe,iOe,sOe,oOe,aOe,lOe,cOe,uOe,dOe,fOe,hOe,pOe,mOe,gOe,vOe,yOe,_Oe,bOe,SOe,EOe,wOe,COe,TOe]);function VD(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function De(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?VD(Object(n),!0).forEach((function(t){de(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):VD(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Zv(e){return(Zv="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function $t(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function qD(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Ht(e,t,n){return t&&qD(e.prototype,t),n&&qD(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function de(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function IOe(e,t){if(null==e)return{};var n,r,i=function(e,t){if(null==e)return{};var n,r,i={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}function bi(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,i,o=[],s=!0,a=!1;try{for(n=n.call(e);!(s=(r=n.next()).done)&&(o.push(r.value),!t||o.length!==t);s=!0);}catch(e){a=!0,i=e}finally{try{s||null==n.return||n.return()}finally{if(a)throw i}}return o}}(e,t)||i4(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function xl(e){return function(e){if(Array.isArray(e))return Tx(e)}(e)||function(e){if(typeof Symbol<"u"&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||i4(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function i4(e,t){if(e){if("string"==typeof e)return Tx(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Tx(e,t):void 0}}function Tx(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function eo(e,t){var n=typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=i4(e))||t){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,s=!0,a=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){a=!0,o=e},f:function(){try{s||null==n.return||n.return()}finally{if(a)throw o}}}}var Ds={DEBUG:!1,LIB_VERSION:"1.160.3"},kOe=Array.isArray,NX=Object.prototype,DX=NX.hasOwnProperty,Ow=NX.toString,_r=kOe||function(e){return"[object Array]"===Ow.call(e)},qs=function(e){return"function"==typeof e},Wr=function(e){return e===Object(e)&&!_r(e)},kb=function(e){if(Wr(e)){for(var t in e)if(DX.call(e,t))return!1;return!0}return!1},Ye=function(e){return void 0===e},ci=function(e){return"[object String]"==Ow.call(e)},KD=function(e){return ci(e)&&0===e.trim().length},ql=function(e){return null===e},Qi=function(e){return Ye(e)||ql(e)},js=function(e){return"[object Number]"==Ow.call(e)},_d=function(e){return"[object Boolean]"===Ow.call(e)},xOe=function(e){return e instanceof FormData},ie=typeof window<"u"?window:void 0,zi=typeof globalThis<"u"?globalThis:ie,jX=Array.prototype,GD=jX.forEach,WD=jX.indexOf,No=null==zi?void 0:zi.navigator,He=null==zi?void 0:zi.document,$i=null==zi?void 0:zi.location,Rx=null==zi?void 0:zi.fetch,Ix=null!=zi&&zi.XMLHttpRequest&&"withCredentials"in new zi.XMLHttpRequest?zi.XMLHttpRequest:void 0,zD=null==zi?void 0:zi.AbortController,kr=null==No?void 0:No.userAgent,In=ie??{},YD="[PostHog.js]",pe={_log:function(e){if(ie&&(Ds.DEBUG||In.POSTHOG_DEBUG)&&!Ye(ie.console)&&ie.console){for(var t=("__rrweb_original__"in ie.console[e]?ie.console[e].__rrweb_original__:ie.console[e]),n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];t.apply(void 0,[YD].concat(r))}},info:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];pe._log.apply(pe,["log"].concat(t))},warn:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];pe._log.apply(pe,["warn"].concat(t))},error:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];pe._log.apply(pe,["error"].concat(t))},critical:function(){for(var e,t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];(e=console).error.apply(e,[YD].concat(n))},uninitializedWarning:function(e){pe.error("You must initialize PostHog before calling ".concat(e))}},HS={},Mw=function(e){return e.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")};function Yh(e,t,n){if(_r(e))if(GD&&e.forEach===GD)e.forEach(t,n);else if("length"in e&&e.length===+e.length)for(var r=0,i=e.length;r<i;r++)if(r in e&&t.call(n,e[r],r)===HS)return}function on(e,t,n){if(!Qi(e)){if(_r(e))return Yh(e,t,n);if(xOe(e)){var r,i=eo(e.entries());try{for(i.s();!(r=i.n()).done;){var o=r.value;if(t.call(n,o[1],o[0])===HS)return}}catch(e){i.e(e)}finally{i.f()}}else for(var s in e)if(DX.call(e,s)&&t.call(n,e[s],s)===HS)return}}var Si=function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return Yh(n,(function(t){for(var n in t)void 0!==t[n]&&(e[n]=t[n])})),e};function Tt(e,t){return-1!==e.indexOf(t)}function xb(e){for(var t=Object.keys(e),n=t.length,r=new Array(n);n--;)r[n]=[t[n],e[t[n]]];return r}var UX=function(){return Date.now=Date.now||function(){return+new Date},Date.now()},JD=function(e){try{return e()}catch{return}},POe=function(e){return function(){try{for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return e.apply(this,n)}catch(e){pe.critical("Implementation error. Please turn on debug mode and open a ticket on https://app.posthog.com/home#panel=support%3Asupport%3A."),pe.critical(e)}}},kx=function(e){var t={};return on(e,(function(e,n){ci(e)&&e.length>0&&(t[n]=e)})),t},xx=function(e){return e.replace(/^\$/,"")};function LOe(e,t){return n=e,r=function(e){return ci(e)&&!ql(t)?e.slice(0,t):e},i=new Set,function e(t,n){return t!==Object(t)?r?r(t):t:i.has(t)?void 0:(i.add(t),_r(t)?(o=[],Yh(t,(function(t){o.push(e(t))}))):(o={},on(t,(function(t,n){i.has(t)||(o[n]=e(t,n))}))),o);var o}(n);var n,r,i}var Mo,OOe=function(e){var t,n,r,i,o="";for(t=n=0,r=(e=(e+"").replace(/\r\n/g,"\n").replace(/\r/g,"\n")).length,i=0;i<r;i++){var s=e.charCodeAt(i),a=null;s<128?n++:a=s>127&&s<2048?String.fromCharCode(s>>6|192,63&s|128):String.fromCharCode(s>>12|224,s>>6&63|128,63&s|128),ql(a)||(n>t&&(o+=e.substring(t,n)),o+=a,t=n=i+1)}return n>t&&(o+=e.substring(t,e.length)),o},vl=function(){function e(t){return t&&(t.preventDefault=e.preventDefault,t.stopPropagation=e.stopPropagation),t}return e.preventDefault=function(){this.returnValue=!1},e.stopPropagation=function(){this.cancelBubble=!0},function(t,n,r,i,o){if(t)if(t.addEventListener&&!i)t.addEventListener(n,r,!!o);else{var s="on"+n,a=t[s];t[s]=(l=t,c=r,u=a,function(t){if(t=t||e(null==ie?void 0:ie.event)){var n,r=!0;qs(u)&&(n=u(t));var i=c.call(l,t);return!1!==n&&!1!==i||(r=!1),r}})}else pe.error("No valid element provided to register_event");var l,c,u}}();function FX(e,t){for(var n=0;n<e.length;n++)if(t(e[n]))return e[n]}!function(e){e.GZipJS="gzip-js",e.Base64="base64"}(Mo||(Mo={}));var $X="$people_distinct_id",Dg="__alias",jg="__timers",XD="$autocapture_disabled_server_side",Px="$heatmaps_enabled_server_side",ZD="$exception_capture_enabled_server_side",QD="$exception_capture_endpoint_suffix",ej="$web_vitals_enabled_server_side",Lx="$session_recording_enabled_server_side",tj="$console_log_recording_enabled_server_side",nj="$session_recording_network_payload_capture",rj="$session_recording_canvas_recording",ij="$replay_sample_rate",sj="$replay_minimum_duration",BS="$sesid",cv="$session_is_sampled",Rh="$enabled_feature_flags",Ox="$early_access_features",Ih="$stored_person_properties",Nc="$stored_group_properties",Mx="$surveys",i_="$surveys_activated",VS="$flag_call_reported",al="$user_state",Ax="$client_session_props",Nx="$capture_rate_limit",Dx="$initial_campaign_params",jx="$initial_referrer_info",oj="$initial_person_info",qS="$epp",Ux="__POSTHOG_TOOLBAR__",MOe=[$X,Dg,"__cmpns",jg,Lx,Px,BS,Rh,al,Ox,Nc,Ih,Mx,VS,Ax,Nx,Dx,jx,qS],YR="$active_feature_flags",s_="$override_feature_flags",aj="$feature_flag_payloads",lj=function(e){var t,n={},r=eo(xb(e||{}));try{for(r.s();!(t=r.n()).done;){var i=bi(t.value,2),o=i[0],s=i[1];s&&(n[o]=s)}}catch(e){r.e(e)}finally{r.f()}return n},AOe=function(){function e(t){$t(this,e),this.instance=t,this._override_warning=!1,this.featureFlagEventHandlers=[],this.reloadFeatureFlagsQueued=!1,this.reloadFeatureFlagsInAction=!1}return Ht(e,[{key:"getFlags",value:function(){return Object.keys(this.getFlagVariants())}},{key:"getFlagVariants",value:function(){var e=this.instance.get_property(Rh),t=this.instance.get_property(s_);if(!t)return e||{};for(var n=Si({},e),r=Object.keys(t),i=0;i<r.length;i++)n[r[i]]=t[r[i]];return this._override_warning||(pe.warn(" Overriding feature flags!",{enabledFlags:e,overriddenFlags:t,finalFlags:n}),this._override_warning=!0),n}},{key:"getFlagPayloads",value:function(){return this.instance.get_property(aj)||{}}},{key:"reloadFeatureFlags",value:function(){this.reloadFeatureFlagsQueued||(this.reloadFeatureFlagsQueued=!0,this._startReloadTimer())}},{key:"setAnonymousDistinctId",value:function(e){this.$anon_distinct_id=e}},{key:"setReloadingPaused",value:function(e){this.reloadFeatureFlagsInAction=e}},{key:"resetRequestQueue",value:function(){this.reloadFeatureFlagsQueued=!1}},{key:"_startReloadTimer",value:function(){var e=this;this.reloadFeatureFlagsQueued&&!this.reloadFeatureFlagsInAction&&setTimeout((function(){!e.reloadFeatureFlagsInAction&&e.reloadFeatureFlagsQueued&&(e.reloadFeatureFlagsQueued=!1,e._reloadFeatureFlagsRequest())}),5)}},{key:"_reloadFeatureFlagsRequest",value:function(){var e=this;if(!this.instance.config.advanced_disable_feature_flags){this.setReloadingPaused(!0);var t=this.instance.config.token,n=this.instance.get_property(Ih),r=this.instance.get_property(Nc),i={token:t,distinct_id:this.instance.get_distinct_id(),groups:this.instance.getGroups(),$anon_distinct_id:this.$anon_distinct_id,person_properties:n,group_properties:r,disable_flags:this.instance.config.advanced_disable_feature_flags||void 0};this.instance._send_request({method:"POST",url:this.instance.requestRouter.endpointFor("api","/decide/?v=3"),data:i,compression:this.instance.config.disable_compression?void 0:Mo.Base64,timeout:this.instance.config.feature_flag_request_timeout_ms,callback:function(t){var n;e.setReloadingPaused(!1);var r=!0;200===t.statusCode&&(e.$anon_distinct_id=void 0,r=!1),e.receivedFeatureFlags(null!==(n=t.json)&&void 0!==n?n:{},r),e._startReloadTimer()}})}}},{key:"getFeatureFlag",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(this.instance.decideEndpointWasHit||this.getFlags()&&this.getFlags().length>0){var n,r=this.getFlagVariants()[e],i="".concat(r),o=this.instance.get_property(VS)||{};return(t.send_event||!("send_event"in t))&&(!(e in o)||!o[e].includes(i))&&(_r(o[e])?o[e].push(i):o[e]=[i],null===(n=this.instance.persistence)||void 0===n||n.register(de({},VS,o)),this.instance.capture("$feature_flag_called",{$feature_flag:e,$feature_flag_response:r})),r}pe.warn('getFeatureFlag for key "'+e+"\" failed. Feature flags didn't load in time.")}},{key:"getFeatureFlagPayload",value:function(e){return this.getFlagPayloads()[e]}},{key:"isFeatureEnabled",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(this.instance.decideEndpointWasHit||this.getFlags()&&this.getFlags().length>0)return!!this.getFeatureFlag(e,t);pe.warn('isFeatureEnabled for key "'+e+"\" failed. Feature flags didn't load in time.")}},{key:"addFeatureFlagsHandler",value:function(e){this.featureFlagEventHandlers.push(e)}},{key:"removeFeatureFlagsHandler",value:function(e){this.featureFlagEventHandlers=this.featureFlagEventHandlers.filter((function(t){return t!==e}))}},{key:"receivedFeatureFlags",value:function(e,t){if(this.instance.persistence){this.instance.decideEndpointWasHit=!0;var n=this.getFlagVariants(),r=this.getFlagPayloads();(function(e,t){var n,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},o=e.featureFlags,s=e.featureFlagPayloads;if(o)if(_r(o)){var a,l={};if(o)for(var c=0;c<o.length;c++)l[o[c]]=!0;t&&t.register((de(a={},YR,o),de(a,Rh,l),a))}else{var u=o,d=s;e.errorsWhileComputingFlags&&(u=De(De({},r),u),d=De(De({},i),d)),t&&t.register((de(n={},YR,Object.keys(lj(u))),de(n,Rh,u||{}),de(n,aj,d||{}),n))}})(e,this.instance.persistence,n,r),this._fireFeatureFlagsCallbacks(t)}}},{key:"override",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!this.instance.__loaded||!this.instance.persistence)return pe.uninitializedWarning("posthog.feature_flags.override");if(this._override_warning=t,!1===e)this.instance.persistence.unregister(s_);else if(_r(e)){for(var n={},r=0;r<e.length;r++)n[e[r]]=!0;this.instance.persistence.register(de({},s_,n))}else this.instance.persistence.register(de({},s_,e))}},{key:"onFeatureFlags",value:function(e){var t=this;if(this.addFeatureFlagsHandler(e),this.instance.decideEndpointWasHit){var n=this._prepareFeatureFlagsForCallbacks(),r=n.flags,i=n.flagVariants;e(r,i)}return function(){return t.removeFeatureFlagsHandler(e)}}},{key:"updateEarlyAccessFeatureEnrollment",value:function(e,t){var n,r,i=de({},"$feature_enrollment/".concat(e),t);this.instance.capture("$feature_enrollment_update",{$feature_flag:e,$feature_enrollment:t,$set:i}),this.setPersonPropertiesForFlags(i,!1);var o=De(De({},this.getFlagVariants()),{},de({},e,t));null===(n=this.instance.persistence)||void 0===n||n.register((de(r={},YR,Object.keys(lj(o))),de(r,Rh,o),r)),this._fireFeatureFlagsCallbacks()}},{key:"getEarlyAccessFeatures",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=this.instance.get_property(Ox);if(r&&!n)return e(r);this.instance._send_request({transport:"XHR",url:this.instance.requestRouter.endpointFor("api","/api/early_access_features/?token=".concat(this.instance.config.token)),method:"GET",callback:function(n){var r;if(n.json){var i=n.json.earlyAccessFeatures;return null===(r=t.instance.persistence)||void 0===r||r.register(de({},Ox,i)),e(i)}}})}},{key:"_prepareFeatureFlagsForCallbacks",value:function(){var e=this.getFlags(),t=this.getFlagVariants();return{flags:e.filter((function(e){return t[e]})),flagVariants:Object.keys(t).filter((function(e){return t[e]})).reduce((function(e,n){return e[n]=t[n],e}),{})}}},{key:"_fireFeatureFlagsCallbacks",value:function(e){var t=this._prepareFeatureFlagsForCallbacks(),n=t.flags,r=t.flagVariants;this.featureFlagEventHandlers.forEach((function(t){return t(n,r,{errorsLoading:e})}))}},{key:"setPersonPropertiesForFlags",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=this.instance.get_property(Ih)||{};this.instance.register(de({},Ih,De(De({},n),e))),t&&this.instance.reloadFeatureFlags()}},{key:"resetPersonPropertiesForFlags",value:function(){this.instance.unregister(Ih)}},{key:"setGroupPropertiesForFlags",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=this.instance.get_property(Nc)||{};0!==Object.keys(n).length&&Object.keys(n).forEach((function(t){n[t]=De(De({},n[t]),e[t]),delete e[t]})),this.instance.register(de({},Nc,De(De({},n),e))),t&&this.instance.reloadFeatureFlags()}},{key:"resetGroupPropertiesForFlags",value:function(e){if(e){var t=this.instance.get_property(Nc)||{};this.instance.register(de({},Nc,De(De({},t),{},de({},e,{}))))}else this.instance.unregister(Nc)}}]),e}();Math.trunc||(Math.trunc=function(e){return e<0?Math.ceil(e):Math.floor(e)}),Number.isInteger||(Number.isInteger=function(e){return js(e)&&isFinite(e)&&Math.floor(e)===e});var cj="0123456789abcdef",NOe=function(){function e(t){if($t(this,e),this.bytes=t,16!==t.length)throw new TypeError("not 128-bit length")}return Ht(e,[{key:"toString",value:function(){for(var e="",t=0;t<this.bytes.length;t++)e=e+cj.charAt(this.bytes[t]>>>4)+cj.charAt(15&this.bytes[t]),3!==t&&5!==t&&7!==t&&9!==t||(e+="-");if(36!==e.length)throw new Error("Invalid UUIDv7 was generated");return e}},{key:"clone",value:function(){return new e(this.bytes.slice(0))}},{key:"equals",value:function(e){return 0===this.compareTo(e)}},{key:"compareTo",value:function(e){for(var t=0;t<16;t++){var n=this.bytes[t]-e.bytes[t];if(0!==n)return Math.sign(n)}return 0}}],[{key:"fromFieldsV7",value:function(t,n,r,i){if(!Number.isInteger(t)||!Number.isInteger(n)||!Number.isInteger(r)||!Number.isInteger(i)||t<0||n<0||r<0||i<0||t>0xffffffffffff||n>4095||r>1073741823||i>4294967295)throw new RangeError("invalid field value");var o=new Uint8Array(16);return o[0]=t/Math.pow(2,40),o[1]=t/Math.pow(2,32),o[2]=t/Math.pow(2,24),o[3]=t/Math.pow(2,16),o[4]=t/Math.pow(2,8),o[5]=t,o[6]=112|n>>>8,o[7]=n,o[8]=128|r>>>24,o[9]=r>>>16,o[10]=r>>>8,o[11]=r,o[12]=i>>>24,o[13]=i>>>16,o[14]=i>>>8,o[15]=i,new e(o)}}]),e}(),DOe=function(){function e(){$t(this,e),de(this,"timestamp",0),de(this,"counter",0),de(this,"random",new jOe)}return Ht(e,[{key:"generate",value:function(){var e=this.generateOrAbort();if(Ye(e)){this.timestamp=0;var t=this.generateOrAbort();if(Ye(t))throw new Error("Could not generate UUID after timestamp reset");return t}return e}},{key:"generateOrAbort",value:function(){var e=Date.now();if(e>this.timestamp)this.timestamp=e,this.resetCounter();else{if(!(e+1e4>this.timestamp))return;this.counter++,this.counter>4398046511103&&(this.timestamp++,this.resetCounter())}return NOe.fromFieldsV7(this.timestamp,Math.trunc(this.counter/Math.pow(2,30)),this.counter&Math.pow(2,30)-1,this.random.nextUint32())}},{key:"resetCounter",value:function(){this.counter=1024*this.random.nextUint32()+(1023&this.random.nextUint32())}}]),e}(),HX=function(e){if(typeof UUIDV7_DENY_WEAK_RNG<"u"&&UUIDV7_DENY_WEAK_RNG)throw new Error("no cryptographically strong RNG available");for(var t=0;t<e.length;t++)e[t]=65536*Math.trunc(65536*Math.random())+Math.trunc(65536*Math.random());return e};ie&&!Ye(ie.crypto)&&crypto.getRandomValues&&(HX=function(e){return crypto.getRandomValues(e)});var uj,jOe=function(){function e(){$t(this,e),de(this,"buffer",new Uint32Array(8)),de(this,"cursor",1/0)}return Ht(e,[{key:"nextUint32",value:function(){return this.cursor>=this.buffer.length&&(HX(this.buffer),this.cursor=0),this.buffer[this.cursor++]}}]),e}(),qc=function(){return UOe().toString()},UOe=function(){return(uj||(uj=new DOe)).generate()},FOe="Thu, 01 Jan 1970 00:00:00 GMT",mg="",$Oe=/[a-z0-9][a-z0-9-]+\.[a-z]{2,}$/i;function HOe(e,t){if(t){var n=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:He;if(mg)return mg;if(!t||["localhost","127.0.0.1"].includes(e))return"";for(var n=e.split("."),r=Math.min(n.length,8),i="dmn_chk_"+qc(),o=new RegExp("(^|;)\\s*"+i+"=1");!mg&&r--;){var s=n.slice(r).join("."),a=i+"=1;domain=."+s;t.cookie=a,o.test(t.cookie)&&(t.cookie=a+";expires="+FOe,mg=s)}return mg}(e);if(!n){var r=(i=e.match($Oe))?i[0]:"";r!==n&&pe.info("Warning: cookie subdomain discovery mismatch",r,n),n=r}return n?"; domain=."+n:""}var i;return""}var Br,Pl={is_supported:function(){return!!He},error:function(e){pe.error("cookieStore error: "+e)},get:function(e){if(He){try{for(var t=e+"=",n=He.cookie.split(";").filter((function(e){return e.length})),r=0;r<n.length;r++){for(var i=n[r];" "==i.charAt(0);)i=i.substring(1,i.length);if(0===i.indexOf(t))return decodeURIComponent(i.substring(t.length,i.length))}}catch{}return null}},parse:function(e){var t;try{t=JSON.parse(Pl.get(e))||{}}catch{}return t},set:function(e,t,n,r,i){if(He)try{var o="",s="",a=HOe(He.location.hostname,r);if(n){var l=new Date;l.setTime(l.getTime()+24*n*60*60*1e3),o="; expires="+l.toUTCString()}i&&(s="; secure");var c=e+"="+encodeURIComponent(JSON.stringify(t))+o+"; SameSite=Lax; path=/"+a+s;return c.length>3686.4&&pe.warn("cookieStore warning: large cookie, len="+c.length),He.cookie=c,c}catch{return}},remove:function(e,t){try{Pl.set(e,"",-1,t)}catch{return}}},JR=null,yr={is_supported:function(){if(!ql(JR))return JR;var e=!0;if(Ye(ie))e=!1;else try{var t="__mplssupport__";yr.set(t,"xyz"),'"xyz"'!==yr.get(t)&&(e=!1),yr.remove(t)}catch{e=!1}return e||pe.error("localStorage unsupported; falling back to cookie store"),JR=e,e},error:function(e){pe.error("localStorage error: "+e)},get:function(e){try{return null==ie?void 0:ie.localStorage.getItem(e)}catch(e){yr.error(e)}return null},parse:function(e){try{return JSON.parse(yr.get(e))||{}}catch{}return null},set:function(e,t){try{null==ie||ie.localStorage.setItem(e,JSON.stringify(t))}catch(e){yr.error(e)}},remove:function(e){try{null==ie||ie.localStorage.removeItem(e)}catch(e){yr.error(e)}}},BOe=["distinct_id",BS,cv,qS],o_=De(De({},yr),{},{parse:function(e){try{var t={};try{t=Pl.parse(e)||{}}catch{}var n=Si(t,JSON.parse(yr.get(e)||"{}"));return yr.set(e,n),n}catch{}return null},set:function(e,t,n,r,i,o){try{yr.set(e,t,void 0,void 0,o);var s={};BOe.forEach((function(e){t[e]&&(s[e]=t[e])})),Object.keys(s).length&&Pl.set(e,s,n,r,i,o)}catch(e){yr.error(e)}},remove:function(e,t){try{null==ie||ie.localStorage.removeItem(e),Pl.remove(e,t)}catch(e){yr.error(e)}}}),a_={},VOe={is_supported:function(){return!0},error:function(e){pe.error("memoryStorage error: "+e)},get:function(e){return a_[e]||null},parse:function(e){return a_[e]||null},set:function(e,t){a_[e]=t},remove:function(e){delete a_[e]}},ed=null,Gr={is_supported:function(){if(!ql(ed))return ed;if(ed=!0,Ye(ie))ed=!1;else try{var e="__support__";Gr.set(e,"xyz"),'"xyz"'!==Gr.get(e)&&(ed=!1),Gr.remove(e)}catch{ed=!1}return ed},error:function(e){pe.error("sessionStorage error: ",e)},get:function(e){try{return null==ie?void 0:ie.sessionStorage.getItem(e)}catch(e){Gr.error(e)}return null},parse:function(e){try{return JSON.parse(Gr.get(e))||null}catch{}return null},set:function(e,t){try{null==ie||ie.sessionStorage.setItem(e,JSON.stringify(t))}catch(e){Gr.error(e)}},remove:function(e){try{null==ie||ie.sessionStorage.removeItem(e)}catch(e){Gr.error(e)}}},qOe=["localhost","127.0.0.1"],uv=function(e){var t=null==He?void 0:He.createElement("a");return Ye(t)?null:(t.href=e,t)},KS=function(e,t){return!!function(e){try{new RegExp(e)}catch{return!1}return!0}(t)&&new RegExp(t).test(e)},KOe=function(e){var t,n,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"&",i=[];return on(e,(function(e,r){Ye(e)||Ye(r)||"undefined"===r||(t=encodeURIComponent(e instanceof File?e.name:e.toString()),n=encodeURIComponent(r),i[i.length]=n+"="+t)})),i.join(r)},dj=function(e,t){for(var n,r=((e.split("#")[0]||"").split("?")[1]||"").split("&"),i=0;i<r.length;i++){var o=r[i].split("=");if(o[0]===t){n=o;break}}if(!_r(n)||n.length<2)return"";var s=n[1];try{s=decodeURIComponent(s)}catch{pe.error("Skipping decoding for malformed query param: "+s)}return s.replace(/\+/g," ")},GS=function(e,t){var n=e.match(new RegExp(t+"=([^&]*)"));return n?n[1]:null},Ys="Mobile",WS="iOS",ba="Android",Qv="Tablet",BX=ba+" "+Qv,VX="iPad",qX="Apple",KX=qX+" Watch",ey="Safari",Cp="BlackBerry",GX="Samsung",WX=GX+"Browser",zX=GX+" Internet",tu="Chrome",GOe=tu+" OS",YX=tu+" "+WS,s4="Internet Explorer",JX=s4+" "+Ys,o4="Opera",WOe=o4+" Mini",a4="Edge",XX="Microsoft "+a4,Jh="Firefox",ZX=Jh+" "+WS,ty="Nintendo",ny="PlayStation",Xh="Xbox",QX=ba+" "+Ys,eZ=Ys+" "+ey,Ug="Windows",Fx=Ug+" Phone",fj="Nokia",$x="Ouya",tZ="Generic",zOe=tZ+" "+Ys.toLowerCase(),nZ=tZ+" "+Qv.toLowerCase(),Hx="Konqueror",gi="(\\d+(\\.\\d+)?)",XR=new RegExp("Version/"+gi),YOe=new RegExp(Xh,"i"),JOe=new RegExp(ny+" \\w+","i"),XOe=new RegExp(ty+" \\w+","i"),l4=new RegExp(Cp+"|PlayBook|BB10","i"),ZOe={"NT3.51":"NT 3.11","NT4.0":"NT 4.0","5.0":"2000",5.1:"XP",5.2:"XP","6.0":"Vista",6.1:"7",6.2:"8",6.3:"8.1",6.4:"10","10.0":"10"},QOe=function(e,t){return t&&Tt(t,qX)||Tt(n=e,ey)&&!Tt(n,tu)&&!Tt(n,ba);var n},hj=function(e,t){return t=t||"",Tt(e," OPR/")&&Tt(e,"Mini")?WOe:Tt(e," OPR/")?o4:l4.test(e)?Cp:Tt(e,"IE"+Ys)||Tt(e,"WPDesktop")?JX:Tt(e,WX)?zX:Tt(e,a4)||Tt(e,"Edg/")?XX:Tt(e,"FBIOS")?"Facebook "+Ys:Tt(e,"UCWEB")||Tt(e,"UCBrowser")?"UC Browser":Tt(e,"CriOS")?YX:Tt(e,"CrMo")?tu:Tt(e,ba)&&Tt(e,ey)?QX:Tt(e,tu)?tu:Tt(e,"FxiOS")?ZX:Tt(e.toLowerCase(),Hx.toLowerCase())?Hx:QOe(e,t)?Tt(e,Ys)?eZ:ey:Tt(e,Jh)?Jh:Tt(e,"MSIE")||Tt(e,"Trident/")?s4:Tt(e,"Gecko")?Jh:""},eMe=(de(Br={},JX,[new RegExp("rv:"+gi)]),de(Br,XX,[new RegExp(a4+"?\\/"+gi)]),de(Br,tu,[new RegExp("("+tu+"|CrMo)\\/"+gi)]),de(Br,YX,[new RegExp("CriOS\\/"+gi)]),de(Br,"UC Browser",[new RegExp("(UCBrowser|UCWEB)\\/"+gi)]),de(Br,ey,[XR]),de(Br,eZ,[XR]),de(Br,o4,[new RegExp("(Opera|OPR)\\/"+gi)]),de(Br,Jh,[new RegExp(Jh+"\\/"+gi)]),de(Br,ZX,[new RegExp("FxiOS\\/"+gi)]),de(Br,Hx,[new RegExp("Konqueror[:/]?"+gi,"i")]),de(Br,Cp,[new RegExp(Cp+" "+gi),XR]),de(Br,QX,[new RegExp("android\\s"+gi,"i")]),de(Br,zX,[new RegExp(WX+"\\/"+gi)]),de(Br,s4,[new RegExp("(rv:|MSIE )"+gi)]),de(Br,"Mozilla",[new RegExp("rv:"+gi)]),Br),pj=[[new RegExp(Xh+"; "+Xh+" (.*?)[);]","i"),function(e){return[Xh,e&&e[1]||""]}],[new RegExp(ty,"i"),[ty,""]],[new RegExp(ny,"i"),[ny,""]],[l4,[Cp,""]],[new RegExp(Ug,"i"),function(e,t){if(/Phone/.test(t)||/WPDesktop/.test(t))return[Fx,""];if(new RegExp(Ys).test(t)&&!/IEMobile\b/.test(t))return[Ug+" "+Ys,""];var n=/Windows NT ([0-9.]+)/i.exec(t);if(n&&n[1]){var r=n[1],i=ZOe[r]||"";return/arm/i.test(t)&&(i="RT"),[Ug,i]}return[Ug,""]}],[/((iPhone|iPad|iPod).*?OS (\d+)_(\d+)_?(\d+)?|iPhone)/,function(e){if(e&&e[3]){var t=[e[3],e[4],e[5]||"0"];return[WS,t.join(".")]}return[WS,""]}],[/(watch.*\/(\d+\.\d+\.\d+)|watch os,(\d+\.\d+),)/i,function(e){var t="";return e&&e.length>=3&&(t=Ye(e[2])?e[3]:e[2]),["watchOS",t]}],[new RegExp("("+ba+" (\\d+)\\.(\\d+)\\.?(\\d+)?|"+ba+")","i"),function(e){if(e&&e[2]){var t=[e[2],e[3],e[4]||"0"];return[ba,t.join(".")]}return[ba,""]}],[/Mac OS X (\d+)[_.](\d+)[_.]?(\d+)?/i,function(e){var t=["Mac OS X",""];if(e&&e[1]){var n=[e[1],e[2],e[3]||"0"];t[1]=n.join(".")}return t}],[/Mac/i,["Mac OS X",""]],[/CrOS/,[GOe,""]],[/Linux|debian/i,["Linux",""]]],mj=function(e){return XOe.test(e)?ty:JOe.test(e)?ny:YOe.test(e)?Xh:new RegExp($x,"i").test(e)?$x:new RegExp("("+Fx+"|WPDesktop)","i").test(e)?Fx:/iPad/.test(e)?VX:/iPod/.test(e)?"iPod Touch":/iPhone/.test(e)?"iPhone":/(watch)(?: ?os[,/]|\d,\d\/)[\d.]+/i.test(e)?KX:l4.test(e)?Cp:/(kobo)\s(ereader|touch)/i.test(e)?"Kobo":new RegExp(fj,"i").test(e)?fj:/(kf[a-z]{2}wi|aeo[c-r]{2})( bui|\))/i.test(e)||/(kf[a-z]+)( bui|\)).+silk\//i.test(e)?"Kindle Fire":/(Android|ZTE)/i.test(e)?!new RegExp(Ys).test(e)||/(9138B|TB782B|Nexus [97]|pixel c|HUAWEISHT|BTV|noble nook|smart ultra 6)/i.test(e)?/pixel[\daxl ]{1,6}/i.test(e)&&!/pixel c/i.test(e)||/(huaweimed-al00|tah-|APA|SM-G92|i980|zte|U304AA)/i.test(e)||/lmy47v/i.test(e)&&!/QTAQZ3/i.test(e)?ba:BX:ba:new RegExp("(pda|"+Ys+")","i").test(e)?zOe:new RegExp(Qv,"i").test(e)&&!new RegExp(Qv+" pc","i").test(e)?nZ:""},l_="https?://(.*)",tMe=["utm_source","utm_medium","utm_campaign","utm_content","utm_term","gclid","gad_source","gclsrc","dclid","gbraid","wbraid","fbclid","msclkid","twclid","li_fat_id","mc_cid","igshid","ttclid","rdt_cid"],xr={campaignParams:function(e){return He?this._campaignParamsFromUrl(He.URL,e):{}},_campaignParamsFromUrl:function(e,t){var n=tMe.concat(t||[]),r={};return on(n,(function(t){var n=dj(e,t);n&&(r[t]=n)})),r},_searchEngine:function(e){return e?0===e.search(l_+"google.([^/?]*)")?"google":0===e.search(l_+"bing.com")?"bing":0===e.search(l_+"yahoo.com")?"yahoo":0===e.search(l_+"duckduckgo.com")?"duckduckgo":null:null},_searchInfoFromReferrer:function(e){var t=xr._searchEngine(e),n="yahoo"!=t?"q":"p",r={};if(!ql(t)){r.$search_engine=t;var i=He?dj(He.referrer,n):"";i.length&&(r.ph_keyword=i)}return r},searchInfo:function(){var e=null==He?void 0:He.referrer;return e?this._searchInfoFromReferrer(e):{}},browser:hj,browserVersion:function(e,t){var n=hj(e,t),r=eMe[n];if(Ye(r))return null;for(var i=0;i<r.length;i++){var o=r[i],s=e.match(o);if(s)return parseFloat(s[s.length-2])}return null},browserLanguage:function(){return navigator.language||navigator.userLanguage},os:function(e){for(var t=0;t<pj.length;t++){var n=bi(pj[t],2),r=n[0],i=n[1],o=r.exec(e),s=o&&(qs(i)?i(o,e):i);if(s)return s}return["",""]},device:mj,deviceType:function(e){var t=mj(e);return t===VX||t===BX||"Kobo"===t||"Kindle Fire"===t||t===nZ?Qv:t===ty||t===Xh||t===ny||t===$x?"Console":t===KX?"Wearable":t?Ys:"Desktop"},referrer:function(){return(null==He?void 0:He.referrer)||"$direct"},referringDomain:function(){var e;return null!=He&&He.referrer&&(null===(e=uv(He.referrer))||void 0===e?void 0:e.host)||"$direct"},referrerInfo:function(){return{$referrer:this.referrer(),$referring_domain:this.referringDomain()}},initialPersonInfo:function(){return{r:this.referrer(),u:null==$i?void 0:$i.href}},initialPersonPropsFromInfo:function(e){var t,n=e.r,r=e.u,i={$initial_referrer:n,$initial_referring_domain:null==n?void 0:"$direct"==n?"$direct":null===(t=uv(n))||void 0===t?void 0:t.host};if(r){i.$initial_current_url=r;var o=uv(r);i.$initial_host=null==o?void 0:o.host,i.$initial_pathname=null==o?void 0:o.pathname,on(this._campaignParamsFromUrl(r),(function(e,t){i["$initial_"+xx(t)]=e}))}return n&&on(this._searchInfoFromReferrer(n),(function(e,t){i["$initial_"+xx(t)]=e})),i},properties:function(){if(!kr)return{};var e=bi(xr.os(kr),2),t=e[0],n=e[1];return Si(kx({$os:t,$os_version:n,$browser:xr.browser(kr,navigator.vendor),$device:xr.device(kr),$device_type:xr.deviceType(kr)}),{$current_url:null==$i?void 0:$i.href,$host:null==$i?void 0:$i.host,$pathname:null==$i?void 0:$i.pathname,$raw_user_agent:kr.length>1e3?kr.substring(0,997)+"...":kr,$browser_version:xr.browserVersion(kr,navigator.vendor),$browser_language:xr.browserLanguage(),$screen_height:null==ie?void 0:ie.screen.height,$screen_width:null==ie?void 0:ie.screen.width,$viewport_height:null==ie?void 0:ie.innerHeight,$viewport_width:null==ie?void 0:ie.innerWidth,$lib:"web",$lib_version:Ds.LIB_VERSION,$insert_id:Math.random().toString(36).substring(2,10)+Math.random().toString(36).substring(2,10),$time:UX()/1e3})},people_properties:function(){if(!kr)return{};var e=bi(xr.os(kr),2),t=e[0],n=e[1];return Si(kx({$os:t,$os_version:n,$browser:xr.browser(kr,navigator.vendor)}),{$browser_version:xr.browserVersion(kr,navigator.vendor)})}},nMe=["cookie","localstorage","localstorage+cookie","sessionstorage","memory"],ZR=function(){function e(t){var n,r;$t(this,e),this.config=t,this.props={},this.campaign_params_saved=!1,this.name=(r="",(n=t).token&&(r=n.token.replace(/\+/g,"PL").replace(/\//g,"SL").replace(/=/g,"EQ")),n.persistence_name?"ph_"+n.persistence_name:"ph_"+r+"_posthog"),this.storage=this.buildStorage(t),this.load(),t.debug&&pe.info("Persistence loaded",t.persistence,De({},this.props)),this.update_config(t,t),this.save()}return Ht(e,[{key:"buildStorage",value:function(e){-1===nMe.indexOf(e.persistence.toLowerCase())&&(pe.critical("Unknown persistence type "+e.persistence+"; falling back to localStorage+cookie"),e.persistence="localStorage+cookie");var t=e.persistence.toLowerCase();return"localstorage"===t&&yr.is_supported()?yr:"localstorage+cookie"===t&&o_.is_supported()?o_:"sessionstorage"===t&&Gr.is_supported()?Gr:"memory"===t?VOe:"cookie"===t?Pl:o_.is_supported()?o_:Pl}},{key:"properties",value:function(){var e={};return on(this.props,(function(t,n){if(n===Rh&&Wr(t))for(var r=Object.keys(t),i=0;i<r.length;i++)e["$feature/".concat(r[i])]=t[r[i]];else s=n,a=!1,(ql(o=MOe)?a:WD&&o.indexOf===WD?-1!=o.indexOf(s):(on(o,(function(e){if(a||(a=e===s))return HS})),a))||(e[n]=t);var o,s,a})),e}},{key:"load",value:function(){if(!this.disabled){var e=this.storage.parse(this.name);e&&(this.props=Si({},e))}}},{key:"save",value:function(){this.disabled||this.storage.set(this.name,this.props,this.expire_days,this.cross_subdomain,this.secure,this.config.debug)}},{key:"remove",value:function(){this.storage.remove(this.name,!1),this.storage.remove(this.name,!0)}},{key:"clear",value:function(){this.remove(),this.props={}}},{key:"register_once",value:function(e,t,n){var r=this;if(Wr(e)){Ye(t)&&(t="None"),this.expire_days=Ye(n)?this.default_expiry:n;var i=!1;if(on(e,(function(e,n){r.props.hasOwnProperty(n)&&r.props[n]!==t||(r.props[n]=e,i=!0)})),i)return this.save(),!0}return!1}},{key:"register",value:function(e,t){var n=this;if(Wr(e)){this.expire_days=Ye(t)?this.default_expiry:t;var r=!1;if(on(e,(function(t,i){e.hasOwnProperty(i)&&n.props[i]!==t&&(n.props[i]=t,r=!0)})),r)return this.save(),!0}return!1}},{key:"unregister",value:function(e){e in this.props&&(delete this.props[e],this.save())}},{key:"update_campaign_params",value:function(){this.campaign_params_saved||(this.register(xr.campaignParams(this.config.custom_campaign_params)),this.campaign_params_saved=!0)}},{key:"update_search_keyword",value:function(){this.register(xr.searchInfo())}},{key:"update_referrer_info",value:function(){this.register_once(xr.referrerInfo(),void 0)}},{key:"set_initial_person_info",value:function(){this.props[Dx]||this.props[jx]||this.register_once(de({},oj,xr.initialPersonInfo()),void 0)}},{key:"get_referrer_info",value:function(){return kx({$referrer:this.props.$referrer,$referring_domain:this.props.$referring_domain})}},{key:"get_initial_props",value:function(){var e=this,t={};on([jx,Dx],(function(n){var r=e.props[n];r&&on(r,(function(e,n){t["$initial_"+xx(n)]=e}))}));var n=this.props[oj];if(n){var r=xr.initialPersonPropsFromInfo(n);Si(t,r)}return t}},{key:"safe_merge",value:function(e){return on(this.props,(function(t,n){n in e||(e[n]=t)})),e}},{key:"update_config",value:function(e,t){if(this.default_expiry=this.expire_days=e.cookie_expiration,this.set_disabled(e.disable_persistence),this.set_cross_subdomain(e.cross_subdomain_cookie),this.set_secure(e.secure_cookie),e.persistence!==t.persistence){var n=this.buildStorage(e),r=this.props;this.clear(),this.storage=n,this.props=r,this.save()}}},{key:"set_disabled",value:function(e){this.disabled=e,this.disabled?this.remove():this.save()}},{key:"set_cross_subdomain",value:function(e){e!==this.cross_subdomain&&(this.cross_subdomain=e,this.remove(),this.save())}},{key:"get_cross_subdomain",value:function(){return!!this.cross_subdomain}},{key:"set_secure",value:function(e){e!==this.secure&&(this.secure=e,this.remove(),this.save())}},{key:"set_event_timer",value:function(e,t){var n=this.props[jg]||{};n[e]=t,this.props[jg]=n,this.save()}},{key:"remove_event_timer",value:function(e){var t=(this.props[jg]||{})[e];return Ye(t)||(delete this.props[jg][e],this.save()),t}},{key:"get_property",value:function(e){return this.props[e]}},{key:"set_property",value:function(e,t){this.props[e]=t,this.save()}}]),e}();function Bx(e){return JSON.stringify(e,(t=[],function(e,n){if(Wr(n)){for(;t.length>0&&t.at(-1)!==this;)t.pop();return t.includes(n)?"[Circular]":(t.push(n),n)}return n})).length;var t}var rMe=2,iMe=4;function Vx(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:6606028.8;if(e.size>=t&&e.data.length>1){var n=Math.floor(e.data.length/2),r=e.data.slice(0,n),i=e.data.slice(n);return[Vx({size:Bx(r),data:r,sessionId:e.sessionId,windowId:e.windowId}),Vx({size:Bx(i),data:i,sessionId:e.sessionId,windowId:e.windowId})].flatMap((function(e){return e}))}return[e]}var Pb=function(e){return e[e.DomContentLoaded=0]="DomContentLoaded",e[e.Load=1]="Load",e[e.FullSnapshot=2]="FullSnapshot",e[e.IncrementalSnapshot=3]="IncrementalSnapshot",e[e.Meta=4]="Meta",e[e.Custom=5]="Custom",e[e.Plugin=6]="Plugin",e}(Pb||{}),tl=function(e){return e[e.Mutation=0]="Mutation",e[e.MouseMove=1]="MouseMove",e[e.MouseInteraction=2]="MouseInteraction",e[e.Scroll=3]="Scroll",e[e.ViewportResize=4]="ViewportResize",e[e.Input=5]="Input",e[e.TouchMove=6]="TouchMove",e[e.MediaInteraction=7]="MediaInteraction",e[e.StyleSheetRule=8]="StyleSheetRule",e[e.CanvasMutation=9]="CanvasMutation",e[e.Font=10]="Font",e[e.Log=11]="Log",e[e.Drag=12]="Drag",e[e.StyleDeclaration=13]="StyleDeclaration",e[e.Selection=14]="Selection",e[e.AdoptedStyleSheet=15]="AdoptedStyleSheet",e[e.CustomElement=16]="CustomElement",e}(tl||{});function c4(e){return e?Mw(e).split(/\s+/):[]}function gj(e){var t=null==ie?void 0:ie.location.href;return!!(t&&e&&e.some((function(e){return t.match(e)})))}function zS(e){var t="";switch(Zv(e.className)){case"string":t=e.className;break;case"object":t=(e.className&&"baseVal"in e.className?e.className.baseVal:null)||e.getAttribute("class")||"";break;default:t=""}return c4(t)}function rZ(e){return Qi(e)?null:Mw(e).split(/(\s+)/).filter((function(e){return Zh(e)})).join("").replace(/[\r\n]/g," ").replace(/[ ]+/g," ").substring(0,255)}function YS(e){var t="";return Kx(e)&&!aZ(e)&&e.childNodes&&e.childNodes.length&&on(e.childNodes,(function(e){var n;iZ(e)&&e.textContent&&(t+=null!==(n=rZ(e.textContent))&&void 0!==n?n:"")})),Mw(t)}function u4(e){return!!e&&1===e.nodeType}function nu(e,t){return!!e&&!!e.tagName&&e.tagName.toLowerCase()===t.toLowerCase()}function iZ(e){return!!e&&3===e.nodeType}function sZ(e){return!!e&&11===e.nodeType}var qx=["a","button","form","input","select","textarea","label"];function oZ(e){var t=e.parentNode;return!(!t||!u4(t))&&t}function sMe(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0,i=arguments.length>4?arguments[4]:void 0;if(!ie||!e||nu(e,"html")||!u4(e)||null!=n&&n.url_allowlist&&!gj(n.url_allowlist)||null!=n&&n.url_ignorelist&&gj(n.url_ignorelist))return!1;if(null!=n&&n.dom_event_allowlist){var o=n.dom_event_allowlist;if(o&&!o.some((function(e){return t.type===e})))return!1}for(var s=!1,a=[e],l=!0,c=e;c.parentNode&&!nu(c,"body");)if(sZ(c.parentNode))a.push(c.parentNode.host),c=c.parentNode.host;else{if(!(l=oZ(c)))break;if(r||qx.indexOf(l.tagName.toLowerCase())>-1)s=!0;else{var u=ie.getComputedStyle(l);u&&"pointer"===u.getPropertyValue("cursor")&&(s=!0)}a.push(l),c=l}if(!function(e,t){var n=null==t?void 0:t.element_allowlist;if(Ye(n))return!0;var r,i=eo(e);try{var o=function(){var e=r.value;if(n.some((function(t){return e.tagName.toLowerCase()===t})))return{v:!0}};for(i.s();!(r=i.n()).done;){var s=o();if("object"===Zv(s))return s.v}}catch(e){i.e(e)}finally{i.f()}return!1}(a,n)||!function(e,t){var n=null==t?void 0:t.css_selector_allowlist;if(Ye(n))return!0;var r,i=eo(e);try{var o=function(){var e=r.value;if(n.some((function(t){return e.matches(t)})))return{v:!0}};for(i.s();!(r=i.n()).done;){var s=o();if("object"===Zv(s))return s.v}}catch(e){i.e(e)}finally{i.f()}return!1}(a,n))return!1;var d=ie.getComputedStyle(e);if(d&&"pointer"===d.getPropertyValue("cursor")&&"click"===t.type)return!0;var h=e.tagName.toLowerCase();switch(h){case"html":return!1;case"form":return(i||["submit"]).indexOf(t.type)>=0;case"input":case"select":case"textarea":return(i||["change","click"]).indexOf(t.type)>=0;default:return s?(i||["click"]).indexOf(t.type)>=0:(i||["click"]).indexOf(t.type)>=0&&(qx.indexOf(h)>-1||"true"===e.getAttribute("contenteditable"))}}function Kx(e){for(var t=e;t.parentNode&&!nu(t,"body");t=t.parentNode){var n=zS(t);if(Tt(n,"ph-sensitive")||Tt(n,"ph-no-capture"))return!1}if(Tt(zS(e),"ph-include"))return!0;var r=e.type||"";if(ci(r))switch(r.toLowerCase()){case"hidden":case"password":return!1}var i=e.name||e.id||"";return!(ci(i)&&/^cc|cardnum|ccnum|creditcard|csc|cvc|cvv|exp|pass|pwd|routing|seccode|securitycode|securitynum|socialsec|socsec|ssn/i.test(i.replace(/[^a-zA-Z0-9]/g,"")))}function aZ(e){return!!(nu(e,"input")&&!["button","checkbox","submit","reset"].includes(e.type)||nu(e,"select")||nu(e,"textarea")||"true"===e.getAttribute("contenteditable"))}var lZ="(4[0-9]{12}(?:[0-9]{3})?)|(5[1-5][0-9]{14})|(6(?:011|5[0-9]{2})[0-9]{12})|(3[47][0-9]{13})|(3(?:0[0-5]|[68][0-9])[0-9]{11})|((?:2131|1800|35[0-9]{3})[0-9]{11})",oMe=new RegExp("^(?:".concat(lZ,")$")),aMe=new RegExp(lZ),cZ="\\d{3}-?\\d{2}-?\\d{4}",lMe=new RegExp("^(".concat(cZ,")$")),cMe=new RegExp("(".concat(cZ,")"));function Zh(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return!(Qi(e)||ci(e)&&(e=Mw(e),(t?oMe:aMe).test((e||"").replace(/[- ]/g,""))||(t?lMe:cMe).test(e)))}function vj(e){var t=YS(e);return Zh(t="".concat(t," ").concat(uZ(e)).trim())?t:""}function uZ(e){var t="";return e&&e.childNodes&&e.childNodes.length&&on(e.childNodes,(function(e){var n;if(e&&"span"===(null===(n=e.tagName)||void 0===n?void 0:n.toLowerCase()))try{var r=YS(e);t="".concat(t," ").concat(r).trim(),e.childNodes&&e.childNodes.length&&(t="".concat(t," ").concat(uZ(e)).trim())}catch(e){pe.error(e)}})),t}function uMe(e){return function(e){return e.map((function(e){var t,n,r="";if(e.tag_name&&(r+=e.tag_name),e.attr_class){e.attr_class.sort();var i,o=eo(e.attr_class);try{for(o.s();!(i=o.n()).done;){var s=i.value;r+=".".concat(s.replace(/"/g,""))}}catch(e){o.e(e)}finally{o.f()}}var a=De(De(De(De({},e.text?{text:e.text}:{}),{},{"nth-child":null!==(t=e.nth_child)&&void 0!==t?t:0,"nth-of-type":null!==(n=e.nth_of_type)&&void 0!==n?n:0},e.href?{href:e.href}:{}),e.attr_id?{attr_id:e.attr_id}:{}),e.attributes),l={};return xb(a).sort((function(e,t){var n=bi(e,1)[0],r=bi(t,1)[0];return n.localeCompare(r)})).forEach((function(e){var t=bi(e,2),n=t[0],r=t[1];return l[yj(n.toString())]=yj(r.toString())})),(r+=":")+xb(a).map((function(e){var t=bi(e,2),n=t[0],r=t[1];return"".concat(n,'="').concat(r,'"')})).join("")})).join(";")}(e.map((function(e){var t,n,r={text:null===(t=e.$el_text)||void 0===t?void 0:t.slice(0,400),tag_name:e.tag_name,href:null===(n=e.attr__href)||void 0===n?void 0:n.slice(0,2048),attr_class:dMe(e),attr_id:e.attr__id,nth_child:e.nth_child,nth_of_type:e.nth_of_type,attributes:{}};return xb(e).filter((function(e){return 0===bi(e,1)[0].indexOf("attr__")})).forEach((function(e){var t=bi(e,2),n=t[0],i=t[1];return r.attributes[n]=i})),r})))}function yj(e){return e.replace(/"|\\"/g,'\\"')}function dMe(e){var t=e.attr__class;return t?_r(t)?t:c4(t):void 0}var Gx="[SessionRecording]",Wx="redacted",c_={initiatorTypes:["audio","beacon","body","css","early-hint","embed","fetch","frame","iframe","icon","image","img","input","link","navigation","object","ping","script","track","video","xmlhttprequest"],maskRequestFn:function(e){return e},recordHeaders:!1,recordBody:!1,recordInitialRequests:!1,recordPerformance:!1,performanceEntryTypeToObserve:["first-input","navigation","paint","resource"],payloadSizeLimitBytes:1e6,payloadHostDenyList:[".lr-ingest.io",".ingest.sentry.io"]},fMe=["authorization","x-forwarded-for","authorization","cookie","set-cookie","x-api-key","x-real-ip","remote-addr","forwarded","proxy-authorization","x-csrf-token","x-csrftoken","x-xsrf-token"],hMe=["password","secret","passwd","api_key","apikey","auth","credentials","mysql_pwd","privatekey","private_key","token"],pMe=["/s/","/e/","/i/"];function _j(e,t,n,r){if(Qi(e))return e;var i=(null==t?void 0:t["content-length"])||new Blob([e]).size;return ci(i)&&(i=parseInt(i)),i>n?Gx+" ".concat(r," body too large to record (").concat(i," bytes)"):e}function bj(e,t){if(Qi(e))return e;var n=e;return Zh(n,!1)||(n=Gx+" "+t+" body "+Wx),on(hMe,(function(e){var r,i;null!==(r=n)&&void 0!==r&&r.length&&-1!==(null===(i=n)||void 0===i?void 0:i.indexOf(e))&&(n=Gx+" "+t+" body "+Wx+" as might contain: "+e)})),n}var ll,mMe=function(e,t){var n,r,i,o={payloadSizeLimitBytes:c_.payloadSizeLimitBytes,performanceEntryTypeToObserve:xl(c_.performanceEntryTypeToObserve),payloadHostDenyList:[].concat(xl(t.payloadHostDenyList||[]),xl(c_.payloadHostDenyList))},s=!1!==e.session_recording.recordHeaders&&t.recordHeaders,a=!1!==e.session_recording.recordBody&&t.recordBody,l=!1!==e.capture_performance&&t.recordPerformance,c=(n=o,i=Math.min(1e6,null!==(r=n.payloadSizeLimitBytes)&&void 0!==r?r:1e6),function(e){return null!=e&&e.requestBody&&(e.requestBody=_j(e.requestBody,e.requestHeaders,i,"Request")),null!=e&&e.responseBody&&(e.responseBody=_j(e.responseBody,e.responseHeaders,i,"Response")),e}),u=function(e){return c(function(e){var t=uv(e.name);if(!(t&&t.pathname&&pMe.some((function(e){return 0===t.pathname.indexOf(e)}))))return e}((n=(t=e).requestHeaders,Qi(n)||on(Object.keys(n??{}),(function(e){fMe.includes(e.toLowerCase())&&(n[e]=Wx)})),t)));var t,n},d=qs(e.session_recording.maskNetworkRequestFn);return d&&qs(e.session_recording.maskCapturedNetworkRequestFn)&&pe.warn("Both `maskNetworkRequestFn` and `maskCapturedNetworkRequestFn` are defined. `maskNetworkRequestFn` will be ignored."),d&&(e.session_recording.maskCapturedNetworkRequestFn=function(t){var n=e.session_recording.maskNetworkRequestFn({url:t.name});return De(De({},t),{},{name:null==n?void 0:n.url})}),o.maskRequestFn=qs(e.session_recording.maskCapturedNetworkRequestFn)?function(t){var n,r,i,o=u(t);return o&&null!==(n=null===(r=(i=e.session_recording).maskCapturedNetworkRequestFn)||void 0===r?void 0:r.call(i,o))&&void 0!==n?n:void 0}:function(e){return function(e){if(!Ye(e))return e.requestBody=bj(e.requestBody,"Request"),e.responseBody=bj(e.responseBody,"Response"),e}(u(e))},De(De(De({},c_),o),{},{recordHeaders:s,recordBody:a,recordPerformance:l,recordInitialRequests:l})},gMe=Ht((function e(t){var n,r,i=this,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};$t(this,e),de(this,"bucketSize",100),de(this,"refillRate",10),de(this,"mutationBuckets",{}),de(this,"loggedTracker",{}),de(this,"refillBuckets",(function(){Object.keys(i.mutationBuckets).forEach((function(e){i.mutationBuckets[e]=i.mutationBuckets[e]+i.refillRate,i.mutationBuckets[e]>=i.bucketSize&&delete i.mutationBuckets[e]}))})),de(this,"getNodeOrRelevantParent",(function(e){var t=i.rrweb.mirror.getNode(e);if("svg"!==(null==t?void 0:t.nodeName)&&t instanceof Element){var n=t.closest("svg");if(n)return[i.rrweb.mirror.getId(n),n]}return[e,t]})),de(this,"numberOfChanges",(function(e){var t,n,r,i,o,s,a,l;return(null!==(t=null===(n=e.removes)||void 0===n?void 0:n.length)&&void 0!==t?t:0)+(null!==(r=null===(i=e.attributes)||void 0===i?void 0:i.length)&&void 0!==r?r:0)+(null!==(o=null===(s=e.texts)||void 0===s?void 0:s.length)&&void 0!==o?o:0)+(null!==(a=null===(l=e.adds)||void 0===l?void 0:l.length)&&void 0!==a?a:0)})),de(this,"throttleMutations",(function(e){if(3!==e.type||0!==e.data.source)return e;var t=e.data,n=i.numberOfChanges(t);t.attributes&&(t.attributes=t.attributes.filter((function(e){var t,n,r,o=bi(i.getNodeOrRelevantParent(e.id),2),s=o[0],a=o[1];return 0!==i.mutationBuckets[s]&&(i.mutationBuckets[s]=null!==(t=i.mutationBuckets[s])&&void 0!==t?t:i.bucketSize,i.mutationBuckets[s]=Math.max(i.mutationBuckets[s]-1,0),0===i.mutationBuckets[s]&&(i.loggedTracker[s]||(i.loggedTracker[s]=!0,null===(n=(r=i.options).onBlockedNode)||void 0===n||n.call(r,s,a))),e)})));var r=i.numberOfChanges(t);return 0!==r||n===r?e:void 0})),this.rrweb=t,this.options=o,this.refillRate=null!==(n=this.options.refillRate)&&void 0!==n?n:this.refillRate,this.bucketSize=null!==(r=this.options.bucketSize)&&void 0!==r?r:this.bucketSize,setInterval((function(){i.refillBuckets()}),1e3)})),vMe=3e5,yMe=[tl.MouseMove,tl.MouseInteraction,tl.Scroll,tl.ViewportResize,tl.Input,tl.TouchMove,tl.MediaInteraction,tl.Drag],Sj=function(e){return{rrwebMethod:e,enqueuedAt:Date.now(),attempt:1}},Ms="[SessionRecording]",_Me=function(){function e(t){var n=this;if($t(this,e),de(this,"queuedRRWebEvents",[]),de(this,"isIdle",!1),de(this,"_linkedFlagSeen",!1),de(this,"_lastActivityTimestamp",Date.now()),de(this,"_linkedFlag",null),de(this,"_forceAllowLocalhostNetworkCapture",!1),de(this,"_onBeforeUnload",(function(){n._flushBuffer()})),de(this,"_onOffline",(function(){n._tryAddCustomEvent("browser offline",{})})),de(this,"_onOnline",(function(){n._tryAddCustomEvent("browser online",{})})),de(this,"_onVisibilityChange",(function(){if(null!=He&&He.visibilityState){var e="window "+He.visibilityState;n._tryAddCustomEvent(e,{})}})),de(this,"_samplingSessionListener",null),this.instance=t,this._captureStarted=!1,this._endpoint="/s/",this.stopRrweb=void 0,this.receivedDecide=!1,!this.instance.sessionManager)throw pe.error(Ms+" started without valid sessionManager"),new Error(Ms+" started without valid sessionManager. This is a bug.");var r=this.sessionManager.checkAndGetSessionAndWindowId(),i=r.sessionId,o=r.windowId;this.sessionId=i,this.windowId=o,this.buffer=this.clearBuffer(),this._setupSampling()}return Ht(e,[{key:"rrwebRecord",get:function(){var e;return null==In||null===(e=In.rrweb)||void 0===e?void 0:e.record}},{key:"started",get:function(){return this._captureStarted}},{key:"sessionManager",get:function(){if(!this.instance.sessionManager)throw new Error(Ms+" must be started with a valid sessionManager.");return this.instance.sessionManager}},{key:"fullSnapshotIntervalMillis",get:function(){var e;return(null===(e=this.instance.config.session_recording)||void 0===e?void 0:e.full_snapshot_interval_millis)||vMe}},{key:"isSampled",get:function(){var e=this.instance.get_property(cv);return _d(e)?e:null}},{key:"sessionDuration",get:function(){var e,t,n=null===(e=this.buffer)||void 0===e?void 0:e.data[(null===(t=this.buffer)||void 0===t?void 0:t.data.length)-1],r=this.sessionManager.checkAndGetSessionAndWindowId(!0).sessionStartTimestamp;return n?n.timestamp-r:null}},{key:"isRecordingEnabled",get:function(){var e=!!this.instance.get_property(Lx),t=!this.instance.config.disable_session_recording;return ie&&e&&t}},{key:"isConsoleLogCaptureEnabled",get:function(){var e=!!this.instance.get_property(tj);return this.instance.config.enable_recording_console_log??e}},{key:"canvasRecording",get:function(){var e=this.instance.get_property(rj);return e&&e.fps&&e.quality?{enabled:e.enabled,fps:e.fps,quality:e.quality}:void 0}},{key:"networkPayloadCapture",get:function(){var e,t,n=this.instance.get_property(nj),r={recordHeaders:null===(e=this.instance.config.session_recording)||void 0===e?void 0:e.recordHeaders,recordBody:null===(t=this.instance.config.session_recording)||void 0===t?void 0:t.recordBody},i=(null==r?void 0:r.recordHeaders)||(null==n?void 0:n.recordHeaders),o=(null==r?void 0:r.recordBody)||(null==n?void 0:n.recordBody),s=Wr(this.instance.config.capture_performance)?this.instance.config.capture_performance.network_timing:this.instance.config.capture_performance,a=!!(_d(s)?s:null!=n&&n.capturePerformance);return i||o||a?{recordHeaders:i,recordBody:o,recordPerformance:a}:void 0}},{key:"sampleRate",get:function(){var e=this.instance.get_property(ij);return js(e)?e:null}},{key:"minimumDuration",get:function(){var e=this.instance.get_property(sj);return js(e)?e:null}},{key:"status",get:function(){return this.receivedDecide?this.isRecordingEnabled?Qi(this._linkedFlag)||this._linkedFlagSeen?_d(this.isSampled)?this.isSampled?"sampled":"disabled":"active":"buffering":"disabled":"buffering"}},{key:"startIfEnabledOrStop",value:function(){this.isRecordingEnabled?(this._startCapture(),null==ie||ie.addEventListener("beforeunload",this._onBeforeUnload),null==ie||ie.addEventListener("offline",this._onOffline),null==ie||ie.addEventListener("online",this._onOnline),null==ie||ie.addEventListener("visibilitychange",this._onVisibilityChange),pe.info(Ms+" started")):(this.stopRecording(),this.clearBuffer(),clearInterval(this._fullSnapshotTimer))}},{key:"stopRecording",value:function(){this._captureStarted&&this.stopRrweb&&(this.stopRrweb(),this.stopRrweb=void 0,this._captureStarted=!1,null==ie||ie.removeEventListener("beforeunload",this._onBeforeUnload),null==ie||ie.removeEventListener("offline",this._onOffline),null==ie||ie.removeEventListener("online",this._onOnline),null==ie||ie.removeEventListener("visibilitychange",this._onVisibilityChange),pe.info(Ms+" stopped"))}},{key:"makeSamplingDecision",value:function(e){var t,n=this.sessionId!==e,r=this.sampleRate;if(js(r)){var i,o=this.isSampled,s=n||!_d(o);!(i=s?Math.random()<r:o)&&s&&pe.warn(Ms+" Sample rate (".concat(r,") has determined that this sessionId (").concat(e,") will not be sent to the server.")),this._tryAddCustomEvent("samplingDecisionMade",{sampleRate:r}),null===(t=this.instance.persistence)||void 0===t||t.register(de({},cv,i))}else{var a;null===(a=this.instance.persistence)||void 0===a||a.register(de({},cv,null))}}},{key:"afterDecideResponse",value:function(e){var t,n,r,i=this;if(this._persistDecideResponse(e),this._linkedFlag=(null===(t=e.sessionRecording)||void 0===t?void 0:t.linkedFlag)||null,null!==(n=e.sessionRecording)&&void 0!==n&&n.endpoint&&(this._endpoint=null===(r=e.sessionRecording)||void 0===r?void 0:r.endpoint),this._setupSampling(),!Qi(this._linkedFlag)&&!this._linkedFlagSeen){var o=ci(this._linkedFlag)?this._linkedFlag:this._linkedFlag.flag,s=ci(this._linkedFlag)?null:this._linkedFlag.variant;this.instance.onFeatureFlags((function(e,t){var n=Wr(t)&&o in t,r=s?t[o]===s:n;if(r){var a={linkedFlag:o,linkedVariant:s},l="linked flag matched";pe.info(Ms+" "+l,a),i._tryAddCustomEvent(l,a)}i._linkedFlagSeen=r}))}this.receivedDecide=!0,this.startIfEnabledOrStop()}},{key:"_setupSampling",value:function(){var e=this;js(this.sampleRate)&&ql(this._samplingSessionListener)&&(this._samplingSessionListener=this.sessionManager.onSessionId((function(t){e.makeSamplingDecision(t)})))}},{key:"_persistDecideResponse",value:function(e){if(this.instance.persistence){var t=this.instance.persistence,n=function(){var n,r,i,o,s,a,l,c,u=null===(n=e.sessionRecording)||void 0===n?void 0:n.sampleRate,d=Qi(u)?null:parseFloat(u),h=null===(r=e.sessionRecording)||void 0===r?void 0:r.minimumDurationMilliseconds;t.register((de(c={},Lx,!!e.sessionRecording),de(c,tj,null===(i=e.sessionRecording)||void 0===i?void 0:i.consoleLogRecordingEnabled),de(c,nj,De({capturePerformance:e.capturePerformance},null===(o=e.sessionRecording)||void 0===o?void 0:o.networkPayloadCapture)),de(c,rj,{enabled:null===(s=e.sessionRecording)||void 0===s?void 0:s.recordCanvas,fps:null===(a=e.sessionRecording)||void 0===a?void 0:a.canvasFps,quality:null===(l=e.sessionRecording)||void 0===l?void 0:l.canvasQuality}),de(c,ij,d),de(c,sj,Ye(h)?null:h),c))};n(),this.sessionManager.onSessionId(n)}}},{key:"log",value:function(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"log";null===(t=this.instance.sessionRecording)||void 0===t||t.onRRwebEmit({type:6,data:{plugin:"rrweb/console@1",payload:{level:n,trace:[],payload:[JSON.stringify(e)]}},timestamp:UX()})}},{key:"_startCapture",value:function(){var e=this;Ye(Object.assign)||this._captureStarted||this.instance.config.disable_session_recording||this.instance.consent.isOptedOut()||(this._captureStarted=!0,this.sessionManager.checkAndGetSessionAndWindowId(),this.rrwebRecord?this._onScriptLoaded():this.instance.requestRouter.loadScript("/static/recorder.js?v=".concat(Ds.LIB_VERSION),(function(t){if(t)return pe.error(Ms+" could not load recorder.js",t);e._onScriptLoaded()})))}},{key:"isInteractiveEvent",value:function(e){var t;return 3===e.type&&-1!==yMe.indexOf(null===(t=e.data)||void 0===t?void 0:t.source)}},{key:"_updateWindowAndSessionIds",value:function(e){var t=this.isInteractiveEvent(e);t||this.isIdle||e.timestamp-this._lastActivityTimestamp>3e5&&(this.isIdle=!0,clearInterval(this._fullSnapshotTimer),this._flushBuffer());var n=!1;if(t&&(this._lastActivityTimestamp=e.timestamp,this.isIdle&&(this.isIdle=!1,this._tryAddCustomEvent("sessionNoLongerIdle",{reason:"user activity",type:e.type}),n=!0)),!this.isIdle){var r=this.sessionManager.checkAndGetSessionAndWindowId(!t,e.timestamp),i=r.windowId,o=r.sessionId,s=this.sessionId!==o,a=this.windowId!==i;this.windowId=i,this.sessionId=o,(n||-1===[rMe,iMe].indexOf(e.type)&&(a||s||Ye(this._fullSnapshotTimer)))&&this._tryTakeFullSnapshot()}}},{key:"_tryRRWebMethod",value:function(e){try{return e.rrwebMethod(),!0}catch(t){return this.queuedRRWebEvents.length<10?this.queuedRRWebEvents.push({enqueuedAt:e.enqueuedAt||Date.now(),attempt:e.attempt++,rrwebMethod:e.rrwebMethod}):pe.warn(Ms+" could not emit queued rrweb event.",t,e),!1}}},{key:"_tryAddCustomEvent",value:function(e,t){var n=this;return this._tryRRWebMethod(Sj((function(){return n.rrwebRecord.addCustomEvent(e,t)})))}},{key:"_tryTakeFullSnapshot",value:function(){var e=this;return this._tryRRWebMethod(Sj((function(){return e.rrwebRecord.takeFullSnapshot()})))}},{key:"_onScriptLoaded",value:function(){for(var e,t=this,n={blockClass:"ph-no-capture",blockSelector:void 0,ignoreClass:"ph-ignore-input",maskTextClass:"ph-mask",maskTextSelector:void 0,maskTextFn:void 0,maskAllInputs:!0,maskInputOptions:{password:!0},maskInputFn:void 0,slimDOMOptions:{},collectFonts:!1,inlineStylesheet:!0,recordCrossOriginIframes:!1},r=this.instance.config.session_recording,i=0,o=Object.entries(r||{});i<o.length;i++){var s=bi(o[i],2),a=s[0],l=s[1];a in n&&("maskInputOptions"===a?n.maskInputOptions=De({password:!0},l):n[a]=l)}if(this.canvasRecording&&this.canvasRecording.enabled&&(n.recordCanvas=!0,n.sampling={canvas:this.canvasRecording.fps},n.dataURLOptions={type:"image/webp",quality:this.canvasRecording.quality}),this.rrwebRecord){this.mutationRateLimiter=null!==(e=this.mutationRateLimiter)&&void 0!==e?e:new gMe(this.rrwebRecord,{onBlockedNode:function(e,n){var r="Too many mutations on node '".concat(e,"'. Rate limiting. This could be due to SVG animations or something similar");pe.info(r,{node:n}),t.log(Ms+" "+r,"warn")}});var c=this._gatherRRWebPlugins();this.stopRrweb=this.rrwebRecord(De({emit:function(e){t.onRRwebEmit(e)},plugins:c},n)),this.instance._addCaptureHook((function(e){try{if("$pageview"===e){var n=ie?t._maskUrl(ie.location.href):"";if(!n)return;t._tryAddCustomEvent("$pageview",{href:n})}}catch(e){pe.error("Could not add $pageview to rrweb session",e)}})),this._lastActivityTimestamp=Date.now(),this.isIdle=!1,this._tryAddCustomEvent("$session_options",{sessionRecordingOptions:n,activePlugins:c.map((function(e){return null==e?void 0:e.name}))}),this._tryAddCustomEvent("$posthog_config",{config:this.instance.config})}else pe.error(Ms+"onScriptLoaded was called but rrwebRecord is not available. This indicates something has gone wrong.")}},{key:"_scheduleFullSnapshot",value:function(){var e=this;if(this._fullSnapshotTimer&&clearInterval(this._fullSnapshotTimer),!this.isIdle){var t=this.fullSnapshotIntervalMillis;t&&(this._fullSnapshotTimer=setInterval((function(){e._tryTakeFullSnapshot()}),t))}}},{key:"_gatherRRWebPlugins",value:function(){var e=[];return In.rrwebConsoleRecord&&this.isConsoleLogCaptureEnabled&&e.push(In.rrwebConsoleRecord.getRecordConsolePlugin()),this.networkPayloadCapture&&qs(In.getRecordNetworkPlugin)&&(!qOe.includes(location.hostname)||this._forceAllowLocalhostNetworkCapture?e.push(In.getRecordNetworkPlugin(mMe(this.instance.config,this.networkPayloadCapture))):pe.info(Ms+" NetworkCapture not started because we are on localhost.")),e}},{key:"onRRwebEmit",value:function(e){if(this._processQueuedEvents(),e&&Wr(e)){if(e.type===Pb.Meta){var t=this._maskUrl(e.data.href);if(this._lastHref=t,!t)return;e.data.href=t}else this._pageViewFallBack();e.type===Pb.FullSnapshot&&this._scheduleFullSnapshot();var n=this.mutationRateLimiter?this.mutationRateLimiter.throttleMutations(e):e;if(n){var r=function(e){var t=e;if(t&&Wr(t)&&6===t.type&&Wr(t.data)&&"rrweb/console@1"===t.data.plugin){t.data.payload.payload.length>10&&(t.data.payload.payload=t.data.payload.payload.slice(0,10),t.data.payload.payload.push("...[truncated]"));for(var n=[],r=0;r<t.data.payload.payload.length;r++)t.data.payload.payload[r]&&t.data.payload.payload[r].length>2e3?n.push(t.data.payload.payload[r].slice(0,2e3)+"...[truncated]"):n.push(t.data.payload.payload[r]);return t.data.payload.payload=n,e}return e}(n),i=Bx(r);if(this._updateWindowAndSessionIds(r),!this.isIdle||r.type===Pb.Custom){var o={$snapshot_bytes:i,$snapshot_data:r,$session_id:this.sessionId,$window_id:this.windowId};"disabled"!==this.status?this._captureSnapshotBuffered(o):this.clearBuffer()}}}}},{key:"_pageViewFallBack",value:function(){if(!this.instance.config.capture_pageview&&ie){var e=this._maskUrl(ie.location.href);this._lastHref!==e&&(this._tryAddCustomEvent("$url_changed",{href:e}),this._lastHref=e)}}},{key:"_processQueuedEvents",value:function(){var e=this;if(this.queuedRRWebEvents.length){var t=xl(this.queuedRRWebEvents);this.queuedRRWebEvents=[],t.forEach((function(t){Date.now()-t.enqueuedAt<=2e3&&e._tryRRWebMethod(t)}))}}},{key:"_maskUrl",value:function(e){var t=this.instance.config.session_recording;if(t.maskNetworkRequestFn){var n,r={url:e};return null===(n=r=t.maskNetworkRequestFn(r))||void 0===n?void 0:n.url}return e}},{key:"clearBuffer",value:function(){return this.buffer={size:0,data:[],sessionId:this.sessionId,windowId:this.windowId},this.buffer}},{key:"_flushBuffer",value:function(){var e=this;this.flushBufferTimer&&(clearTimeout(this.flushBufferTimer),this.flushBufferTimer=void 0);var t=this.minimumDuration,n=this.sessionDuration,r=js(n)&&n>=0,i=js(t)&&r&&n<t;return"buffering"===this.status||i?(this.flushBufferTimer=setTimeout((function(){e._flushBuffer()}),2e3),this.buffer):(this.buffer.data.length>0&&Vx(this.buffer).forEach((function(t){e._captureSnapshot({$snapshot_bytes:t.size,$snapshot_data:t.data,$session_id:t.sessionId,$window_id:t.windowId})})),this.clearBuffer())}},{key:"_captureSnapshotBuffered",value:function(e){var t,n=this,r=2+((null===(t=this.buffer)||void 0===t?void 0:t.data.length)||0);!this.isIdle&&(this.buffer.size+e.$snapshot_bytes+r>943718.4||this.buffer.sessionId!==this.sessionId)&&(this.buffer=this._flushBuffer()),this.buffer.size+=e.$snapshot_bytes,this.buffer.data.push(e.$snapshot_data),this.flushBufferTimer||this.isIdle||(this.flushBufferTimer=setTimeout((function(){n._flushBuffer()}),2e3))}},{key:"_captureSnapshot",value:function(e){this.instance.capture("$snapshot",e,{_url:this.instance.requestRouter.endpointFor("api",this._endpoint),_noTruncate:!0,_batchKey:"recordings",skip_client_rate_limiting:!0})}},{key:"overrideLinkedFlag",value:function(){this._linkedFlagSeen=!0}}]),e}(),bMe=function(){function e(t){$t(this,e),this.instance=t,this.instance.decideEndpointWasHit=this.instance._hasBootstrappedFeatureFlags()}return Ht(e,[{key:"call",value:function(){var e=this,t={token:this.instance.config.token,distinct_id:this.instance.get_distinct_id(),groups:this.instance.getGroups(),person_properties:this.instance.get_property(Ih),group_properties:this.instance.get_property(Nc),disable_flags:this.instance.config.advanced_disable_feature_flags||this.instance.config.advanced_disable_feature_flags_on_first_load||void 0};this.instance._send_request({method:"POST",url:this.instance.requestRouter.endpointFor("api","/decide/?v=3"),data:t,compression:this.instance.config.disable_compression?void 0:Mo.Base64,timeout:this.instance.config.feature_flag_request_timeout_ms,callback:function(t){return e.parseDecideResponse(t.json)}})}},{key:"parseDecideResponse",value:function(e){var t=this;this.instance.featureFlags.setReloadingPaused(!1),this.instance.featureFlags._startReloadTimer();var n=!e;if(this.instance.config.advanced_disable_feature_flags_on_first_load||this.instance.config.advanced_disable_feature_flags||this.instance.featureFlags.receivedFeatureFlags(e??{},n),n)pe.error("Failed to fetch feature flags from PostHog.");else{if(!He||!He.body)return pe.info("document not ready yet, trying again in 500 milliseconds..."),void setTimeout((function(){t.parseDecideResponse(e)}),500);if(this.instance._afterDecideResponse(e),e.siteApps)if(this.instance.config.opt_in_site_apps){var r,i=eo(e.siteApps);try{var o=function(){var e=r.value,n=e.id,i=e.url,o=t.instance.requestRouter.endpointFor("api",i);In["__$$ph_site_app_".concat(n)]=t.instance,t.instance.requestRouter.loadScript(o,(function(e){if(e)return pe.error("Error while initializing PostHog app with config id ".concat(n),e)}))};for(i.s();!(r=i.n()).done;)o()}catch(e){i.e(e)}finally{i.f()}}else e.siteApps.length>0&&pe.error('PostHog site apps are disabled. Enable the "opt_in_site_apps" config to proceed.')}}}]),e}(),SMe=null!=ie&&ie.location?GS(ie.location.hash,"__posthog")||GS(location.hash,"state"):null,Ej="_postHogToolbarParams";!function(e){e[e.UNINITIALIZED=0]="UNINITIALIZED",e[e.LOADING=1]="LOADING",e[e.LOADED=2]="LOADED"}(ll||(ll={}));var EMe=function(){function e(t){$t(this,e),this.instance=t}return Ht(e,[{key:"setToolbarState",value:function(e){In.ph_toolbar_state=e}},{key:"getToolbarState",value:function(){var e;return null!==(e=In.ph_toolbar_state)&&void 0!==e?e:ll.UNINITIALIZED}},{key:"maybeLoadToolbar",value:function(){var e,t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0;if(!ie||!He)return!1;n=null!==(e=n)&&void 0!==e?e:ie.location,i=null!==(t=i)&&void 0!==t?t:ie.history;try{if(!r){try{ie.localStorage.setItem("test","test"),ie.localStorage.removeItem("test")}catch{return!1}r=null==ie?void 0:ie.localStorage}var o,s=SMe||GS(n.hash,"__posthog")||GS(n.hash,"state"),a=s?JD((function(){return JSON.parse(atob(decodeURIComponent(s)))}))||JD((function(){return JSON.parse(decodeURIComponent(s))})):null;return a&&"ph_authorize"===a.action?((o=a).source="url",o&&Object.keys(o).length>0&&(a.desiredHash?n.hash=a.desiredHash:i?i.replaceState(i.state,"",n.pathname+n.search):n.hash="")):((o=JSON.parse(r.getItem(Ej)||"{}")).source="localstorage",delete o.userIntent),!(!o.token||this.instance.config.token!==o.token||(this.loadToolbar(o),0))}catch{return!1}}},{key:"_callLoadToolbar",value:function(e){(In.ph_load_toolbar||In.ph_load_editor)(e,this.instance)}},{key:"loadToolbar",value:function(e){var t=this,n=!(null==He||!He.getElementById(Ux));if(!ie||n)return!1;var r="custom"===this.instance.requestRouter.region&&this.instance.config.advanced_disable_toolbar_metrics,i=De(De({token:this.instance.config.token},e),{},{apiURL:this.instance.requestRouter.endpointFor("ui")},r?{instrument:!1}:{});if(ie.localStorage.setItem(Ej,JSON.stringify(De(De({},i),{},{source:void 0}))),this.getToolbarState()===ll.LOADED)this._callLoadToolbar(i);else if(this.getToolbarState()===ll.UNINITIALIZED){this.setToolbarState(ll.LOADING);var o=3e5,s=Math.floor(Date.now()/o)*o;this.instance.requestRouter.loadScript("/static/toolbar.js?t=".concat(s),(function(e){if(e)return pe.error("Failed to load toolbar",e),void t.setToolbarState(ll.UNINITIALIZED);t.setToolbarState(ll.LOADED),t._callLoadToolbar(i)})),vl(ie,"turbolinks:load",(function(){t.setToolbarState(ll.UNINITIALIZED),t.loadToolbar(i)}))}return!0}},{key:"_loadEditor",value:function(e){return this.loadToolbar(e)}},{key:"maybeLoadEditor",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0;return this.maybeLoadToolbar(e,t,n)}}]),e}(),wMe=function(){function e(t){$t(this,e),de(this,"isPaused",!0),de(this,"queue",[]),de(this,"flushTimeoutMs",3e3),this.sendRequest=t}return Ht(e,[{key:"enqueue",value:function(e){this.queue.push(e),this.flushTimeout||this.setFlushTimeout()}},{key:"unload",value:function(){var e=this;this.clearFlushTimeout();var t=this.queue.length>0?this.formatQueue():{},n=Object.values(t);[].concat(xl(n.filter((function(e){return 0===e.url.indexOf("/e")}))),xl(n.filter((function(e){return 0!==e.url.indexOf("/e")})))).map((function(t){e.sendRequest(De(De({},t),{},{transport:"sendBeacon"}))}))}},{key:"enable",value:function(){this.isPaused=!1,this.setFlushTimeout()}},{key:"setFlushTimeout",value:function(){var e=this;this.isPaused||(this.flushTimeout=setTimeout((function(){if(e.clearFlushTimeout(),e.queue.length>0){var t=e.formatQueue(),n=function(n){var r=t[n],i=(new Date).getTime();r.data&&_r(r.data)&&on(r.data,(function(e){e.offset=Math.abs(e.timestamp-i),delete e.timestamp})),e.sendRequest(r)};for(var r in t)n(r)}}),this.flushTimeoutMs))}},{key:"clearFlushTimeout",value:function(){clearTimeout(this.flushTimeout),this.flushTimeout=void 0}},{key:"formatQueue",value:function(){var e={};return on(this.queue,(function(t){var n,r=t,i=(r?r.batchKey:null)||r.url;Ye(e[i])&&(e[i]=De(De({},r),{},{data:[]})),null===(n=e[i].data)||void 0===n||n.push(r.data)})),this.queue=[],e}}]),e}(),Js=Uint8Array,Yi=Uint16Array,Tp=Uint32Array,d4=new Js([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),f4=new Js([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),wj=new Js([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),dZ=function(e,t){for(var n=new Yi(31),r=0;r<31;++r)n[r]=t+=1<<e[r-1];var i=new Tp(n[30]);for(r=1;r<30;++r)for(var o=n[r];o<n[r+1];++o)i[o]=o-n[r]<<5|r;return[n,i]},fZ=dZ(d4,2),CMe=fZ[0],zx=fZ[1];CMe[28]=258,zx[258]=28;for(var Cj=dZ(f4,0)[1],hZ=new Yi(32768),Sn=0;Sn<32768;++Sn){var td=(43690&Sn)>>>1|(21845&Sn)<<1;td=(61680&(td=(52428&td)>>>2|(13107&td)<<2))>>>4|(3855&td)<<4,hZ[Sn]=((65280&td)>>>8|(255&td)<<8)>>>1}var dv=function(e,t,n){for(var r=e.length,i=0,o=new Yi(t);i<r;++i)++o[e[i]-1];var s,a=new Yi(t);for(i=0;i<t;++i)a[i]=a[i-1]+o[i-1]<<1;for(s=new Yi(r),i=0;i<r;++i)s[i]=hZ[a[e[i]-1]++]>>>15-e[i];return s},Gd=new Js(288);for(Sn=0;Sn<144;++Sn)Gd[Sn]=8;for(Sn=144;Sn<256;++Sn)Gd[Sn]=9;for(Sn=256;Sn<280;++Sn)Gd[Sn]=7;for(Sn=280;Sn<288;++Sn)Gd[Sn]=8;var JS=new Js(32);for(Sn=0;Sn<32;++Sn)JS[Sn]=5;var TMe=dv(Gd,9),RMe=dv(JS,5),pZ=function(e){return(e/8|0)+(7&e&&1)},mZ=function(e,t,n){(null==n||n>e.length)&&(n=e.length);var r=new(e instanceof Yi?Yi:e instanceof Tp?Tp:Js)(n-t);return r.set(e.subarray(t,n)),r},Xa=function(e,t,n){n<<=7&t;var r=t/8|0;e[r]|=n,e[r+1]|=n>>>8},gg=function(e,t,n){n<<=7&t;var r=t/8|0;e[r]|=n,e[r+1]|=n>>>8,e[r+2]|=n>>>16},QR=function(e,t){for(var n=[],r=0;r<e.length;++r)e[r]&&n.push({s:r,f:e[r]});var i=n.length,o=n.slice();if(!i)return[new Js(0),0];if(1==i){var s=new Js(n[0].s+1);return s[n[0].s]=1,[s,1]}n.sort((function(e,t){return e.f-t.f})),n.push({s:-1,f:25001});var a=n[0],l=n[1],c=0,u=1,d=2;for(n[0]={s:-1,f:a.f+l.f,l:a,r:l};u!=i-1;)a=n[n[c].f<n[d].f?c++:d++],l=n[c!=u&&n[c].f<n[d].f?c++:d++],n[u++]={s:-1,f:a.f+l.f,l:a,r:l};var h=o[0].s;for(r=1;r<i;++r)o[r].s>h&&(h=o[r].s);var p=new Yi(h+1),f=IMe(n[u-1],p,0);if(f>t){r=0;var m=0,v=f-t,g=1<<v;for(o.sort((function(e,t){return p[t.s]-p[e.s]||e.f-t.f}));r<i;++r){var y=o[r].s;if(!(p[y]>t))break;m+=g-(1<<f-p[y]),p[y]=t}for(m>>>=v;m>0;){var b=o[r].s;p[b]<t?m-=1<<t-p[b]++-1:++r}for(;r>=0&&m;--r){var _=o[r].s;p[_]==t&&(--p[_],++m)}f=t}return[new Js(p),f]},IMe=function e(t,n,r){return-1==t.s?Math.max(e(t.l,n,r+1),e(t.r,n,r+1)):n[t.s]=r},Tj=function(e){for(var t=e.length;t&&!e[--t];);for(var n=new Yi(++t),r=0,i=e[0],o=1,s=function(e){n[r++]=e},a=1;a<=t;++a)if(e[a]==i&&a!=t)++o;else{if(!i&&o>2){for(;o>138;o-=138)s(32754);o>2&&(s(o>10?o-11<<5|28690:o-3<<5|12305),o=0)}else if(o>3){for(s(i),--o;o>6;o-=6)s(8304);o>2&&(s(o-3<<5|8208),o=0)}for(;o--;)s(i);o=1,i=e[a]}return[n.subarray(0,r),t]},vg=function(e,t){for(var n=0,r=0;r<t.length;++r)n+=e[r]*t[r];return n},Yx=function(e,t,n){var r=n.length,i=pZ(t+2);e[i]=255&r,e[i+1]=r>>>8,e[i+2]=255^e[i],e[i+3]=255^e[i+1];for(var o=0;o<r;++o)e[i+o+4]=n[o];return 8*(i+4+r)},Rj=function(e,t,n,r,i,o,s,a,l,c,u){Xa(t,u++,n),++i[256];for(var d=QR(i,15),h=d[0],p=d[1],f=QR(o,15),m=f[0],v=f[1],g=Tj(h),y=g[0],b=g[1],_=Tj(m),w=_[0],E=_[1],S=new Yi(19),C=0;C<y.length;++C)S[31&y[C]]++;for(C=0;C<w.length;++C)S[31&w[C]]++;for(var k=QR(S,7),T=k[0],I=k[1],R=19;R>4&&!T[wj[R-1]];--R);var x,L,P,O,A=c+5<<3,M=vg(i,Gd)+vg(o,JS)+s,N=vg(i,h)+vg(o,m)+s+14+3*R+vg(S,T)+(2*S[16]+3*S[17]+7*S[18]);if(A<=M&&A<=N)return Yx(t,u,e.subarray(l,l+c));if(Xa(t,u,1+(N<M)),u+=2,N<M){x=dv(h,p),L=h,P=dv(m,v),O=m;var D=dv(T,I);for(Xa(t,u,b-257),Xa(t,u+5,E-1),Xa(t,u+10,R-4),u+=14,C=0;C<R;++C)Xa(t,u+3*C,T[wj[C]]);u+=3*R;for(var j=[y,w],U=0;U<2;++U){var F=j[U];for(C=0;C<F.length;++C){var H=31&F[C];Xa(t,u,D[H]),u+=T[H],H>15&&(Xa(t,u,F[C]>>>5&127),u+=F[C]>>>12)}}}else x=TMe,L=Gd,P=RMe,O=JS;for(C=0;C<a;++C)if(r[C]>255){H=r[C]>>>18&31,gg(t,u,x[H+257]),u+=L[H+257],H>7&&(Xa(t,u,r[C]>>>23&31),u+=d4[H]);var B=31&r[C];gg(t,u,P[B]),u+=O[B],B>3&&(gg(t,u,r[C]>>>5&8191),u+=f4[B])}else gg(t,u,x[r[C]]),u+=L[r[C]];return gg(t,u,x[256]),u+L[256]},kMe=new Tp([65540,131080,131088,131104,262176,1048704,1048832,2114560,2117632]),xMe=function(){for(var e=new Tp(256),t=0;t<256;++t){for(var n=t,r=9;--r;)n=(1&n&&3988292384)^n>>>1;e[t]=n}return e}(),PMe=function(e,t,n,r,i){return function(e,t,n,r,i,o){var s=e.length,a=new Js(r+s+5*(1+Math.floor(s/7e3))+i),l=a.subarray(r,a.length-i),c=0;if(!t||s<8)for(var u=0;u<=s;u+=65535){var d=u+65535;d<s?c=Yx(l,c,e.subarray(u,d)):(l[u]=o,c=Yx(l,c,e.subarray(u,s)))}else{for(var h=kMe[t-1],p=h>>>13,f=8191&h,m=(1<<n)-1,v=new Yi(32768),g=new Yi(m+1),y=Math.ceil(n/3),b=2*y,_=function(t){return(e[t]^e[t+1]<<y^e[t+2]<<b)&m},w=new Tp(25e3),E=new Yi(288),S=new Yi(32),C=0,k=0,T=(u=0,0),I=0,R=0;u<s;++u){var x=_(u),L=32767&u,P=g[x];if(v[L]=P,g[x]=L,I<=u){var O=s-u;if((C>7e3||T>24576)&&O>423){c=Rj(e,l,0,w,E,S,k,T,R,u-R,c),T=C=k=0,R=u;for(var A=0;A<286;++A)E[A]=0;for(A=0;A<30;++A)S[A]=0}var M=2,N=0,D=f,j=L-P&32767;if(O>2&&x==_(u-j))for(var U=Math.min(p,O)-1,F=Math.min(32767,u),H=Math.min(258,O);j<=F&&--D&&L!=P;){if(e[u+M]==e[u+M-j]){for(var B=0;B<H&&e[u+B]==e[u+B-j];++B);if(B>M){if(M=B,N=j,B>U)break;var $=Math.min(j,B-2),V=0;for(A=0;A<$;++A){var q=u-j+A+32768&32767,K=q-v[q]+32768&32767;K>V&&(V=K,P=q)}}}j+=(L=P)-(P=v[L])+32768&32767}if(N){w[T++]=268435456|zx[M]<<18|Cj[N];var G=31&zx[M],W=31&Cj[N];k+=d4[G]+f4[W],++E[257+G],++S[W],I=u+M,++C}else w[T++]=e[u],++E[e[u]]}}c=Rj(e,l,o,w,E,S,k,T,R,u-R,c)}return mZ(a,0,r+pZ(c)+i)}(e,null==t.level?6:t.level,null==t.mem?Math.ceil(1.5*Math.max(8,Math.min(13,Math.log(e.length)))):12+t.mem,n,r,!0)},eI=function(e,t,n){for(;n;++t)e[t]=n,n>>>=8};function LMe(e,t){void 0===t&&(t={});var n,r=(n=4294967295,{p:function(e){for(var t=n,r=0;r<e.length;++r)t=xMe[255&t^e[r]]^t>>>8;n=t},d:function(){return 4294967295^n}}),i=e.length;r.p(e);var o,s=PMe(e,t,10+((o=t).filename&&o.filename.length+1||0),8),a=s.length;return function(e,t){var n=t.filename;if(e[0]=31,e[1]=139,e[2]=8,e[8]=t.level<2?4:9==t.level?2:0,e[9]=3,0!=t.mtime&&eI(e,4,Math.floor(new Date(t.mtime||Date.now())/1e3)),n){e[3]=8;for(var r=0;r<=n.length;++r)e[r+10]=n.charCodeAt(r)}}(s,t),eI(s,a-8,r.d()),eI(s,a-4,i),s}var OMe=!!Ix||!!Rx,Ij="text/plain",XS=function(e,t){var n=bi(e.split("?"),2),r=n[0],i=n[1],o=De({},t);null==i||i.split("&").forEach((function(e){var t=bi(e.split("="),1)[0];delete o[t]}));var s=KOe(o);return s=s?(i?i+"&":"")+s:i,"".concat(r,"?").concat(s)},MMe=function(e){return"data="+encodeURIComponent("string"==typeof e?e:JSON.stringify(e))},tI=function(e){var t=e.data,n=e.compression;if(t){if(n===Mo.GZipJS){var r=LMe(function(e){var t=e.length;if(typeof TextEncoder<"u")return(new TextEncoder).encode(e);for(var n=new Js(e.length+(e.length>>>1)),r=0,i=function(e){n[r++]=e},o=0;o<t;++o){if(r+5>n.length){var s=new Js(r+8+(t-o<<1));s.set(n),n=s}var a=e.charCodeAt(o);a<128?i(a):a<2048?(i(192|a>>>6),i(128|63&a)):a>55295&&a<57344?(i(240|(a=65536+(1047552&a)|1023&e.charCodeAt(++o))>>>18),i(128|a>>>12&63),i(128|a>>>6&63),i(128|63&a)):(i(224|a>>>12),i(128|a>>>6&63),i(128|63&a))}return mZ(n,0,r)}(JSON.stringify(t)),{mtime:0});return{contentType:Ij,body:new Blob([r],{type:Ij})}}if(n===Mo.Base64){var i=function(e){var t,n,r,i,o,s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",a=0,l=0,c="",u=[];if(!e)return e;e=OOe(e);do{t=(o=e.charCodeAt(a++)<<16|e.charCodeAt(a++)<<8|e.charCodeAt(a++))>>18&63,n=o>>12&63,r=o>>6&63,i=63&o,u[l++]=s.charAt(t)+s.charAt(n)+s.charAt(r)+s.charAt(i)}while(a<e.length);switch(c=u.join(""),e.length%3){case 1:c=c.slice(0,-2)+"==";break;case 2:c=c.slice(0,-1)+"="}return c}(JSON.stringify(t));return{contentType:"application/x-www-form-urlencoded",body:MMe(i)}}return{contentType:"application/json",body:JSON.stringify(t)}}},fv=[];Ix&&fv.push({transport:"XHR",method:function(e){var t,n=new Ix;n.open(e.method||"GET",e.url,!0);var r=null!==(t=tI(e))&&void 0!==t?t:{},i=r.contentType,o=r.body;on(e.headers,(function(e,t){n.setRequestHeader(t,e)})),i&&n.setRequestHeader("Content-Type",i),e.timeout&&(n.timeout=e.timeout),n.withCredentials=!0,n.onreadystatechange=function(){if(4===n.readyState){var t,r={statusCode:n.status,text:n.responseText};if(200===n.status)try{r.json=JSON.parse(n.responseText)}catch{}null===(t=e.callback)||void 0===t||t.call(e,r)}},n.send(o)}}),Rx&&fv.push({transport:"fetch",method:function(e){var t,n,r=null!==(t=tI(e))&&void 0!==t?t:{},i=r.contentType,o=r.body,s=new Headers;on(e.headers,(function(e,t){s.append(t,e)})),i&&s.append("Content-Type",i);var a=e.url,l=null;if(zD){var c=new zD;l={signal:c.signal,timeout:setTimeout((function(){return c.abort()}),e.timeout)}}Rx(a,{method:(null==e?void 0:e.method)||"GET",headers:s,keepalive:"POST"===e.method,body:o,signal:null===(n=l)||void 0===n?void 0:n.signal}).then((function(t){return t.text().then((function(n){var r,i={statusCode:t.status,text:n};if(200===t.status)try{i.json=JSON.parse(n)}catch(e){pe.error(e)}null===(r=e.callback)||void 0===r||r.call(e,i)}))})).catch((function(t){var n;pe.error(t),null===(n=e.callback)||void 0===n||n.call(e,{statusCode:0,text:t})})).finally((function(){return l?clearTimeout(l.timeout):null}))}}),null!=No&&No.sendBeacon&&fv.push({transport:"sendBeacon",method:function(e){var t=XS(e.url,{beacon:"1"});try{var n,r=null!==(n=tI(e))&&void 0!==n?n:{},i=r.contentType,o=r.body,s="string"==typeof o?new Blob([o],{type:i}):o;No.sendBeacon(t,s)}catch{}}});var bd,AMe=["retriesPerformedSoFar"],NMe=function(){function e(t){var n=this;$t(this,e),de(this,"isPolling",!1),de(this,"pollIntervalMs",3e3),de(this,"queue",[]),this.instance=t,this.queue=[],this.areWeOnline=!0,!Ye(ie)&&"onLine"in ie.navigator&&(this.areWeOnline=ie.navigator.onLine,ie.addEventListener("online",(function(){n.areWeOnline=!0,n.flush()})),ie.addEventListener("offline",(function(){n.areWeOnline=!1})))}return Ht(e,[{key:"retriableRequest",value:function(e){var t=this,n=e.retriesPerformedSoFar,r=IOe(e,AMe);js(n)&&n>0&&(r.url=XS(r.url,{retry_count:n})),this.instance._send_request(De(De({},r),{},{callback:function(e){var i;200!==e.statusCode&&(e.statusCode<400||e.statusCode>=500)&&(n??0)<10?t.enqueue(De({retriesPerformedSoFar:n},r)):null===(i=r.callback)||void 0===i||i.call(r,e)}}))}},{key:"enqueue",value:function(e){var t=e.retriesPerformedSoFar||0;e.retriesPerformedSoFar=t+1;var n,r,i,o,s,a=(n=t,r=3e3*Math.pow(2,n),i=r/2,o=Math.min(18e5,r),s=(Math.random()-.5)*(o-i),Math.ceil(o+s)),l=Date.now()+a;this.queue.push({retryAt:l,requestOptions:e});var c="Enqueued failed request for retry in ".concat(a);navigator.onLine||(c+=" (Browser is offline)"),pe.warn(c),this.isPolling||(this.isPolling=!0,this.poll())}},{key:"poll",value:function(){var e=this;this.poller&&clearTimeout(this.poller),this.poller=setTimeout((function(){e.areWeOnline&&e.queue.length>0&&e.flush(),e.poll()}),this.pollIntervalMs)}},{key:"flush",value:function(){var e=Date.now(),t=[],n=this.queue.filter((function(n){return n.retryAt<e||(t.push(n),!1)}));if(this.queue=t,n.length>0){var r,i=eo(n);try{for(i.s();!(r=i.n()).done;){var o=r.value.requestOptions;this.retriableRequest(o)}}catch(e){i.e(e)}finally{i.f()}}}},{key:"unload",value:function(){this.poller&&(clearTimeout(this.poller),this.poller=void 0);var e,t=eo(this.queue);try{for(t.s();!(e=t.n()).done;){var n=e.value.requestOptions;try{this.instance._send_request(De(De({},n),{},{transport:"sendBeacon"}))}catch(e){pe.error(e)}}}catch(e){t.e(e)}finally{t.f()}this.queue=[]}}]),e}(),u_=1800,DMe=function(){function e(t,n,r,i){var o;$t(this,e),de(this,"_sessionIdChangedHandlers",[]),this.config=t,this.persistence=n,this._windowId=void 0,this._sessionId=void 0,this._sessionStartTimestamp=null,this._sessionActivityTimestamp=null,this._sessionIdGenerator=r||qc,this._windowIdGenerator=i||qc;var s=t.persistence_name||t.token,a=t.session_idle_timeout_seconds||u_;if(js(a)?a>u_?pe.warn("session_idle_timeout_seconds cannot be  greater than 30 minutes. Using 30 minutes instead."):a<60&&pe.warn("session_idle_timeout_seconds cannot be less than 60 seconds. Using 60 seconds instead."):(pe.warn("session_idle_timeout_seconds must be a number. Defaulting to 30 minutes."),a=u_),this._sessionTimeoutMs=1e3*Math.min(Math.max(a,60),u_),this._window_id_storage_key="ph_"+s+"_window_id",this._primary_window_exists_storage_key="ph_"+s+"_primary_window_exists",this._canUseSessionStorage()){var l=Gr.parse(this._window_id_storage_key),c=Gr.parse(this._primary_window_exists_storage_key);l&&!c?this._windowId=l:Gr.remove(this._window_id_storage_key),Gr.set(this._primary_window_exists_storage_key,!0)}if(null!==(o=this.config.bootstrap)&&void 0!==o&&o.sessionID)try{var u=function(e){var t=e.replace(/-/g,"");if(32!==t.length)throw new Error("Not a valid UUID");if("7"!==t[12])throw new Error("Not a UUIDv7");return parseInt(t.substring(0,12),16)}(this.config.bootstrap.sessionID);this._setSessionId(this.config.bootstrap.sessionID,(new Date).getTime(),u)}catch(e){pe.error("Invalid sessionID in bootstrap",e)}this._listenToReloadWindow()}return Ht(e,[{key:"onSessionId",value:function(e){var t=this;return Ye(this._sessionIdChangedHandlers)&&(this._sessionIdChangedHandlers=[]),this._sessionIdChangedHandlers.push(e),this._sessionId&&e(this._sessionId,this._windowId),function(){t._sessionIdChangedHandlers=t._sessionIdChangedHandlers.filter((function(t){return t!==e}))}}},{key:"_canUseSessionStorage",value:function(){return"memory"!==this.config.persistence&&!this.persistence.disabled&&Gr.is_supported()}},{key:"_setWindowId",value:function(e){e!==this._windowId&&(this._windowId=e,this._canUseSessionStorage()&&Gr.set(this._window_id_storage_key,e))}},{key:"_getWindowId",value:function(){return this._windowId?this._windowId:this._canUseSessionStorage()?Gr.parse(this._window_id_storage_key):null}},{key:"_setSessionId",value:function(e,t,n){e===this._sessionId&&t===this._sessionActivityTimestamp&&n===this._sessionStartTimestamp||(this._sessionStartTimestamp=n,this._sessionActivityTimestamp=t,this._sessionId=e,this.persistence.register(de({},BS,[t,e,n])))}},{key:"_getSessionId",value:function(){if(this._sessionId&&this._sessionActivityTimestamp&&this._sessionStartTimestamp)return[this._sessionActivityTimestamp,this._sessionId,this._sessionStartTimestamp];var e=this.persistence.props[BS];return _r(e)&&2===e.length&&e.push(e[0]),e||[0,null,0]}},{key:"resetSessionId",value:function(){this._setSessionId(null,null,null)}},{key:"_listenToReloadWindow",value:function(){var e=this;null==ie||ie.addEventListener("beforeunload",(function(){e._canUseSessionStorage()&&Gr.remove(e._primary_window_exists_storage_key)}))}},{key:"checkAndGetSessionAndWindowId",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:null)||(new Date).getTime(),n=bi(this._getSessionId(),3),r=n[0],i=n[1],o=n[2],s=this._getWindowId(),a=o&&o>0&&Math.abs(t-o)>864e5,l=!1,c=!i,u=!e&&Math.abs(t-r)>this._sessionTimeoutMs;c||u||a?(i=this._sessionIdGenerator(),s=this._windowIdGenerator(),pe.info("[SessionId] new session ID generated",{sessionId:i,windowId:s,changeReason:{noSessionId:c,activityTimeout:u,sessionPastMaximumLength:a}}),o=t,l=!0):s||(s=this._windowIdGenerator(),l=!0);var d=0===r||!e||a?t:r,h=0===o?(new Date).getTime():o;return this._setWindowId(s),this._setSessionId(i,d,h),l&&this._sessionIdChangedHandlers.forEach((function(e){return e(i,s)})),{sessionId:i,windowId:s,sessionStartTimestamp:h}}}]),e}();!function(e){e.US="us",e.EU="eu",e.CUSTOM="custom"}(bd||(bd={}));var kj="i.posthog.com",jMe=function(){function e(t){$t(this,e),de(this,"_regionCache",{}),this.instance=t}return Ht(e,[{key:"apiHost",get:function(){var e=this.instance.config.api_host.trim().replace(/\/$/,"");return"https://app.posthog.com"===e?"https://us.i.posthog.com":e}},{key:"uiHost",get:function(){var e,t=null===(e=this.instance.config.ui_host)||void 0===e?void 0:e.replace(/\/$/,"");return t||(t=this.apiHost.replace(".".concat(kj),".posthog.com")),"https://app.posthog.com"===t?"https://us.posthog.com":t}},{key:"region",get:function(){return this._regionCache[this.apiHost]||(/https:\/\/(app|us|us-assets)(\.i)?\.posthog\.com/i.test(this.apiHost)?this._regionCache[this.apiHost]=bd.US:/https:\/\/(eu|eu-assets)(\.i)?\.posthog\.com/i.test(this.apiHost)?this._regionCache[this.apiHost]=bd.EU:this._regionCache[this.apiHost]=bd.CUSTOM),this._regionCache[this.apiHost]}},{key:"endpointFor",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";if(t&&(t="/"===t[0]?t:"/".concat(t)),"ui"===e)return this.uiHost+t;if(this.region===bd.CUSTOM)return this.apiHost+t;var n=kj+t;switch(e){case"assets":return"https://".concat(this.region,"-assets.").concat(n);case"api":return"https://".concat(this.region,".").concat(n)}}},{key:"loadScript",value:function(e,t){if(this.instance.config.disable_external_dependency_loading)return pe.warn("".concat(e," was requested but loading of external scripts is disabled.")),t("Loading of external scripts is disabled");var n="/"===e[0]?this.endpointFor("assets",e):e,r=function(){if(!He)return t("document not found");var e=He.createElement("script");e.type="text/javascript",e.src=n,e.onload=function(e){return t(void 0,e)},e.onerror=function(e){return t(e)};var r,i=He.querySelectorAll("body > script");i.length>0?null===(r=i[0].parentNode)||void 0===r||r.insertBefore(e,i[0]):He.body.appendChild(e)};null!=He&&He.body?r():null==He||He.addEventListener("DOMContentLoaded",r)}}]),e}(),gZ="posthog-js";function vZ(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.organization,r=t.projectId,i=t.prefix,o=t.severityAllowList,s=void 0===o?["error"]:o;return function(t){var o,a,l,c,u;if("*"!==s&&!s.includes(t.level)||!e.__loaded)return t;t.tags||(t.tags={});var d=e.requestRouter.endpointFor("ui","/project/".concat(e.config.token,"/person/").concat(e.get_distinct_id()));t.tags["PostHog Person URL"]=d,e.sessionRecordingStarted()&&(t.tags["PostHog Recording URL"]=e.get_session_replay_url({withTimestamp:!0}));var h=(null===(o=t.exception)||void 0===o?void 0:o.values)||[],p={$exception_message:(null===(a=h[0])||void 0===a?void 0:a.value)||t.message,$exception_type:null===(l=h[0])||void 0===l?void 0:l.type,$exception_personURL:d,$exception_level:t.level,$sentry_event_id:t.event_id,$sentry_exception:t.exception,$sentry_exception_message:(null===(c=h[0])||void 0===c?void 0:c.value)||t.message,$sentry_exception_type:null===(u=h[0])||void 0===u?void 0:u.type,$sentry_tags:t.tags,$level:t.level};return n&&r&&(p.$sentry_url=(i||"https://sentry.io/organizations/")+n+"/issues/?project="+r+"&query="+t.event_id),e.exceptions.sendExceptionEvent(p),t}}var UMe=Ht((function e(t,n,r,i,o){$t(this,e),this.name=gZ,this.setupOnce=function(e){e(vZ(t,{organization:n,projectId:r,prefix:i,severityAllowList:o}))}}));function FMe(e,t){var n=e.config.segment;if(!n)return t();!function(e,t){var n=e.config.segment;if(!n)return t();var r=function(n){var r=function(){return n.anonymousId()||qc()};e.config.get_device_id=r,n.id()&&(e.register({distinct_id:n.id(),$device_id:r()}),e.persistence.set_property(al,"identified")),t()},i=n.user();"then"in i&&qs(i.then)?i.then((function(e){return r(e)})):r(i)}(e,(function(){n.register(function(e){Promise&&Promise.resolve||pe.warn("This browser does not have Promise support, and can not use the segment integration");var t=function(t,n){var r;if(!n)return t;t.event.userId||t.event.anonymousId===e.get_distinct_id()||(pe.info("Segment integration does not have a userId set, resetting PostHog"),e.reset()),t.event.userId&&t.event.userId!==e.get_distinct_id()&&(pe.info("Segment integration has a userId set, identifying with PostHog"),e.identify(t.event.userId));var i=e._calculate_event_properties(n,null!==(r=t.event.properties)&&void 0!==r?r:{},new Date);return t.event.properties=Object.assign({},i,t.event.properties),t};return{name:"PostHog JS",type:"enrichment",version:"1.0.0",isLoaded:function(){return!0},load:function(){return Promise.resolve()},track:function(e){return t(e,e.event.event)},page:function(e){return t(e,"$pageview")},identify:function(e){return t(e,"$identify")},screen:function(e){return t(e,"$screen")}}}(e)).then((function(){t()}))}))}var xj,ZS,So,$Me=function(){function e(t){$t(this,e),this._instance=t}return Ht(e,[{key:"doPageView",value:function(e){var t,n=this._previousPageViewProperties(e);return this._currentPath=null!==(t=null==ie?void 0:ie.location.pathname)&&void 0!==t?t:"",this._instance.scrollManager.resetContext(),this._prevPageviewTimestamp=e,n}},{key:"doPageLeave",value:function(e){return this._previousPageViewProperties(e)}},{key:"_previousPageViewProperties",value:function(e){var t=this._currentPath,n=this._prevPageviewTimestamp,r=this._instance.scrollManager.getContext();if(!n)return{};var i={};if(r){var o=r.maxScrollHeight,s=r.lastScrollY,a=r.maxScrollY,l=r.maxContentHeight,c=r.lastContentY,u=r.maxContentY;Ye(o)||Ye(s)||Ye(a)||Ye(l)||Ye(c)||Ye(u)||(o=Math.ceil(o),s=Math.ceil(s),a=Math.ceil(a),l=Math.ceil(l),c=Math.ceil(c),u=Math.ceil(u),i={$prev_pageview_last_scroll:s,$prev_pageview_last_scroll_percentage:o<=1?1:d_(s/o,0,1),$prev_pageview_max_scroll:a,$prev_pageview_max_scroll_percentage:o<=1?1:d_(a/o,0,1),$prev_pageview_last_content:c,$prev_pageview_last_content_percentage:l<=1?1:d_(c/l,0,1),$prev_pageview_max_content:u,$prev_pageview_max_content_percentage:l<=1?1:d_(u/l,0,1)})}return t&&(i.$prev_pageview_pathname=t),n&&(i.$prev_pageview_duration=(e.getTime()-n.getTime())/1e3),i}}]),e}();function d_(e,t,n){return Math.max(t,Math.min(e,n))}(function(e){e.Popover="popover",e.API="api",e.Widget="widget"})(xj||(xj={})),function(e){e.Open="open",e.MultipleChoice="multiple_choice",e.SingleChoice="single_choice",e.Rating="rating",e.Link="link"}(ZS||(ZS={})),function(e){e.NextQuestion="next_question",e.End="end",e.ResponseBased="response_based",e.SpecificQuestion="specific_question"}(So||(So={}));var yZ=function(){function e(){$t(this,e),de(this,"events",{}),this.events={}}return Ht(e,[{key:"on",value:function(e,t){var n=this;return this.events[e]||(this.events[e]=[]),this.events[e].push(t),function(){n.events[e]=n.events[e].filter((function(e){return e!==t}))}}},{key:"emit",value:function(e,t){var n,r=eo(this.events[e]||[]);try{for(r.s();!(n=r.n()).done;)(0,n.value)(t)}catch(e){r.e(e)}finally{r.f()}var i,o=eo(this.events["*"]||[]);try{for(o.s();!(i=o.n()).done;)(0,i.value)(e,t)}catch(e){o.e(e)}finally{o.f()}}}]),e}(),HMe=function(){function e(t){var n=this;$t(this,e),de(this,"_debugEventEmitter",new yZ),de(this,"checkStep",(function(e,t){return n.checkStepEvent(e,t)&&n.checkStepUrl(e,t)&&n.checkStepElement(e,t)})),de(this,"checkStepEvent",(function(e,t){return null==t||!t.event||(null==e?void 0:e.event)===(null==t?void 0:t.event)})),this.instance=t,this.actionEvents=new Set,this.actionRegistry=new Set}return Ht(e,[{key:"init",value:function(){var e,t,n=this;Ye(null===(e=this.instance)||void 0===e?void 0:e._addCaptureHook)||(null===(t=this.instance)||void 0===t||t._addCaptureHook((function(e,t){n.on(e,t)})))}},{key:"register",value:function(e){var t,n,r=this;if(!Ye(null===(t=this.instance)||void 0===t?void 0:t._addCaptureHook)&&(e.forEach((function(e){var t,n;null===(t=r.actionRegistry)||void 0===t||t.add(e),null===(n=e.steps)||void 0===n||n.forEach((function(e){var t;null===(t=r.actionEvents)||void 0===t||t.add((null==e?void 0:e.event)||"")}))})),null!==(n=this.instance)&&void 0!==n&&n.autocapture)){var i,o=new Set;e.forEach((function(e){var t;null===(t=e.steps)||void 0===t||t.forEach((function(e){null!=e&&e.selector&&o.add(null==e?void 0:e.selector)}))})),null===(i=this.instance)||void 0===i||i.autocapture.setElementSelectors(o)}}},{key:"on",value:function(e,t){var n,r=this;null!=t&&0!=e.length&&(this.actionEvents.has(e)||this.actionEvents.has(null==t?void 0:t.event))&&this.actionRegistry&&(null===(n=this.actionRegistry)||void 0===n?void 0:n.size)>0&&this.actionRegistry.forEach((function(e){r.checkAction(t,e)&&r._debugEventEmitter.emit("actionCaptured",e.name)}))}},{key:"_addActionHook",value:function(e){this.onAction("actionCaptured",(function(t){return e(t)}))}},{key:"checkAction",value:function(e,t){if(null==(null==t?void 0:t.steps))return!1;var n,r=eo(t.steps);try{for(r.s();!(n=r.n()).done;){var i=n.value;if(this.checkStep(e,i))return!0}}catch(e){r.e(e)}finally{r.f()}return!1}},{key:"onAction",value:function(e,t){return this._debugEventEmitter.on(e,t)}},{key:"checkStepUrl",value:function(t,n){if(null!=n&&n.url){var r,i=null==t||null===(r=t.properties)||void 0===r?void 0:r.$current_url;if(!i||"string"!=typeof i||!e.matchString(i,null==n?void 0:n.url,(null==n?void 0:n.url_matching)||"contains"))return!1}return!0}},{key:"checkStepElement",value:function(t,n){if((null!=n&&n.href||null!=n&&n.tag_name||null!=n&&n.text)&&!this.getElementsList(t).some((function(t){return!(null!=n&&n.href&&!e.matchString(t.href||"",null==n?void 0:n.href,(null==n?void 0:n.href_matching)||"exact")||null!=n&&n.tag_name&&t.tag_name!==(null==n?void 0:n.tag_name)||null!=n&&n.text&&!e.matchString(t.text||"",null==n?void 0:n.text,(null==n?void 0:n.text_matching)||"exact")&&!e.matchString(t.$el_text||"",null==n?void 0:n.text,(null==n?void 0:n.text_matching)||"exact"))})))return!1;if(null!=n&&n.selector){var r,i=null==t||null===(r=t.properties)||void 0===r?void 0:r.$element_selectors;if(!i||!i.includes(null==n?void 0:n.selector))return!1}return!0}},{key:"getElementsList",value:function(e){return null==(null==e?void 0:e.properties.$elements)?[]:null==e?void 0:e.properties.$elements}}],[{key:"matchString",value:function(t,n,r){switch(r){case"regex":return!!ie&&KS(t,n);case"exact":return n===t;case"contains":var i=e.escapeStringRegexp(n).replace(/_/g,".").replace(/%/g,".*");return KS(t,i);default:return!1}}},{key:"escapeStringRegexp",value:function(e){return e.replace(/[|\\{}()[\]^$+*?.]/g,"\\$&").replace(/-/g,"\\x2d")}}]),e}(),Jx=function(){function e(t){$t(this,e),this.instance=t,this.eventToSurveys=new Map,this.actionToSurveys=new Map}return Ht(e,[{key:"register",value:function(e){var t;Ye(null===(t=this.instance)||void 0===t?void 0:t._addCaptureHook)||(this.setupEventBasedSurveys(e),this.setupActionBasedSurveys(e))}},{key:"setupActionBasedSurveys",value:function(e){var t=this,n=e.filter((function(e){var t,n,r,i;return(null===(t=e.conditions)||void 0===t?void 0:t.actions)&&(null===(n=e.conditions)||void 0===n||null===(r=n.actions)||void 0===r||null===(i=r.values)||void 0===i?void 0:i.length)>0}));0!==n.length&&(null==this.actionMatcher&&(this.actionMatcher=new HMe(this.instance),this.actionMatcher.init(),this.actionMatcher._addActionHook((function(e){t.onAction(e)}))),n.forEach((function(e){var n,r,i,o,s,a,l,c,u,d;e.conditions&&null!==(n=e.conditions)&&void 0!==n&&n.actions&&null!==(r=e.conditions)&&void 0!==r&&null!==(i=r.actions)&&void 0!==i&&i.values&&(null===(o=e.conditions)||void 0===o||null===(s=o.actions)||void 0===s||null===(a=s.values)||void 0===a?void 0:a.length)>0&&(null===(l=t.actionMatcher)||void 0===l||l.register(e.conditions.actions.values),null===(c=e.conditions)||void 0===c||null===(u=c.actions)||void 0===u||null===(d=u.values)||void 0===d||d.forEach((function(n){if(n&&n.name){var r=t.actionToSurveys.get(n.name);r&&r.push(e.id),t.actionToSurveys.set(n.name,r||[e.id])}})))})))}},{key:"setupEventBasedSurveys",value:function(e){var t,n=this;0!==e.filter((function(e){var t,n,r,i;return(null===(t=e.conditions)||void 0===t?void 0:t.events)&&(null===(n=e.conditions)||void 0===n||null===(r=n.events)||void 0===r||null===(i=r.values)||void 0===i?void 0:i.length)>0})).length&&(null===(t=this.instance)||void 0===t||t._addCaptureHook((function(e,t){n.onEvent(e,t)})),e.forEach((function(e){var t,r,i;null===(t=e.conditions)||void 0===t||null===(r=t.events)||void 0===r||null===(i=r.values)||void 0===i||i.forEach((function(t){if(t&&t.name){var r=n.eventToSurveys.get(t.name);r&&r.push(e.id),n.eventToSurveys.set(t.name,r||[e.id])}}))})))}},{key:"onEvent",value:function(t,n){var r,i,o=(null===(r=this.instance)||void 0===r||null===(i=r.persistence)||void 0===i?void 0:i.props[i_])||[];if(e.SURVEY_SHOWN_EVENT_NAME==t&&n&&o.length>0){var s,a=null==n||null===(s=n.properties)||void 0===s?void 0:s.$survey_id;if(a){var l=o.indexOf(a);l>=0&&(o.splice(l,1),this._updateActivatedSurveys(o))}}else this.eventToSurveys.has(t)&&this._updateActivatedSurveys(o.concat(this.eventToSurveys.get(t)||[]))}},{key:"onAction",value:function(e){var t,n,r=(null===(t=this.instance)||void 0===t||null===(n=t.persistence)||void 0===n?void 0:n.props[i_])||[];this.actionToSurveys.has(e)&&this._updateActivatedSurveys(r.concat(this.actionToSurveys.get(e)||[]))}},{key:"_updateActivatedSurveys",value:function(e){var t,n;null===(t=this.instance)||void 0===t||null===(n=t.persistence)||void 0===n||n.register(de({},i_,xl(new Set(e))))}},{key:"getSurveys",value:function(){var e,t;return(null===(e=this.instance)||void 0===e||null===(t=e.persistence)||void 0===t?void 0:t.props[i_])||[]}},{key:"getEventToSurveys",value:function(){return this.eventToSurveys}},{key:"_getActionMatcher",value:function(){return this.actionMatcher}}]),e}();de(Jx,"SURVEY_SHOWN_EVENT_NAME","survey shown");var yg="[Surveys]",BMe={icontains:function(e){return!!ie&&ie.location.href.toLowerCase().indexOf(e.toLowerCase())>-1},not_icontains:function(e){return!!ie&&-1===ie.location.href.toLowerCase().indexOf(e.toLowerCase())},regex:function(e){return!!ie&&KS(ie.location.href,e)},not_regex:function(e){return!!ie&&!KS(ie.location.href,e)},exact:function(e){return(null==ie?void 0:ie.location.href)===e},is_not:function(e){return(null==ie?void 0:ie.location.href)!==e}},VMe=function(){function e(t){$t(this,e),this.instance=t,this._surveyEventReceiver=null}return Ht(e,[{key:"afterDecideResponse",value:function(e){this._decideServerResponse=!!e.surveys,this.loadIfEnabled()}},{key:"loadIfEnabled",value:function(){var e=this,t=null==In?void 0:In.extendPostHogWithSurveys;this.instance.config.disable_surveys||!this._decideServerResponse||t||(null==this._surveyEventReceiver&&(this._surveyEventReceiver=new Jx(this.instance)),this.instance.requestRouter.loadScript("/static/surveys.js",(function(t){if(t)return pe.error(yg,"Could not load surveys script",t);e._surveyManager=In.extendPostHogWithSurveys(e.instance)})))}},{key:"getSurveys",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.instance.config.disable_surveys)return e([]);null==this._surveyEventReceiver&&(this._surveyEventReceiver=new Jx(this.instance));var r=this.instance.get_property(Mx);if(r&&!n)return e(r);this.instance._send_request({url:this.instance.requestRouter.endpointFor("api","/api/surveys/?token=".concat(this.instance.config.token)),method:"GET",transport:"XHR",callback:function(n){var r;if(200!==n.statusCode||!n.json)return e([]);var i,o=n.json.surveys||[],s=o.filter((function(e){var t,n,r,i,o,s,a,l,c,u,d,h;return(null===(t=e.conditions)||void 0===t?void 0:t.events)&&(null===(n=e.conditions)||void 0===n||null===(r=n.events)||void 0===r?void 0:r.values)&&(null===(i=e.conditions)||void 0===i||null===(o=i.events)||void 0===o||null===(s=o.values)||void 0===s?void 0:s.length)>0||(null===(a=e.conditions)||void 0===a?void 0:a.actions)&&(null===(l=e.conditions)||void 0===l||null===(c=l.actions)||void 0===c?void 0:c.values)&&(null===(u=e.conditions)||void 0===u||null===(d=u.actions)||void 0===d||null===(h=d.values)||void 0===h?void 0:h.length)>0}));return s.length>0&&(null===(i=t._surveyEventReceiver)||void 0===i||i.register(s)),null===(r=t.instance.persistence)||void 0===r||r.register(de({},Mx,o)),e(o)}})}},{key:"getActiveMatchingSurveys",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.getSurveys((function(n){var r,i=n.filter((function(e){return!(!e.start_date||e.end_date)})).filter((function(e){var t,n,r,i;if(!e.conditions)return!0;var o=null===(t=e.conditions)||void 0===t||!t.url||BMe[null!==(n=null===(r=e.conditions)||void 0===r?void 0:r.urlMatchType)&&void 0!==n?n:"icontains"](e.conditions.url),s=null===(i=e.conditions)||void 0===i||!i.selector||(null==He?void 0:He.querySelector(e.conditions.selector));return o&&s})),o=null===(r=t._surveyEventReceiver)||void 0===r?void 0:r.getSurveys(),s=i.filter((function(e){var n,r,i,s,a,l,c,u,d,h;if(!e.linked_flag_key&&!e.targeting_flag_key&&!e.internal_targeting_flag_key)return!0;var p=!e.linked_flag_key||t.instance.featureFlags.isFeatureEnabled(e.linked_flag_key),f=!e.targeting_flag_key||t.instance.featureFlags.isFeatureEnabled(e.targeting_flag_key),m=(null===(n=e.conditions)||void 0===n?void 0:n.events)&&(null===(r=e.conditions)||void 0===r||null===(i=r.events)||void 0===i?void 0:i.values)&&(null===(s=e.conditions)||void 0===s||null===(a=s.events)||void 0===a?void 0:a.values.length)>0,v=(null===(l=e.conditions)||void 0===l?void 0:l.actions)&&(null===(c=e.conditions)||void 0===c||null===(u=c.actions)||void 0===u?void 0:u.values)&&(null===(d=e.conditions)||void 0===d||null===(h=d.actions)||void 0===h?void 0:h.values.length)>0,g=!m&&!v||(null==o?void 0:o.includes(e.id)),y=t._canActivateRepeatedly(e),b=!(e.internal_targeting_flag_key&&!y)||t.instance.featureFlags.isFeatureEnabled(e.internal_targeting_flag_key);return p&&f&&b&&g}));return e(s)}),n)}},{key:"getNextSurveyStep",value:function(e,t,n){var r,i=e.questions[t],o=t+1;if(null===(r=i.branching)||void 0===r||!r.type)return t===e.questions.length-1?So.End:o;if(i.branching.type===So.End)return So.End;if(i.branching.type===So.SpecificQuestion){if(Number.isInteger(i.branching.index))return i.branching.index}else if(i.branching.type===So.ResponseBased){if(i.type===ZS.SingleChoice){var s,a,l=i.choices.indexOf("".concat(n));if(null!==(s=i.branching)&&void 0!==s&&null!==(a=s.responseValues)&&void 0!==a&&a.hasOwnProperty(l)){var c=i.branching.responseValues[l];return Number.isInteger(c)?c:c===So.End?So.End:o}}else if(i.type===ZS.Rating){var u,d;if("number"!=typeof n||!Number.isInteger(n))throw new Error("The response type must be an integer");var h=function(e,t){if(3===t){if(e<1||e>3)throw new Error("The response must be in range 1-3");return 1===e?"negative":2===e?"neutral":"positive"}if(5===t){if(e<1||e>5)throw new Error("The response must be in range 1-5");return e<=2?"negative":3===e?"neutral":"positive"}if(10===t){if(e<0||e>10)throw new Error("The response must be in range 0-10");return e<=6?"detractors":e<=8?"passives":"promoters"}throw new Error("The scale must be one of: 3, 5, 10")}(n,i.scale);if(null!==(u=i.branching)&&void 0!==u&&null!==(d=u.responseValues)&&void 0!==d&&d.hasOwnProperty(h)){var p=i.branching.responseValues[h];return Number.isInteger(p)?p:p===So.End?So.End:o}}return o}return pe.warn(yg,"Falling back to next question index due to unexpected branching type"),o}},{key:"_canActivateRepeatedly",value:function(e){return Qi(In.__PosthogExtensions__.canActivateRepeatedly)&&pe.warn(yg,"canActivateRepeatedly is not defined, must init before calling"),In.__PosthogExtensions__.canActivateRepeatedly(e)}},{key:"canRenderSurvey",value:function(e){var t=this;Qi(this._surveyManager)?pe.warn(yg,"canActivateRepeatedly is not defined, must init before calling"):this.getSurveys((function(n){var r=n.filter((function(t){return t.id===e}))[0];t._surveyManager.canRenderSurvey(r)}))}},{key:"renderSurvey",value:function(e,t){var n=this;Qi(this._surveyManager)?pe.warn(yg,"canActivateRepeatedly is not defined, must init before calling"):this.getSurveys((function(r){var i=r.filter((function(t){return t.id===e}))[0];n._surveyManager.renderSurvey(i,null==He?void 0:He.querySelector(t))}))}}]),e}(),qMe=function(){function e(t){var n,r,i=this;$t(this,e),de(this,"serverLimits",{}),de(this,"lastEventRateLimited",!1),de(this,"checkForLimiting",(function(e){var t=e.text;if(t&&t.length)try{(JSON.parse(t).quota_limited||[]).forEach((function(e){pe.info("[RateLimiter] ".concat(e||"events"," is quota limited.")),i.serverLimits[e]=(new Date).getTime()+6e4}))}catch(e){return void pe.warn('[RateLimiter] could not rate limit - continuing. Error: "'.concat(null==e?void 0:e.message,'"'),{text:t})}})),this.instance=t,this.captureEventsPerSecond=(null===(n=t.config.rate_limiting)||void 0===n?void 0:n.events_per_second)||10,this.captureEventsBurstLimit=Math.max((null===(r=t.config.rate_limiting)||void 0===r?void 0:r.events_burst_limit)||10*this.captureEventsPerSecond,this.captureEventsPerSecond),this.lastEventRateLimited=this.clientRateLimitContext(!0).isRateLimited}return Ht(e,[{key:"clientRateLimitContext",value:function(){var e,t,n,r=arguments.length>0&&void 0!==arguments[0]&&arguments[0],i=(new Date).getTime(),o=null!==(e=null===(t=this.instance.persistence)||void 0===t?void 0:t.get_property(Nx))&&void 0!==e?e:{tokens:this.captureEventsBurstLimit,last:i};o.tokens+=(i-o.last)/1e3*this.captureEventsPerSecond,o.last=i,o.tokens>this.captureEventsBurstLimit&&(o.tokens=this.captureEventsBurstLimit);var s=o.tokens<1;return s||r||(o.tokens=Math.max(0,o.tokens-1)),!s||this.lastEventRateLimited||r||this.instance.capture("$$client_ingestion_warning",{$$client_ingestion_warning_message:"posthog-js client rate limited. Config is set to ".concat(this.captureEventsPerSecond," events per second and ").concat(this.captureEventsBurstLimit," events burst limit.")},{skip_client_rate_limiting:!0}),this.lastEventRateLimited=s,null===(n=this.instance.persistence)||void 0===n||n.set_property(Nx,o),{isRateLimited:s,remainingTokens:o.tokens}}},{key:"isServerRateLimited",value:function(e){var t=this.serverLimits[e||"events"]||!1;return!1!==t&&(new Date).getTime()<t}}]),e}(),KMe=function(){return De({initialPathName:(null==$i?void 0:$i.pathname)||"",referringDomain:xr.referringDomain()},xr.campaignParams())},GMe=function(){function e(t,n,r){var i=this;$t(this,e),de(this,"_onSessionIdCallback",(function(e){var t=i._getStoredProps();if(!t||t.sessionId!==e){var n={sessionId:e,props:i._sessionSourceParamGenerator()};i._persistence.register(de({},Ax,n))}})),this._sessionIdManager=t,this._persistence=n,this._sessionSourceParamGenerator=r||KMe,this._sessionIdManager.onSessionId(this._onSessionIdCallback)}return Ht(e,[{key:"_getStoredProps",value:function(){return this._persistence.props[Ax]}},{key:"getSessionProps",value:function(){var e,t=null===(e=this._getStoredProps())||void 0===e?void 0:e.props;return t?{$client_session_initial_referring_host:t.referringDomain,$client_session_initial_pathname:t.initialPathName,$client_session_initial_utm_source:t.utm_source,$client_session_initial_utm_campaign:t.utm_campaign,$client_session_initial_utm_medium:t.utm_medium,$client_session_initial_utm_content:t.utm_content,$client_session_initial_utm_term:t.utm_term}:{}}}]),e}(),WMe=["ahrefsbot","ahrefssiteaudit","applebot","baiduspider","bingbot","bingpreview","bot.htm","bot.php","crawler","deepscan","duckduckbot","facebookexternal","facebookcatalog","gptbot","http://yandex.com/bots","hubspot","ia_archiver","linkedinbot","mj12bot","msnbot","nessus","petalbot","pinterest","prerender","rogerbot","screaming frog","semrushbot","sitebulb","slurp","turnitin","twitterbot","vercelbot","yahoo! slurp","yandexbot","headlesschrome","cypress","Google-HotelAdsVerifier","adsbot-google","apis-google","duplexweb-google","feedfetcher-google","google favicon","google web preview","google-read-aloud","googlebot","googleweblight","mediapartners-google","storebot-google","Bytespider;"],Pj=function(e,t){if(!e)return!1;var n=e.toLowerCase();return WMe.concat(t||[]).some((function(e){var t=e.toLowerCase();return-1!==n.indexOf(t)}))},_Z=function(){function e(){$t(this,e),this.clicks=[]}return Ht(e,[{key:"isRageClick",value:function(e,t,n){var r=this.clicks[this.clicks.length-1];if(r&&Math.abs(e-r.x)+Math.abs(t-r.y)<30&&n-r.timestamp<1e3){if(this.clicks.push({x:e,y:t,timestamp:n}),3===this.clicks.length)return!0}else this.clicks=[{x:e,y:t,timestamp:n}];return!1}}]),e}();function Lj(e){var t;return e.id===Ux||!(null===(t=e.closest)||void 0===t||!t.call(e,"#"+Ux))}var zMe=function(){function e(t){var n,r=this;$t(this,e),de(this,"rageclicks",new _Z),de(this,"_enabledServerSide",!1),de(this,"_initialized",!1),de(this,"_flushInterval",null),this.instance=t,this._enabledServerSide=!(null===(n=this.instance.persistence)||void 0===n||!n.props[Px]),null==ie||ie.addEventListener("beforeunload",(function(){r.flush()}))}return Ht(e,[{key:"flushIntervalMilliseconds",get:function(){var e=5e3;return Wr(this.instance.config.capture_heatmaps)&&this.instance.config.capture_heatmaps.flush_interval_milliseconds&&(e=this.instance.config.capture_heatmaps.flush_interval_milliseconds),e}},{key:"isEnabled",get:function(){return Ye(this.instance.config.capture_heatmaps)?Ye(this.instance.config.enable_heatmaps)?this._enabledServerSide:this.instance.config.enable_heatmaps:!1!==this.instance.config.capture_heatmaps}},{key:"startIfEnabled",value:function(){if(this.isEnabled){if(this._initialized)return;pe.info("[heatmaps] starting..."),this._setupListeners(),this._flushInterval=setInterval(this.flush.bind(this),this.flushIntervalMilliseconds)}else{var e;clearInterval(null!==(e=this._flushInterval)&&void 0!==e?e:void 0),this.getAndClearBuffer()}}},{key:"afterDecideResponse",value:function(e){var t=!!e.heatmaps;this.instance.persistence&&this.instance.persistence.register(de({},Px,t)),this._enabledServerSide=t,this.startIfEnabled()}},{key:"getAndClearBuffer",value:function(){var e=this.buffer;return this.buffer=void 0,e}},{key:"_setupListeners",value:function(){var e=this;ie&&He&&(vl(He,"click",(function(t){return e._onClick(t||(null==ie?void 0:ie.event))}),!1,!0),vl(He,"mousemove",(function(t){return e._onMouseMove(t||(null==ie?void 0:ie.event))}),!1,!0),this._initialized=!0)}},{key:"_getProperties",value:function(e,t){var n=this.instance.scrollManager.scrollY(),r=this.instance.scrollManager.scrollX(),i=this.instance.scrollManager.scrollElement(),o=function(e,t,n){for(var r=e;r&&!nu(r,"body");){if(r===n)return!1;if(Tt(t,null==ie?void 0:ie.getComputedStyle(r).position))return!0;r=oZ(r)}return!1}(e.target,["fixed","sticky"],i);return{x:e.clientX+(o?0:r),y:e.clientY+(o?0:n),target_fixed:o,type:t}}},{key:"_onClick",value:function(e){var t;if(!Lj(e.target)){var n=this._getProperties(e,"click");null!==(t=this.rageclicks)&&void 0!==t&&t.isRageClick(e.clientX,e.clientY,(new Date).getTime())&&this._capture(De(De({},n),{},{type:"rageclick"})),this._capture(n)}}},{key:"_onMouseMove",value:function(e){var t=this;Lj(e.target)||(clearTimeout(this._mouseMoveTimeout),this._mouseMoveTimeout=setTimeout((function(){t._capture(t._getProperties(e,"mousemove"))}),500))}},{key:"_capture",value:function(e){if(ie){var t=ie.location.href;this.buffer=this.buffer||{},this.buffer[t]||(this.buffer[t]=[]),this.buffer[t].push(e)}}},{key:"flush",value:function(){this.buffer&&!kb(this.buffer)&&this.instance.capture("$$heatmap",{$heatmap_data:this.getAndClearBuffer()})}}]),e}(),YMe=function(){function e(t){var n=this;$t(this,e),de(this,"_updateScrollData",(function(){var e,t,r,i;n.context||(n.context={});var o=n.scrollElement(),s=n.scrollY(),a=o?Math.max(0,o.scrollHeight-o.clientHeight):0,l=s+((null==o?void 0:o.clientHeight)||0),c=(null==o?void 0:o.scrollHeight)||0;n.context.lastScrollY=Math.ceil(s),n.context.maxScrollY=Math.max(s,null!==(e=n.context.maxScrollY)&&void 0!==e?e:0),n.context.maxScrollHeight=Math.max(a,null!==(t=n.context.maxScrollHeight)&&void 0!==t?t:0),n.context.lastContentY=l,n.context.maxContentY=Math.max(l,null!==(r=n.context.maxContentY)&&void 0!==r?r:0),n.context.maxContentHeight=Math.max(c,null!==(i=n.context.maxContentHeight)&&void 0!==i?i:0)})),this.instance=t}return Ht(e,[{key:"getContext",value:function(){return this.context}},{key:"resetContext",value:function(){var e=this.context;return setTimeout(this._updateScrollData,0),e}},{key:"startMeasuringScrollPosition",value:function(){null==ie||ie.addEventListener("scroll",this._updateScrollData,!0),null==ie||ie.addEventListener("scrollend",this._updateScrollData,!0),null==ie||ie.addEventListener("resize",this._updateScrollData)}},{key:"scrollElement",value:function(){if(!this.instance.config.scroll_root_selector)return null==ie?void 0:ie.document.documentElement;var e,t=eo(_r(this.instance.config.scroll_root_selector)?this.instance.config.scroll_root_selector:[this.instance.config.scroll_root_selector]);try{for(t.s();!(e=t.n()).done;){var n=e.value,r=null==ie?void 0:ie.document.querySelector(n);if(r)return r}}catch(e){t.e(e)}finally{t.f()}}},{key:"scrollY",value:function(){if(this.instance.config.scroll_root_selector){var e=this.scrollElement();return e&&e.scrollTop||0}return ie&&(ie.scrollY||ie.pageYOffset||ie.document.documentElement.scrollTop)||0}},{key:"scrollX",value:function(){if(this.instance.config.scroll_root_selector){var e=this.scrollElement();return e&&e.scrollLeft||0}return ie&&(ie.scrollX||ie.pageXOffset||ie.document.documentElement.scrollLeft)||0}}]),e}(),nI="$copy_autocapture";function rI(e,t){return t.length>e?t.slice(0,e)+"...":t}var Dc,JMe=function(){function e(t){$t(this,e),de(this,"_initialized",!1),de(this,"_isDisabledServerSide",null),de(this,"rageclicks",new _Z),de(this,"_elementsChainAsString",!1),this.instance=t,this._elementSelectors=null}return Ht(e,[{key:"config",get:function(){var e,t,n=Wr(this.instance.config.autocapture)?this.instance.config.autocapture:{};return n.url_allowlist=null===(e=n.url_allowlist)||void 0===e?void 0:e.map((function(e){return new RegExp(e)})),n.url_ignorelist=null===(t=n.url_ignorelist)||void 0===t?void 0:t.map((function(e){return new RegExp(e)})),n}},{key:"_addDomEventHandlers",value:function(){var e=this;if(this.isBrowserSupported()){if(ie&&He){var t=function(t){t=t||(null==ie?void 0:ie.event);try{e._captureEvent(t)}catch(e){pe.error("Failed to capture event",e)}},n=function(t){t=t||(null==ie?void 0:ie.event),e._captureEvent(t,nI)};vl(He,"submit",t,!1,!0),vl(He,"change",t,!1,!0),vl(He,"click",t,!1,!0),this.config.capture_copied_text&&(vl(He,"copy",n,!1,!0),vl(He,"cut",n,!1,!0))}}else pe.info("Disabling Automatic Event Collection because this browser is not supported")}},{key:"startIfEnabled",value:function(){this.isEnabled&&!this._initialized&&(this._addDomEventHandlers(),this._initialized=!0)}},{key:"afterDecideResponse",value:function(e){e.elementsChainAsString&&(this._elementsChainAsString=e.elementsChainAsString),this.instance.persistence&&this.instance.persistence.register(de({},XD,!!e.autocapture_opt_out)),this._isDisabledServerSide=!!e.autocapture_opt_out,this.startIfEnabled()}},{key:"setElementSelectors",value:function(e){this._elementSelectors=e}},{key:"getElementSelectors",value:function(e){var t,n=[];return null===(t=this._elementSelectors)||void 0===t||t.forEach((function(t){var r=null==He?void 0:He.querySelectorAll(t);null==r||r.forEach((function(r){e===r&&n.push(t)}))})),n}},{key:"isEnabled",get:function(){var e,t,n=null===(e=this.instance.persistence)||void 0===e?void 0:e.props[XD],r=this._isDisabledServerSide;if(ql(r)&&!_d(n)&&!this.instance.config.advanced_disable_decide)return!1;var i=null!==(t=this._isDisabledServerSide)&&void 0!==t?t:!!n;return!!this.instance.config.autocapture&&!i}},{key:"_previousElementSibling",value:function(e){if(e.previousElementSibling)return e.previousElementSibling;var t=e;do{t=t.previousSibling}while(t&&!u4(t));return t}},{key:"_getAugmentPropertiesFromElement",value:function(e){if(!Kx(e))return{};var t={};return on(e.attributes,(function(e){if(e.name&&0===e.name.indexOf("data-ph-capture-attribute")){var n=e.name.replace("data-ph-capture-attribute-",""),r=e.value;n&&r&&Zh(r)&&(t[n]=r)}})),t}},{key:"_getPropertiesFromElement",value:function(e,t,n){var r,i=e.tagName.toLowerCase(),o={tag_name:i};qx.indexOf(i)>-1&&!n&&("a"===i.toLowerCase()||"button"===i.toLowerCase()?o.$el_text=rI(1024,vj(e)):o.$el_text=rI(1024,YS(e)));var s=zS(e);s.length>0&&(o.classes=s.filter((function(e){return""!==e})));var a=null===(r=this.config)||void 0===r?void 0:r.element_attribute_ignorelist;on(e.attributes,(function(n){var r;if((!aZ(e)||-1!==["name","id","class","aria-label"].indexOf(n.name))&&(null==a||!a.includes(n.name))&&!t&&Zh(n.value)&&(r=n.name,!ci(r)||"_ngcontent"!==r.substring(0,10)&&"_nghost"!==r.substring(0,7))){var i=n.value;"class"===n.name&&(i=c4(i).join(" ")),o["attr__"+n.name]=rI(1024,i)}}));for(var l=1,c=1,u=e;u=this._previousElementSibling(u);)l++,u.tagName===e.tagName&&c++;return o.nth_child=l,o.nth_of_type=c,o}},{key:"_getDefaultProperties",value:function(e){return{$event_type:e,$ce_version:1}}},{key:"_getEventTarget",value:function(e){return Ye(e.target)?e.srcElement||null:null!==(t=e.target)&&void 0!==t&&t.shadowRoot?e.composedPath()[0]||null:e.target||null;var t}},{key:"_captureEvent",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"$autocapture";if(this.isEnabled){var r,i=this._getEventTarget(e);iZ(i)&&(i=i.parentNode||null),"$autocapture"===n&&"click"===e.type&&e instanceof MouseEvent&&this.instance.config.rageclick&&null!==(r=this.rageclicks)&&void 0!==r&&r.isRageClick(e.clientX,e.clientY,(new Date).getTime())&&this._captureEvent(e,"$rageclick");var o=n===nI;if(i&&sMe(i,e,this.config,o,o?["copy","cut"]:void 0)){for(var s,a,l=[i],c=i;c.parentNode&&!nu(c,"body");)sZ(c.parentNode)?(l.push(c.parentNode.host),c=c.parentNode.host):(l.push(c.parentNode),c=c.parentNode);var u,d,h=[],p={},f=!1;if(on(l,(function(e){var n=Kx(e);"a"===e.tagName.toLowerCase()&&(u=e.getAttribute("href"),u=n&&Zh(u)&&u),Tt(zS(e),"ph-no-capture")&&(f=!0),h.push(t._getPropertiesFromElement(e,t.instance.config.mask_all_element_attributes,t.instance.config.mask_all_text));var r=t._getAugmentPropertiesFromElement(e);Si(p,r)})),this.instance.config.mask_all_text||("a"===i.tagName.toLowerCase()||"button"===i.tagName.toLowerCase()?h[0].$el_text=vj(i):h[0].$el_text=YS(i)),u){var m,v;h[0].attr__href=u;var g=null===(m=uv(u))||void 0===m?void 0:m.host,y=null==ie||null===(v=ie.location)||void 0===v?void 0:v.host;g&&y&&g!==y&&(d=u)}if(f)return!1;var b=Si(this._getDefaultProperties(e.type),this._elementsChainAsString?{$elements_chain:uMe(h)}:{$elements:h},null!==(s=h[0])&&void 0!==s&&s.$el_text?{$el_text:null===(a=h[0])||void 0===a?void 0:a.$el_text}:{},d&&"click"===e.type?{$external_click_url:d}:{},p),_=this.getElementSelectors(i);if(_&&_.length>0&&(b.$element_selectors=_),n===nI){var w,E=rZ(null==ie||null===(w=ie.getSelection())||void 0===w?void 0:w.toString()),S=e.type||"clipboard";if(!E)return!1;b.$selected_content=E,b.$copy_type=S}return this.instance.capture(n,b),!0}}}},{key:"isBrowserSupported",value:function(){return qs(null==He?void 0:He.querySelectorAll)}}]),e}(),XMe=function(){function e(t){var n=this;$t(this,e),de(this,"_restoreXHRPatch",void 0),de(this,"_restoreFetchPatch",void 0),de(this,"_startCapturing",(function(){Ye(n._restoreXHRPatch)&&In.postHogTracingHeadersPatchFns._patchXHR(n.instance.sessionManager),Ye(n._restoreFetchPatch)&&In.postHogTracingHeadersPatchFns._patchFetch(n.instance.sessionManager)})),this.instance=t}return Ht(e,[{key:"_loadScript",value:function(e){In.postHogTracingHeadersPatchFns&&e(),this.instance.requestRouter.loadScript("/static/tracing-headers.js?v=".concat(Ds.LIB_VERSION),(function(t){if(t)return pe.error("[TRACING-HEADERS] failed to load script",t);e()}))}},{key:"startIfEnabledOrStop",value:function(){var e,t;this.instance.config.__add_tracing_headers?this._loadScript(this._startCapturing):(null===(e=this._restoreXHRPatch)||void 0===e||e.call(this),null===(t=this._restoreFetchPatch)||void 0===t||t.call(this),this._restoreXHRPatch=void 0,this._restoreFetchPatch=void 0)}}]),e}();!function(e){e[e.PENDING=-1]="PENDING",e[e.DENIED=0]="DENIED",e[e.GRANTED=1]="GRANTED"}(Dc||(Dc={}));var ZMe=function(){function e(t){$t(this,e),this.instance=t}return Ht(e,[{key:"config",get:function(){return this.instance.config}},{key:"consent",get:function(){return this.getDnt()?Dc.DENIED:this.storedConsent}},{key:"isOptedOut",value:function(){return this.consent===Dc.DENIED||this.consent===Dc.PENDING&&this.config.opt_out_capturing_by_default}},{key:"isOptedIn",value:function(){return!this.isOptedOut()}},{key:"optInOut",value:function(e){this.storage.set(this.storageKey,e?1:0,this.config.cookie_expiration,this.config.cross_subdomain_cookie,this.config.secure_cookie)}},{key:"reset",value:function(){this.storage.remove(this.storageKey,this.config.cross_subdomain_cookie)}},{key:"storageKey",get:function(){var e=this.instance.config,t=e.token;return(e.opt_out_capturing_cookie_prefix||"__ph_opt_in_out_")+t}},{key:"storedConsent",get:function(){var e=this.storage.get(this.storageKey);return"1"===e?Dc.GRANTED:"0"===e?Dc.DENIED:Dc.PENDING}},{key:"storage",get:function(){if(!this._storage){var e=this.config.opt_out_capturing_persistence_type;this._storage="localStorage"===e?yr:Pl;var t="localStorage"===e?Pl:yr;t.get(this.storageKey)&&(this._storage.get(this.storageKey)||this.optInOut("1"===t.get(this.storageKey)),t.remove(this.storageKey,this.config.cross_subdomain_cookie))}return this._storage}},{key:"getDnt",value:function(){return!!this.config.respect_dnt&&!!FX([null==No?void 0:No.doNotTrack,null==No?void 0:No.msDoNotTrack,In.doNotTrack],(function(e){return Tt([!0,1,"1","yes"],e)}))}}]),e}(),f_="[Exception Autocapture]",QMe=function(){function e(t){var n,r=this;$t(this,e),de(this,"originalOnUnhandledRejectionHandler",void 0),de(this,"startCapturing",(function(){if(ie&&r.isEnabled&&!r.hasHandlers&&!r.isCapturing){var e=ie.posthogErrorWrappingFunctions.wrapOnError,t=ie.posthogErrorWrappingFunctions.wrapUnhandledRejection;if(e&&t)try{r.unwrapOnError=e(r.captureException.bind(r)),r.unwrapUnhandledRejection=t(r.captureException.bind(r))}catch(e){pe.error(f_+" failed to start",e),r.stopCapturing()}else pe.error(f_+" failed to load error wrapping functions - cannot start")}})),this.instance=t,this.remoteEnabled=!(null===(n=this.instance.persistence)||void 0===n||!n.props[ZD]),this.startIfEnabled()}return Ht(e,[{key:"isEnabled",get:function(){var e;return null!==(e=this.remoteEnabled)&&void 0!==e&&e}},{key:"isCapturing",get:function(){var e;return!(null==ie||null===(e=ie.onerror)||void 0===e||!e.__POSTHOG_INSTRUMENTED__)}},{key:"hasHandlers",get:function(){return this.originalOnUnhandledRejectionHandler||this.unwrapOnError}},{key:"startIfEnabled",value:function(){this.isEnabled&&!this.isCapturing&&(pe.info(f_+" enabled, starting..."),this.loadScript(this.startCapturing))}},{key:"loadScript",value:function(e){this.hasHandlers&&e(),this.instance.requestRouter.loadScript("/static/exception-autocapture.js?v=".concat(Ds.LIB_VERSION),(function(t){if(t)return pe.error(f_+" failed to load script",t);e()}))}},{key:"stopCapturing",value:function(){var e,t;null===(e=this.unwrapOnError)||void 0===e||e.call(this),null===(t=this.unwrapUnhandledRejection)||void 0===t||t.call(this)}},{key:"afterDecideResponse",value:function(e){var t=e.autocaptureExceptions;this.remoteEnabled=!!t||!1,this.instance.persistence&&this.instance.persistence.register(de({},ZD,this.remoteEnabled)),this.startIfEnabled()}},{key:"captureException",value:function(e){var t=this.instance.requestRouter.endpointFor("ui");e.$exception_personURL="".concat(t,"/project/").concat(this.instance.config.token,"/person/").concat(this.instance.get_distinct_id()),this.instance.exceptions.sendExceptionEvent(e)}}]),e}(),Oj=9e5,nd="[Web Vitals]",eAe=function(){function e(t){var n,r=this;$t(this,e),de(this,"_enabledServerSide",!1),de(this,"_initialized",!1),de(this,"buffer",{url:void 0,metrics:[],firstMetricTimestamp:void 0}),de(this,"_flushToCapture",(function(){clearTimeout(r._delayedFlushTimer),0!==r.buffer.metrics.length&&(r.instance.capture("$web_vitals",r.buffer.metrics.reduce((function(e,t){var n;return De(De({},e),{},(de(n={},"$web_vitals_".concat(t.name,"_event"),De({},t)),de(n,"$web_vitals_".concat(t.name,"_value"),t.value),n))}),{})),r.buffer={url:void 0,metrics:[],firstMetricTimestamp:void 0})})),de(this,"_addToBuffer",(function(e){var t,n=null===(t=r.instance.sessionManager)||void 0===t?void 0:t.checkAndGetSessionAndWindowId(!0);if(Ye(n))pe.error(nd+"Could not read session ID. Dropping metrics!");else{r.buffer=r.buffer||{url:void 0,metrics:[],firstMetricTimestamp:void 0};var i=r._currentURL();Ye(i)||(Qi(null==e?void 0:e.name)||Qi(null==e?void 0:e.value)?pe.error(nd+"Invalid metric received",e):r._maxAllowedValue&&e.value>=r._maxAllowedValue?pe.error(nd+"Ignoring metric with value >= "+r._maxAllowedValue,e):(r.buffer.url!==i&&(r._flushToCapture(),r._delayedFlushTimer=setTimeout(r._flushToCapture,8e3)),Ye(r.buffer.url)&&(r.buffer.url=i),r.buffer.firstMetricTimestamp=Ye(r.buffer.firstMetricTimestamp)?Date.now():r.buffer.firstMetricTimestamp,r.buffer.metrics.push(De(De({},e),{},{$current_url:i,$session_id:n.sessionId,$window_id:n.windowId,timestamp:Date.now()})),4===r.buffer.metrics.length&&r._flushToCapture()))}})),de(this,"_startCapturing",(function(){var e=In.postHogWebVitalsCallbacks,t=e.onLCP,n=e.onCLS,i=e.onFCP,o=e.onINP;t&&n&&i&&o?(t(r._addToBuffer),n(r._addToBuffer),i(r._addToBuffer),o(r._addToBuffer),r._initialized=!0):pe.error(nd+"web vitals callbacks not loaded - not starting")})),this.instance=t,this._enabledServerSide=!(null===(n=this.instance.persistence)||void 0===n||!n.props[ej]),this.startIfEnabled()}return Ht(e,[{key:"_maxAllowedValue",get:function(){var e=Wr(this.instance.config.capture_performance)&&js(this.instance.config.capture_performance.__web_vitals_max_value)?this.instance.config.capture_performance.__web_vitals_max_value:Oj;return 0<e&&e<=6e4?Oj:e}},{key:"isEnabled",get:function(){var e=Wr(this.instance.config.capture_performance)?this.instance.config.capture_performance.web_vitals:void 0;return _d(e)?e:this._enabledServerSide}},{key:"startIfEnabled",value:function(){this.isEnabled&&!this._initialized&&(pe.info(nd+" enabled, starting..."),this.loadScript(this._startCapturing))}},{key:"afterDecideResponse",value:function(e){var t=Wr(e.capturePerformance)&&!!e.capturePerformance.web_vitals;this.instance.persistence&&this.instance.persistence.register(de({},ej,t)),this._enabledServerSide=t,this.startIfEnabled()}},{key:"loadScript",value:function(e){ie.postHogWebVitalsCallbacks&&e(),this.instance.requestRouter.loadScript("/static/web-vitals.js?v=".concat(Ds.LIB_VERSION),(function(t){t?pe.error(nd+" failed to load script",t):e()}))}},{key:"_currentURL",value:function(){var e=ie?ie.location.href:void 0;return e||pe.error(nd+"Could not determine current URL"),e}}]),e}(),Mj="/e/",tAe=function(){function e(t){var n;$t(this,e),this.instance=t,this._endpointSuffix=(null===(n=this.instance.persistence)||void 0===n?void 0:n.props[QD])||Mj}return Ht(e,[{key:"endpoint",get:function(){return this.instance.requestRouter.endpointFor("api",this._endpointSuffix)}},{key:"afterDecideResponse",value:function(e){var t=e.autocaptureExceptions;this._endpointSuffix=Wr(t)&&t.endpoint||Mj,this.instance.persistence&&this.instance.persistence.register(de({},QD,this._endpointSuffix))}},{key:"sendExceptionEvent",value:function(e){this.instance.capture("$exception",e,{_noTruncate:!0,_batchKey:"exceptionEvent",_url:this.endpoint})}}]),e}(),hv={},Aj=function(){},gh="posthog",bZ=!OMe&&-1===(null==kr?void 0:kr.indexOf("MSIE"))&&-1===(null==kr?void 0:kr.indexOf("Mozilla")),Nj=function(){var e,t,n;return{api_host:"https://us.i.posthog.com",ui_host:null,token:"",autocapture:!0,rageclick:!0,cross_subdomain_cookie:(t=null==He?void 0:He.location,n=null==t?void 0:t.hostname,!!ci(n)&&"herokuapp.com"!==n.split(".").slice(-2).join(".")),persistence:"localStorage+cookie",persistence_name:"",loaded:Aj,store_google:!0,custom_campaign_params:[],custom_blocked_useragents:[],save_referrer:!0,capture_pageview:!0,capture_pageleave:"if_capture_pageview",debug:$i&&ci(null==$i?void 0:$i.search)&&-1!==$i.search.indexOf("__posthog_debug=true")||!1,verbose:!1,cookie_expiration:365,upgrade:!1,disable_session_recording:!1,disable_persistence:!1,disable_surveys:!1,enable_recording_console_log:void 0,secure_cookie:"https:"===(null==ie||null===(e=ie.location)||void 0===e?void 0:e.protocol),ip:!0,opt_out_capturing_by_default:!1,opt_out_persistence_by_default:!1,opt_out_useragent_filter:!1,opt_out_capturing_persistence_type:"localStorage",opt_out_capturing_cookie_prefix:null,opt_in_site_apps:!1,property_denylist:[],respect_dnt:!1,sanitize_properties:null,request_headers:{},inapp_protocol:"//",inapp_link_new_window:!1,request_batching:!0,properties_string_max_length:65535,session_recording:{},mask_all_element_attributes:!1,mask_all_text:!1,advanced_disable_decide:!1,advanced_disable_feature_flags:!1,advanced_disable_feature_flags_on_first_load:!1,advanced_disable_toolbar_metrics:!1,feature_flag_request_timeout_ms:3e3,on_request_error:function(e){var t="Bad HTTP status: "+e.statusCode+" "+e.text;pe.error(t)},get_device_id:function(e){return e},_onCapture:Aj,capture_performance:void 0,name:"posthog",bootstrap:{},disable_compression:!1,session_idle_timeout_seconds:1800,person_profiles:"always",__add_tracing_headers:!1}},Dj=function(e){var t={};Ye(e.process_person)||(t.person_profiles=e.process_person),Ye(e.xhr_headers)||(t.request_headers=e.xhr_headers),Ye(e.cookie_name)||(t.persistence_name=e.cookie_name),Ye(e.disable_cookie)||(t.disable_persistence=e.disable_cookie);var n=Si({},t,e);return _r(e.property_blacklist)&&(Ye(e.property_denylist)?n.property_denylist=e.property_blacklist:_r(e.property_denylist)?n.property_denylist=[].concat(xl(e.property_blacklist),xl(e.property_denylist)):pe.error("Invalid value for property_denylist config: "+e.property_denylist)),n},nAe=function(){function e(){$t(this,e),de(this,"__forceAllowLocalhost",!1)}return Ht(e,[{key:"_forceAllowLocalhost",get:function(){return this.__forceAllowLocalhost},set:function(e){pe.error("WebPerformanceObserver is deprecated and has no impact on network capture. Use `_forceAllowLocalhostNetworkCapture` on `posthog.sessionRecording`"),this.__forceAllowLocalhost=e}}]),e}(),SZ=function(){function e(){var t=this;$t(this,e),de(this,"webPerformance",new nAe),de(this,"version",Ds.LIB_VERSION),de(this,"_internalEventEmitter",new yZ),this.config=Nj(),this.decideEndpointWasHit=!1,this.SentryIntegration=UMe,this.sentryIntegration=function(e){return n=vZ(t,e),{name:gZ,processEvent:function(e){return n(e)}};var n},this.__request_queue=[],this.__loaded=!1,this.analyticsDefaultEndpoint="/e/",this._initialPageviewCaptured=!1,this.featureFlags=new AOe(this),this.toolbar=new EMe(this),this.scrollManager=new YMe(this),this.pageViewManager=new $Me(this),this.surveys=new VMe(this),this.exceptions=new tAe(this),this.rateLimiter=new qMe(this),this.requestRouter=new jMe(this),this.consent=new ZMe(this),this.people={set:function(e,n,r){var i=ci(e)?de({},e,n):e;t.setPersonProperties(i),null==r||r({})},set_once:function(e,n,r){var i=ci(e)?de({},e,n):e;t.setPersonProperties(void 0,i),null==r||r({})}},this.on("eventCaptured",(function(e){return pe.info("send",e)}))}return Ht(e,[{key:"init",value:function(t,n,r){if(r&&r!==gh){var i,o=null!==(i=hv[r])&&void 0!==i?i:new e;return o._init(t,n,r),hv[r]=o,hv[gh][r]=o,o}return this._init(t,n,r)}},{key:"_init",value:function(e){var t,n,r=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=arguments.length>2?arguments[2]:void 0;if(Ye(e)||KD(e))return pe.critical("PostHog was initialized without a token. This likely indicates a misconfiguration. Please check the first argument passed to posthog.init()"),this;if(this.__loaded)return pe.warn("You have already initialized PostHog! Re-initializing is a no-op"),this;this.__loaded=!0,this.config={},this._triggered_notifs=[],this.set_config(Si({},Nj(),Dj(i),{name:o,token:e})),this.config.on_xhr_error&&pe.error("[posthog] on_xhr_error is deprecated. Use on_request_error instead"),this.compression=i.disable_compression?void 0:Mo.GZipJS,this.persistence=new ZR(this.config),this.sessionPersistence="sessionStorage"===this.config.persistence?this.persistence:new ZR(De(De({},this.config),{},{persistence:"sessionStorage"}));var s=De({},this.persistence.props),a=De({},this.sessionPersistence.props);if(this._requestQueue=new wMe((function(e){return r._send_retriable_request(e)})),this._retryQueue=new NMe(this),this.__request_queue=[],this.sessionManager=new DMe(this.config,this.persistence),this.sessionPropsManager=new GMe(this.sessionManager,this.persistence),new XMe(this).startIfEnabledOrStop(),this.sessionRecording=new _Me(this),this.sessionRecording.startIfEnabledOrStop(),this.config.disable_scroll_properties||this.scrollManager.startMeasuringScrollPosition(),this.autocapture=new JMe(this),this.autocapture.startIfEnabled(),this.surveys.loadIfEnabled(),this.heatmaps=new zMe(this),this.heatmaps.startIfEnabled(),this.webVitalsAutocapture=new eAe(this),this.exceptionObserver=new QMe(this),this.exceptionObserver.startIfEnabled(),Ds.DEBUG=Ds.DEBUG||this.config.debug,Ds.DEBUG&&pe.info("Starting in debug mode",{this:this,config:i,thisC:De({},this.config),p:s,s:a}),this._sync_opt_out_with_persistence(),void 0!==(null===(t=i.bootstrap)||void 0===t?void 0:t.distinctID)){var l,c,u=this.config.get_device_id(qc()),d=null!==(l=i.bootstrap)&&void 0!==l&&l.isIdentifiedID?u:i.bootstrap.distinctID;this.persistence.set_property(al,null!==(c=i.bootstrap)&&void 0!==c&&c.isIdentifiedID?"identified":"anonymous"),this.register({distinct_id:i.bootstrap.distinctID,$device_id:d})}if(this._hasBootstrappedFeatureFlags()){var h,p,f=Object.keys((null===(h=i.bootstrap)||void 0===h?void 0:h.featureFlags)||{}).filter((function(e){var t,n;return!(null===(t=i.bootstrap)||void 0===t||null===(n=t.featureFlags)||void 0===n||!n[e])})).reduce((function(e,t){var n,r;return e[t]=(null===(n=i.bootstrap)||void 0===n||null===(r=n.featureFlags)||void 0===r?void 0:r[t])||!1,e}),{}),m=Object.keys((null===(p=i.bootstrap)||void 0===p?void 0:p.featureFlagPayloads)||{}).filter((function(e){return f[e]})).reduce((function(e,t){var n,r,o,s;return null!==(n=i.bootstrap)&&void 0!==n&&null!==(r=n.featureFlagPayloads)&&void 0!==r&&r[t]&&(e[t]=null===(o=i.bootstrap)||void 0===o||null===(s=o.featureFlagPayloads)||void 0===s?void 0:s[t]),e}),{});this.featureFlags.receivedFeatureFlags({featureFlags:f,featureFlagPayloads:m})}if(!this.get_distinct_id()){var v=this.config.get_device_id(qc());this.register_once({distinct_id:v,$device_id:v},""),this.persistence.set_property(al,"anonymous")}return null==ie||null===(n=ie.addEventListener)||void 0===n||n.call(ie,"onpagehide"in self?"pagehide":"unload",this._handle_unload.bind(this)),this.toolbar.maybeLoadToolbar(),i.segment?FMe(this,(function(){return r._loaded()})):this._loaded(),qs(this.config._onCapture)&&this.on("eventCaptured",(function(e){return r.config._onCapture(e.event,e)})),this}},{key:"_afterDecideResponse",value:function(e){var t,n,r,i,o,s,a,l;this.compression=void 0,e.supportedCompression&&!this.config.disable_compression&&(this.compression=Tt(e.supportedCompression,Mo.GZipJS)?Mo.GZipJS:Tt(e.supportedCompression,Mo.Base64)?Mo.Base64:void 0),null!==(t=e.analytics)&&void 0!==t&&t.endpoint&&(this.analyticsDefaultEndpoint=e.analytics.endpoint),null===(n=this.sessionRecording)||void 0===n||n.afterDecideResponse(e),null===(r=this.autocapture)||void 0===r||r.afterDecideResponse(e),null===(i=this.heatmaps)||void 0===i||i.afterDecideResponse(e),null===(o=this.surveys)||void 0===o||o.afterDecideResponse(e),null===(s=this.webVitalsAutocapture)||void 0===s||s.afterDecideResponse(e),null===(a=this.exceptions)||void 0===a||a.afterDecideResponse(e),null===(l=this.exceptionObserver)||void 0===l||l.afterDecideResponse(e)}},{key:"_loaded",value:function(){var e=this,t=this.config.advanced_disable_decide;t||this.featureFlags.setReloadingPaused(!0);try{this.config.loaded(this)}catch(e){pe.critical("`loaded` function failed",e)}this._start_queue_if_opted_in(),this.config.capture_pageview&&setTimeout((function(){e.consent.isOptedIn()&&e._captureInitialPageview()}),1),t||(new bMe(this).call(),this.featureFlags.resetRequestQueue())}},{key:"_start_queue_if_opted_in",value:function(){var e;this.has_opted_out_capturing()||this.config.request_batching&&(null===(e=this._requestQueue)||void 0===e||e.enable())}},{key:"_dom_loaded",value:function(){var e=this;this.has_opted_out_capturing()||Yh(this.__request_queue,(function(t){return e._send_retriable_request(t)})),this.__request_queue=[],this._start_queue_if_opted_in()}},{key:"_handle_unload",value:function(){var e,t;this.config.request_batching?(this._shouldCapturePageleave()&&this.capture("$pageleave"),null===(e=this._requestQueue)||void 0===e||e.unload(),null===(t=this._retryQueue)||void 0===t||t.unload()):this._shouldCapturePageleave()&&this.capture("$pageleave",null,{transport:"sendBeacon"})}},{key:"_send_request",value:function(e){var t=this;this.__loaded&&(bZ?this.__request_queue.push(e):this.rateLimiter.isServerRateLimited(e.batchKey)||(e.transport=e.transport||this.config.api_transport,e.url=XS(e.url,{ip:this.config.ip?1:0}),e.headers=De({},this.config.request_headers),e.compression="best-available"===e.compression?this.compression:e.compression,function(e){var t,n,r,i=De({},e);i.timeout=i.timeout||6e4,i.url=XS(i.url,{_:(new Date).getTime().toString(),ver:Ds.LIB_VERSION,compression:i.compression});var o=null!==(t=i.transport)&&void 0!==t?t:"XHR",s=null!==(n=null===(r=FX(fv,(function(e){return e.transport===o})))||void 0===r?void 0:r.method)&&void 0!==n?n:fv[0].method;if(!s)throw new Error("No available transport method");s(i)}(De(De({},e),{},{callback:function(n){var r,i,o;t.rateLimiter.checkForLimiting(n),n.statusCode>=400&&(null===(i=(o=t.config).on_request_error)||void 0===i||i.call(o,n)),null===(r=e.callback)||void 0===r||r.call(e,n)}}))))}},{key:"_send_retriable_request",value:function(e){this._retryQueue?this._retryQueue.retriableRequest(e):this._send_request(e)}},{key:"_execute_array",value:function(e){var t,n=this,r=[],i=[],o=[];Yh(e,(function(e){e&&(t=e[0],_r(t)?o.push(e):qs(e)?e.call(n):_r(e)&&"alias"===t?r.push(e):_r(e)&&-1!==t.indexOf("capture")&&qs(n[t])?o.push(e):i.push(e))}));var s=function(e,t){Yh(e,(function(e){if(_r(e[0])){var n=t;on(e,(function(e){n=n[e[0]].apply(n,e.slice(1))}))}else this[e[0]].apply(this,e.slice(1))}),t)};s(r,this),s(i,this),s(o,this)}},{key:"_hasBootstrappedFeatureFlags",value:function(){var e,t;return(null===(e=this.config.bootstrap)||void 0===e?void 0:e.featureFlags)&&Object.keys(null===(t=this.config.bootstrap)||void 0===t?void 0:t.featureFlags).length>0||!1}},{key:"push",value:function(e){this._execute_array([e])}},{key:"capture",value:function(e,t,n){var r;if(this.__loaded&&this.persistence&&this.sessionPersistence&&this._requestQueue){if(!this.consent.isOptedOut())if(!Ye(e)&&ci(e)){if(this.config.opt_out_useragent_filter||!this._is_bot()){var i=null!=n&&n.skip_client_rate_limiting?void 0:this.rateLimiter.clientRateLimitContext();if(null==i||!i.isRateLimited){this.sessionPersistence.update_search_keyword(),this.config.store_google&&this.sessionPersistence.update_campaign_params(),this.config.save_referrer&&this.sessionPersistence.update_referrer_info(),(this.config.store_google||this.config.save_referrer)&&this.persistence.set_initial_person_info();var o=new Date,s=(null==n?void 0:n.timestamp)||o,a={uuid:qc(),event:e,properties:this._calculate_event_properties(e,t||{},s)};i&&(a.properties.$lib_rate_limit_remaining_tokens=i.remainingTokens),null!=n&&n.$set&&(a.$set=null==n?void 0:n.$set);var l=this._calculate_set_once_properties(null==n?void 0:n.$set_once);l&&(a.$set_once=l),(a=LOe(a,null!=n&&n._noTruncate?null:this.config.properties_string_max_length)).timestamp=s,Ye(null==n?void 0:n.timestamp)||(a.properties.$event_time_override_provided=!0,a.properties.$event_time_override_system_time=o);var c=De(De({},a.properties.$set),a.$set);kb(c)||this.setPersonPropertiesForFlags(c),this._internalEventEmitter.emit("eventCaptured",a);var u={method:"POST",url:null!==(r=null==n?void 0:n._url)&&void 0!==r?r:this.requestRouter.endpointFor("api",this.analyticsDefaultEndpoint),data:a,compression:"best-available",batchKey:null==n?void 0:n._batchKey};return!this.config.request_batching||n&&(null==n||!n._batchKey)||null!=n&&n.send_instantly?this._send_retriable_request(u):this._requestQueue.enqueue(u),a}pe.critical("This capture call is ignored due to client rate limiting.")}}else pe.error("No event name provided to posthog.capture")}else pe.uninitializedWarning("posthog.capture")}},{key:"_addCaptureHook",value:function(e){this.on("eventCaptured",(function(t){return e(t.event,t)}))}},{key:"_calculate_event_properties",value:function(e,t,n){if(n=n||new Date,!this.persistence||!this.sessionPersistence)return t;var r=this.persistence.remove_event_timer(e),i=De({},t);if(i.token=this.config.token,"$snapshot"===e){var o=De(De({},this.persistence.properties()),this.sessionPersistence.properties());return i.distinct_id=o.distinct_id,(!ci(i.distinct_id)&&!js(i.distinct_id)||KD(i.distinct_id))&&pe.error("Invalid distinct_id for replay event. This indicates a bug in your implementation"),i}var s=xr.properties();if(this.sessionManager){var a=this.sessionManager.checkAndGetSessionAndWindowId(),l=a.sessionId,c=a.windowId;i.$session_id=l,i.$window_id=c}if(this.requestRouter.region===bd.CUSTOM&&(i.$lib_custom_api_host=this.config.api_host),this.sessionPropsManager&&this.config.__preview_send_client_session_params&&("$pageview"===e||"$pageleave"===e||"$autocapture"===e)){var u=this.sessionPropsManager.getSessionProps();i=Si(i,u)}if(!this.config.disable_scroll_properties){var d={};"$pageview"===e?d=this.pageViewManager.doPageView(n):"$pageleave"===e&&(d=this.pageViewManager.doPageLeave(n)),i=Si(i,d)}if("$pageview"===e&&He&&(i.title=He.title),!Ye(r)){var h=n.getTime()-r;i.$duration=parseFloat((h/1e3).toFixed(3))}kr&&this.config.opt_out_useragent_filter&&(i.$browser_type=this._is_bot()?"bot":"browser"),(i=Si({},s,this.persistence.properties(),this.sessionPersistence.properties(),i)).$is_identified=this._isIdentified(),_r(this.config.property_denylist)?on(this.config.property_denylist,(function(e){delete i[e]})):pe.error("Invalid value for property_denylist config: "+this.config.property_denylist+" or property_blacklist config: "+this.config.property_blacklist);var p=this.config.sanitize_properties;return p&&(i=p(i,e)),i.$process_person_profile=this._hasPersonProcessing(),i}},{key:"_calculate_set_once_properties",value:function(e){if(!this.persistence||!this._hasPersonProcessing())return e;var t=Si({},this.persistence.get_initial_props(),e||{});return kb(t)?void 0:t}},{key:"register",value:function(e,t){var n;null===(n=this.persistence)||void 0===n||n.register(e,t)}},{key:"register_once",value:function(e,t,n){var r;null===(r=this.persistence)||void 0===r||r.register_once(e,t,n)}},{key:"register_for_session",value:function(e){var t;null===(t=this.sessionPersistence)||void 0===t||t.register(e)}},{key:"unregister",value:function(e){var t;null===(t=this.persistence)||void 0===t||t.unregister(e)}},{key:"unregister_for_session",value:function(e){var t;null===(t=this.sessionPersistence)||void 0===t||t.unregister(e)}},{key:"_register_single",value:function(e,t){this.register(de({},e,t))}},{key:"getFeatureFlag",value:function(e,t){return this.featureFlags.getFeatureFlag(e,t)}},{key:"getFeatureFlagPayload",value:function(e){var t=this.featureFlags.getFeatureFlagPayload(e);try{return JSON.parse(t)}catch{return t}}},{key:"isFeatureEnabled",value:function(e,t){return this.featureFlags.isFeatureEnabled(e,t)}},{key:"reloadFeatureFlags",value:function(){this.featureFlags.reloadFeatureFlags()}},{key:"updateEarlyAccessFeatureEnrollment",value:function(e,t){this.featureFlags.updateEarlyAccessFeatureEnrollment(e,t)}},{key:"getEarlyAccessFeatures",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this.featureFlags.getEarlyAccessFeatures(e,t)}},{key:"on",value:function(e,t){return this._internalEventEmitter.on(e,t)}},{key:"onFeatureFlags",value:function(e){return this.featureFlags.onFeatureFlags(e)}},{key:"onSessionId",value:function(e){var t,n;return null!==(t=null===(n=this.sessionManager)||void 0===n?void 0:n.onSessionId(e))&&void 0!==t?t:function(){}}},{key:"getSurveys",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.surveys.getSurveys(e,t)}},{key:"getActiveMatchingSurveys",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.surveys.getActiveMatchingSurveys(e,t)}},{key:"renderSurvey",value:function(e,t){this.surveys.renderSurvey(e,t)}},{key:"canRenderSurvey",value:function(e){this.surveys.canRenderSurvey(e)}},{key:"getNextSurveyStep",value:function(e,t,n){return this.surveys.getNextSurveyStep(e,t,n)}},{key:"identify",value:function(e,t,n){if(!this.__loaded||!this.persistence)return pe.uninitializedWarning("posthog.identify");if(js(e)&&(e=e.toString(),pe.warn("The first argument to posthog.identify was a number, but it should be a string. It has been converted to a string.")),e){if(["distinct_id","distinctid"].includes(e.toLowerCase()))pe.critical('The string "'.concat(e,'" was set in posthog.identify which indicates an error. This ID should be unique to the user and not a hardcoded string.'));else if(this._requirePersonProcessing("posthog.identify")){var r=this.get_distinct_id();if(this.register({$user_id:e}),!this.get_property("$device_id")){var i=r;this.register_once({$had_persisted_distinct_id:!0,$device_id:i},"")}e!==r&&e!==this.get_property(Dg)&&(this.unregister(Dg),this.register({distinct_id:e}));var o="anonymous"===(this.persistence.get_property(al)||"anonymous");e!==r&&o?(this.persistence.set_property(al,"identified"),this.setPersonPropertiesForFlags(t||{},!1),this.capture("$identify",{distinct_id:e,$anon_distinct_id:r},{$set:t||{},$set_once:n||{}}),this.featureFlags.setAnonymousDistinctId(r)):(t||n)&&this.setPersonProperties(t,n),e!==r&&(this.reloadFeatureFlags(),this.unregister(VS))}}else pe.error("Unique user id has not been set in posthog.identify")}},{key:"setPersonProperties",value:function(e,t){(e||t)&&this._requirePersonProcessing("posthog.setPersonProperties")&&(this.setPersonPropertiesForFlags(e||{}),this.capture("$set",{$set:e||{},$set_once:t||{}}))}},{key:"group",value:function(e,t,n){if(e&&t){if(this._requirePersonProcessing("posthog.group")){var r=this.getGroups();r[e]!==t&&this.resetGroupPropertiesForFlags(e),this.register({$groups:De(De({},r),{},de({},e,t))}),n&&(this.capture("$groupidentify",{$group_type:e,$group_key:t,$group_set:n}),this.setGroupPropertiesForFlags(de({},e,n))),r[e]===t||n||this.reloadFeatureFlags()}}else pe.error("posthog.group requires a group type and group key")}},{key:"resetGroups",value:function(){this.register({$groups:{}}),this.resetGroupPropertiesForFlags(),this.reloadFeatureFlags()}},{key:"setPersonPropertiesForFlags",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this._requirePersonProcessing("posthog.setPersonPropertiesForFlags")&&this.featureFlags.setPersonPropertiesForFlags(e,t)}},{key:"resetPersonPropertiesForFlags",value:function(){this.featureFlags.resetPersonPropertiesForFlags()}},{key:"setGroupPropertiesForFlags",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this._requirePersonProcessing("posthog.setGroupPropertiesForFlags")&&this.featureFlags.setGroupPropertiesForFlags(e,t)}},{key:"resetGroupPropertiesForFlags",value:function(e){this.featureFlags.resetGroupPropertiesForFlags(e)}},{key:"reset",value:function(e){var t,n,r,i;if(pe.info("reset"),!this.__loaded)return pe.uninitializedWarning("posthog.reset");var o=this.get_property("$device_id");this.consent.reset(),null===(t=this.persistence)||void 0===t||t.clear(),null===(n=this.sessionPersistence)||void 0===n||n.clear(),null===(r=this.persistence)||void 0===r||r.set_property(al,"anonymous"),null===(i=this.sessionManager)||void 0===i||i.resetSessionId();var s=this.config.get_device_id(qc());this.register_once({distinct_id:s,$device_id:e?s:o},"")}},{key:"get_distinct_id",value:function(){return this.get_property("distinct_id")}},{key:"getGroups",value:function(){return this.get_property("$groups")||{}}},{key:"get_session_id",value:function(){var e,t;return null!==(e=null===(t=this.sessionManager)||void 0===t?void 0:t.checkAndGetSessionAndWindowId(!0).sessionId)&&void 0!==e?e:""}},{key:"get_session_replay_url",value:function(e){if(!this.sessionManager)return"";var t=this.sessionManager.checkAndGetSessionAndWindowId(!0),n=t.sessionId,r=t.sessionStartTimestamp,i=this.requestRouter.endpointFor("ui","/project/".concat(this.config.token,"/replay/").concat(n));if(null!=e&&e.withTimestamp&&r){var o,s=null!==(o=e.timestampLookBack)&&void 0!==o?o:10;if(!r)return i;var a=Math.max(Math.floor(((new Date).getTime()-r)/1e3)-s,0);i+="?t=".concat(a)}return i}},{key:"alias",value:function(e,t){return e===this.get_property($X)?(pe.critical("Attempting to create alias for existing People user - aborting."),-2):this._requirePersonProcessing("posthog.alias")?(Ye(t)&&(t=this.get_distinct_id()),e!==t?(this._register_single(Dg,e),this.capture("$create_alias",{alias:e,distinct_id:t})):(pe.warn("alias matches current distinct_id - skipping api call."),this.identify(e),-1)):void 0}},{key:"set_config",value:function(e){var t,n,r,i,o=De({},this.config);Wr(e)&&(Si(this.config,Dj(e)),null===(t=this.persistence)||void 0===t||t.update_config(this.config,o),this.sessionPersistence="sessionStorage"===this.config.persistence?this.persistence:new ZR(De(De({},this.config),{},{persistence:"sessionStorage"})),yr.is_supported()&&"true"===yr.get("ph_debug")&&(this.config.debug=!0),this.config.debug&&(Ds.DEBUG=!0,pe.info("set_config",{config:e,oldConfig:o,newConfig:De({},this.config)})),null===(n=this.sessionRecording)||void 0===n||n.startIfEnabledOrStop(),null===(r=this.autocapture)||void 0===r||r.startIfEnabled(),null===(i=this.heatmaps)||void 0===i||i.startIfEnabled(),this.surveys.loadIfEnabled(),this._sync_opt_out_with_persistence())}},{key:"startSessionRecording",value:function(e){var t,n=_d(e)&&e;if(n||null!=e&&e.sampling){var r,i,o=null===(r=this.sessionManager)||void 0===r?void 0:r.checkAndGetSessionAndWindowId();null===(i=this.persistence)||void 0===i||i.register(de({},cv,!0)),pe.info("Session recording started with sampling override for session: ",null==o?void 0:o.sessionId)}(n||null!=e&&e.linked_flag)&&(null===(t=this.sessionRecording)||void 0===t||t.overrideLinkedFlag(),pe.info("Session recording started with linked_flags override")),this.set_config({disable_session_recording:!1})}},{key:"stopSessionRecording",value:function(){this.set_config({disable_session_recording:!0})}},{key:"sessionRecordingStarted",value:function(){var e;return!(null===(e=this.sessionRecording)||void 0===e||!e.started)}},{key:"captureException",value:function(e,t){var n=qs(In.parseErrorAsProperties)?In.parseErrorAsProperties([e.message,void 0,void 0,void 0,e]):De({$exception_type:e.name,$exception_message:e.message,$exception_level:"error"},t);this.exceptions.sendExceptionEvent(n)}},{key:"loadToolbar",value:function(e){return this.toolbar.loadToolbar(e)}},{key:"get_property",value:function(e){var t;return null===(t=this.persistence)||void 0===t?void 0:t.props[e]}},{key:"getSessionProperty",value:function(e){var t;return null===(t=this.sessionPersistence)||void 0===t?void 0:t.props[e]}},{key:"toString",value:function(){var e,t=null!==(e=this.config.name)&&void 0!==e?e:gh;return t!==gh&&(t=gh+"."+t),t}},{key:"_isIdentified",value:function(){var e,t;return"identified"===(null===(e=this.persistence)||void 0===e?void 0:e.get_property(al))||"identified"===(null===(t=this.sessionPersistence)||void 0===t?void 0:t.get_property(al))}},{key:"_hasPersonProcessing",value:function(){var e,t,n,r;return!("never"===this.config.person_profiles||"identified_only"===this.config.person_profiles&&!this._isIdentified()&&kb(this.getGroups())&&(null===(e=this.persistence)||void 0===e||null===(t=e.props)||void 0===t||!t[Dg])&&(null===(n=this.persistence)||void 0===n||null===(r=n.props)||void 0===r||!r[qS]))}},{key:"_shouldCapturePageleave",value:function(){return!0===this.config.capture_pageleave||"if_capture_pageview"===this.config.capture_pageleave&&this.config.capture_pageview}},{key:"createPersonProfile",value:function(){this._hasPersonProcessing()||this._requirePersonProcessing("posthog.createPersonProfile")&&this.setPersonProperties({},{})}},{key:"_requirePersonProcessing",value:function(e){return"never"===this.config.person_profiles?(pe.error(e+' was called, but process_person is set to "never". This call will be ignored.'),!1):(this._register_single(qS,!0),!0)}},{key:"_sync_opt_out_with_persistence",value:function(){var e,t,n,r,i=this.consent.isOptedOut(),o=this.config.opt_out_persistence_by_default,s=this.config.disable_persistence||i&&!!o;(null===(e=this.persistence)||void 0===e?void 0:e.disabled)!==s&&(null===(n=this.persistence)||void 0===n||n.set_disabled(s)),(null===(t=this.sessionPersistence)||void 0===t?void 0:t.disabled)!==s&&(null===(r=this.sessionPersistence)||void 0===r||r.set_disabled(s))}},{key:"opt_in_capturing",value:function(e){var t;this.consent.optInOut(!0),this._sync_opt_out_with_persistence(),(Ye(null==e?void 0:e.captureEventName)||null!=e&&e.captureEventName)&&this.capture(null!==(t=null==e?void 0:e.captureEventName)&&void 0!==t?t:"$opt_in",null==e?void 0:e.captureProperties,{send_instantly:!0}),this.config.capture_pageview&&this._captureInitialPageview()}},{key:"opt_out_capturing",value:function(){this.consent.optInOut(!1),this._sync_opt_out_with_persistence()}},{key:"has_opted_in_capturing",value:function(){return this.consent.isOptedIn()}},{key:"has_opted_out_capturing",value:function(){return this.consent.isOptedOut()}},{key:"clear_opt_in_out_capturing",value:function(){this.consent.reset(),this._sync_opt_out_with_persistence()}},{key:"_is_bot",value:function(){return No?function(e,t){if(!e)return!1;var n=e.userAgent;if(n&&Pj(n,t))return!0;try{var r=null==e?void 0:e.userAgentData;if(null!=r&&r.brands&&r.brands.some((function(e){return Pj(null==e?void 0:e.brand,t)})))return!0}catch{}return!!e.webdriver}(No,this.config.custom_blocked_useragents):void 0}},{key:"_captureInitialPageview",value:function(){He&&!this._initialPageviewCaptured&&(this._initialPageviewCaptured=!0,this.capture("$pageview",{title:He.title},{send_instantly:!0}))}},{key:"debug",value:function(e){!1===e?(null==ie||ie.console.log("You've disabled debug mode."),localStorage&&localStorage.removeItem("ph_debug"),this.set_config({debug:!1})):(null==ie||ie.console.log("You're now in debug mode. All calls to PostHog will be logged in your console.\nYou can disable this with `posthog.debug(false)`."),localStorage&&localStorage.setItem("ph_debug","true"),this.set_config({debug:!0}))}}]),e}();!function(e,t){for(var n=0;n<t.length;n++)e.prototype[t[n]]=POe(e.prototype[t[n]])}(SZ,["identify"]);var jj,rAe=(jj=hv[gh]=new SZ,function(){function e(){e.done||(e.done=!0,bZ=!1,on(hv,(function(e){e._dom_loaded()})))}null!=He&&He.addEventListener&&("complete"===He.readyState?e():He.addEventListener("DOMContentLoaded",e,!1)),ie&&vl(ie,"load",e,!0)}(),jj);class iAe extends xP{constructor(){super(...arguments),this.eventBacklogs=new Map}emit(e,...t){const n=super.emit(e,...t);if(!n){const n=this.eventBacklogs.get(e);n?n.push(t):this.eventBacklogs.set(e,[t])}return n}on(e,t){super.on(e,t);const n=this.eventBacklogs.get(e);if(n){for(const t of n)super.emit(e,...t);this.eventBacklogs.delete(e)}return this}addListener(e,t){return this.on(e,t)}once(e,t){super.once(e,t);const n=this.eventBacklogs.get(e);return n&&(super.emit(e,...n[0]),1===n.length?this.eventBacklogs.delete(e):n.shift()),this}}const sAe=""+new URL("cat-4r_NkDcK.ogg",import.meta.url).href,oAe=""+new URL("cat-Dd8bv_2W.mp3",import.meta.url).href,aAe=""+new URL("clap-AxCMZLTd.ogg",import.meta.url).href,lAe=""+new URL("clap-Dxm5qGyl.mp3",import.meta.url).href,cAe=""+new URL("crickets-DUJdcuUa.ogg",import.meta.url).href,uAe=""+new URL("crickets-CcwrRdbq.mp3",import.meta.url).href,dAe=""+new URL("dog-CxIWtkNX.ogg",import.meta.url).href,fAe=""+new URL("dog-BoQdnF-w.mp3",import.meta.url).href,hAe=""+new URL("generic-BBbS3Wph.ogg",import.meta.url).href,pAe=""+new URL("generic-BFeSb6fL.mp3",import.meta.url).href,mAe=""+new URL("lightbulb-BIeJtAR_.ogg",import.meta.url).href,gAe=""+new URL("lightbulb-BrnY00qi.mp3",import.meta.url).href,vAe=""+new URL("party-D7rIOhAQ.ogg",import.meta.url).href,yAe=""+new URL("party-BZPeTgC3.mp3",import.meta.url).href,_Ae=""+new URL("deer-DPSlVch4.ogg",import.meta.url).href,bAe=""+new URL("deer-91r1Gyrx.mp3",import.meta.url).href,SAe=""+new URL("rock-BVCJXNC-.ogg",import.meta.url).href,EAe=""+new URL("rock-CHdnB31m.mp3",import.meta.url).href,wAe=""+new URL("wave-FiiOzicp.ogg",import.meta.url).href,CAe=""+new URL("wave-Bzf1LSMH.mp3",import.meta.url).href,h4="io.element.call.reaction",Xx={name:"generic",emoji:"",sound:{mp3:pAe,ogg:hAe}},Zx=5,ry=[{emoji:"👍",name:"thumbsup",alias:["+1","yes","thumbs up"]},{emoji:"🎉",name:"party",alias:["hurray","success"],sound:{ogg:vAe,mp3:yAe}},{emoji:"👏",name:"clapping",alias:["celebrate","success"],sound:{ogg:aAe,mp3:lAe}},{emoji:"🐶",name:"dog",alias:["doggo","pupper","woofer","bark"],sound:{ogg:dAe,mp3:fAe}},{emoji:"🐱",name:"cat",alias:["meow","kitty"],sound:{ogg:sAe,mp3:oAe}},{emoji:"💡",name:"lightbulb",alias:["bulb","light","idea","ping"],sound:{ogg:mAe,mp3:gAe}},{emoji:"🦗",name:"crickets",alias:["awkward","silence"],sound:{ogg:cAe,mp3:uAe}},{emoji:"👎",name:"thumbsdown",alias:["-1","no","thumbs no"]},{emoji:"😵‍💫",name:"dizzy",alias:["dazed","confused"]},{emoji:"👌",name:"ok",alias:["okay","cool"]},{emoji:"🥰",name:"heart",alias:["heart","love","smiling"]},{emoji:"😄",name:"laugh",alias:["giggle","joy","smiling"]},{emoji:"🦌",name:"deer",alias:["stag","doe","bleat"],sound:{ogg:_Ae,mp3:bAe}},{emoji:"🤘",name:"rock",alias:["cool","horns","guitar"],sound:{ogg:SAe,mp3:EAe}},{emoji:"👋",name:"wave",alias:["hand","waving"],sound:{ogg:wAe,mp3:CAe}}];var Ar=(e=>(e.JoinCall="io.element.join",e.HangupCall="im.vector.hangup",e.Close="io.element.close",e.TileLayout="io.element.tile_layout",e.SpotlightLayout="io.element.spotlight_layout",e.DeviceMute="io.element.device_mute",e))(Ar||{});const Ge=(()=>{try{const{widgetId:e,parentUrl:t}=Jr();if(e&&t){const n=new URL(t).origin;A.info("Widget API is available");const r=new jae(e,n);r.requestCapability(zg.AlwaysOnScreen);const i=new iAe;[mr.ThemeChange,"io.element.join","im.vector.hangup","io.element.tile_layout","io.element.spotlight_layout","io.element.device_mute"].forEach((e=>{r.on(`action:${e}`,(t=>{t.preventDefault(),i.emit(e,t)}))}));const{roomId:o,userId:s,deviceId:a,baseUrl:l,e2eEnabled:c,allowIceFallback:u}=Jr();if(!o)throw new Error("Room ID must be supplied");if(!s)throw new Error("User ID must be supplied");if(!a)throw new Error("Device ID must be supplied");if(!l)throw new Error("Base URL must be supplied");const d=["org.matrix.rageshake_request",ee.CallEncryptionKeysPrefix,ee.Reaction,ee.RoomRedaction,h4],h=[s,`_${s}_${a}`,`${s}_${a}`].map((e=>({eventType:ee.GroupCallMemberPrefix,stateKey:e}))),p=[{eventType:ee.RoomCreate},{eventType:ee.RoomMember},{eventType:ee.RoomEncryption},{eventType:ee.GroupCallMemberPrefix}],f=[ee.CallInvite,ee.CallCandidates,ee.CallAnswer,ee.CallHangup,ee.CallReject,ee.CallSelectAnswer,ee.CallNegotiate,ee.CallSDPStreamMetadataChanged,ee.CallSDPStreamMetadataChangedPrefix,ee.CallReplaces,ee.CallEncryptionKeysPrefix],m=lB(r,{sendEvent:d,receiveEvent:d,sendState:h,receiveState:p,sendToDevice:f,receiveToDevice:f,turnServers:!1,sendDelayedEvents:!0,updateDelayedEvents:!0},o,{baseUrl:l,userId:s,deviceId:a,timelineSupport:!0,useE2eForGroupCall:c,fallbackICEServerAllowed:u},!1);return{api:r,lazyActions:i,client:(async()=>(await Bt.init(),await m.startClient({clientWellKnownPollPeriod:600}),m))()}}return A.info("No widget API available"),null}catch(e){return A.warn("Continuing without the widget API",e),null}})();class TAe{constructor(){this.cache={startTime:new Date(0),maxParticipantsCount:0}}cacheStartCall(e){this.cache.startTime=e}cacheParticipantCountChanged(e){this.cache.maxParticipantsCount=Math.max(e,this.cache.maxParticipantsCount)}track(e,t,n,r){Et.instance.trackEvent({eventName:"CallEnded",callId:e,callParticipantsMax:this.cache.maxParticipantsCount,callParticipantsOnLeave:t,callDuration:(Date.now()-this.cache.startTime.getTime())/1e3,roomEventEncryptionKeysSent:r.statistics.counters.roomEventEncryptionKeysSent,roomEventEncryptionKeysReceived:r.statistics.counters.roomEventEncryptionKeysReceived,roomEventEncryptionKeysReceivedAverageAge:r.statistics.counters.roomEventEncryptionKeysReceived>0?r.statistics.totals.roomEventEncryptionKeysReceivedTotalAge/r.statistics.counters.roomEventEncryptionKeysReceived:0},{send_instantly:n})}}class RAe{track(e){Et.instance.trackEvent({eventName:"CallStarted",callId:e})}}class IAe{constructor(){this.cache={signupStart:new Date(0),signupEnd:new Date(0)}}cacheSignupStart(e){this.cache.signupStart=e}getSignupEndTime(){return this.cache.signupEnd}cacheSignupEnd(e){this.cache.signupEnd=e}track(){Et.instance.trackEvent({eventName:"Signup",signupDuration:Date.now()-this.cache.signupStart.getTime()}),Et.instance.setRegistrationType(Dw.Registered)}}class kAe{track(){Et.instance.trackEvent({eventName:"Login"}),Et.instance.setRegistrationType(Dw.Registered)}}class xAe{track(e,t){Et.instance.trackEvent({eventName:"MuteMicrophone",targetMuteState:e?"mute":"unmute",callId:t})}}class PAe{track(e,t){Et.instance.trackEvent({eventName:"MuteCamera",targetMuteState:e?"mute":"unmute",callId:t})}}class LAe{track(e){Et.instance.trackEvent({eventName:"UndecryptableToDeviceEvent",callId:e})}}class OAe{track(e,t,n){Et.instance.trackEvent({eventName:"QualitySurvey",callId:e,feedbackText:t,stars:n})}}class MAe{track(e){Et.instance.trackEvent({eventName:"CallDisconnected",reason:e})}}class AAe{constructor(){this.connectStart=0,this.websocketConnected=0}cacheConnectStart(){this.connectStart=Date.now()}cacheWsConnect(){this.websocketConnected=Date.now()}track(e={log:!1}){const t=Date.now(),n=t-this.connectStart,r=this.websocketConnected-this.connectStart,i=t-this.websocketConnected;Et.instance.trackEvent({eventName:"CallConnectDuration",totalDuration:n,websocketDuration:r,peerConnectionDuration:i}),e.log&&A.log(`Time to connect:\ntotal: ${n}ms\npeerConnection: ${r}ms\nwebsocket: ${i}ms`)}}function Wt(e){return"function"==typeof e}function EZ(e){var t=e((function(e){Error.call(e),e.stack=(new Error).stack}));return t.prototype=Object.create(Error.prototype),t.prototype.constructor=t,t}var iI=EZ((function(e){return function(t){e(this),this.message=t?t.length+" errors occurred during unsubscription:\n"+t.map((function(e,t){return t+1+") "+e.toString()})).join("\n  "):"",this.name="UnsubscriptionError",this.errors=t}}));function QS(e,t){if(e){var n=e.indexOf(t);0<=n&&e.splice(n,1)}}var Ky=function(){function e(e){this.initialTeardown=e,this.closed=!1,this._parentage=null,this._finalizers=null}return e.prototype.unsubscribe=function(){var e,t,n,r,i;if(!this.closed){this.closed=!0;var o=this._parentage;if(o)if(this._parentage=null,Array.isArray(o))try{for(var s=_u(o),a=s.next();!a.done;a=s.next()){a.value.remove(this)}}catch(t){e={error:t}}finally{try{a&&!a.done&&(t=s.return)&&t.call(s)}finally{if(e)throw e.error}}else o.remove(this);var l=this.initialTeardown;if(Wt(l))try{l()}catch(e){i=e instanceof iI?e.errors:[e]}var c=this._finalizers;if(c){this._finalizers=null;try{for(var u=_u(c),d=u.next();!d.done;d=u.next()){var h=d.value;try{Uj(h)}catch(e){i=i??[],e instanceof iI?i=Qs(Qs([],Zs(i)),Zs(e.errors)):i.push(e)}}}catch(e){n={error:e}}finally{try{d&&!d.done&&(r=u.return)&&r.call(u)}finally{if(n)throw n.error}}}if(i)throw new iI(i)}},e.prototype.add=function(t){var n;if(t&&t!==this)if(this.closed)Uj(t);else{if(t instanceof e){if(t.closed||t._hasParent(this))return;t._addParent(this)}(this._finalizers=null!==(n=this._finalizers)&&void 0!==n?n:[]).push(t)}},e.prototype._hasParent=function(e){var t=this._parentage;return t===e||Array.isArray(t)&&t.includes(e)},e.prototype._addParent=function(e){var t=this._parentage;this._parentage=Array.isArray(t)?(t.push(e),t):t?[t,e]:e},e.prototype._removeParent=function(e){var t=this._parentage;t===e?this._parentage=null:Array.isArray(t)&&QS(t,e)},e.prototype.remove=function(t){var n=this._finalizers;n&&QS(n,t),t instanceof e&&t._removeParent(this)},e.EMPTY=((t=new e).closed=!0,t),e;var t}(),wZ=Ky.EMPTY;function CZ(e){return e instanceof Ky||e&&"closed"in e&&Wt(e.remove)&&Wt(e.add)&&Wt(e.unsubscribe)}function Uj(e){Wt(e)?e():e.unsubscribe()}var NAe={Promise:void 0},DAe={setTimeout:function(e,t){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];return setTimeout.apply(void 0,Qs([e,t],Zs(n)))},clearTimeout:function(e){return clearTimeout(e)},delegate:void 0};function TZ(e){DAe.setTimeout((function(){throw e}))}function eE(){}function Lb(e){e()}var p4=function(e){function t(t){var n=e.call(this)||this;return n.isStopped=!1,t?(n.destination=t,CZ(t)&&t.add(n)):n.destination=FAe,n}return no(t,e),t.create=function(e,t,n){return new iy(e,t,n)},t.prototype.next=function(e){this.isStopped||this._next(e)},t.prototype.error=function(e){this.isStopped||(this.isStopped=!0,this._error(e))},t.prototype.complete=function(){this.isStopped||(this.isStopped=!0,this._complete())},t.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,e.prototype.unsubscribe.call(this),this.destination=null)},t.prototype._next=function(e){this.destination.next(e)},t.prototype._error=function(e){try{this.destination.error(e)}finally{this.unsubscribe()}},t.prototype._complete=function(){try{this.destination.complete()}finally{this.unsubscribe()}},t}(Ky),jAe=function(){function e(e){this.partialObserver=e}return e.prototype.next=function(e){var t=this.partialObserver;if(t.next)try{t.next(e)}catch(e){h_(e)}},e.prototype.error=function(e){var t=this.partialObserver;if(t.error)try{t.error(e)}catch(e){h_(e)}else h_(e)},e.prototype.complete=function(){var e=this.partialObserver;if(e.complete)try{e.complete()}catch(e){h_(e)}},e}(),iy=function(e){function t(t,n,r){var i,o=e.call(this)||this;return i=Wt(t)||!t?{next:t??void 0,error:n??void 0,complete:r??void 0}:t,o.destination=new jAe(i),o}return no(t,e),t}(p4);function h_(e){TZ(e)}function UAe(e){throw e}var FAe={closed:!0,next:eE,error:UAe,complete:eE},m4="function"==typeof Symbol&&Symbol.observable||"@@observable";function Ou(e){return e}function $Ae(e){return 0===e.length?Ou:1===e.length?e[0]:function(t){return e.reduce((function(e,t){return t(e)}),t)}}var Dn=function(){function e(e){e&&(this._subscribe=e)}return e.prototype.lift=function(t){var n=new e;return n.source=this,n.operator=t,n},e.prototype.subscribe=function(e,t,n){var r=this,i=BAe(e)?e:new iy(e,t,n);return Lb((function(){var e=r,t=e.operator,n=e.source;i.add(t?t.call(i,n):n?r._subscribe(i):r._trySubscribe(i))})),i},e.prototype._trySubscribe=function(e){try{return this._subscribe(e)}catch(t){e.error(t)}},e.prototype.forEach=function(e,t){var n=this;return new(t=Fj(t))((function(t,r){var i=new iy({next:function(t){try{e(t)}catch(e){r(e),i.unsubscribe()}},error:r,complete:t});n.subscribe(i)}))},e.prototype._subscribe=function(e){var t;return null===(t=this.source)||void 0===t?void 0:t.subscribe(e)},e.prototype[m4]=function(){return this},e.prototype.pipe=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return $Ae(e)(this)},e.prototype.toPromise=function(e){var t=this;return new(e=Fj(e))((function(e,n){var r;t.subscribe((function(e){return r=e}),(function(e){return n(e)}),(function(){return e(r)}))}))},e.create=function(t){return new e(t)},e}();function Fj(e){var t;return null!==(t=e??NAe.Promise)&&void 0!==t?t:Promise}function HAe(e){return e&&Wt(e.next)&&Wt(e.error)&&Wt(e.complete)}function BAe(e){return e&&e instanceof p4||HAe(e)&&CZ(e)}function VAe(e){return Wt(null==e?void 0:e.lift)}function jr(e){return function(t){if(VAe(t))return t.lift((function(t){try{return e(t,this)}catch(e){this.error(e)}}));throw new TypeError("Unable to lift unknown Observable type")}}function Qn(e,t,n,r,i){return new qAe(e,t,n,r,i)}var qAe=function(e){function t(t,n,r,i,o,s){var a=e.call(this,t)||this;return a.onFinalize=o,a.shouldUnsubscribe=s,a._next=n?function(e){try{n(e)}catch(e){t.error(e)}}:e.prototype._next,a._error=i?function(e){try{i(e)}catch(e){t.error(e)}finally{this.unsubscribe()}}:e.prototype._error,a._complete=r?function(){try{r()}catch(e){t.error(e)}finally{this.unsubscribe()}}:e.prototype._complete,a}return no(t,e),t.prototype.unsubscribe=function(){var t;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){var n=this.closed;e.prototype.unsubscribe.call(this),!n&&(null===(t=this.onFinalize)||void 0===t||t.call(this))}},t}(p4),KAe=EZ((function(e){return function(){e(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"}})),Or=function(e){function t(){var t=e.call(this)||this;return t.closed=!1,t.currentObservers=null,t.observers=[],t.isStopped=!1,t.hasError=!1,t.thrownError=null,t}return no(t,e),t.prototype.lift=function(e){var t=new $j(this,this);return t.operator=e,t},t.prototype._throwIfClosed=function(){if(this.closed)throw new KAe},t.prototype.next=function(e){var t=this;Lb((function(){var n,r;if(t._throwIfClosed(),!t.isStopped){t.currentObservers||(t.currentObservers=Array.from(t.observers));try{for(var i=_u(t.currentObservers),o=i.next();!o.done;o=i.next()){o.value.next(e)}}catch(e){n={error:e}}finally{try{o&&!o.done&&(r=i.return)&&r.call(i)}finally{if(n)throw n.error}}}}))},t.prototype.error=function(e){var t=this;Lb((function(){if(t._throwIfClosed(),!t.isStopped){t.hasError=t.isStopped=!0,t.thrownError=e;for(var n=t.observers;n.length;)n.shift().error(e)}}))},t.prototype.complete=function(){var e=this;Lb((function(){if(e._throwIfClosed(),!e.isStopped){e.isStopped=!0;for(var t=e.observers;t.length;)t.shift().complete()}}))},t.prototype.unsubscribe=function(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null},Object.defineProperty(t.prototype,"observed",{get:function(){var e;return(null===(e=this.observers)||void 0===e?void 0:e.length)>0},enumerable:!1,configurable:!0}),t.prototype._trySubscribe=function(t){return this._throwIfClosed(),e.prototype._trySubscribe.call(this,t)},t.prototype._subscribe=function(e){return this._throwIfClosed(),this._checkFinalizedStatuses(e),this._innerSubscribe(e)},t.prototype._innerSubscribe=function(e){var t=this,n=this,r=n.hasError,i=n.isStopped,o=n.observers;return r||i?wZ:(this.currentObservers=null,o.push(e),new Ky((function(){t.currentObservers=null,QS(o,e)})))},t.prototype._checkFinalizedStatuses=function(e){var t=this,n=t.hasError,r=t.thrownError,i=t.isStopped;n?e.error(r):i&&e.complete()},t.prototype.asObservable=function(){var e=new Dn;return e.source=this,e},t.create=function(e,t){return new $j(e,t)},t}(Dn),$j=function(e){function t(t,n){var r=e.call(this)||this;return r.destination=t,r.source=n,r}return no(t,e),t.prototype.next=function(e){var t,n;null===(n=null===(t=this.destination)||void 0===t?void 0:t.next)||void 0===n||n.call(t,e)},t.prototype.error=function(e){var t,n;null===(n=null===(t=this.destination)||void 0===t?void 0:t.error)||void 0===n||n.call(t,e)},t.prototype.complete=function(){var e,t;null===(t=null===(e=this.destination)||void 0===e?void 0:e.complete)||void 0===t||t.call(e)},t.prototype._subscribe=function(e){var t,n;return null!==(n=null===(t=this.source)||void 0===t?void 0:t.subscribe(e))&&void 0!==n?n:wZ},t}(Or),ns=function(e){function t(t){var n=e.call(this)||this;return n._value=t,n}return no(t,e),Object.defineProperty(t.prototype,"value",{get:function(){return this.getValue()},enumerable:!1,configurable:!0}),t.prototype._subscribe=function(t){var n=e.prototype._subscribe.call(this,t);return!n.closed&&t.next(this._value),n},t.prototype.getValue=function(){var e=this,t=e.hasError,n=e.thrownError,r=e._value;if(t)throw n;return this._throwIfClosed(),r},t.prototype.next=function(t){e.prototype.next.call(this,this._value=t)},t}(Or),g4={now:function(){return(g4.delegate||Date).now()},delegate:void 0},GAe=function(e){function t(t,n,r){void 0===t&&(t=1/0),void 0===n&&(n=1/0),void 0===r&&(r=g4);var i=e.call(this)||this;return i._bufferSize=t,i._windowTime=n,i._timestampProvider=r,i._buffer=[],i._infiniteTimeWindow=!0,i._infiniteTimeWindow=n===1/0,i._bufferSize=Math.max(1,t),i._windowTime=Math.max(1,n),i}return no(t,e),t.prototype.next=function(t){var n=this,r=n.isStopped,i=n._buffer,o=n._infiniteTimeWindow,s=n._timestampProvider,a=n._windowTime;r||(i.push(t),!o&&i.push(s.now()+a)),this._trimBuffer(),e.prototype.next.call(this,t)},t.prototype._subscribe=function(e){this._throwIfClosed(),this._trimBuffer();for(var t=this._innerSubscribe(e),n=this._infiniteTimeWindow,r=this._buffer.slice(),i=0;i<r.length&&!e.closed;i+=n?1:2)e.next(r[i]);return this._checkFinalizedStatuses(e),t},t.prototype._trimBuffer=function(){var e=this,t=e._bufferSize,n=e._timestampProvider,r=e._buffer,i=e._infiniteTimeWindow,o=(i?1:2)*t;if(t<1/0&&o<r.length&&r.splice(0,r.length-o),!i){for(var s=n.now(),a=0,l=1;l<r.length&&r[l]<=s;l+=2)a=l;a&&r.splice(0,a+1)}},t}(Or),WAe=function(e){function t(t,n){return e.call(this)||this}return no(t,e),t.prototype.schedule=function(e,t){return this},t}(Ky),Hj={setInterval:function(e,t){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];return setInterval.apply(void 0,Qs([e,t],Zs(n)))},clearInterval:function(e){return clearInterval(e)},delegate:void 0},zAe=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.scheduler=t,r.work=n,r.pending=!1,r}return no(t,e),t.prototype.schedule=function(e,t){var n;if(void 0===t&&(t=0),this.closed)return this;this.state=e;var r=this.id,i=this.scheduler;return null!=r&&(this.id=this.recycleAsyncId(i,r,t)),this.pending=!0,this.delay=t,this.id=null!==(n=this.id)&&void 0!==n?n:this.requestAsyncId(i,this.id,t),this},t.prototype.requestAsyncId=function(e,t,n){return void 0===n&&(n=0),Hj.setInterval(e.flush.bind(e,this),n)},t.prototype.recycleAsyncId=function(e,t,n){if(void 0===n&&(n=0),null!=n&&this.delay===n&&!1===this.pending)return t;null!=t&&Hj.clearInterval(t)},t.prototype.execute=function(e,t){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;var n=this._execute(e,t);if(n)return n;!1===this.pending&&null!=this.id&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))},t.prototype._execute=function(e,t){var n,r=!1;try{this.work(e)}catch(e){r=!0,n=e||new Error("Scheduled action threw falsy error")}if(r)return this.unsubscribe(),n},t.prototype.unsubscribe=function(){if(!this.closed){var t=this.id,n=this.scheduler,r=n.actions;this.work=this.state=this.scheduler=null,this.pending=!1,QS(r,this),null!=t&&(this.id=this.recycleAsyncId(n,t,null)),this.delay=null,e.prototype.unsubscribe.call(this)}},t}(WAe),Bj=function(){function e(t,n){void 0===n&&(n=e.now),this.schedulerActionCtor=t,this.now=n}return e.prototype.schedule=function(e,t,n){return void 0===t&&(t=0),new this.schedulerActionCtor(this,e).schedule(n,t)},e.now=g4.now,e}(),YAe=function(e){function t(t,n){void 0===n&&(n=Bj.now);var r=e.call(this,t,n)||this;return r.actions=[],r._active=!1,r}return no(t,e),t.prototype.flush=function(e){var t=this.actions;if(this._active)t.push(e);else{var n;this._active=!0;do{if(n=e.execute(e.state,e.delay))break}while(e=t.shift());if(this._active=!1,n){for(;e=t.shift();)e.unsubscribe();throw n}}},t}(Bj),Aw=new YAe(zAe),JAe=Aw,tE=new Dn((function(e){return e.complete()}));function RZ(e){return e&&Wt(e.schedule)}function v4(e){return e[e.length-1]}function y4(e){return Wt(v4(e))?e.pop():void 0}function Gy(e){return RZ(v4(e))?e.pop():void 0}function XAe(e,t){return"number"==typeof v4(e)?e.pop():t}var _4=function(e){return e&&"number"==typeof e.length&&"function"!=typeof e};function IZ(e){return Wt(null==e?void 0:e.then)}function kZ(e){return Wt(e[m4])}function xZ(e){return Symbol.asyncIterator&&Wt(null==e?void 0:e[Symbol.asyncIterator])}function PZ(e){return new TypeError("You provided "+(null!==e&&"object"==typeof e?"an invalid object":"'"+e+"'")+" where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.")}function ZAe(){return"function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator"}var LZ=ZAe();function OZ(e){return Wt(null==e?void 0:e[LZ])}function MZ(e){return a6(this,arguments,(function(){var t,n,r;return mw(this,(function(i){switch(i.label){case 0:t=e.getReader(),i.label=1;case 1:i.trys.push([1,,9,10]),i.label=2;case 2:return[4,Il(t.read())];case 3:return n=i.sent(),r=n.value,n.done?[4,Il(void 0)]:[3,5];case 4:return[2,i.sent()];case 5:return[4,Il(r)];case 6:return[4,i.sent()];case 7:return i.sent(),[3,2];case 8:return[3,10];case 9:return t.releaseLock(),[7];case 10:return[2]}}))}))}function AZ(e){return Wt(null==e?void 0:e.getReader)}function Sr(e){if(e instanceof Dn)return e;if(null!=e){if(kZ(e))return QAe(e);if(_4(e))return e5e(e);if(IZ(e))return t5e(e);if(xZ(e))return NZ(e);if(OZ(e))return n5e(e);if(AZ(e))return r5e(e)}throw PZ(e)}function QAe(e){return new Dn((function(t){var n=e[m4]();if(Wt(n.subscribe))return n.subscribe(t);throw new TypeError("Provided object does not correctly implement Symbol.observable")}))}function e5e(e){return new Dn((function(t){for(var n=0;n<e.length&&!t.closed;n++)t.next(e[n]);t.complete()}))}function t5e(e){return new Dn((function(t){e.then((function(e){t.closed||(t.next(e),t.complete())}),(function(e){return t.error(e)})).then(null,TZ)}))}function n5e(e){return new Dn((function(t){var n,r;try{for(var i=_u(e),o=i.next();!o.done;o=i.next()){var s=o.value;if(t.next(s),t.closed)return}}catch(e){n={error:e}}finally{try{o&&!o.done&&(r=i.return)&&r.call(i)}finally{if(n)throw n.error}}t.complete()}))}function NZ(e){return new Dn((function(t){i5e(e,t).catch((function(e){return t.error(e)}))}))}function r5e(e){return NZ(MZ(e))}function i5e(e,t){var n,r,i,o;return o6(this,void 0,void 0,(function(){var s,a;return mw(this,(function(l){switch(l.label){case 0:l.trys.push([0,5,6,11]),n=l6(e),l.label=1;case 1:return[4,n.next()];case 2:if((r=l.sent()).done)return[3,4];if(s=r.value,t.next(s),t.closed)return[2];l.label=3;case 3:return[3,1];case 4:return[3,11];case 5:return a=l.sent(),i={error:a},[3,11];case 6:return l.trys.push([6,,9,10]),r&&!r.done&&(o=n.return)?[4,o.call(n)]:[3,8];case 7:l.sent(),l.label=8;case 8:return[3,10];case 9:if(i)throw i.error;return[7];case 10:return[7];case 11:return t.complete(),[2]}}))}))}function ru(e,t,n,r,i){void 0===r&&(r=0),void 0===i&&(i=!1);var o=t.schedule((function(){n(),i?e.add(this.schedule(null,r)):this.unsubscribe()}),r);if(e.add(o),!i)return o}function DZ(e,t){return void 0===t&&(t=0),jr((function(n,r){n.subscribe(Qn(r,(function(n){return ru(r,e,(function(){return r.next(n)}),t)}),(function(){return ru(r,e,(function(){return r.complete()}),t)}),(function(n){return ru(r,e,(function(){return r.error(n)}),t)})))}))}function jZ(e,t){return void 0===t&&(t=0),jr((function(n,r){r.add(e.schedule((function(){return n.subscribe(r)}),t))}))}function s5e(e,t){return Sr(e).pipe(jZ(t),DZ(t))}function o5e(e,t){return Sr(e).pipe(jZ(t),DZ(t))}function a5e(e,t){return new Dn((function(n){var r=0;return t.schedule((function(){r===e.length?n.complete():(n.next(e[r++]),n.closed||this.schedule())}))}))}function l5e(e,t){return new Dn((function(n){var r;return ru(n,t,(function(){r=e[LZ](),ru(n,t,(function(){var e,t,i;try{t=(e=r.next()).value,i=e.done}catch(e){return void n.error(e)}i?n.complete():n.next(t)}),0,!0)})),function(){return Wt(null==r?void 0:r.return)&&r.return()}}))}function UZ(e,t){if(!e)throw new Error("Iterable cannot be null");return new Dn((function(n){ru(n,t,(function(){var r=e[Symbol.asyncIterator]();ru(n,t,(function(){r.next().then((function(e){e.done?n.complete():n.next(e.value)}))}),0,!0)}))}))}function c5e(e,t){return UZ(MZ(e),t)}function u5e(e,t){if(null!=e){if(kZ(e))return s5e(e,t);if(_4(e))return a5e(e,t);if(IZ(e))return o5e(e,t);if(xZ(e))return UZ(e,t);if(OZ(e))return l5e(e,t);if(AZ(e))return c5e(e,t)}throw PZ(e)}function Wy(e,t){return t?u5e(e,t):Sr(e)}function Rt(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return Wy(e,Gy(e))}function d5e(e){return!!e&&(e instanceof Dn||Wt(e.lift)&&Wt(e.subscribe))}function f5e(e){return e instanceof Date&&!isNaN(e)}function Ne(e,t){return jr((function(n,r){var i=0;n.subscribe(Qn(r,(function(n){r.next(e.call(t,n,i++))})))}))}var h5e=Array.isArray;function p5e(e,t){return h5e(t)?e.apply(void 0,Qs([],Zs(t))):e(t)}function b4(e){return Ne((function(t){return p5e(e,t)}))}var m5e=Array.isArray,g5e=Object.getPrototypeOf,v5e=Object.prototype,y5e=Object.keys;function FZ(e){if(1===e.length){var t=e[0];if(m5e(t))return{args:t,keys:null};if(_5e(t)){var n=y5e(t);return{args:n.map((function(e){return t[e]})),keys:n}}}return{args:e,keys:null}}function _5e(e){return e&&"object"==typeof e&&g5e(e)===v5e}function $Z(e,t){return e.reduce((function(e,n,r){return e[n]=t[r],e}),{})}function $n(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=Gy(e),r=y4(e),i=FZ(e),o=i.args,s=i.keys;if(0===o.length)return Wy([],n);var a=new Dn(b5e(o,n,s?function(e){return $Z(s,e)}:Ou));return r?a.pipe(b4(r)):a}function b5e(e,t,n){return void 0===n&&(n=Ou),function(r){Vj(t,(function(){for(var i=e.length,o=new Array(i),s=i,a=i,l=function(i){Vj(t,(function(){var l=Wy(e[i],t),c=!1;l.subscribe(Qn(r,(function(e){o[i]=e,c||(c=!0,a--),a||r.next(n(o.slice()))}),(function(){--s||r.complete()})))}),r)},c=0;c<i;c++)l(c)}),r)}}function Vj(e,t,n){e?ru(n,e,t):t()}function S5e(e,t,n,r,i,o,s,a){var l=[],c=0,u=0,d=!1,h=function(){d&&!l.length&&!c&&t.complete()},p=function(e){c++;var i=!1;Sr(n(e,u++)).subscribe(Qn(t,(function(e){t.next(e)}),(function(){i=!0}),void 0,(function(){if(i)try{c--;for(;l.length&&c<r;)e=void 0,e=l.shift(),s||p(e);h()}catch(e){t.error(e)}var e})))};return e.subscribe(Qn(t,(function(e){return c<r?p(e):l.push(e)}),(function(){d=!0,h()}))),function(){}}function zy(e,t,n){return void 0===n&&(n=1/0),Wt(t)?zy((function(n,r){return Ne((function(e,i){return t(n,e,r,i)}))(Sr(e(n,r)))}),n):("number"==typeof t&&(n=t),jr((function(t,r){return S5e(t,r,e,n)})))}function HZ(e){return void 0===e&&(e=1/0),zy(Ou,e)}function E5e(){return HZ(1)}function nE(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return E5e()(Wy(e,Gy(e)))}function w5e(e){return new Dn((function(t){Sr(e()).subscribe(t)}))}function C5e(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=y4(e),r=FZ(e),i=r.args,o=r.keys,s=new Dn((function(e){var t=i.length;if(t)for(var n=new Array(t),r=t,s=t,a=function(t){var a=!1;Sr(i[t]).subscribe(Qn(e,(function(e){a||(a=!0,s--),n[t]=e}),(function(){return r--}),void 0,(function(){(!r||!a)&&(s||e.next(o?$Z(o,n):n),e.complete())})))},l=0;l<t;l++)a(l);else e.complete()}));return n?s.pipe(b4(n)):s}var T5e=["addListener","removeListener"],R5e=["addEventListener","removeEventListener"],I5e=["on","off"];function Sa(e,t,n,r){if(Wt(n)&&(r=n,n=void 0),r)return Sa(e,t,n).pipe(b4(r));var i=Zs(P5e(e)?R5e.map((function(r){return function(i){return e[r](t,i,n)}})):k5e(e)?T5e.map(qj(e,t)):x5e(e)?I5e.map(qj(e,t)):[],2),o=i[0],s=i[1];if(!o&&_4(e))return zy((function(e){return Sa(e,t,n)}))(Sr(e));if(!o)throw new TypeError("Invalid event target");return new Dn((function(e){var t=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return e.next(1<t.length?t:t[0])};return o(t),function(){return s(t)}}))}function qj(e,t){return function(n){return function(r){return e[n](t,r)}}}function k5e(e){return Wt(e.addListener)&&Wt(e.removeListener)}function x5e(e){return Wt(e.on)&&Wt(e.off)}function P5e(e){return Wt(e.addEventListener)&&Wt(e.removeEventListener)}function Kc(e,t,n){void 0===e&&(e=0),void 0===n&&(n=JAe);var r=-1;return null!=t&&(RZ(t)?n=t:r=t),new Dn((function(t){var i=f5e(e)?+e-n.now():e;i<0&&(i=0);var o=0;return n.schedule((function(){t.closed||(t.next(o++),0<=r?this.schedule(void 0,r):t.complete())}),i)}))}function Qx(e,t){return void 0===e&&(e=0),void 0===t&&(t=Aw),e<0&&(e=0),Kc(e,e,t)}function sy(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=Gy(e),r=XAe(e,1/0),i=e;return i.length?1===i.length?Sr(i[0]):HZ(r)(Wy(i,n)):tE}var L5e=Array.isArray;function O5e(e){return 1===e.length&&L5e(e[0])?e[0]:e}function Fo(e,t){return jr((function(n,r){var i=0;n.subscribe(Qn(r,(function(n){return e.call(t,n,i++)&&r.next(n)})))}))}function M5e(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return 1===(e=O5e(e)).length?Sr(e[0]):new Dn(A5e(e))}function A5e(e){return function(t){for(var n=[],r=function(r){n.push(Sr(e[r]).subscribe(Qn(t,(function(e){if(n){for(var i=0;i<n.length;i++)i!==r&&n[i].unsubscribe();n=null}t.next(e)}))))},i=0;n&&!t.closed&&i<e.length;i++)r(i)}}function N5e(e){return jr((function(t,n){var r=!1,i=null,o=null,s=!1,a=function(){if(null==o||o.unsubscribe(),o=null,r){r=!1;var e=i;i=null,n.next(e)}s&&n.complete()},l=function(){o=null,s&&n.complete()};t.subscribe(Qn(n,(function(t){r=!0,i=t,o||Sr(e(t)).subscribe(o=Qn(n,a,l))}),(function(){s=!0,(!r||!o||o.closed)&&n.complete()})))}))}function D5e(e,t,n,r,i){return function(r,o){var s=n,a=t,l=0;r.subscribe(Qn(o,(function(t){var n=l++;a=s?e(a,t,n):(s=!0,t),o.next(a)}),i))}}function eP(e){return e<=0?function(){return tE}:jr((function(t,n){var r=0;t.subscribe(Qn(n,(function(t){++r<=e&&(n.next(t),e<=r&&n.complete())})))}))}function j5e(e){return Ne((function(){return e}))}function U5e(e,t){return zy((function(t,n){return Sr(e(t,n)).pipe(eP(1),j5e(t))}))}function F5e(e,t){void 0===t&&(t=Aw);var n=Kc(e,t);return U5e((function(){return n}))}function va(e,t){return void 0===t&&(t=Ou),e=e??$5e,jr((function(n,r){var i,o=!0;n.subscribe(Qn(r,(function(n){var s=t(n);(o||!e(i,s))&&(o=!1,i=s,r.next(n))})))}))}function $5e(e,t){return e===t}function H5e(e,t){return va((function(t,n){return t[e]===n[e]}))}function BZ(e){return jr((function(t,n){try{t.subscribe(n)}finally{n.add(e)}}))}function nl(e,t){return jr(D5e(e,t,arguments.length>=2,!0))}function B5e(e){void 0===e&&(e={});var t=e.connector,n=void 0===t?function(){return new Or}:t,r=e.resetOnError,i=void 0===r||r,o=e.resetOnComplete,s=void 0===o||o,a=e.resetOnRefCountZero,l=void 0===a||a;return function(e){var t,r,o,a=0,c=!1,u=!1,d=function(){null==r||r.unsubscribe(),r=void 0},h=function(){d(),t=o=void 0,c=u=!1},p=function(){var e=t;h(),null==e||e.unsubscribe()};return jr((function(e,f){a++,!u&&!c&&d();var m=o=o??n();f.add((function(){0===--a&&!u&&!c&&(r=sI(p,l))})),m.subscribe(f),!t&&a>0&&(t=new iy({next:function(e){return m.next(e)},error:function(e){u=!0,d(),r=sI(h,i,e),m.error(e)},complete:function(){c=!0,d(),r=sI(h,s),m.complete()}}),Sr(e).subscribe(t))}))(e)}}function sI(e,t){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];if(!0!==t){if(!1!==t){var i=new iy({next:function(){i.unsubscribe(),e()}});return Sr(t.apply(void 0,Qs([],Zs(n)))).subscribe(i)}}else e()}function V5e(e,t,n){var r,i,o,s,a=!1;return e&&"object"==typeof e?(r=e.bufferSize,s=void 0===r?1/0:r,i=e.windowTime,t=void 0===i?1/0:i,a=void 0!==(o=e.refCount)&&o,n=e.scheduler):s=e??1/0,B5e({connector:function(){return new GAe(s,t,n)},resetOnError:!0,resetOnComplete:!1,resetOnRefCountZero:a})}function q5e(e){return Fo((function(t,n){return e<=n}))}function un(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=Gy(e);return jr((function(t,r){(n?nE(e,t,n):nE(e,t)).subscribe(r)}))}function Pt(e,t){return jr((function(n,r){var i=null,o=0,s=!1,a=function(){return s&&!i&&r.complete()};n.subscribe(Qn(r,(function(n){null==i||i.unsubscribe();var s=0,l=o++;Sr(e(n,l)).subscribe(i=Qn(r,(function(e){return r.next(t?t(n,e,l,s++):e)}),(function(){i=null,a()})))}),(function(){s=!0,a()})))}))}function K5e(){return Pt(Ou)}function G5e(e,t){return jr((function(n,r){var i=t;return Pt((function(t,n){return e(i,t,n)}),(function(e,t){return i=t,t}))(n).subscribe(r),function(){i=null}}))}function W5e(e){return jr((function(t,n){Sr(e).subscribe(Qn(n,(function(){return n.complete()}),eE)),!n.closed&&t.subscribe(n)}))}function z5e(e,t,n){var r=Wt(e)||t||n?{next:e,error:t,complete:n}:e;return r?jr((function(e,t){var n;null===(n=r.subscribe)||void 0===n||n.call(r);var i=!0;e.subscribe(Qn(t,(function(e){var n;null===(n=r.next)||void 0===n||n.call(r,e),t.next(e)}),(function(){var e;i=!1,null===(e=r.complete)||void 0===e||e.call(r),t.complete()}),(function(e){var n;i=!1,null===(n=r.error)||void 0===n||n.call(r,e),t.error(e)}),(function(){var e,t;i&&(null===(e=r.unsubscribe)||void 0===e||e.call(r)),null===(t=r.finalize)||void 0===t||t.call(r)})))})):Ou}function tP(e,t){return jr((function(n,r){var i=t??{},o=i.leading,s=void 0===o||o,a=i.trailing,l=void 0!==a&&a,c=!1,u=null,d=null,h=!1,p=function(){null==d||d.unsubscribe(),d=null,l&&(v(),h&&r.complete())},f=function(){d=null,h&&r.complete()},m=function(t){return d=Sr(e(t)).subscribe(Qn(r,p,f))},v=function(){if(c){c=!1;var e=u;u=null,r.next(e),!h&&m(e)}};n.subscribe(Qn(r,(function(e){c=!0,u=e,(!d||d.closed)&&(s?v():m(e))}),(function(){h=!0,(!(l&&c&&d)||d.closed)&&r.complete()})))}))}function Y5e(e,t,n){void 0===t&&(t=Aw);var r=Kc(e,t);return tP((function(){return r}),n)}function J5e(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=y4(e);return jr((function(t,r){for(var i=e.length,o=new Array(i),s=e.map((function(){return!1})),a=!1,l=function(t){Sr(e[t]).subscribe(Qn(r,(function(e){o[t]=e,!a&&!s[t]&&(s[t]=!0,(a=s.every(Ou))&&(s=null))}),eE))},c=0;c<i;c++)l(c);t.subscribe(Qn(r,(function(e){if(a){var t=Qs([e],Zs(o));r.next(n?n.apply(void 0,Qs([],Zs(t))):t)}})))}))}function X5e(e,t,n){if(!n)return _.useState(t)[0];const[r]=_.useState((()=>new ns(n))),[i]=_.useState((()=>t(r))),o=_.useRef(!0);return e((()=>{o.current?o.current=!1:r.next(n)}),n),i}function oy(e,t){return X5e(_.useEffect,e,t)}var Z5e=()=>new Or,Q5e=e=>e+1|0,eNe=()=>{const e=_.useState(0)[1];return _.useRef((()=>e(Q5e))).current},VZ=typeof window>"u"?_.useEffect:_.useLayoutEffect,Kj=e=>{var t;return null!=(t=e[1])&&t.next?e[1]:{next:e[1],error:e[2],complete:e[3]}};function tNe(e,t){const n=_.useRef(t),r=_.useRef(),i=_.useRef();return VZ((()=>{n.current=t,r.current=Kj(t)})),e((()=>{const e=n.current[0];r.current||(r.current=Kj(n.current));const t=e.subscribe({next:t=>{var i,o;e===n.current[0]&&(null==(o=(i=r.current).next)||o.call(i,t))},error:t=>{e===n.current[0]&&(r.current.error?r.current.error(t):console.error(t))},complete:()=>{var t,i;e===n.current[0]&&(null==(i=(t=r.current).complete)||i.call(t))}});return i.current=t,()=>{t.unsubscribe()}}),[t[0]]),i}function nNe(e,t,n,r){return tNe(_.useEffect,[e,t,n,r])}function rNe(e,t,n){if(d5e(t)){const r=t,[i,o]=_.useState((()=>r instanceof ns||void 0!==r.value?r.value:n));return e(r,o),_.useDebugValue(i),i}{const r=t,[i,o]=_.useState(n),[s]=_.useState(Z5e),[a]=_.useState((()=>r(s,i))),l=_.useRef((e=>s.next(e))).current;return e(a,o),_.useDebugValue(i),[i,l]}}function ay(e,t){return rNe(nNe,e,t)}function tt(e){const t=eNe(),n=_.useRef(e),r=_.useRef(),i=_.useRef(!1),o=_.useRef(!1),[s,a]=_.useState((()=>{let t;return e.subscribe({next:e=>{o.current=!0,t=e},error:e=>{r.current=e}}).unsubscribe(),t}));if(VZ((()=>{n.current=e})),_.useEffect((()=>{r.current=null;const e=n.current;let o=s;const l=e.subscribe({next:t=>{e===n.current&&(i.current?a((()=>t)):o=t)},error:i=>{e===n.current&&(r.current=i,t())}});return i.current||o!==s&&a((()=>o)),i.current=!0,()=>{l.unsubscribe()}}),[e]),r.current)throw r.current;if(o.current)return _.useDebugValue(s),s;throw new Error("Observable did not synchronously emit a value.")}function iNe(e){const[t]=_.useState((()=>new ns(e))),[n]=_.useState((()=>({get current(){return t.value},set current(e){t.next(e)}})));return[n,t]}class fi{constructor(e,t){this.defaultValue=t,this.setValue=e=>{this._value$.next(e),localStorage.setItem(this.key,JSON.stringify(e))},this.key=`matrix-setting-${e}`;const n=localStorage.getItem(this.key);let r=t;if(null!==n)try{r=JSON.parse(n)}catch(t){A.warn(`Invalid value stored for setting ${e}: ${n}.`,t)}this._value$=new ns(r),this.value$=this._value$}}function qn(e){return[tt(e.value$),e.setValue]}const qZ=new fi("opt-in-analytics",null),Nw=()=>{const e=qn(qZ);return Et.instance.isEnabled()?e:[!1,null]},S4=new fi("developer-settings-tab",!1),KZ=new fi("duplicate-tiles",0),GZ=new fi("show-non-member-tiles",!1),E4=new fi("debug-tile-layout",!1),ly=new fi("show-connection-stats",!1),sNe=new fi("audio-input",void 0),oNe=new fi("audio-output",void 0),aNe=new fi("video-input",void 0),WZ=new fi("hand-raised-show-timer",!1),zZ=new fi("reactions-show",!0),w4=new fi("reactions-play-sound",!0),YZ=new fi("sound-effect-volume",.5),JZ=new fi("new-membership-manager",!0),C4=new fi("experimental-to-device-transport",!0),Gj=new fi("always-show-self",!0);var Dw=(e=>(e[e.Guest=0]="Guest",e[e.Registered=1]="Registered",e))(Dw||{});const ua=class e{constructor(e){let t,n;this.posthog=e,this.enabled=!1,this.anonymity=0,this.platformSuperProperties={},this.registrationType=0,this.optInListener=null,this.sanitizeProperties=(e,t)=>(1==this.anonymity&&(e.$referrer=null,e.$referring_domain=null,e.$initial_referrer=null,e.$initial_referring_domain=null,e.$device_id=null),e.$current_url=e.$current_url.split("/").slice(0,3).join(""),e),this.eventCallEnded=new TAe,this.eventSignup=new IAe,this.eventCallStarted=new RAe,this.eventLogin=new kAe,this.eventMuteMicrophone=new xAe,this.eventMuteCamera=new PAe,this.eventUndecryptableToDevice=new LAe,this.eventQualitySurvey=new OAe,this.eventCallDisconnected=new MAe,this.eventCallConnectDuration=new AAe,t=Jr().posthogApiKey??void 0,n=Jr().posthogApiHost??void 0,t&&n?(this.posthog.init(t,{api_host:n,autocapture:!1,mask_all_text:!0,mask_all_element_attributes:!0,capture_pageview:!1,sanitize_properties:this.sanitizeProperties,respect_dnt:!0,advanced_disable_decide:!0}),this.enabled=!0):(A.info("Posthog is not enabled because there is no api key or no host given in the config"),this.enabled=!1)}static hasInstance(){return!!this.internalInstance}static get instance(){return this.internalInstance||(this.internalInstance=new e(rAe)),this.internalInstance}static resetInstance(){this.internalInstance=null}registerSuperProperties(e){this.enabled&&this.posthog.register(e)}static getPlatformProperties(){var e,t;return{appVersion:"embedded-v0.10.0",matrixBackend:Ge?"embedded":"jssdk",callBackend:"livekit",cryptoVersion:Ge||null==(t=null==(e=window.matrixclient)?void 0:e.getCrypto())?void 0:t.getVersion()}}capture(e,t,n){this.enabled&&this.posthog.capture(e,{...t},n)}isEnabled(){return this.enabled}setAnonymity(e){this.enabled&&(0==e||1==e)&&(this.posthog.reset(),this.updateSuperProperties()),this.anonymity=e}static getRandomAnalyticsId(){return[...crypto.getRandomValues(new Uint8Array(16))].map((e=>e.toString(16))).join("")}async identifyUser(e){if(2==this.anonymity&&this.enabled){let t=await this.getAnalyticsId();try{if(!t&&!Ge){const n=e();await this.setAccountAnalyticsId(n),t=await this.hashedEcAnalyticsId(n)}}catch(e){A.log("Unable to identify user for tracking"+(null==e?void 0:e.toString()))}t?this.posthog.identify(t):A.info("No analyticsID is available. Should not try to setup posthog")}}async getAnalyticsId(){const t=window.matrixclient;let n;if(Ge)n=Jr().posthogUserId;else{const r=await t.getAccountDataFromServer(e.ANALYTICS_EVENT_TYPE);n=(null==r?void 0:r.id)??null}return n?await this.hashedEcAnalyticsId(n):null}async hashedEcAnalyticsId(e){const t="ec"+e+window.matrixclient.getUserId(),n=await crypto.subtle.digest("sha-256",(new TextEncoder).encode(t)),r=new Int32Array(n);return Array.from(r).map((e=>Math.abs(e).toString(16).padStart(2,"0"))).join("")}async setAccountAnalyticsId(t){if(!Ge){const n=window.matrixclient,r=await n.getAccountDataFromServer(e.ANALYTICS_EVENT_TYPE);await n.setAccountData(e.ANALYTICS_EVENT_TYPE,Object.assign({id:t},r))}}getAnonymity(){return this.anonymity}logout(){var e;this.enabled&&this.posthog.reset(),null==(e=this.optInListener)||e.unsubscribe(),this.optInListener=null,this.setAnonymity(0)}onLoginStatusChanged(){this.maybeIdentifyUser().catch((()=>A.log("Could not identify user on login status change")))}updateSuperProperties(){this.platformSuperProperties=e.getPlatformProperties(),this.registerSuperProperties({...this.platformSuperProperties,registrationType:0==this.registrationType?"Guest":"Registered"})}userRegisteredInThisSession(){return this.eventSignup.getSignupEndTime()>new Date(0)}async maybeIdentifyUser(){window.matrixclient&&(2===this.anonymity&&(this.setRegistrationType(window.matrixclient.isGuest()||window.passwordlessUser?0:1),this.identificationPromise=this.identifyUser(e.getRandomAnalyticsId),await this.identificationPromise,this.userRegisteredInThisSession()&&this.eventSignup.track()),0!==this.anonymity&&this.updateSuperProperties())}trackEvent({eventName:e,...t},n){const r=()=>{0==this.anonymity||1==this.anonymity||this.capture(e,t,n)};this.identificationPromise?this.identificationPromise.then(r,(e=>{A.error("Failed to identify user for tracking",e)})):r()}startListeningToSettingsChanges(){this.optInListener??(this.optInListener=qZ.value$.subscribe((e=>{this.setAnonymity(e?2:0),this.maybeIdentifyUser().catch((()=>A.log("Could not identify user")))})))}setRegistrationType(e){this.registrationType=e,0!=this.anonymity&&1!=this.anonymity&&this.updateSuperProperties()}};ua.ANALYTICS_EVENT_TYPE="im.vector.analytics",ua.internalInstance=null;let Et=ua;const lNe=12e4;class cNe{async forceFlush(){}onStart(e){try{switch(e.name){case"matrix.groupCallMembership":return void this.onGroupCallMembershipStart(e);case"matrix.groupCallMembership.summaryReport":return void this.onSummaryReportStart(e)}}catch(e){A.debug(e)}}onEnd(e){"matrix.groupCallMembership"!==e.name||this.onGroupCallMembershipEnd(e)}get prevCall(){const e=localStorage.getItem("matrix-prev-call");if(null===e)return null;try{return JSON.parse(e)}catch(t){return A.warn("Invalid prev call data",e,"error:",t),null}}set prevCall(e){localStorage.setItem("matrix-prev-call",JSON.stringify(e))}onGroupCallMembershipStart(e){const t=this.prevCall,n=e.attributes["matrix.confId"];if(null!==t&&n===t.callId){const n=TD(e.startTime)-t.hangupTs;n<=lNe&&Et.instance.trackEvent({eventName:"Rejoin",callId:t.callId,rejoinDuration:n})}}onGroupCallMembershipEnd(e){this.prevCall={callId:e.attributes["matrix.confId"],hangupTs:TD(e.endTime)}}onSummaryReportStart(e){const t=e.events.find((e=>"matrix.stats.summary"===e.name));if(void 0!==t){const n=t.attributes;if(n){const t=`${n["matrix.stats.summary.percentageReceivedMedia"]}`,r=`${n["matrix.stats.summary.percentageReceivedVideoMedia"]}`,i=`${n["matrix.stats.summary.percentageReceivedAudioMedia"]}`,o=`${n["matrix.stats.summary.maxJitter"]}`,s=`${n["matrix.stats.summary.maxPacketLoss"]}`,a=`${n["matrix.stats.summary.peerConnections"]}`,l=`${n["matrix.stats.summary.percentageConcealedAudio"]}`,c=`${n["matrix.stats.summary.opponentUsersInCall"]}`,u=`${n["matrix.stats.summary.opponentDevicesInCall"]}`,d=`${n["matrix.stats.summary.diffDevicesToPeerConnections"]}`,h=`${n["matrix.stats.summary.ratioPeerConnectionToDevices"]}`;Et.instance.trackEvent({eventName:"MediaReceived",callId:e.attributes["matrix.confId"],mediaReceived:t,audioReceived:i,videoReceived:r,maxJitter:o,maxPacketLoss:s,peerConnections:a,percentageConcealedAudio:l,opponentUsersInCall:c,opponentDevicesInCall:u,diffDevicesToPeerConnections:d,ratioPeerConnectionToDevices:h},{send_instantly:!0})}}}async shutdown(){return Promise.resolve()}}const Wj=e=>Object.entries(e).map((([e,t])=>({key:e,type:typeof t,value:t})));class uNe{constructor(){this.spans=[]}async forceFlush(){}onStart(e){this.spans.push(e)}onEnd(){}dump(){const e=1e3*Date.now(),t=new Map;for(const e of this.spans){const n=e.spanContext().traceId;let r=t.get(n);void 0===r&&(r=[],t.set(n,r)),r.push(e)}const n="p1",r={[n]:{serviceName:"element-call",tags:[]},warnings:null};return JSON.stringify({total:0,limit:0,offset:0,errors:null,data:[...t.entries()].map((([t,n])=>({traceID:t,warnings:null,processes:r,spans:n.map((n=>{const r=n.spanContext(),i=BR(n.startTime),o=-1===n.duration[0]?e-i:BR(n.duration);return{traceID:t,spanID:r.spanId,operationName:n.name,processID:"p1",warnings:null,startTime:i,duration:o,references:void 0===n.parentSpanId?[]:[{refType:"CHILD_OF",traceID:t,spanID:n.parentSpanId}],tags:Wj(n.attributes),logs:n.events.map((e=>({timestamp:BR(e.time),fields:[...Wj(e.attributes??{}),{key:"event",type:"string",value:e.name}]})))}}))})))})}async shutdown(){}}const dNe="element-call";let rd;class jw{static globalInit(){(!rd||!1!==rd.isOtlpEnabled)&&(A.info("(Re)starting OpenTelemetry debug reporting"),null==rd||rd.dispose(),rd=new jw(void 0,XZ()))}static get instance(){return rd}constructor(e,t){const n={resource:new Cx({[ROe.SERVICE_NAME]:dNe})};this._provider=new X6e(n),e?(A.info("Enabling OTLP collector with URL "+e),this.otlpExporter=new G6e({url:e}),this._provider.addSpanProcessor(new $Le(this.otlpExporter))):A.info("OTLP collector disabled"),t&&(this.rageshakeProcessor=new uNe,this._provider.addSpanProcessor(this.rageshakeProcessor)),this._provider.addSpanProcessor(new cNe),FR.trace.setGlobalTracerProvider(this._provider),this._tracer=FR.trace.getTracer("my-element-call-otl-tracer")}dispose(){var e;FR.trace.disable(),null==(e=this._provider)||e.shutdown().catch((e=>{A.error("Failed to shutdown OpenTelemetry",e)}))}get isOtlpEnabled(){return!!this.otlpExporter}get tracer(){return this._tracer}get provider(){return this._provider}}const zj=async e=>{const{gzip:t}=await Cv((async()=>{const{gzip:e}=await import("./pako.esm-Bt8vjcgE.js");return{gzip:e}}),[],import.meta.url),n=(new TextEncoder).encode(e);return new Blob([t(n)])};async function fNe(e,t){t.append("crypto_version",e.getVersion());const n=await e.getOwnDeviceKeys(),r=[`curve25519:${n.curve25519}`,`ed25519:${n.ed25519}`];t.append("device_keys",r.join(", "));const i=await e.getCrossSigningStatus();t.append("cross_signing_ready",String(await e.isCrossSigningReady())),t.append("cross_signing_key",await e.getCrossSigningKeyId()??"n/a"),t.append("cross_signing_privkey_in_secret_storage",String(i.privateKeysInSecretStorage)),t.append("cross_signing_master_privkey_cached",String(i.privateKeysCachedLocally.masterKey)),t.append("cross_signing_self_signing_privkey_cached",String(i.privateKeysCachedLocally.selfSigningKey)),t.append("cross_signing_user_signing_privkey_cached",String(i.privateKeysCachedLocally.userSigningKey))}async function hNe(e,t,n){const r=e.secretStorage;n.append("secret_storage_ready",String(await t.isSecretStorageReady())),n.append("secret_storage_key_in_account",String(await r.hasKey())),n.append("session_backup_key_in_secret_storage",String(!!await e.isKeyBackupKeyStored()));const i=await t.getSessionBackupPrivateKey();n.append("session_backup_key_cached",String(!!i)),n.append("session_backup_key_well_formed",String(i instanceof Uint8Array))}function XZ(){return Jr().rageshakeSubmitUrl??void 0}function Uw(e=XZ){const{client:t}=cf(),[{sending:n,sent:r,error:i},o]=_.useState({sending:!1,sent:!1,error:void 0});return{submitRageshake:_.useCallback((async r=>{const i=e();if(!i)throw new Error("No rageshake URL is configured");if(!n)try{o({sending:!0,sent:!1,error:void 0});let e="UNKNOWN";window.navigator&&window.navigator.userAgent&&(e=window.navigator.userAgent);let n="UNKNOWN";try{n=String(window.matchMedia("(pointer: coarse)").matches)}catch(e){A.warn("Could not get coarse pointer for rageshake submit.",e)}let s=r.rageshakeRequestId?`Rageshake ${r.rageshakeRequestId}`:"";r.description&&(s+=`: ${r.description}`);const a=new FormData;if(a.append("text",s??"User did not supply any additional text."),a.append("app","matrix-video-chat"),a.append("version","embedded-v0.10.0"),a.append("user_agent",e),a.append("installed_pwa","false"),a.append("touch_input",n),a.append("call_backend","livekit"),a.append("hostname",window.location.hostname),t){const e=t.getUserId(),n=t.getUser(e);a.append("display_name",(null==n?void 0:n.displayName)??""),a.append("user_id",t.credentials.userId??""),a.append("device_id",t.deviceId??""),r.roomId&&a.append("room_id",r.roomId);const i=t.getCrypto();i&&(await fNe(i,a),await hNe(t,i,a))}if(r.label&&a.append("label",r.label),navigator.storage&&navigator.storage.persisted)try{a.append("storageManager_persisted",String(await navigator.storage.persisted()))}catch(e){A.warn("coulr not get navigator peristed storage",e)}else if(document.hasStorageAccess)try{a.append("storageManager_persisted",String(await document.hasStorageAccess()))}catch(e){A.warn("could not get storage access",e)}if(navigator.storage&&navigator.storage.estimate)try{const e=await navigator.storage.estimate();a.append("storageManager_quota",String(e.quota)),a.append("storageManager_usage",String(e.usage)),e.usageDetails&&Object.keys(e.usageDetails).forEach((t=>{a.append(`storageManager_usage_${t}`,String(e.usageDetails[t]))}))}catch(e){A.warn("could not obatain storage estimate",e)}if(r.sendLogs){const e=await A3e();for(const t of e)a.append("compressed-log",await zj(t.lines),t.id);a.append("file",await zj(jw.instance.rageshakeProcessor.dump()),"traces.json.gz")}r.rageshakeRequestId&&a.append("group_call_rageshake_request_id",r.rageshakeRequestId);const l=await fetch(i,{method:"POST",body:a});if(200!==l.status)throw new Error(`Failed to submit feedback: receive HTTP ${l.status} ${l.statusText}`);o({sending:!1,sent:!0,error:void 0})}catch(e){o({sending:!1,sent:!1,error:e}),A.error(e)}}),[t,n,e]),sending:n,sent:r,error:i,available:!!e()}}function pNe(){const{client:e}=cf();return _.useCallback(((t,n)=>{e.sendEvent(t,"org.matrix.rageshake_request",{request_id:n}).catch((e=>{A.error("Failed to send org.matrix.rageshake_request event",e)}))}),[e])}function mNe(e){const[t,n]=_.useState(!1),r=_.useCallback((()=>n(!1)),[n]),{client:i}=cf(),[o,s]=_.useState();return _.useEffect((()=>{if(!i)return;const t=t=>{"org.matrix.rageshake_request"===t.getType()&&e===t.getRoomId()&&i.getUserId()!==t.getSender()&&(s(t.getContent().request_id),n(!0))};return i.on(Oe.Event,t),()=>{i.removeListener(Oe.Event,t)}}),[n,e,i]),{rageshakeRequestId:o??"",roomId:e,open:t,onDismiss:r}}const gNe=({description:e})=>{var t;const{submitRageshake:n,sending:r,sent:i,error:o}=Uw(),{t:s}=ze(),a=_.useCallback((()=>{n({description:e,sendLogs:!0}).catch((e=>{A.error("Failed to send rageshake",e)}))}),[n,e]);if(null==(t=Bt.get().rageshake)||!t.submit_url)return null;let l=null;if(r)l=E.jsx("span",{children:s("rageshake_sending")});else if(i)l=E.jsx("div",{children:s("rageshake_sent")});else{let e=s("rageshake_send_logs");o&&(e=s("rageshake_button_error_caption")),l=E.jsx(At,{onClick:a,className:bD.wideButton,disabled:r,children:e})}return E.jsx("div",{className:bD.rageshakeControl,children:l})},vNe="_error_19mk1_1",yNe="_icon_19mk1_9",p_={error:vNe,icon:yNe},_Ne="_endCall_bwclo_8",bNe={endCall:_Ne},ZZ=({muted:e,...t})=>{const{t:n}=ze(),r=e?cJ:q6,i=n(e?"unmute_microphone_button_label":"mute_microphone_button_label");return E.jsx(ui,{label:i,children:E.jsx(At,{iconOnly:!0,Icon:r,kind:e?"primary":"secondary",...t})})},QZ=({muted:e,...t})=>{const{t:n}=ze(),r=e?aRe:PJ,i=n(e?"start_video_button_label":"stop_video_button_label");return E.jsx(ui,{label:i,children:E.jsx(At,{iconOnly:!0,Icon:r,kind:e?"primary":"secondary",...t})})},eQ=e=>{const{t}=ze();return E.jsx(ui,{label:t("switch_camera"),children:E.jsx(At,{iconOnly:!0,Icon:iRe,kind:"secondary",...e})})},SNe=({enabled:e,...t})=>{const{t:n}=ze(),r=n(e?"stop_screenshare_button_label":"screenshare_button_label");return E.jsx(ui,{label:r,children:E.jsx(At,{iconOnly:!0,Icon:tRe,kind:e?"primary":"secondary",...t})})},tQ=({className:e,...t})=>{const{t:n}=ze();return E.jsx(ui,{label:n("hangup_button_label"),children:E.jsx(At,{className:Ae(e,bNe.endCall),iconOnly:!0,Icon:eJ,destructive:!0,...t})})},nQ=e=>{const{t}=ze();return E.jsx(ui,{label:t("common.settings"),children:E.jsx(At,{iconOnly:!0,Icon:eRe,kind:"secondary",...e})})},ENe="_external_jhjdf_8",wNe={external:ENe};function rQ(e,t){return[lq(e),yq(e,{state:t})]}const Ia=_.forwardRef((function({to:e,state:t,...n},r){const[i,o]=rQ(e,t);return E.jsx(MCe,{ref:r,...n,href:i,onClick:o})})),Pd=_.forwardRef((function({className:e,children:t,...n},r){return E.jsx("a",{ref:r,className:Ae(e,wNe.external),target:"_blank",rel:"noreferrer noopener",...n,children:t})})),T4=_.forwardRef((function({to:e,state:t,...n},r){const[i,o]=rQ(e,t);return E.jsx(At,{as:"a",ref:r,...n,href:i,onClick:o})}));function iQ(e){const[t,n]=_.useState(e.memberships),r=_.useCallback((()=>{A.info(`Memberships changed for call in room ${e.room.roomId} (${e.memberships.length} members)`),n(e.memberships)}),[e]);return _.useEffect((()=>(e.on(ar.MembershipsChanged,r),()=>{e.off(ar.MembershipsChanged,r)})),[e,r]),t}const sQ=_.createContext(void 0),R4=()=>{const e=_.useContext(sQ);if(!e)throw new Error("useReactions must be used within a ReactionsProvider");return e},CNe=({children:e,rtcSession:t,vm:n})=>{const r=iQ(t),i=nm(),o="valid"===(null==i?void 0:i.state)&&i.supportedFeatures.reactions,s=t.room,a=s.client.getUserId(),l=s.client.getDeviceId(),c=`${a}:${l}`,u=_.useMemo((()=>{var e;return null==(e=r.find((e=>e.sender===a&&e.deviceId===l)))?void 0:e.eventId}),[r,a,l]),d=tt(n.reactions$),h=_.useMemo((()=>void 0!==c?d[c]:void 0),[c,d]),p=tt(n.handsRaised$),f=_.useMemo((()=>void 0!==c?p[c]:void 0),[c,p]),m=_.useCallback((async()=>{if(!c)return;const e=null==f?void 0:f.reactionEventId;if(e)try{await s.client.redactEvent(t.room.roomId,e),A.debug("Redacted raise hand event")}catch(t){throw A.error("Failed to redact reaction event",e,t),t}else try{if(!u)throw new Error("Cannot find own membership event");const e=await s.client.sendEvent(t.room.roomId,ee.Reaction,{"m.relates_to":{rel_type:cn.Annotation,event_id:u,key:"🖐️"}});A.debug("Sent raise hand event",e.event_id)}catch(e){A.error("Failed to send raised hand",e)}}),[u,c,f,t,s]),v=_.useCallback((async e=>{if(c&&!h){if(!u)throw new Error("Cannot find own membership event");await s.client.sendEvent(t.room.roomId,h4,{"m.relates_to":{rel_type:cn.Reference,event_id:u},emoji:e.emoji,name:e.name})}}),[u,h,s,c,t]);return E.jsx(sQ.Provider,{value:{supportsReactions:o,toggleRaisedHand:m,sendReaction:v},children:e})},TNe="_raisedButton_unw54_1",RNe="_reactionPopupMenu_unw54_5",INe="_reactionPopupMenuRoot_unw54_21",kNe="_reactionPopupMenuModal_unw54_21",xNe="_reactionsMenuSection_unw54_47",PNe="_reactionsMenu_unw54_47",LNe="_reactionButton_unw54_81",ONe="_verticalSeperator_unw54_91",MNe="_alert_unw54_99",wo={raisedButton:TNe,reactionPopupMenu:RNe,reactionPopupMenuRoot:INe,reactionPopupMenuModal:kNe,reactionsMenuSection:xNe,reactionsMenu:PNe,reactionButton:LNe,verticalSeperator:ONe,alert:MNe};var oQ=_.forwardRef(((e,t)=>{const{children:n,...r}=e,i=_.Children.toArray(n),o=i.find(NNe);if(o){const e=o.props.children,n=i.map((t=>t===o?_.Children.count(e)>1?_.Children.only(null):_.isValidElement(e)?e.props.children:null:t));return E.jsx(nP,{...r,ref:t,children:_.isValidElement(e)?_.cloneElement(e,void 0,n):null})}return E.jsx(nP,{...r,ref:t,children:n})}));oQ.displayName="Slot";var nP=_.forwardRef(((e,t)=>{const{children:n,...r}=e;if(_.isValidElement(n)){const e=jNe(n),i=DNe(r,n.props);return n.type!==_.Fragment&&(i.ref=t?Ua(t,e):e),_.cloneElement(n,i)}return _.Children.count(n)>1?_.Children.only(null):null}));nP.displayName="SlotClone";var ANe=({children:e})=>E.jsx(E.Fragment,{children:e});function NNe(e){return _.isValidElement(e)&&e.type===ANe}function DNe(e,t){const n={...t};for(const r in t){const i=e[r],o=t[r];/^on[A-Z]/.test(r)?i&&o?n[r]=(...e)=>{o(...e),i(...e)}:i&&(n[r]=i):"style"===r?n[r]={...i,...o}:"className"===r&&(n[r]=[i,o].filter(Boolean).join(" "))}return{...e,...n}}function jNe(e){var t,n;let r=null==(t=Object.getOwnPropertyDescriptor(e.props,"ref"))?void 0:t.get,i=r&&"isReactWarning"in r&&r.isReactWarning;return i?e.ref:(r=null==(n=Object.getOwnPropertyDescriptor(e,"ref"))?void 0:n.get,i=r&&"isReactWarning"in r&&r.isReactWarning,i?e.props.ref:e.props.ref||e.ref)}var UNe=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","span","svg","ul"],FNe=UNe.reduce(((e,t)=>{const n=_.forwardRef(((e,n)=>{const{asChild:r,...i}=e,o=r?oQ:t;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),E.jsx(o,{...i,ref:n})}));return n.displayName=`Primitive.${t}`,{...e,[t]:n}}),{}),$Ne="VisuallyHidden",rP=_.forwardRef(((e,t)=>E.jsx(FNe.span,{...e,ref:t,style:{position:"absolute",border:0,width:1,height:1,padding:0,margin:-1,overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",wordWrap:"normal",...e.style}})));rP.displayName=$Ne;const HNe="_modal_lmgdq_8",BNe="_dialog_lmgdq_14",VNe="_content_lmgdq_21",qNe="_drawer_lmgdq_32",KNe="_close_lmgdq_59",GNe="_header_lmgdq_84",WNe="_body_lmgdq_114",zNe="_tabbed_lmgdq_129",YNe="_handle_lmgdq_133",ji={modal:HNe,dialog:BNe,content:VNe,drawer:qNe,close:KNe,header:GNe,body:WNe,tabbed:zNe,handle:YNe},JNe="_bg_197ap_8",XNe="_animate_197ap_23",ZNe="_overlay_197ap_40",ga={bg:JNe,animate:XNe,overlay:ZNe},lf=({title:e,hideHeader:t,children:n,className:r,classNameDrawer:i,classNameModal:o,open:s,onDismiss:a,tabbed:l,...c})=>{const{t:u}=ze(),d=ww("(hover: none) or (pointer: coarse)"),h=_.useCallback((e=>{e||null==a||a()}),[a]);if(d)return E.jsx(Ki.Root,{open:s,onOpenChange:h,dismissible:void 0!==a,children:E.jsxs(Ki.Portal,{children:[E.jsx(Ki.Overlay,{className:Ae(ga.bg)}),E.jsx(Ki.Content,{className:Ae(r,i,ga.overlay,ji.modal,ji.drawer,{[ji.tabbed]:l}),role:"dialog","aria-describedby":void 0,...c,children:E.jsxs("div",{className:ji.content,children:[E.jsxs("div",{className:ji.header,children:[E.jsx("div",{className:ji.handle}),E.jsx(rP,{asChild:!0,children:E.jsx(Ki.Title,{children:e})})]}),E.jsx("div",{className:ji.body,children:n})]})})]})});{const i=E.jsx(k6,{asChild:!0,children:E.jsx(xu,{as:"h2",weight:"semibold",size:"md",children:e})}),d=E.jsxs("div",{className:ji.header,children:[i,void 0!==a&&E.jsx(Qz,{className:ji.close,"data-testid":"modal_close","aria-label":u("action.close"),children:E.jsx(lw,{width:20,height:20})})]});return E.jsx(C6,{open:s,onOpenChange:h,children:E.jsxs(T6,{children:[E.jsx(R6,{className:Ae(ga.bg,ga.animate)}),E.jsx(I6,{asChild:!0,"aria-describedby":void 0,role:"dialog",...c,children:E.jsx(dY,{className:Ae(r,o,ga.overlay,ga.animate,ji.modal,ji.dialog,{[ji.tabbed]:l}),children:E.jsxs("div",{className:ji.content,children:[t?null:d,t?E.jsx(rP,{asChild:!0,children:i}):null,E.jsx("div",{className:ji.body,children:n})]})})})]})})}},QNe=({raised:e,open:t,...n})=>{const{t:r}=ze();return E.jsx(ui,{label:r("common.reactions"),children:E.jsx(At,{className:Ae(e&&wo.raisedButton),"aria-expanded":t,"aria-haspopup":!0,kind:e||t?"primary":"secondary",iconOnly:!0,Icon:e?vJ:Q2e,...n})})};function e8e({sendReaction:e,toggleRaisedHand:t,isHandRaised:n,canReact:r,errorText:i}){const{t:o}=ze(),[s,a]=_.useState(!1),l=_.useMemo((()=>s?ry:ry.slice(0,5)),[s]),c=o(n?"action.lower_hand":"action.raise_hand");return E.jsxs(E.Fragment,{children:[i&&E.jsx(Z_e,{className:wo.alert,type:"critical",title:o("error.generic"),children:i}),E.jsxs("div",{className:wo.reactionPopupMenu,children:[E.jsx("section",{className:wo.handRaiseSection,children:E.jsx(ui,{label:c,caption:"H",children:E.jsx(At,{kind:n?"primary":"secondary","aria-keyshortcuts":"H","aria-pressed":n,"aria-label":c,onClick:()=>t(),iconOnly:!0,Icon:vJ})})}),E.jsx("div",{className:wo.verticalSeperator}),E.jsx("section",{className:wo.reactionsMenuSection,children:E.jsx("menu",{className:Ae(s&&wo.reactionsMenuExpanded,wo.reactionsMenu),children:l.map(((t,n)=>E.jsx("li",{children:E.jsx(ui,{label:t.name,caption:n<5?(n+1).toString():void 0,children:E.jsx(At,{kind:"secondary",className:wo.reactionButton,disabled:!r,onClick:()=>e(t),"aria-keyshortcuts":n<5?(n+1).toString():void 0,children:t.emoji})})},t.name)))})}),E.jsx("section",{style:{marginLeft:"var(--cpd-separator-spacing)"},children:E.jsx(ui,{label:o(s?"action.show_less":"action.show_more"),children:E.jsx(At,{iconOnly:!0,"aria-label":o(s?"action.show_less":"action.show_more"),Icon:s?B2e:h2e,kind:"tertiary",onClick:()=>a(!s)})})})]})]})}function t8e({identifier:e,vm:t,...n}){const{t:r}=ze(),{toggleRaisedHand:i,sendReaction:o}=R4(),[s,a]=_.useState(!1),[l,c]=_.useState(!1),[u,d]=_.useState(),h=ay(t.handsRaised$.pipe(Ne((t=>!!t[e])))),p=ay(t.reactions$.pipe(Ne((t=>!t[e]))));_.useEffect((()=>{d(void 0)}),[l]);const f=_.useCallback((async e=>{try{a(!0),await o(e),d(void 0),c(!1)}catch(e){d(e instanceof Error?e.message:"Unknown error"),A.error("Failed to send reaction",e)}finally{a(!1)}}),[o]),m=_.useCallback((()=>{(async()=>{try{a(!0),await i(),c(!1)}catch(e){d(e instanceof Error?e.message:"Unknown error"),A.error("Failed to raise/lower hand",e)}finally{a(!1)}})()}),[i]);return E.jsxs(E.Fragment,{children:[E.jsx(QNe,{disabled:s,onClick:()=>c((e=>!e)),raised:!!h,open:l,...n}),E.jsx(lf,{open:l,title:r("action.pick_reaction"),hideHeader:!0,classNameModal:wo.reactionPopupMenuModal,className:wo.reactionPopupMenuRoot,onDismiss:()=>c(!1),children:E.jsx(e8e,{errorText:u,isHandRaised:!!h,canReact:!s&&!!p,sendReaction:e=>{f(e)},toggleRaisedHand:m})})]})}const cy=({Icon:e,title:t,rageshake:n,fatal:r,children:i,widget:o})=>{const{t:s}=ze(),{confineToRoom:a}=Lu(),l=_.useCallback((()=>{window.location.href="/"}),[]);return E.jsxs("div",{className:p_.error,children:[E.jsx(a2e,{className:p_.icon,children:E.jsx(e,{})}),E.jsx(xu,{as:"h1",weight:"semibold",size:"md",children:t}),i,n&&E.jsx(gNe,{description:`***Error View***: ${t}`}),o?E.jsx((({widget:e})=>E.jsx(At,{kind:"primary",onClick:()=>{e.api.transport.send(Ar.Close,{}).catch((e=>{A.error("Failed to send close action",e)})).finally((()=>{e.api.transport.stop()}))},children:s("action.close")})),{widget:o}):!a&&E.jsx((()=>r||"/"===location.pathname?E.jsx(At,{kind:"tertiary",className:p_.homeLink,onClick:l,children:s("return_home_button")}):E.jsx(T4,{kind:"tertiary",className:p_.homeLink,to:"/",children:s("return_home_button")})),{})]})};class aQ extends Error{constructor(e,t){super(e),this.richMessage=t}}const n8e=()=>{const{t:e}=ze();return E.jsx(cy,{widget:Ge,Icon:mJ,title:e("error.open_elsewhere"),children:E.jsx("p",{children:e("error.open_elsewhere_description",{brand:"Element Call"})})})};class r8e extends aQ{constructor(){super("App opened in another tab",E.jsx(n8e,{}))}}const Qh=({className:e,children:t})=>{const{hideHeader:n}=Lu();return E.jsxs("div",{className:Ae(LR.page,e),children:[!n&&E.jsxs(Pu,{children:[E.jsx(sf,{children:E.jsx(Vd,{})}),E.jsx(of,{})]}),E.jsx("div",{className:LR.container,children:E.jsx("div",{className:LR.content,children:t})})]})},uy=({error:e,widget:t})=>{const{t:n}=ze();return _.useEffect((()=>{A.error(e),rw(e)}),[e]),E.jsx(Qh,{children:e instanceof aQ?e.richMessage:E.jsx(cy,{widget:t,Icon:aw,title:n("error.generic"),rageshake:!0,fatal:!0,children:E.jsx("p",{children:n("error.generic_description")})})})},Fw=()=>{const{t:e}=ze();return E.jsx(Qh,{children:E.jsx("h1",{children:e("common.loading")})})},I4=_.createContext(void 0);I4.Provider;const nm=()=>_.useContext(I4);function cf(){var e;let t,n;const r=nm();return"valid"===(null==r?void 0:r.state)&&(t=null==(e=r.authenticated)?void 0:e.client,n=r.setClient),{client:t,setClient:n}}function k4(){var e,t,n;const r=nm();let i,o,s,a,l=!1,c=!0,u=!1;return"valid"===(null==r?void 0:r.state)?(i=null==(e=r.authenticated)?void 0:e.client,o=r.setClient,l=(null==(t=r.authenticated)?void 0:t.isPasswordlessUser)??!1,c=!1,u=void 0!==i,a=null==(n=r.authenticated)?void 0:n.logout):"error"===(null==r?void 0:r.state)&&(s=r.error,c=!1),{client:i,setClient:o,passwordlessUser:l,loading:c,authenticated:u,logout:a,error:s}}const m_="BroadcastChannel"in window?new BroadcastChannel("load"):null,i8e=({children:e})=>{const t=Aa(),[n,r]=_.useState(void 0),i=_.useRef(!1);_.useEffect((()=>{i.current||(i.current=!0,s8e().then((e=>{r(e),Et.instance.isEnabled()&&Et.instance.startListeningToSettingsChanges()})).catch((e=>A.error(e))).finally((()=>i.current=!1)))}),[]);const o=_.useCallback((async e=>{const t=cQ();null==n||!n.client||!t||(await n.client.setPassword({type:"m.login.password",identifier:{type:"m.id.user",user:t.user_id},user:t.user_id,password:t.tempPassword},e),Yj({...t,passwordlessUser:!1}),r({...n,passwordlessUser:!1}))}),[n]),s=_.useCallback(((e,t)=>{const i=null==n?void 0:n.client;i&&i!==e&&i.stopClient(),Yj(t),r({widgetApi:null,client:e,passwordlessUser:t.passwordlessUser}),Et.instance.isEnabled()&&Et.instance.startListeningToSettingsChanges()}),[null==n?void 0:n.client]),a=_.useCallback((async()=>{const e=null==n?void 0:n.client;e&&(await e.logout(!0),await e.clearStores(),lQ(),r(null),await t("/"),Et.instance.logout(),Et.instance.setRegistrationType(Dw.Guest))}),[t,null==n?void 0:n.client]);_.useEffect((()=>{Ge||null==m_||m_.postMessage({})}),[]);const[l,c]=_.useState(void 0);ov(m_,"message",_.useCallback((()=>{null==n||n.client.stopClient(),c(new r8e)}),[null==n?void 0:n.client,c]));const[u,d]=_.useState(!1),[h,p]=_.useState(!1),[f,m]=_.useState(!1),v=_.useMemo((()=>l?{state:"error",error:l}:void 0===n?void 0:{state:"valid",authenticated:null===n?void 0:{client:n.client,isPasswordlessUser:n.passwordlessUser,changePassword:o,logout:a},setClient:s,disconnected:u,supportedFeatures:{reactions:h,thumbnails:f}}),[l,o,n,a,s,u,h,f]),g=_.useCallback(((e,t,n)=>{d(o8e(e,n))}),[]);return _.useEffect((()=>{if(n){if(window.matrixclient=n.client,window.passwordlessUser=n.passwordlessUser,Et.hasInstance()&&Et.instance.onLoginStatusChanged(),n.client&&n.client.on(Oe.Sync,g),n.widgetApi){m(!1);const e=n.widgetApi.hasCapability("org.matrix.msc2762.send.event:m.reaction"),t=n.widgetApi.hasCapability("org.matrix.msc2762.send.event:m.room.redaction"),r=n.widgetApi.hasCapability("org.matrix.msc2762.receive.event:m.reaction"),i=n.widgetApi.hasCapability("org.matrix.msc2762.receive.event:m.room.redaction");e&&r&&t&&i?p(!0):(A.warn("Widget does not support reactions"),p(!1))}else p(!0),m(!0);return()=>{n.client&&n.client.removeListener(Oe.Sync,g)}}}),[n,g]),l?E.jsx(uy,{widget:Ge,error:l}):E.jsx(I4.Provider,{value:v,children:e})};async function s8e(){if(Ge){A.log("Using a matryoshka client");const e=await Ge.client;return{widgetApi:Ge.api,client:e,passwordlessUser:!1}}{const{initSPA:e}=await Cv((async()=>{const{initSPA:e}=await import("./spa-DVTankup.js");return{initSPA:e}}),[],import.meta.url);return e(cQ,lQ)}}const lQ=()=>localStorage.removeItem("matrix-auth-store"),Yj=e=>localStorage.setItem("matrix-auth-store",JSON.stringify(e)),cQ=()=>{const e=localStorage.getItem("matrix-auth-store");if(e)return JSON.parse(e)},o8e=(e,t)=>{var n;return"ERROR"===e&&"ConnectionError"===(null==(n=null==t?void 0:t.error)?void 0:n.name)};function Yy(e){const[{success:t,loading:n,displayName:r,avatarUrl:i,error:o},s]=_.useState((()=>{let t;return e&&(t=e.getUser(e.getUserId())??void 0),{success:!1,loading:!1,displayName:null==t?void 0:t.rawDisplayName,avatarUrl:null==t?void 0:t.avatarUrl,error:void 0}}));_.useEffect((()=>{const t=(e,{displayName:t,avatarUrl:n})=>{s({success:!1,loading:!1,displayName:t,avatarUrl:n,error:void 0})};let n;if(e){const r=e.getUserId();n=e.getUser(r),null==n||n.on(Kr.DisplayName,t),null==n||n.on(Kr.AvatarUrl,t)}return()=>{n&&(n.removeListener(Kr.DisplayName,t),n.removeListener(Kr.AvatarUrl,t))}}),[e]);return{loading:n,error:o,displayName:r,avatarUrl:i,saveProfile:_.useCallback((async({displayName:t,avatar:n,removeAvatar:r})=>{if(e){s((e=>({...e,loading:!0,error:void 0,success:!1})));try{let i;await e.setDisplayName(t),r?await e.setAvatarUrl(""):n&&(({content_uri:i}=await e.uploadContent(n)),await e.setAvatarUrl(i)),s((e=>({...e,displayName:t,avatarUrl:r?void 0:i??e.avatarUrl,loading:!1,success:!0})))}catch(e){s((t=>({...t,loading:!1,error:e instanceof Error?e:Error(e),success:!1})))}}else A.error("Client not initialized before calling saveProfile")}),[e]),success:t}}const a8e="_settingsModal_1dkeq_8",l8e="_volumeSlider_1dkeq_20",Jj={settingsModal:a8e,volumeSlider:l8e},c8e="_tabContainer_1nnp9_8",u8e="_tabList_1nnp9_14",Xj={tabContainer:c8e,tabList:u8e};function d8e({label:e,tab:t,onTabChange:n,tabs:r}){const i=_.useId();return E.jsxs("div",{className:Xj.tabContainer,children:[E.jsx(l2e,{role:"tablist","aria-label":e,className:Xj.tabList,children:r.map((({key:e,name:r})=>E.jsx(f2e,{"aria-controls":`${i}[${e}]`,onClick:()=>n(e),active:e===t,children:r})))}),r.map((({key:e,content:n})=>E.jsx("div",{id:`${i}[${e}]`,style:{display:e===t?void 0:"none"},children:n})))]})}const f8e="_fieldRow_iwncy_8",h8e="_field_iwncy_8",p8e="_rightAlign_iwncy_21",m8e="_inputField_iwncy_33",g8e="_disabled_iwncy_52",v8e="_prefix_iwncy_110",y8e="_checkboxField_iwncy_131",_8e="_checkbox_iwncy_131",b8e="_description_iwncy_168",S8e="_errorMessage_iwncy_197",E8e="_noLabel_iwncy_210",As={fieldRow:f8e,field:h8e,rightAlign:p8e,inputField:m8e,disabled:g8e,prefix:v8e,checkboxField:y8e,checkbox:_8e,description:b8e,errorMessage:S8e,noLabel:E8e},w8e=(e,t)=>_.createElement("svg",{fill:"none",height:24,stroke:"#000",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,viewBox:"0 0 24 24",width:24,xmlns:"http://www.w3.org/2000/svg",ref:t,...e},_.createElement("path",{d:"m20 6-11 11-5-5"})),C8e=_.forwardRef(w8e);class uQ extends Error{constructor(e,t){super(t(e,{lng:"en"})),this.translatedMessage=t(e)}}class T8e extends uQ{}const Zj=(e,t)=>new T8e(e,t);function vt({children:e,rightAlign:t,className:n}){return E.jsx("div",{className:Ae(As.fieldRow,{[As.rightAlign]:t},n),children:e})}function R8e({children:e,className:t}){return E.jsx("div",{className:Ae(As.field,t),children:e})}const _n=_.forwardRef((({id:e,label:t,className:n,type:r,checked:i,prefix:o,suffix:s,description:a,disabled:l,min:c,...u},d)=>{const h=_.useId();return E.jsxs(R8e,{className:Ae("checkbox"===r?As.checkboxField:As.inputField,{[As.prefix]:!!o,[As.disabled]:l},n),children:[o&&E.jsx("span",{children:o}),"textarea"===r?E.jsx("textarea",{id:e,ref:d,disabled:l,"aria-describedby":h,...u}):E.jsx("input",{id:e,ref:d,type:r,checked:i,disabled:l,"aria-describedby":h,min:c,...u}),E.jsxs("label",{htmlFor:e,children:["checkbox"===r&&E.jsx("div",{className:As.checkbox,children:E.jsx(C8e,{})}),t]}),s&&E.jsx("span",{children:s}),a&&E.jsx("p",{id:h,className:t?As.description:Ae(As.description,As.noLabel),children:a})]})}));_n.displayName="InputField";const Mu=({error:e})=>E.jsx("p",{className:As.errorMessage,children:e instanceof uQ?e.translatedMessage:e.message}),I8e="_avatarInputField_1ep5q_8",k8e="_avatar_1ep5q_8",x8e="_fileInput_1ep5q_17",P8e="_edit_1ep5q_21",g_={avatarInputField:I8e,avatar:k8e,fileInput:x8e,edit:P8e},dQ=({id:e,label:t,className:n,avatarUrl:r,userId:i,displayName:o,onRemoveAvatar:s,...a})=>{const{t:l}=ze(),[c,u]=_.useState(!1),[d,h]=_.useState(void 0),[p,f]=_.useState(!1),m=_.useRef(null);_.useEffect((()=>{const e=m.current,t=e=>{const t=e;t.target.files&&t.target.files.length>0?(h(URL.createObjectURL(t.target.files[0])),u(!1)):h(void 0)};return e.addEventListener("change",t),()=>{null==e||e.removeEventListener("change",t)}}));const v=_.useCallback((()=>{m.current.click()}),[m]),g=_.useCallback((()=>{u(!0),s()}),[s]);return E.jsxs("div",{className:Ae(g_.avatarInputField,n),children:[E.jsx(Zp,{id:i,className:g_.avatar,name:o,size:Xp.XL,src:c?void 0:d||r}),E.jsx("input",{id:e,accept:"image/*",ref:m,type:"file",className:g_.fileInput,role:"button","aria-label":t,...a}),E.jsx("div",{className:g_.edit,children:!r&&!d||c?E.jsx(At,{type:"button",iconOnly:!0,Icon:sD,kind:"tertiary",size:"sm","aria-label":l("action.edit"),onClick:v}):E.jsxs(A6,{title:l("action.edit"),showTitle:!1,open:p,onOpenChange:f,trigger:E.jsx(At,{iconOnly:!0,Icon:sD,kind:"tertiary",size:"sm","aria-label":l("action.edit")}),children:[E.jsx(Sp,{Icon:nRe,label:l("action.upload_file"),onSelect:v}),E.jsx(Sp,{Icon:q2e,label:l("action.remove"),kind:"critical",onSelect:g})]})})]})};dQ.displayName="AvatarInputField";const L8e="_content_gj715_8",O8e="_avatarFieldRow_gj715_15",Qj={content:L8e,avatarFieldRow:O8e},M8e=({client:e})=>{const{t}=ze(),{error:n,displayName:r,avatarUrl:i,saveProfile:o}=Yy(e),s=_.useMemo((()=>e.getUserId()),[e]),a=_.useRef(null),l=_.useRef(!1),c=_.useCallback((()=>{l.current=!0}),[]),u=_.useRef(!1),d=_.useCallback((()=>{u.current=!0,l.current=!0}),[]);return _.useEffect((()=>{const e=a.current;return()=>{if(l.current){const t=new FormData(e),n=t.get("displayName"),r=t.get("avatar"),i="string"==typeof r?r.length:(null==r?void 0:r.size)??0,s="string"==typeof n?n:(null==n?void 0:n.name)??null;if(!s)return;o({displayName:s,avatar:r&&i>0?r:void 0,removeAvatar:u.current&&(!r||0===i)}).catch((e=>{A.error("Failed to save profile",e)}))}}}),[o]),E.jsxs("form",{onChange:c,ref:a,className:Qj.content,children:[E.jsx(vt,{className:Qj.avatarFieldRow,children:s&&r&&E.jsx(dQ,{id:"avatar",name:"avatar",label:t("common.avatar"),avatarUrl:i,userId:s,displayName:r,onRemoveAvatar:d})}),E.jsx(vt,{children:E.jsx(_n,{id:"userId",name:"userId",label:t("common.username"),type:"text",disabled:!0,value:e.getUserId()})}),E.jsx(vt,{children:E.jsx(_n,{id:"displayName",name:"displayName",label:t("common.display_name"),type:"text",required:!0,autoComplete:"off",placeholder:t("common.display_name"),defaultValue:r,"data-testid":"profile_displayname"})}),n&&E.jsx(vt,{children:E.jsx(Mu,{error:n})})]})},A8e="_feedback_19yh9_8",fQ={feedback:A8e},hQ=()=>E.jsxs(Zi,{i18nKey:"analytics_notice",children:["By participating in this beta, you consent to the collection of anonymous data, which we use to improve the product. You can find more information about which data we track in our"," ",E.jsx(Pd,{href:"https://element.io/privacy",children:"Privacy Policy"})," ","and our"," ",E.jsx(Pd,{href:"https://element.io/cookie-policy",children:"Cookie Policy"}),"."]}),N8e=({roomId:e})=>{const{t}=ze(),{submitRageshake:n,sending:r,sent:i,error:o,available:s}=Uw(),a=pNe(),l=_.useCallback((t=>{t.preventDefault();const r=new FormData(t.target),i=r.get("description"),o="string"==typeof i?i:"",s=!!r.get("sendLogs"),l=_s(16);n({description:o,sendLogs:s,rageshakeRequestId:l,roomId:e}).catch((e=>{A.error("Failed to send feedback rageshake",e)})),e&&s&&a(e,l)}),[n,e,a]);Nw();const c=s?E.jsxs(E.Fragment,{children:[E.jsx("h4",{children:t("settings.feedback_tab_h4")}),E.jsx(Jt,{children:t("settings.feedback_tab_body")}),E.jsxs("form",{onSubmit:l,children:[E.jsx(vt,{children:E.jsx(_n,{className:fQ.feedback,id:"description",name:"description",label:t("settings.feedback_tab_description_label"),placeholder:t("settings.feedback_tab_description_label"),type:"textarea",disabled:r||i})}),!i&&E.jsxs(vt,{children:[E.jsx(_n,{id:"sendLogs",name:"sendLogs",label:t("settings.feedback_tab_send_logs_label"),type:"checkbox",defaultChecked:!0}),E.jsx(At,{type:"submit",disabled:r,children:t(r?"submitting":"action.submit")})]}),E.jsxs(vt,{children:[o&&E.jsx(Mu,{error:o}),i&&E.jsx(Jt,{children:t("settings.feedback_tab_thank_you")})]})]})]}):null;return E.jsxs("div",{children:[null,c]})};var eU,Ob={exports:{}},D8e=Ob.exports;function j8e(){return eU||(eU=1,t=D8e,n=function(){var e=function(){},t="undefined",n=typeof window!==t&&typeof window.navigator!==t&&/Trident\/|MSIE /.test(window.navigator.userAgent),r=["trace","debug","info","warn","error"],i={},o=null;function s(e,t){var n=e[t];if("function"==typeof n.bind)return n.bind(e);try{return Function.prototype.bind.call(n,e)}catch{return function(){return Function.prototype.apply.apply(n,[e,arguments])}}}function a(){console.log&&(console.log.apply?console.log.apply(console,arguments):Function.prototype.apply.apply(console.log,[console,arguments])),console.trace&&console.trace()}function l(){for(var n=this.getLevel(),i=0;i<r.length;i++){var o=r[i];this[o]=i<n?e:this.methodFactory(o,n,this.name)}if(this.log=this.debug,typeof console===t&&n<this.levels.SILENT)return"No console available for logging"}function c(e){return function(){typeof console!==t&&(l.call(this),this[e].apply(this,arguments))}}function u(r,i,o){return function(r){return"debug"===r&&(r="log"),typeof console!==t&&("trace"===r&&n?a:void 0!==console[r]?s(console,r):void 0!==console.log?s(console,"log"):e)}(r)||c.apply(this,arguments)}function d(e,n){var s,a,c,d=this,h="loglevel";function p(){var e;if(typeof window!==t&&h){try{e=window.localStorage[h]}catch{}if(typeof e===t)try{var n=window.document.cookie,r=encodeURIComponent(h),i=n.indexOf(r+"=");-1!==i&&(e=/^([^;]+)/.exec(n.slice(i+r.length+1))[1])}catch{}return void 0===d.levels[e]&&(e=void 0),e}}function f(e){var t=e;if("string"==typeof t&&void 0!==d.levels[t.toUpperCase()]&&(t=d.levels[t.toUpperCase()]),"number"==typeof t&&t>=0&&t<=d.levels.SILENT)return t;throw new TypeError("log.setLevel() called with invalid level: "+e)}"string"==typeof e?h+=":"+e:"symbol"==typeof e&&(h=void 0),d.name=e,d.levels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5},d.methodFactory=n||u,d.getLevel=function(){return c??a??s},d.setLevel=function(e,n){return c=f(e),!1!==n&&function(e){var n=(r[e]||"silent").toUpperCase();if(typeof window!==t&&h){try{return void(window.localStorage[h]=n)}catch{}try{window.document.cookie=encodeURIComponent(h)+"="+n+";"}catch{}}}(c),l.call(d)},d.setDefaultLevel=function(e){a=f(e),p()||d.setLevel(e,!1)},d.resetLevel=function(){c=null,function(){if(typeof window!==t&&h){try{window.localStorage.removeItem(h)}catch{}try{window.document.cookie=encodeURIComponent(h)+"=; expires=Thu, 01 Jan 1970 00:00:00 UTC"}catch{}}}(),l.call(d)},d.enableAll=function(e){d.setLevel(d.levels.TRACE,e)},d.disableAll=function(e){d.setLevel(d.levels.SILENT,e)},d.rebuild=function(){if(o!==d&&(s=f(o.getLevel())),l.call(d),o===d)for(var e in i)i[e].rebuild()},s=f(o?o.getLevel():"WARN");var m=p();null!=m&&(c=f(m)),l.call(d)}(o=new d).getLogger=function(e){if("symbol"!=typeof e&&"string"!=typeof e||""===e)throw new TypeError("You must supply a name when creating a logger.");var t=i[e];return t||(t=i[e]=new d(e,o.methodFactory)),t};var h=typeof window!==t?window.log:void 0;return o.noConflict=function(){return typeof window!==t&&window.log===o&&(window.log=h),o},o.getLoggers=function(){return i},o.default=o,o},(e=Ob).exports?e.exports=n():t.log=n()),Ob.exports;var e,t,n}var U8e=j8e();const F8e=Ko(U8e);var $8e=(e,t,n)=>new Promise(((r,i)=>{var o=e=>{try{a(n.next(e))}catch(e){i(e)}},s=e=>{try{a(n.throw(e))}catch(e){i(e)}},a=e=>e.done?r(e.value):Promise.resolve(e.value).then(o,s);a((n=n.apply(e,t)).next())})),H8e=[le.ConnectionStateChanged,le.RoomMetadataChanged,le.ActiveSpeakersChanged,le.ConnectionQualityChanged,le.ParticipantConnected,le.ParticipantDisconnected,le.ParticipantPermissionsChanged,le.ParticipantMetadataChanged,le.ParticipantNameChanged,le.ParticipantAttributesChanged,le.TrackMuted,le.TrackUnmuted,le.TrackPublished,le.TrackUnpublished,le.TrackStreamStateChanged,le.TrackSubscriptionFailed,le.TrackSubscriptionPermissionChanged,le.TrackSubscriptionStatusChanged],B8e=[...H8e,le.LocalTrackPublished,le.LocalTrackUnpublished];oe.TrackPublished,oe.TrackUnpublished,oe.TrackMuted,oe.TrackUnmuted,oe.TrackStreamStateChanged,oe.TrackSubscribed,oe.TrackUnsubscribed,oe.TrackSubscriptionPermissionChanged,oe.TrackSubscriptionFailed,oe.LocalTrackPublished,oe.LocalTrackUnpublished;var V8e=[oe.ConnectionQualityChanged,oe.IsSpeakingChanged,oe.ParticipantMetadataChanged,oe.ParticipantPermissionsChanged,oe.TrackMuted,oe.TrackUnmuted,oe.TrackPublished,oe.TrackUnpublished,oe.TrackStreamStateChanged,oe.TrackSubscriptionFailed,oe.TrackSubscriptionPermissionChanged,oe.TrackSubscriptionStatusChanged];oe.LocalTrackPublished,oe.LocalTrackUnpublished;var q8e=F8e.getLogger("lk-components-js");function K8e(e,...t){return new Dn((n=>{const r=()=>{n.next(e)};return t.forEach((t=>{e.on(t,r)})),()=>{t.forEach((t=>{e.off(t,r)}))}})).pipe(un(e))}function G8e(e,t){return new Dn((n=>{const r=(...e)=>{n.next(e)};return e.on(t,r),()=>{e.off(t,r)}}))}function W8e(e,t,n=!0){var r;const i=()=>$8e(this,null,(function*(){try{const t=yield Al.getLocalDevices(e,n);o.next(t)}catch(e){null==t||t(e)}})),o=new Or,s=o.pipe(BZ((()=>{var e;null==(e=null==navigator?void 0:navigator.mediaDevices)||e.removeEventListener("devicechange",i)})));if(typeof window<"u"){if(!window.isSecureContext)throw new Error("Accessing media devices is available only in secure contexts (HTTPS and localhost), in some or all supporting browsers. See: https://developer.mozilla.org/en-US/docs/Web/API/Navigator/mediaDevices");null==(r=null==navigator?void 0:navigator.mediaDevices)||r.addEventListener("devicechange",i)}return nE(Al.getLocalDevices(e,n).catch((e=>(null==t||t(e),[]))),s)}function x4(e,...t){return new Dn((n=>{const r=()=>{n.next(e)};return t.forEach((t=>{e.on(t,r)})),()=>{t.forEach((t=>{e.off(t,r)}))}})).pipe(un(e))}function P4(e){return x4(e,oe.TrackMuted,oe.TrackUnmuted,oe.ParticipantPermissionsChanged,oe.TrackPublished,oe.TrackUnpublished,oe.LocalTrackPublished,oe.LocalTrackUnpublished,oe.MediaDevicesError,oe.TrackSubscriptionStatusChanged).pipe(Ne((e=>{const{isMicrophoneEnabled:t,isCameraEnabled:n,isScreenShareEnabled:r}=e,i=e.getTrackPublication(ue.Source.Microphone);return{isCameraEnabled:n,isMicrophoneEnabled:t,isScreenShareEnabled:r,cameraTrack:e.getTrackPublication(ue.Source.Camera),microphoneTrack:i,participant:e}})))}function z8e(e,t={}){var n;let r;const i=new Dn((e=>(r=e,()=>s.unsubscribe()))).pipe(un(Array.from(e.remoteParticipants.values()))),o=null!=(n=t.additionalRoomEvents)?n:B8e,s=K8e(e,...Array.from(new Set([le.ParticipantConnected,le.ParticipantDisconnected,le.ConnectionStateChanged,...o]))).subscribe((e=>null==r?void 0:r.next(Array.from(e.remoteParticipants.values()))));return e.remoteParticipants.size>0&&(null==r||r.next(Array.from(e.remoteParticipants.values()))),i}function oI(e,t,n){const r=_.useRef(!1),i=n||r.current;r.current||(r.current=n);const o=_.useMemo((()=>W8e(e,(()=>A.error("Error creating MediaDeviceObserver")),i).pipe(un([]))),[e,i]),s=tt(_.useMemo((()=>o.pipe(Ne((t=>{var n;let r=new Map(t.map(((e,t)=>[e.deviceId,e.label?{type:"name",name:e.label}:{type:"number",number:t+1}])));return"audiooutput"===e&&r.size&&!r.has("")&&!r.has("default")&&(r=new Map([["",{type:"default",name:(null==(n=t[0])?void 0:n.label)||null}],...r])),r})))),[e,o])),[a,l]=qn(t),c=_.useMemo((()=>{if(s.size)return void 0!==a&&s.has(a)||1===s.size&&s.has("")?a:s.keys().next().value}),[s,a]),u=tt(_.useMemo((()=>o.pipe(Ne((e=>{var t;return null==(t=e.find((e=>e.deviceId===c)))?void 0:t.groupId})))),[o,c]));return _.useMemo((()=>({available:s,selectedId:c,selectedGroupId:u,select:l})),[s,c,u,l])}q8e.setDefaultLevel("WARN"),new TextEncoder,new TextDecoder;const aI={available:new Map,selectedId:void 0,selectedGroupId:void 0,select:()=>{}},Y8e={audioInput:aI,audioOutput:aI,videoInput:aI,startUsingDeviceNames:()=>{},stopUsingDeviceNames:()=>{}},pQ=_.createContext(Y8e),J8e=({children:e})=>{const[t,n]=_.useState(0),r=t>0,i=oI("audioinput",sNe,r),o=oI("audiooutput",oNe,r),s=oI("videoinput",aNe,r),a=_.useCallback((()=>n((e=>e+1))),[n]),l=_.useCallback((()=>n((e=>e-1))),[n]),c=_.useMemo((()=>({audioInput:i,audioOutput:o,videoInput:s,startUsingDeviceNames:a,stopUsingDeviceNames:l})),[i,o,s,a,l]);return E.jsx(pQ.Provider,{value:c,children:e})},uf=()=>_.useContext(pQ),X8e=(e,t=!0)=>_.useEffect((()=>{if(t)return e.startUsingDeviceNames(),e.stopUsingDeviceNames}),[e,t]),Z8e=()=>{const{t:e}=ze(),[t,n]=qn(WZ),[r,i]=qn(zZ),[o,s]=qn(w4),a=(e,t)=>{t(e.target.checked)},[l,c]=qn(S4);return E.jsxs("div",{children:[E.jsx(Jt,{children:e("settings.preferences_tab.introduction")}),E.jsx(vt,{children:E.jsx(_n,{id:"showHandRaisedTimer",label:e("settings.preferences_tab.show_hand_raised_timer_label"),description:e("settings.preferences_tab.show_hand_raised_timer_description"),type:"checkbox",checked:t,onChange:e=>a(e,n)})}),E.jsx(vt,{children:E.jsx(_n,{id:"showReactions",label:e("settings.preferences_tab.reactions_show_label"),description:e("settings.preferences_tab.reactions_show_description"),type:"checkbox",checked:r,onChange:e=>a(e,i)})}),E.jsx(vt,{children:E.jsx(_n,{id:"playReactionSound",label:e("settings.preferences_tab.reactions_play_sound_label"),description:e("settings.preferences_tab.reactions_play_sound_description"),type:"checkbox",checked:o,onChange:e=>a(e,s)})}),E.jsx(vt,{children:E.jsx(_n,{id:"developerSettingsTab",type:"checkbox",checked:l,label:e("settings.preferences_tab.developer_mode_label"),description:e("settings.preferences_tab.developer_mode_label_description"),onChange:e=>c(e.target.checked)})})]})};function mQ(e,[t,n]){return Math.min(n,Math.max(t,e))}function Q8e(e){const t=_.useRef({value:e,previous:e});return _.useMemo((()=>(t.current.value!==e&&(t.current.previous=t.current.value,t.current.value=e),t.current.previous)),[e])}var rE=_.forwardRef(((e,t)=>{const{children:n,...r}=e,i=_.Children.toArray(n),o=i.find(t9e);if(o){const e=o.props.children,n=i.map((t=>t===o?_.Children.count(e)>1?_.Children.only(null):_.isValidElement(e)?e.props.children:null:t));return E.jsx(iP,{...r,ref:t,children:_.isValidElement(e)?_.cloneElement(e,void 0,n):null})}return E.jsx(iP,{...r,ref:t,children:n})}));rE.displayName="Slot";var iP=_.forwardRef(((e,t)=>{const{children:n,...r}=e;if(_.isValidElement(n)){const e=r9e(n),i=n9e(r,n.props);return n.type!==_.Fragment&&(i.ref=t?Ua(t,e):e),_.cloneElement(n,i)}return _.Children.count(n)>1?_.Children.only(null):null}));iP.displayName="SlotClone";var e9e=({children:e})=>E.jsx(E.Fragment,{children:e});function t9e(e){return _.isValidElement(e)&&e.type===e9e}function n9e(e,t){const n={...t};for(const r in t){const i=e[r],o=t[r];/^on[A-Z]/.test(r)?i&&o?n[r]=(...e)=>{o(...e),i(...e)}:i&&(n[r]=i):"style"===r?n[r]={...i,...o}:"className"===r&&(n[r]=[i,o].filter(Boolean).join(" "))}return{...e,...n}}function r9e(e){var t,n;let r=null==(t=Object.getOwnPropertyDescriptor(e.props,"ref"))?void 0:t.get,i=r&&"isReactWarning"in r&&r.isReactWarning;return i?e.ref:(r=null==(n=Object.getOwnPropertyDescriptor(e,"ref"))?void 0:n.get,i=r&&"isReactWarning"in r&&r.isReactWarning,i?e.props.ref:e.props.ref||e.ref)}var i9e=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","span","svg","ul"],$w=i9e.reduce(((e,t)=>{const n=_.forwardRef(((e,n)=>{const{asChild:r,...i}=e,o=r?rE:t;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),E.jsx(o,{...i,ref:n})}));return n.displayName=`Primitive.${t}`,{...e,[t]:n}}),{});function s9e(e){const t=e+"CollectionProvider",[n,r]=ja(t),[i,o]=n(t,{collectionRef:{current:null},itemMap:new Map}),s=e=>{const{scope:t,children:n}=e,r=we.useRef(null),o=we.useRef(new Map).current;return E.jsx(i,{scope:t,itemMap:o,collectionRef:r,children:n})};s.displayName=t;const a=e+"CollectionSlot",l=we.forwardRef(((e,t)=>{const{scope:n,children:r}=e,i=tn(t,o(a,n).collectionRef);return E.jsx(rE,{ref:i,children:r})}));l.displayName=a;const c=e+"CollectionItemSlot",u="data-radix-collection-item",d=we.forwardRef(((e,t)=>{const{scope:n,children:r,...i}=e,s=we.useRef(null),a=tn(t,s),l=o(c,n);return we.useEffect((()=>(l.itemMap.set(s,{ref:s,...i}),()=>{l.itemMap.delete(s)}))),E.jsx(rE,{[u]:"",ref:a,children:r})}));return d.displayName=c,[{Provider:s,Slot:l,ItemSlot:d},function(t){const n=o(e+"CollectionConsumer",t);return we.useCallback((()=>{const e=n.collectionRef.current;if(!e)return[];const t=Array.from(e.querySelectorAll(`[${u}]`));return Array.from(n.itemMap.values()).sort(((e,n)=>t.indexOf(e.ref.current)-t.indexOf(n.ref.current)))}),[n.collectionRef,n.itemMap])},r]}var gQ=["PageUp","PageDown"],vQ=["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"],yQ={"from-left":["Home","PageDown","ArrowDown","ArrowLeft"],"from-right":["Home","PageDown","ArrowDown","ArrowRight"],"from-bottom":["Home","PageDown","ArrowDown","ArrowLeft"],"from-top":["Home","PageDown","ArrowUp","ArrowLeft"]},rm="Slider",[sP,o9e,a9e]=s9e(rm),[_Q,hGe]=ja(rm,[a9e]),[l9e,Hw]=_Q(rm),bQ=_.forwardRef(((e,t)=>{const{name:n,min:r=0,max:i=100,step:o=1,orientation:s="horizontal",disabled:a=!1,minStepsBetweenThumbs:l=0,defaultValue:c=[r],value:u,onValueChange:d=()=>{},onValueCommit:h=()=>{},inverted:p=!1,form:f,...m}=e,v=_.useRef(new Set),g=_.useRef(0),y="horizontal"===s?c9e:u9e,[b=[],w]=hw({prop:u,defaultProp:c,onChange:e=>{var t;null==(t=[...v.current][g.current])||t.focus(),d(e)}}),S=_.useRef(b);function C(e,t,{commit:n}={commit:!1}){const s=_9e(o),a=mQ(b9e(Math.round((e-r)/o)*o+r,s),[r,i]);w(((e=[])=>{const r=h9e(e,a,t);if(y9e(r,l*o)){g.current=r.indexOf(a);const t=String(r)!==String(e);return t&&n&&h(r),t?r:e}return e}))}return E.jsx(l9e,{scope:e.__scopeSlider,name:n,disabled:a,min:r,max:i,valueIndexToChangeRef:g,thumbs:v.current,values:b,orientation:s,form:f,children:E.jsx(sP.Provider,{scope:e.__scopeSlider,children:E.jsx(sP.Slot,{scope:e.__scopeSlider,children:E.jsx(y,{"aria-disabled":a,"data-disabled":a?"":void 0,...m,ref:t,onPointerDown:We(m.onPointerDown,(()=>{a||(S.current=b)})),min:r,max:i,inverted:p,onSlideStart:a?void 0:function(e){C(e,m9e(b,e))},onSlideMove:a?void 0:function(e){C(e,g.current)},onSlideEnd:a?void 0:function(){const e=S.current[g.current];b[g.current]!==e&&h(b)},onHomeKeyDown:()=>!a&&C(r,0,{commit:!0}),onEndKeyDown:()=>!a&&C(i,b.length-1,{commit:!0}),onStepKeyDown:({event:e,direction:t})=>{if(!a){const n=gQ.includes(e.key)||e.shiftKey&&vQ.includes(e.key)?10:1,r=g.current;C(b[r]+o*n*t,r,{commit:!0})}}})})})})}));bQ.displayName=rm;var[SQ,EQ]=_Q(rm,{startEdge:"left",endEdge:"right",size:"width",direction:1}),c9e=_.forwardRef(((e,t)=>{const{min:n,max:r,dir:i,inverted:o,onSlideStart:s,onSlideMove:a,onSlideEnd:l,onStepKeyDown:c,...u}=e,[d,h]=_.useState(null),p=tn(t,(e=>h(e))),f=_.useRef(void 0),m=n6(i),v="ltr"===m,g=v&&!o||!v&&o;function y(e){const t=f.current||d.getBoundingClientRect(),i=L4([0,t.width],g?[n,r]:[r,n]);return f.current=t,i(e-t.left)}return E.jsx(SQ,{scope:e.__scopeSlider,startEdge:g?"left":"right",endEdge:g?"right":"left",direction:g?1:-1,size:"width",children:E.jsx(wQ,{dir:m,"data-orientation":"horizontal",...u,ref:p,style:{...u.style,"--radix-slider-thumb-transform":"translateX(-50%)"},onSlideStart:e=>{const t=y(e.clientX);null==s||s(t)},onSlideMove:e=>{const t=y(e.clientX);null==a||a(t)},onSlideEnd:()=>{f.current=void 0,null==l||l()},onStepKeyDown:e=>{const t=yQ[g?"from-left":"from-right"].includes(e.key);null==c||c({event:e,direction:t?-1:1})}})})})),u9e=_.forwardRef(((e,t)=>{const{min:n,max:r,inverted:i,onSlideStart:o,onSlideMove:s,onSlideEnd:a,onStepKeyDown:l,...c}=e,u=_.useRef(null),d=tn(t,u),h=_.useRef(void 0),p=!i;function f(e){const t=h.current||u.current.getBoundingClientRect(),i=L4([0,t.height],p?[r,n]:[n,r]);return h.current=t,i(e-t.top)}return E.jsx(SQ,{scope:e.__scopeSlider,startEdge:p?"bottom":"top",endEdge:p?"top":"bottom",size:"height",direction:p?1:-1,children:E.jsx(wQ,{"data-orientation":"vertical",...c,ref:d,style:{...c.style,"--radix-slider-thumb-transform":"translateY(50%)"},onSlideStart:e=>{const t=f(e.clientY);null==o||o(t)},onSlideMove:e=>{const t=f(e.clientY);null==s||s(t)},onSlideEnd:()=>{h.current=void 0,null==a||a()},onStepKeyDown:e=>{const t=yQ[p?"from-bottom":"from-top"].includes(e.key);null==l||l({event:e,direction:t?-1:1})}})})})),wQ=_.forwardRef(((e,t)=>{const{__scopeSlider:n,onSlideStart:r,onSlideMove:i,onSlideEnd:o,onHomeKeyDown:s,onEndKeyDown:a,onStepKeyDown:l,...c}=e,u=Hw(rm,n);return E.jsx($w.span,{...c,ref:t,onKeyDown:We(e.onKeyDown,(e=>{"Home"===e.key?(s(e),e.preventDefault()):"End"===e.key?(a(e),e.preventDefault()):gQ.concat(vQ).includes(e.key)&&(l(e),e.preventDefault())})),onPointerDown:We(e.onPointerDown,(e=>{const t=e.target;t.setPointerCapture(e.pointerId),e.preventDefault(),u.thumbs.has(t)?t.focus():r(e)})),onPointerMove:We(e.onPointerMove,(e=>{e.target.hasPointerCapture(e.pointerId)&&i(e)})),onPointerUp:We(e.onPointerUp,(e=>{const t=e.target;t.hasPointerCapture(e.pointerId)&&(t.releasePointerCapture(e.pointerId),o(e))}))})})),CQ="SliderTrack",TQ=_.forwardRef(((e,t)=>{const{__scopeSlider:n,...r}=e,i=Hw(CQ,n);return E.jsx($w.span,{"data-disabled":i.disabled?"":void 0,"data-orientation":i.orientation,...r,ref:t})}));TQ.displayName=CQ;var oP="SliderRange",RQ=_.forwardRef(((e,t)=>{const{__scopeSlider:n,...r}=e,i=Hw(oP,n),o=EQ(oP,n),s=tn(t,_.useRef(null)),a=i.values.length,l=i.values.map((e=>kQ(e,i.min,i.max))),c=a>1?Math.min(...l):0,u=100-Math.max(...l);return E.jsx($w.span,{"data-orientation":i.orientation,"data-disabled":i.disabled?"":void 0,...r,ref:s,style:{...e.style,[o.startEdge]:c+"%",[o.endEdge]:u+"%"}})}));RQ.displayName=oP;var aP="SliderThumb",IQ=_.forwardRef(((e,t)=>{const n=o9e(e.__scopeSlider),[r,i]=_.useState(null),o=tn(t,(e=>i(e))),s=_.useMemo((()=>r?n().findIndex((e=>e.ref.current===r)):-1),[n,r]);return E.jsx(d9e,{...e,ref:o,index:s})})),d9e=_.forwardRef(((e,t)=>{const{__scopeSlider:n,index:r,name:i,...o}=e,s=Hw(aP,n),a=EQ(aP,n),[l,c]=_.useState(null),u=tn(t,(e=>c(e))),d=!l||(s.form||!!l.closest("form")),h=$G(l),p=s.values[r],f=void 0===p?0:kQ(p,s.min,s.max),m=p9e(r,s.values.length),v=null==h?void 0:h[a.size],g=v?g9e(v,f,a.direction):0;return _.useEffect((()=>{if(l)return s.thumbs.add(l),()=>{s.thumbs.delete(l)}}),[l,s.thumbs]),E.jsxs("span",{style:{transform:"var(--radix-slider-thumb-transform)",position:"absolute",[a.startEdge]:`calc(${f}% + ${g}px)`},children:[E.jsx(sP.ItemSlot,{scope:e.__scopeSlider,children:E.jsx($w.span,{role:"slider","aria-label":e["aria-label"]||m,"aria-valuemin":s.min,"aria-valuenow":p,"aria-valuemax":s.max,"aria-orientation":s.orientation,"data-orientation":s.orientation,"data-disabled":s.disabled?"":void 0,tabIndex:s.disabled?void 0:0,...o,ref:u,style:void 0===p?{display:"none"}:e.style,onFocus:We(e.onFocus,(()=>{s.valueIndexToChangeRef.current=r}))})}),d&&E.jsx(f9e,{name:i??(s.name?s.name+(s.values.length>1?"[]":""):void 0),form:s.form,value:p},r)]})}));IQ.displayName=aP;var f9e=e=>{const{value:t,...n}=e,r=_.useRef(null),i=Q8e(t);return _.useEffect((()=>{const e=r.current,n=window.HTMLInputElement.prototype,o=Object.getOwnPropertyDescriptor(n,"value").set;if(i!==t&&o){const n=new Event("input",{bubbles:!0});o.call(e,t),e.dispatchEvent(n)}}),[i,t]),E.jsx("input",{style:{display:"none"},...n,ref:r,defaultValue:t})};function h9e(e=[],t,n){const r=[...e];return r[n]=t,r.sort(((e,t)=>e-t))}function kQ(e,t,n){return mQ(100/(n-t)*(e-t),[0,100])}function p9e(e,t){return t>2?`Value ${e+1} of ${t}`:2===t?["Minimum","Maximum"][e]:void 0}function m9e(e,t){if(1===e.length)return 0;const n=e.map((e=>Math.abs(e-t))),r=Math.min(...n);return n.indexOf(r)}function g9e(e,t,n){const r=e/2;return(r-L4([0,50],[0,r])(t)*n)*n}function v9e(e){return e.slice(0,-1).map(((t,n)=>e[n+1]-t))}function y9e(e,t){if(t>0){const n=v9e(e);return Math.min(...n)>=t}return!0}function L4(e,t){return n=>{if(e[0]===e[1]||t[0]===t[1])return t[0];const r=(t[1]-t[0])/(e[1]-e[0]);return t[0]+r*(n-e[0])}}function _9e(e){return(String(e).split(".")[1]||"").length}function b9e(e,t){const n=Math.pow(10,t);return Math.round(e*n)/n}var S9e=bQ,E9e=TQ,w9e=RQ,C9e=IQ;const T9e="_slider_15go1_8",R9e="_track_15go1_14",I9e="_highlight_15go1_31",k9e="_handle_15go1_43",v_={slider:T9e,track:R9e,highlight:I9e,handle:k9e},xQ=({className:e,label:t,value:n,onValueChange:r,onValueCommit:i,min:o,max:s,step:a,disabled:l})=>{const c=_.useCallback((([e])=>r(e)),[r]),u=_.useCallback((([e])=>null==i?void 0:i(e)),[i]);return E.jsxs(S9e,{className:Ae(e,v_.slider),value:[n],onValueChange:c,onValueCommit:u,min:o,max:s,step:a,disabled:l,children:[E.jsx(E9e,{className:v_.track,children:E.jsx(w9e,{className:v_.highlight})}),E.jsx(ui,{placement:"top",label:Math.round(100*n).toString()+"%",children:E.jsx(C9e,{className:v_.handle,"aria-label":t})})]})},x9e="_selection_1akwb_1",P9e="_title_1akwb_5",L9e="_separator_1akwb_10",O9e="_options_1akwb_14",M9e="_secondary_1akwb_20",_g={selection:x9e,title:P9e,separator:L9e,options:O9e,secondary:M9e},lI=({devices:e,title:t,numberedLabel:n})=>{const{t:r}=ze(),i=_.useId(),o=_.useCallback((t=>{e.select(t.target.value)}),[e]);return 0==e.available.size?null:E.jsxs("div",{className:_g.selection,children:[E.jsx(xu,{type:"body",weight:"semibold",size:"sm",as:"h4",className:_g.title,children:t}),E.jsx(OY,{className:_g.separator}),E.jsx("div",{className:_g.options,children:[...e.available].map((([t,s])=>{let a;switch(s.type){case"name":a=s.name;break;case"number":a=n(s.number);break;case"default":a=null===s.name?r("settings.devices.default"):E.jsxs(Zi,{i18nKey:"settings.devices.default_named",name:s.name,children:["Default"," ",E.jsxs("span",{className:_g.secondary,children:["(",{name:s.name},")"]})]})}return E.jsx(KTe,{name:i,control:E.jsx(r2e,{checked:t===e.selectedId,onChange:o,value:t}),children:E.jsx(NTe,{children:a})},t)}))})]})},A9e={},N9e={BASE_URL:"./",DEV:!1,MODE:"production",PROD:!0,SSR:!1,VITE_APP_VERSION:"embedded-v0.10.0",VITE_PACKAGE:"embedded"},D9e=({client:e,livekitRoom:t})=>{var n;const{t:r}=ze(),[i,o]=qn(KZ),[s,a]=qn(E4),[l,c]=qn(GZ),[u,d]=qn(ly),[h,p]=qn(JZ),[f,m]=qn(C4),v=Lu(),g=_.useMemo((()=>{var e;if(null!=(e=null==t?void 0:t.engine.client.ws)&&e.url){const e=new URL(t.engine.client.ws.url);return e.search="",e}return null}),[t]);return E.jsxs(E.Fragment,{children:[E.jsx("p",{children:r("developer_mode.hostname",{hostname:window.location.hostname||"unknown"})}),E.jsx("p",{children:r("version",{productName:"Element Call",version:"embedded-v0.10.0"})}),E.jsx("p",{children:r("developer_mode.crypto_version",{version:(null==(n=e.getCrypto())?void 0:n.getVersion())||"unknown"})}),E.jsx("p",{children:r("developer_mode.matrix_id",{id:e.getUserId()||"unknown"})}),E.jsx("p",{children:r("developer_mode.device_id",{id:e.getDeviceId()||"unknown"})}),E.jsx(vt,{children:E.jsx(_n,{id:"duplicateTiles",type:"number",label:r("developer_mode.duplicate_tiles_label"),value:i.toString(),min:0,onChange:_.useCallback((e=>{const t=e.target.valueAsNumber;t<0||o(Number.isNaN(t)?0:t)}),[o])})}),E.jsx(vt,{children:E.jsx(_n,{id:"debugTileLayout",type:"checkbox",checked:s,label:r("developer_mode.debug_tile_layout_label"),onChange:e=>a(e.target.checked)})}),E.jsx(vt,{children:E.jsx(_n,{id:"showNonMemberTiles",type:"checkbox",label:r("developer_mode.show_non_member_tiles"),checked:!!l,onChange:_.useCallback((e=>{c(e.target.checked)}),[c])})}),E.jsx(vt,{children:E.jsx(_n,{id:"showConnectionStats",type:"checkbox",label:r("developer_mode.show_connection_stats"),checked:!!u,onChange:_.useCallback((e=>{d(e.target.checked)}),[d])})}),E.jsx(vt,{children:E.jsx(_n,{id:"useNewMembershipManager",type:"checkbox",label:r("developer_mode.use_new_membership_manager"),checked:!!h,onChange:_.useCallback((e=>{p(e.target.checked)}),[p])})}),E.jsx(vt,{children:E.jsx(_n,{id:"useToDeviceKeyTransport",type:"checkbox",label:r("developer_mode.use_to_device_key_transport"),checked:!!f,onChange:_.useCallback((e=>{m(e.target.checked)}),[m])})}),t?E.jsxs(E.Fragment,{children:[E.jsx("p",{children:r("developer_mode.livekit_sfu",{url:(null==g?void 0:g.href)||"unknown"})}),E.jsx("p",{children:r("developer_mode.livekit_server_info")}),E.jsxs("pre",{className:A9e.pre,children:[t.serverInfo?JSON.stringify(t.serverInfo,null,2):"undefined",t.metadata]})]}):null,E.jsx("p",{children:r("developer_mode.environment_variables")}),E.jsx("pre",{children:JSON.stringify(N9e,null,2)}),E.jsx("p",{children:r("developer_mode.url_params")}),E.jsx("pre",{children:JSON.stringify(v,null,2)})]})},O4="audio",M4=({open:e,onDismiss:t,tab:n,onTabChange:r,client:i,roomId:o,livekitRoom:s})=>{const{t:a}=ze(),l=uf();X8e(l,e);const[c,u]=qn(YZ),[d,h]=_.useState(c),[p]=qn(S4),{available:f}=Uw(),m={key:"audio",name:a("common.audio"),content:E.jsx(E.Fragment,{children:E.jsxs(eD,{children:[E.jsx(lI,{devices:l.audioInput,title:a("settings.devices.microphone"),numberedLabel:e=>a("settings.devices.microphone_numbered",{n:e})}),E.jsx(lI,{devices:l.audioOutput,title:a("settings.devices.speaker"),numberedLabel:e=>a("settings.devices.speaker_numbered",{n:e})}),E.jsxs("div",{className:Jj.volumeSlider,children:[E.jsx("label",{children:a("settings.audio_tab.effect_volume_label")}),E.jsx("p",{children:a("settings.audio_tab.effect_volume_description")}),E.jsx(xQ,{label:a("video_tile.volume"),value:d,onValueChange:h,onValueCommit:u,min:0,max:1,step:.01})]})]})})},v={key:"video",name:a("common.video"),content:E.jsx(eD,{children:E.jsx(lI,{devices:l.videoInput,title:a("settings.devices.camera"),numberedLabel:e=>a("settings.devices.camera_numbered",{n:e})})})},g={key:"preferences",name:a("common.preferences"),content:E.jsx(Z8e,{})},y={key:"profile",name:a("common.profile"),content:E.jsx(M8e,{client:i})},b={key:"feedback",name:a("settings.feedback_tab_title"),content:E.jsx(N8e,{roomId:o})},w={key:"developer",name:a("settings.developer_tab_title"),content:E.jsx(D9e,{client:i,livekitRoom:s})},S=[m,v];return null===Ge&&S.push(y),S.push(g),f&&S.push(b),p&&S.push(w),E.jsx(lf,{title:a("common.settings"),className:Jj.settingsModal,open:e,onDismiss:t,tabbed:!0,children:E.jsx(d8e,{label:a("common.settings"),tab:n,onTabChange:r,tabs:S})})},j9e=(e,t)=>_.createElement("svg",{width:22,height:22,viewBox:"0 0 22 22",fill:"none",xmlns:"http://www.w3.org/2000/svg",ref:t,...e},_.createElement("mask",{id:"path-1-inside-1_898_2641",fill:"white"},_.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M17.1502 20.1214C15.3946 21.3074 13.2782 22 11 22C8.52367 22 6.23845 21.1817 4.4 19.8008C1.72821 17.794 0 14.5988 0 11C0 4.92487 4.92487 0 11 0C17.0751 0 22 4.92487 22 11C22 14.797 20.0762 18.1446 17.1502 20.1214ZM11 11.55C12.8225 11.55 14.3 9.94942 14.3 7.975C14.3 6.00058 12.8225 4.4 11 4.4C9.17746 4.4 7.7 6.00058 7.7 7.975C7.7 9.94942 9.17746 11.55 11 11.55ZM11 19.8C13.3782 19.8 15.536 18.8566 17.1197 17.3237C16.1403 14.9056 13.7693 13.2 11 13.2C8.23066 13.2 5.85969 14.9056 4.88028 17.3237C6.46399 18.8566 8.62183 19.8 11 19.8Z"})),_.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M17.1502 20.1214C15.3946 21.3074 13.2782 22 11 22C8.52367 22 6.23845 21.1817 4.4 19.8008C1.72821 17.794 0 14.5988 0 11C0 4.92487 4.92487 0 11 0C17.0751 0 22 4.92487 22 11C22 14.797 20.0762 18.1446 17.1502 20.1214ZM11 11.55C12.8225 11.55 14.3 9.94942 14.3 7.975C14.3 6.00058 12.8225 4.4 11 4.4C9.17746 4.4 7.7 6.00058 7.7 7.975C7.7 9.94942 9.17746 11.55 11 11.55ZM11 19.8C13.3782 19.8 15.536 18.8566 17.1197 17.3237C16.1403 14.9056 13.7693 13.2 11 13.2C8.23066 13.2 5.85969 14.9056 4.88028 17.3237C6.46399 18.8566 8.62183 19.8 11 19.8Z",fill:"white"}),_.createElement("path",{d:"M17.1502 20.1214L17.9339 21.2814L17.1502 20.1214ZM4.4 19.8008L3.55919 20.9202H3.55919L4.4 19.8008ZM17.1197 17.3237L18.0934 18.3296L18.7717 17.6731L18.4173 16.7981L17.1197 17.3237ZM4.88028 17.3237L3.58268 16.7981L3.22829 17.6731L3.90659 18.3296L4.88028 17.3237ZM11 23.4C13.5662 23.4 15.9541 22.619 17.9339 21.2814L16.3665 18.9613C14.835 19.9959 12.9902 20.6 11 20.6V23.4ZM3.55919 20.9202C5.63176 22.477 8.21011 23.4 11 23.4V20.6C8.83723 20.6 6.84514 19.8865 5.24081 18.6814L3.55919 20.9202ZM-1.4 11C-1.4 15.0577 0.55052 18.6603 3.55919 20.9202L5.24081 18.6814C2.90591 16.9276 1.4 14.1399 1.4 11H-1.4ZM11 -1.4C4.15167 -1.4 -1.4 4.15167 -1.4 11H1.4C1.4 5.69807 5.69807 1.4 11 1.4V-1.4ZM23.4 11C23.4 4.15167 17.8483 -1.4 11 -1.4V1.4C16.3019 1.4 20.6 5.69807 20.6 11H23.4ZM17.9339 21.2814C21.2288 19.0554 23.4 15.2815 23.4 11H20.6C20.6 14.3124 18.9236 17.2337 16.3665 18.9613L17.9339 21.2814ZM12.9 7.975C12.9 9.28384 11.9459 10.15 11 10.15V12.95C13.6991 12.95 15.7 10.615 15.7 7.975H12.9ZM11 5.8C11.9459 5.8 12.9 6.66616 12.9 7.975H15.7C15.7 5.335 13.6991 3 11 3V5.8ZM9.1 7.975C9.1 6.66616 10.0541 5.8 11 5.8V3C8.30086 3 6.3 5.335 6.3 7.975H9.1ZM11 10.15C10.0541 10.15 9.1 9.28384 9.1 7.975H6.3C6.3 10.615 8.30086 12.95 11 12.95V10.15ZM16.146 16.3178C14.8129 17.6081 13.0004 18.4 11 18.4V21.2C13.756 21.2 16.2591 20.1051 18.0934 18.3296L16.146 16.3178ZM11 14.6C13.1797 14.6 15.0494 15.9415 15.8221 17.8493L18.4173 16.7981C17.2312 13.8697 14.359 11.8 11 11.8V14.6ZM6.17788 17.8493C6.95058 15.9415 8.8203 14.6 11 14.6V11.8C7.64102 11.8 4.7688 13.8697 3.58268 16.7981L6.17788 17.8493ZM11 18.4C8.99963 18.4 7.18709 17.6081 5.85397 16.3178L3.90659 18.3296C5.74088 20.1051 8.24402 21.2 11 21.2V18.4Z",fill:"white",mask:"url(#path-1-inside-1_898_2641)"})),tU=_.forwardRef(j9e),U9e=(e,t)=>_.createElement("svg",{width:24,height:24,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",ref:t,...e},_.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M20.0988 9.01625C20.3188 9.59375 20.8825 9.97875 21.5013 9.97875C22.3263 9.97875 23 10.6525 23 11.4775V12.5225C23 13.3475 22.3263 14.0213 21.5013 14.0213C20.8825 14.0213 20.3188 14.4062 20.0988 14.9838C20.0806 15.0292 20.0624 15.0753 20.0441 15.1218C19.9792 15.2863 19.9125 15.4555 19.8375 15.6163C19.5763 16.18 19.7 16.84 20.14 17.28C20.7313 17.8575 20.7313 18.8062 20.14 19.3975L19.3975 20.14C18.82 20.7313 17.8713 20.7313 17.28 20.14C16.8538 19.7 16.18 19.5763 15.6163 19.8375C15.41 19.9338 15.2037 20.0163 14.9838 20.0988C14.4062 20.3188 14.0213 20.8825 14.0213 21.5013C14.0213 22.3263 13.3475 23 12.5225 23H11.4775C10.6525 23 9.97875 22.3263 9.97875 21.5013C9.97875 20.8825 9.59375 20.3188 9.01625 20.0988C8.97079 20.0806 8.92466 20.0624 8.87815 20.044C8.71368 19.9792 8.54454 19.9125 8.38375 19.8375C7.82 19.5763 7.16 19.7 6.72 20.14C6.1425 20.7313 5.19375 20.7313 4.6025 20.14L3.86 19.3975C3.26875 18.82 3.26875 17.8713 3.86 17.28C4.3 16.8538 4.42375 16.18 4.1625 15.6163C4.06625 15.41 3.98375 15.2037 3.90125 14.9838C3.68125 14.4062 3.1175 14.0213 2.49875 14.0213C1.67375 14.0213 1 13.3475 1 12.5225V11.4775C1 10.6525 1.67375 9.97875 2.49875 9.97875C3.1175 9.97875 3.68125 9.59375 3.90125 9.01625C3.94464 8.87742 3.99897 8.74406 4.0539 8.60926C4.086 8.53046 4.11831 8.45117 4.14875 8.37C4.41 7.80625 4.28625 7.14625 3.84625 6.70625C3.255 6.12875 3.255 5.18 3.84625 4.58875L4.6025 3.86C5.18 3.26875 6.12875 3.26875 6.72 3.86C7.14625 4.3 7.82 4.42375 8.38375 4.1625C8.59 4.06625 8.79625 3.97 9.01625 3.90125C9.59375 3.68125 9.97875 3.1175 9.97875 2.49875C9.97875 1.67375 10.6525 1 11.4775 1H12.5225C13.3475 1 14.0213 1.67375 14.0213 2.49875C14.0213 3.13125 14.4062 3.68125 14.9838 3.90125C15.0292 3.91943 15.0753 3.93762 15.1218 3.95595C15.2863 4.02079 15.4555 4.08746 15.6163 4.1625C16.18 4.42375 16.84 4.3 17.28 3.86C17.8575 3.26875 18.8062 3.26875 19.3975 3.86L20.14 4.6025C20.7313 5.18 20.7313 6.12875 20.14 6.72C19.7 7.14625 19.5763 7.82 19.8375 8.38375C19.9338 8.59 20.0163 8.79625 20.0988 9.01625ZM12 17.5C8.96125 17.5 6.5 15.0387 6.5 12C6.5 8.96125 8.96125 6.5 12 6.5C15.0387 6.5 17.5 8.96125 17.5 12C17.5 15.0387 15.0387 17.5 12 17.5Z",fill:"#ffffff"})),F9e=_.forwardRef(U9e),$9e=(e,t)=>_.createElement("svg",{width:24,height:24,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",ref:t,...e},_.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M7.49966 2.38889C7.49966 1.89797 7.89763 1.5 8.38855 1.5H20.1108C20.6017 1.5 20.9997 1.89797 20.9997 2.38889V21.6111C20.9997 22.102 20.6017 22.5 20.1108 22.5H8.38855C7.89763 22.5 7.49966 22.102 7.49966 21.6111V12.6667H7.49089H7.4821H7.47331H7.46452H7.45573H7.44694H7.43815H7.42936H7.42057H7.41178H7.403H7.39421H7.38542H7.37663H7.36784H7.35905H7.35026H7.34147H7.33268H7.32389H7.3151H7.30632H7.29753H7.28874H7.27995H7.27116H7.26237H7.25358H7.24479H7.236H7.22721H7.21842H7.20964H7.20085H7.19206H7.18327H7.17448H7.16569H7.1569H7.14811H7.13932H7.13053H7.12175H7.11296H7.10417H7.09538H7.08659H7.0778H7.06901H7.06022H7.05143H7.04264H7.03385H7.02507H7.01628H7.00749H6.9987H6.98991H6.98112H6.97233H6.96354H6.95475H6.94596H6.93717H6.92839H6.9196H6.91081H6.90202H6.89323H6.88444H6.87565H6.86686H6.85807H6.84928H6.8405H6.83171H6.82292H6.81413H6.80534H6.79655H6.78776H6.77897H6.77018H6.76139H6.7526H6.74382H6.73503H6.72624H6.71745H6.70866H6.69987H6.69108H6.68229H6.6735H6.66471H6.65592H6.64714H6.63835H6.62956H6.62077H6.61198H6.60319H6.5944H6.58561H6.57682H6.56803H6.55925H6.55046H6.54167H6.53288H6.52409H6.5153H6.50651H6.49772H6.48893H6.48014H6.47135H6.46257H6.45378H6.44499H6.4362H6.42741H6.41862H6.40983H6.40104H6.39225H6.38346H6.37467H6.36589H6.3571H6.34831H6.33952H6.33073H6.32194H6.31315H6.30436H6.29557H6.28678H6.27799H6.26921H6.26042H6.25163H6.24284H6.23405H6.22526H6.21647H6.20768H6.19889H6.1901H6.18132H6.17253H6.16374H6.15495H6.14616H6.13737H6.12858H6.11979H6.111H6.10221H6.09342H6.08464H6.07585H6.06706H6.05827H6.04948H6.04069H6.0319H6.02311H6.01432H6.00553H5.99674H5.98796H5.97917H5.97038H5.96159H5.9528H5.94401H5.93522H5.92643H5.91764H5.90885H5.90007H5.89128H5.88249H5.8737H5.86491H5.85612H5.84733H5.83854H5.82975H5.82096H5.81217H5.80339H5.7946H5.78581H5.77702H5.76823H5.75944H5.75065H5.74186H5.73307H5.72428H5.71549H5.70671H5.69792H5.68913H5.68034H5.67155H5.66276H5.65397H5.64518H5.63639H5.6276H5.61882H5.61003H5.60124H5.59245H5.58366H5.57487H5.56608H5.55729H5.5485H5.53971H5.53092H5.52214H5.51335H5.50456H5.49577H5.48698H5.47819H5.4694H5.46061H5.45182H5.44303H5.43424H5.42546H5.41667H5.40788H5.39909H5.3903H5.38151H5.37272H5.36393H5.35514H5.34635H5.33757H5.32878H5.31999H5.3112H5.30241H5.29362H5.28483H5.27604H5.26725H5.25846H5.24967H5.24089H5.2321H5.22331H5.21452H5.20573H5.19694H5.18815H5.17936H5.17057H5.16178H5.15299H5.14421H5.13542H5.12663H5.11784H5.10905H5.10026H5.09147H5.08268H5.07389H5.0651H5.05632H5.04753H5.03874H5.02995H5.02116H5.01237H5.00358H4.99479H4.986H4.97721H4.96842H4.95964H4.95085H4.94206H4.93327H4.92448H4.91569H4.9069H4.89811H4.88932H4.88053H4.87174H4.86296H4.85417H4.84538H4.83659H4.8278H4.81901H4.81022H4.80143H4.79264H4.78385H4.77507H4.76628H4.75749H4.7487H4.73991H4.73112H4.72233H4.71354H4.70475H4.69596H4.68717H4.67839H4.6696H4.66081H4.65202H4.64323H4.63444H4.62565H4.61686H4.60807H4.59928H4.59049H4.58171H4.57292H4.56413H4.55534H4.54655H4.53776H4.52897H4.52018H4.51139H4.5026H4.49382H4.48503H4.47624H4.46745H4.45866H4.44987H4.44108H4.43229H4.4235H4.41471H4.40592H4.39714H4.38835H4.37956H4.37077H4.36198H4.35319H4.3444H4.33561H4.32682H4.31803H4.30924H4.30046H4.29167H4.28288H4.27409H4.2653H4.25651H4.24772H4.23893H4.23014H4.22135H4.21257H4.20378H4.19499H4.1862H4.17741H4.16862H4.15983H4.15104H4.14225H4.13346H4.12467H4.11589H4.1071H4.09831H4.08952H4.08073H4.07194H4.06315H4.05436H4.04557H4.03678H4.02799H4.01921H4.01042H4.00163H3.99284H3.98405H3.97526H3.96647H3.95768H3.94889H3.9401H3.93132H3.92253H3.91374H3.90495H3.89616H3.88737H3.87858H3.86979H3.861H3.85221H3.84342H3.83464H3.82585H3.81706H3.80827H3.79948H3.79069H3.7819H3.77311H3.76432H3.75553H3.74674H3.73796H3.72917H3.72038H3.71159H3.7028H3.69401H3.68522H3.67643H3.66764H3.65885H3.65007H3.64128H3.63249H3.6237H3.61491H3.60612H3.59733H3.58854H3.57975H3.57096H3.56217H3.55339H3.5446H3.53581H3.52702H3.51823H3.50944H3.50065H3.49186H3.48307H3.47428H3.46549H3.45671H3.44792H3.43913H3.43034H3.42155H3.41276H3.40397H3.39518H3.38639H3.3776H3.36882H3.36003H3.35124H3.34245H3.33366H3.32487H3.31608H3.30729H3.2985H3.28971H3.28092H3.27214H3.26335H3.25456H3.24577H3.23698H3.22819H3.2194H3.21061H3.20182H3.19303H3.18424H3.17546H3.16667H3.15788H3.14909H3.1403H3.13151H3.12272H3.11393H3.10514H3.09635H3.08757H3.07878H3.06999H3.0612H3.05241H3.04362H3.03483H3.02604H3.01725H3.00846H2.99967C2.63148 12.6667 2.33301 12.3682 2.33301 12C2.33301 11.6318 2.63148 11.3333 2.99967 11.3333H3.00846H3.01725H3.02604H3.03483H3.04362H3.05241H3.0612H3.06999H3.07878H3.08757H3.09635H3.10514H3.11393H3.12272H3.13151H3.1403H3.14909H3.15788H3.16667H3.17546H3.18424H3.19303H3.20182H3.21061H3.2194H3.22819H3.23698H3.24577H3.25456H3.26335H3.27214H3.28092H3.28971H3.2985H3.30729H3.31608H3.32487H3.33366H3.34245H3.35124H3.36003H3.36882H3.3776H3.38639H3.39518H3.40397H3.41276H3.42155H3.43034H3.43913H3.44792H3.45671H3.46549H3.47428H3.48307H3.49186H3.50065H3.50944H3.51823H3.52702H3.53581H3.5446H3.55339H3.56217H3.57096H3.57975H3.58854H3.59733H3.60612H3.61491H3.6237H3.63249H3.64128H3.65007H3.65885H3.66764H3.67643H3.68522H3.69401H3.7028H3.71159H3.72038H3.72917H3.73796H3.74674H3.75553H3.76432H3.77311H3.7819H3.79069H3.79948H3.80827H3.81706H3.82585H3.83464H3.84342H3.85221H3.861H3.86979H3.87858H3.88737H3.89616H3.90495H3.91374H3.92253H3.93132H3.9401H3.94889H3.95768H3.96647H3.97526H3.98405H3.99284H4.00163H4.01042H4.01921H4.02799H4.03678H4.04557H4.05436H4.06315H4.07194H4.08073H4.08952H4.09831H4.1071H4.11589H4.12467H4.13346H4.14225H4.15104H4.15983H4.16862H4.17741H4.1862H4.19499H4.20378H4.21257H4.22135H4.23014H4.23893H4.24772H4.25651H4.2653H4.27409H4.28288H4.29167H4.30046H4.30924H4.31803H4.32682H4.33561H4.3444H4.35319H4.36198H4.37077H4.37956H4.38835H4.39714H4.40592H4.41471H4.4235H4.43229H4.44108H4.44987H4.45866H4.46745H4.47624H4.48503H4.49382H4.5026H4.51139H4.52018H4.52897H4.53776H4.54655H4.55534H4.56413H4.57292H4.58171H4.59049H4.59928H4.60807H4.61686H4.62565H4.63444H4.64323H4.65202H4.66081H4.6696H4.67839H4.68717H4.69596H4.70475H4.71354H4.72233H4.73112H4.73991H4.7487H4.75749H4.76628H4.77507H4.78385H4.79264H4.80143H4.81022H4.81901H4.8278H4.83659H4.84538H4.85417H4.86296H4.87174H4.88053H4.88932H4.89811H4.9069H4.91569H4.92448H4.93327H4.94206H4.95085H4.95964H4.96842H4.97721H4.986H4.99479H5.00358H5.01237H5.02116H5.02995H5.03874H5.04753H5.05631H5.0651H5.07389H5.08268H5.09147H5.10026H5.10905H5.11784H5.12663H5.13542H5.14421H5.15299H5.16178H5.17057H5.17936H5.18815H5.19694H5.20573H5.21452H5.22331H5.2321H5.24089H5.24967H5.25846H5.26725H5.27604H5.28483H5.29362H5.30241H5.3112H5.31999H5.32878H5.33757H5.34635H5.35514H5.36393H5.37272H5.38151H5.3903H5.39909H5.40788H5.41667H5.42546H5.43424H5.44303H5.45182H5.46061H5.4694H5.47819H5.48698H5.49577H5.50456H5.51335H5.52214H5.53092H5.53971H5.5485H5.55729H5.56608H5.57487H5.58366H5.59245H5.60124H5.61003H5.61882H5.6276H5.63639H5.64518H5.65397H5.66276H5.67155H5.68034H5.68913H5.69792H5.70671H5.71549H5.72428H5.73307H5.74186H5.75065H5.75944H5.76823H5.77702H5.78581H5.7946H5.80339H5.81217H5.82096H5.82975H5.83854H5.84733H5.85612H5.86491H5.8737H5.88249H5.89128H5.90007H5.90885H5.91764H5.92643H5.93522H5.94401H5.9528H5.96159H5.97038H5.97917H5.98796H5.99674H6.00553H6.01432H6.02311H6.0319H6.04069H6.04948H6.05827H6.06706H6.07585H6.08464H6.09342H6.10221H6.111H6.11979H6.12858H6.13737H6.14616H6.15495H6.16374H6.17253H6.18132H6.1901H6.19889H6.20768H6.21647H6.22526H6.23405H6.24284H6.25163H6.26042H6.26921H6.27799H6.28678H6.29557H6.30436H6.31315H6.32194H6.33073H6.33952H6.34831H6.3571H6.36589H6.37467H6.38346H6.39225H6.40104H6.40983H6.41862H6.42741H6.4362H6.44499H6.45378H6.46257H6.47135H6.48014H6.48893H6.49772H6.50651H6.5153H6.52409H6.53288H6.54167H6.55046H6.55925H6.56803H6.57682H6.58561H6.5944H6.60319H6.61198H6.62077H6.62956H6.63835H6.64714H6.65592H6.66471H6.6735H6.68229H6.69108H6.69987H6.70866H6.71745H6.72624H6.73503H6.74382H6.7526H6.76139H6.77018H6.77897H6.78776H6.79655H6.80534H6.81413H6.82292H6.83171H6.8405H6.84928H6.85807H6.86686H6.87565H6.88444H6.89323H6.90202H6.91081H6.9196H6.92839H6.93717H6.94596H6.95475H6.96354H6.97233H6.98112H6.98991H6.9987H7.00749H7.01628H7.02507H7.03385H7.04264H7.05143H7.06022H7.06901H7.0778H7.08659H7.09538H7.10417H7.11296H7.12175H7.13053H7.13932H7.14811H7.1569H7.16569H7.17448H7.18327H7.19206H7.20085H7.20964H7.21842H7.22721H7.236H7.24479H7.25358H7.26237H7.27116H7.27995H7.28874H7.29753H7.30632H7.3151H7.32389H7.33268H7.34147H7.35026H7.35905H7.36784H7.37663H7.38542H7.39421H7.403H7.41178H7.42057H7.42936H7.43815H7.44694H7.45573H7.46452H7.47331H7.4821H7.49089H7.49966V2.38889ZM13.3687 6.24853C13.1172 5.9796 12.7095 5.9796 12.458 6.24853C12.2065 6.51747 12.2065 6.9535 12.458 7.22243L16.3022 11.3336L16.2894 11.3336L16.2726 11.3336L16.2558 11.3336L16.239 11.3335L16.2223 11.3335L16.2055 11.3335L16.1887 11.3335L16.1719 11.3335L16.1552 11.3334L16.1384 11.3334L16.1216 11.3334L16.1048 11.3334L16.088 11.3334L16.0713 11.3333L16.0545 11.3333L16.0377 11.3333L16.0209 11.3333L16.0041 11.3333L15.9874 11.3332L15.9706 11.3332L15.9538 11.3332L15.937 11.3332L15.9202 11.3332L15.9035 11.3331L15.8867 11.3331L15.8699 11.3331L15.8531 11.3331L15.8364 11.3331L15.8196 11.333L15.8028 11.333L15.786 11.333L15.7692 11.333L15.7525 11.333L15.7357 11.3329L15.7189 11.3329L15.7021 11.3329L15.6853 11.3329L15.6686 11.3329L15.6518 11.3328L15.635 11.3328L15.6182 11.3328L15.6014 11.3328L15.5847 11.3328L15.5679 11.3327L15.5511 11.3327L15.5343 11.3327L15.5175 11.3327L15.5008 11.3327L15.484 11.3326L15.4672 11.3326L15.4504 11.3326L15.4337 11.3326L15.4169 11.3326L15.4001 11.3325L15.3833 11.3325L15.3665 11.3325L15.3498 11.3325L15.333 11.3324L15.3162 11.3324L15.2994 11.3324L15.2826 11.3324L15.2659 11.3324L15.2491 11.3323L15.2323 11.3323L15.2155 11.3323L15.1987 11.3323L15.182 11.3323L15.1652 11.3322L15.1484 11.3322L15.1316 11.3322L15.1148 11.3322L15.0981 11.3322L15.0813 11.3321L15.0645 11.3321L15.0477 11.3321L15.031 11.3321L15.0142 11.3321L14.9974 11.332L14.9806 11.332L14.9638 11.332L14.9471 11.332L14.9303 11.332L14.9135 11.3319L14.8967 11.3319L14.8799 11.3319L14.8632 11.3319L14.8464 11.3319L14.8296 11.3318L14.8128 11.3318L14.796 11.3318L14.7793 11.3318L14.7625 11.3318L14.7457 11.3317L14.7289 11.3317L14.7122 11.3317L14.6954 11.3317L14.6786 11.3317L14.6618 11.3316L14.645 11.3316L14.6283 11.3316L14.6115 11.3316L14.5947 11.3316L14.5779 11.3315L14.5611 11.3315L14.5444 11.3315L14.5276 11.3315L14.5108 11.3315L14.494 11.3314L14.4772 11.3314L14.4605 11.3314L14.4437 11.3314L14.4269 11.3314L14.4101 11.3313L14.3933 11.3313L14.3766 11.3313L14.3598 11.3313L14.343 11.3313L14.3262 11.3312L14.3095 11.3312L14.2927 11.3312L14.2759 11.3312L14.2591 11.3312L14.2423 11.3311L14.2256 11.3311L14.2088 11.3311L14.192 11.3311L14.1752 11.3311L14.1584 11.331L14.1417 11.331L14.1249 11.331L14.1081 11.331L14.0913 11.331L14.0745 11.3309L14.0578 11.3309L14.041 11.3309L14.0242 11.3309L14.0074 11.3309L13.9906 11.3308L13.9739 11.3308L13.9571 11.3308L13.9403 11.3308L13.9235 11.3308L13.9068 11.3307L13.89 11.3307L13.8732 11.3307L13.8564 11.3307L13.8396 11.3307L13.8229 11.3306L13.8061 11.3306L13.7893 11.3306L13.7725 11.3306L13.7557 11.3306L13.739 11.3305L13.7222 11.3305L13.7054 11.3305L13.6886 11.3305L13.6718 11.3305L13.6551 11.3304L13.6383 11.3304L13.6215 11.3304L13.6047 11.3304L13.5879 11.3304L13.5712 11.3303L13.5544 11.3303L13.5376 11.3303L13.5208 11.3303L13.5041 11.3303L13.4873 11.3302L13.4705 11.3302L13.4537 11.3302L13.4369 11.3302L13.4202 11.3302L13.4034 11.3301L13.3866 11.3301L13.3698 11.3301L13.353 11.3301L13.3363 11.33L13.3195 11.33L13.3027 11.33L13.2859 11.33L13.2691 11.33L13.2524 11.3299L13.2356 11.3299L13.2188 11.3299L13.202 11.3299L13.1853 11.3299L13.1685 11.3298L13.1517 11.3298L13.1349 11.3298L13.1181 11.3298L13.1014 11.3298L13.0846 11.3297L13.0678 11.3297L13.051 11.3297L13.0342 11.3297L13.0175 11.3297L13.0007 11.3296L12.9839 11.3296L12.9671 11.3296L12.9503 11.3296L12.9336 11.3296L12.9168 11.3295L12.9 11.3295L12.8832 11.3295L12.8664 11.3295L12.8497 11.3295L12.8329 11.3294L12.8161 11.3294L12.7993 11.3294L12.7826 11.3294L12.7658 11.3294L12.749 11.3293L12.7322 11.3293L12.7154 11.3293L12.6987 11.3293L12.6819 11.3293L12.6651 11.3292L12.6483 11.3292L12.6315 11.3292L12.6148 11.3292L12.598 11.3292L12.5812 11.3291L12.5644 11.3291L12.5476 11.3291L12.5309 11.3291L12.5141 11.3291L12.4973 11.329L12.4805 11.329L12.4637 11.329L12.447 11.329L12.4302 11.329L12.4134 11.3289L12.3966 11.3289L12.3799 11.3289L12.3631 11.3289L12.3463 11.3289L12.3295 11.3288L12.3127 11.3288L12.296 11.3288L12.2792 11.3288L12.2624 11.3288L12.2456 11.3287L12.2288 11.3287L12.2121 11.3287L12.1953 11.3287L12.1785 11.3287L12.1617 11.3286L12.1449 11.3286L12.1282 11.3286L12.1114 11.3286L12.0946 11.3286L12.0778 11.3285L12.0611 11.3285L12.0443 11.3285L12.0275 11.3285L12.0107 11.3285L11.9939 11.3284L11.9772 11.3284L11.9604 11.3284L11.9436 11.3284L11.9268 11.3284L11.91 11.3283L11.8933 11.3283L11.8765 11.3283L11.8597 11.3283L11.8429 11.3283L11.8261 11.3282L11.8094 11.3282L11.7926 11.3282L11.7758 11.3282L11.759 11.3282L11.7422 11.3281L11.7255 11.3281L11.7087 11.3281L11.6919 11.3281L11.6751 11.3281L11.6583 11.328L11.6416 11.328L11.6248 11.328L11.608 11.328L11.5912 11.328L11.5745 11.3279L11.5577 11.3279L11.5409 11.3279L11.5241 11.3279L11.5073 11.3279L11.4906 11.3278L11.4738 11.3278L11.457 11.3278L11.4402 11.3278L11.4234 11.3278L11.4067 11.3277L11.3899 11.3277L11.3731 11.3277L11.3563 11.3277L11.3395 11.3277L11.3228 11.3276L11.306 11.3276L11.2892 11.3276L11.2724 11.3276L11.2557 11.3275L11.2389 11.3275L11.2221 11.3275L11.2053 11.3275L11.1885 11.3275L11.1718 11.3274L11.155 11.3274L11.1382 11.3274L11.1214 11.3274L11.1046 11.3274L11.0879 11.3273L11.0711 11.3273L11.0543 11.3273L11.0375 11.3273L11.0207 11.3273L11.004 11.3272L10.9872 11.3272L10.9704 11.3272L10.9536 11.3272L10.9368 11.3272L10.9201 11.3271L10.9033 11.3271L10.8865 11.3271L10.8697 11.3271L10.853 11.3271L10.8362 11.327L10.8194 11.327L10.8026 11.327L10.7858 11.327L10.7691 11.327L10.7523 11.3269L10.7355 11.3269L10.7187 11.3269L10.7019 11.3269L10.6852 11.3269L10.6684 11.3268L10.6516 11.3268L10.6348 11.3268L10.618 11.3268L10.6013 11.3268L10.5845 11.3267L10.5677 11.3267L10.5509 11.3267L10.5341 11.3267L10.5174 11.3267L10.5006 11.3266L10.4838 11.3266L10.467 11.3266L10.4503 11.3266L10.4335 11.3266L10.4167 11.3265L10.3999 11.3265L10.3831 11.3265L10.3664 11.3265L10.3496 11.3265L10.3328 11.3264L10.316 11.3264L10.2992 11.3264L10.2825 11.3264L10.2657 11.3264L10.2489 11.3263L10.2321 11.3263L10.2153 11.3263L10.1986 11.3263L10.1818 11.3263L10.165 11.3262L10.1482 11.3262L10.1315 11.3262L10.1147 11.3262L10.0979 11.3262L10.0811 11.3261L10.0643 11.3261L10.0476 11.3261L10.0308 11.3261L10.014 11.3261L9.99722 11.326L9.98044 11.326L9.96366 11.326L9.94688 11.326L9.9301 11.326L9.91332 11.3259L9.89654 11.3259L9.87977 11.3259L9.86299 11.3259L9.84621 11.3259L9.82943 11.3258L9.81265 11.3258L9.79587 11.3258L9.77909 11.3258L9.76231 11.3258L9.74553 11.3257L9.72875 11.3257L9.71197 11.3257L9.69519 11.3257L9.67841 11.3257L9.66163 11.3256L9.64486 11.3256L9.62808 11.3256L9.6113 11.3256L9.59452 11.3256L9.57774 11.3255L9.56096 11.3255L9.54418 11.3255L9.5274 11.3255L9.51062 11.3255L9.49384 11.3254L9.47706 11.3254L9.46029 11.3254L9.44351 11.3254L9.42673 11.3254L9.40995 11.3253L9.39317 11.3253L9.37639 11.3253L9.35961 11.3253L9.34283 11.3253L9.32605 11.3252L9.30927 11.3252L9.29249 11.3252L9.27572 11.3252L9.25894 11.3252L9.24216 11.3251L9.22538 11.3251L9.2086 11.3251L9.19182 11.3251L9.17504 11.325L9.15826 11.325L9.14148 11.325L9.1247 11.325L9.10792 11.325L9.09115 11.3249L9.07437 11.3249L9.05759 11.3249L9.04081 11.3249L9.02403 11.3249L9.00725 11.3248L8.99047 11.3248L8.97369 11.3248L8.95691 11.3248L8.94013 11.3248L8.92335 11.3247L8.90658 11.3247L8.8898 11.3247L8.87302 11.3247L8.85624 11.3247L8.83946 11.3246L8.82268 11.3246L8.8059 11.3246L8.78912 11.3246L8.77234 11.3246L8.75556 11.3245L8.73878 11.3245L8.722 11.3245L8.70523 11.3245L8.68845 11.3245L8.67167 11.3244L8.65489 11.3244L8.63811 11.3244L8.62133 11.3244L8.60455 11.3244L8.58777 11.3243L8.57099 11.3243L8.55421 11.3243L8.53743 11.3243L8.52066 11.3243L8.50388 11.3242L8.4871 11.3242L8.47032 11.3242L8.45354 11.3242L8.43676 11.3242L8.41998 11.3241L8.4032 11.3241L8.38642 11.3241L8.36964 11.3241L8.35286 11.3241L8.33608 11.324L8.31931 11.324L8.30253 11.324L8.28575 11.324L8.26897 11.324L8.25219 11.3239L8.23541 11.3239L8.21863 11.3239L8.20185 11.3239L8.18507 11.3239L8.16829 11.3238L8.15151 11.3238L8.13474 11.3238L8.11796 11.3238L8.10118 11.3238L8.0844 11.3237L8.06762 11.3237L8.05084 11.3237L8.03406 11.3237L8.01728 11.3237L8.0005 11.3236L7.99885 12.657L8.01563 12.657L8.03241 12.657L8.04919 12.657L8.06597 12.6571L8.08274 12.6571L8.09952 12.6571L8.1163 12.6571L8.13308 12.6571L8.14986 12.6572L8.16664 12.6572L8.18342 12.6572L8.2002 12.6572L8.21698 12.6572L8.23376 12.6573L8.25054 12.6573L8.26731 12.6573L8.28409 12.6573L8.30087 12.6573L8.31765 12.6574L8.33443 12.6574L8.35121 12.6574L8.36799 12.6574L8.38477 12.6574L8.40155 12.6575L8.41833 12.6575L8.43511 12.6575L8.45189 12.6575L8.46866 12.6575L8.48544 12.6576L8.50222 12.6576L8.519 12.6576L8.53578 12.6576L8.55256 12.6576L8.56934 12.6577L8.58612 12.6577L8.6029 12.6577L8.61968 12.6577L8.63646 12.6577L8.65323 12.6578L8.67001 12.6578L8.68679 12.6578L8.70357 12.6578L8.72035 12.6578L8.73713 12.6579L8.75391 12.6579L8.77069 12.6579L8.78747 12.6579L8.80425 12.6579L8.82103 12.658L8.83781 12.658L8.85458 12.658L8.87136 12.658L8.88814 12.658L8.90492 12.6581L8.9217 12.6581L8.93848 12.6581L8.95526 12.6581L8.97204 12.6581L8.98882 12.6582L9.0056 12.6582L9.02238 12.6582L9.03915 12.6582L9.05593 12.6582L9.07271 12.6583L9.08949 12.6583L9.10627 12.6583L9.12305 12.6583L9.13983 12.6583L9.15661 12.6584L9.17339 12.6584L9.19017 12.6584L9.20695 12.6584L9.22373 12.6584L9.2405 12.6585L9.25728 12.6585L9.27406 12.6585L9.29084 12.6585L9.30762 12.6585L9.3244 12.6586L9.34118 12.6586L9.35796 12.6586L9.37474 12.6586L9.39152 12.6586L9.4083 12.6587L9.42507 12.6587L9.44185 12.6587L9.45863 12.6587L9.47541 12.6587L9.49219 12.6588L9.50897 12.6588L9.52575 12.6588L9.54253 12.6588L9.55931 12.6588L9.57609 12.6589L9.59287 12.6589L9.60964 12.6589L9.62642 12.6589L9.6432 12.6589L9.65998 12.659L9.67676 12.659L9.69354 12.659L9.71032 12.659L9.7271 12.659L9.74388 12.6591L9.76066 12.6591L9.77744 12.6591L9.79421 12.6591L9.81099 12.6591L9.82777 12.6592L9.84455 12.6592L9.86133 12.6592L9.87811 12.6592L9.89489 12.6592L9.91167 12.6593L9.92845 12.6593L9.94523 12.6593L9.96201 12.6593L9.97879 12.6594L9.99556 12.6594L10.0123 12.6594L10.0291 12.6594L10.0459 12.6594L10.0627 12.6595L10.0795 12.6595L10.0962 12.6595L10.113 12.6595L10.1298 12.6595L10.1466 12.6596L10.1634 12.6596L10.1801 12.6596L10.1969 12.6596L10.2137 12.6596L10.2305 12.6597L10.2473 12.6597L10.264 12.6597L10.2808 12.6597L10.2976 12.6597L10.3144 12.6598L10.3311 12.6598L10.3479 12.6598L10.3647 12.6598L10.3815 12.6598L10.3983 12.6599L10.415 12.6599L10.4318 12.6599L10.4486 12.6599L10.4654 12.6599L10.4822 12.66L10.4989 12.66L10.5157 12.66L10.5325 12.66L10.5493 12.66L10.5661 12.6601L10.5828 12.6601L10.5996 12.6601L10.6164 12.6601L10.6332 12.6601L10.65 12.6602L10.6667 12.6602L10.6835 12.6602L10.7003 12.6602L10.7171 12.6602L10.7338 12.6603L10.7506 12.6603L10.7674 12.6603L10.7842 12.6603L10.801 12.6603L10.8177 12.6604L10.8345 12.6604L10.8513 12.6604L10.8681 12.6604L10.8849 12.6604L10.9016 12.6605L10.9184 12.6605L10.9352 12.6605L10.952 12.6605L10.9688 12.6605L10.9855 12.6606L11.0023 12.6606L11.0191 12.6606L11.0359 12.6606L11.0526 12.6606L11.0694 12.6607L11.0862 12.6607L11.103 12.6607L11.1198 12.6607L11.1365 12.6607L11.1533 12.6608L11.1701 12.6608L11.1869 12.6608L11.2037 12.6608L11.2204 12.6608L11.2372 12.6609L11.254 12.6609L11.2708 12.6609L11.2876 12.6609L11.3043 12.6609L11.3211 12.661L11.3379 12.661L11.3547 12.661L11.3715 12.661L11.3882 12.661L11.405 12.6611L11.4218 12.6611L11.4386 12.6611L11.4553 12.6611L11.4721 12.6611L11.4889 12.6612L11.5057 12.6612L11.5225 12.6612L11.5392 12.6612L11.556 12.6612L11.5728 12.6613L11.5896 12.6613L11.6064 12.6613L11.6231 12.6613L11.6399 12.6613L11.6567 12.6614L11.6735 12.6614L11.6903 12.6614L11.707 12.6614L11.7238 12.6614L11.7406 12.6615L11.7574 12.6615L11.7742 12.6615L11.7909 12.6615L11.8077 12.6615L11.8245 12.6616L11.8413 12.6616L11.858 12.6616L11.8748 12.6616L11.8916 12.6616L11.9084 12.6617L11.9252 12.6617L11.9419 12.6617L11.9587 12.6617L11.9755 12.6617L11.9923 12.6618L12.0091 12.6618L12.0258 12.6618L12.0426 12.6618L12.0594 12.6618L12.0762 12.6619L12.093 12.6619L12.1097 12.6619L12.1265 12.6619L12.1433 12.662L12.1601 12.662L12.1768 12.662L12.1936 12.662L12.2104 12.662L12.2272 12.6621L12.244 12.6621L12.2607 12.6621L12.2775 12.6621L12.2943 12.6621L12.3111 12.6622L12.3279 12.6622L12.3446 12.6622L12.3614 12.6622L12.3782 12.6622L12.395 12.6623L12.4118 12.6623L12.4285 12.6623L12.4453 12.6623L12.4621 12.6623L12.4789 12.6624L12.4957 12.6624L12.5124 12.6624L12.5292 12.6624L12.546 12.6624L12.5628 12.6625L12.5795 12.6625L12.5963 12.6625L12.6131 12.6625L12.6299 12.6625L12.6467 12.6626L12.6634 12.6626L12.6802 12.6626L12.697 12.6626L12.7138 12.6626L12.7306 12.6627L12.7473 12.6627L12.7641 12.6627L12.7809 12.6627L12.7977 12.6627L12.8145 12.6628L12.8312 12.6628L12.848 12.6628L12.8648 12.6628L12.8816 12.6628L12.8984 12.6629L12.9151 12.6629L12.9319 12.6629L12.9487 12.6629L12.9655 12.6629L12.9822 12.663L12.999 12.663L13.0158 12.663L13.0326 12.663L13.0494 12.663L13.0661 12.6631L13.0829 12.6631L13.0997 12.6631L13.1165 12.6631L13.1333 12.6631L13.15 12.6632L13.1668 12.6632L13.1836 12.6632L13.2004 12.6632L13.2172 12.6632L13.2339 12.6633L13.2507 12.6633L13.2675 12.6633L13.2843 12.6633L13.3011 12.6633L13.3178 12.6634L13.3346 12.6634L13.3514 12.6634L13.3682 12.6634L13.3849 12.6634L13.4017 12.6635L13.4185 12.6635L13.4353 12.6635L13.4521 12.6635L13.4688 12.6635L13.4856 12.6636L13.5024 12.6636L13.5192 12.6636L13.536 12.6636L13.5527 12.6636L13.5695 12.6637L13.5863 12.6637L13.6031 12.6637L13.6199 12.6637L13.6366 12.6637L13.6534 12.6638L13.6702 12.6638L13.687 12.6638L13.7038 12.6638L13.7205 12.6638L13.7373 12.6639L13.7541 12.6639L13.7709 12.6639L13.7876 12.6639L13.8044 12.6639L13.8212 12.664L13.838 12.664L13.8548 12.664L13.8715 12.664L13.8883 12.664L13.9051 12.6641L13.9219 12.6641L13.9387 12.6641L13.9554 12.6641L13.9722 12.6641L13.989 12.6642L14.0058 12.6642L14.0226 12.6642L14.0393 12.6642L14.0561 12.6642L14.0729 12.6643L14.0897 12.6643L14.1064 12.6643L14.1232 12.6643L14.14 12.6644L14.1568 12.6644L14.1736 12.6644L14.1903 12.6644L14.2071 12.6644L14.2239 12.6645L14.2407 12.6645L14.2575 12.6645L14.2742 12.6645L14.291 12.6645L14.3078 12.6646L14.3246 12.6646L14.3414 12.6646L14.3581 12.6646L14.3749 12.6646L14.3917 12.6647L14.4085 12.6647L14.4253 12.6647L14.442 12.6647L14.4588 12.6647L14.4756 12.6648L14.4924 12.6648L14.5091 12.6648L14.5259 12.6648L14.5427 12.6648L14.5595 12.6649L14.5763 12.6649L14.593 12.6649L14.6098 12.6649L14.6266 12.6649L14.6434 12.665L14.6602 12.665L14.6769 12.665L14.6937 12.665L14.7105 12.665L14.7273 12.6651L14.7441 12.6651L14.7608 12.6651L14.7776 12.6651L14.7944 12.6651L14.8112 12.6652L14.828 12.6652L14.8447 12.6652L14.8615 12.6652L14.8783 12.6652L14.8951 12.6653L14.9118 12.6653L14.9286 12.6653L14.9454 12.6653L14.9622 12.6653L14.979 12.6654L14.9957 12.6654L15.0125 12.6654L15.0293 12.6654L15.0461 12.6654L15.0629 12.6655L15.0796 12.6655L15.0964 12.6655L15.1132 12.6655L15.13 12.6655L15.1468 12.6656L15.1635 12.6656L15.1803 12.6656L15.1971 12.6656L15.2139 12.6656L15.2306 12.6657L15.2474 12.6657L15.2642 12.6657L15.281 12.6657L15.2978 12.6657L15.3145 12.6658L15.3313 12.6658L15.3481 12.6658L15.3649 12.6658L15.3817 12.6658L15.3984 12.6659L15.4152 12.6659L15.432 12.6659L15.4488 12.6659L15.4656 12.6659L15.4823 12.666L15.4991 12.666L15.5159 12.666L15.5327 12.666L15.5495 12.666L15.5662 12.6661L15.583 12.6661L15.5998 12.6661L15.6166 12.6661L15.6333 12.6661L15.6501 12.6662L15.6669 12.6662L15.6837 12.6662L15.7005 12.6662L15.7172 12.6662L15.734 12.6663L15.7508 12.6663L15.7676 12.6663L15.7844 12.6663L15.8011 12.6663L15.8179 12.6664L15.8347 12.6664L15.8515 12.6664L15.8683 12.6664L15.885 12.6664L15.9018 12.6665L15.9186 12.6665L15.9354 12.6665L15.9522 12.6665L15.9689 12.6665L15.9857 12.6666L16.0025 12.6666L16.0193 12.6666L16.036 12.6666L16.0528 12.6666L16.0696 12.6667L16.0864 12.6667L16.1032 12.6667L16.1199 12.6667L16.1367 12.6667L16.1535 12.6668L16.1703 12.6668L16.1871 12.6668L16.2038 12.6668L16.2206 12.6669L16.2374 12.6669L16.2542 12.6669L16.271 12.6669L16.2836 12.6669L12.458 16.7581C12.2065 17.0271 12.2065 17.4631 12.458 17.732C12.7095 18.001 13.1172 18.001 13.3687 17.732L18.2822 12.4772C18.5337 12.2083 18.5337 11.7723 18.2822 11.5033L13.3687 6.24853Z",fill:"white"})),H9e=_.forwardRef($9e),B9e=(e,t)=>_.createElement("svg",{width:24,height:24,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",ref:t,...e},_.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M18.2139 2.44646L12 3.99992H5.4375C4.64359 3.99992 4 4.64352 4 5.43742V18.5624C4 19.3563 4.64359 19.9999 5.4375 19.9999H12L18.2139 21.5534C19.1211 21.7802 20 21.094 20 20.1588V3.84104C20 2.90584 19.1211 2.21964 18.2139 2.44646ZM12 17.9999V5.99992H6V17.9999H12Z",fill:"white"})),V9e=_.forwardRef(B9e),q9e="_userButton_t5z8t_15",K9e={userButton:q9e},G9e=({preventNavigation:e,isAuthenticated:t,isPasswordlessUser:n,userId:r,displayName:i,avatarUrl:o,onAction:s})=>{const{t:a}=ze(),l=di(),c=_.useMemo((()=>{const r=[];return t&&(r.push({key:"user",icon:tU,label:i,dataTestid:"usermenu_user"}),r.push({key:"settings",icon:F9e,label:a("common.settings")}),n&&!e&&r.push({key:"login",label:a("action.sign_in"),icon:H9e,dataTestid:"usermenu_login"}),!n&&!e&&r.push({key:"logout",label:a("action.sign_out"),icon:V9e,dataTestid:"usermenu_logout"})),r}),[t,n,i,e,a]),[u,d]=_.useState(!1);return t?E.jsx(A6,{title:a("a11y.user_menu"),showTitle:!1,align:"end",open:u,onOpenChange:d,trigger:E.jsx("button",{"aria-label":a("common.profile"),className:K9e.userButton,"data-testid":"usermenu_open",children:!t||n&&!o?E.jsx(tU,{}):E.jsx(Zp,{id:r,name:i,size:Xp.SM,src:o})}),children:c.map((({key:e,icon:t,label:n,dataTestid:r})=>E.jsx(Sp,{Icon:t,label:n,"data-test-id":r,onSelect:()=>s(e)},e)))}):E.jsx(T4,{to:{pathname:"/login"},state:{from:l},children:a("log_in")})},A4=({preventNavigation:e=!1})=>{const t=di(),n=Aa(),{client:r,logout:i,authenticated:o,passwordlessUser:s}=k4(),{displayName:a,avatarUrl:l}=Yy(r),[c,u]=_.useState(!1),d=_.useCallback((()=>u(!1)),[u]),[h,p]=_.useState(O4),f=_.useCallback((e=>{var r;switch(e){case"user":p("profile"),u(!0);break;case"settings":p("audio"),u(!0);break;case"logout":null==i||i();break;case"login":null==(r=n("/login",{state:{from:t}}))||r.catch((e=>A.error("Failed to navigate to login",e)))}}),[n,t,i,u]),m=(null==r?void 0:r.getUserIdLocalpart())??"";return E.jsxs(E.Fragment,{children:[E.jsx(G9e,{preventNavigation:e,isAuthenticated:o,isPasswordlessUser:s,avatarUrl:l,onAction:f,userId:(null==r?void 0:r.getUserId())??"",displayName:a||(m?m.replace("@",""):"")}),r&&E.jsx(M4,{client:r,open:c,onDismiss:d,tab:h,onTabChange:p})]})};function W9e(e){return new Worker(""+new URL("IndexedDBWorker-whz4J8_U.js",import.meta.url).href,{name:null==e?void 0:e.name})}const Mb=new xP,z9e=e=>{const[t,n]=_.useState((()=>localStorage.getItem(e)));return _.useEffect((()=>(Mb.on(e,n),()=>{Mb.off(e,n)})),[e,n]),[t,_.useCallback((t=>{n(t),localStorage.setItem(e,t),Mb.emit(e,t)}),[e,n])]},Y9e=(e,t)=>{localStorage.setItem(e,t),Mb.emit(e,t)};function PQ(e,t){Y9e(N4(e),t)}const N4=e=>`room-shared-key-${e}`,J9e=e=>{const t=N4(e);return z9e(t)[0]};function X9e(e){LQ(Jr());const t=N4(e);return localStorage.getItem(t)}function LQ(e){!e.password||!e.roomId||PQ(e.roomId,e.password)}const Z9e=()=>{const e=Lu();return _.useEffect((()=>LQ(e)),[e]),e.roomId&&e.password?[e.roomId,e.password]:[void 0,void 0]};function Jy(e){const{client:t}=cf(),[n,r]=Z9e(),i=J9e(e),o=null==t?void 0:t.getRoom(e);return _.useMemo((()=>o?i?{kind:Ut.SHARED_KEY,secret:i}:n===e?{kind:Ut.SHARED_KEY,secret:r}:o.hasEncryptionStateEvent()?{kind:Ut.PER_PARTICIPANT}:{kind:Ut.NONE}:{kind:Ut.NONE}),[r,o,e,i,n])}const nU=!1,Q9e="element-call-sync";async function e7e(e){let t=!!await e.store.getSavedSyncToken();return new Promise(((n,r)=>{const i=(o,s,a)=>{"PREPARED"===o?t?t=!1:(e.removeListener(Oe.Sync,i),n()):"ERROR"===o&&(e.removeListener(Oe.Sync,i),r(null==a?void 0:a.error))};e.on(Oe.Sync,i)}))}async function OQ(e,t){var n;let r;try{r=window.indexedDB}catch(e){A.warn("Could not get indexDB from window.",e)}const i={fallbackICEServerAllowed:nU,isVoipWithNoMediaAllowed:null==(n=Bt.get().features)?void 0:n.feature_group_calls_without_video_and_audio};r&&localStorage?i.store=new nB({indexedDB:window.indexedDB,localStorage,dbName:Q9e,workerFactory:()=>new W9e}):localStorage&&(i.store=new Ov({localStorage}));const{e2eEnabled:o}=Jr();o||A.info("Disabling E2E: group call signalling will NOT be encrypted.");const s=FE({...i,...e,useAuthorizationHeader:!0,localTimeoutMs:5e3,useE2eForGroupCall:o,fallbackICEServerAllowed:nU});t||await s.clearStores();try{await s.store.startup()}catch(e){A.error("Error starting matrix client indexDB store. Falling back to memory store.",e),s.store=new Ov({localStorage}),await s.store.startup()}try{await s.initRustCrypto()}catch(e){A.warn(e,"Make sure to clear client stores before initializing the rust crypto.")}const a=e7e(s);return await s.startClient({clientWellKnownPollPeriod:600}),await a,s}function Xy(e){return e.trim().replace(/\s/g,"-").replace(/[^\w-]/g,"").toLowerCase()}function t7e(e,t){return`#${Xy(e)}:${t.getDomain()}`}function MQ(e){const t=e.split(":",2);if(2===t.length&&"#"===t[0][0]){if(t[1]===Bt.defaultServerName())return t[0];throw new Error("Unsupported remote room alias")}return e}async function AQ(e,t,n){A.log("Creating room for group call");const r=e.createRoom({visibility:_H.Private,preset:ME.PublicChat,name:t,room_alias_name:n?void 0:Xy(t),power_level_content_override:{invite:100,kick:100,ban:100,redact:50,state_default:0,events_default:0,users_default:0,events:{"m.room.power_levels":100,"m.room.history_visibility":100,"m.room.tombstone":100,"m.room.encryption":100,"m.room.name":50,"m.room.message":0,"m.room.encrypted":50,"m.sticker":50,"org.matrix.msc3401.call.member":0},users:{[e.getUserId()]:100}}}),i=await new Promise(((t,n)=>{r.catch((e=>{n(e),o()}));const i=e=>{r.then((n=>{e.roomId===n.room_id&&(t(e.roomId),o())}),(e=>{A.error("Failed to wait for the room to arrive",e)}))},o=()=>{e.off(Oe.Room,i)};e.on(Oe.Room,i)}));let o;return n==Ut.SHARED_KEY&&(o=mH(16),PQ(i,o)),{roomId:i,alias:n?void 0:t7e(t,e),password:o}}function NQ(e,t,n,r){return`${window.location.protocol}//${window.location.host}${Bw(e,t,n)}`}function Bw(e,t,n,r){return`/room/#${n?"/"+Xy(n):""}?${T3e(e,t).toString()}`}async function n7e(e){let t=0;for(;;)try{return await e()}catch(e){t++;const n=$P(e,t,!0);if(n<0)throw e;await su(n)}}const D4=e=>{const[t,n]=_.useState(void 0),[r,i]=_.useState(void 0),o=_.useRef(void 0);o.current||(o.current=FE({baseUrl:Bt.defaultHomeserverUrl()})),_.useEffect((()=>{Ge||o.current.registerRequest({}).catch((e=>{var t,r,o,s,a,l,c;n(null==(a=null==(s=null==(o=null==(r=null==(t=e.data)?void 0:t.params["m.login.terms"])?void 0:r.policies)?void 0:o.privacy_policy)?void 0:s.en)?void 0:a.url),i(null==(c=null==(l=e.data)?void 0:l.params["m.login.recaptcha"])?void 0:c.public_key)}))}),[]);return{privacyPolicyUrl:t,recaptchaKey:r,register:_.useCallback((async(t,n,r,i,s)=>{const a=new sL({matrixClient:o.current,doRequest:async e=>o.current.registerRequest({username:t,password:n,auth:e||void 0}),stateUpdated:(e,t)=>{if(t.error)throw new Error(t.error);"m.login.terms"===e?a.submitAuthDict({type:"m.login.terms"}).catch((e=>{A.error(e)})):"m.login.recaptcha"===e&&a.submitAuthDict({type:"m.login.recaptcha",response:i}).catch((e=>{A.error(e)}))},requestEmailToken:async()=>Promise.resolve({sid:"dummy"})}),{user_id:l,access_token:c,device_id:u}=await a.attemptAuth();await(null==e?void 0:e.logout(!0));const d=await OQ({baseUrl:Bt.defaultHomeserverUrl(),accessToken:c,userId:l,deviceId:u},!1);await d.setDisplayName(r);const h={user_id:l,device_id:u,access_token:c,passwordlessUser:s};s&&(h.tempPassword=n);const p=d.getUser(d.getUserId());return p.setRawDisplayName(r),p.setDisplayName(r),[d,h]}),[e])}},r7e="_buttons_1arp2_8",i7e={buttons:r7e},DQ=({onJoin:e,open:t,onDismiss:n})=>{const{t:r}=ze();return E.jsxs(lf,{title:r("join_existing_call_modal.title"),open:t,onDismiss:n,children:[E.jsx("p",{children:r("join_existing_call_modal.text")}),E.jsxs(vt,{rightAlign:!0,className:i7e.buttons,children:[E.jsx(At,{onClick:n,children:r("action.no")}),E.jsx(At,{onClick:e,"data-testid":"home_joinExistingRoom",children:r("join_existing_call_modal.join_button")})]})]})},rU="https://www.recaptcha.net/recaptcha/api.js?onload=mxOnRecaptchaLoaded&render=explicit";function j4(e){const{t}=ze(),[n]=_.useState((()=>_s(16))),r=_.useRef(void 0);_.useEffect((()=>{var t;if(!e)return;const i=()=>{document.getElementById(n)&&window.grecaptcha.render(n,{sitekey:e,size:"invisible",callback:e=>{var t;return null==(t=r.current)?void 0:t.resolve(e)},"error-callback":()=>{var e;return null==(e=r.current)?void 0:e.reject(new Error)}})};if("function"==typeof(null==(t=window.grecaptcha)?void 0:t.render))i();else if(window.mxOnRecaptchaLoaded=i,!document.querySelector(`script[src="${rU}"]`)){const e=document.createElement("script");e.src=rU,e.async=!0,document.body.appendChild(e)}}),[n,e]);return{execute:_.useCallback((async()=>e?window.grecaptcha?new Promise(((e,n)=>{var i,o;const s=new MutationObserver((e=>{var r,i;for(const o of e)if("visible"!==(null==(i=null==(r=o.target)?void 0:r.style)?void 0:i.visibility))return n(Zj("recaptcha_dismissed",t)),void s.disconnect()}));r.current={resolve:t=>{e(t),s.disconnect()},reject:e=>{n(e),s.disconnect()}},window.grecaptcha.execute().then((()=>{}),(e=>{A.error("Recaptcha execution failed",e)}));const a=document.querySelector('iframe[src*="recaptcha/api2/bframe"]');null!=(i=null==a?void 0:a.parentNode)&&i.parentNode&&s.observe(null==(o=null==a?void 0:a.parentNode)?void 0:o.parentNode,{attributes:!0})})):(A.log("Recaptcha not loaded"),Promise.reject(Zj("recaptcha_not_loaded",t))):Promise.resolve("")),[e,t]),reset:_.useCallback((()=>{var e;null==(e=window.grecaptcha)||e.reset()}),[]),recaptchaId:n}}const s7e="_form_jcuzc_8",o7e={form:s7e},Vw=_.forwardRef((({children:e,className:t,onSubmit:n},r)=>E.jsx("form",{onSubmit:n,className:Ae(o7e.form,t),ref:r,children:e})));Vw.displayName="Form";const a7e="_footer_106jg_8",l7e="_mobileLoginLink_106jg_19",c7e="_form_106jg_24",u7e="_notice_106jg_40",bg={footer:a7e,mobileLoginLink:l7e,form:c7e,notice:u7e},d7e="_container_dwllg_8",f7e="_main_dwllg_15",h7e="_logo_dwllg_23",ep={container:d7e,main:f7e,logo:h7e},iU=e=>{e=1831565813+(e|=0)|0;let t=Math.imul(e^e>>>15,1|e);return t=t+Math.imul(t^t>>>7,61|t)^t,((t^t>>>14)>>>0)/4294967296};class p7e{constructor(e){this.dictionaries=void 0,this.length=void 0,this.separator=void 0,this.style=void 0,this.seed=void 0;const{length:t,separator:n,dictionaries:r,style:i,seed:o}=e;this.dictionaries=r,this.separator=n,this.length=t,this.style=i,this.seed=o}generate(){if(!this.dictionaries)throw new Error('Cannot find any dictionary. Please provide at least one, or leave the "dictionary" field empty in the config object');if(this.length<=0)throw new Error("Invalid length provided");if(this.length>this.dictionaries.length)throw new Error(`The length cannot be bigger than the number of dictionaries.\nLength provided: ${this.length}. Number of dictionaries provided: ${this.dictionaries.length}`);let e=this.seed;return this.dictionaries.slice(0,this.length).reduce(((t,n)=>{let r;e?(r=(e=>{if("string"==typeof e){const t=e.split("").map((e=>e.charCodeAt(0))).reduce(((e,t)=>e+t),1),n=Math.floor(Number(t));return iU(n)}return iU(e)})(e),e=4294967296*r):r=Math.random();let i=n[Math.floor(r*n.length)]||"";if("lowerCase"===this.style)i=i.toLowerCase();else if("capital"===this.style){const[e,...t]=i.split("");i=e.toUpperCase()+t.join("")}else"upperCase"===this.style&&(i=i.toUpperCase());return t?`${t}${this.separator}${i}`:`${i}`}),"")}}const sU={separator:"_",dictionaries:[]},m7e=e=>{const t=[...e&&e.dictionaries||sU.dictionaries],n={...sU,...e,length:e&&e.length||t.length,dictionaries:t};if(!e||!e.dictionaries||!e.dictionaries.length)throw new Error('A "dictionaries" array must be provided. This is a breaking change introduced starting from Unique Name Generator v4. Read more about the breaking change here: https://github.com/andreasonny83/unique-names-generator#migration-guide');return new p7e(n).generate()};var g7e=["able","above","absent","absolute","abstract","abundant","academic","acceptable","accepted","accessible","accurate","accused","active","actual","acute","added","additional","adequate","adjacent","administrative","adorable","advanced","adverse","advisory","aesthetic","afraid","aggregate","aggressive","agreeable","agreed","agricultural","alert","alive","alleged","allied","alone","alright","alternative","amateur","amazing","ambitious","amused","ancient","angry","annoyed","annual","anonymous","anxious","appalling","apparent","applicable","appropriate","arbitrary","architectural","armed","arrogant","artificial","artistic","ashamed","asleep","assistant","associated","atomic","attractive","automatic","autonomous","available","average","awake","aware","awful","awkward","back","bad","balanced","bare","basic","beautiful","beneficial","better","bewildered","big","binding","biological","bitter","bizarre","blank","blind","blonde","bloody","blushing","boiling","bold","bored","boring","bottom","brainy","brave","breakable","breezy","brief","bright","brilliant","broad","broken","bumpy","burning","busy","calm","capable","capitalist","careful","casual","causal","cautious","central","certain","changing","characteristic","charming","cheap","cheerful","chemical","chief","chilly","chosen","christian","chronic","chubby","circular","civic","civil","civilian","classic","classical","clean","clear","clever","clinical","close","closed","cloudy","clumsy","coastal","cognitive","coherent","cold","collective","colonial","colorful","colossal","coloured","colourful","combative","combined","comfortable","coming","commercial","common","communist","compact","comparable","comparative","compatible","competent","competitive","complete","complex","complicated","comprehensive","compulsory","conceptual","concerned","concrete","condemned","confident","confidential","confused","conscious","conservation","conservative","considerable","consistent","constant","constitutional","contemporary","content","continental","continued","continuing","continuous","controlled","controversial","convenient","conventional","convinced","convincing","cooing","cool","cooperative","corporate","correct","corresponding","costly","courageous","crazy","creative","creepy","criminal","critical","crooked","crowded","crucial","crude","cruel","cuddly","cultural","curious","curly","current","curved","cute","daily","damaged","damp","dangerous","dark","dead","deaf","deafening","dear","decent","decisive","deep","defeated","defensive","defiant","definite","deliberate","delicate","delicious","delighted","delightful","democratic","dependent","depressed","desirable","desperate","detailed","determined","developed","developing","devoted","different","difficult","digital","diplomatic","direct","dirty","disabled","disappointed","disastrous","disciplinary","disgusted","distant","distinct","distinctive","distinguished","disturbed","disturbing","diverse","divine","dizzy","domestic","dominant","double","doubtful","drab","dramatic","dreadful","driving","drunk","dry","dual","due","dull","dusty","dutch","dying","dynamic","eager","early","eastern","easy","economic","educational","eerie","effective","efficient","elaborate","elated","elderly","eldest","electoral","electric","electrical","electronic","elegant","eligible","embarrassed","embarrassing","emotional","empirical","empty","enchanting","encouraging","endless","energetic","enormous","enthusiastic","entire","entitled","envious","environmental","equal","equivalent","essential","established","estimated","ethical","ethnic","eventual","everyday","evident","evil","evolutionary","exact","excellent","exceptional","excess","excessive","excited","exciting","exclusive","existing","exotic","expected","expensive","experienced","experimental","explicit","extended","extensive","external","extra","extraordinary","extreme","exuberant","faint","fair","faithful","familiar","famous","fancy","fantastic","far","fascinating","fashionable","fast","fat","fatal","favourable","favourite","federal","fellow","female","feminist","few","fierce","filthy","final","financial","fine","firm","fiscal","fit","fixed","flaky","flat","flexible","fluffy","fluttering","flying","following","fond","foolish","foreign","formal","formidable","forthcoming","fortunate","forward","fragile","frail","frantic","free","frequent","fresh","friendly","frightened","front","frozen","full","fun","functional","fundamental","funny","furious","future","fuzzy","gastric","gay","general","generous","genetic","gentle","genuine","geographical","giant","gigantic","given","glad","glamorous","gleaming","global","glorious","golden","good","gorgeous","gothic","governing","graceful","gradual","grand","grateful","greasy","great","grieving","grim","gross","grotesque","growing","grubby","grumpy","guilty","handicapped","handsome","happy","hard","harsh","head","healthy","heavy","helpful","helpless","hidden","high","hilarious","hissing","historic","historical","hollow","holy","homeless","homely","hon","honest","horizontal","horrible","hostile","hot","huge","human","hungry","hurt","hushed","husky","icy","ideal","identical","ideological","ill","illegal","imaginative","immediate","immense","imperial","implicit","important","impossible","impressed","impressive","improved","inadequate","inappropriate","inc","inclined","increased","increasing","incredible","independent","indirect","individual","industrial","inevitable","influential","informal","inherent","initial","injured","inland","inner","innocent","innovative","inquisitive","instant","institutional","insufficient","intact","integral","integrated","intellectual","intelligent","intense","intensive","interested","interesting","interim","interior","intermediate","internal","international","intimate","invisible","involved","irrelevant","isolated","itchy","jealous","jittery","joint","jolly","joyous","judicial","juicy","junior","just","keen","key","kind","known","labour","large","late","latin","lazy","leading","left","legal","legislative","legitimate","lengthy","lesser","level","lexical","liable","liberal","light","like","likely","limited","linear","linguistic","liquid","literary","little","live","lively","living","local","logical","lonely","long","loose","lost","loud","lovely","low","loyal","ltd","lucky","mad","magic","magnetic","magnificent","main","major","male","mammoth","managerial","managing","manual","many","marginal","marine","marked","married","marvellous","marxist","mass","massive","mathematical","mature","maximum","mean","meaningful","mechanical","medical","medieval","melodic","melted","mental","mere","metropolitan","mid","middle","mighty","mild","military","miniature","minimal","minimum","ministerial","minor","miserable","misleading","missing","misty","mixed","moaning","mobile","moderate","modern","modest","molecular","monetary","monthly","moral","motionless","muddy","multiple","mushy","musical","mute","mutual","mysterious","naked","narrow","nasty","national","native","natural","naughty","naval","near","nearby","neat","necessary","negative","neighbouring","nervous","net","neutral","new","nice","noble","noisy","normal","northern","nosy","notable","novel","nuclear","numerous","nursing","nutritious","nutty","obedient","objective","obliged","obnoxious","obvious","occasional","occupational","odd","official","ok","okay","old","olympic","only","open","operational","opposite","optimistic","oral","ordinary","organic","organisational","original","orthodox","other","outdoor","outer","outrageous","outside","outstanding","overall","overseas","overwhelming","painful","pale","panicky","parallel","parental","parliamentary","partial","particular","passing","passive","past","patient","payable","peaceful","peculiar","perfect","permanent","persistent","personal","petite","philosophical","physical","plain","planned","plastic","pleasant","pleased","poised","polite","political","poor","popular","positive","possible","potential","powerful","practical","precious","precise","preferred","pregnant","preliminary","premier","prepared","present","presidential","pretty","previous","prickly","primary","prime","primitive","principal","printed","prior","private","probable","productive","professional","profitable","profound","progressive","prominent","promising","proper","proposed","prospective","protective","protestant","proud","provincial","psychiatric","psychological","public","puny","pure","purring","puzzled","quaint","qualified","quarrelsome","querulous","quick","quickest","quiet","quintessential","quixotic","racial","radical","rainy","random","rapid","rare","raspy","rational","ratty","raw","ready","real","realistic","rear","reasonable","recent","reduced","redundant","regional","registered","regular","regulatory","related","relative","relaxed","relevant","reliable","relieved","religious","reluctant","remaining","remarkable","remote","renewed","representative","repulsive","required","resident","residential","resonant","respectable","respective","responsible","resulting","retail","retired","revolutionary","rich","ridiculous","right","rigid","ripe","rising","rival","roasted","robust","rolling","romantic","rotten","rough","round","royal","rubber","rude","ruling","running","rural","sacred","sad","safe","salty","satisfactory","satisfied","scared","scary","scattered","scientific","scornful","scrawny","screeching","secondary","secret","secure","select","selected","selective","selfish","semantic","senior","sensible","sensitive","separate","serious","severe","sexual","shaggy","shaky","shallow","shared","sharp","sheer","shiny","shivering","shocked","short","shrill","shy","sick","significant","silent","silky","silly","similar","simple","single","skilled","skinny","sleepy","slight","slim","slimy","slippery","slow","small","smart","smiling","smoggy","smooth","social","socialist","soft","solar","sole","solid","sophisticated","sore","sorry","sound","sour","southern","soviet","spare","sparkling","spatial","special","specific","specified","spectacular","spicy","spiritual","splendid","spontaneous","sporting","spotless","spotty","square","squealing","stable","stale","standard","static","statistical","statutory","steady","steep","sticky","stiff","still","stingy","stormy","straight","straightforward","strange","strategic","strict","striking","striped","strong","structural","stuck","stupid","subjective","subsequent","substantial","subtle","successful","successive","sudden","sufficient","suitable","sunny","super","superb","superior","supporting","supposed","supreme","sure","surprised","surprising","surrounding","surviving","suspicious","sweet","swift","symbolic","sympathetic","systematic","tall","tame","tart","tasteless","tasty","technical","technological","teenage","temporary","tender","tense","terrible","territorial","testy","then","theoretical","thick","thin","thirsty","thorough","thoughtful","thoughtless","thundering","tight","tiny","tired","top","tory","total","tough","toxic","traditional","tragic","tremendous","tricky","tropical","troubled","typical","ugliest","ugly","ultimate","unable","unacceptable","unaware","uncertain","unchanged","uncomfortable","unconscious","underground","underlying","unemployed","uneven","unexpected","unfair","unfortunate","unhappy","uniform","uninterested","unique","united","universal","unknown","unlikely","unnecessary","unpleasant","unsightly","unusual","unwilling","upper","upset","uptight","urban","urgent","used","useful","useless","usual","vague","valid","valuable","variable","varied","various","varying","vast","verbal","vertical","very","vicarious","vicious","victorious","violent","visible","visiting","visual","vital","vitreous","vivacious","vivid","vocal","vocational","voiceless","voluminous","voluntary","vulnerable","wandering","warm","wasteful","watery","weak","wealthy","weary","wee","weekly","weird","welcome","well","western","wet","whispering","whole","wicked","wide","widespread","wild","wilful","willing","willowy","wily","wise","wispy","wittering","witty","wonderful","wooden","working","worldwide","worried","worrying","worthwhile","worthy","written","wrong","xenacious","xenial","xenogeneic","xenophobic","xeric","xerothermic","yabbering","yammering","yappiest","yappy","yawning","yearling","yearning","yeasty","yelling","yelping","yielding","yodelling","young","youngest","youthful","ytterbic","yucky","yummy","zany","zealous","zeroth","zestful","zesty","zippy","zonal","zoophagous","zygomorphic","zygotic"],v7e=["aardvark","aardwolf","albatross","alligator","alpaca","amphibian","anaconda","angelfish","anglerfish","ant","anteater","antelope","antlion","ape","aphid","armadillo","asp","baboon","badger","bandicoot","barnacle","barracuda","basilisk","bass","bat","bear","beaver","bedbug","bee","beetle","bird","bison","blackbird","boa","boar","bobcat","bobolink","bonobo","booby","bovid","bug","butterfly","buzzard","camel","canid","canidae","capybara","cardinal","caribou","carp","cat","caterpillar","catfish","catshark","cattle","centipede","cephalopod","chameleon","cheetah","chickadee","chicken","chimpanzee","chinchilla","chipmunk","cicada","clam","clownfish","cobra","cockroach","cod","condor","constrictor","coral","cougar","cow","coyote","crab","crane","crawdad","crayfish","cricket","crocodile","crow","cuckoo","damselfly","deer","dingo","dinosaur","dog","dolphin","donkey","dormouse","dove","dragon","dragonfly","duck","eagle","earthworm","earwig","echidna","eel","egret","elephant","elk","emu","ermine","falcon","felidae","ferret","finch","firefly","fish","flamingo","flea","fly","flyingfish","fowl","fox","frog","galliform","gamefowl","gayal","gazelle","gecko","gerbil","gibbon","giraffe","goat","goldfish","goose","gopher","gorilla","grasshopper","grouse","guan","guanaco","guineafowl","gull","guppy","haddock","halibut","hamster","hare","harrier","hawk","hedgehog","heron","herring","hippopotamus","hookworm","hornet","horse","hoverfly","hummingbird","hyena","iguana","impala","jackal","jaguar","jay","jellyfish","junglefowl","kangaroo","kingfisher","kite","kiwi","koala","koi","krill","ladybug","lamprey","landfowl","lark","leech","lemming","lemur","leopard","leopon","limpet","lion","lizard","llama","lobster","locust","loon","louse","lungfish","lynx","macaw","mackerel","magpie","mammal","manatee","mandrill","marlin","marmoset","marmot","marsupial","marten","mastodon","meadowlark","meerkat","mink","minnow","mite","mockingbird","mole","mollusk","mongoose","monkey","moose","mosquito","moth","mouse","mule","muskox","narwhal","newt","nightingale","ocelot","octopus","opossum","orangutan","orca","ostrich","otter","owl","ox","panda","panther","parakeet","parrot","parrotfish","partridge","peacock","peafowl","pelican","penguin","perch","pheasant","pig","pigeon","pike","pinniped","piranha","planarian","platypus","pony","porcupine","porpoise","possum","prawn","primate","ptarmigan","puffin","puma","python","quail","quelea","quokka","rabbit","raccoon","rat","rattlesnake","raven","reindeer","reptile","rhinoceros","roadrunner","rodent","rook","rooster","roundworm","sailfish","salamander","salmon","sawfish","scallop","scorpion","seahorse","shark","sheep","shrew","shrimp","silkworm","silverfish","skink","skunk","sloth","slug","smelt","snail","snake","snipe","sole","sparrow","spider","spoonbill","squid","squirrel","starfish","stingray","stoat","stork","sturgeon","swallow","swan","swift","swordfish","swordtail","tahr","takin","tapir","tarantula","tarsier","termite","tern","thrush","tick","tiger","tiglon","toad","tortoise","toucan","trout","tuna","turkey","turtle","tyrannosaurus","unicorn","urial","vicuna","viper","vole","vulture","wallaby","walrus","warbler","wasp","weasel","whale","whippet","whitefish","wildcat","wildebeest","wildfowl","wolf","wolverine","wombat","woodpecker","worm","wren","xerinae","yak","zebra"],y7e=["amaranth","amber","amethyst","apricot","aqua","aquamarine","azure","beige","black","blue","blush","bronze","brown","chocolate","coffee","copper","coral","crimson","cyan","emerald","fuchsia","gold","gray","green","harlequin","indigo","ivory","jade","lavender","lime","magenta","maroon","moccasin","olive","orange","peach","pink","plum","purple","red","rose","salmon","sapphire","scarlet","silver","tan","teal","tomato","turquoise","violet","white","yellow"];const _7e=["hydrogen","helium","lithium","beryllium","boron","carbon","nitrogen","oxygen","fluorine","neon","sodium","magnesium","aluminum","silicon","phosphorus","sulfur","chlorine","argon","potassium","calcium","scandium","titanium","vanadium","chromium","manganese","iron","cobalt","nickel","copper","zinc","gallium","germanium","arsenic","selenium","bromine","krypton","rubidium","strontium","yttrium","zirconium","niobium","molybdenum","technetium","ruthenium","rhodium","palladium","silver","cadmium","indium","tin","antimony","tellurium","iodine","xenon","cesium","barium","lanthanum","cerium","praseodymium","neodymium","promethium","samarium","europium","gadolinium","terbium","dysprosium","holmium","erbium","thulium","ytterbium","lutetium","hafnium","tantalum","wolfram","rhenium","osmium","iridium","platinum","gold","mercury","thallium","lead","bismuth","polonium","astatine","radon","francium","radium","actinium","thorium","protactinium","uranium","neptunium","plutonium","americium","curium","berkelium","californium","einsteinium","fermium","mendelevium","nobelium","lawrencium","rutherfordium","dubnium","seaborgium","bohrium","hassium","meitnerium","darmstadtium","roentgenium","copernicium","nihonium","flerovium","moscovium","livermorium","tennessine","oganesson"];function jQ(){return m7e({dictionaries:[y7e,g7e,v7e,_7e],style:"lowerCase",length:3,separator:"-"})}const b7e=()=>{const{setClient:e}=cf(),[t,n]=_.useState(!1),[r,i]=_.useState(),[o]=Nw(),{recaptchaKey:s,register:a}=D4(),{execute:l,reset:c,recaptchaId:u}=j4(s),[d,h]=_.useState(!1),p=_.useCallback((()=>h(!1)),[h]),[f,m]=_.useState(),v=Aa(),{t:g}=ze(),y=_.useCallback((t=>{t.preventDefault();const r=new FormData(t.target),o=MQ(r.get("callName")),s=r.get("displayName");(async function(){i(void 0),n(!0);const t=await l(),r=jQ(),[c,u]=await a(r,_s(16),s,t,!0);let d;try{d=await AQ(c,o,Ut.SHARED_KEY)}catch(t){if(!e)throw t;if("M_ROOM_IN_USE"===t.errcode)return m((()=>{var t;e(c,u);const n=Xy(o);null==(t=v(`/${n}`))||t.catch((e=>{A.error("Failed to navigate to alias localpart",e)}))})),n(!1),void h(!0);throw t}if(!e)throw new Error("setClient is undefined");if(!d.password)throw new Error("Failed to create room with shared secret");e(c,u),await v(Bw(d.roomId,{kind:Ut.SHARED_KEY,secret:d.password},o))})().catch((e=>{A.error(e),n(!1),i(e),c()}))}),[a,c,l,v,h,e]);return E.jsxs(E.Fragment,{children:[E.jsxs("div",{className:ep.container,children:[E.jsxs(Pu,{children:[E.jsx(sf,{children:E.jsx(Vd,{})}),E.jsx(of,{hideMobile:!0,children:E.jsx(A4,{})})]}),E.jsxs("main",{className:ep.main,children:[E.jsx(Vd,{className:ep.logo}),E.jsx(xu,{size:"lg",weight:"semibold",children:g("start_new_call")}),E.jsxs(Vw,{className:bg.form,onSubmit:y,children:[E.jsx(vt,{children:E.jsx(_n,{id:"callName",name:"callName",label:g("call_name"),placeholder:g("call_name"),type:"text",required:!0,autoComplete:"off","data-testid":"home_callName"})}),E.jsx(vt,{children:E.jsx(_n,{id:"displayName",name:"displayName",label:g("common.display_name"),placeholder:g("common.display_name"),type:"text",required:!0,"data-testid":"home_displayName",autoComplete:"off"})}),null===o&&E.jsx(Jt,{size:"sm",className:bg.notice,children:E.jsx(hQ,{})}),E.jsx(Jt,{size:"sm",className:bg.notice,children:E.jsxs(Zi,{i18nKey:"unauthenticated_view_ssla_caption",children:['By clicking "Go", you agree to our'," ",E.jsx(Pd,{href:Bt.get().ssla,children:"Software and Services License Agreement (SSLA)"})]})}),r&&E.jsx(vt,{children:E.jsx(Mu,{error:r})}),E.jsx(At,{type:"submit",size:"lg",disabled:t,"data-testid":"home_go",children:g(t?"common.loading":"action.go")}),E.jsx("div",{id:u})]})]}),E.jsxs("footer",{className:bg.footer,children:[E.jsx(Jt,{className:bg.mobileLoginLink,children:E.jsx(Ia,{to:"/login","data-testid":"home_login",children:g("unauthenticated_view_login_button")})}),E.jsx(Jt,{children:E.jsxs(Zi,{i18nKey:"unauthenticated_view_body",children:["Not registered yet?"," ",E.jsx(Ia,{to:"/register","data-testid":"home_register",children:"Create an account"})]})})]})]}),f&&E.jsx(DQ,{onJoin:f,open:d,onDismiss:p})]})},rh={};function oU(e,t){if(rh[t.roomId])return rh[t.roomId];if(!t||!t.timeline){const e=Number.MAX_SAFE_INTEGER;return rh[t.roomId]=e,e}const n=e.getUserId();if(t.getMyMembership()!==Ke.Join){const e=t.currentState.getStateEvents("m.room.member",n);if(e&&!Array.isArray(e)){const n=e.getTs();return rh[t.roomId]=n,n}}for(let e=t.timeline.length-1;e>=0;--e){const n=t.timeline[e].getTs();if(n)return rh[t.roomId]=n,n}const r=Number.MAX_SAFE_INTEGER;return rh[t.roomId]=r,r}function S7e(e,t){return t.sort(((t,n)=>oU(e,n)-oU(e,t)))}const E7e=e=>{var t,n;if(!e.hasEncryptionStateEvent()&&!X9e(e.roomId))return!1;switch(e.getJoinRule()){case Jc.Public:return!0;case Jc.Knock:switch(e.getMyMembership()){case Ke.Join:case Ke.Knock:return!0;case Ke.Invite:return(null==(n=null==(t=e.getLiveTimeline().getState(Le.FORWARDS))?void 0:t.getStateEvents(ee.RoomMember,e.myUserId))?void 0:n.getPrevContent().membership)===Jc.Knock;default:return!1}default:return e.getMyMembership()===Ke.Join}},w7e=e=>{var t,n;switch(e.getMyMembership()){case Ke.Join:return!(null==(n=null==(t=e.getLiveTimeline().getState(Le.FORWARDS))?void 0:t.events)||!n.get(ee.GroupCallMemberPrefix));case Ke.Knock:return!0;default:return!1}};function C7e(e){const[t,n]=_.useState([]);return _.useEffect((()=>{function t(){const t=e.getRooms().filter(w7e).filter(E7e),r=S7e(e,t).map((t=>{const n=e.matrixRTC.getRoomSession(t);return{roomAlias:t.getCanonicalAlias()??void 0,roomName:t.name,avatarUrl:t.getMxcAvatarUrl(),room:t,session:n,participants:n.memberships.filter((e=>e.sender)).map((e=>t.getMember(e.sender))).filter((e=>e))}}));n(r)}return t(),e.matrixRTC.on(Qb.SessionStarted,t),e.on(ke.MyMembership,t),()=>{e.matrixRTC.off(Qb.SessionStarted,t),e.off(ke.MyMembership,t)}}),[e]),t}const T7e="_form_1vjc2_8",R7e="_fieldRow_1vjc2_16",I7e="_button_1vjc2_24",k7e="_notice_1vjc2_32",Sg={form:T7e,fieldRow:R7e,button:I7e,notice:k7e},x7e="_callTileSpacer_l4ywf_8",P7e="_callTile_l4ywf_8",L7e="_callTileLink_l4ywf_28",O7e="_callInfo_l4ywf_40",M7e="_callName_l4ywf_53",A7e="_callList_l4ywf_63",N7e="_disabled_l4ywf_74",dl={callTileSpacer:x7e,callTile:P7e,callTileLink:L7e,callInfo:O7e,callName:M7e,callList:A7e,disabled:N7e},D7e=({rooms:e,client:t})=>E.jsx(E.Fragment,{children:E.jsxs("div",{className:dl.callList,children:[e.map((({room:e,roomName:n,avatarUrl:r,participants:i})=>E.jsx(j7e,{client:t,name:n,avatarUrl:r,room:e,participants:i},e.roomId))),e.length>3&&E.jsxs(E.Fragment,{children:[E.jsx("div",{className:dl.callTileSpacer}),E.jsx("div",{className:dl.callTileSpacer})]})]})}),j7e=({name:e,avatarUrl:t,room:n,client:r})=>{const{t:i}=ze(),o=Jy(n.roomId),[s,a]=_.useState(!1),l=_.useCallback((e=>{e.stopPropagation(),e.preventDefault(),a(!0),r.leave(n.roomId).catch((()=>a(!1)))}),[n,r]),c=E.jsxs(E.Fragment,{children:[E.jsx(Zp,{id:n.roomId,name:e,size:Xp.LG,src:t}),E.jsx("div",{className:dl.callInfo,children:E.jsx(Jt,{weight:"semibold",className:dl.callName,children:e})}),E.jsx(PG,{onClick:l,disabled:s,"aria-label":i("action.remove"),children:E.jsx(lw,{})})]});return E.jsx("div",{className:dl.callTile,children:s?E.jsx("span",{className:Ae(dl.callTileLink,dl.disabled),children:c}):E.jsx(zE,{to:Bw(n.roomId,o,n.name),className:dl.callTileLink,children:c})})},U7e=({client:e})=>{const[t,n]=_.useState(!1),[r,i]=_.useState(),[o]=Nw(),s=Aa(),{t:a}=ze(),[l,c]=_.useState(!1),u=_.useCallback((()=>c(!1)),[c]),d=_.useCallback((t=>{t.preventDefault();const r=new FormData(t.target).get("callName"),o="string"==typeof r?MQ(r):"";(async function(){i(void 0),n(!0);const t=await AQ(e,o,Ut.SHARED_KEY);if(!t.password)throw new Error("Failed to create room with shared secret");await s(Bw(t.roomId,{kind:Ut.SHARED_KEY,secret:t.password},o))})().catch((e=>{"M_ROOM_IN_USE"===e.errcode?(f(Xy(o)),n(!1),i(void 0),c(!0)):(A.error(e),n(!1),i(e))}))}),[e,s,c]),h=C7e(e),[p,f]=_.useState(),m=_.useCallback((()=>{var e;null==(e=s(`/${p}`))||e.catch((e=>{A.error("Failed to navigate to existing alias",e)}))}),[s,p]);return E.jsxs(E.Fragment,{children:[E.jsxs("div",{className:ep.container,children:[E.jsxs(Pu,{children:[E.jsx(sf,{children:E.jsx(Vd,{})}),E.jsx(of,{children:E.jsx(A4,{})})]}),E.jsxs("main",{className:ep.main,children:[E.jsx(Vd,{className:ep.logo}),E.jsx(xu,{size:"lg",weight:"semibold",children:a("start_new_call")}),E.jsxs(Vw,{className:Sg.form,onSubmit:d,children:[E.jsxs(vt,{className:Sg.fieldRow,children:[E.jsx(_n,{id:"callName",name:"callName",label:a("call_name"),placeholder:a("call_name"),type:"text",required:!0,autoComplete:"off","data-testid":"home_callName"}),E.jsx(At,{type:"submit",size:"lg",className:Sg.button,disabled:t,"data-testid":"home_go",children:a(t?"common.loading":"action.go")})]}),null===o&&E.jsx(Jt,{size:"sm",className:Sg.notice,children:E.jsx(hQ,{})}),r&&E.jsx(vt,{className:Sg.fieldRow,children:E.jsx(Mu,{error:r})})]}),h.length>0&&E.jsx(D7e,{rooms:h,client:e})]})]}),E.jsx(DQ,{onJoin:m,open:l,onDismiss:u})]})};function Zy(e){_.useEffect((()=>{const t="Element Call";document.title=e?`${t} | ${e}`:t}),[e])}const UQ=()=>{const{t:e}=ze();Zy(e("common.home"));const t=nm();return t?"error"===t.state?E.jsx(uy,{widget:Ge,error:t.error}):t.authenticated?E.jsx(U7e,{client:t.authenticated.client}):E.jsx(b7e,{}):E.jsx(Fw,{})},F7e=(e,t)=>_.createElement("svg",{width:300,height:66,viewBox:"0 0 300 66",fill:"none",xmlns:"http://www.w3.org/2000/svg",ref:t,...e},_.createElement("circle",{cx:32.6901,cy:32.6904,r:23.496,fill:"white"}),_.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M32.6137 65.2274C50.6257 65.2274 65.2274 50.6257 65.2274 32.6137C65.2274 14.6016 50.6257 0 32.6137 0C14.6016 0 0 14.6016 0 32.6137C0 50.6257 14.6016 65.2274 32.6137 65.2274ZM26.6511 15.1961C26.6511 13.8796 27.7205 12.8124 29.0397 12.8124C37.9808 12.8124 45.2291 20.0456 45.2291 28.9681C45.2291 30.2846 44.1596 31.3518 42.8405 31.3518C41.5213 31.3518 40.4519 30.2846 40.4519 28.9681C40.4519 22.6785 35.3425 17.5797 29.0397 17.5797C27.7205 17.5797 26.6511 16.5125 26.6511 15.1961ZM52.4139 28.9683C52.4139 27.6518 51.3445 26.5846 50.0253 26.5846C48.7061 26.5846 47.6367 27.6518 47.6367 28.9683C47.6367 35.2579 42.5274 40.3567 36.2246 40.3567C34.9054 40.3567 33.836 41.4239 33.836 42.7404C33.836 44.0568 34.9054 45.124 36.2246 45.124C45.1657 45.124 52.4139 37.8909 52.4139 28.9683ZM38.6134 50.031C38.6134 51.3475 37.544 52.4146 36.2248 52.4146C27.2837 52.4146 20.0355 45.1815 20.0355 36.2589C20.0355 34.9425 21.1049 33.8753 22.4241 33.8753C23.7432 33.8753 24.8127 34.9425 24.8127 36.2589C24.8127 42.5486 29.922 47.6474 36.2248 47.6474C37.544 47.6474 38.6134 48.7146 38.6134 50.031ZM12.8113 36.2589C12.8113 37.5754 13.8808 38.6426 15.1999 38.6426C16.5191 38.6426 17.5885 37.5754 17.5885 36.2589C17.5885 29.9693 22.6979 24.8705 29.0007 24.8705C30.3198 24.8705 31.3893 23.8033 31.3893 22.4869C31.3893 21.1704 30.3198 20.1032 29.0007 20.1032C20.0595 20.1032 12.8113 27.3364 12.8113 36.2589Z",fill:"#0DBD8B"}),_.createElement("path",{d:"M114.73 36.9816H91.7256C91.9974 39.3888 92.871 41.3107 94.3464 42.7472C95.8217 44.1449 97.763 44.8438 100.17 44.8438C101.762 44.8438 103.199 44.4555 104.48 43.679C105.761 42.9025 106.674 41.8542 107.217 40.5341H114.206C113.274 43.6014 111.527 46.0862 108.964 47.9887C106.441 49.8523 103.451 50.7842 99.9955 50.7842C95.4917 50.7842 91.8421 49.2894 89.0466 46.2998C86.29 43.3102 84.9117 39.5247 84.9117 34.9432C84.9117 30.4783 86.3094 26.7316 89.1049 23.7032C91.9003 20.6747 95.5111 19.1605 99.9373 19.1605C104.363 19.1605 107.935 20.6553 110.653 23.6449C113.41 26.5957 114.788 30.323 114.788 34.8267L114.73 36.9816ZM99.9373 24.8097C97.763 24.8097 95.9576 25.4503 94.5211 26.7316C93.0845 28.0128 92.1915 29.7212 91.8421 31.8566H107.916C107.605 29.7212 106.751 28.0128 105.353 26.7316C103.956 25.4503 102.15 24.8097 99.9373 24.8097Z",fill:"white"}),_.createElement("path",{d:"M119.557 41.0583V6.40625H126.488V41.1748C126.488 42.7278 127.342 43.5043 129.05 43.5043L130.273 43.4461V50.0271C129.613 50.1435 128.914 50.2018 128.177 50.2018C125.187 50.2018 122.993 49.4447 121.596 47.9305C120.237 46.4163 119.557 44.1255 119.557 41.0583Z",fill:"white"}),_.createElement("path",{d:"M162.549 36.9816H139.545C139.817 39.3888 140.69 41.3107 142.166 42.7472C143.641 44.1449 145.582 44.8438 147.99 44.8438C149.582 44.8438 151.018 44.4555 152.299 43.679C153.581 42.9025 154.493 41.8542 155.037 40.5341H162.025C161.093 43.6014 159.346 46.0862 156.784 47.9887C154.26 49.8523 151.27 50.7842 147.815 50.7842C143.311 50.7842 139.662 49.2894 136.866 46.2998C134.109 43.3102 132.731 39.5247 132.731 34.9432C132.731 30.4783 134.129 26.7316 136.924 23.7032C139.72 20.6747 143.331 19.1605 147.757 19.1605C152.183 19.1605 155.755 20.6553 158.473 23.6449C161.229 26.5957 162.608 30.323 162.608 34.8267L162.549 36.9816ZM147.757 24.8097C145.582 24.8097 143.777 25.4503 142.341 26.7316C140.904 28.0128 140.011 29.7212 139.662 31.8566H155.735C155.425 29.7212 154.571 28.0128 153.173 26.7316C151.775 25.4503 149.97 24.8097 147.757 24.8097Z",fill:"white"}),_.createElement("path",{d:"M193.817 32.7302V50.0853H186.887V31.973C186.887 27.3916 184.984 25.1009 181.179 25.1009C179.122 25.1009 177.471 25.7609 176.229 27.081C175.025 28.4011 174.424 30.2065 174.424 32.4972V50.0853H167.493V19.8594H173.9V23.8779C174.637 22.519 175.763 21.393 177.277 20.5C178.792 19.607 180.675 19.1605 182.927 19.1605C187.12 19.1605 190.148 20.7524 192.012 23.9361C194.574 20.7524 197.991 19.1605 202.262 19.1605C205.795 19.1605 208.513 20.2671 210.415 22.4801C212.318 24.6544 213.269 27.5275 213.269 31.0995V50.0853H206.338V31.973C206.338 27.3916 204.436 25.1009 200.631 25.1009C198.535 25.1009 196.865 25.7803 195.623 27.1392C194.419 28.4593 193.817 30.323 193.817 32.7302Z",fill:"white"}),_.createElement("path",{d:"M247.735 36.9816H224.731C225.002 39.3888 225.876 41.3107 227.351 42.7472C228.827 44.1449 230.768 44.8438 233.175 44.8438C234.767 44.8438 236.204 44.4555 237.485 43.679C238.766 42.9025 239.678 41.8542 240.222 40.5341H247.211C246.279 43.6014 244.532 46.0862 241.969 47.9887C239.446 49.8523 236.456 50.7842 233 50.7842C228.497 50.7842 224.847 49.2894 222.052 46.2998C219.295 43.3102 217.917 39.5247 217.917 34.9432C217.917 30.4783 219.314 26.7316 222.11 23.7032C224.905 20.6747 228.516 19.1605 232.942 19.1605C237.368 19.1605 240.94 20.6553 243.658 23.6449C246.415 26.5957 247.793 30.323 247.793 34.8267L247.735 36.9816ZM232.942 24.8097C230.768 24.8097 228.963 25.4503 227.526 26.7316C226.089 28.0128 225.196 29.7212 224.847 31.8566H240.921C240.61 29.7212 239.756 28.0128 238.358 26.7316C236.961 25.4503 235.155 24.8097 232.942 24.8097Z",fill:"white"}),_.createElement("path",{d:"M259.085 19.8594V23.8779C259.784 22.5578 260.929 21.4513 262.521 20.5583C264.152 19.6264 266.113 19.1605 268.403 19.1605C271.975 19.1605 274.732 20.2477 276.673 22.4219C278.653 24.5961 279.643 27.4887 279.643 31.0995V50.0853H272.713V31.973C272.713 29.8376 272.208 28.1681 271.199 26.9645C270.228 25.7221 268.733 25.1009 266.714 25.1009C264.501 25.1009 262.754 25.7609 261.473 27.081C260.23 28.4011 259.609 30.2259 259.609 32.5554V50.0853H252.679V19.8594H259.085Z",fill:"white"}),_.createElement("path",{d:"M299.884 43.912V49.9106C299.029 50.1435 297.826 50.26 296.273 50.26C290.371 50.26 287.42 47.2898 287.42 41.3495V25.3921H282.82V19.8594H287.42V11.9972H294.351V19.8594H300V25.3921H294.351V40.6506C294.351 43.019 295.477 44.2032 297.729 44.2032L299.884 43.912Z",fill:"white"})),FQ=_.forwardRef(F7e),$7e="_logo_1gx2r_8",H7e="_container_1gx2r_14",B7e="_content_1gx2r_22",V7e="_formContainer_1gx2r_30",q7e="_authLinks_1gx2r_62",ya={logo:$7e,container:H7e,content:B7e,formContainer:V7e,authLinks:q7e};function K7e(e){return _.useCallback((async(t,n,r)=>{const i=FE({baseUrl:t}),o=new sL({matrixClient:i,doRequest:async()=>i.login("m.login.password",{identifier:{type:"m.id.user",user:n},password:r}),stateUpdated:()=>{},requestEmailToken:async()=>Promise.resolve({sid:""})}),{user_id:s,access_token:a,device_id:l}=await o.attemptAuth(),c={user_id:s,access_token:a,device_id:l,passwordlessUser:!1};return await(null==e?void 0:e.logout(!0)),[await OQ({baseUrl:t,accessToken:a,userId:s,deviceId:l},!1),c]}),[e])}const G7e=()=>{var e,t;const{t:n}=ze();Zy(n("login_title"));const{client:r,setClient:i}=cf(),o=K7e(r),s=Bt.defaultHomeserverUrl(),a=_.useRef(null),l=_.useRef(null),c=Aa(),u=di(),[d,h]=_.useState(!1),[p,f]=_.useState(),m=_.useCallback((e=>{if(e.preventDefault(),h(!0),!s||!a.current||!l.current)return f(Error("Login parameters are undefined")),void h(!1);o(s,a.current.value,l.current.value).then((async([e,t])=>{if(!i)return;i(e,t);const n=u.state;n&&n.from?await c(n.from):await c("/"),Et.instance.eventLogin.track()})).catch((e=>{f(e),h(!1)}))}),[o,u,c,s,i]);let v=null==(e=Bt.defaultServerName())?void 0:e.slice(0,25);return v=(null==v?void 0:v.length)!==(null==(t=Bt.defaultServerName())?void 0:t.length)?v+"...":v,E.jsx(E.Fragment,{children:E.jsx("div",{className:ya.container,children:E.jsxs("div",{className:ya.content,children:[E.jsxs("div",{className:ya.formContainer,children:[E.jsx(FQ,{width:"auto",height:"auto",className:ya.logo}),E.jsx("h2",{children:n("log_in")}),E.jsx("h4",{children:n("login_subheading")}),E.jsxs("form",{onSubmit:m,children:[E.jsx(vt,{children:E.jsx(_n,{type:"text",ref:a,placeholder:n("common.username"),label:n("common.username"),autoCorrect:"off",autoCapitalize:"none",prefix:"@",suffix:`:${v}`,"data-testid":"login_username"})}),E.jsx(vt,{children:E.jsx(_n,{type:"password",ref:l,placeholder:n("common.password"),label:n("common.password"),"data-testid":"login_password"})}),p&&E.jsx(vt,{children:E.jsx(Mu,{error:p})}),E.jsx(vt,{children:E.jsx(At,{type:"submit",disabled:d,"data-testid":"login_login",children:n(d?"logging_in":"login_title")})})]})]}),E.jsxs("div",{className:ya.authLinks,children:[E.jsx("p",{children:n("login_auth_links_prompt")}),E.jsx("p",{children:E.jsxs(Zi,{i18nKey:"login_auth_links",children:[E.jsx(Ia,{to:"/register",children:"Create an account"})," Or ",E.jsx(Ia,{to:"/",children:"Access as a guest"})]})})]})]})})})},W7e=()=>{const{t:e}=ze();Zy(e("action.register"));const{loading:t,authenticated:n,passwordlessUser:r,client:i,setClient:o}=k4(),s=_.useRef(null),a=Aa(),l=di(),[c,u]=_.useState(!1),[d,h]=_.useState(),[p,f]=_.useState(""),[m,v]=_.useState(""),{recaptchaKey:g,register:y}=D4(i),{execute:b,reset:w,recaptchaId:S}=j4(g),C=_.useCallback((e=>{e.preventDefault();const t=new FormData(e.target),n=t.get("userName"),s=t.get("password"),c=t.get("passwordConfirmation");s===c&&(async()=>{u(!0);const e=await b(),[t,a]=await y(n,s,n,e,r);if(i&&null!=i&&i.groupCallEventHandler&&r)for(const e of i.groupCallEventHandler.groupCalls.values()){const n=e.room.roomId;try{await t.joinRoom(n)}catch(e){"M_LIMIT_EXCEEDED"===e.errcode?(await su(e.data.retry_after_ms),await t.joinRoom(n)):(rw(e),A.error(`Couldn't join room ${n}`,e))}}null==o||o(t,a),Et.instance.eventSignup.cacheSignupEnd(new Date)})().then((async()=>{var e,t;null!=(e=l.state)&&e.from?await a(null==(t=l.state)?void 0:t.from):await a("/")})).catch((e=>{h(e),u(!1),w()}))}),[y,l,a,r,w,b,i,o]);return _.useEffect((()=>{var t,n;p&&m&&p!==m?null==(t=s.current)||t.setCustomValidity(e("register.passwords_must_match")):null==(n=s.current)||n.setCustomValidity("")}),[p,m,e]),_.useEffect((()=>{var e;!t&&n&&!r&&!c&&(null==(e=a("/"))||e.catch((e=>{A.error("Failed to navigate to /",e)})))}),[t,a,n,r,c]),t?E.jsx(Fw,{}):(Et.instance.eventSignup.cacheSignupStart(new Date),E.jsx(E.Fragment,{children:E.jsx("div",{className:ya.container,children:E.jsxs("div",{className:ya.content,children:[E.jsxs("div",{className:ya.formContainer,children:[E.jsx(FQ,{width:"auto",height:"auto",className:ya.logo}),E.jsx("h2",{children:e("register_heading")}),E.jsxs("form",{onSubmit:C,children:[E.jsx(vt,{children:E.jsx(_n,{type:"text",name:"userName",placeholder:e("common.username"),label:e("common.username"),autoCorrect:"off",autoCapitalize:"none",prefix:"@",suffix:`:${Bt.defaultServerName()}`,"data-testid":"register_username"})}),E.jsx(vt,{children:E.jsx(_n,{required:!0,name:"password",type:"password",onChange:e=>f(e.target.value),value:p,placeholder:e("common.password"),label:e("common.password"),"data-testid":"register_password"})}),E.jsx(vt,{children:E.jsx(_n,{required:!0,type:"password",name:"passwordConfirmation",onChange:e=>v(e.target.value),value:m,placeholder:e("register_confirm_password_label"),label:e("register_confirm_password_label"),ref:s,"data-testid":"register_confirm_password"})}),E.jsx(Jt,{size:"sm",children:E.jsxs(Zi,{i18nKey:"recaptcha_ssla_caption",children:["This site is protected by ReCAPTCHA and the Google"," ",E.jsx(Pd,{href:"https://www.google.com/policies/privacy/",children:"Privacy Policy"})," ","and"," ",E.jsx(Pd,{href:"https://policies.google.com/terms",children:"Terms of Service"})," ","apply.",E.jsx("br",{}),'By clicking "Register", you agree to our'," ",E.jsx(Pd,{href:Bt.get().ssla,children:"Software and Services License Agreement (SSLA)"})]})}),d&&E.jsx(vt,{children:E.jsx(Mu,{error:d})}),E.jsx(vt,{children:E.jsx(At,{type:"submit",disabled:c,"data-testid":"register_register",children:e(c?"register.registering":"action.register")})}),E.jsx("div",{id:S})]})]}),E.jsx("div",{className:ya.authLinks,children:E.jsxs(Zi,{i18nKey:"register_auth_links",children:[E.jsx("p",{children:"Already have an account?"}),E.jsxs("p",{children:[E.jsx(Ia,{to:"/login",children:"Log in"})," Or ",E.jsx(Ia,{to:"/",children:"Access as a guest"})]})]})})]})})}))},z7e="_form_1wfyo_8",Y7e="_headline_1wfyo_18",J7e="_container_1wfyo_37",X7e="_main_1wfyo_45",Z7e="_footer_1wfyo_62",Eg={form:z7e,headline:Y7e,container:J7e,main:X7e,footer:Z7e};function $Q(){const{setClient:e}=cf(),{privacyPolicyUrl:t,recaptchaKey:n,register:r}=D4(),{execute:i,reset:o,recaptchaId:s}=j4(n);return{privacyPolicyUrl:t,registerPasswordlessUser:_.useCallback((async t=>{if(!e)throw new Error("No client context");if(Ge)throw new Error("Registration was skipped: We should never try to register password-less user in embedded mode.");try{const n=await i(),o=jQ(),[s,a]=await r(o,_s(16),t,n,!0);e(s,a)}catch(e){throw o(),e}}),[i,o,r,e]),recaptchaId:s}}const Q7e=()=>{const[e,t]=_.useState(!1),[n,r]=_.useState(),{registerPasswordlessUser:i,recaptchaId:o}=$Q(),s=_.useCallback((e=>{e.preventDefault(),t(!0);const n=new FormData(e.target).get("displayName");i("string"==typeof n?n:"").catch((n=>{A.error("Failed to register passwordless user",e),t(!1),r(n)}))}),[i]),{t:a}=ze(),l=di();return E.jsxs(E.Fragment,{children:[E.jsxs(Pu,{children:[E.jsx(sf,{children:E.jsx(Vd,{})}),E.jsx(of,{children:E.jsx(A4,{preventNavigation:!0})})]}),E.jsxs("div",{className:Eg.container,children:[E.jsxs("main",{className:Eg.main,children:[E.jsx(xu,{size:"xl",weight:"semibold",className:Eg.headline,children:a("lobby.join_as_guest")}),E.jsxs(Vw,{className:Eg.form,onSubmit:s,children:[E.jsx(vt,{children:E.jsx(_n,{id:"displayName",name:"displayName",label:a("common.display_name"),placeholder:a("common.display_name"),"data-testid":"joincall_displayName",type:"text",required:!0,autoComplete:"off"})}),E.jsx(Jt,{size:"sm",children:E.jsxs(Zi,{i18nKey:"room_auth_view_ssla_caption",children:['By clicking "Join call now", you agree to our'," ",E.jsx(Pd,{href:Bt.get().ssla,children:"Software and Services License Agreement (SSLA)"})]})}),n&&E.jsx(vt,{children:E.jsx(Mu,{error:n})}),E.jsx(At,{type:"submit",size:"lg",disabled:e,"data-testid":"joincall_joincall",children:a(e?"common.loading":"room_auth_view_continue_button")}),E.jsx("div",{id:o})]})]}),E.jsx(Jt,{className:Eg.footer,children:E.jsxs(Zi,{i18nKey:"unauthenticated_view_body",children:["Not registered yet?"," ",E.jsx(Ia,{to:"/register",state:{from:l},children:"Create an account"})]})})]})]})};var Fg=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function HQ(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var BQ={exports:{}};!function(e){var t,n;t=Fg,n=function(){var e=function(){},t="undefined",n=typeof window!==t&&typeof window.navigator!==t&&/Trident\/|MSIE /.test(window.navigator.userAgent),r=["trace","debug","info","warn","error"],i={},o=null;function s(e,t){var n=e[t];if("function"==typeof n.bind)return n.bind(e);try{return Function.prototype.bind.call(n,e)}catch{return function(){return Function.prototype.apply.apply(n,[e,arguments])}}}function a(){console.log&&(console.log.apply?console.log.apply(console,arguments):Function.prototype.apply.apply(console.log,[console,arguments])),console.trace&&console.trace()}function l(){for(var n=this.getLevel(),i=0;i<r.length;i++){var o=r[i];this[o]=i<n?e:this.methodFactory(o,n,this.name)}if(this.log=this.debug,typeof console===t&&n<this.levels.SILENT)return"No console available for logging"}function c(e){return function(){typeof console!==t&&(l.call(this),this[e].apply(this,arguments))}}function u(r,i,o){return function(r){return"debug"===r&&(r="log"),typeof console!==t&&("trace"===r&&n?a:void 0!==console[r]?s(console,r):void 0!==console.log?s(console,"log"):e)}(r)||c.apply(this,arguments)}function d(e,n){var s,a,c,d=this,h="loglevel";function p(){var e;if(typeof window!==t&&h){try{e=window.localStorage[h]}catch{}if(typeof e===t)try{var n=window.document.cookie,r=encodeURIComponent(h),i=n.indexOf(r+"=");-1!==i&&(e=/^([^;]+)/.exec(n.slice(i+r.length+1))[1])}catch{}return void 0===d.levels[e]&&(e=void 0),e}}function f(e){var t=e;if("string"==typeof t&&void 0!==d.levels[t.toUpperCase()]&&(t=d.levels[t.toUpperCase()]),"number"==typeof t&&t>=0&&t<=d.levels.SILENT)return t;throw new TypeError("log.setLevel() called with invalid level: "+e)}"string"==typeof e?h+=":"+e:"symbol"==typeof e&&(h=void 0),d.name=e,d.levels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5},d.methodFactory=n||u,d.getLevel=function(){return c??a??s},d.setLevel=function(e,n){return c=f(e),!1!==n&&function(e){var n=(r[e]||"silent").toUpperCase();if(typeof window!==t&&h){try{return void(window.localStorage[h]=n)}catch{}try{window.document.cookie=encodeURIComponent(h)+"="+n+";"}catch{}}}(c),l.call(d)},d.setDefaultLevel=function(e){a=f(e),p()||d.setLevel(e,!1)},d.resetLevel=function(){c=null,function(){if(typeof window!==t&&h){try{window.localStorage.removeItem(h)}catch{}try{window.document.cookie=encodeURIComponent(h)+"=; expires=Thu, 01 Jan 1970 00:00:00 UTC"}catch{}}}(),l.call(d)},d.enableAll=function(e){d.setLevel(d.levels.TRACE,e)},d.disableAll=function(e){d.setLevel(d.levels.SILENT,e)},d.rebuild=function(){if(o!==d&&(s=f(o.getLevel())),l.call(d),o===d)for(var e in i)i[e].rebuild()},s=f(o?o.getLevel():"WARN");var m=p();null!=m&&(c=f(m)),l.call(d)}(o=new d).getLogger=function(e){if("symbol"!=typeof e&&"string"!=typeof e||""===e)throw new TypeError("You must supply a name when creating a logger.");var t=i[e];return t||(t=i[e]=new d(e,o.methodFactory)),t};var h=typeof window!==t?window.log:void 0;return o.noConflict=function(){return typeof window!==t&&window.log===o&&(window.log=h),o},o.getLoggers=function(){return i},o.default=o,o},e.exports?e.exports=n():t.log=n()}(BQ);var eDe=BQ.exports;const tDe=HQ(eDe);var lP=function(e,t){return(lP=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)};function Kl(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}lP(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}function nDe(e,t,n,r){return new(n||(n=Promise))((function(t,i){function o(e){try{a(r.next(e))}catch(e){i(e)}}function s(e){try{a(r.throw(e))}catch(e){i(e)}}function a(e){e.done?t(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(o,s)}a((r=r.apply(e,[])).next())}))}function VQ(e,t){var n,r,i,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]},s=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return s.next=a(0),s.throw=a(1),s.return=a(2),"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function a(a){return function(l){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;s&&(s=0,a[0]&&(o=0)),o;)try{if(n=1,r&&(i=2&a[0]?r.return:a[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,a[1])).done)return i;switch(r=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,r=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!(i=(i=o.trys).length>0&&i[i.length-1])&&(6===a[0]||2===a[0])){o=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){o.label=a[1];break}if(6===a[0]&&o.label<i[1]){o.label=i[1],i=a;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(a);break}i[2]&&o.ops.pop(),o.trys.pop();continue}a=t.call(e,o)}catch(e){a=[6,e],r=0}finally{n=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,l])}}}function Rp(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function iE(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,i,o=n.call(e),s=[];try{for(;(void 0===t||t-- >0)&&!(r=o.next()).done;)s.push(r.value)}catch(e){i={error:e}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return s}function sE(e,t,n){if(2===arguments.length)for(var r,i=0,o=t.length;i<o;i++)(r||!(i in t))&&(r||(r=Array.prototype.slice.call(t,0,i)),r[i]=t[i]);return e.concat(r||Array.prototype.slice.call(t))}function tp(e){return this instanceof tp?(this.v=e,this):new tp(e)}function rDe(e,t,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r,i=n.apply(e,t||[]),o=[];return r=Object.create(("function"==typeof AsyncIterator?AsyncIterator:Object).prototype),s("next"),s("throw"),s("return",(function(e){return function(t){return Promise.resolve(t).then(e,c)}})),r[Symbol.asyncIterator]=function(){return this},r;function s(e,t){i[e]&&(r[e]=function(t){return new Promise((function(n,r){o.push([e,t,n,r])>1||a(e,t)}))},t&&(r[e]=t(r[e])))}function a(e,t){try{!function(e){e.value instanceof tp?Promise.resolve(e.value.v).then(l,c):u(o[0][2],e)}(i[e](t))}catch(e){u(o[0][3],e)}}function l(e){a("next",e)}function c(e){a("throw",e)}function u(e,t){e(t),o.shift(),o.length&&a(o[0][0],o[0][1])}}function iDe(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t,n=e[Symbol.asyncIterator];return n?n.call(e):(e="function"==typeof Rp?Rp(e):e[Symbol.iterator](),t={},r("next"),r("throw"),r("return"),t[Symbol.asyncIterator]=function(){return this},t);function r(n){t[n]=e[n]&&function(t){return new Promise((function(r,i){(function(e,t,n,r){Promise.resolve(r).then((function(t){e({value:t,done:n})}),t)})(r,i,(t=e[n](t)).done,t.value)}))}}}function br(e){return"function"==typeof e}function U4(e){var t=e((function(e){Error.call(e),e.stack=(new Error).stack}));return t.prototype=Object.create(Error.prototype),t.prototype.constructor=t,t}var cI=U4((function(e){return function(t){e(this),this.message=t?t.length+" errors occurred during unsubscription:\n"+t.map((function(e,t){return t+1+") "+e.toString()})).join("\n  "):"",this.name="UnsubscriptionError",this.errors=t}}));function oE(e,t){if(e){var n=e.indexOf(t);0<=n&&e.splice(n,1)}}var Qy=function(){function e(e){this.initialTeardown=e,this.closed=!1,this._parentage=null,this._finalizers=null}return e.prototype.unsubscribe=function(){var e,t,n,r,i;if(!this.closed){this.closed=!0;var o=this._parentage;if(o)if(this._parentage=null,Array.isArray(o))try{for(var s=Rp(o),a=s.next();!a.done;a=s.next()){a.value.remove(this)}}catch(t){e={error:t}}finally{try{a&&!a.done&&(t=s.return)&&t.call(s)}finally{if(e)throw e.error}}else o.remove(this);var l=this.initialTeardown;if(br(l))try{l()}catch(e){i=e instanceof cI?e.errors:[e]}var c=this._finalizers;if(c){this._finalizers=null;try{for(var u=Rp(c),d=u.next();!d.done;d=u.next()){var h=d.value;try{aU(h)}catch(e){i=i??[],e instanceof cI?i=sE(sE([],iE(i)),iE(e.errors)):i.push(e)}}}catch(e){n={error:e}}finally{try{d&&!d.done&&(r=u.return)&&r.call(u)}finally{if(n)throw n.error}}}if(i)throw new cI(i)}},e.prototype.add=function(t){var n;if(t&&t!==this)if(this.closed)aU(t);else{if(t instanceof e){if(t.closed||t._hasParent(this))return;t._addParent(this)}(this._finalizers=null!==(n=this._finalizers)&&void 0!==n?n:[]).push(t)}},e.prototype._hasParent=function(e){var t=this._parentage;return t===e||Array.isArray(t)&&t.includes(e)},e.prototype._addParent=function(e){var t=this._parentage;this._parentage=Array.isArray(t)?(t.push(e),t):t?[t,e]:e},e.prototype._removeParent=function(e){var t=this._parentage;t===e?this._parentage=null:Array.isArray(t)&&oE(t,e)},e.prototype.remove=function(t){var n=this._finalizers;n&&oE(n,t),t instanceof e&&t._removeParent(this)},e.EMPTY=((t=new e).closed=!0,t),e;var t}(),qQ=Qy.EMPTY;function KQ(e){return e instanceof Qy||e&&"closed"in e&&br(e.remove)&&br(e.add)&&br(e.unsubscribe)}function aU(e){br(e)?e():e.unsubscribe()}var sDe={Promise:void 0},oDe={setTimeout:function(e,t){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];return setTimeout.apply(void 0,sE([e,t],iE(n)))},clearTimeout:function(e){return clearTimeout(e)},delegate:void 0};function GQ(e){oDe.setTimeout((function(){throw e}))}function lU(){}function Ab(e){e()}var F4=function(e){function t(t){var n=e.call(this)||this;return n.isStopped=!1,t?(n.destination=t,KQ(t)&&t.add(n)):n.destination=cDe,n}return Kl(t,e),t.create=function(e,t,n){return new cP(e,t,n)},t.prototype.next=function(e){this.isStopped||this._next(e)},t.prototype.error=function(e){this.isStopped||(this.isStopped=!0,this._error(e))},t.prototype.complete=function(){this.isStopped||(this.isStopped=!0,this._complete())},t.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,e.prototype.unsubscribe.call(this),this.destination=null)},t.prototype._next=function(e){this.destination.next(e)},t.prototype._error=function(e){try{this.destination.error(e)}finally{this.unsubscribe()}},t.prototype._complete=function(){try{this.destination.complete()}finally{this.unsubscribe()}},t}(Qy),aDe=function(){function e(e){this.partialObserver=e}return e.prototype.next=function(e){var t=this.partialObserver;if(t.next)try{t.next(e)}catch(e){y_(e)}},e.prototype.error=function(e){var t=this.partialObserver;if(t.error)try{t.error(e)}catch(e){y_(e)}else y_(e)},e.prototype.complete=function(){var e=this.partialObserver;if(e.complete)try{e.complete()}catch(e){y_(e)}},e}(),cP=function(e){function t(t,n,r){var i,o=e.call(this)||this;return i=br(t)||!t?{next:t??void 0,error:n??void 0,complete:r??void 0}:t,o.destination=new aDe(i),o}return Kl(t,e),t}(F4);function y_(e){GQ(e)}function lDe(e){throw e}var cDe={closed:!0,next:lU,error:lDe,complete:lU},$4="function"==typeof Symbol&&Symbol.observable||"@@observable";function WQ(e){return e}function uDe(e){return 0===e.length?WQ:1===e.length?e[0]:function(t){return e.reduce((function(e,t){return t(e)}),t)}}var ws=function(){function e(e){e&&(this._subscribe=e)}return e.prototype.lift=function(t){var n=new e;return n.source=this,n.operator=t,n},e.prototype.subscribe=function(e,t,n){var r=this,i=fDe(e)?e:new cP(e,t,n);return Ab((function(){var e=r,t=e.operator,n=e.source;i.add(t?t.call(i,n):n?r._subscribe(i):r._trySubscribe(i))})),i},e.prototype._trySubscribe=function(e){try{return this._subscribe(e)}catch(t){e.error(t)}},e.prototype.forEach=function(e,t){var n=this;return new(t=cU(t))((function(t,r){var i=new cP({next:function(t){try{e(t)}catch(e){r(e),i.unsubscribe()}},error:r,complete:t});n.subscribe(i)}))},e.prototype._subscribe=function(e){var t;return null===(t=this.source)||void 0===t?void 0:t.subscribe(e)},e.prototype[$4]=function(){return this},e.prototype.pipe=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return uDe(e)(this)},e.prototype.toPromise=function(e){var t=this;return new(e=cU(e))((function(e,n){var r;t.subscribe((function(e){return r=e}),(function(e){return n(e)}),(function(){return e(r)}))}))},e.create=function(t){return new e(t)},e}();function cU(e){var t;return null!==(t=e??sDe.Promise)&&void 0!==t?t:Promise}function dDe(e){return e&&br(e.next)&&br(e.error)&&br(e.complete)}function fDe(e){return e&&e instanceof F4||dDe(e)&&KQ(e)}function hDe(e){return br(null==e?void 0:e.lift)}function e0(e){return function(t){if(hDe(t))return t.lift((function(t){try{return e(t,this)}catch(e){this.error(e)}}));throw new TypeError("Unable to lift unknown Observable type")}}function aE(e,t,n,r,i){return new pDe(e,t,n,r,i)}var pDe=function(e){function t(t,n,r,i,o,s){var a=e.call(this,t)||this;return a.onFinalize=o,a.shouldUnsubscribe=s,a._next=n?function(e){try{n(e)}catch(e){t.error(e)}}:e.prototype._next,a._error=i?function(e){try{i(e)}catch(e){t.error(e)}finally{this.unsubscribe()}}:e.prototype._error,a._complete=r?function(){try{r()}catch(e){t.error(e)}finally{this.unsubscribe()}}:e.prototype._complete,a}return Kl(t,e),t.prototype.unsubscribe=function(){var t;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){var n=this.closed;e.prototype.unsubscribe.call(this),!n&&(null===(t=this.onFinalize)||void 0===t||t.call(this))}},t}(F4),mDe=U4((function(e){return function(){e(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"}})),zQ=function(e){function t(){var t=e.call(this)||this;return t.closed=!1,t.currentObservers=null,t.observers=[],t.isStopped=!1,t.hasError=!1,t.thrownError=null,t}return Kl(t,e),t.prototype.lift=function(e){var t=new uU(this,this);return t.operator=e,t},t.prototype._throwIfClosed=function(){if(this.closed)throw new mDe},t.prototype.next=function(e){var t=this;Ab((function(){var n,r;if(t._throwIfClosed(),!t.isStopped){t.currentObservers||(t.currentObservers=Array.from(t.observers));try{for(var i=Rp(t.currentObservers),o=i.next();!o.done;o=i.next()){o.value.next(e)}}catch(e){n={error:e}}finally{try{o&&!o.done&&(r=i.return)&&r.call(i)}finally{if(n)throw n.error}}}}))},t.prototype.error=function(e){var t=this;Ab((function(){if(t._throwIfClosed(),!t.isStopped){t.hasError=t.isStopped=!0,t.thrownError=e;for(var n=t.observers;n.length;)n.shift().error(e)}}))},t.prototype.complete=function(){var e=this;Ab((function(){if(e._throwIfClosed(),!e.isStopped){e.isStopped=!0;for(var t=e.observers;t.length;)t.shift().complete()}}))},t.prototype.unsubscribe=function(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null},Object.defineProperty(t.prototype,"observed",{get:function(){var e;return(null===(e=this.observers)||void 0===e?void 0:e.length)>0},enumerable:!1,configurable:!0}),t.prototype._trySubscribe=function(t){return this._throwIfClosed(),e.prototype._trySubscribe.call(this,t)},t.prototype._subscribe=function(e){return this._throwIfClosed(),this._checkFinalizedStatuses(e),this._innerSubscribe(e)},t.prototype._innerSubscribe=function(e){var t=this,n=this,r=n.hasError,i=n.isStopped,o=n.observers;return r||i?qQ:(this.currentObservers=null,o.push(e),new Qy((function(){t.currentObservers=null,oE(o,e)})))},t.prototype._checkFinalizedStatuses=function(e){var t=this,n=t.hasError,r=t.thrownError,i=t.isStopped;n?e.error(r):i&&e.complete()},t.prototype.asObservable=function(){var e=new ws;return e.source=this,e},t.create=function(e,t){return new uU(e,t)},t}(ws),uU=function(e){function t(t,n){var r=e.call(this)||this;return r.destination=t,r.source=n,r}return Kl(t,e),t.prototype.next=function(e){var t,n;null===(n=null===(t=this.destination)||void 0===t?void 0:t.next)||void 0===n||n.call(t,e)},t.prototype.error=function(e){var t,n;null===(n=null===(t=this.destination)||void 0===t?void 0:t.error)||void 0===n||n.call(t,e)},t.prototype.complete=function(){var e,t;null===(t=null===(e=this.destination)||void 0===e?void 0:e.complete)||void 0===t||t.call(e)},t.prototype._subscribe=function(e){var t,n;return null!==(n=null===(t=this.source)||void 0===t?void 0:t.subscribe(e))&&void 0!==n?n:qQ},t}(zQ);!function(e){function t(t){var n=e.call(this)||this;return n._value=t,n}Kl(t,e),Object.defineProperty(t.prototype,"value",{get:function(){return this.getValue()},enumerable:!1,configurable:!0}),t.prototype._subscribe=function(t){var n=e.prototype._subscribe.call(this,t);return!n.closed&&t.next(this._value),n},t.prototype.getValue=function(){var e=this,t=e.hasError,n=e.thrownError,r=e._value;if(t)throw n;return this._throwIfClosed(),r},t.prototype.next=function(t){e.prototype.next.call(this,this._value=t)}}(zQ);var gDe={now:function(){return Date.now()}},vDe=function(e){function t(t,n){return e.call(this)||this}return Kl(t,e),t.prototype.schedule=function(e,t){return this},t}(Qy),dU={setInterval:function(e,t){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];return setInterval.apply(void 0,sE([e,t],iE(n)))},clearInterval:function(e){return clearInterval(e)},delegate:void 0},yDe=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.scheduler=t,r.work=n,r.pending=!1,r}return Kl(t,e),t.prototype.schedule=function(e,t){var n;if(void 0===t&&(t=0),this.closed)return this;this.state=e;var r=this.id,i=this.scheduler;return null!=r&&(this.id=this.recycleAsyncId(i,r,t)),this.pending=!0,this.delay=t,this.id=null!==(n=this.id)&&void 0!==n?n:this.requestAsyncId(i,this.id,t),this},t.prototype.requestAsyncId=function(e,t,n){return void 0===n&&(n=0),dU.setInterval(e.flush.bind(e,this),n)},t.prototype.recycleAsyncId=function(e,t,n){if(void 0===n&&(n=0),null!=n&&this.delay===n&&!1===this.pending)return t;null!=t&&dU.clearInterval(t)},t.prototype.execute=function(e,t){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;var n=this._execute(e,t);if(n)return n;!1===this.pending&&null!=this.id&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))},t.prototype._execute=function(e,t){var n,r=!1;try{this.work(e)}catch(e){r=!0,n=e||new Error("Scheduled action threw falsy error")}if(r)return this.unsubscribe(),n},t.prototype.unsubscribe=function(){if(!this.closed){var t=this.id,n=this.scheduler,r=n.actions;this.work=this.state=this.scheduler=null,this.pending=!1,oE(r,this),null!=t&&(this.id=this.recycleAsyncId(n,t,null)),this.delay=null,e.prototype.unsubscribe.call(this)}},t}(vDe),fU=function(){function e(t,n){void 0===n&&(n=e.now),this.schedulerActionCtor=t,this.now=n}return e.prototype.schedule=function(e,t,n){return void 0===t&&(t=0),new this.schedulerActionCtor(this,e).schedule(n,t)},e.now=gDe.now,e}(),_De=function(e){function t(t,n){void 0===n&&(n=fU.now);var r=e.call(this,t,n)||this;return r.actions=[],r._active=!1,r}return Kl(t,e),t.prototype.flush=function(e){var t=this.actions;if(this._active)t.push(e);else{var n;this._active=!0;do{if(n=e.execute(e.state,e.delay))break}while(e=t.shift());if(this._active=!1,n){for(;e=t.shift();)e.unsubscribe();throw n}}},t}(fU);function bDe(e){return e&&br(e.schedule)}function SDe(e){return e[e.length-1]}function YQ(e){return bDe(SDe(e))?e.pop():void 0}new _De(yDe);var JQ=function(e){return e&&"number"==typeof e.length&&"function"!=typeof e};function XQ(e){return br(null==e?void 0:e.then)}function ZQ(e){return br(e[$4])}function QQ(e){return Symbol.asyncIterator&&br(null==e?void 0:e[Symbol.asyncIterator])}function eee(e){return new TypeError("You provided "+(null!==e&&"object"==typeof e?"an invalid object":"'"+e+"'")+" where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.")}function EDe(){return"function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator"}var tee=EDe();function nee(e){return br(null==e?void 0:e[tee])}function ree(e){return rDe(this,arguments,(function(){var t,n,r;return VQ(this,(function(i){switch(i.label){case 0:t=e.getReader(),i.label=1;case 1:i.trys.push([1,,9,10]),i.label=2;case 2:return[4,tp(t.read())];case 3:return n=i.sent(),r=n.value,n.done?[4,tp(void 0)]:[3,5];case 4:return[2,i.sent()];case 5:return[4,tp(r)];case 6:return[4,i.sent()];case 7:return i.sent(),[3,2];case 8:return[3,10];case 9:return t.releaseLock(),[7];case 10:return[2]}}))}))}function iee(e){return br(null==e?void 0:e.getReader)}function t0(e){if(e instanceof ws)return e;if(null!=e){if(ZQ(e))return wDe(e);if(JQ(e))return CDe(e);if(XQ(e))return TDe(e);if(QQ(e))return see(e);if(nee(e))return RDe(e);if(iee(e))return IDe(e)}throw eee(e)}function wDe(e){return new ws((function(t){var n=e[$4]();if(br(n.subscribe))return n.subscribe(t);throw new TypeError("Provided object does not correctly implement Symbol.observable")}))}function CDe(e){return new ws((function(t){for(var n=0;n<e.length&&!t.closed;n++)t.next(e[n]);t.complete()}))}function TDe(e){return new ws((function(t){e.then((function(e){t.closed||(t.next(e),t.complete())}),(function(e){return t.error(e)})).then(null,GQ)}))}function RDe(e){return new ws((function(t){var n,r;try{for(var i=Rp(e),o=i.next();!o.done;o=i.next()){var s=o.value;if(t.next(s),t.closed)return}}catch(e){n={error:e}}finally{try{o&&!o.done&&(r=i.return)&&r.call(i)}finally{if(n)throw n.error}}t.complete()}))}function see(e){return new ws((function(t){kDe(e,t).catch((function(e){return t.error(e)}))}))}function IDe(e){return see(ree(e))}function kDe(e,t){var n,r,i,o;return nDe(this,void 0,void 0,(function(){var s,a;return VQ(this,(function(l){switch(l.label){case 0:l.trys.push([0,5,6,11]),n=iDe(e),l.label=1;case 1:return[4,n.next()];case 2:if((r=l.sent()).done)return[3,4];if(s=r.value,t.next(s),t.closed)return[2];l.label=3;case 3:return[3,1];case 4:return[3,11];case 5:return a=l.sent(),i={error:a},[3,11];case 6:return l.trys.push([6,,9,10]),r&&!r.done&&(o=n.return)?[4,o.call(n)]:[3,8];case 7:l.sent(),l.label=8;case 8:return[3,10];case 9:if(i)throw i.error;return[7];case 10:return[7];case 11:return t.complete(),[2]}}))}))}function Ld(e,t,n,r,i){void 0===r&&(r=0),void 0===i&&(i=!1);var o=t.schedule((function(){n(),i?e.add(this.schedule(null,r)):this.unsubscribe()}),r);if(e.add(o),!i)return o}function oee(e,t){return void 0===t&&(t=0),e0((function(n,r){n.subscribe(aE(r,(function(n){return Ld(r,e,(function(){return r.next(n)}),t)}),(function(){return Ld(r,e,(function(){return r.complete()}),t)}),(function(n){return Ld(r,e,(function(){return r.error(n)}),t)})))}))}function aee(e,t){return void 0===t&&(t=0),e0((function(n,r){r.add(e.schedule((function(){return n.subscribe(r)}),t))}))}function xDe(e,t){return t0(e).pipe(aee(t),oee(t))}function PDe(e,t){return t0(e).pipe(aee(t),oee(t))}function LDe(e,t){return new ws((function(n){var r=0;return t.schedule((function(){r===e.length?n.complete():(n.next(e[r++]),n.closed||this.schedule())}))}))}function ODe(e,t){return new ws((function(n){var r;return Ld(n,t,(function(){r=e[tee](),Ld(n,t,(function(){var e,t,i;try{t=(e=r.next()).value,i=e.done}catch(e){return void n.error(e)}i?n.complete():n.next(t)}),0,!0)})),function(){return br(null==r?void 0:r.return)&&r.return()}}))}function lee(e,t){if(!e)throw new Error("Iterable cannot be null");return new ws((function(n){Ld(n,t,(function(){var r=e[Symbol.asyncIterator]();Ld(n,t,(function(){r.next().then((function(e){e.done?n.complete():n.next(e.value)}))}),0,!0)}))}))}function MDe(e,t){return lee(ree(e),t)}function ADe(e,t){if(null!=e){if(ZQ(e))return xDe(e,t);if(JQ(e))return LDe(e,t);if(XQ(e))return PDe(e,t);if(QQ(e))return lee(e,t);if(nee(e))return ODe(e,t);if(iee(e))return MDe(e,t)}throw eee(e)}function NDe(e,t){return t?ADe(e,t):t0(e)}function qw(e,t){return e0((function(n,r){var i=0;n.subscribe(aE(r,(function(n){r.next(e.call(t,n,i++))})))}))}function DDe(e,t,n,r,i,o,s,a){var l=[],c=0,u=0,d=!1,h=function(){d&&!l.length&&!c&&t.complete()},p=function(e){c++;var i=!1;t0(n(e,u++)).subscribe(aE(t,(function(e){t.next(e)}),(function(){i=!0}),void 0,(function(){if(i)try{c--;for(;l.length&&c<r;)e=void 0,e=l.shift(),s||p(e);h()}catch(e){t.error(e)}var e})))};return e.subscribe(aE(t,(function(e){return c<r?p(e):l.push(e)}),(function(){d=!0,h()}))),function(){}}function cee(e,t,n){return void 0===n&&(n=1/0),br(t)?cee((function(n,r){return qw((function(e,i){return t(n,e,r,i)}))(t0(e(n,r)))}),n):("number"==typeof t&&(n=t),e0((function(t,r){return DDe(t,r,e,n)})))}function jDe(e){return cee(WQ,e)}function UDe(){return jDe(1)}function hU(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return UDe()(NDe(e,YQ(e)))}function Kw(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=YQ(e);return e0((function(t,r){(n?hU(e,t,n):hU(e,t)).subscribe(r)}))}U4((function(e){return function(t){void 0===t&&(t=null),e(this),this.message="Timeout has occurred",this.name="TimeoutError",this.info=t}}));var FDe="lk";function H4(e){return!(typeof e>"u")&&($De(e)||HDe(e))}function $De(e){var t;return!!e&&(e.hasOwnProperty("participant")&&e.hasOwnProperty("source")&&e.hasOwnProperty("track")&&typeof(null==(t=e.publication)?void 0:t.track)<"u")}function HDe(e){return!!e&&(e.hasOwnProperty("participant")&&e.hasOwnProperty("source")&&e.hasOwnProperty("publication")&&typeof e.publication<"u")}function BDe(e){return!!e&&(e.hasOwnProperty("participant")&&e.hasOwnProperty("source")&&typeof e.publication>"u")}function VDe(e){if("string"==typeof e||"number"==typeof e)return`${e}`;if(BDe(e))return`${e.participant.identity}_${e.source}_placeholder`;if(H4(e))return`${e.participant.identity}_${e.publication.source}_${e.publication.trackSid}`;throw new Error(`Can't generate a id for the given track reference: ${e}`)}var qDe=[le.ConnectionStateChanged,le.RoomMetadataChanged,le.ActiveSpeakersChanged,le.ConnectionQualityChanged,le.ParticipantConnected,le.ParticipantDisconnected,le.ParticipantPermissionsChanged,le.ParticipantMetadataChanged,le.ParticipantNameChanged,le.ParticipantAttributesChanged,le.TrackMuted,le.TrackUnmuted,le.TrackPublished,le.TrackUnpublished,le.TrackStreamStateChanged,le.TrackSubscriptionFailed,le.TrackSubscriptionPermissionChanged,le.TrackSubscriptionStatusChanged],KDe=[...qDe,le.LocalTrackPublished,le.LocalTrackUnpublished];oe.TrackPublished,oe.TrackUnpublished,oe.TrackMuted,oe.TrackUnmuted,oe.TrackStreamStateChanged,oe.TrackSubscribed,oe.TrackUnsubscribed,oe.TrackSubscriptionPermissionChanged,oe.TrackSubscriptionFailed,oe.LocalTrackPublished,oe.LocalTrackUnpublished;var GDe=[oe.ConnectionQualityChanged,oe.IsSpeakingChanged,oe.ParticipantMetadataChanged,oe.ParticipantPermissionsChanged,oe.TrackMuted,oe.TrackUnmuted,oe.TrackPublished,oe.TrackUnpublished,oe.TrackStreamStateChanged,oe.TrackSubscriptionFailed,oe.TrackSubscriptionPermissionChanged,oe.TrackSubscriptionStatusChanged];oe.LocalTrackPublished,oe.LocalTrackUnpublished;var Su=tDe.getLogger("lk-components-js");function uee(e){return"object"==typeof e}function dee(e){return Array.isArray(e)&&e.filter(uee).length>0}function WDe(e){return`${FDe}-${e}`}function zDe(e){const t=uP(e),n=fee(e.participant).pipe(qw((()=>uP(e))),Kw(t));return{className:WDe(e.source===ue.Source.Camera||e.source===ue.Source.ScreenShare?"participant-media-video":"participant-media-audio"),trackObserver:n}}function uP(e){if(H4(e))return e.publication;{const{source:t,name:n,participant:r}=e;if(t&&n)return r.getTrackPublications().find((e=>e.source===t&&e.trackName===n));if(n)return r.getTrackPublicationByName(n);if(t)return r.getTrackPublication(t);throw new Error("At least one of source and name needs to be defined")}}function YDe(e,...t){return new ws((n=>{const r=()=>{n.next(e)};return t.forEach((t=>{e.on(t,r)})),()=>{t.forEach((t=>{e.off(t,r)}))}})).pipe(Kw(e))}function JDe(e,...t){return new ws((n=>{const r=()=>{n.next(e)};return t.forEach((t=>{e.on(t,r)})),()=>{t.forEach((t=>{e.off(t,r)}))}})).pipe(Kw(e))}function fee(e){return JDe(e,oe.TrackMuted,oe.TrackUnmuted,oe.ParticipantPermissionsChanged,oe.TrackPublished,oe.TrackUnpublished,oe.LocalTrackPublished,oe.LocalTrackUnpublished,oe.MediaDevicesError,oe.TrackSubscriptionStatusChanged).pipe(qw((e=>{const{isMicrophoneEnabled:t,isCameraEnabled:n,isScreenShareEnabled:r}=e,i=e.getTrackPublication(ue.Source.Microphone);return{isCameraEnabled:n,isMicrophoneEnabled:t,isScreenShareEnabled:r,cameraTrack:e.getTrackPublication(ue.Source.Camera),microphoneTrack:i,participant:e}})))}function pU(e,t,n=!0){const r=[e.localParticipant,...Array.from(e.remoteParticipants.values())],i=[];return r.forEach((e=>{t.forEach((t=>{const r=Array.from(e.trackPublications.values()).filter((e=>e.source===t&&(!n||e.track))).map((t=>({participant:e,publication:t,source:t.source})));i.push(...r)}))})),{trackReferences:i,participants:r}}function XDe(e,t,n){var r,i;const o=null!=(r=n.additionalRoomEvents)?r:KDe,s=null==(i=n.onlySubscribed)||i;return YDe(e,...Array.from(new Set([le.ParticipantConnected,le.ParticipantDisconnected,le.ConnectionStateChanged,le.LocalTrackPublished,le.LocalTrackUnpublished,le.TrackPublished,le.TrackUnpublished,le.TrackSubscriptionStatusChanged,...o]).values())).pipe(qw((e=>{const n=pU(e,t,s);return Su.debug(`TrackReference[] was updated. (length ${n.trackReferences.length})`,n),n})),Kw(pU(e,t,s)))}Su.setDefaultLevel("WARN"),new TextEncoder,new TextDecoder,_.createContext(void 0);const ZDe=_.createContext(void 0);function QDe(){return _.useContext(ZDe)}function hee(e){const t=QDe(),n=e??t;if(!n)throw new Error("No TrackRef, make sure you are inside a TrackRefContext or pass the TrackRef explicitly");return n}_.createContext(void 0);const pee=_.createContext(void 0);function eje(){return _.useContext(pee)}function mee(e){const t=eje(),n=e??t;if(!n)throw new Error("No room provided, make sure you are inside a Room context or pass the room explicitly");return n}function gee(e){var t,n,r="";if("string"==typeof e||"number"==typeof e)r+=e;else if("object"==typeof e)if(Array.isArray(e)){var i=e.length;for(t=0;t<i;t++)e[t]&&(n=gee(e[t]))&&(r&&(r+=" "),r+=n)}else for(n in e)e[n]&&(r&&(r+=" "),r+=n);return r}function tje(){for(var e,t,n=0,r="",i=arguments.length;n<i;n++)(e=arguments[n])&&(t=gee(e))&&(r&&(r+=" "),r+=t);return r}function nje(...e){return(...t)=>{for(const n of e)if("function"==typeof n)try{n(...t)}catch(e){console.error(e)}}}function rje(...e){const t={...e[0]};for(let n=1;n<e.length;n++){const r=e[n];for(const e in r){const n=t[e],i=r[e];"function"==typeof n&&"function"==typeof i&&"o"===e[0]&&"n"===e[1]&&e.charCodeAt(2)>=65&&e.charCodeAt(2)<=90?t[e]=nje(n,i):t[e]="className"!==e&&"UNSAFE_className"!==e||"string"!=typeof n||"string"!=typeof i?void 0!==i?i:n:tje(n,i)}}return t}function ije(e){return void 0!==e}function sje(...e){return rje(...e.filter(ije))}function oje(e,t){return"processor"===e&&t&&"object"==typeof t&&"name"in t?t.name:"e2ee"===e&&t?"e2ee-enabled":t}function aje(e={}){const t=mee(e.room),[n,r]=_.useState(t.localParticipant),[i,o]=_.useState(n.isMicrophoneEnabled),[s,a]=_.useState(n.isMicrophoneEnabled),[l,c]=_.useState(n.lastMicrophoneError),[u,d]=_.useState(n.lastCameraError),[h,p]=_.useState(n.isMicrophoneEnabled),[f,m]=_.useState(void 0),[v,g]=_.useState(void 0),y=e=>{a(e.isCameraEnabled),o(e.isMicrophoneEnabled),p(e.isScreenShareEnabled),g(e.cameraTrack),m(e.microphoneTrack),c(e.participant.lastMicrophoneError),d(e.participant.lastCameraError),r(e.participant)};return _.useEffect((()=>{const e=fee(t.localParticipant).subscribe(y);return()=>e.unsubscribe()}),[t]),{isMicrophoneEnabled:i,isScreenShareEnabled:h,isCameraEnabled:s,microphoneTrack:f,cameraTrack:v,lastMicrophoneError:l,lastCameraError:u,localParticipant:n}}function lje(e=[ue.Source.Camera,ue.Source.Microphone,ue.Source.ScreenShare,ue.Source.ScreenShareAudio,ue.Source.Unknown],t={}){const n=mee(t.room),[r,i]=_.useState([]),[o,s]=_.useState([]),a=_.useMemo((()=>e.map((e=>uee(e)?e.source:e))),[JSON.stringify(e)]);return _.useEffect((()=>{const e=XDe(n,a,{additionalRoomEvents:t.updateOnlyOn,onlySubscribed:t.onlySubscribed}).subscribe((({trackReferences:e,participants:t})=>{Su.debug("setting track bundles",e,t),i(e),s(t)}));return()=>e.unsubscribe()}),[n,JSON.stringify(t.onlySubscribed),JSON.stringify(t.updateOnlyOn),JSON.stringify(e)]),_.useMemo((()=>{if(dee(e)){const t=uje(e,o),n=Array.from(r);return o.forEach((e=>{t.has(e.identity)&&(t.get(e.identity)??[]).forEach((t=>{if(r.find((({participant:n,publication:r})=>e.identity===n.identity&&r.source===t)))return;Su.debug(`Add ${t} placeholder for participant ${e.identity}.`);const i={participant:e,source:t};n.push(i)}))})),n}return r}),[r,o,e])}function cje(e,t){const n=new Set(e);for(const e of t)n.delete(e);return n}function uje(e,t){const n=new Map;if(dee(e)){const r=e.filter((e=>e.withPlaceholder)).map((e=>e.source));t.forEach((e=>{const t=e.getTrackPublications().map((e=>{var t;return null==(t=e.track)?void 0:t.source})).filter((e=>void 0!==e)),i=Array.from(cje(new Set(r),new Set(t)));i.length>0&&n.set(e.identity,i)}))}return n}function vee(e,t={}){const[n,r]=_.useState(uP(e)),[i,o]=_.useState(null==n?void 0:n.isMuted),[s,a]=_.useState(null==n?void 0:n.isSubscribed),[l,c]=_.useState(null==n?void 0:n.track),[u,d]=_.useState("landscape"),h=_.useRef(),{className:p,trackObserver:f}=_.useMemo((()=>zDe(e)),[e.participant.sid??e.participant.identity,e.source,H4(e)&&e.publication.trackSid]);return _.useEffect((()=>{const e=f.subscribe((e=>{Su.debug("update track",e),r(e),o(null==e?void 0:e.isMuted),a(null==e?void 0:e.isSubscribed),c(null==e?void 0:e.track)}));return()=>null==e?void 0:e.unsubscribe()}),[f]),_.useEffect((()=>{var n,r;return l&&(h.current&&l.detach(h.current),null!=(n=t.element)&&n.current&&!(e.participant.isLocal&&"audio"===(null==l?void 0:l.kind))&&l.attach(t.element.current)),h.current=null==(r=t.element)?void 0:r.current,()=>{h.current&&(null==l||l.detach(h.current))}}),[l,t.element]),_.useEffect((()=>{var e,t;if("number"==typeof(null==(e=null==n?void 0:n.dimensions)?void 0:e.width)&&"number"==typeof(null==(t=null==n?void 0:n.dimensions)?void 0:t.height)){const e=n.dimensions.width>n.dimensions.height?"landscape":"portrait";d(e)}}),[n]),{publication:n,isMuted:i,isSubscribed:s,track:l,elementProps:sje(t.props,{className:p,"data-lk-local-participant":e.participant.isLocal,"data-lk-source":null==n?void 0:n.source,..."video"===(null==n?void 0:n.kind)&&{"data-lk-orientation":u}})}}_.createContext(void 0);var dje="Expected a function",mU=NaN,fje="[object Symbol]",hje=/^\s+|\s+$/g,pje=/^[-+]0x[0-9a-f]+$/i,mje=/^0b[01]+$/i,gje=/^0o[0-7]+$/i,vje=parseInt,yje="object"==typeof Fg&&Fg&&Fg.Object===Object&&Fg,_je="object"==typeof self&&self&&self.Object===Object&&self,bje=yje||_je||Function("return this")(),Sje=Object.prototype,Eje=Sje.toString,wje=Math.max,Cje=Math.min,uI=function(){return bje.Date.now()};function Tje(e,t,n){var r,i,o,s,a,l,c=0,u=!1,d=!1,h=!0;if("function"!=typeof e)throw new TypeError(dje);function p(t){var n=r,o=i;return r=i=void 0,c=t,s=e.apply(o,n)}function f(e){var n=e-l;return void 0===l||n>=t||n<0||d&&e-c>=o}function m(){var e=uI();if(f(e))return v(e);a=setTimeout(m,function(e){var n=t-(e-l);return d?Cje(n,o-(e-c)):n}(e))}function v(e){return a=void 0,h&&r?p(e):(r=i=void 0,s)}function g(){var e=uI(),n=f(e);if(r=arguments,i=this,l=e,n){if(void 0===a)return function(e){return c=e,a=setTimeout(m,t),u?p(e):s}(l);if(d)return a=setTimeout(m,t),p(l)}return void 0===a&&(a=setTimeout(m,t)),s}return t=gU(t)||0,dP(n)&&(u=!!n.leading,o=(d="maxWait"in n)?wje(gU(n.maxWait)||0,t):o,h="trailing"in n?!!n.trailing:h),g.cancel=function(){void 0!==a&&clearTimeout(a),c=0,r=l=i=a=void 0},g.flush=function(){return void 0===a?s:v(uI())},g}function dP(e){var t=typeof e;return!!e&&("object"==t||"function"==t)}function Rje(e){return!!e&&"object"==typeof e}function Ije(e){return"symbol"==typeof e||Rje(e)&&Eje.call(e)==fje}function gU(e){if("number"==typeof e)return e;if(Ije(e))return mU;if(dP(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=dP(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=e.replace(hje,"");var n=mje.test(e);return n||gje.test(e)?vje(e.slice(2),n?2:8):pje.test(e)?mU:+e}var kje=Tje;const vU=HQ(kje);function xje(e){const t=_.useRef(e);t.current=e,_.useEffect((()=>()=>{t.current()}),[])}function Pje(e,t=500,n){const r=_.useRef();xje((()=>{r.current&&r.current.cancel()}));const i=_.useMemo((()=>{const i=vU(e,t,n),o=(...e)=>i(...e);return o.cancel=()=>{i.cancel()},o.isPending=()=>!!r.current,o.flush=()=>i.flush(),o}),[e,t,n]);return _.useEffect((()=>{r.current=vU(e,t,n)}),[e,t,n]),i}function Lje(e,t,n){const r=e instanceof Function?e():e,[i,o]=_.useState(r),s=_.useRef(r),a=Pje(o,t,n);return s.current===r||(a(r),s.current=r),[i,a]}function Oje({threshold:e=0,root:t=null,rootMargin:n="0%",freezeOnceVisible:r=!1,initialIsIntersecting:i=!1,onChange:o}={}){var s;const[a,l]=_.useState(null),[c,u]=_.useState((()=>({isIntersecting:i,entry:void 0}))),d=_.useRef();d.current=o;const h=(null==(s=c.entry)?void 0:s.isIntersecting)&&r;_.useEffect((()=>{if(!a||!("IntersectionObserver"in window)||h)return;const r=new IntersectionObserver((e=>{const t=Array.isArray(r.thresholds)?r.thresholds:[r.thresholds];e.forEach((e=>{const n=e.isIntersecting&&t.some((t=>e.intersectionRatio>=t));u({isIntersecting:n,entry:e}),d.current&&d.current(n,e)}))}),{threshold:e,root:t,rootMargin:n});return r.observe(a),()=>{r.disconnect()}}),[a,JSON.stringify(e),t,n,h,r]);const p=_.useRef(null);_.useEffect((()=>{var e;!a&&null!=(e=c.entry)&&e.target&&!r&&!h&&p.current!==c.entry.target&&(p.current=c.entry.target,u({isIntersecting:i,entry:void 0}))}),[a,c.entry,r,h,i]);const f=[l,!!c.isIntersecting,c.entry];return f.ref=f[0],f.isIntersecting=f[1],f.entry=f[2],f}const Mje=_.forwardRef((function({onTrackClick:e,onClick:t,onSubscriptionStatusChanged:n,trackRef:r,manageSubscription:i,...o},s){const a=hee(r),l=_.useRef(null);_.useImperativeHandle(s,(()=>l.current));const c=Oje({root:l.current}),[u]=Lje(c,3e3);_.useEffect((()=>{i&&a.publication instanceof pS&&!1===(null==u?void 0:u.isIntersecting)&&!1===(null==c?void 0:c.isIntersecting)&&a.publication.setSubscribed(!1)}),[u,a,i]),_.useEffect((()=>{i&&a.publication instanceof pS&&!0===(null==c?void 0:c.isIntersecting)&&a.publication.setSubscribed(!0)}),[c,a,i]);const{elementProps:d,publication:h,isSubscribed:p}=vee(a,{element:l,props:o});_.useEffect((()=>{null==n||n(!!p)}),[p,n]);return _.createElement("video",{ref:l,...d,muted:!0,onClick:n=>{null==t||t(n),null==e||e({participant:null==a?void 0:a.participant,track:h})}})})),Aje=_.forwardRef((function({trackRef:e,onSubscriptionStatusChanged:t,volume:n,...r},i){const o=hee(e),s=_.useRef(null);_.useImperativeHandle(i,(()=>s.current));const{elementProps:a,isSubscribed:l,track:c,publication:u}=vee(o,{element:s,props:r});return _.useEffect((()=>{null==t||t(!!l)}),[l,t]),_.useEffect((()=>{void 0===c||void 0===n||(c instanceof QV?c.setVolume(n):Su.warn("Volume can only be set on remote audio tracks."))}),[n,c]),_.useEffect((()=>{void 0===u||void 0===r.muted||(u instanceof pS?u.setEnabled(!r.muted):Su.warn("Can only call setEnabled on remote track publications."))}),[r.muted,u,c]),_.createElement("audio",{ref:s,...a})}));function Nje({volume:e,muted:t}){const n=lje([ue.Source.Microphone,ue.Source.ScreenShareAudio,ue.Source.Unknown],{updateOnlyOn:[],onlySubscribed:!0}).filter((e=>!e.participant.isLocal&&e.publication.kind===ue.Kind.Audio));return _.createElement("div",{style:{display:"none"}},n.map((n=>_.createElement(Aje,{key:VDe(n),trackRef:n,volume:e,muted:t}))))}function Dje(e,t){const[n,r]=_.useState(),i=_.useMemo((()=>new Ei),[]);return _.useEffect((()=>{let n=!1,o=[];return i.lock().then((async i=>{try{(e.audio||e.video)&&(o=await Ry(e),n?o.forEach((e=>e.stop())):r(o))}catch(e){t&&e instanceof Error?t(e):Su.error(e)}finally{i()}})),()=>{n=!0,o.forEach((e=>{e.stop()}))}}),[JSON.stringify(e,oje),t,i]),n}const jje="_inRoom_1a6xo_8",Uje="_header_1a6xo_17",Fje="_filler_1a6xo_29",$je="_footer_1a6xo_34",Hje="_hidden_1a6xo_53",Bje="_overlay_1a6xo_57",Vje="_logo_1a6xo_75",qje="_buttons_1a6xo_84",Kje="_layout_1a6xo_91",Gje="_raiseHand_1a6xo_111",Wje="_invite_1a6xo_117",zje="_switchCamera_1a6xo_118",Yje="_shareScreen_1a6xo_119",Jje="_fixedGrid_1a6xo_148",Xje="_scrollingGrid_1a6xo_154",Zje="_tile_1a6xo_173",Qje="_maximised_1a6xo_178",On={inRoom:jje,header:Uje,filler:Fje,footer:$je,hidden:Hje,overlay:Bje,logo:Vje,buttons:qje,layout:Kje,raiseHand:Gje,invite:Wje,switchCamera:zje,shareScreen:Yje,fixedGrid:Jje,scrollingGrid:Xje,tile:Zje,maximised:Qje},eUe="_content_1cy0f_8",tUe="_wait_1cy0f_19",nUe="_join_1cy0f_32",wg={content:eUe,wait:tUe,join:nUe};function yU(e,t){let n;return(...r)=>{window.clearTimeout(n),n=window.setTimeout((()=>e(...r)),t)}}function pv({debounce:e,scroll:t,polyfill:n,offsetSize:r}={debounce:0,scroll:!1,offsetSize:!1}){const i=n||(typeof window>"u"?class{}:window.ResizeObserver);if(!i)throw new Error("This browser does not support ResizeObserver out of the box. See: https://github.com/react-spring/react-use-measure/#resize-observer-polyfills");const[o,s]=_.useState({left:0,top:0,width:0,height:0,bottom:0,right:0,x:0,y:0}),a=_.useRef({element:null,scrollContainers:null,resizeObserver:null,lastBounds:o,orientationHandler:null}),l=e?"number"==typeof e?e:e.scroll:null,c=e?"number"==typeof e?e:e.resize:null,u=_.useRef(!1);_.useEffect((()=>(u.current=!0,()=>{u.current=!1})));const[d,h,p]=_.useMemo((()=>{const e=()=>{if(!a.current.element)return;const{left:e,top:t,width:n,height:i,bottom:o,right:l,x:c,y:d}=a.current.element.getBoundingClientRect(),h={left:e,top:t,width:n,height:i,bottom:o,right:l,x:c,y:d};a.current.element instanceof HTMLElement&&r&&(h.height=a.current.element.offsetHeight,h.width=a.current.element.offsetWidth),Object.freeze(h),u.current&&!oUe(a.current.lastBounds,h)&&s(a.current.lastBounds=h)};return[e,c?yU(e,c):e,l?yU(e,l):e]}),[s,r,l,c]);function f(){a.current.scrollContainers&&(a.current.scrollContainers.forEach((e=>e.removeEventListener("scroll",p,!0))),a.current.scrollContainers=null),a.current.resizeObserver&&(a.current.resizeObserver.disconnect(),a.current.resizeObserver=null),a.current.orientationHandler&&("orientation"in screen&&"removeEventListener"in screen.orientation?screen.orientation.removeEventListener("change",a.current.orientationHandler):"onorientationchange"in window&&window.removeEventListener("orientationchange",a.current.orientationHandler))}function m(){a.current.element&&(a.current.resizeObserver=new i(p),a.current.resizeObserver.observe(a.current.element),t&&a.current.scrollContainers&&a.current.scrollContainers.forEach((e=>e.addEventListener("scroll",p,{capture:!0,passive:!0}))),a.current.orientationHandler=()=>{p()},"orientation"in screen&&"addEventListener"in screen.orientation?screen.orientation.addEventListener("change",a.current.orientationHandler):"onorientationchange"in window&&window.addEventListener("orientationchange",a.current.orientationHandler))}return iUe(p,!!t),rUe(h),_.useEffect((()=>{f(),m()}),[t,p,h]),_.useEffect((()=>f),[]),[e=>{!e||e===a.current.element||(f(),a.current.element=e,a.current.scrollContainers=yee(e),m())},o,d]}function rUe(e){_.useEffect((()=>{const t=e;return window.addEventListener("resize",t),()=>{window.removeEventListener("resize",t)}}),[e])}function iUe(e,t){_.useEffect((()=>{if(t){const t=e;return window.addEventListener("scroll",t,{capture:!0,passive:!0}),()=>{window.removeEventListener("scroll",t,!0)}}}),[e,t])}function yee(e){const t=[];if(!e||e===document.body)return t;const{overflow:n,overflowX:r,overflowY:i}=window.getComputedStyle(e);return[n,r,i].some((e=>"auto"===e||"scroll"===e))&&t.push(e),[...t,...yee(e.parentElement)]}const sUe=["x","y","top","bottom","left","right","width","height"],oUe=(e,t)=>sUe.every((n=>e[n]===t[n])),aUe="_loading_14w06_8",lUe={loading:aUe},cUe=({size:e,loading:t,...n})=>E.jsxs("div",{children:[t&&E.jsx("div",{className:lUe.loading,children:E.jsx(YTe,{size:e/3})}),E.jsx(Zp,{size:e,...n})]}),uUe="_preview_1jjvr_8",dUe="_mirror_1jjvr_24",fUe="_cameraStarting_1jjvr_28",hUe="_avatarContainer_1jjvr_39",pUe="_buttonBar_1jjvr_51",Cg={preview:uUe,mirror:dUe,cameraStarting:fUe,avatarContainer:hUe,buttonBar:pUe},mUe=({matrixInfo:e,muteStates:t,videoTrack:n,children:r})=>{const{t:i}=ze(),[o,s]=pv(),a=_.useRef(null);_.useEffect((()=>(a.current&&(null==n||n.attach(a.current)),()=>{null==n||n.detach()})),[n]);const l=_.useMemo((()=>t.video.enabled&&!n),[t.video.enabled,n]);return E.jsxs("div",{className:Ae(Cg.preview),ref:o,children:[E.jsx("video",{className:n&&"user"===CL(n).facingMode?Cg.mirror:void 0,ref:a,muted:!0,playsInline:!0,tabIndex:-1,disablePictureInPicture:!0}),(!t.video.enabled||l)&&E.jsx(E.Fragment,{children:E.jsxs("div",{className:Cg.avatarContainer,children:[l&&E.jsx("div",{className:Cg.cameraStarting,role:"status",children:i("video_tile.camera_starting")}),E.jsx(cUe,{id:e.userId,name:e.displayName,size:Math.min(s.width,s.height)/2,src:e.avatarUrl,loading:l})]})}),E.jsx("div",{className:Cg.buttonBar,children:r})]})},_ee=e=>{const{t}=ze();return E.jsx(At,{kind:"secondary",size:"sm",Icon:oRe,...e,children:t("action.invite")})};function Ip(e){const t=_.useRef(void 0);return t.current??(t.current={value:e()}),t.current.value}let Od;Od=/android/i.test(navigator.userAgent)?"android":/iPad|iPhone|iPod|Mac/.test(navigator.userAgent)&&"ontouchend"in document?"ios":"desktop";const gUe=()=>{const{userAgent:e}=navigator;return e.includes("Firefox")};function Ll(e){const t=_.useRef(e);return t.current=e,t}function bee(e){const t=Ll(uf().videoInput.select),n=oy((e=>e.pipe(Pt((([e])=>e)),Pt((e=>null===e?Rt(null):sy(Sa(e,Re.Restarted).pipe(un(null),Ne((()=>e))),Sa(e,Re.Muted).pipe(Ne((()=>null)))))))),[e]);return tt(oy((e=>"desktop"===Od?Rt(null):e.pipe(Pt((([e])=>e)),Ne((e=>{if(null===e)return null;const n=CL(e).facingMode;return"user"!==n&&"environment"!==n?null:()=>{e.restartTrack({facingMode:"user"===n?"environment":"user"}).then((()=>{const n=e.mediaStreamTrack.getSettings().deviceId;void 0!==n&&t.current(n)})).catch((e=>A.error("Failed to switch camera",n,e)))}})))),[n]))}const See=({client:e,matrixInfo:t,muteStates:n,onEnter:r,enterLabel:i,confineToRoom:o,hideHeader:s,participantCount:a,onShareClick:l,waitingForInvite:c})=>{const{t:u}=ze();Zy(t.roomName);const d=_.useCallback((()=>{var e,t;return null==(t=(e=n.audio).setEnabled)?void 0:t.call(e,(e=>!e))}),[n]),h=_.useCallback((()=>{var e,t;return null==(t=(e=n.video).setEnabled)?void 0:t.call(e,(e=>!e))}),[n]),[p,f]=_.useState(!1),[m,v]=_.useState(O4),g=_.useCallback((()=>f(!0)),[f]),y=_.useCallback((()=>f(!1)),[f]),b=Aa(),w=_.useCallback((()=>{var e;null==(e=b("/"))||e.catch((e=>{A.error("Failed to navigate to /",e)}))}),[b]),S=ww("(max-height: 500px)"),C=!o&&E.jsx(Ia,{className:wg.recents,to:"/",children:u("lobby.leave_button")}),k=uf(),T=Ip((()=>n.audio.enabled&&{deviceId:k.audioInput.selectedId})),I=Dje(_.useMemo((()=>({audio:Object.assign({},T),video:n.video.enabled&&{deviceId:k.videoInput.selectedId}})),[T,k.videoInput.selectedId,n.video.enabled]),_.useCallback((e=>{var t,r,i,o;A.error("Error while creating preview Tracks:",e),null==(r=(t=n.audio).setEnabled)||r.call(t,!1),null==(o=(i=n.video).setEnabled)||o.call(i,!1)}),[n.audio,n.video])),R=_.useMemo((()=>(null==I?void 0:I.find((e=>e.kind===ue.Kind.Video)))??null),[I]),x=bee(oy((e=>e.pipe(Ne((([e])=>e)))),[R]));return E.jsxs(E.Fragment,{children:[E.jsxs("div",{className:Ae(wg.room,On.inRoom),children:[!s&&E.jsxs(Pu,{children:[E.jsx(sf,{children:E.jsx(NJ,{id:t.roomId,name:t.roomName,avatarUrl:t.roomAvatar,encrypted:t.e2eeSystem.kind!==Ut.NONE,participantCount:a})}),E.jsx(of,{children:null!==l&&E.jsx(_ee,{onClick:l})})]}),E.jsxs("div",{className:wg.content,children:[E.jsx(mUe,{matrixInfo:t,muteStates:n,videoTrack:R,children:E.jsx(At,{className:Ae(wg.join,{[wg.wait]:c}),size:c?"sm":"lg",onClick:()=>{c||r()},"data-testid":"lobby_joinCall",children:i??u("lobby.join_button")})}),!S&&C]}),E.jsxs("div",{className:On.footer,children:[S&&C,E.jsxs("div",{className:On.buttons,children:[E.jsx(ZZ,{muted:!n.audio.enabled,onClick:d,disabled:null===n.audio.setEnabled}),E.jsx(QZ,{muted:!n.video.enabled,onClick:h,disabled:null===n.video.setEnabled}),x&&E.jsx(eQ,{onClick:x}),E.jsx(nQ,{onClick:g}),!o&&E.jsx(tQ,{onClick:w})]})]})]}),e&&E.jsx(M4,{client:e,open:p,onDismiss:y,tab:m,onTabChange:v})]})},vUe="_headline_1em2y_8",yUe="_callEndedContent_1em2y_15",_Ue="_callEndedButton_1em2y_35",bUe="_submitButton_1em2y_40",SUe="_container_1em2y_47",EUe="_main_1em2y_55",wUe="_footer_1em2y_72",Ec={headline:vUe,callEndedContent:yUe,callEndedButton:_Ue,submitButton:bUe,container:SUe,main:EUe,footer:wUe},CUe="_starIcon_1m09w_8",TUe="_starRating_1m09w_12",RUe="_inputContainer_1m09w_18",IUe="_hideElement_1m09w_22",Tg={starIcon:CUe,starRating:TUe,inputContainer:RUe,hideElement:IUe},kUe=(e,t)=>_.createElement("svg",{width:28,height:26,viewBox:"0 0 28 26",fill:"none",xmlns:"http://www.w3.org/2000/svg",ref:t,...e},_.createElement("path",{d:"M14 21.0267L22.24 26.0001L20.0533 16.6267L27.3333 10.3201L17.7466 9.50675L14 0.666748L10.2533 9.50675L0.666626 10.3201L7.94663 16.6267L5.75996 26.0001L14 21.0267Z",fill:"white"})),xUe=_.forwardRef(kUe),PUe=(e,t)=>_.createElement("svg",{width:28,height:26,viewBox:"0 0 28 26",fill:"none",xmlns:"http://www.w3.org/2000/svg",ref:t,...e},_.createElement("path",{id:"Vector",d:"M14 7.50675L15.2933 10.5601L15.92 12.0401L17.52 12.1734L20.8133 12.4534L18.3066 14.6267L17.0933 15.6801L17.4533 17.2534L18.2 20.4667L15.3733 18.7601L14 17.9067L12.6266 18.7334L9.79996 20.4401L10.5466 17.2267L10.9066 15.6534L9.69329 14.6001L7.18663 12.4267L10.48 12.1467L12.08 12.0134L12.7066 10.5334L14 7.50675M14 0.666748L10.2533 9.50675L0.666626 10.3201L7.94663 16.6267L5.75996 26.0001L14 21.0267L22.24 26.0001L20.0533 16.6267L27.3333 10.3201L17.7466 9.50675L14 0.666748Z",fill:"white"})),LUe=_.forwardRef(PUe);function OUe({starCount:e,onChange:t,required:n}){const[r,i]=_.useState(0),[o,s]=_.useState(0),{t:a}=ze();return E.jsx("div",{className:Tg.starRating,children:[...Array(e)].map(((e,n)=>(n+=1,E.jsxs("div",{className:Tg.inputContainer,onMouseEnter:()=>s(n),onMouseLeave:()=>s(r),children:[E.jsx("input",{className:Tg.hideElement,type:"radio",id:"starInput"+String(n),value:String(n)+"Star",name:"star rating",onChange:e=>{i(n),t(n)},required:!0}),E.jsx("label",{className:Tg.hideElement,id:"starInvisibleLabel"+String(n),htmlFor:"starInput"+String(n),children:a("star_rating_input_label",{count:n})}),E.jsx("label",{className:Tg.starIcon,id:"starIcon"+String(n),htmlFor:"starInput"+String(n),children:n<=(o||r)?E.jsx(xUe,{}):E.jsx(LUe,{})})]},n))))})}const MUe=({client:e,isPasswordlessUser:t,confineToRoom:n,endedCallId:r})=>{const{t:i}=ze(),o=Aa(),{displayName:s}=Yy(e),[a,l]=_.useState(!1),[c,u]=_.useState(0),[d,h]=_.useState(!1),[p,f]=_.useState(!1),m=_.useCallback((e=>{e.preventDefault();const i=new FormData(e.target).get("feedbackText");Et.instance.eventQualitySurvey.track(r,i,c),h(!0),setTimeout((()=>{f(!0),setTimeout((()=>{var e;t?l(!0):n||null==(e=o("/"))||e.catch((e=>{A.error("Failed to navigate to /",e)}))}),1e3)}),1e3)}),[r,o,t,n,c]),v=t&&E.jsxs("div",{className:Ec.callEndedContent,children:[E.jsxs(Zi,{i18nKey:"call_ended_view.create_account_prompt",children:[E.jsx("p",{children:"Why not finish by setting up a password to keep your account?"}),E.jsx("p",{children:"You'll be able to keep your name and set an avatar for use on future calls"})]}),E.jsx(T4,{className:Ec.callEndedButton,to:"/register",children:i("call_ended_view.create_account_button")})]}),g=E.jsxs("div",{className:Ec.callEndedContent,children:[E.jsx(Zi,{i18nKey:"call_ended_view.feedback_prompt",children:E.jsx("p",{children:"We'd love to hear your feedback so we can improve your experience."})}),E.jsxs("form",{onSubmit:m,children:[E.jsx(vt,{children:E.jsx(OUe,{starCount:5,onChange:u,required:!0})}),E.jsx(vt,{children:E.jsx(_n,{className:fQ.feedback,id:"feedbackText",name:"feedbackText",label:i("settings.feedback_tab_description_label"),placeholder:i("settings.feedback_tab_description_label"),type:"textarea"})})," ",E.jsx(vt,{children:p?E.jsx(Zi,{i18nKey:"call_ended_view.feedback_done",children:E.jsx("p",{children:"Thanks for your feedback!"})}):E.jsx(At,{type:"submit",className:Ec.submitButton,"data-testid":"home_go",children:i(d?"submitting":"action.submit")})})]})]});return E.jsxs(E.Fragment,{children:[E.jsxs(Pu,{children:[E.jsx(sf,{children:!n&&E.jsx(Vd,{})}),E.jsx(of,{})]}),E.jsxs("div",{className:Ec.container,children:[E.jsxs("main",{className:Ec.main,children:[E.jsx(xu,{size:"xl",weight:"semibold",className:Ec.headline,children:a?i("call_ended_view.headline",{displayName:s}):i("call_ended_view.headline",{displayName:s})+"\n"+i("call_ended_view.survey_prompt")}),a&&!n||!Et.instance.isEnabled()?v:g]}),!n&&E.jsx(Jt,{className:Ec.footer,children:E.jsxs(Ia,{to:"/",children:[" ",i("call_ended_view.not_now_button")," "]})})]})]})};function _U(e,t,n){const r=n.find((n=>n.kind===t&&n.label===e));return null==r?void 0:r.deviceId}const AUe=(e,t)=>_.createElement("svg",{width:48,height:48,viewBox:"0 0 48 48",fill:"none",xmlns:"http://www.w3.org/2000/svg",ref:t,...e},_.createElement("g",{id:"Logo Mark"},_.createElement("rect",{width:47.86,height:48,rx:23.93,fill:"#0DBD8B"}),_.createElement("g",{id:"Union"},_.createElement("path",{d:"M21.3075 9.42871C20.3396 9.42871 19.5549 10.214 19.5549 11.1828C19.5549 12.1516 20.3396 12.9369 21.3075 12.9369C25.9321 12.9369 29.6811 16.689 29.6811 21.3175C29.6811 22.2863 30.4657 23.0716 31.4337 23.0716C32.4016 23.0716 33.1863 22.2863 33.1863 21.3175C33.1863 14.7515 27.868 9.42871 21.3075 9.42871Z",fill:"white"}),_.createElement("path",{d:"M38.4591 21.3174C38.4591 20.3486 37.6745 19.5633 36.7065 19.5633C35.7386 19.5633 34.9539 20.3486 34.9539 21.3174C34.9539 25.9459 31.2049 29.698 26.5804 29.698C25.6124 29.698 24.8277 30.4833 24.8277 31.4521C24.8277 32.4209 25.6124 33.2062 26.5804 33.2062C33.1408 33.2062 38.4591 27.8834 38.4591 21.3174Z",fill:"white"}),_.createElement("path",{d:"M28.3329 36.8173C28.3329 37.786 27.5482 38.5714 26.5803 38.5714C20.0198 38.5714 14.7015 33.2486 14.7015 26.6826C14.7015 25.7138 15.4862 24.9285 16.4541 24.9285C17.4221 24.9285 18.2067 25.7138 18.2067 26.6826C18.2067 31.3111 21.9557 35.0632 26.5803 35.0632C27.5482 35.0632 28.3329 35.8485 28.3329 36.8173Z",fill:"white"}),_.createElement("path",{d:"M9.40112 26.6827C9.40112 27.6514 10.1858 28.4368 11.1537 28.4368C12.1217 28.4368 12.9064 27.6514 12.9064 26.6827C12.9064 22.0542 16.6553 18.3021 21.2799 18.3021C22.2478 18.3021 23.0325 17.5167 23.0325 16.548C23.0325 15.5792 22.2478 14.7939 21.2799 14.7939C14.7194 14.7939 9.40112 20.1167 9.40112 26.6827Z",fill:"white"})))),NUe=_.forwardRef(AUe),DUe=(e,t)=>_.createElement("svg",{width:160,height:22,viewBox:"0 0 160 22",fill:"none",xmlns:"http://www.w3.org/2000/svg",ref:t,...e},_.createElement("g",{id:"Logo Type"},_.createElement("g",{id:"Vector"},_.createElement("path",{d:"M14.8673 15.1575H3.39742C3.53293 16.3508 3.96849 17.3036 4.70411 18.0157C5.43974 18.7087 6.40766 19.0551 7.60789 19.0551C8.40159 19.0551 9.11785 18.8626 9.75668 18.4777C10.3955 18.0927 10.8504 17.5731 11.1215 16.9186H14.606C14.1414 18.4392 13.2702 19.671 11.9926 20.6142C10.7343 21.5381 9.24368 22 7.52078 22C5.27519 22 3.45549 21.259 2.06168 19.7769C0.687227 18.2948 0 16.4182 0 14.147C0 11.9335 0.696906 10.0761 2.09072 8.5748C3.48453 7.07349 5.28487 6.32283 7.49174 6.32283C9.69861 6.32283 11.4796 7.06387 12.8347 8.54593C14.2091 10.0087 14.8964 11.8565 14.8964 14.0892L14.8673 15.1575ZM7.49174 9.12336C6.40766 9.12336 5.50749 9.44095 4.79123 10.0761C4.07496 10.7113 3.62972 11.5582 3.45549 12.6168H11.4699C11.315 11.5582 10.8892 10.7113 10.1922 10.0761C9.49534 9.44095 8.59517 9.12336 7.49174 9.12336Z",fill:"currentColor"}),_.createElement("path",{d:"M17.2743 17.1785V0H20.7298V17.2362C20.7298 18.0061 21.1557 18.3911 22.0074 18.3911L22.6172 18.3622V21.6247C22.2881 21.6824 21.9397 21.7113 21.5719 21.7113C20.0813 21.7113 18.9875 21.336 18.2906 20.5853C17.6131 19.8346 17.2743 18.699 17.2743 17.1785Z",fill:"currentColor"}),_.createElement("path",{d:"M38.71 15.1575H27.2401C27.3756 16.3508 27.8112 17.3036 28.5468 18.0157C29.2824 18.7087 30.2504 19.0551 31.4506 19.0551C32.2443 19.0551 32.9606 18.8626 33.5994 18.4777C34.2382 18.0927 34.6931 17.5731 34.9642 16.9186H38.4487C37.9841 18.4392 37.113 19.671 35.8353 20.6142C34.577 21.5381 33.0864 22 31.3635 22C29.1179 22 27.2982 21.259 25.9044 19.7769C24.5299 18.2948 23.8427 16.4182 23.8427 14.147C23.8427 11.9335 24.5396 10.0761 25.9334 8.5748C27.3272 7.07349 29.1276 6.32283 31.3344 6.32283C33.5413 6.32283 35.3223 7.06387 36.6774 8.54593C38.0518 10.0087 38.7391 11.8565 38.7391 14.0892L38.71 15.1575ZM31.3344 9.12336C30.2504 9.12336 29.3502 9.44095 28.6339 10.0761C27.9177 10.7113 27.4724 11.5582 27.2982 12.6168H35.3126C35.1577 11.5582 34.7319 10.7113 34.035 10.0761C33.3381 9.44095 32.4379 9.12336 31.3344 9.12336Z",fill:"currentColor"}),_.createElement("path",{d:"M54.3001 13.0499V21.6535H50.8446V12.6745C50.8446 10.4033 49.8961 9.26772 47.9989 9.26772C46.9729 9.26772 46.1502 9.59493 45.5307 10.2493C44.9306 10.9038 44.6306 11.7988 44.6306 12.9344V21.6535H41.1751V6.66929H44.3692V8.66142C44.737 7.98775 45.2984 7.42957 46.0534 6.98688C46.8084 6.54418 47.7473 6.32283 48.8701 6.32283C50.9608 6.32283 52.4707 7.11199 53.4 8.69029C54.6776 7.11199 56.3812 6.32283 58.5106 6.32283C60.2722 6.32283 61.6273 6.87139 62.5759 7.9685C63.5244 9.04637 63.9987 10.4707 63.9987 12.2415V21.6535H60.5432V12.6745C60.5432 10.4033 59.5947 9.26772 57.6975 9.26772C56.6522 9.26772 55.8198 9.60455 55.2003 10.2782C54.6002 10.9326 54.3001 11.8565 54.3001 13.0499Z",fill:"currentColor"}),_.createElement("path",{d:"M81.1834 15.1575H69.7135C69.849 16.3508 70.2846 17.3036 71.0202 18.0157C71.7558 18.7087 72.7237 19.0551 73.924 19.0551C74.7177 19.0551 75.4339 18.8626 76.0728 18.4777C76.7116 18.0927 77.1665 17.5731 77.4375 16.9186H80.9221C80.4575 18.4392 79.5863 19.671 78.3087 20.6142C77.0504 21.5381 75.5598 22 73.8369 22C71.5913 22 69.7716 21.259 68.3778 19.7769C67.0033 18.2948 66.3161 16.4182 66.3161 14.147C66.3161 11.9335 67.013 10.0761 68.4068 8.5748C69.8006 7.07349 71.601 6.32283 73.8078 6.32283C76.0147 6.32283 77.7957 7.06387 79.1508 8.54593C80.5252 10.0087 81.2124 11.8565 81.2124 14.0892L81.1834 15.1575ZM73.8078 9.12336C72.7237 9.12336 71.8236 9.44095 71.1073 10.0761C70.391 10.7113 69.9458 11.5582 69.7716 12.6168H77.786C77.6311 11.5582 77.2052 10.7113 76.5083 10.0761C75.8114 9.44095 74.9113 9.12336 73.8078 9.12336Z",fill:"currentColor"}),_.createElement("path",{d:"M86.8426 6.66929V8.66142C87.191 8.007 87.7621 7.45844 88.5558 7.01575C89.3689 6.55381 90.3465 6.32283 91.4886 6.32283C93.2696 6.32283 94.6441 6.86177 95.612 7.93963C96.5993 9.0175 97.0929 10.4514 97.0929 12.2415V21.6535H93.6374V12.6745C93.6374 11.6159 93.3858 10.7883 92.8824 10.1916C92.3985 9.57568 91.6532 9.26772 90.6465 9.26772C89.5431 9.26772 88.672 9.59493 88.0331 10.2493C87.4137 10.9038 87.1039 11.8084 87.1039 12.9633V21.6535H83.6484V6.66929H86.8426Z",fill:"currentColor"}),_.createElement("path",{d:"M107.185 18.5932V21.5669C106.759 21.6824 106.159 21.7402 105.384 21.7402C102.442 21.7402 100.971 20.2677 100.971 17.3228V9.41208H98.6766V6.66929H100.971V2.77165H104.426V6.66929H107.243V9.41208H104.426V16.9764C104.426 18.1505 104.987 18.7375 106.11 18.7375L107.185 18.5932Z",fill:"currentColor"}),_.createElement("path",{d:"M116.115 18.9881C114.474 17.2035 113.653 14.9429 113.653 12.2064C113.653 9.4699 114.474 7.21782 116.115 5.45015C117.773 3.66548 119.953 2.77314 122.654 2.77314C124.876 2.77314 126.756 3.38503 128.295 4.6088C129.833 5.83258 130.816 7.47277 131.244 9.52939H129.269C128.91 7.99967 128.132 6.7844 126.936 5.88357C125.739 4.98273 124.312 4.53232 122.654 4.53232C120.534 4.53232 118.824 5.23769 117.525 6.64842C116.243 8.05916 115.602 9.91182 115.602 12.2064C115.602 14.501 116.243 16.3536 117.525 17.7644C118.824 19.1751 120.534 19.8805 122.654 19.8805C124.312 19.8805 125.739 19.4301 126.936 18.5292C128.132 17.6284 128.91 16.4131 129.269 14.8834H131.244C130.816 16.94 129.833 18.5802 128.295 19.804C126.756 21.0278 124.876 21.6397 122.654 21.6397C119.953 21.6397 117.773 20.7558 116.115 18.9881Z",fill:"currentColor"}),_.createElement("path",{d:"M143.174 15.0874C140.832 15.0874 139.233 15.1384 138.379 15.2403C137.541 15.3253 136.926 15.4698 136.532 15.6738C135.831 16.0647 135.481 16.6936 135.481 17.5604C135.481 19.2261 136.473 20.0589 138.456 20.0589C139.977 20.0589 141.139 19.719 141.943 19.0391C142.763 18.3593 143.174 17.4499 143.174 16.3111V15.0874ZM138.25 21.5632C136.763 21.5632 135.626 21.2062 134.84 20.4924C134.071 19.7615 133.686 18.8012 133.686 17.6114C133.686 16.8295 133.891 16.1327 134.301 15.5208C134.729 14.9089 135.31 14.4585 136.045 14.1695C136.661 13.9316 137.455 13.7786 138.43 13.7106C139.404 13.6256 140.986 13.5831 143.174 13.5831V12.7418C143.174 10.6002 141.943 9.52939 139.481 9.52939C137.361 9.52939 136.131 10.3877 135.789 12.1044H134.019C134.207 10.8466 134.746 9.84383 135.635 9.09597C136.541 8.34811 137.849 7.97418 139.558 7.97418C141.387 7.97418 142.746 8.3991 143.635 9.24894C144.541 10.0988 144.994 11.2716 144.994 12.7673V21.2572H143.251V19.3706C142.345 20.8323 140.678 21.5632 138.25 21.5632Z",fill:"currentColor"}),_.createElement("path",{d:"M149.358 18.4018V2.13576H151.178V18.1978C151.178 18.7247 151.264 19.0901 151.435 19.2941C151.623 19.498 151.956 19.6 152.435 19.6L152.948 19.549V21.2062C152.657 21.2572 152.341 21.2827 151.999 21.2827C150.238 21.2827 149.358 20.3224 149.358 18.4018Z",fill:"currentColor"}),_.createElement("path",{d:"M155.944 18.4018V2.13576H157.764V18.1978C157.764 18.7247 157.85 19.0901 158.021 19.2941C158.209 19.498 158.542 19.6 159.021 19.6L159.534 19.549V21.2062C159.243 21.2572 158.927 21.2827 158.585 21.2827C156.824 21.2827 155.944 20.3224 155.944 18.4018Z",fill:"currentColor"})))),jUe=_.forwardRef(DUe),bU=e=>{const t=document.activeElement;return null!==t&&t.contains(e)},SU=Object.fromEntries(ry.slice(0,5).map(((e,t)=>[(t+1).toString(),e])));function UUe(e,t,n,r,i,o){const s=_.useRef(!1);ov(window,"keydown",_.useCallback((a=>{null!==e.current&&bU(e.current)&&(a.altKey||a.ctrlKey||a.metaKey||a.shiftKey||("m"===a.key?(a.preventDefault(),t()):"v"==a.key?(a.preventDefault(),n()):" "===a.key?(a.preventDefault(),s.current||(s.current=!0,r(!1))):"h"===a.key?(a.preventDefault(),o()):SU[a.key]&&(a.preventDefault(),i(SU[a.key]))))}),[e,n,t,r,i,o]),_.useMemo((()=>({capture:!0})),[])),ov(window,"keyup",_.useCallback((t=>{null!==e.current&&bU(e.current)&&" "===t.key&&(s.current=!1,r(!0))}),[e,r])),ov(window,"blur",_.useCallback((()=>{s.current&&(s.current=!1,r(!0))}),[r,s]))}const FUe="_tile_vtjqb_8",$Ue="_speaking_vtjqb_27",HUe="_handRaised_vtjqb_47",BUe="_muteIcon_vtjqb_74",VUe="_volumeSlider_vtjqb_82",$g={tile:FUe,speaking:$Ue,handRaised:HUe,muteIcon:BUe,volumeSlider:VUe};class Eee{constructor(){this.ended$=new Or,this.bindImpl=W5e(this.ended$),this.stateImpl=e=>e.pipe(this.bind(),va(),V5e({bufferSize:1,refCount:!1}))}bind(){return this.bindImpl}state(){return this.stateImpl}end(){this.ended$.next(),this.ended$.complete()}}class Gw{constructor(){this.scope=new Eee}destroy(){this.scope.end()}}const EU=Symbol("nothing");function qUe(e){return t=>w5e((()=>{let n=EU;return t.pipe(z5e((e=>n=e)),BZ((()=>{n!==EU&&e(n)})))}))}function fP(e,t){return n=>n.pipe(nl(t,e),un(e))}function lE(e,t){return e.pipe(Pt((e=>e?P4(e).pipe(Ne((()=>({participant:e,publication:e.getTrackPublication(t),source:t}))),H5e("publication")):Rt(void 0))))}function wee(e,t,n){return $n([lE(Rt(e),t),Qx(1e3).pipe(un(0))]).pipe(Pt((async([e])=>{var t;const r=null==(t=null==e?void 0:e.publication)?void 0:t.track;if(!r||!(r instanceof wL||r instanceof KE))return;const i=await r.getRTCStatsReport();if(i)for(const e of i.values())if(e.type===n)return e})),un(void 0))}function hP(e,t){return wee(e,t,"inbound-rtp").pipe(Ne((e=>e)))}function wU(e,t){return wee(e,t,"outbound-rtp").pipe(Ne((e=>e)))}function __(e,t){let n={framesDecoded:void 0,framesReceived:void 0};return hP(e,t).pipe(Ne((e=>{if(!e)return;const{framesDecoded:t,framesDropped:n,framesReceived:r}=e;return{framesDecoded:t,framesDropped:n,framesReceived:r}})),Fo((e=>!!e)),Ne((e=>{const t=n;if(n=e,"number"==typeof e.framesReceived&&"number"==typeof t.framesReceived&&"number"==typeof e.framesDecoded&&"number"==typeof t.framesDecoded){const n=e.framesReceived-t.framesReceived,r=e.framesDecoded-t.framesDecoded;if(n>0)return r>0}})),Fo((e=>"boolean"==typeof e)),un(void 0))}function dI(e,t,n,r){return G8e(e,le.EncryptionError).pipe(Ne((e=>{const[i]=e;return n.kind===Ut.PER_PARTICIPANT?((null==i?void 0:i.message.includes(t.identity))&&(null==i?void 0:i.message.includes(r)))??!1:n.kind===Ut.SHARED_KEY&&!(null==i||!i.message.includes(r))})),Y5e(1e3),un(!1))}class Cee extends Gw{constructor(e,t,n,r,i,o,s,a){super(),this.id=e,this.member=t,this.participant$=n,this.displayname$=a;const l=lE(n,i).pipe(this.scope.state());this.video$=lE(n,o).pipe(this.scope.state()),this.unencryptedWarning$=$n([l,this.video$],((e,t)=>{var n,i;return r.kind!==Ut.NONE&&(!1===(null==(n=null==e?void 0:e.publication)?void 0:n.isEncrypted)||!1===(null==(i=null==t?void 0:t.publication)?void 0:i.isEncrypted))})).pipe(this.scope.state()),this.encryptionStatus$=this.participant$.pipe(Pt((e=>e?e.isLocal||r.kind===Ut.NONE?Rt(1):r.kind===Ut.PER_PARTICIPANT?$n([dI(s,e,r,"MissingKey"),dI(s,e,r,"InvalidKey"),__(e,i),__(e,o)]).pipe(Ne((([e,t,n,r])=>e?2:t?3:n||r?1:void 0)),Fo((e=>!!e)),un(0)):$n([dI(s,e,r,"InvalidKey"),__(e,i),__(e,o)]).pipe(Ne((([e,t,n])=>e?4:t||n?1:void 0)),Fo((e=>!!e)),un(0)):Rt(0))),this.scope.state())}}class Tee extends Cee{constructor(e,t,n,r,i,o,s,a){super(e,t,n,r,ue.Source.Microphone,ue.Source.Camera,i,o),this.handRaised$=s,this.reaction$=a,this.speaking$=this.participant$.pipe(Pt((e=>e?x4(e,oe.IsSpeakingChanged).pipe(Ne((e=>e.isSpeaking))):Rt(!1))),this.scope.state()),this._cropVideo$=new ns(!0),this.cropVideo$=this._cropVideo$;const l=n.pipe(Pt((e=>(e&&P4(e))??Rt(void 0))),this.scope.state());this.audioEnabled$=l.pipe(Ne((e=>{var t;return!1===(null==(t=null==e?void 0:e.microphoneTrack)?void 0:t.isMuted)}))),this.videoEnabled$=l.pipe(Ne((e=>{var t;return!1===(null==(t=null==e?void 0:e.cameraTrack)?void 0:t.isMuted)})))}toggleFitContain(){this._cropVideo$.next(!this._cropVideo$.value)}get local(){return this instanceof kp}}class kp extends Tee{constructor(e,t,n,r,i,o,s,a){super(e,t,n,r,i,o,s,a),this.mirror$=this.video$.pipe(Pt((e=>{var t;const n=null==(t=null==e?void 0:e.publication)?void 0:t.track;return n instanceof KE?Sa(n,Re.Restarted).pipe(un(null),Ne((()=>"user"===CL(n).facingMode))):Rt(!1)})),this.scope.state()),this.alwaysShow$=Gj.value$,this.setAlwaysShow=Gj.setValue,this.audioStreamStats$=$n([this.participant$,ly.value$]).pipe(Pt((([e,t])=>e&&t?wU(e,ue.Source.Microphone):Rt(void 0)))),this.videoStreamStats$=$n([this.participant$,ly.value$]).pipe(Pt((([e,t])=>e&&t?wU(e,ue.Source.Camera):Rt(void 0))))}}class KUe extends Tee{constructor(e,t,n,r,i,o,s,a){super(e,t,n,r,i,o,s,a),this.locallyMutedToggle$=new Or,this.localVolumeAdjustment$=new Or,this.localVolumeCommit$=new Or,this.localVolume$=sy(this.locallyMutedToggle$.pipe(Ne((()=>"toggle mute"))),this.localVolumeAdjustment$,this.localVolumeCommit$.pipe(Ne((()=>"commit")))).pipe(fP({volume:1,committedVolume:1},((e,t)=>{switch(t){case"toggle mute":return{...e,volume:0===e.volume?e.committedVolume:0};case"commit":return{...e,committedVolume:0===e.volume?e.committedVolume:e.volume};default:return{...e,volume:t}}})),Ne((({volume:e})=>e)),this.scope.state()),this.locallyMuted$=this.localVolume$.pipe(Ne((e=>0===e)),this.scope.state()),this.audioStreamStats$=$n([this.participant$,ly.value$]).pipe(Pt((([e,t])=>e&&t?hP(e,ue.Source.Microphone):Rt(void 0)))),this.videoStreamStats$=$n([this.participant$,ly.value$]).pipe(Pt((([e,t])=>e&&t?hP(e,ue.Source.Camera):Rt(void 0)))),$n([n,this.localVolume$.pipe(this.scope.bind())]).subscribe((([e,t])=>e&&e.setVolume(t)))}toggleLocallyMuted(){this.locallyMutedToggle$.next()}setLocalVolume(e){this.localVolumeAdjustment$.next(e)}commitLocalVolume(){this.localVolumeCommit$.next()}}class kh extends Cee{constructor(e,t,n,r,i,o,s){super(e,t,n,r,ue.Source.ScreenShareAudio,ue.Source.ScreenShare,i,o),this.local=s}}var B4=r0(),dt=e=>n0(e,B4),V4=r0();dt.write=e=>n0(e,V4);var Ww=r0();dt.onStart=e=>n0(e,Ww);var q4=r0();dt.onFrame=e=>n0(e,q4);var K4=r0();dt.onFinish=e=>n0(e,K4);var np=[];dt.setTimeout=(e,t)=>{const n=dt.now()+t,r=()=>{const e=np.findIndex((e=>e.cancel==r));~e&&np.splice(e,1),Wc-=~e?1:0},i={time:n,handler:e,cancel:r};return np.splice(Ree(n),0,i),Wc+=1,Iee(),i};var Ree=e=>~(~np.findIndex((t=>t.time>e))||~np.length);dt.cancel=e=>{Ww.delete(e),q4.delete(e),K4.delete(e),B4.delete(e),V4.delete(e)},dt.sync=e=>{pP=!0,dt.batchedUpdates(e),pP=!1},dt.throttle=e=>{let t;function n(){try{e(...t)}finally{t=null}}function r(...e){t=e,dt.onStart(n)}return r.handler=e,r.cancel=()=>{Ww.delete(n),t=null},r};var G4=typeof window<"u"?window.requestAnimationFrame:()=>{};dt.use=e=>G4=e,dt.now=typeof performance<"u"?()=>performance.now():Date.now,dt.batchedUpdates=e=>e(),dt.catch=console.error,dt.frameLoop="always",dt.advance=()=>{"demand"!==dt.frameLoop?console.warn("Cannot call the manual advancement of rafz whilst frameLoop is not set as demand"):xee()};var Gc=-1,Wc=0,pP=!1;function n0(e,t){pP?(t.delete(e),e(0)):(t.add(e),Iee())}function Iee(){Gc<0&&(Gc=0,"demand"!==dt.frameLoop&&G4(kee))}function GUe(){Gc=-1}function kee(){~Gc&&(G4(kee),dt.batchedUpdates(xee))}function xee(){const e=Gc;Gc=dt.now();const t=Ree(Gc);t&&(Pee(np.splice(0,t),(e=>e.handler())),Wc-=t),Wc?(Ww.flush(),B4.flush(e?Math.min(64,Gc-e):16.667),q4.flush(),V4.flush(),K4.flush()):GUe()}function r0(){let e=new Set,t=e;return{add(n){Wc+=t!=e||e.has(n)?0:1,e.add(n)},delete:n=>(Wc-=t==e&&e.has(n)?1:0,e.delete(n)),flush(n){t.size&&(e=new Set,Wc-=t.size,Pee(t,(t=>t(n)&&e.add(t))),Wc+=e.size,t=e)}}}function Pee(e,t){e.forEach((e=>{try{t(e)}catch(e){dt.catch(e)}}))}var WUe=Object.defineProperty,zUe=(e,t)=>{for(var n in t)WUe(e,n,{get:t[n],enumerable:!0})},Vo={};function mP(){}zUe(Vo,{assign:()=>JUe,colors:()=>iu,createStringInterpolator:()=>z4,skipAnimation:()=>Oee,to:()=>Lee,willAdvance:()=>Y4});var YUe=(e,t,n)=>Object.defineProperty(e,t,{value:n,writable:!0,configurable:!0}),Ee={arr:Array.isArray,obj:e=>!!e&&"Object"===e.constructor.name,fun:e=>"function"==typeof e,str:e=>"string"==typeof e,num:e=>"number"==typeof e,und:e=>void 0===e};function cl(e,t){if(Ee.arr(e)){if(!Ee.arr(t)||e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}return e===t}var gt=(e,t)=>e.forEach(t);function ka(e,t,n){if(Ee.arr(e))for(let r=0;r<e.length;r++)t.call(n,e[r],`${r}`);else for(const r in e)e.hasOwnProperty(r)&&t.call(n,e[r],r)}var wi=e=>Ee.und(e)?[]:Ee.arr(e)?e:[e];function mv(e,t){if(e.size){const n=Array.from(e);e.clear(),gt(n,t)}}var z4,Lee,Hg=(e,...t)=>mv(e,(e=>e(...t))),W4=()=>typeof window>"u"||!window.navigator||/ServerSideRendering|^Deno\//.test(window.navigator.userAgent),iu=null,Oee=!1,Y4=mP,JUe=e=>{e.to&&(Lee=e.to),e.now&&(dt.now=e.now),void 0!==e.colors&&(iu=e.colors),null!=e.skipAnimation&&(Oee=e.skipAnimation),e.createStringInterpolator&&(z4=e.createStringInterpolator),e.requestAnimationFrame&&dt.use(e.requestAnimationFrame),e.batchedUpdates&&(dt.batchedUpdates=e.batchedUpdates),e.willAdvance&&(Y4=e.willAdvance),e.frameLoop&&(dt.frameLoop=e.frameLoop)},gv=new Set,$s=[],fI=[],cE=0,zw={get idle(){return!gv.size&&!$s.length},start(e){cE>e.priority?(gv.add(e),dt.onStart(XUe)):(Mee(e),dt(gP))},advance:gP,sort(e){if(cE)dt.onFrame((()=>zw.sort(e)));else{const t=$s.indexOf(e);~t&&($s.splice(t,1),Aee(e))}},clear(){$s=[],gv.clear()}};function XUe(){gv.forEach(Mee),gv.clear(),dt(gP)}function Mee(e){$s.includes(e)||Aee(e)}function Aee(e){$s.splice(ZUe($s,(t=>t.priority>e.priority)),0,e)}function gP(e){const t=fI;for(let n=0;n<$s.length;n++){const r=$s[n];cE=r.priority,r.idle||(Y4(r),r.advance(e),r.idle||t.push(r))}return cE=0,(fI=$s).length=0,($s=t).length>0}function ZUe(e,t){const n=e.findIndex(t);return n<0?e.length:n}var QUe={transparent:0,aliceblue:4042850303,antiquewhite:4209760255,aqua:16777215,aquamarine:2147472639,azure:4043309055,beige:4126530815,bisque:4293182719,black:255,blanchedalmond:4293643775,blue:65535,blueviolet:2318131967,brown:2771004159,burlywood:3736635391,burntsienna:3934150143,cadetblue:1604231423,chartreuse:2147418367,chocolate:3530104575,coral:4286533887,cornflowerblue:1687547391,cornsilk:4294499583,crimson:3692313855,cyan:16777215,darkblue:35839,darkcyan:9145343,darkgoldenrod:3095792639,darkgray:2846468607,darkgreen:6553855,darkgrey:2846468607,darkkhaki:3182914559,darkmagenta:2332068863,darkolivegreen:1433087999,darkorange:4287365375,darkorchid:2570243327,darkred:2332033279,darksalmon:3918953215,darkseagreen:2411499519,darkslateblue:1211993087,darkslategray:793726975,darkslategrey:793726975,darkturquoise:13554175,darkviolet:2483082239,deeppink:4279538687,deepskyblue:12582911,dimgray:1768516095,dimgrey:1768516095,dodgerblue:512819199,firebrick:2988581631,floralwhite:4294635775,forestgreen:579543807,fuchsia:4278255615,gainsboro:3705462015,ghostwhite:4177068031,gold:4292280575,goldenrod:3668254975,gray:2155905279,green:8388863,greenyellow:2919182335,grey:2155905279,honeydew:4043305215,hotpink:4285117695,indianred:3445382399,indigo:1258324735,ivory:4294963455,khaki:4041641215,lavender:3873897215,lavenderblush:4293981695,lawngreen:2096890111,lemonchiffon:4294626815,lightblue:2916673279,lightcoral:4034953471,lightcyan:3774873599,lightgoldenrodyellow:4210742015,lightgray:3553874943,lightgreen:2431553791,lightgrey:3553874943,lightpink:4290167295,lightsalmon:4288707327,lightseagreen:548580095,lightskyblue:2278488831,lightslategray:2005441023,lightslategrey:2005441023,lightsteelblue:2965692159,lightyellow:4294959359,lime:16711935,limegreen:852308735,linen:4210091775,magenta:4278255615,maroon:2147483903,mediumaquamarine:1724754687,mediumblue:52735,mediumorchid:3126187007,mediumpurple:2473647103,mediumseagreen:1018393087,mediumslateblue:2070474495,mediumspringgreen:16423679,mediumturquoise:1221709055,mediumvioletred:3340076543,midnightblue:421097727,mintcream:4127193855,mistyrose:4293190143,moccasin:4293178879,navajowhite:4292783615,navy:33023,oldlace:4260751103,olive:2155872511,olivedrab:1804477439,orange:4289003775,orangered:4282712319,orchid:3664828159,palegoldenrod:4008225535,palegreen:2566625535,paleturquoise:2951671551,palevioletred:3681588223,papayawhip:4293907967,peachpuff:4292524543,peru:3448061951,pink:4290825215,plum:3718307327,powderblue:2967529215,purple:2147516671,rebeccapurple:1714657791,red:4278190335,rosybrown:3163525119,royalblue:1097458175,saddlebrown:2336560127,salmon:4202722047,sandybrown:4104413439,seagreen:780883967,seashell:4294307583,sienna:2689740287,silver:3233857791,skyblue:2278484991,slateblue:1784335871,slategray:1887473919,slategrey:1887473919,snow:4294638335,springgreen:16744447,steelblue:1182971135,tan:3535047935,teal:8421631,thistle:3636451583,tomato:4284696575,turquoise:1088475391,violet:4001558271,wheat:4125012991,white:4294967295,whitesmoke:4126537215,yellow:4294902015,yellowgreen:2597139199},Do="[-+]?\\d*\\.?\\d+",uE=Do+"%";function Yw(...e){return"\\(\\s*("+e.join(")\\s*,\\s*(")+")\\s*\\)"}var eFe=new RegExp("rgb"+Yw(Do,Do,Do)),tFe=new RegExp("rgba"+Yw(Do,Do,Do,Do)),nFe=new RegExp("hsl"+Yw(Do,uE,uE)),rFe=new RegExp("hsla"+Yw(Do,uE,uE,Do)),iFe=/^#([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,sFe=/^#([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,oFe=/^#([0-9a-fA-F]{6})$/,aFe=/^#([0-9a-fA-F]{8})$/;function lFe(e){let t;return"number"==typeof e?e>>>0===e&&e>=0&&e<=4294967295?e:null:(t=oFe.exec(e))?parseInt(t[1]+"ff",16)>>>0:iu&&void 0!==iu[e]?iu[e]:(t=eFe.exec(e))?(ih(t[1])<<24|ih(t[2])<<16|ih(t[3])<<8|255)>>>0:(t=tFe.exec(e))?(ih(t[1])<<24|ih(t[2])<<16|ih(t[3])<<8|RU(t[4]))>>>0:(t=iFe.exec(e))?parseInt(t[1]+t[1]+t[2]+t[2]+t[3]+t[3]+"ff",16)>>>0:(t=aFe.exec(e))?parseInt(t[1],16)>>>0:(t=sFe.exec(e))?parseInt(t[1]+t[1]+t[2]+t[2]+t[3]+t[3]+t[4]+t[4],16)>>>0:(t=nFe.exec(e))?(255|CU(TU(t[1]),b_(t[2]),b_(t[3])))>>>0:(t=rFe.exec(e))?(CU(TU(t[1]),b_(t[2]),b_(t[3]))|RU(t[4]))>>>0:null}function hI(e,t,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?e+6*(t-e)*n:n<.5?t:n<2/3?e+(t-e)*(2/3-n)*6:e}function CU(e,t,n){const r=n<.5?n*(1+t):n+t-n*t,i=2*n-r,o=hI(i,r,e+1/3),s=hI(i,r,e),a=hI(i,r,e-1/3);return Math.round(255*o)<<24|Math.round(255*s)<<16|Math.round(255*a)<<8}function ih(e){const t=parseInt(e,10);return t<0?0:t>255?255:t}function TU(e){return(parseFloat(e)%360+360)%360/360}function RU(e){const t=parseFloat(e);return t<0?0:t>1?255:Math.round(255*t)}function b_(e){const t=parseFloat(e);return t<0?0:t>100?1:t/100}function IU(e){let t=lFe(e);if(null===t)return e;t=t||0;return`rgba(${(4278190080&t)>>>24}, ${(16711680&t)>>>16}, ${(65280&t)>>>8}, ${(255&t)/255})`}var dy=(e,t,n)=>{if(Ee.fun(e))return e;if(Ee.arr(e))return dy({range:e,output:t,extrapolate:n});if(Ee.str(e.output[0]))return z4(e);const r=e,i=r.output,o=r.range||[0,1],s=r.extrapolateLeft||r.extrapolate||"extend",a=r.extrapolateRight||r.extrapolate||"extend",l=r.easing||(e=>e);return e=>{const t=uFe(e,o);return cFe(e,o[t],o[t+1],i[t],i[t+1],l,s,a,r.map)}};function cFe(e,t,n,r,i,o,s,a,l){let c=l?l(e):e;if(c<t){if("identity"===s)return c;"clamp"===s&&(c=t)}if(c>n){if("identity"===a)return c;"clamp"===a&&(c=n)}return r===i?r:t===n?e<=t?r:i:(t===-1/0?c=-c:n===1/0?c-=t:c=(c-t)/(n-t),c=o(c),r===-1/0?c=-c:i===1/0?c+=r:c=c*(i-r)+r,c)}function uFe(e,t){for(var n=1;n<t.length-1&&!(t[n]>=e);++n);return n-1}var dFe={linear:e=>e},fy=Symbol.for("FluidValue.get"),xp=Symbol.for("FluidValue.observers"),Us=e=>!(!e||!e[fy]),Bi=e=>e&&e[fy]?e[fy]():e,kU=e=>e[xp]||null;function fFe(e,t){e.eventObserved?e.eventObserved(t):e(t)}function hy(e,t){const n=e[xp];n&&n.forEach((e=>{fFe(e,t)}))}var Nee=class{constructor(e){if(!e&&!(e=this.get))throw Error("Unknown getter");hFe(this,e)}},hFe=(e,t)=>Dee(e,fy,t);function im(e,t){if(e[fy]){let n=e[xp];n||Dee(e,xp,n=new Set),n.has(t)||(n.add(t),e.observerAdded&&e.observerAdded(n.size,t))}return t}function py(e,t){const n=e[xp];if(n&&n.has(t)){const r=n.size-1;r?n.delete(t):e[xp]=null,e.observerRemoved&&e.observerRemoved(r,t)}}var pI,Dee=(e,t,n)=>Object.defineProperty(e,t,{value:n,writable:!0,configurable:!0}),Nb=/[+\-]?(?:0|[1-9]\d*)(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,pFe=/(#(?:[0-9a-f]{2}){2,4}|(#[0-9a-f]{3})|(rgb|hsl)a?\((-?\d+%?[,\s]+){2,3}\s*[\d\.]+%?\))/gi,xU=new RegExp(`(${Nb.source})(%|[a-z]+)`,"i"),mFe=/rgba\(([0-9\.-]+), ([0-9\.-]+), ([0-9\.-]+), ([0-9\.-]+)\)/gi,Jw=/var\((--[a-zA-Z0-9-_]+),? ?([a-zA-Z0-9 ()%#.,-]+)?\)/,jee=e=>{const[t,n]=gFe(e);if(!t||W4())return e;const r=window.getComputedStyle(document.documentElement).getPropertyValue(t);if(r)return r.trim();if(n&&n.startsWith("--")){return window.getComputedStyle(document.documentElement).getPropertyValue(n)||e}return n&&Jw.test(n)?jee(n):n||e},gFe=e=>{const t=Jw.exec(e);if(!t)return[,];const[,n,r]=t;return[n,r]},vFe=(e,t,n,r,i)=>`rgba(${Math.round(t)}, ${Math.round(n)}, ${Math.round(r)}, ${i})`,Uee=e=>{pI||(pI=iu?new RegExp(`(${Object.keys(iu).join("|")})(?!\\w)`,"g"):/^\b$/);const t=e.output.map((e=>Bi(e).replace(Jw,jee).replace(pFe,IU).replace(pI,IU))),n=t.map((e=>e.match(Nb).map(Number))),r=n[0].map(((e,t)=>n.map((e=>{if(!(t in e))throw Error('The arity of each "output" value must be equal');return e[t]})))).map((t=>dy({...e,output:t})));return e=>{var n;const i=!xU.test(t[0])&&(null==(n=t.find((e=>xU.test(e))))?void 0:n.replace(Nb,""));let o=0;return t[0].replace(Nb,(()=>`${r[o++](e)}${i||""}`)).replace(mFe,vFe)}},J4="react-spring: ",Fee=e=>{const t=e;let n=!1;if("function"!=typeof t)throw new TypeError(`${J4}once requires a function parameter`);return(...e)=>{n||(t(...e),n=!0)}},yFe=Fee(console.warn);function _Fe(){yFe(`${J4}The "interpolate" function is deprecated in v9 (use "to" instead)`)}var bFe=Fee(console.warn);function SFe(){bFe(`${J4}Directly calling start instead of using the api object is deprecated in v9 (use ".start" instead), this will be removed in later 0.X.0 versions`)}function Xw(e){return Ee.str(e)&&("#"==e[0]||/\d/.test(e)||!W4()&&Jw.test(e)||e in(iu||{}))}var xh=W4()?_.useEffect:_.useLayoutEffect,EFe=()=>{const e=_.useRef(!1);return xh((()=>(e.current=!0,()=>{e.current=!1})),[]),e};function $ee(){const e=_.useState()[1],t=EFe();return()=>{t.current&&e(Math.random())}}function wFe(e,t){const[n]=_.useState((()=>({inputs:t,result:e()}))),r=_.useRef(),i=r.current;let o=i;return o?t&&o.inputs&&CFe(t,o.inputs)||(o={inputs:t,result:e()}):o=n,_.useEffect((()=>{r.current=o,i==n&&(n.inputs=n.result=void 0)}),[o]),o.result}function CFe(e,t){if(e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}var Hee=e=>_.useEffect(e,TFe),TFe=[];function RFe(e){const t=_.useRef();return _.useEffect((()=>{t.current=e})),t.current}var my=Symbol.for("Animated:node"),IFe=e=>!!e&&e[my]===e,fa=e=>e&&e[my],X4=(e,t)=>YUe(e,my,t),Zw=e=>e&&e[my]&&e[my].getPayload(),Bee=class{constructor(){X4(this,this)}getPayload(){return this.payload||[]}},i0=class extends Bee{constructor(e){super(),this._value=e,this.done=!0,this.durationProgress=0,Ee.num(this._value)&&(this.lastPosition=this._value)}static create(e){return new i0(e)}getPayload(){return[this]}getValue(){return this._value}setValue(e,t){return Ee.num(e)&&(this.lastPosition=e,t&&(e=Math.round(e/t)*t,this.done&&(this.lastPosition=e))),this._value!==e&&(this._value=e,!0)}reset(){const{done:e}=this;this.done=!1,Ee.num(this._value)&&(this.elapsedTime=0,this.durationProgress=0,this.lastPosition=this._value,e&&(this.lastVelocity=null),this.v0=null)}},gy=class extends i0{constructor(e){super(0),this._string=null,this._toString=dy({output:[e,e]})}static create(e){return new gy(e)}getValue(){return this._string??(this._string=this._toString(this._value))}setValue(e){if(Ee.str(e)){if(e==this._string)return!1;this._string=e,this._value=1}else{if(!super.setValue(e))return!1;this._string=null}return!0}reset(e){e&&(this._toString=dy({output:[this.getValue(),e]})),this._value=0,super.reset()}},dE={dependencies:null},Qw=class extends Bee{constructor(e){super(),this.source=e,this.setValue(e)}getValue(e){const t={};return ka(this.source,((n,r)=>{IFe(n)?t[r]=n.getValue(e):Us(n)?t[r]=Bi(n):e||(t[r]=n)})),t}setValue(e){this.source=e,this.payload=this._makePayload(e)}reset(){this.payload&&gt(this.payload,(e=>e.reset()))}_makePayload(e){if(e){const t=new Set;return ka(e,this._addToPayload,t),Array.from(t)}}_addToPayload(e){dE.dependencies&&Us(e)&&dE.dependencies.add(e);const t=Zw(e);t&&gt(t,(e=>this.add(e)))}},Vee=class extends Qw{constructor(e){super(e)}static create(e){return new Vee(e)}getValue(){return this.source.map((e=>e.getValue()))}setValue(e){const t=this.getPayload();return e.length==t.length?t.map(((t,n)=>t.setValue(e[n]))).some(Boolean):(super.setValue(e.map(kFe)),!0)}};function kFe(e){return(Xw(e)?gy:i0).create(e)}function vP(e){const t=fa(e);return t?t.constructor:Ee.arr(e)?Vee:Xw(e)?gy:i0}var PU=(e,t)=>{const n=!Ee.fun(e)||e.prototype&&e.prototype.isReactComponent;return _.forwardRef(((r,i)=>{const o=_.useRef(null),s=n&&_.useCallback((e=>{o.current=LFe(i,e)}),[i]),[a,l]=PFe(r,t),c=$ee(),u=()=>{const e=o.current;n&&!e||!1===(!!e&&t.applyAnimatedValues(e,a.getValue(!0)))&&c()},d=new xFe(u,l),h=_.useRef();xh((()=>(h.current=d,gt(l,(e=>im(e,d))),()=>{h.current&&(gt(h.current.deps,(e=>py(e,h.current))),dt.cancel(h.current.update))}))),_.useEffect(u,[]),Hee((()=>()=>{const e=h.current;gt(e.deps,(t=>py(t,e)))}));const p=t.getComponentProps(a.getValue());return _.createElement(e,{...p,ref:s})}))},xFe=class{constructor(e,t){this.update=e,this.deps=t}eventObserved(e){"change"==e.type&&dt.write(this.update)}};function PFe(e,t){const n=new Set;return dE.dependencies=n,e.style&&(e={...e,style:t.createAnimatedStyle(e.style)}),e=new Qw(e),dE.dependencies=null,[e,n]}function LFe(e,t){return e&&(Ee.fun(e)?e(t):e.current=t),t}var LU=Symbol.for("AnimatedComponent"),OFe=(e,{applyAnimatedValues:t=()=>!1,createAnimatedStyle:n=e=>new Qw(e),getComponentProps:r=e=>e}={})=>{const i={applyAnimatedValues:t,createAnimatedStyle:n,getComponentProps:r},o=e=>{const t=OU(e)||"Anonymous";return(e=Ee.str(e)?o[e]||(o[e]=PU(e,i)):e[LU]||(e[LU]=PU(e,i))).displayName=`Animated(${t})`,e};return ka(e,((t,n)=>{Ee.arr(e)&&(n=OU(t)),o[n]=o(t)})),{animated:o}},OU=e=>Ee.str(e)?e:e&&Ee.str(e.displayName)?e.displayName:Ee.fun(e)&&e.name||null;function Vi(e,...t){return Ee.fun(e)?e(...t):e}var vv=(e,t)=>!0===e||!!(t&&e&&(Ee.fun(e)?e(t):wi(e).includes(t))),qee=(e,t)=>Ee.obj(e)?t&&e[t]:e,Kee=(e,t)=>!0===e.default?e[t]:e.default?e.default[t]:void 0,MFe=e=>e,Z4=(e,t=MFe)=>{let n=AFe;e.default&&!0!==e.default&&(e=e.default,n=Object.keys(e));const r={};for(const i of n){const n=t(e[i],i);Ee.und(n)||(r[i]=n)}return r},AFe=["config","onProps","onStart","onChange","onPause","onResume","onRest"],NFe={config:1,from:1,to:1,ref:1,loop:1,reset:1,pause:1,cancel:1,reverse:1,immediate:1,default:1,delay:1,onProps:1,onStart:1,onChange:1,onPause:1,onResume:1,onRest:1,onResolve:1,items:1,trail:1,sort:1,expires:1,initial:1,enter:1,update:1,leave:1,children:1,onDestroyed:1,keys:1,callId:1,parentId:1};function DFe(e){const t={};let n=0;if(ka(e,((e,r)=>{NFe[r]||(t[r]=e,n++)})),n)return t}function Q4(e){const t=DFe(e);if(t){const n={to:t};return ka(e,((e,r)=>r in t||(n[r]=e))),n}return{...e}}function vy(e){return e=Bi(e),Ee.arr(e)?e.map(vy):Xw(e)?Vo.createStringInterpolator({range:[0,1],output:[e,e]})(1):e}function jFe(e){for(const t in e)return!0;return!1}function yP(e){return Ee.fun(e)||Ee.arr(e)&&Ee.obj(e[0])}function MU(e,t){var n;null==(n=e.ref)||n.delete(e),null==t||t.delete(e)}function UFe(e,t){var n;t&&e.ref!==t&&(null==(n=e.ref)||n.delete(e),t.add(e),e.ref=t)}var FFe={default:{tension:170,friction:26}},_P={...FFe.default,mass:1,damping:1,easing:dFe.linear,clamp:!1},$Fe=class{constructor(){this.velocity=0,Object.assign(this,_P)}};function HFe(e,t,n){n&&(AU(n={...n},t),t={...n,...t}),AU(e,t),Object.assign(e,t);for(const t in _P)null==e[t]&&(e[t]=_P[t]);let{frequency:r,damping:i}=e;const{mass:o}=e;return Ee.und(r)||(r<.01&&(r=.01),i<0&&(i=0),e.tension=Math.pow(2*Math.PI/r,2)*o,e.friction=4*Math.PI*i*o/r),e}function AU(e,t){if(Ee.und(t.decay)){const n=!Ee.und(t.tension)||!Ee.und(t.friction);(n||!Ee.und(t.frequency)||!Ee.und(t.damping)||!Ee.und(t.mass))&&(e.duration=void 0,e.decay=void 0),n&&(e.frequency=void 0)}else e.duration=void 0}var NU=[],BFe=class{constructor(){this.changed=!1,this.values=NU,this.toValues=null,this.fromValues=NU,this.config=new $Fe,this.immediate=!1}};function Gee(e,{key:t,props:n,defaultProps:r,state:i,actions:o}){return new Promise(((s,a)=>{let l,c,u=vv(n.cancel??(null==r?void 0:r.cancel),t);if(u)p();else{Ee.und(n.pause)||(i.paused=vv(n.pause,t));let e=null==r?void 0:r.pause;!0!==e&&(e=i.paused||vv(e,t)),l=Vi(n.delay||0,t),e?(i.resumeQueue.add(h),o.pause()):(o.resume(),h())}function d(){i.resumeQueue.add(h),i.timeouts.delete(c),c.cancel(),l=c.time-dt.now()}function h(){l>0&&!Vo.skipAnimation?(i.delayed=!0,c=dt.setTimeout(p,l),i.pauseQueue.add(d),i.timeouts.add(c)):p()}function p(){i.delayed&&(i.delayed=!1),i.pauseQueue.delete(d),i.timeouts.delete(c),e<=(i.cancelId||0)&&(u=!0);try{o.start({...n,callId:e,cancel:u},s)}catch(e){a(e)}}}))}var eO=(e,t)=>1==t.length?t[0]:t.some((e=>e.cancelled))?rp(e.get()):t.every((e=>e.noop))?Wee(e.get()):Po(e.get(),t.every((e=>e.finished))),Wee=e=>({value:e,noop:!0,finished:!0,cancelled:!1}),Po=(e,t,n=!1)=>({value:e,finished:t,cancelled:n}),rp=e=>({value:e,cancelled:!0,finished:!1});function zee(e,t,n,r){const{callId:i,parentId:o,onRest:s}=t,{asyncTo:a,promise:l}=n;return o||e!==a||t.reset?n.promise=(async()=>{n.asyncId=i,n.asyncTo=e;const c=Z4(t,((e,t)=>"onRest"===t?void 0:e));let u,d;const h=new Promise(((e,t)=>(u=e,d=t))),p=e=>{const t=i<=(n.cancelId||0)&&rp(r)||i!==n.asyncId&&Po(r,!1);if(t)throw e.result=t,d(e),e},f=(e,t)=>{const o=new DU,s=new jU;return(async()=>{if(Vo.skipAnimation)throw yy(n),s.result=Po(r,!1),d(s),s;p(o);const a=Ee.obj(e)?{...e}:{...t,to:e};a.parentId=i,ka(c,((e,t)=>{Ee.und(a[t])&&(a[t]=e)}));const l=await r.start(a);return p(o),n.paused&&await new Promise((e=>{n.resumeQueue.add(e)})),l})()};let m;if(Vo.skipAnimation)return yy(n),Po(r,!1);try{let t;t=Ee.arr(e)?(async e=>{for(const t of e)await f(t)})(e):Promise.resolve(e(f,r.stop.bind(r))),await Promise.all([t.then(u),h]),m=Po(r.get(),!0,!1)}catch(e){if(e instanceof DU)m=e.result;else{if(!(e instanceof jU))throw e;m=e.result}}finally{i==n.asyncId&&(n.asyncId=o,n.asyncTo=o?a:void 0,n.promise=o?l:void 0)}return Ee.fun(s)&&dt.batchedUpdates((()=>{s(m,r,r.item)})),m})():l}function yy(e,t){mv(e.timeouts,(e=>e.cancel())),e.pauseQueue.clear(),e.resumeQueue.clear(),e.asyncId=e.asyncTo=e.promise=void 0,t&&(e.cancelId=t)}var DU=class extends Error{constructor(){super("An async animation has been interrupted. You see this error because you forgot to use `await` or `.catch(...)` on its returned promise.")}},jU=class extends Error{constructor(){super("SkipAnimationSignal")}},bP=e=>e instanceof tO,VFe=1,tO=class extends Nee{constructor(){super(...arguments),this.id=VFe++,this._priority=0}get priority(){return this._priority}set priority(e){this._priority!=e&&(this._priority=e,this._onPriorityChange(e))}get(){const e=fa(this);return e&&e.getValue()}to(...e){return Vo.to(this,e)}interpolate(...e){return _Fe(),Vo.to(this,e)}toJSON(){return this.get()}observerAdded(e){1==e&&this._attach()}observerRemoved(e){0==e&&this._detach()}_attach(){}_detach(){}_onChange(e,t=!1){hy(this,{type:"change",parent:this,value:e,idle:t})}_onPriorityChange(e){this.idle||zw.sort(this),hy(this,{type:"priority",parent:this,priority:e})}},Wd=Symbol.for("SpringPhase"),Yee=1,Jee=2,Xee=4,mI=e=>(e[Wd]&Yee)>0,wc=e=>(e[Wd]&Jee)>0,Rg=e=>(e[Wd]&Xee)>0,UU=(e,t)=>t?e[Wd]|=Jee|Yee:e[Wd]&=-3,FU=(e,t)=>t?e[Wd]|=Xee:e[Wd]&=-5,qFe=class extends tO{constructor(e,t){if(super(),this.animation=new BFe,this.defaultProps={},this._state={paused:!1,delayed:!1,pauseQueue:new Set,resumeQueue:new Set,timeouts:new Set},this._pendingCalls=new Set,this._lastCallId=0,this._lastToId=0,this._memoizedDuration=0,!Ee.und(e)||!Ee.und(t)){const n=Ee.obj(e)?{...e}:{...t,from:e};Ee.und(n.default)&&(n.default=!0),this.start(n)}}get idle(){return!(wc(this)||this._state.asyncTo)||Rg(this)}get goal(){return Bi(this.animation.to)}get velocity(){const e=fa(this);return e instanceof i0?e.lastVelocity||0:e.getPayload().map((e=>e.lastVelocity||0))}get hasAnimated(){return mI(this)}get isAnimating(){return wc(this)}get isPaused(){return Rg(this)}get isDelayed(){return this._state.delayed}advance(e){let t=!0,n=!1;const r=this.animation;let{toValues:i}=r;const{config:o}=r,s=Zw(r.to);!s&&Us(r.to)&&(i=wi(Bi(r.to))),r.values.forEach(((a,l)=>{if(a.done)return;const c=a.constructor==gy?1:s?s[l].lastPosition:i[l];let u=r.immediate,d=c;if(!u){if(d=a.lastPosition,o.tension<=0)return void(a.done=!0);let t=a.elapsedTime+=e;const n=r.fromValues[l],i=null!=a.v0?a.v0:a.v0=Ee.arr(o.velocity)?o.velocity[l]:o.velocity;let s;const h=o.precision||(n==c?.005:Math.min(1,.001*Math.abs(c-n)));if(Ee.und(o.duration))if(o.decay){const e=!0===o.decay?.998:o.decay,r=Math.exp(-(1-e)*t);d=n+i/(1-e)*(1-r),u=Math.abs(a.lastPosition-d)<=h,s=i*r}else{s=null==a.lastVelocity?i:a.lastVelocity;const t=o.restVelocity||h/10,r=o.clamp?0:o.bounce,l=!Ee.und(r),p=n==c?a.v0>0:n<c;let f,m=!1;const v=1,g=Math.ceil(e/v);for(let e=0;e<g&&(f=Math.abs(s)>t,f||(u=Math.abs(c-d)<=h,!u));++e){l&&(m=d==c||d>c==p,m&&(s=-s*r,d=c));s+=(1e-6*-o.tension*(d-c)+.001*-o.friction*s)/o.mass*v,d+=s*v}}else{let r=1;o.duration>0&&(this._memoizedDuration!==o.duration&&(this._memoizedDuration=o.duration,a.durationProgress>0&&(a.elapsedTime=o.duration*a.durationProgress,t=a.elapsedTime+=e)),r=(o.progress||0)+t/this._memoizedDuration,r=r>1?1:r<0?0:r,a.durationProgress=r),d=n+o.easing(r)*(c-n),s=(d-a.lastPosition)/e,u=1==r}a.lastVelocity=s,Number.isNaN(d)&&(console.warn("Got NaN while animating:",this),u=!0)}s&&!s[l].done&&(u=!1),u?a.done=!0:t=!1,a.setValue(d,o.round)&&(n=!0)}));const a=fa(this),l=a.getValue();if(t){const e=Bi(r.to);l===e&&!n||o.decay?n&&o.decay&&this._onChange(l):(a.setValue(e),this._onChange(e)),this._stop()}else n&&this._onChange(l)}set(e){return dt.batchedUpdates((()=>{this._stop(),this._focus(e),this._set(e)})),this}pause(){this._update({pause:!0})}resume(){this._update({pause:!1})}finish(){if(wc(this)){const{to:e,config:t}=this.animation;dt.batchedUpdates((()=>{this._onStart(),t.decay||this._set(e,!1),this._stop()}))}return this}update(e){return(this.queue||(this.queue=[])).push(e),this}start(e,t){let n;return Ee.und(e)?(n=this.queue||[],this.queue=[]):n=[Ee.obj(e)?e:{...t,to:e}],Promise.all(n.map((e=>this._update(e)))).then((e=>eO(this,e)))}stop(e){const{to:t}=this.animation;return this._focus(this.get()),yy(this._state,e&&this._lastCallId),dt.batchedUpdates((()=>this._stop(t,e))),this}reset(){this._update({reset:!0})}eventObserved(e){"change"==e.type?this._start():"priority"==e.type&&(this.priority=e.priority+1)}_prepareNode(e){const t=this.key||"";let{to:n,from:r}=e;n=Ee.obj(n)?n[t]:n,(null==n||yP(n))&&(n=void 0),r=Ee.obj(r)?r[t]:r,null==r&&(r=void 0);const i={to:n,from:r};return mI(this)||(e.reverse&&([n,r]=[r,n]),r=Bi(r),Ee.und(r)?fa(this)||this._set(n):this._set(r)),i}_update({...e},t){const{key:n,defaultProps:r}=this;e.default&&Object.assign(r,Z4(e,((e,t)=>/^on/.test(t)?qee(e,n):e))),HU(this,e,"onProps"),kg(this,"onProps",e,this);const i=this._prepareNode(e);if(Object.isFrozen(this))throw Error("Cannot animate a `SpringValue` object that is frozen. Did you forget to pass your component to `animated(...)` before animating its props?");const o=this._state;return Gee(++this._lastCallId,{key:n,props:e,defaultProps:r,state:o,actions:{pause:()=>{Rg(this)||(FU(this,!0),Hg(o.pauseQueue),kg(this,"onPause",Po(this,Ig(this,this.animation.to)),this))},resume:()=>{Rg(this)&&(FU(this,!1),wc(this)&&this._resume(),Hg(o.resumeQueue),kg(this,"onResume",Po(this,Ig(this,this.animation.to)),this))},start:this._merge.bind(this,i)}}).then((n=>{if(e.loop&&n.finished&&(!t||!n.noop)){const t=Zee(e);if(t)return this._update(t,!0)}return n}))}_merge(e,t,n){if(t.cancel)return this.stop(!0),n(rp(this));const r=!Ee.und(e.to),i=!Ee.und(e.from);if(r||i){if(!(t.callId>this._lastToId))return n(rp(this));this._lastToId=t.callId}const{key:o,defaultProps:s,animation:a}=this,{to:l,from:c}=a;let{to:u=l,from:d=c}=e;i&&!r&&(!t.default||Ee.und(u))&&(u=d),t.reverse&&([u,d]=[d,u]);const h=!cl(d,c);h&&(a.from=d),d=Bi(d);const p=!cl(u,l);p&&this._focus(u);const f=yP(t.to),{config:m}=a,{decay:v,velocity:g}=m;(r||i)&&(m.velocity=0),t.config&&!f&&HFe(m,Vi(t.config,o),t.config!==s.config?Vi(s.config,o):void 0);let y=fa(this);if(!y||Ee.und(u))return n(Po(this,!0));const b=Ee.und(t.reset)?i&&!t.default:!Ee.und(d)&&vv(t.reset,o),_=b?d:this.get(),w=vy(u),E=Ee.num(w)||Ee.arr(w)||Xw(w),S=!f&&(!E||vv(s.immediate||t.immediate,o));if(p){const e=vP(u);if(e!==y.constructor){if(!S)throw Error(`Cannot animate between ${y.constructor.name} and ${e.name}, as the "to" prop suggests`);y=this._set(w)}}const C=y.constructor;let k=Us(u),T=!1;if(!k){const e=b||!mI(this)&&h;(p||e)&&(T=cl(vy(_),w),k=!T),(!cl(a.immediate,S)&&!S||!cl(m.decay,v)||!cl(m.velocity,g))&&(k=!0)}if(T&&wc(this)&&(a.changed&&!b?k=!0:k||this._stop(l)),!f&&((k||Us(l))&&(a.values=y.getPayload(),a.toValues=Us(u)?null:C==gy?[1]:wi(w)),a.immediate!=S&&(a.immediate=S,!S&&!b&&this._set(l)),k)){const{onRest:e}=a;gt(KFe,(e=>HU(this,t,e)));const r=Po(this,Ig(this,l));Hg(this._pendingCalls,r),this._pendingCalls.add(n),a.changed&&dt.batchedUpdates((()=>{var t;a.changed=!b,null==e||e(r,this),b?Vi(s.onRest,r):null==(t=a.onStart)||t.call(a,r,this)}))}b&&this._set(_),f?n(zee(t.to,t,this._state,this)):k?this._start():wc(this)&&!p?this._pendingCalls.add(n):n(Wee(_))}_focus(e){const t=this.animation;e!==t.to&&(kU(this)&&this._detach(),t.to=e,kU(this)&&this._attach())}_attach(){let e=0;const{to:t}=this.animation;Us(t)&&(im(t,this),bP(t)&&(e=t.priority+1)),this.priority=e}_detach(){const{to:e}=this.animation;Us(e)&&py(e,this)}_set(e,t=!0){const n=Bi(e);if(!Ee.und(n)){const e=fa(this);if(!e||!cl(n,e.getValue())){const r=vP(n);e&&e.constructor==r?e.setValue(n):X4(this,r.create(n)),e&&dt.batchedUpdates((()=>{this._onChange(n,t)}))}}return fa(this)}_onStart(){const e=this.animation;e.changed||(e.changed=!0,kg(this,"onStart",Po(this,Ig(this,e.to)),this))}_onChange(e,t){t||(this._onStart(),Vi(this.animation.onChange,e,this)),Vi(this.defaultProps.onChange,e,this),super._onChange(e,t)}_start(){const e=this.animation;fa(this).reset(Bi(e.to)),e.immediate||(e.fromValues=e.values.map((e=>e.lastPosition))),wc(this)||(UU(this,!0),Rg(this)||this._resume())}_resume(){Vo.skipAnimation?this.finish():zw.start(this)}_stop(e,t){if(wc(this)){UU(this,!1);const n=this.animation;gt(n.values,(e=>{e.done=!0})),n.toValues&&(n.onChange=n.onPause=n.onResume=void 0),hy(this,{type:"idle",parent:this});const r=t?rp(this.get()):Po(this.get(),Ig(this,e??n.to));Hg(this._pendingCalls,r),n.changed&&(n.changed=!1,kg(this,"onRest",r,this))}}};function Ig(e,t){const n=vy(t);return cl(vy(e.get()),n)}function Zee(e,t=e.loop,n=e.to){const r=Vi(t);if(r){const i=!0!==r&&Q4(r),o=(i||e).reverse,s=!i||i.reset;return fE({...e,loop:t,default:!1,pause:void 0,to:!o||yP(n)?n:void 0,from:s?e.from:void 0,reset:s,...i})}}function fE(e){const{to:t,from:n}=e=Q4(e),r=new Set;return Ee.obj(t)&&$U(t,r),Ee.obj(n)&&$U(n,r),e.keys=r.size?Array.from(r):null,e}function $U(e,t){ka(e,((e,n)=>null!=e&&t.add(n)))}var KFe=["onStart","onRest","onChange","onPause","onResume"];function HU(e,t,n){e.animation[n]=t[n]!==Kee(t,n)?qee(t[n],e.key):void 0}function kg(e,t,...n){var r,i,o,s;null==(i=(r=e.animation)[t])||i.call(r,...n),null==(s=(o=e.defaultProps)[t])||s.call(o,...n)}var GFe=["onStart","onChange","onRest"],WFe=1,zFe=class{constructor(e,t){this.id=WFe++,this.springs={},this.queue=[],this._lastAsyncId=0,this._active=new Set,this._changed=new Set,this._started=!1,this._state={paused:!1,pauseQueue:new Set,resumeQueue:new Set,timeouts:new Set},this._events={onStart:new Map,onChange:new Map,onRest:new Map},this._onFrame=this._onFrame.bind(this),t&&(this._flush=t),e&&this.start({default:!0,...e})}get idle(){return!this._state.asyncTo&&Object.values(this.springs).every((e=>e.idle&&!e.isDelayed&&!e.isPaused))}get item(){return this._item}set item(e){this._item=e}get(){const e={};return this.each(((t,n)=>e[n]=t.get())),e}set(e){for(const t in e){const n=e[t];Ee.und(n)||this.springs[t].set(n)}}update(e){return e&&this.queue.push(fE(e)),this}start(e){let{queue:t}=this;return e?t=wi(e).map(fE):this.queue=[],this._flush?this._flush(this,t):(nte(this,t),YFe(this,t))}stop(e,t){if(e!==!!e&&(t=e),t){const n=this.springs;gt(wi(t),(t=>n[t].stop(!!e)))}else yy(this._state,this._lastAsyncId),this.each((t=>t.stop(!!e)));return this}pause(e){if(Ee.und(e))this.start({pause:!0});else{const t=this.springs;gt(wi(e),(e=>t[e].pause()))}return this}resume(e){if(Ee.und(e))this.start({pause:!1});else{const t=this.springs;gt(wi(e),(e=>t[e].resume()))}return this}each(e){ka(this.springs,e)}_onFrame(){const{onStart:e,onChange:t,onRest:n}=this._events,r=this._active.size>0,i=this._changed.size>0;(r&&!this._started||i&&!this._started)&&(this._started=!0,mv(e,(([e,t])=>{t.value=this.get(),e(t,this,this._item)})));const o=!r&&this._started,s=i||o&&n.size?this.get():null;i&&t.size&&mv(t,(([e,t])=>{t.value=s,e(t,this,this._item)})),o&&(this._started=!1,mv(n,(([e,t])=>{t.value=s,e(t,this,this._item)})))}eventObserved(e){if("change"==e.type)this._changed.add(e.parent),e.idle||this._active.add(e.parent);else{if("idle"!=e.type)return;this._active.delete(e.parent)}dt.onFrame(this._onFrame)}};function YFe(e,t){return Promise.all(t.map((t=>Qee(e,t)))).then((t=>eO(e,t)))}async function Qee(e,t,n){const{keys:r,to:i,from:o,loop:s,onRest:a,onResolve:l}=t,c=Ee.obj(t.default)&&t.default;s&&(t.loop=!1),!1===i&&(t.to=null),!1===o&&(t.from=null);const u=Ee.arr(i)||Ee.fun(i)?i:void 0;u?(t.to=void 0,t.onRest=void 0,c&&(c.onRest=void 0)):gt(GFe,(n=>{const r=t[n];if(Ee.fun(r)){const i=e._events[n];t[n]=({finished:e,cancelled:t})=>{const n=i.get(r);n?(e||(n.finished=!1),t&&(n.cancelled=!0)):i.set(r,{value:null,finished:e||!1,cancelled:t||!1})},c&&(c[n]=t[n])}}));const d=e._state;t.pause===!d.paused?(d.paused=t.pause,Hg(t.pause?d.pauseQueue:d.resumeQueue)):d.paused&&(t.pause=!0);const h=(r||Object.keys(e.springs)).map((n=>e.springs[n].start(t))),p=!0===t.cancel||!0===Kee(t,"cancel");(u||p&&d.asyncId)&&h.push(Gee(++e._lastAsyncId,{props:t,state:d,actions:{pause:mP,resume:mP,start(t,n){p?(yy(d,e._lastAsyncId),n(rp(e))):(t.onRest=a,n(zee(u,t,d,e)))}}})),d.paused&&await new Promise((e=>{d.resumeQueue.add(e)}));const f=eO(e,await Promise.all(h));if(s&&f.finished&&(!n||!f.noop)){const n=Zee(t,s,i);if(n)return nte(e,[n]),Qee(e,n,!0)}return l&&dt.batchedUpdates((()=>l(f,e,e.item))),f}function JFe(e,t){const n={...e.springs};return t&&gt(wi(t),(e=>{Ee.und(e.keys)&&(e=fE(e)),Ee.obj(e.to)||(e={...e,to:void 0}),tte(n,e,(e=>ete(e)))})),XFe(e,n),n}function XFe(e,t){ka(t,((t,n)=>{e.springs[n]||(e.springs[n]=t,im(t,e))}))}function ete(e,t){const n=new qFe;return n.key=e,t&&im(n,t),n}function tte(e,t,n){t.keys&&gt(t.keys,(r=>{(e[r]||(e[r]=n(r)))._prepareNode(t)}))}function nte(e,t){gt(t,(t=>{tte(e.springs,t,(t=>ete(t,e)))}))}var eC=({children:e,...t})=>{const n=_.useContext(hE),r=t.pause||!!n.pause,i=t.immediate||!!n.immediate;t=wFe((()=>({pause:r,immediate:i})),[r,i]);const{Provider:o}=hE;return _.createElement(o,{value:t},e)},hE=ZFe(eC,{});function ZFe(e,t){return Object.assign(e,_.createContext(t)),e.Provider._context=e,e.Consumer._context=e,e}eC.Provider=hE.Provider,eC.Consumer=hE.Consumer;var QFe=()=>{const e=[],t=function(t){SFe();const r=[];return gt(e,((e,i)=>{if(Ee.und(t))r.push(e.start());else{const o=n(t,e,i);o&&r.push(e.start(o))}})),r};t.current=e,t.add=function(t){e.includes(t)||e.push(t)},t.delete=function(t){const n=e.indexOf(t);~n&&e.splice(n,1)},t.pause=function(){return gt(e,(e=>e.pause(...arguments))),this},t.resume=function(){return gt(e,(e=>e.resume(...arguments))),this},t.set=function(t){gt(e,((e,n)=>{const r=Ee.fun(t)?t(n,e):t;r&&e.set(r)}))},t.start=function(t){const n=[];return gt(e,((e,r)=>{if(Ee.und(t))n.push(e.start());else{const i=this._getProps(t,e,r);i&&n.push(e.start(i))}})),n},t.stop=function(){return gt(e,(e=>e.stop(...arguments))),this},t.update=function(t){return gt(e,((e,n)=>e.update(this._getProps(t,e,n)))),this};const n=function(e,t,n){return Ee.fun(e)?e(n,t):e};return t._getProps=n,t};function e$e(e,t,n){const r=Ee.fun(t)&&t,{reset:i,sort:o,trail:s=0,expires:a=!0,exitBeforeEnter:l=!1,onDestroyed:c,ref:u,config:d}=r?r():t,h=_.useMemo((()=>r||3==arguments.length?QFe():void 0),[]),p=wi(e),f=[],m=_.useRef(null),v=i?null:m.current;xh((()=>{m.current=f})),Hee((()=>(gt(f,(e=>{null==h||h.add(e.ctrl),e.ctrl.ref=h})),()=>{gt(m.current,(e=>{e.expired&&clearTimeout(e.expirationId),MU(e.ctrl,h),e.ctrl.stop(!0)}))})));const g=n$e(p,r?r():t,v),y=i&&m.current||[];xh((()=>gt(y,(({ctrl:e,item:t,key:n})=>{MU(e,h),Vi(c,t,n)}))));const b=[];if(v&&gt(v,((e,t)=>{e.expired?(clearTimeout(e.expirationId),y.push(e)):~(t=b[t]=g.indexOf(e.key))&&(f[t]=e)})),gt(p,((e,t)=>{f[t]||(f[t]={key:g[t],item:e,phase:"mount",ctrl:new zFe},f[t].ctrl.item=e)})),b.length){let e=-1;const{leave:n}=r?r():t;gt(b,((t,r)=>{const i=v[r];~t?(e=f.indexOf(i),f[e]={...i,item:p[t]}):n&&f.splice(++e,0,i)}))}Ee.fun(o)&&f.sort(((e,t)=>o(e.item,t.item)));let w=-s;const E=$ee(),S=Z4(t),C=new Map,k=_.useRef(new Map),T=_.useRef(!1);gt(f,((e,n)=>{const i=e.key,o=e.phase,c=r?r():t;let h,p;const f=Vi(c.delay||0,i);if("mount"==o)h=c.enter,p="enter";else{const e=g.indexOf(i)<0;if("leave"!=o)if(e)h=c.leave,p="leave";else{if(!(h=c.update))return;p="update"}else{if(e)return;h=c.enter,p="enter"}}if(h=Vi(h,e.item,n),h=Ee.obj(h)?Q4(h):{to:h},!h.config){const t=d||S.config;h.config=Vi(t,e.item,n,p)}w+=s;const y={...S,delay:f+w,ref:u,immediate:c.immediate,reset:!1,...h};if("enter"==p&&Ee.und(y.from)){const i=r?r():t,o=Ee.und(i.initial)||v?i.from:i.initial;y.from=Vi(o,e.item,n)}const{onResolve:b}=y;y.onResolve=e=>{Vi(b,e);const t=m.current,n=t.find((e=>e.key===i));if(n&&(!e.cancelled||"update"==n.phase)&&n.ctrl.idle){const e=t.every((e=>e.ctrl.idle));if("leave"==n.phase){const t=Vi(a,n.item);if(!1!==t){const r=!0===t?0:t;if(n.expired=!0,!e&&r>0)return void(r<=2147483647&&(n.expirationId=setTimeout(E,r)))}}e&&t.some((e=>e.expired))&&(k.current.delete(n),l&&(T.current=!0),E())}};const _=JFe(e.ctrl,y);"leave"===p&&l?k.current.set(e,{phase:p,springs:_,payload:y}):C.set(e,{phase:p,springs:_,payload:y})}));const I=_.useContext(eC),R=RFe(I),x=I!==R&&jFe(I);xh((()=>{x&&gt(f,(e=>{e.ctrl.start({default:I})}))}),[I]),gt(C,((e,t)=>{if(k.current.size){const e=f.findIndex((e=>e.key===t.key));f.splice(e,1)}})),xh((()=>{gt(k.current.size?k.current:C,(({phase:e,payload:t},n)=>{const{ctrl:r}=n;n.phase=e,null==h||h.add(r),x&&"enter"==e&&r.start({default:I}),t&&(UFe(r,t.ref),!r.ref&&!h||T.current?(r.start(t),T.current&&(T.current=!1)):r.update(t))}))}),i?void 0:n);const L=e=>_.createElement(_.Fragment,null,f.map(((t,n)=>{const{springs:r}=C.get(t)||t.ctrl,i=e({...r},t.item,t,n);return i&&i.type?_.createElement(i.type,{...i.props,key:Ee.str(t.key)||Ee.num(t.key)?t.key:t.ctrl.id,ref:i.ref}):i})));return h?[L,h]:L}var t$e=1;function n$e(e,{key:t,keys:n=t},r){if(null===n){const t=new Set;return e.map((e=>{const n=r&&r.find((n=>n.item===e&&"leave"!==n.phase&&!t.has(n)));return n?(t.add(n),n.key):t$e++}))}return Ee.und(n)?e:Ee.fun(n)?e.map(n):wi(n)}var r$e=class extends tO{constructor(e,t){super(),this.source=e,this.idle=!0,this._active=new Set,this.calc=dy(...t);const n=this._get(),r=vP(n);X4(this,r.create(n))}advance(e){const t=this._get();cl(t,this.get())||(fa(this).setValue(t),this._onChange(t,this.idle)),!this.idle&&BU(this._active)&&gI(this)}_get(){const e=Ee.arr(this.source)?this.source.map(Bi):wi(Bi(this.source));return this.calc(...e)}_start(){this.idle&&!BU(this._active)&&(this.idle=!1,gt(Zw(this),(e=>{e.done=!1})),Vo.skipAnimation?(dt.batchedUpdates((()=>this.advance())),gI(this)):zw.start(this))}_attach(){let e=1;gt(wi(this.source),(t=>{Us(t)&&im(t,this),bP(t)&&(t.idle||this._active.add(t),e=Math.max(e,t.priority+1))})),this.priority=e,this._start()}_detach(){gt(wi(this.source),(e=>{Us(e)&&py(e,this)})),this._active.clear(),gI(this)}eventObserved(e){"change"==e.type?e.idle?this.advance():(this._active.add(e.parent),this._start()):"idle"==e.type?this._active.delete(e.parent):"priority"==e.type&&(this.priority=wi(this.source).reduce(((e,t)=>Math.max(e,(bP(t)?t.priority:0)+1)),0))}};function i$e(e){return!1!==e.idle}function BU(e){return!e.size||Array.from(e).every(i$e)}function gI(e){e.idle||(e.idle=!0,gt(Zw(e),(e=>{e.done=!0})),hy(e,{type:"idle",parent:e}))}Vo.assign({createStringInterpolator:Uee,to:(e,t)=>new r$e(e,t)});var rte=/^--/;function s$e(e,t){return null==t||"boolean"==typeof t||""===t?"":"number"!=typeof t||0===t||rte.test(e)||yv.hasOwnProperty(e)&&yv[e]?(""+t).trim():t+"px"}var VU={};function o$e(e,t){if(!e.nodeType||!e.setAttribute)return!1;const n="filter"===e.nodeName||e.parentNode&&"filter"===e.parentNode.nodeName,{className:r,style:i,children:o,scrollTop:s,scrollLeft:a,viewBox:l,...c}=t,u=Object.values(c),d=Object.keys(c).map((t=>n||e.hasAttribute(t)?t:VU[t]||(VU[t]=t.replace(/([A-Z])/g,(e=>"-"+e.toLowerCase())))));void 0!==o&&(e.textContent=o);for(const t in i)if(i.hasOwnProperty(t)){const n=s$e(t,i[t]);rte.test(t)?e.style.setProperty(t,n):e.style[t]=n}d.forEach(((t,n)=>{e.setAttribute(t,u[n])})),void 0!==r&&(e.className=r),void 0!==s&&(e.scrollTop=s),void 0!==a&&(e.scrollLeft=a),void 0!==l&&e.setAttribute("viewBox",l)}var yv={animationIterationCount:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},a$e=(e,t)=>e+t.charAt(0).toUpperCase()+t.substring(1),l$e=["Webkit","Ms","Moz","O"];yv=Object.keys(yv).reduce(((e,t)=>(l$e.forEach((n=>e[a$e(n,t)]=e[t])),e)),yv);var c$e=/^(matrix|translate|scale|rotate|skew)/,u$e=/^(translate)/,d$e=/^(rotate|skew)/,vI=(e,t)=>Ee.num(e)&&0!==e?e+t:e,Db=(e,t)=>Ee.arr(e)?e.every((e=>Db(e,t))):Ee.num(e)?e===t:parseFloat(e)===t,f$e=class extends Qw{constructor({x:e,y:t,z:n,...r}){const i=[],o=[];(e||t||n)&&(i.push([e||0,t||0,n||0]),o.push((e=>[`translate3d(${e.map((e=>vI(e,"px"))).join(",")})`,Db(e,0)]))),ka(r,((e,t)=>{if("transform"===t)i.push([e||""]),o.push((e=>[e,""===e]));else if(c$e.test(t)){if(delete r[t],Ee.und(e))return;const n=u$e.test(t)?"px":d$e.test(t)?"deg":"";i.push(wi(e)),o.push("rotate3d"===t?([e,t,r,i])=>[`rotate3d(${e},${t},${r},${vI(i,n)})`,Db(i,0)]:e=>[`${t}(${e.map((e=>vI(e,n))).join(",")})`,Db(e,t.startsWith("scale")?1:0)])}})),i.length&&(r.transform=new h$e(i,o)),super(r)}},h$e=class extends Nee{constructor(e,t){super(),this.inputs=e,this.transforms=t,this._value=null}get(){return this._value||(this._value=this._get())}_get(){let e="",t=!0;return gt(this.inputs,((n,r)=>{const i=Bi(n[0]),[o,s]=this.transforms[r](Ee.arr(i)?i:n.map(Bi));e+=" "+o,t=t&&s})),t?"none":e}observerAdded(e){1==e&&gt(this.inputs,(e=>gt(e,(e=>Us(e)&&im(e,this)))))}observerRemoved(e){0==e&&gt(this.inputs,(e=>gt(e,(e=>Us(e)&&py(e,this)))))}eventObserved(e){"change"==e.type&&(this._value=null),hy(this,e)}},p$e=["a","abbr","address","area","article","aside","audio","b","base","bdi","bdo","big","blockquote","body","br","button","canvas","caption","cite","code","col","colgroup","data","datalist","dd","del","details","dfn","dialog","div","dl","dt","em","embed","fieldset","figcaption","figure","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","iframe","img","input","ins","kbd","keygen","label","legend","li","link","main","map","mark","menu","menuitem","meta","meter","nav","noscript","object","ol","optgroup","option","output","p","param","picture","pre","progress","q","rp","rt","ruby","s","samp","script","section","select","small","source","span","strong","style","sub","summary","sup","table","tbody","td","textarea","tfoot","th","thead","time","title","tr","track","u","ul","var","video","wbr","circle","clipPath","defs","ellipse","foreignObject","g","image","line","linearGradient","mask","path","pattern","polygon","polyline","radialGradient","rect","stop","svg","text","tspan"];Vo.assign({batchedUpdates:Up.unstable_batchedUpdates,createStringInterpolator:Uee,colors:QUe});var m$e=OFe(p$e,{applyAnimatedValues:o$e,createAnimatedStyle:e=>new f$e(e),getComponentProps:({scrollTop:e,scrollLeft:t,...n})=>n}),ite=m$e.animated;const g$e="_media_40njg_8",v$e="_mirror_40njg_25",y$e="_bg_40njg_37",_$e="_avatar_40njg_45",b$e="_fg_40njg_70",S$e="_nameTag_40njg_84",E$e="_status_40njg_100",w$e="_reactions_40njg_119",C$e="_name_40njg_84",T$e="_errorIcon_40njg_138",_o={media:g$e,mirror:v$e,bg:y$e,avatar:_$e,fg:b$e,nameTag:S$e,status:E$e,reactions:w$e,name:C$e,errorIcon:T$e},R$e="_reactionIndicatorWidget_14f9a_1",I$e="_reactionIndicatorWidgetLarge_14f9a_21",k$e="_reactionLarge_14f9a_28",x$e="_reaction_14f9a_1",S_={reactionIndicatorWidget:R$e,reactionIndicatorWidgetLarge:I$e,reactionLarge:k$e,reaction:x$e};function ste({emoji:e,miniature:t,children:n}){const{t:r}=ze();return E.jsxs("div",{className:Ae(S_.reactionIndicatorWidget,{[S_.reactionIndicatorWidgetLarge]:!t}),children:[E.jsx("div",{className:Ae(S_.reaction,{[S_.reactionLarge]:!t}),children:E.jsx("span",{role:"img","aria-label":r("common.reaction"),children:e})}),n]})}function P$e({raisedHandTime:e,miniature:t,showTimer:n,onClick:r}){const{t:i}=ze(),[o,s]=_.useState(""),a=_.useMemo((()=>new Intl.DurationFormat(void 0,{minutesDisplay:"always",secondsDisplay:"always",hoursDisplay:"auto",style:"digital"})),[]),l=_.useCallback((e=>{r&&(e.preventDefault(),r())}),[r]);if(_.useEffect((()=>{if(!e||!n)return;const t=()=>{const t=Math.ceil(((new Date).getTime()-e.getTime())/1e3);s(a.format({seconds:t%60,minutes:Math.floor(t/60)}))};t();const r=setInterval(t,1e3);return()=>clearInterval(r)}),[s,e,n,a]),!e)return;const c=E.jsx(ste,{emoji:"✋",miniature:t,children:n&&E.jsx("p",{children:o})});return r?E.jsx("button",{"aria-label":i("action.lower_hand"),style:{display:"contents",background:"none"},onClick:l,children:c}):c}const L$e="_modal_13thw_8",O$e="_statsPill_13thw_12",qU={modal:L$e,statsPill:O$e},M$e=({audio:e,video:t,...n})=>{const[r,i]=_.useState(!1),[o,s]=_.useState("none"),a=e=>{i(!0),s(e)};return E.jsxs("div",{className:Ae(_o.nameTag,qU.statsPill),children:[E.jsx(lf,{title:"RTC Connection Stats",open:r,onDismiss:()=>{i(!1),s("none")},children:E.jsx("div",{className:qU.modal,children:E.jsx("pre",{children:"none"!==o&&JSON.stringify("video"===o?t:e,null,2)})})}),e&&E.jsx("div",{children:E.jsx(At,{onClick:()=>a("audio"),size:"sm",kind:"tertiary",Icon:q6,children:"jitter"in e&&"number"==typeof e.jitter&&E.jsxs(Jt,{as:"span",size:"xs",title:"jitter",children:[" ",(1e3*e.jitter).toFixed(0),"ms"]})})}),t&&E.jsx("div",{children:E.jsxs(At,{onClick:()=>a("video"),size:"sm",kind:"tertiary",Icon:PJ,children:[!(null==t||!t.framesPerSecond)&&E.jsxs(Jt,{as:"span",size:"xs",title:"frame rate",children:[" ",t.framesPerSecond.toFixed(0),"fps"]}),"jitter"in t&&"number"==typeof t.jitter&&E.jsxs(Jt,{as:"span",size:"xs",title:"jitter",children:[" ",(1e3*t.jitter).toFixed(0),"ms"]}),"frameHeight"in t&&"number"==typeof t.frameHeight&&"frameWidth"in t&&"number"==typeof t.frameWidth&&E.jsxs(Jt,{as:"span",size:"xs",title:"frame size",children:[" ",t.frameWidth,"x",t.frameHeight]}),"qualityLimitationReason"in t&&"string"==typeof t.qualityLimitationReason&&"none"!==t.qualityLimitationReason&&E.jsxs(Jt,{as:"span",size:"xs",title:"quality limitation reason",children:[" ",t.qualityLimitationReason]})]})})]})},s0=_.forwardRef((({className:e,style:t,targetWidth:n,targetHeight:r,video:i,videoFit:o,mirror:s,member:a,videoEnabled:l,unencryptedWarning:c,nameTagLeadingIcon:u,displayName:d,primaryButton:h,encryptionStatus:p,raisedHandTime:f,currentReaction:m,raisedHandOnClick:v,localParticipant:g,audioStreamStats:y,videoStreamStats:b,..._},w)=>{const{t:S}=ze(),[C]=qn(WZ),k=Math.round(Math.min(n,r)/2);return E.jsxs(ite.div,{className:Ae(_o.media,e,{[_o.mirror]:s}),style:t,ref:w,"data-testid":"videoTile","data-video-fit":o,..._,children:[E.jsxs("div",{className:_o.bg,children:[E.jsx(Zp,{id:(null==a?void 0:a.userId)??d,name:d,size:k,src:null==a?void 0:a.getMxcAvatarUrl(),className:_o.avatar,style:{display:i&&l?"none":"initial"}}),void 0!==(null==i?void 0:i.publication)&&E.jsx(Mje,{trackRef:i,tabIndex:-1,disablePictureInPicture:!0,style:{display:i&&l?"block":"none"},"data-testid":"video"})]}),E.jsxs("div",{className:_o.fg,children:[E.jsxs("div",{className:_o.reactions,children:[E.jsx(P$e,{raisedHandTime:f,miniature:k<96,showTimer:C,onClick:v}),m&&E.jsx(ste,{miniature:k<96,emoji:m.emoji})]}),!i&&!g&&E.jsx("div",{className:_o.status,children:S("video_tile.waiting_for_media")}),(y||b)&&E.jsx(M$e,{audio:y,video:b}),E.jsxs("div",{className:_o.nameTag,children:[u,E.jsx(Jt,{as:"span",size:"sm",weight:"medium",className:_o.name,"data-testid":"name_tag",children:d}),c&&E.jsx(ui,{label:S("common.unencrypted"),placement:"bottom",isTriggerInteractive:!1,children:E.jsx(aw,{width:20,height:20,className:_o.errorIcon,role:"img","aria-label":S("common.unencrypted")})})]}),h]})]})}));s0.displayName="MediaView";const o0=(...e)=>_.useCallback((t=>e.forEach((e=>{"function"==typeof e?e(t):null!==e&&(e.current=t)}))),e),nO=_.forwardRef((({vm:e,showSpeakingIndicators:t,locallyMuted:n,menuStart:r,menuEnd:i,className:o,displayName:s,...a},l)=>{const{toggleRaisedHand:c}=R4(),{t:u}=ze(),d=tt(e.video$),h=tt(e.unencryptedWarning$),p=tt(e.encryptionStatus$),f=tt(e.audioStreamStats$),m=tt(e.videoStreamStats$),v=tt(e.audioEnabled$),g=tt(e.videoEnabled$),y=tt(e.speaking$),b=tt(e.cropVideo$),w=_.useCallback((t=>{t.preventDefault(),e.toggleFitContain()}),[e]),S=ay(e.handRaised$),C=ay(e.reaction$),k=n?lRe:v?q6:cJ,T=u(n?"video_tile.muted_for_me":v?"microphone_on":"microphone_off"),[I,R]=_.useState(!1),x=E.jsxs(E.Fragment,{children:[r,E.jsx(B6,{Icon:nJ,label:u("video_tile.change_fit_contain"),checked:b,onSelect:w}),i]}),L=e.local?()=>{c()}:void 0,P=t&&y,O=E.jsx(s0,{ref:l,video:d,member:e.member,unencryptedWarning:h,encryptionStatus:p,videoEnabled:g,videoFit:b?"cover":"contain",className:Ae(o,$g.tile,{[$g.speaking]:P,[$g.handRaised]:!P&&S}),nameTagLeadingIcon:E.jsx(k,{width:20,height:20,"aria-label":T,"data-muted":n||!v,className:$g.muteIcon}),displayName:s,primaryButton:E.jsx(A6,{open:I,onOpenChange:R,title:s,trigger:E.jsx("button",{"aria-label":u("common.options"),children:E.jsx(Z2e,{"aria-hidden":!0,width:20,height:20})}),side:"left",align:"start",children:x}),raisedHandTime:S??void 0,currentReaction:C??void 0,raisedHandOnClick:L,localParticipant:e.local,audioStreamStats:f,videoStreamStats:m,...a});return E.jsx(kCe,{title:s,trigger:O,hasAccessibleAlternative:!0,children:x})}));nO.displayName="UserMediaTile";const ote=_.forwardRef((({vm:e,onOpenProfile:t,...n},r)=>{const{t:i}=ze(),o=tt(e.mirror$),s=tt(e.alwaysShow$),a=Ll(s),l=_.useCallback((t=>{t.preventDefault(),e.setAlwaysShow(!a.current)}),[e,a]);return E.jsx(nO,{ref:r,vm:e,locallyMuted:!1,mirror:o,menuStart:E.jsx(B6,{Icon:ZTe,label:i("video_tile.always_show"),checked:s,onSelect:l}),menuEnd:t&&E.jsx(Sp,{Icon:IJ,label:i("common.profile"),onSelect:t}),...n})}));ote.displayName="LocalUserMediaTile";const ate=_.forwardRef((({vm:e,...t},n)=>{const{t:r}=ze(),i=tt(e.locallyMuted$),o=tt(e.localVolume$),s=_.useCallback((t=>{t.preventDefault(),e.toggleLocallyMuted()}),[e]),a=_.useCallback((t=>e.setLocalVolume(t)),[e]),l=_.useCallback((()=>e.commitLocalVolume()),[e]),c=i?cRe:uRe;return E.jsx(nO,{ref:n,vm:e,locallyMuted:i,mirror:!1,menuStart:E.jsxs(E.Fragment,{children:[E.jsx(B6,{Icon:J2e,label:r("video_tile.mute_for_me"),checked:i,onSelect:s}),E.jsx(Sp,{as:"div",Icon:c,label:null,onSelect:null,children:E.jsx(xQ,{className:$g.volumeSlider,label:r("video_tile.volume"),value:o,onValueChange:a,onValueCommit:l,min:0,max:1,step:.01})})]}),...t})}));ate.displayName="RemoteUserMediaTile";const lte=_.forwardRef((({vm:e,onOpenProfile:t,...n},r)=>{const i=_.useRef(null),o=o0(i,r),s=tt(e.media$),a=tt(s.displayname$);return s instanceof kp?E.jsx(ote,{ref:o,vm:s,onOpenProfile:t,displayName:a,...n}):E.jsx(ate,{ref:o,vm:s,displayName:a,...n})}));lte.displayName="GridTile";const A$e=({rageshakeRequestId:e,roomId:t,open:n,onDismiss:r})=>{const{t:i}=ze(),{submitRageshake:o,sending:s,sent:a,error:l}=Uw();return _.useEffect((()=>{a&&r()}),[a,r]),E.jsxs(lf,{title:i("rageshake_request_modal.title"),open:n,onDismiss:r,children:[E.jsx(Jt,{children:i("rageshake_request_modal.body")}),E.jsx(vt,{children:E.jsx(At,{onClick:()=>{o({sendLogs:!0,rageshakeRequestId:e,roomId:t})},disabled:s,children:i(s?"rageshake_sending_logs":"rageshake_send_logs")})}),l&&E.jsx(vt,{children:E.jsx(Mu,{error:l})})]})};function KU(e){return new Worker(""+new URL("livekit-client.e2ee.worker-P7E4-zMp.js",import.meta.url).href,{name:null==e?void 0:e.name})}const N$e={audioPreset:uS.music,dtx:!0,red:!1,forceStereo:!1,simulcast:!0,videoSimulcastLayers:[_a.h180,_a.h360],screenShareEncoding:VE.h1080fps30.encoding,stopMicTrackOnMute:!1,videoCodec:"vp8",videoEncoding:_a.h720.encoding,backupCodec:{codec:"vp8",encoding:_a.h720.encoding}},yI={adaptiveStream:!0,dynacast:!0,videoCaptureDefaults:{resolution:_a.h720.resolution},publishDefaults:N$e,stopLocalTrackOnUnpublish:!0,reconnectPolicy:new nV,disconnectOnPageLeave:!0,webAudioMix:!1};function D$e(e){const[t,n]=_.useState((()=>{const t=e.getActiveFocus();return t&&xk(t)?t:void 0})),r=_.useCallback((()=>{const r=e.getActiveFocus();if((!r||xk(r))&&!Md(t,r)){const i=e.getOldestMembership();A.warn(`Got new active focus from membership: ${null==i?void 0:i.sender}/${null==i?void 0:i.deviceId}.\n        Updating focus (focus switch) from ${JSON.stringify(t)} to ${JSON.stringify(r)}`),n(r)}}),[t,e]);return _.useEffect((()=>(e.on(ar.MembershipsChanged,r),()=>{e.off(ar.MembershipsChanged,r)}))),t}function j$e(){const[e,t]=_.useState(null),n=_.useMemo((()=>({showErrorBoundary:e=>t(e)})),[]);if(e)throw e;return n}const lt=e=>"string"==typeof e,xg=()=>{let e,t;const n=new Promise(((n,r)=>{e=n,t=r}));return n.resolve=e,n.reject=t,n},GU=e=>null==e?"":""+e,U$e=(e,t,n)=>{e.forEach((e=>{t[e]&&(n[e]=t[e])}))},F$e=/###/g,WU=e=>e&&e.indexOf("###")>-1?e.replace(F$e,"."):e,zU=e=>!e||lt(e),_v=(e,t,n)=>{const r=lt(t)?t.split("."):t;let i=0;for(;i<r.length-1;){if(zU(e))return{};const t=WU(r[i]);!e[t]&&n&&(e[t]=new n),e=Object.prototype.hasOwnProperty.call(e,t)?e[t]:{},++i}return zU(e)?{}:{obj:e,k:WU(r[i])}},YU=(e,t,n)=>{const{obj:r,k:i}=_v(e,t,Object);if(void 0!==r||1===t.length)return void(r[i]=n);let o=t[t.length-1],s=t.slice(0,t.length-1),a=_v(e,s,Object);for(;void 0===a.obj&&s.length;)o=`${s[s.length-1]}.${o}`,s=s.slice(0,s.length-1),a=_v(e,s,Object),null!=a&&a.obj&&typeof a.obj[`${a.k}.${o}`]<"u"&&(a.obj=void 0);a.obj[`${a.k}.${o}`]=n},$$e=(e,t,n,r)=>{const{obj:i,k:o}=_v(e,t,Object);i[o]=i[o]||[],i[o].push(n)},pE=(e,t)=>{const{obj:n,k:r}=_v(e,t);if(n&&Object.prototype.hasOwnProperty.call(n,r))return n[r]},H$e=(e,t,n)=>{const r=pE(e,n);return void 0!==r?r:pE(t,n)},cte=(e,t,n)=>{for(const r in t)"__proto__"!==r&&"constructor"!==r&&(r in e?lt(e[r])||e[r]instanceof String||lt(t[r])||t[r]instanceof String?n&&(e[r]=t[r]):cte(e[r],t[r],n):e[r]=t[r]);return e},sh=e=>e.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&");var B$e={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"};const V$e=e=>lt(e)?e.replace(/[&<>"'\/]/g,(e=>B$e[e])):e;class q$e{constructor(e){this.capacity=e,this.regExpMap=new Map,this.regExpQueue=[]}getRegExp(e){const t=this.regExpMap.get(e);if(void 0!==t)return t;const n=new RegExp(e);return this.regExpQueue.length===this.capacity&&this.regExpMap.delete(this.regExpQueue.shift()),this.regExpMap.set(e,n),this.regExpQueue.push(e),n}}const K$e=[" ",",","?","!",";"],G$e=new q$e(20),W$e=(e,t,n)=>{t=t||"",n=n||"";const r=K$e.filter((e=>t.indexOf(e)<0&&n.indexOf(e)<0));if(0===r.length)return!0;const i=G$e.getRegExp(`(${r.map((e=>"?"===e?"\\?":e)).join("|")})`);let o=!i.test(e);if(!o){const t=e.indexOf(n);t>0&&!i.test(e.substring(0,t))&&(o=!0)}return o},SP=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:".";if(!e)return;if(e[t])return Object.prototype.hasOwnProperty.call(e,t)?e[t]:void 0;const r=t.split(n);let i=e;for(let e=0;e<r.length;){if(!i||"object"!=typeof i)return;let t,o="";for(let s=e;s<r.length;++s)if(s!==e&&(o+=n),o+=r[s],t=i[o],void 0!==t){if(["string","number","boolean"].indexOf(typeof t)>-1&&s<r.length-1)continue;e+=s-e+1;break}i=t}return i},mE=e=>null==e?void 0:e.replace("_","-"),z$e={type:"logger",log(e){this.output("log",e)},warn(e){this.output("warn",e)},error(e){this.output("error",e)},output(e,t){var n,r;null==(r=null==(n=null==console?void 0:console[e])?void 0:n.apply)||r.call(n,console,t)}};class gE{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.init(e,t)}init(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.prefix=t.prefix||"i18next:",this.logger=e||z$e,this.options=t,this.debug=t.debug}log(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return this.forward(t,"log","",!0)}warn(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return this.forward(t,"warn","",!0)}error(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return this.forward(t,"error","")}deprecate(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return this.forward(t,"warn","WARNING DEPRECATED: ",!0)}forward(e,t,n,r){return r&&!this.debug?null:(lt(e[0])&&(e[0]=`${n}${this.prefix} ${e[0]}`),this.logger[t](e))}create(e){return new gE(this.logger,{prefix:`${this.prefix}:${e}:`,...this.options})}clone(e){return(e=e||this.options).prefix=e.prefix||this.prefix,new gE(this.logger,e)}}var Ea=new gE;class tC{constructor(){this.observers={}}on(e,t){return e.split(" ").forEach((e=>{this.observers[e]||(this.observers[e]=new Map);const n=this.observers[e].get(t)||0;this.observers[e].set(t,n+1)})),this}off(e,t){if(this.observers[e]){if(!t)return void delete this.observers[e];this.observers[e].delete(t)}}emit(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];this.observers[e]&&Array.from(this.observers[e].entries()).forEach((e=>{let[t,r]=e;for(let e=0;e<r;e++)t(...n)})),this.observers["*"]&&Array.from(this.observers["*"].entries()).forEach((t=>{let[r,i]=t;for(let t=0;t<i;t++)r.apply(r,[e,...n])}))}}class JU extends tC{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{ns:["translation"],defaultNS:"translation"};super(),this.data=e||{},this.options=t,void 0===this.options.keySeparator&&(this.options.keySeparator="."),void 0===this.options.ignoreJSONStructure&&(this.options.ignoreJSONStructure=!0)}addNamespaces(e){this.options.ns.indexOf(e)<0&&this.options.ns.push(e)}removeNamespaces(e){const t=this.options.ns.indexOf(e);t>-1&&this.options.ns.splice(t,1)}getResource(e,t,n){var r,i;let o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};const s=void 0!==o.keySeparator?o.keySeparator:this.options.keySeparator,a=void 0!==o.ignoreJSONStructure?o.ignoreJSONStructure:this.options.ignoreJSONStructure;let l;e.indexOf(".")>-1?l=e.split("."):(l=[e,t],n&&(Array.isArray(n)?l.push(...n):lt(n)&&s?l.push(...n.split(s)):l.push(n)));const c=pE(this.data,l);return!c&&!t&&!n&&e.indexOf(".")>-1&&(e=l[0],t=l[1],n=l.slice(2).join(".")),!c&&a&&lt(n)?SP(null==(i=null==(r=this.data)?void 0:r[e])?void 0:i[t],n,s):c}addResource(e,t,n,r){let i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{silent:!1};const o=void 0!==i.keySeparator?i.keySeparator:this.options.keySeparator;let s=[e,t];n&&(s=s.concat(o?n.split(o):n)),e.indexOf(".")>-1&&(s=e.split("."),r=t,t=s[1]),this.addNamespaces(t),YU(this.data,s,r),i.silent||this.emit("added",e,t,n,r)}addResources(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{silent:!1};for(const r in n)(lt(n[r])||Array.isArray(n[r]))&&this.addResource(e,t,r,n[r],{silent:!0});r.silent||this.emit("added",e,t,n)}addResourceBundle(e,t,n,r,i){let o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:{silent:!1,skipCopy:!1},s=[e,t];e.indexOf(".")>-1&&(s=e.split("."),r=n,n=t,t=s[1]),this.addNamespaces(t);let a=pE(this.data,s)||{};o.skipCopy||(n=JSON.parse(JSON.stringify(n))),r?cte(a,n,i):a={...a,...n},YU(this.data,s,a),o.silent||this.emit("added",e,t,n)}removeResourceBundle(e,t){this.hasResourceBundle(e,t)&&delete this.data[e][t],this.removeNamespaces(t),this.emit("removed",e,t)}hasResourceBundle(e,t){return void 0!==this.getResource(e,t)}getResourceBundle(e,t){return t||(t=this.options.defaultNS),this.getResource(e,t)}getDataByLanguage(e){return this.data[e]}hasLanguageSomeTranslations(e){const t=this.getDataByLanguage(e);return!!(t&&Object.keys(t)||[]).find((e=>t[e]&&Object.keys(t[e]).length>0))}toJSON(){return this.data}}var ute={processors:{},addPostProcessor(e){this.processors[e.name]=e},handle(e,t,n,r,i){return e.forEach((e=>{var o;t=(null==(o=this.processors[e])?void 0:o.process(t,n,r,i))??t})),t}};const XU={},ZU=e=>!lt(e)&&"boolean"!=typeof e&&"number"!=typeof e;class vE extends tC{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};super(),U$e(["resourceStore","languageUtils","pluralResolver","interpolator","backendConnector","i18nFormat","utils"],e,this),this.options=t,void 0===this.options.keySeparator&&(this.options.keySeparator="."),this.logger=Ea.create("translator")}changeLanguage(e){e&&(this.language=e)}exists(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{interpolation:{}};if(null==e)return!1;const n=this.resolve(e,t);return void 0!==(null==n?void 0:n.res)}extractFromKey(e,t){let n=void 0!==t.nsSeparator?t.nsSeparator:this.options.nsSeparator;void 0===n&&(n=":");const r=void 0!==t.keySeparator?t.keySeparator:this.options.keySeparator;let i=t.ns||this.options.defaultNS||[];const o=n&&e.indexOf(n)>-1,s=!(this.options.userDefinedKeySeparator||t.keySeparator||this.options.userDefinedNsSeparator||t.nsSeparator||W$e(e,n,r));if(o&&!s){const t=e.match(this.interpolator.nestingRegexp);if(t&&t.length>0)return{key:e,namespaces:lt(i)?[i]:i};const o=e.split(n);(n!==r||n===r&&this.options.ns.indexOf(o[0])>-1)&&(i=o.shift()),e=o.join(r)}return{key:e,namespaces:lt(i)?[i]:i}}translate(e,t,n){if("object"!=typeof t&&this.options.overloadTranslationOptionHandler&&(t=this.options.overloadTranslationOptionHandler(arguments)),"object"==typeof t&&(t={...t}),t||(t={}),null==e)return"";Array.isArray(e)||(e=[String(e)]);const r=void 0!==t.returnDetails?t.returnDetails:this.options.returnDetails,i=void 0!==t.keySeparator?t.keySeparator:this.options.keySeparator,{key:o,namespaces:s}=this.extractFromKey(e[e.length-1],t),a=s[s.length-1],l=t.lng||this.language,c=t.appendNamespaceToCIMode||this.options.appendNamespaceToCIMode;if("cimode"===(null==l?void 0:l.toLowerCase())){if(c){const e=t.nsSeparator||this.options.nsSeparator;return r?{res:`${a}${e}${o}`,usedKey:o,exactUsedKey:o,usedLng:l,usedNS:a,usedParams:this.getUsedParamsDetails(t)}:`${a}${e}${o}`}return r?{res:o,usedKey:o,exactUsedKey:o,usedLng:l,usedNS:a,usedParams:this.getUsedParamsDetails(t)}:o}const u=this.resolve(e,t);let d=null==u?void 0:u.res;const h=(null==u?void 0:u.usedKey)||o,p=(null==u?void 0:u.exactUsedKey)||o,f=void 0!==t.joinArrays?t.joinArrays:this.options.joinArrays,m=!this.i18nFormat||this.i18nFormat.handleAsObject,v=void 0!==t.count&&!lt(t.count),g=vE.hasDefaultValue(t),y=v?this.pluralResolver.getSuffix(l,t.count,t):"",b=t.ordinal&&v?this.pluralResolver.getSuffix(l,t.count,{ordinal:!1}):"",_=v&&!t.ordinal&&0===t.count,w=_&&t[`defaultValue${this.options.pluralSeparator}zero`]||t[`defaultValue${y}`]||t[`defaultValue${b}`]||t.defaultValue;let E=d;m&&!d&&g&&(E=w);const S=ZU(E),C=Object.prototype.toString.apply(E);if(!(m&&E&&S&&["[object Number]","[object Function]","[object RegExp]"].indexOf(C)<0)||lt(f)&&Array.isArray(E))if(m&&lt(f)&&Array.isArray(d))d=d.join(f),d&&(d=this.extendTranslation(d,e,t,n));else{let r=!1,s=!1;!this.isValidLookup(d)&&g&&(r=!0,d=w),this.isValidLookup(d)||(s=!0,d=o);const c=(t.missingKeyNoValueFallbackToKey||this.options.missingKeyNoValueFallbackToKey)&&s?void 0:d,h=g&&w!==d&&this.options.updateMissing;if(s||r||h){if(this.logger.log(h?"updateKey":"missingKey",l,a,o,h?w:d),i){const e=this.resolve(o,{...t,keySeparator:!1});e&&e.res&&this.logger.warn("Seems the loaded translations were in flat JSON format instead of nested. Either set keySeparator: false on init or make sure your translations are published in nested format.")}let e=[];const n=this.languageUtils.getFallbackCodes(this.options.fallbackLng,t.lng||this.language);if("fallback"===this.options.saveMissingTo&&n&&n[0])for(let t=0;t<n.length;t++)e.push(n[t]);else"all"===this.options.saveMissingTo?e=this.languageUtils.toResolveHierarchy(t.lng||this.language):e.push(t.lng||this.language);const r=(e,n,r)=>{var i;const o=g&&r!==d?r:c;this.options.missingKeyHandler?this.options.missingKeyHandler(e,a,n,o,h,t):null!=(i=this.backendConnector)&&i.saveMissing&&this.backendConnector.saveMissing(e,a,n,o,h,t),this.emit("missingKey",e,a,n,d)};this.options.saveMissing&&(this.options.saveMissingPlurals&&v?e.forEach((e=>{const n=this.pluralResolver.getSuffixes(e,t);_&&t[`defaultValue${this.options.pluralSeparator}zero`]&&n.indexOf(`${this.options.pluralSeparator}zero`)<0&&n.push(`${this.options.pluralSeparator}zero`),n.forEach((n=>{r([e],o+n,t[`defaultValue${n}`]||w)}))})):r(e,o,w))}d=this.extendTranslation(d,e,t,u,n),s&&d===o&&this.options.appendNamespaceToMissingKey&&(d=`${a}:${o}`),(s||r)&&this.options.parseMissingKeyHandler&&(d=this.options.parseMissingKeyHandler(this.options.appendNamespaceToMissingKey?`${a}:${o}`:o,r?d:void 0))}else{if(!t.returnObjects&&!this.options.returnObjects){this.options.returnedObjectHandler||this.logger.warn("accessing an object - but returnObjects options is not enabled!");const e=this.options.returnedObjectHandler?this.options.returnedObjectHandler(h,E,{...t,ns:s}):`key '${o} (${this.language})' returned an object instead of string.`;return r?(u.res=e,u.usedParams=this.getUsedParamsDetails(t),u):e}if(i){const e=Array.isArray(E),n=e?[]:{},r=e?p:h;for(const e in E)if(Object.prototype.hasOwnProperty.call(E,e)){const o=`${r}${i}${e}`;n[e]=g&&!d?this.translate(o,{...t,defaultValue:ZU(w)?w[e]:void 0,joinArrays:!1,ns:s}):this.translate(o,{...t,joinArrays:!1,ns:s}),n[e]===o&&(n[e]=E[e])}d=n}}return r?(u.res=d,u.usedParams=this.getUsedParamsDetails(t),u):d}extendTranslation(e,t,n,r,i){var o,s,a=this;if(null!=(o=this.i18nFormat)&&o.parse)e=this.i18nFormat.parse(e,{...this.options.interpolation.defaultVariables,...n},n.lng||this.language||r.usedLng,r.usedNS,r.usedKey,{resolved:r});else if(!n.skipInterpolation){n.interpolation&&this.interpolator.init({...n,interpolation:{...this.options.interpolation,...n.interpolation}});const o=lt(e)&&(void 0!==(null==(s=null==n?void 0:n.interpolation)?void 0:s.skipOnVariables)?n.interpolation.skipOnVariables:this.options.interpolation.skipOnVariables);let l;if(o){const t=e.match(this.interpolator.nestingRegexp);l=t&&t.length}let c=n.replace&&!lt(n.replace)?n.replace:n;if(this.options.interpolation.defaultVariables&&(c={...this.options.interpolation.defaultVariables,...c}),e=this.interpolator.interpolate(e,c,n.lng||this.language||r.usedLng,n),o){const t=e.match(this.interpolator.nestingRegexp);l<(t&&t.length)&&(n.nest=!1)}!n.lng&&r&&r.res&&(n.lng=this.language||r.usedLng),!1!==n.nest&&(e=this.interpolator.nest(e,(function(){for(var e=arguments.length,r=new Array(e),o=0;o<e;o++)r[o]=arguments[o];return(null==i?void 0:i[0])!==r[0]||n.context?a.translate(...r,t):(a.logger.warn(`It seems you are nesting recursively key: ${r[0]} in key: ${t[0]}`),null)}),n)),n.interpolation&&this.interpolator.reset()}const l=n.postProcess||this.options.postProcess,c=lt(l)?[l]:l;return null!=e&&null!=c&&c.length&&!1!==n.applyPostProcessor&&(e=ute.handle(c,e,t,this.options&&this.options.postProcessPassResolved?{i18nResolved:{...r,usedParams:this.getUsedParamsDetails(n)},...n}:n,this)),e}resolve(e){let t,n,r,i,o,s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return lt(e)&&(e=[e]),e.forEach((e=>{if(this.isValidLookup(t))return;const a=this.extractFromKey(e,s),l=a.key;n=l;let c=a.namespaces;this.options.fallbackNS&&(c=c.concat(this.options.fallbackNS));const u=void 0!==s.count&&!lt(s.count),d=u&&!s.ordinal&&0===s.count,h=void 0!==s.context&&(lt(s.context)||"number"==typeof s.context)&&""!==s.context,p=s.lngs?s.lngs:this.languageUtils.toResolveHierarchy(s.lng||this.language,s.fallbackLng);c.forEach((e=>{var a,c;this.isValidLookup(t)||(o=e,!XU[`${p[0]}-${e}`]&&null!=(a=this.utils)&&a.hasLoadedNamespace&&!(null!=(c=this.utils)&&c.hasLoadedNamespace(o))&&(XU[`${p[0]}-${e}`]=!0,this.logger.warn(`key "${n}" for languages "${p.join(", ")}" won't get resolved as namespace "${o}" was not yet loaded`,"This means something IS WRONG in your setup. You access the t function before i18next.init / i18next.loadNamespace / i18next.changeLanguage was done. Wait for the callback or Promise to resolve before accessing it!!!")),p.forEach((n=>{var o;if(this.isValidLookup(t))return;i=n;const a=[l];if(null!=(o=this.i18nFormat)&&o.addLookupKeys)this.i18nFormat.addLookupKeys(a,l,n,e,s);else{let e;u&&(e=this.pluralResolver.getSuffix(n,s.count,s));const t=`${this.options.pluralSeparator}zero`,r=`${this.options.pluralSeparator}ordinal${this.options.pluralSeparator}`;if(u&&(a.push(l+e),s.ordinal&&0===e.indexOf(r)&&a.push(l+e.replace(r,this.options.pluralSeparator)),d&&a.push(l+t)),h){const n=`${l}${this.options.contextSeparator}${s.context}`;a.push(n),u&&(a.push(n+e),s.ordinal&&0===e.indexOf(r)&&a.push(n+e.replace(r,this.options.pluralSeparator)),d&&a.push(n+t))}}let c;for(;c=a.pop();)this.isValidLookup(t)||(r=c,t=this.getResource(n,e,c,s))})))}))})),{res:t,usedKey:n,exactUsedKey:r,usedLng:i,usedNS:o}}isValidLookup(e){return!(void 0===e||!this.options.returnNull&&null===e||!this.options.returnEmptyString&&""===e)}getResource(e,t,n){var r;let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return null!=(r=this.i18nFormat)&&r.getResource?this.i18nFormat.getResource(e,t,n,i):this.resourceStore.getResource(e,t,n,i)}getUsedParamsDetails(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const t=["defaultValue","ordinal","context","replace","lng","lngs","fallbackLng","ns","keySeparator","nsSeparator","returnObjects","returnDetails","joinArrays","postProcess","interpolation"],n=e.replace&&!lt(e.replace);let r=n?e.replace:e;if(n&&typeof e.count<"u"&&(r.count=e.count),this.options.interpolation.defaultVariables&&(r={...this.options.interpolation.defaultVariables,...r}),!n){r={...r};for(const e of t)delete r[e]}return r}static hasDefaultValue(e){const t="defaultValue";for(const n in e)if(Object.prototype.hasOwnProperty.call(e,n)&&t===n.substring(0,12)&&void 0!==e[n])return!0;return!1}}class QU{constructor(e){this.options=e,this.supportedLngs=this.options.supportedLngs||!1,this.logger=Ea.create("languageUtils")}getScriptPartFromCode(e){if(!(e=mE(e))||e.indexOf("-")<0)return null;const t=e.split("-");return 2===t.length||(t.pop(),"x"===t[t.length-1].toLowerCase())?null:this.formatLanguageCode(t.join("-"))}getLanguagePartFromCode(e){if(!(e=mE(e))||e.indexOf("-")<0)return e;const t=e.split("-");return this.formatLanguageCode(t[0])}formatLanguageCode(e){if(lt(e)&&e.indexOf("-")>-1){let t;try{t=Intl.getCanonicalLocales(e)[0]}catch{}return t&&this.options.lowerCaseLng&&(t=t.toLowerCase()),t||(this.options.lowerCaseLng?e.toLowerCase():e)}return this.options.cleanCode||this.options.lowerCaseLng?e.toLowerCase():e}isSupportedCode(e){return("languageOnly"===this.options.load||this.options.nonExplicitSupportedLngs)&&(e=this.getLanguagePartFromCode(e)),!this.supportedLngs||!this.supportedLngs.length||this.supportedLngs.indexOf(e)>-1}getBestMatchFromCodes(e){if(!e)return null;let t;return e.forEach((e=>{if(t)return;const n=this.formatLanguageCode(e);(!this.options.supportedLngs||this.isSupportedCode(n))&&(t=n)})),!t&&this.options.supportedLngs&&e.forEach((e=>{if(t)return;const n=this.getLanguagePartFromCode(e);if(this.isSupportedCode(n))return t=n;t=this.options.supportedLngs.find((e=>e===n?e:e.indexOf("-")<0&&n.indexOf("-")<0||!(e.indexOf("-")>0&&n.indexOf("-")<0&&e.substring(0,e.indexOf("-"))===n||0===e.indexOf(n)&&n.length>1)?void 0:e))})),t||(t=this.getFallbackCodes(this.options.fallbackLng)[0]),t}getFallbackCodes(e,t){if(!e)return[];if("function"==typeof e&&(e=e(t)),lt(e)&&(e=[e]),Array.isArray(e))return e;if(!t)return e.default||[];let n=e[t];return n||(n=e[this.getScriptPartFromCode(t)]),n||(n=e[this.formatLanguageCode(t)]),n||(n=e[this.getLanguagePartFromCode(t)]),n||(n=e.default),n||[]}toResolveHierarchy(e,t){const n=this.getFallbackCodes(t||this.options.fallbackLng||[],e),r=[],i=e=>{e&&(this.isSupportedCode(e)?r.push(e):this.logger.warn(`rejecting language code not found in supportedLngs: ${e}`))};return lt(e)&&(e.indexOf("-")>-1||e.indexOf("_")>-1)?("languageOnly"!==this.options.load&&i(this.formatLanguageCode(e)),"languageOnly"!==this.options.load&&"currentOnly"!==this.options.load&&i(this.getScriptPartFromCode(e)),"currentOnly"!==this.options.load&&i(this.getLanguagePartFromCode(e))):lt(e)&&i(this.formatLanguageCode(e)),n.forEach((e=>{r.indexOf(e)<0&&i(this.formatLanguageCode(e))})),r}}const eF={zero:0,one:1,two:2,few:3,many:4,other:5},tF={select:e=>1===e?"one":"other",resolvedOptions:()=>({pluralCategories:["one","other"]})};class Y$e{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.languageUtils=e,this.options=t,this.logger=Ea.create("pluralResolver"),this.pluralRulesCache={}}addRule(e,t){this.rules[e]=t}clearCache(){this.pluralRulesCache={}}getRule(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const n=mE("dev"===e?"en":e),r=t.ordinal?"ordinal":"cardinal",i=JSON.stringify({cleanedCode:n,type:r});if(i in this.pluralRulesCache)return this.pluralRulesCache[i];let o;try{o=new Intl.PluralRules(n,{type:r})}catch{if(!Intl)return this.logger.error("No Intl support, please use an Intl polyfill!"),tF;if(!e.match(/-|_/))return tF;const n=this.languageUtils.getLanguagePartFromCode(e);o=this.getRule(n,t)}return this.pluralRulesCache[i]=o,o}needsPlural(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=this.getRule(e,t);return n||(n=this.getRule("dev",t)),(null==n?void 0:n.resolvedOptions().pluralCategories.length)>1}getPluralFormsOfKey(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return this.getSuffixes(e,n).map((e=>`${t}${e}`))}getSuffixes(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=this.getRule(e,t);return n||(n=this.getRule("dev",t)),n?n.resolvedOptions().pluralCategories.sort(((e,t)=>eF[e]-eF[t])).map((e=>`${this.options.prepend}${t.ordinal?`ordinal${this.options.prepend}`:""}${e}`)):[]}getSuffix(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const r=this.getRule(e,n);return r?`${this.options.prepend}${n.ordinal?`ordinal${this.options.prepend}`:""}${r.select(t)}`:(this.logger.warn(`no plural rule found for: ${e}`),this.getSuffix("dev",t,n))}}const nF=function(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:".",i=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],o=H$e(e,t,n);return!o&&i&&lt(n)&&(o=SP(e,n,r),void 0===o&&(o=SP(t,n,r))),o},_I=e=>e.replace(/\$/g,"$$$$");class J$e{constructor(){var e;let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.logger=Ea.create("interpolator"),this.options=t,this.format=(null==(e=null==t?void 0:t.interpolation)?void 0:e.format)||(e=>e),this.init(t)}init(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};e.interpolation||(e.interpolation={escapeValue:!0});const{escape:t,escapeValue:n,useRawValueToEscape:r,prefix:i,prefixEscaped:o,suffix:s,suffixEscaped:a,formatSeparator:l,unescapeSuffix:c,unescapePrefix:u,nestingPrefix:d,nestingPrefixEscaped:h,nestingSuffix:p,nestingSuffixEscaped:f,nestingOptionsSeparator:m,maxReplaces:v,alwaysFormat:g}=e.interpolation;this.escape=void 0!==t?t:V$e,this.escapeValue=void 0===n||n,this.useRawValueToEscape=void 0!==r&&r,this.prefix=i?sh(i):o||"{{",this.suffix=s?sh(s):a||"}}",this.formatSeparator=l||",",this.unescapePrefix=c?"":u||"-",this.unescapeSuffix=this.unescapePrefix?"":c||"",this.nestingPrefix=d?sh(d):h||sh("$t("),this.nestingSuffix=p?sh(p):f||sh(")"),this.nestingOptionsSeparator=m||",",this.maxReplaces=v||1e3,this.alwaysFormat=void 0!==g&&g,this.resetRegExp()}reset(){this.options&&this.init(this.options)}resetRegExp(){const e=(e,t)=>(null==e?void 0:e.source)===t?(e.lastIndex=0,e):new RegExp(t,"g");this.regexp=e(this.regexp,`${this.prefix}(.+?)${this.suffix}`),this.regexpUnescape=e(this.regexpUnescape,`${this.prefix}${this.unescapePrefix}(.+?)${this.unescapeSuffix}${this.suffix}`),this.nestingRegexp=e(this.nestingRegexp,`${this.nestingPrefix}(.+?)${this.nestingSuffix}`)}interpolate(e,t,n,r){var i;let o,s,a;const l=this.options&&this.options.interpolation&&this.options.interpolation.defaultVariables||{},c=e=>{if(e.indexOf(this.formatSeparator)<0){const i=nF(t,l,e,this.options.keySeparator,this.options.ignoreJSONStructure);return this.alwaysFormat?this.format(i,void 0,n,{...r,...t,interpolationkey:e}):i}const i=e.split(this.formatSeparator),o=i.shift().trim(),s=i.join(this.formatSeparator).trim();return this.format(nF(t,l,o,this.options.keySeparator,this.options.ignoreJSONStructure),s,n,{...r,...t,interpolationkey:o})};this.resetRegExp();const u=(null==r?void 0:r.missingInterpolationHandler)||this.options.missingInterpolationHandler,d=void 0!==(null==(i=null==r?void 0:r.interpolation)?void 0:i.skipOnVariables)?r.interpolation.skipOnVariables:this.options.interpolation.skipOnVariables;return[{regex:this.regexpUnescape,safeValue:e=>_I(e)},{regex:this.regexp,safeValue:e=>this.escapeValue?_I(this.escape(e)):_I(e)}].forEach((t=>{for(a=0;o=t.regex.exec(e);){const n=o[1].trim();if(s=c(n),void 0===s)if("function"==typeof u){const t=u(e,o,r);s=lt(t)?t:""}else if(r&&Object.prototype.hasOwnProperty.call(r,n))s="";else{if(d){s=o[0];continue}this.logger.warn(`missed to pass in variable ${n} for interpolating ${e}`),s=""}else!lt(s)&&!this.useRawValueToEscape&&(s=GU(s));const i=t.safeValue(s);if(e=e.replace(o[0],i),d?(t.regex.lastIndex+=s.length,t.regex.lastIndex-=o[0].length):t.regex.lastIndex=0,a++,a>=this.maxReplaces)break}})),e}nest(e,t){let n,r,i,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const s=(e,t)=>{const n=this.nestingOptionsSeparator;if(e.indexOf(n)<0)return e;const r=e.split(new RegExp(`${n}[ ]*{`));let o=`{${r[1]}`;e=r[0],o=this.interpolate(o,i);const s=o.match(/'/g),a=o.match(/"/g);(((null==s?void 0:s.length)??0)%2==0&&!a||a.length%2!=0)&&(o=o.replace(/'/g,'"'));try{i=JSON.parse(o),t&&(i={...t,...i})}catch(t){return this.logger.warn(`failed parsing options string in nesting for key ${e}`,t),`${e}${n}${o}`}return i.defaultValue&&i.defaultValue.indexOf(this.prefix)>-1&&delete i.defaultValue,e};for(;n=this.nestingRegexp.exec(e);){let a=[];i={...o},i=i.replace&&!lt(i.replace)?i.replace:i,i.applyPostProcessor=!1,delete i.defaultValue;let l=!1;if(-1!==n[0].indexOf(this.formatSeparator)&&!/{.*}/.test(n[1])){const e=n[1].split(this.formatSeparator).map((e=>e.trim()));n[1]=e.shift(),a=e,l=!0}if(r=t(s.call(this,n[1].trim(),i),i),r&&n[0]===e&&!lt(r))return r;lt(r)||(r=GU(r)),r||(this.logger.warn(`missed to resolve ${n[1]} for nesting ${e}`),r=""),l&&(r=a.reduce(((e,t)=>this.format(e,t,o.lng,{...o,interpolationkey:n[1].trim()})),r.trim())),e=e.replace(n[0],r),this.regexp.lastIndex=0}return e}}const X$e=e=>{let t=e.toLowerCase().trim();const n={};if(e.indexOf("(")>-1){const r=e.split("(");t=r[0].toLowerCase().trim();const i=r[1].substring(0,r[1].length-1);"currency"===t&&i.indexOf(":")<0?n.currency||(n.currency=i.trim()):"relativetime"===t&&i.indexOf(":")<0?n.range||(n.range=i.trim()):i.split(";").forEach((e=>{if(e){const[t,...r]=e.split(":"),i=r.join(":").trim().replace(/^'+|'+$/g,""),o=t.trim();n[o]||(n[o]=i),"false"===i&&(n[o]=!1),"true"===i&&(n[o]=!0),isNaN(i)||(n[o]=parseInt(i,10))}}))}return{formatName:t,formatOptions:n}},oh=e=>{const t={};return(n,r,i)=>{let o=i;i&&i.interpolationkey&&i.formatParams&&i.formatParams[i.interpolationkey]&&i[i.interpolationkey]&&(o={...o,[i.interpolationkey]:void 0});const s=r+JSON.stringify(o);let a=t[s];return a||(a=e(mE(r),i),t[s]=a),a(n)}};class Z$e{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.logger=Ea.create("formatter"),this.options=e,this.formats={number:oh(((e,t)=>{const n=new Intl.NumberFormat(e,{...t});return e=>n.format(e)})),currency:oh(((e,t)=>{const n=new Intl.NumberFormat(e,{...t,style:"currency"});return e=>n.format(e)})),datetime:oh(((e,t)=>{const n=new Intl.DateTimeFormat(e,{...t});return e=>n.format(e)})),relativetime:oh(((e,t)=>{const n=new Intl.RelativeTimeFormat(e,{...t});return e=>n.format(e,t.range||"day")})),list:oh(((e,t)=>{const n=new Intl.ListFormat(e,{...t});return e=>n.format(e)}))},this.init(e)}init(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{interpolation:{}};this.formatSeparator=t.interpolation.formatSeparator||","}add(e,t){this.formats[e.toLowerCase().trim()]=t}addCached(e,t){this.formats[e.toLowerCase().trim()]=oh(t)}format(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};const i=t.split(this.formatSeparator);if(i.length>1&&i[0].indexOf("(")>1&&i[0].indexOf(")")<0&&i.find((e=>e.indexOf(")")>-1))){const e=i.findIndex((e=>e.indexOf(")")>-1));i[0]=[i[0],...i.splice(1,e)].join(this.formatSeparator)}return i.reduce(((e,t)=>{var i;const{formatName:o,formatOptions:s}=X$e(t);if(this.formats[o]){let t=e;try{const a=(null==(i=null==r?void 0:r.formatParams)?void 0:i[r.interpolationkey])||{},l=a.locale||a.lng||r.locale||r.lng||n;t=this.formats[o](e,l,{...s,...r,...a})}catch(e){this.logger.warn(e)}return t}return this.logger.warn(`there was no format function for ${o}`),e}),e)}}const Q$e=(e,t)=>{void 0!==e.pending[t]&&(delete e.pending[t],e.pendingCount--)};class eHe extends tC{constructor(e,t,n){var r,i;let o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};super(),this.backend=e,this.store=t,this.services=n,this.languageUtils=n.languageUtils,this.options=o,this.logger=Ea.create("backendConnector"),this.waitingReads=[],this.maxParallelReads=o.maxParallelReads||10,this.readingCalls=0,this.maxRetries=o.maxRetries>=0?o.maxRetries:5,this.retryTimeout=o.retryTimeout>=1?o.retryTimeout:350,this.state={},this.queue=[],null==(i=null==(r=this.backend)?void 0:r.init)||i.call(r,n,o.backend,o)}queueLoad(e,t,n,r){const i={},o={},s={},a={};return e.forEach((e=>{let r=!0;t.forEach((t=>{const s=`${e}|${t}`;!n.reload&&this.store.hasResourceBundle(e,t)?this.state[s]=2:this.state[s]<0||(1===this.state[s]?void 0===o[s]&&(o[s]=!0):(this.state[s]=1,r=!1,void 0===o[s]&&(o[s]=!0),void 0===i[s]&&(i[s]=!0),void 0===a[t]&&(a[t]=!0)))})),r||(s[e]=!0)})),(Object.keys(i).length||Object.keys(o).length)&&this.queue.push({pending:o,pendingCount:Object.keys(o).length,loaded:{},errors:[],callback:r}),{toLoad:Object.keys(i),pending:Object.keys(o),toLoadLanguages:Object.keys(s),toLoadNamespaces:Object.keys(a)}}loaded(e,t,n){const r=e.split("|"),i=r[0],o=r[1];t&&this.emit("failedLoading",i,o,t),!t&&n&&this.store.addResourceBundle(i,o,n,void 0,void 0,{skipCopy:!0}),this.state[e]=t?-1:2,t&&n&&(this.state[e]=0);const s={};this.queue.forEach((n=>{$$e(n.loaded,[i],o),Q$e(n,e),t&&n.errors.push(t),0===n.pendingCount&&!n.done&&(Object.keys(n.loaded).forEach((e=>{s[e]||(s[e]={});const t=n.loaded[e];t.length&&t.forEach((t=>{void 0===s[e][t]&&(s[e][t]=!0)}))})),n.done=!0,n.errors.length?n.callback(n.errors):n.callback())})),this.emit("loaded",s),this.queue=this.queue.filter((e=>!e.done))}read(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:this.retryTimeout,o=arguments.length>5?arguments[5]:void 0;if(!e.length)return o(null,{});if(this.readingCalls>=this.maxParallelReads)return void this.waitingReads.push({lng:e,ns:t,fcName:n,tried:r,wait:i,callback:o});this.readingCalls++;const s=(s,a)=>{if(this.readingCalls--,this.waitingReads.length>0){const e=this.waitingReads.shift();this.read(e.lng,e.ns,e.fcName,e.tried,e.wait,e.callback)}s&&a&&r<this.maxRetries?setTimeout((()=>{this.read.call(this,e,t,n,r+1,2*i,o)}),i):o(s,a)},a=this.backend[n].bind(this.backend);if(2!==a.length)return a(e,t,s);try{const n=a(e,t);n&&"function"==typeof n.then?n.then((e=>s(null,e))).catch(s):s(null,n)}catch(e){s(e)}}prepareLoading(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=arguments.length>3?arguments[3]:void 0;if(!this.backend)return this.logger.warn("No backend was added via i18next.use. Will not load resources."),r&&r();lt(e)&&(e=this.languageUtils.toResolveHierarchy(e)),lt(t)&&(t=[t]);const i=this.queueLoad(e,t,n,r);if(!i.toLoad.length)return i.pending.length||r(),null;i.toLoad.forEach((e=>{this.loadOne(e)}))}load(e,t,n){this.prepareLoading(e,t,{},n)}reload(e,t,n){this.prepareLoading(e,t,{reload:!0},n)}loadOne(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";const n=e.split("|"),r=n[0],i=n[1];this.read(r,i,"read",void 0,void 0,((n,o)=>{n&&this.logger.warn(`${t}loading namespace ${i} for language ${r} failed`,n),!n&&o&&this.logger.log(`${t}loaded namespace ${i} for language ${r}`,o),this.loaded(e,n,o)}))}saveMissing(e,t,n,r,i){var o,s,a,l,c;let u=arguments.length>5&&void 0!==arguments[5]?arguments[5]:{},d=arguments.length>6&&void 0!==arguments[6]?arguments[6]:()=>{};if(null==(s=null==(o=this.services)?void 0:o.utils)||!s.hasLoadedNamespace||null!=(l=null==(a=this.services)?void 0:a.utils)&&l.hasLoadedNamespace(t)){if(null!=n&&""!==n){if(null!=(c=this.backend)&&c.create){const o={...u,isUpdate:i},s=this.backend.create.bind(this.backend);if(s.length<6)try{let i;i=5===s.length?s(e,t,n,r,o):s(e,t,n,r),i&&"function"==typeof i.then?i.then((e=>d(null,e))).catch(d):d(null,i)}catch(e){d(e)}else s(e,t,n,r,d,o)}!e||!e[0]||this.store.addResource(e[0],t,n,r)}}else this.logger.warn(`did not save key "${n}" as the namespace "${t}" was not yet loaded`,"This means something IS WRONG in your setup. You access the t function before i18next.init / i18next.loadNamespace / i18next.changeLanguage was done. Wait for the callback or Promise to resolve before accessing it!!!")}}const rF=()=>({debug:!1,initAsync:!0,ns:["translation"],defaultNS:["translation"],fallbackLng:["dev"],fallbackNS:!1,supportedLngs:!1,nonExplicitSupportedLngs:!1,load:"all",preload:!1,simplifyPluralSuffix:!0,keySeparator:".",nsSeparator:":",pluralSeparator:"_",contextSeparator:"_",partialBundledLanguages:!1,saveMissing:!1,updateMissing:!1,saveMissingTo:"fallback",saveMissingPlurals:!0,missingKeyHandler:!1,missingInterpolationHandler:!1,postProcess:!1,postProcessPassResolved:!1,returnNull:!1,returnEmptyString:!0,returnObjects:!1,joinArrays:!1,returnedObjectHandler:!1,parseMissingKeyHandler:!1,appendNamespaceToMissingKey:!1,appendNamespaceToCIMode:!1,overloadTranslationOptionHandler:e=>{let t={};if("object"==typeof e[1]&&(t=e[1]),lt(e[1])&&(t.defaultValue=e[1]),lt(e[2])&&(t.tDescription=e[2]),"object"==typeof e[2]||"object"==typeof e[3]){const n=e[3]||e[2];Object.keys(n).forEach((e=>{t[e]=n[e]}))}return t},interpolation:{escapeValue:!0,format:e=>e,prefix:"{{",suffix:"}}",formatSeparator:",",unescapePrefix:"-",nestingPrefix:"$t(",nestingSuffix:")",nestingOptionsSeparator:",",maxReplaces:1e3,skipOnVariables:!0}}),iF=e=>{var t,n;return lt(e.ns)&&(e.ns=[e.ns]),lt(e.fallbackLng)&&(e.fallbackLng=[e.fallbackLng]),lt(e.fallbackNS)&&(e.fallbackNS=[e.fallbackNS]),(null==(n=null==(t=e.supportedLngs)?void 0:t.indexOf)?void 0:n.call(t,"cimode"))<0&&(e.supportedLngs=e.supportedLngs.concat(["cimode"])),"boolean"==typeof e.initImmediate&&(e.initAsync=e.initImmediate),e},E_=()=>{},tHe=e=>{Object.getOwnPropertyNames(Object.getPrototypeOf(e)).forEach((t=>{"function"==typeof e[t]&&(e[t]=e[t].bind(e))}))};class _y extends tC{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;if(super(),this.options=iF(e),this.services={},this.logger=Ea,this.modules={external:[]},tHe(this),t&&!this.isInitialized&&!e.isClone){if(!this.options.initAsync)return this.init(e,t),this;setTimeout((()=>{this.init(e,t)}),0)}}init(){var e=this;let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1?arguments[1]:void 0;this.isInitializing=!0,"function"==typeof t&&(n=t,t={}),null==t.defaultNS&&t.ns&&(lt(t.ns)?t.defaultNS=t.ns:t.ns.indexOf("translation")<0&&(t.defaultNS=t.ns[0]));const r=rF();this.options={...r,...this.options,...iF(t)},this.options.interpolation={...r.interpolation,...this.options.interpolation},void 0!==t.keySeparator&&(this.options.userDefinedKeySeparator=t.keySeparator),void 0!==t.nsSeparator&&(this.options.userDefinedNsSeparator=t.nsSeparator);const i=e=>e?"function"==typeof e?new e:e:null;if(!this.options.isClone){let t;this.modules.logger?Ea.init(i(this.modules.logger),this.options):Ea.init(null,this.options),t=this.modules.formatter?this.modules.formatter:Z$e;const n=new QU(this.options);this.store=new JU(this.options.resources,this.options);const o=this.services;o.logger=Ea,o.resourceStore=this.store,o.languageUtils=n,o.pluralResolver=new Y$e(n,{prepend:this.options.pluralSeparator,simplifyPluralSuffix:this.options.simplifyPluralSuffix}),t&&(!this.options.interpolation.format||this.options.interpolation.format===r.interpolation.format)&&(o.formatter=i(t),o.formatter.init(o,this.options),this.options.interpolation.format=o.formatter.format.bind(o.formatter)),o.interpolator=new J$e(this.options),o.utils={hasLoadedNamespace:this.hasLoadedNamespace.bind(this)},o.backendConnector=new eHe(i(this.modules.backend),o.resourceStore,o,this.options),o.backendConnector.on("*",(function(t){for(var n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];e.emit(t,...r)})),this.modules.languageDetector&&(o.languageDetector=i(this.modules.languageDetector),o.languageDetector.init&&o.languageDetector.init(o,this.options.detection,this.options)),this.modules.i18nFormat&&(o.i18nFormat=i(this.modules.i18nFormat),o.i18nFormat.init&&o.i18nFormat.init(this)),this.translator=new vE(this.services,this.options),this.translator.on("*",(function(t){for(var n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];e.emit(t,...r)})),this.modules.external.forEach((e=>{e.init&&e.init(this)}))}if(this.format=this.options.interpolation.format,n||(n=E_),this.options.fallbackLng&&!this.services.languageDetector&&!this.options.lng){const e=this.services.languageUtils.getFallbackCodes(this.options.fallbackLng);e.length>0&&"dev"!==e[0]&&(this.options.lng=e[0])}!this.services.languageDetector&&!this.options.lng&&this.logger.warn("init: no languageDetector is used and no lng is defined"),["getResource","hasResourceBundle","getResourceBundle","getDataByLanguage"].forEach((t=>{this[t]=function(){return e.store[t](...arguments)}})),["addResource","addResources","addResourceBundle","removeResourceBundle"].forEach((t=>{this[t]=function(){return e.store[t](...arguments),e}}));const o=xg(),s=()=>{const e=(e,t)=>{this.isInitializing=!1,this.isInitialized&&!this.initializedStoreOnce&&this.logger.warn("init: i18next is already initialized. You should call init just once!"),this.isInitialized=!0,this.options.isClone||this.logger.log("initialized",this.options),this.emit("initialized",this.options),o.resolve(t),n(e,t)};if(this.languages&&!this.isInitialized)return e(null,this.t.bind(this));this.changeLanguage(this.options.lng,e)};return this.options.resources||!this.options.initAsync?s():setTimeout(s,0),o}loadResources(e){var t,n;let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:E_;const i=lt(e)?e:this.language;if("function"==typeof e&&(r=e),!this.options.resources||this.options.partialBundledLanguages){if("cimode"===(null==i?void 0:i.toLowerCase())&&(!this.options.preload||0===this.options.preload.length))return r();const e=[],o=t=>{t&&"cimode"!==t&&this.services.languageUtils.toResolveHierarchy(t).forEach((t=>{"cimode"!==t&&e.indexOf(t)<0&&e.push(t)}))};i?o(i):this.services.languageUtils.getFallbackCodes(this.options.fallbackLng).forEach((e=>o(e))),null==(n=null==(t=this.options.preload)?void 0:t.forEach)||n.call(t,(e=>o(e))),this.services.backendConnector.load(e,this.options.ns,(e=>{!e&&!this.resolvedLanguage&&this.language&&this.setResolvedLanguage(this.language),r(e)}))}else r(null)}reloadResources(e,t,n){const r=xg();return"function"==typeof e&&(n=e,e=void 0),"function"==typeof t&&(n=t,t=void 0),e||(e=this.languages),t||(t=this.options.ns),n||(n=E_),this.services.backendConnector.reload(e,t,(e=>{r.resolve(),n(e)})),r}use(e){if(!e)throw new Error("You are passing an undefined module! Please check the object you are passing to i18next.use()");if(!e.type)throw new Error("You are passing a wrong module! Please check the object you are passing to i18next.use()");return"backend"===e.type&&(this.modules.backend=e),("logger"===e.type||e.log&&e.warn&&e.error)&&(this.modules.logger=e),"languageDetector"===e.type&&(this.modules.languageDetector=e),"i18nFormat"===e.type&&(this.modules.i18nFormat=e),"postProcessor"===e.type&&ute.addPostProcessor(e),"formatter"===e.type&&(this.modules.formatter=e),"3rdParty"===e.type&&this.modules.external.push(e),this}setResolvedLanguage(e){if(e&&this.languages&&!(["cimode","dev"].indexOf(e)>-1))for(let e=0;e<this.languages.length;e++){const t=this.languages[e];if(!(["cimode","dev"].indexOf(t)>-1)&&this.store.hasLanguageSomeTranslations(t)){this.resolvedLanguage=t;break}}}changeLanguage(e,t){var n=this;this.isLanguageChangingTo=e;const r=xg();this.emit("languageChanging",e);const i=e=>{this.language=e,this.languages=this.services.languageUtils.toResolveHierarchy(e),this.resolvedLanguage=void 0,this.setResolvedLanguage(e)},o=(e,o)=>{o?(i(o),this.translator.changeLanguage(o),this.isLanguageChangingTo=void 0,this.emit("languageChanged",o),this.logger.log("languageChanged",o)):this.isLanguageChangingTo=void 0,r.resolve((function(){return n.t(...arguments)})),t&&t(e,(function(){return n.t(...arguments)}))},s=t=>{var n,r;!e&&!t&&this.services.languageDetector&&(t=[]);const s=lt(t)?t:this.services.languageUtils.getBestMatchFromCodes(t);s&&(this.language||i(s),this.translator.language||this.translator.changeLanguage(s),null==(r=null==(n=this.services.languageDetector)?void 0:n.cacheUserLanguage)||r.call(n,s)),this.loadResources(s,(e=>{o(e,s)}))};return e||!this.services.languageDetector||this.services.languageDetector.async?!e&&this.services.languageDetector&&this.services.languageDetector.async?0===this.services.languageDetector.detect.length?this.services.languageDetector.detect().then(s):this.services.languageDetector.detect(s):s(e):s(this.services.languageDetector.detect()),r}getFixedT(e,t,n){var r=this;const i=function(e,t){let o;if("object"!=typeof t){for(var s=arguments.length,a=new Array(s>2?s-2:0),l=2;l<s;l++)a[l-2]=arguments[l];o=r.options.overloadTranslationOptionHandler([e,t].concat(a))}else o={...t};o.lng=o.lng||i.lng,o.lngs=o.lngs||i.lngs,o.ns=o.ns||i.ns,""!==o.keyPrefix&&(o.keyPrefix=o.keyPrefix||n||i.keyPrefix);const c=r.options.keySeparator||".";let u;return u=o.keyPrefix&&Array.isArray(e)?e.map((e=>`${o.keyPrefix}${c}${e}`)):o.keyPrefix?`${o.keyPrefix}${c}${e}`:e,r.t(u,o)};return lt(e)?i.lng=e:i.lngs=e,i.ns=t,i.keyPrefix=n,i}t(){for(var e,t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return null==(e=this.translator)?void 0:e.translate(...n)}exists(){for(var e,t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return null==(e=this.translator)?void 0:e.exists(...n)}setDefaultNamespace(e){this.options.defaultNS=e}hasLoadedNamespace(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!this.isInitialized)return this.logger.warn("hasLoadedNamespace: i18next was not initialized",this.languages),!1;if(!this.languages||!this.languages.length)return this.logger.warn("hasLoadedNamespace: i18n.languages were undefined or empty",this.languages),!1;const n=t.lng||this.resolvedLanguage||this.languages[0],r=!!this.options&&this.options.fallbackLng,i=this.languages[this.languages.length-1];if("cimode"===n.toLowerCase())return!0;const o=(e,t)=>{const n=this.services.backendConnector.state[`${e}|${t}`];return-1===n||0===n||2===n};if(t.precheck){const e=t.precheck(this,o);if(void 0!==e)return e}return!!(this.hasResourceBundle(n,e)||!this.services.backendConnector.backend||this.options.resources&&!this.options.partialBundledLanguages||o(n,e)&&(!r||o(i,e)))}loadNamespaces(e,t){const n=xg();return this.options.ns?(lt(e)&&(e=[e]),e.forEach((e=>{this.options.ns.indexOf(e)<0&&this.options.ns.push(e)})),this.loadResources((e=>{n.resolve(),t&&t(e)})),n):(t&&t(),Promise.resolve())}loadLanguages(e,t){const n=xg();lt(e)&&(e=[e]);const r=this.options.preload||[],i=e.filter((e=>r.indexOf(e)<0&&this.services.languageUtils.isSupportedCode(e)));return i.length?(this.options.preload=r.concat(i),this.loadResources((e=>{n.resolve(),t&&t(e)})),n):(t&&t(),Promise.resolve())}dir(e){var t,n;if(e||(e=this.resolvedLanguage||((null==(t=this.languages)?void 0:t.length)>0?this.languages[0]:this.language)),!e)return"rtl";const r=(null==(n=this.services)?void 0:n.languageUtils)||new QU(rF());return["ar","shu","sqr","ssh","xaa","yhd","yud","aao","abh","abv","acm","acq","acw","acx","acy","adf","ads","aeb","aec","afb","ajp","apc","apd","arb","arq","ars","ary","arz","auz","avl","ayh","ayl","ayn","ayp","bbz","pga","he","iw","ps","pbt","pbu","pst","prp","prd","ug","ur","ydd","yds","yih","ji","yi","hbo","men","xmn","fa","jpr","peo","pes","prs","dv","sam","ckb"].indexOf(r.getLanguagePartFromCode(e))>-1||e.toLowerCase().indexOf("-arab")>1?"rtl":"ltr"}static createInstance(){return new _y(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},arguments.length>1?arguments[1]:void 0)}cloneInstance(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:E_;const n=e.forkResourceStore;n&&delete e.forkResourceStore;const r={...this.options,...e,isClone:!0},i=new _y(r);if((void 0!==e.debug||void 0!==e.prefix)&&(i.logger=i.logger.clone(e)),["store","services","language"].forEach((e=>{i[e]=this[e]})),i.services={...this.services},i.services.utils={hasLoadedNamespace:i.hasLoadedNamespace.bind(i)},n){const e=Object.keys(this.store.data).reduce(((e,t)=>(e[t]={...this.store.data[t]},Object.keys(e[t]).reduce(((n,r)=>(n[r]={...e[t][r]},n)),{}))),{});i.store=new JU(e,r),i.services.resourceStore=i.store}return i.translator=new vE(i.services,r),i.translator.on("*",(function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];i.emit(e,...n)})),i.init(r,t),i.translator.options=r,i.translator.backendConnector.services.utils={hasLoadedNamespace:i.hasLoadedNamespace.bind(i)},i}toJSON(){return{options:this.options,store:this.store,language:this.language,languages:this.languages,resolvedLanguage:this.resolvedLanguage}}}const hi=_y.createInstance();hi.createInstance=_y.createInstance,hi.createInstance,hi.dir,hi.init,hi.loadResources,hi.reloadResources,hi.use,hi.changeLanguage,hi.getFixedT;const qo=hi.t;hi.exists,hi.setDefaultNamespace,hi.hasLoadedNamespace,hi.loadNamespaces,hi.loadLanguages;var rO=(e=>(e.MISSING_MATRIX_RTC_FOCUS="MISSING_MATRIX_RTC_FOCUS",e.CONNECTION_LOST_ERROR="CONNECTION_LOST_ERROR",e.MEMBERSHIP_MANAGER_UNRECOVERABLE="MEMBERSHIP_MANAGER_UNRECOVERABLE",e.INSUFFICIENT_CAPACITY_ERROR="INSUFFICIENT_CAPACITY_ERROR",e.E2EE_NOT_SUPPORTED="E2EE_NOT_SUPPORTED",e.OPEN_ID_ERROR="OPEN_ID_ERROR",e.UNKNOWN_ERROR="UNKNOWN_ERROR",e))(rO||{}),jb=(e=>(e.CONFIGURATION_ISSUE="CONFIGURATION_ISSUE",e.NETWORK_CONNECTIVITY="NETWORK_CONNECTIVITY",e.RTC_SESSION_FAILURE="RTC_SESSION_FAILURE",e.CLIENT_CONFIGURATION="CLIENT_CONFIGURATION",e.UNKNOWN="UNKNOWN",e))(jb||{});class Fa extends Error{constructor(e,t,n,r,i){super(e,{cause:i}),this.localisedTitle=e,this.localisedMessage=r,this.category=n,this.code=t}}class nHe extends Fa{constructor(e){super(qo("error.call_is_not_supported"),"MISSING_MATRIX_RTC_FOCUS","CONFIGURATION_ISSUE",qo("error.matrix_rtc_focus_missing",{domain:e,brand:"Element Call",errorCode:"MISSING_MATRIX_RTC_FOCUS"})),this.domain=e}}class dte extends Fa{constructor(){super(qo("error.connection_lost"),"CONNECTION_LOST_ERROR","NETWORK_CONNECTIVITY",qo("error.connection_lost_description"))}}class rHe extends Fa{constructor(e,t){super("RTCSession Error",e,"RTC_SESSION_FAILURE",t)}}class iHe extends Fa{constructor(){super(qo("error.e2ee_unsupported"),"E2EE_NOT_SUPPORTED","CLIENT_CONFIGURATION",qo("error.e2ee_unsupported_description"))}}class iO extends Fa{constructor(e){super(qo("error.generic"),"UNKNOWN_ERROR","UNKNOWN",e.message,e)}}class fte extends Fa{constructor(e){super(qo("error.generic"),"OPEN_ID_ERROR","CONFIGURATION_ISSUE",void 0,e)}}class sHe extends Fa{constructor(){super(qo("error.insufficient_capacity"),"INSUFFICIENT_CAPACITY_ERROR","UNKNOWN",qo("error.insufficient_capacity_description"))}}function oHe(e,t){return void 0===e&&void 0===t||void 0!==e&&void 0!==t&&(e.jwt===t.jwt&&e.url===t.url)}function aHe(e,t){const[n,r]=_.useState(void 0),i=D$e(t),{showErrorBoundary:o}=j$e();return _.useEffect((()=>{i?lHe(e,i).then((e=>{r(e)}),(e=>{o(new fte(e)),A.error("Failed to get SFU config",e)})):r(void 0)}),[e,i,o]),n}async function lHe(e,t){let n;try{n=await n7e((async()=>e.getOpenIdToken()))}catch(e){throw new fte(e instanceof Error?e:new Error("Unknown error"))}A.debug("Got openID token",n);try{A.info(`Trying to get JWT from call's active focus URL of ${t.livekit_service_url}...`);const r=await cHe(e,t.livekit_service_url,t.livekit_alias,n);return A.info("Got JWT from call's active focus URL."),r}catch(e){return void A.warn(`Failed to get JWT from RTC session's active focus URL of ${t.livekit_service_url}.`,e)}}async function cHe(e,t,n,r){try{const i=await fetch(t+"/sfu/get",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({room:n,openid_token:r,device_id:e.getDeviceId()})});if(!i.ok)throw new Error("SFU Config fetch failed with status code "+i.status);return await i.json()}catch(e){throw new Error("SFU Config fetch failed with exception "+e)}}var EP=(e=>(e.ECSwitchingFocus="ec_switching_focus",e.ECWaiting="ec_waiting",e))(EP||{});function w_(e){return!(null==e||!e.url||null==e||!e.jwt)}async function uHe(e,t,n,r){if(e.localParticipant.getTrackPublication(ue.Source.Microphone))return A.warn("Pre-creating audio track but participant already appears to have an microphone track: this shouldn't happen!"),void gme("Pre-creating audio track but participant already appears to have an microphone track!");let i;A.info("Pre-creating microphone track");try{const t=await e.localParticipant.createTracks({audio:r});t.length<1?A.info("Tried to pre-create local audio track but got no tracks"):i=t[0],A.info("Pre-created microphone track")}catch(e){A.error("Failed to pre-create microphone track",e)}if(n||await(null==i?void 0:i.mute()),e.localParticipant.getTrackPublication(ue.Source.Microphone))return A.warn("Pre-created audio track but participant already appears to have an microphone track: this shouldn't happen!"),void(null==i||i.stop());A.info("Connecting & publishing");try{await hte(e,t,i,[])}catch(e){throw null==i||i.stop(),A.debug("Stopped precreated audio tracks."),e}}async function hte(e,t,n,r){const i=Et.instance.eventCallConnectDuration;i.cacheConnectStart(),e.once(le.SignalConnected,i.cacheWsConnect);try{await e.connect(t.url,t.jwt,{peerConnectionTimeout:window.peerConnectionTimeout??45e3,websocketTimeout:window.websocketTimeout??45e3})}catch(e){throw e instanceof en&&(503===e.status||200===e.status||429===e.status)?new sHe:e}e.off(le.SignalConnected,i.cacheWsConnect),i.track({log:!0}),n&&(A.info("Publishing precreated mic track"),await e.localParticipant.publishTrack(n,{source:ue.Source.Microphone})),A.info(`Publishing ${r.length} precreated screenshare tracks`);for(const t of r)e.localParticipant.publishTrack(t,{source:ue.Source.ScreenShare}).catch((e=>{A.error("Failed to publish screenshare track",e)}))}function dHe(e,t,n,r){const[i,o]=_.useState(r&&n?n.state:"ec_waiting"),[s,a]=_.useState(!1),[l,c]=_.useState(!1),[u,d]=_.useState(null);if(null!==u)throw u;const h=_.useCallback((e=>{e==St.Connected&&a(!1),o(e)}),[]);_.useEffect((()=>{const e=n;return n&&n.on(le.ConnectionStateChanged,h),()=>{e&&e.off(le.ConnectionStateChanged,h)}}),[n,h]);const p=_.useCallback((async()=>{const e=[];for(const t of n.localParticipant.videoTrackPublications.values())if(t.track&&t.source==ue.Source.ScreenShare){const n=t.track.mediaStreamTrack.clone();n.enabled=!0,e.push(n)}a(!0),await(null==n?void 0:n.disconnect()),c(!0);try{await hte(n,r,void 0,e)}finally{c(!1)}}),[n,r]),f=_.useRef(Object.assign({},r));return _.useEffect((()=>{var i;w_(r)&&w_(f.current)&&!oHe(f.current,r)?(A.info(`SFU config changed! URL was ${null==(i=f.current)?void 0:i.url} now ${null==r?void 0:r.url}`),p().catch((e=>{A.error("Failed to switch focus",e)}))):!w_(f.current)&&w_(r)&&(c(!0),uHe(n,r,t,e).catch((e=>{e instanceof Fa?d(e):e instanceof Error?d(new iO(e)):A.error("Failed to connect to SFU",e)})).finally((()=>c(!1)))),f.current=Object.assign({},r)}),[r,n,e,t,p]),s?"ec_switching_focus":l?St.Connecting:i}class fHe extends jV{constructor(){super({ratchetWindowSize:10,keyringSize:256}),this.onEncryptionKeyChanged=(e,t,n)=>{DV(e).then((e=>{var r;this.onSetEncryptionKey(e,n,t),A.debug(`Sent new key to livekit room=${null==(r=this.rtcSession)?void 0:r.room.roomId} participantId=${n} encryptionKeyIndex=${t}`)}),(e=>{var r;A.error(`Failed to create key material from buffer for livekit room=${null==(r=this.rtcSession)?void 0:r.room.roomId} participantId=${n} encryptionKeyIndex=${t}`,e)}))}}setRTCSession(e){this.rtcSession&&this.rtcSession.off(ar.EncryptionKeyChanged,this.onEncryptionKeyChanged),this.rtcSession=e,this.rtcSession.on(ar.EncryptionKeyChanged,this.onEncryptionKeyChanged),this.rtcSession.reemitEncryptionKeys()}}function hHe(e,t,n,r){const i=_.useMemo((()=>{if(r.kind!==Ut.NONE){if(r.kind===Ut.PER_PARTICIPANT)return A.info("Created MatrixKeyProvider (per participant)"),{keyProvider:new fHe,worker:new KU};if(r.kind===Ut.SHARED_KEY&&r.secret)return A.info("Created ExternalE2EEKeyProvider (shared key)"),{keyProvider:new pue,worker:new KU}}}),[r]);_.useEffect((()=>{r.kind===Ut.NONE||!i||(r.kind===Ut.PER_PARTICIPANT?i.keyProvider.setRTCSession(e):r.kind===Ut.SHARED_KEY&&r.secret&&i.keyProvider.setKey(r.secret).catch((e=>{A.error("Failed to set shared key for E2EE",e)})))}),[i,r,e]);const o=_.useRef(t),s=uf(),a=_.useRef(s),l=_.useMemo((()=>({...yI,videoCaptureDefaults:{...yI.videoCaptureDefaults,deviceId:a.current.videoInput.selectedId},audioCaptureDefaults:{...yI.audioCaptureDefaults,deviceId:a.current.audioInput.selectedId},audioOutput:{deviceId:a.current.audioOutput.selectedId},e2ee:i})),[i]),c=_.useRef(!1),u=_.useRef(!1),d=_.useRef({audio:o.current.audio.enabled,video:o.current.video.enabled}),h=_.useMemo((()=>{const e=new Al(l);return e.setE2EEEnabled(r.kind!==Ut.NONE).catch((e=>{A.error("Failed to set E2EE enabled on room",e)})),e}),[l,r]),p=dHe({deviceId:a.current.audioInput.selectedId},o.current.audio.enabled,h,n);return _.useEffect((()=>{if(void 0!==h&&p===St.Connected){const n=h.localParticipant;let r;d.current={audio:t.audio.enabled,video:t.video.enabled},(e=r||(r={}))[e.Microphone=0]="Microphone",e[e.Camera=1]="Camera";const i=async(e,o)=>{var s,a,l,h;if(e>10)return void A.error("Stop trying to sync the input device with current mute state after 10 failed tries");let p,f,m;switch(o){case 0:p=n.isMicrophoneEnabled,f=d.current.audio,m=c.current;break;case 1:p=n.isCameraEnabled,f=d.current.video,m=u.current}if(p!==f&&!m)try{let t;switch(o){case 0:c.current=!0,t=await n.setMicrophoneEnabled(d.current.audio),c.current=!1;break;case 1:u.current=!0,t=await n.setCameraEnabled(d.current.video),u.current=!1}if(!t)throw new Error("track with new mute state could not be published");await new Promise((e=>setTimeout(e,100))),await i(e+1,o)}catch(n){"NotAllowedError"===n.name?(A.error("Fatal error while syncing mute state: resetting",n),0===o?(c.current=!1,null==(a=(s=t.audio).setEnabled)||a.call(s,!1)):(u.current=!1,null==(h=(l=t.video).setEnabled)||h.call(l,!1))):(A.error("Failed to sync audio mute state with LiveKit (will retry to sync in 1s):",n),setTimeout((()=>{i(e+1,o).catch((t=>{A.error(`Failed to sync ${r[o]} mute state with LiveKit iterCount=${e+1}`,t)}))}),1e3))}};i(0,0).catch((e=>{A.error("Failed to sync audio mute state with LiveKit",e)})),i(0,1).catch((e=>{A.error("Failed to sync video mute state with LiveKit",e)}))}var e}),[h,t,p]),_.useEffect((()=>{if(void 0!==h&&p===St.Connected){const e=(e,t)=>{var n,r,i,o;const s=t.selectedId;if("default"===s&&"audioinput"===e&&"default"===(null==(n=h.options.audioCaptureDefaults)?void 0:n.deviceId)){const e=null==(r=Array.from(h.localParticipant.audioTrackPublications.values()).find((e=>e.source===ue.Source.Microphone)))?void 0:r.track;e&&"ended"!==e.mediaStreamTrack.readyState&&t.selectedGroupId!==e.mediaStreamTrack.getSettings().groupId&&(null==(o=null==(i=h.localParticipant.getTrackPublication(ue.Source.Microphone))?void 0:i.audioTrack)||o.restartTrack().catch((e=>{A.error("Failed to restart audio device track",e)})))}else void 0!==s&&h.getActiveDevice(e)!==s&&h.switchActiveDevice(e,s).catch((t=>A.error(`Failed to sync ${e} device with LiveKit`,t)))};e("audioinput",s.audioInput),e("audiooutput",s.audioOutput),e("videoinput",s.videoInput)}}),[h,s,p]),{connState:p,livekitRoom:h}}function pHe(){_.useEffect((()=>{if("wakeLock"in navigator){let e=!0,t=null;const n=()=>{"visible"===document.visibilityState&&navigator.wakeLock.request("screen").then((n=>{t=n,e||t.release().catch((e=>A.warn("Can't release wake lock",e)))}),(e=>{A.warn("Can't acquire wake lock",e)}))};return n(),document.addEventListener("visibilitychange",n),()=>{e=!1,null!==t&&t.release().catch((e=>A.warn("Can't release wake lock",e))),document.removeEventListener("visibilitychange",n)}}}),[])}const mHe="_toggle_z1rxf_8",gHe={toggle:mHe},vHe=({layout:e,setLayout:t,className:n,onTouchEnd:r})=>{const{t:i}=ze(),o=_.useCallback((e=>t(e.target.value)),[t]);return E.jsxs("div",{className:Ae(gHe.toggle,n),children:[E.jsx(ui,{label:i("layout_spotlight_label"),children:E.jsx("input",{type:"radio",name:"layout",value:"spotlight",checked:"spotlight"===e,onChange:o,onTouchEnd:r})}),E.jsx(rRe,{"aria-hidden":!0,width:24,height:24}),E.jsx(ui,{label:i("layout_grid_label"),children:E.jsx("input",{type:"radio",name:"layout",value:"grid",checked:"grid"===e,onChange:o,onTouchEnd:r})}),E.jsx(K2e,{"aria-hidden":!0,width:24,height:24})]})},vh=new Or;window.controls={canEnterPip:()=>vh.observed,enablePip(){if(!vh.observed)throw new Error("No call is running");vh.next(!0)},disablePip(){if(!vh.observed)throw new Error("No call is running");vh.next(!1)}};let yHe=0;function _He(){return(yHe++).toString()}class pte extends Gw{constructor(e){super(),this.media$=e,this.id=_He()}}class bHe extends Gw{constructor(e,t){super(),this.media$=e,this.maximised$=t}}function SHe(e,t){return{[Symbol.iterator](){const n=e[Symbol.iterator](),r=t[Symbol.iterator]();return{next(){let e;do{if(e=n.next(),!e.done&&void 0!==e.value)return e;const t=r.next();if(!t.done)return t}while(!e.done);return e}}}}}function C_(e){return e.map((e=>{var t;return(null==(t=e.media.member)?void 0:t.rawDisplayName)??"[👻]"}))}let Ub=!1;E4.value$.subscribe((e=>Ub=e));class EHe{get media(){return this.media$.value}set media(e){this.media$.next(e)}get maximised(){return this.maximised$.value}set maximised(e){this.maximised$.next(e)}constructor(e,t){this.media$=new ns(e),this.maximised$=new ns(t),this.vm=new bHe(this.media$,this.maximised$)}destroy(){this.vm.destroy()}}class sF{get media(){return this.media$.value}set media(e){this.media$.next(e)}constructor(e){this.media$=new ns(e),this.vm=new pte(this.media$)}destroy(){this.vm.destroy()}}class yE{constructor(e,t,n){var r;this.spotlight=e,this.grid=t,this.generation=n,this.spotlightTile=null==(r=this.spotlight)?void 0:r.vm,this.gridTiles=this.grid.map((({vm:e})=>e)),this.gridTilesByMedia=new Map(this.grid.map((({vm:e,media:t})=>[t,e])))}static empty(){return new yE(null,[],0)}from(e){return new wHe(this.spotlight,this.grid,((e,t)=>new yE(e,t,this.generation+1)),e,this.generation)}}class wHe{constructor(e,t,n,r,i){var o;this.prevSpotlight=e,this.prevGrid=t,this.construct=n,this.visibleTiles=r,this.generation=i,this.spotlight=null,this.prevSpotlightSpeaker=1===(null==(o=this.prevSpotlight)?void 0:o.media.length)&&"speaking"in this.prevSpotlight.media[0]&&this.prevSpotlight.media[0],this.prevGridByMedia=new Map(this.prevGrid.map(((e,t)=>[e.media,[e,t]]))),this.numGridEntries=0,this.stationaryGridEntries=new Array(this.prevGrid.length),this.visibleGridEntries=[],this.invisibleGridEntries=[]}registerSpotlight(e,t){if(Ub&&A.debug(`[TileStore, ${this.generation}] register spotlight: ${e.map((e=>{var t;return(null==(t=e.member)?void 0:t.rawDisplayName)??"[👻]"}))}`),null!==this.spotlight)throw new Error("Spotlight already set");if(this.numGridEntries>0)throw new Error("Spotlight must be registered before grid tiles");null===this.prevSpotlight?this.spotlight=new EHe(e,t):(this.spotlight=this.prevSpotlight,this.spotlight.media=e,this.spotlight.maximised=t)}registerGridTile(e){var t;if(Ub&&A.debug(`[TileStore, ${this.generation}] register grid tile: ${(null==(t=e.member)?void 0:t.rawDisplayName)??"[👻]"}`),null!==this.spotlight){if(!e.local&&this.spotlight.media.includes(e))return;if(e===this.prevSpotlightSpeaker&&1===this.spotlight.media.length&&"speaking"in this.spotlight.media[0]&&this.prevSpotlightSpeaker!==this.spotlight.media[0]){const t=this.prevGridByMedia.get(this.spotlight.media[0]);if(void 0!==t){const[n,r]=t,i=r<this.visibleTiles,o=this.numGridEntries<this.visibleTiles;return i===o?(this.stationaryGridEntries[r]=n,n.media=e,this.prevGridByMedia.delete(this.spotlight.media[0]),this.prevGridByMedia.set(e,t)):(o?this.visibleGridEntries:this.invisibleGridEntries).push(new sF(e)),void this.numGridEntries++}}}const n=this.prevGridByMedia.get(e);if(void 0===n)(this.numGridEntries<this.visibleTiles?this.visibleGridEntries:this.invisibleGridEntries).push(new sF(e));else{const[e,t]=n,r=t<this.visibleTiles,i=this.numGridEntries<this.visibleTiles;r===i?this.stationaryGridEntries[t]=e:(i?this.visibleGridEntries:this.invisibleGridEntries).push(e)}this.numGridEntries++}build(){const e=[...SHe(this.stationaryGridEntries,[...this.visibleGridEntries,...this.invisibleGridEntries])];Ub&&(A.debug(`[TileStore, ${this.generation}] stationary: ${C_(this.stationaryGridEntries)}`),A.debug(`[TileStore, ${this.generation}] visible: ${C_(this.visibleGridEntries)}`),A.debug(`[TileStore, ${this.generation}] invisible: ${C_(this.invisibleGridEntries)}`),A.debug(`[TileStore, ${this.generation}] result: ${C_(e)}`)),null===this.spotlight&&null!==this.prevSpotlight&&this.prevSpotlight.destroy();const t=new Set(e);for(const e of this.prevGrid)t.has(e)||e.destroy();return this.construct(this.spotlight,e)}}function CHe(e,t,n,r){const i=r.from(t);void 0!==e.spotlight&&i.registerSpotlight(e.spotlight,"spotlight-portrait"===e.type);for(const t of e.grid)i.registerGridTile(t);const o=i.build();return[{type:e.type,spotlight:o.spotlightTile,grid:o.gridTiles,setVisibleTiles:n},o]}function THe(e,t){const n=t.from(1);n.registerSpotlight(e.spotlight,!0),void 0!==e.pip&&n.registerGridTile(e.pip);const r=n.build();return[{type:e.type,spotlight:r.spotlightTile,pip:r.gridTiles[0]},r]}function RHe(e,t){const n=t.from(2);n.registerGridTile(e.local),n.registerGridTile(e.remote);const r=n.build();return[{type:e.type,local:r.gridTilesByMedia.get(e.local),remote:r.gridTilesByMedia.get(e.remote)},r]}function IHe(e,t){const n=t.from(0);n.registerSpotlight(e.spotlight,!0);const r=n.build();return[{type:e.type,spotlight:r.spotlightTile},r]}function kHe(e){const t=e.pipe(va());return t.pipe(N5e((e=>sy(Kc(e?1e3:6e4),t.pipe(Fo((t=>t!==e)))))),un(!1),va())}function oF(e,t){if(e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}const Pg=new Map;function wP(e){if(Pg.has(e))return Pg.get(e);const t=zc(e);return Pg.size>500&&Pg.clear(),Pg.set(e,t),t}function xHe(e,t,n){const{rawDisplayName:r,userId:i}=e;if(!r||r===i)return!1;const o=wP(r);return!!o&&(!(!/@.+:.+/.test(r)&&!/[\u200E\u200F\u202A-\u202F]/.test(r))||t.map((e=>e.sender&&n.getMember(e.sender))).filter((e=>!!e)).filter((e=>e.userId!==i)).some((e=>wP(mte(e,!1))===o)))}function mte(e,t){const{rawDisplayName:n,userId:r}=e;if(!n||n===r)return r;const i=Bb(n);return t?i+" ("+r+")":wP(n)?i:r}const PHe=3e3,LHe=3,bI=4e3;class T_{constructor(e,t,n,r,i,o,s,a){this.id=e,this.scope=new Eee,this.participant$=new ns(n),null!=n&&n.isLocal?this.vm=new kp(this.id,t,this.participant$.asObservable(),r,i,o,s,a):this.vm=new KUe(e,t,this.participant$.asObservable(),r,i,o,s,a),this.speaker$=kHe(this.vm.speaking$).pipe(this.scope.state()),this.presenter$=this.participant$.pipe(Pt((e=>(e&&x4(e,oe.TrackPublished,oe.TrackUnpublished,oe.LocalTrackPublished,oe.LocalTrackUnpublished).pipe(Ne((e=>e.isScreenShareEnabled))))??Rt(!1))),this.scope.state())}updateParticipant(e){this.participant$.value!==e&&this.participant$.next(e)}destroy(){this.scope.end(),this.vm.destroy()}}class aF{constructor(e,t,n,r,i,o){this.participant$=new ns(n),this.vm=new kh(e,t,this.participant$.asObservable(),r,i,o,n.isLocal)}destroy(){this.vm.destroy()}}function lF(e,t){let n=e.sender+":"+e.deviceId;if(!e.sender)return{id:n,member:void 0};e.sender===t.client.getUserId()&&e.deviceId===t.client.getDeviceId()&&(n="local");return{id:n,member:t.getMember(e.sender)??void 0}}class OHe extends Gw{constructor(e,t,n,r,i,o){super(),this.matrixRTCSession=e,this.livekitRoom=t,this.encryptionSystem=n,this.connectionState$=r,this.handsRaisedSubject$=i,this.reactionsSubject$=o,this.localVideo$=lE(Rt(this.livekitRoom.localParticipant),ue.Source.Camera).pipe(Ne((e=>{var t;const n=null==(t=null==e?void 0:e.publication)?void 0:t.track;return n instanceof Dv?n:null}))),this.rawRemoteParticipants$=z8e(this.livekitRoom).pipe(this.scope.state()),this.remoteParticipantHolds$=this.connectionState$.pipe(J5e(this.rawRemoteParticipants$),zy((([e,t])=>e===EP.ECSwitchingFocus?nE(Rt({hold:t}),C5e([Kc(PHe),this.connectionState$.pipe(Fo((e=>e!==EP.ECSwitchingFocus)),eP(1))]).pipe(Ne((()=>({unhold:t}))))):tE)),fP([],((e,t)=>"hold"in t?[t.hold,...e]:e.filter((e=>e!==t.unhold))))),this.remoteParticipants$=$n([this.rawRemoteParticipants$,this.remoteParticipantHolds$],((e,t)=>{const n=[...e],r=new Set(n.map((e=>e.identity)));for(const e of t)for(const t of e)r.has(t.identity)||(n.push(t),r.add(t.identity));return n})),this.memberDisplaynames$=sy(Sa(this.matrixRTCSession,ar.MembershipsChanged),Sa(this.matrixRTCSession.room,ut.Members)).pipe(un(null),Ne((()=>{const e=new Map,{room:t,memberships:n}=this.matrixRTCSession;for(const r of n){const i=`${r.sender}:${r.deviceId}`,{member:o}=lF(r,t);if(!o){A.error("Could not find member for media id:",i);continue}const s=xHe(o,n,t);e.set(i,mte(o,s))}return e})),this.scope.state()),this.mediaItems$=$n([this.remoteParticipants$,P4(this.livekitRoom.localParticipant),KZ.value$,Sa(this.matrixRTCSession,ar.MembershipsChanged).pipe(un(null)),GZ.value$]).pipe(nl(((e,[t,{participant:n},r,i,o])=>{const s=new Map(function*(){const i=this.matrixRTCSession.room;for(const o of this.matrixRTCSession.memberships){const{member:s,id:a}=lF(o,i),l=`${o.sender}:${o.deviceId}`;let c;c="local"===a?n:t.find((e=>e.identity===a)),s||A.error("Could not find member for media id: ",a);for(let t=0;t<1+r;t++){const n=`${a}:${t}`;let r=e.get(n);if(r&&r instanceof T_&&(r.updateParticipant(c),void 0===r.vm.member&&(r=void 0)),yield[n,r??new T_(n,s,c,this.encryptionSystem,this.livekitRoom,this.memberDisplaynames$.pipe(Ne((e=>e.get(l)??"[👻]"))),this.handsRaised$.pipe(Ne((e=>{var t;return(null==(t=e[l])?void 0:t.time)??null}))),this.reactions$.pipe(Ne((e=>e[l]??void 0))))],null!=c&&c.isScreenShareEnabled){const t=`${n}:screen-share`;yield[t,e.get(t)??new aF(t,s,c,this.encryptionSystem,this.livekitRoom,this.memberDisplaynames$.pipe(Ne((e=>e.get(l)??"[👻]"))))]}}}}.bind(this)()),a=o?new Map(function*(){for(const n of t)for(let t=0;t<1+r;t++){const r=n.identity+":"+t;if(!s.has(r)){const t=r;yield[t,e.get(t)??new T_(t,void 0,n,this.encryptionSystem,this.livekitRoom,this.memberDisplaynames$.pipe(Ne((e=>e.get(n.identity)??"[👻]"))),Rt(null),Rt(null))]}}}.bind(this)()):new Map;a.size>0&&A.debug("Added NonMember items: ",a);const l=new Map([...a.entries(),...s.entries()]);for(const[t,n]of e)l.has(t)||n.destroy();return l}),new Map),Ne((e=>[...e.values()])),qUe((e=>{for(const t of e)t.destroy()})),this.scope.state()),this.userMedia$=this.mediaItems$.pipe(Ne((e=>e.filter((e=>e instanceof T_))))),this.memberChanges$=this.userMedia$.pipe(Ne((e=>e.map((e=>e.id))))).pipe(nl(((e,t)=>{const n=e.ids.filter((e=>!t.includes(e))),r=t.filter((t=>!e.ids.includes(t)));return{ids:t,joined:r,left:n}}),{ids:[],joined:[],left:[]})),this.screenShares$=this.mediaItems$.pipe(Ne((e=>e.filter((e=>e instanceof aF)))),this.scope.state()),this.spotlightSpeaker$=this.userMedia$.pipe(Pt((e=>0===e.length?Rt([]):$n(e.map((e=>e.vm.speaking$.pipe(Ne((t=>[e,t])))))))),nl(((e,t)=>{var n,r,i;const[o,s]=!(null!=e&&e.vm.local)&&t.find((([t])=>t===e))||[];return s?o:(null==(n=t.find((([e,t])=>!e.vm.local&&t)))?void 0:n[0])??o??(null==(r=t.find((([e])=>!e.vm.local)))?void 0:r[0])??(null==(i=t.find((([e])=>e.vm.local)))?void 0:i[0])}),null),Ne((e=>(null==e?void 0:e.vm)??null)),this.scope.state()),this.grid$=this.userMedia$.pipe(Pt((e=>{const t=e.map((e=>$n([e.speaker$,e.presenter$,e.vm.videoEnabled$,e.vm.handRaised$,e.vm instanceof kp?e.vm.alwaysShow$:Rt(!1)],((t,n,r,i,o)=>{let s;return s=e.vm.local?o?0:6:n?1:t?2:i?3:r?4:5,[e,s]}))));return 0===t.length?Rt([]):$n(t,((...e)=>e.sort((([,e],[,t])=>e-t)).map((([e])=>e.vm))))})),va(oF),this.scope.state()),this.spotlight$=this.screenShares$.pipe(Pt((e=>e.length>0?Rt(e.map((e=>e.vm))):this.spotlightSpeaker$.pipe(Ne((e=>e?[e]:[]))))),va(oF),this.scope.state()),this.pip$=$n([this.screenShares$,this.spotlightSpeaker$,this.mediaItems$]).pipe(Pt((([e,t,n])=>{if(e.length>0)return this.spotlightSpeaker$;if(!t||t.local)return Rt(null);const r=n.find((e=>e.vm instanceof kp)),i=null==r?void 0:r.vm;return i?i.alwaysShow$.pipe(Ne((e=>e?i:null))):Rt(null)})),this.scope.state()),this.hasRemoteScreenShares$=this.spotlight$.pipe(Ne((e=>e.some((e=>!e.local&&e instanceof kh)))),va()),this.pipEnabled$=vh.pipe(un(!1)),this.naturalWindowMode$=Sa(window,"resize").pipe(un(null),Ne((()=>{const e=window.innerHeight,t=window.innerWidth;return e<=400&&t<=340?"pip":e<=600?"flat":t<=600?"narrow":"normal"})),this.scope.state()),this.windowMode$=this.pipEnabled$.pipe(Pt((e=>e?Rt("pip"):this.naturalWindowMode$))),this.spotlightExpandedToggle$=new Or,this.spotlightExpanded$=this.spotlightExpandedToggle$.pipe(fP(!1,(e=>!e)),this.scope.state()),this.gridModeUserSelection$=new Or,this.gridMode$=this.gridModeUserSelection$.pipe(un(null),Pt((e=>("spotlight"===e?tE:$n([this.hasRemoteScreenShares$,this.windowMode$]).pipe(q5e(null===e?0:1),Ne((([e,t])=>e||"flat"===t?"spotlight":"grid")))).pipe(un(e??"grid")))),this.scope.state()),this.gridLayoutMedia$=$n([this.grid$,this.spotlight$],((e,t)=>({type:"grid",spotlight:t.some((e=>e instanceof kh))?t:void 0,grid:e}))),this.spotlightLandscapeLayoutMedia$=$n([this.grid$,this.spotlight$],((e,t)=>({type:"spotlight-landscape",spotlight:t,grid:e}))),this.spotlightPortraitLayoutMedia$=$n([this.grid$,this.spotlight$],((e,t)=>({type:"spotlight-portrait",spotlight:t,grid:e}))),this.spotlightExpandedLayoutMedia$=$n([this.spotlight$,this.pip$],((e,t)=>({type:"spotlight-expanded",spotlight:e,pip:t??void 0}))),this.oneOnOneLayoutMedia$=this.mediaItems$.pipe(Ne((e=>{var t,n;if(2!==e.length)return null;const r=null==(t=e.find((e=>e.vm.local)))?void 0:t.vm,i=null==(n=e.find((e=>!e.vm.local)))?void 0:n.vm;return i&&r?{type:"one-on-one",local:r,remote:i}:null}))),this.pipLayoutMedia$=this.spotlight$.pipe(Ne((e=>({type:"pip",spotlight:e})))),this.layoutMedia$=this.windowMode$.pipe(Pt((e=>{switch(e){case"normal":return this.gridMode$.pipe(Pt((e=>{switch(e){case"grid":return this.oneOnOneLayoutMedia$.pipe(Pt((e=>null===e?this.gridLayoutMedia$:Rt(e))));case"spotlight":return this.spotlightExpanded$.pipe(Pt((e=>e?this.spotlightExpandedLayoutMedia$:this.spotlightLandscapeLayoutMedia$)))}})));case"narrow":return this.oneOnOneLayoutMedia$.pipe(Pt((e=>null===e?$n([this.grid$,this.spotlight$],((e,t)=>e.length>3||t.some((e=>e instanceof kh))?this.spotlightPortraitLayoutMedia$:this.gridLayoutMedia$)).pipe(K5e()):this.spotlightExpandedLayoutMedia$)));case"flat":return this.gridMode$.pipe(Pt((e=>{switch(e){case"grid":return this.spotlightLandscapeLayoutMedia$;case"spotlight":return this.spotlightExpandedLayoutMedia$}})));case"pip":return this.pipLayoutMedia$}})),this.scope.state()),this.visibleTiles$=new Or,this.setVisibleTiles=e=>this.visibleTiles$.next(e),this.layoutInternals$=$n([this.layoutMedia$,this.visibleTiles$.pipe(un(0),va())]).pipe(nl((({tiles:e},[t,n])=>{let r,i;switch(t.type){case"grid":case"spotlight-landscape":case"spotlight-portrait":[r,i]=CHe(t,n,this.setVisibleTiles,e);break;case"spotlight-expanded":[r,i]=THe(t,e);break;case"one-on-one":[r,i]=RHe(t,e);break;case"pip":[r,i]=IHe(t,e)}return{layout:r,tiles:i}}),{layout:null,tiles:yE.empty()}),this.scope.state()),this.layout$=this.layoutInternals$.pipe(Ne((({layout:e})=>e)),this.scope.state()),this.tileStoreGeneration$=this.layoutInternals$.pipe(Ne((({tiles:e})=>e.generation)),this.scope.state()),this.showSpotlightIndicators$=this.layout$.pipe(Ne((e=>"grid"!==e.type)),this.scope.state()),this.showSpeakingIndicators$=this.layout$.pipe(Pt((e=>{switch(e.type){case"spotlight-landscape":case"spotlight-portrait":return e.spotlight.media$.pipe(Ne((e=>e.some((e=>e instanceof kh)))));case"spotlight-expanded":case"one-on-one":return Rt(!1);default:return Rt(!0)}})),this.scope.state()),this.toggleSpotlightExpanded$=this.windowMode$.pipe(Pt((e=>"normal"===e?this.layout$.pipe(Ne((e=>"spotlight-landscape"===e.type||"spotlight-expanded"===e.type))):Rt(!1))),va(),Ne((e=>e?()=>this.spotlightExpandedToggle$.next():null)),this.scope.state()),this.screenTap$=new Or,this.controlsTap$=new Or,this.screenHover$=new Or,this.screenUnhover$=new Or,this.showHeader$=this.windowMode$.pipe(Ne((e=>"pip"!==e&&"flat"!==e)),this.scope.state()),this.showFooter$=this.windowMode$.pipe(Pt((e=>{switch(e){case"pip":return Rt(!1);case"normal":case"narrow":return Rt(!0);case"flat":return gUe()?Rt(!0):sy(this.screenTap$.pipe(Ne((()=>"tap screen"))),this.controlsTap$.pipe(Ne((()=>"tap controls"))),this.screenHover$.pipe(Ne((()=>"hover")))).pipe(G5e(((e,t)=>{switch(t){case"tap screen":return e?Rt(!1):Kc(bI).pipe(Ne((()=>!1)),un(!0));case"tap controls":return Kc(bI).pipe(Ne((()=>!1)),un(!0));case"hover":return M5e(Kc(bI),this.screenUnhover$.pipe(eP(1))).pipe(Ne((()=>!1)),un(!0))}}),!1),un(!1))}})),this.scope.state()),this.reactions$=this.reactionsSubject$.pipe(Ne((e=>Object.fromEntries(Object.entries(e).map((([e,{reactionOption:t}])=>[e,t])))))),this.handsRaised$=this.handsRaisedSubject$.pipe(),this.visibleReactions$=zZ.value$.pipe(Pt((e=>e?this.reactions$:Rt({}))),nl(((e,t)=>{var n;const r=[];for(const[i,o]of Object.entries(t)){const t=(null==(n=e.find((e=>e.sender===i&&e.emoji)))?void 0:n.startX)??Math.ceil(80*Math.random())+10;r.push({sender:i,emoji:o.emoji,startX:t})}return r}),[])),this.audibleReactions$=w4.value$.pipe(Pt((e=>e?this.reactions$:Rt({}))),Ne((e=>Object.values(e).map((e=>e.name)))),nl(((e,t)=>({playing:t.filter((t=>e.playing.includes(t)||e.newSounds.includes(t))),newSounds:t.filter((t=>!e.playing.includes(t)&&!e.newSounds.includes(t)))})),{playing:[],newSounds:[]}),Ne((e=>e.newSounds))),this.newHandRaised$=this.handsRaised$.pipe(Ne((e=>Object.keys(e).length)),nl(((e,t)=>({value:t,playSounds:t>e.value})),{value:0,playSounds:!1}),Fo((e=>e.playSounds))),this.newScreenShare$=this.screenShares$.pipe(Ne((e=>e.length)),nl(((e,t)=>({value:t,playSounds:t>e.value})),{value:0,playSounds:!1}),Fo((e=>e.playSounds)))}setGridMode(e){this.gridModeUserSelection$.next(e)}tapScreen(){this.screenTap$.next()}tapControls(){this.controlsTap$.next()}hoverScreen(){this.screenHover$.next()}unhoverScreen(){this.screenUnhover$.next()}}function MHe(e,t,n){return Math.max(t,Math.min(e,n))}const Dr={toVector:(e,t)=>(void 0===e&&(e=t),Array.isArray(e)?e:[e,e]),add:(e,t)=>[e[0]+t[0],e[1]+t[1]],sub:(e,t)=>[e[0]-t[0],e[1]-t[1]],addTo(e,t){e[0]+=t[0],e[1]+=t[1]},subTo(e,t){e[0]-=t[0],e[1]-=t[1]}};function cF(e,t,n){return 0===t||Math.abs(t)===1/0?Math.pow(e,5*n):e*t*n/(t+n*e)}function uF(e,t,n,r=.15){return 0===r?MHe(e,t,n):e<t?-cF(t-e,n-t,r)+t:e>n?+cF(e-n,n-t,r)+n:e}function AHe(e,[t,n],[r,i]){const[[o,s],[a,l]]=e;return[uF(t,o,s,r),uF(n,a,l,i)]}function NHe(e,t){if("object"!=typeof e||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t);if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}function DHe(e){var t=NHe(e,"string");return"symbol"==typeof t?t:String(t)}function vi(e,t,n){return(t=DHe(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function dF(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function An(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?dF(Object(n),!0).forEach((function(t){vi(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):dF(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}const gte={pointer:{start:"down",change:"move",end:"up"},mouse:{start:"down",change:"move",end:"up"},touch:{start:"start",change:"move",end:"end"},gesture:{start:"start",change:"change",end:"end"}};function fF(e){return e?e[0].toUpperCase()+e.slice(1):""}const jHe=["enter","leave"];function UHe(e=!1,t){return e&&!jHe.includes(t)}function FHe(e,t="",n=!1){const r=gte[e],i=r&&r[t]||t;return"on"+fF(e)+fF(i)+(UHe(n,i)?"Capture":"")}const $He=["gotpointercapture","lostpointercapture"];function HHe(e){let t=e.substring(2).toLowerCase();const n=!!~t.indexOf("passive");n&&(t=t.replace("passive",""));const r=$He.includes(t)?"capturecapture":"capture",i=!!~t.indexOf(r);return i&&(t=t.replace("capture","")),{device:t,capture:i,passive:n}}function BHe(e,t=""){const n=gte[e];return e+(n&&n[t]||t)}function nC(e){return"touches"in e}function vte(e){return nC(e)?"touch":"pointerType"in e?e.pointerType:"mouse"}function VHe(e){return Array.from(e.touches).filter((t=>{var n,r;return t.target===e.currentTarget||(null===(n=e.currentTarget)||void 0===n||null===(r=n.contains)||void 0===r?void 0:r.call(n,t.target))}))}function qHe(e){return"touchend"===e.type||"touchcancel"===e.type?e.changedTouches:e.targetTouches}function yte(e){return nC(e)?qHe(e)[0]:e}function KHe(e){return VHe(e).map((e=>e.identifier))}function SI(e){const t=yte(e);return nC(e)?t.identifier:t.pointerId}function hF(e){const t=yte(e);return[t.clientX,t.clientY]}function GHe(e){var t,n;const{scrollX:r,scrollY:i,scrollLeft:o,scrollTop:s}=e.currentTarget;return[null!==(t=r??o)&&void 0!==t?t:0,null!==(n=i??s)&&void 0!==n?n:0]}function WHe(e){const t={};if("buttons"in e&&(t.buttons=e.buttons),"shiftKey"in e){const{shiftKey:n,altKey:r,metaKey:i,ctrlKey:o}=e;Object.assign(t,{shiftKey:n,altKey:r,metaKey:i,ctrlKey:o})}return t}function _E(e,...t){return"function"==typeof e?e(...t):e}function zHe(){}function YHe(...e){return 0===e.length?zHe:1===e.length?e[0]:function(){let t;for(const n of e)t=n.apply(this,arguments)||t;return t}}function pF(e,t){return Object.assign({},t,e||{})}const JHe=32;class XHe{constructor(e,t,n){this.ctrl=e,this.args=t,this.key=n,this.state||(this.state={},this.computeValues([0,0]),this.computeInitial(),this.init&&this.init(),this.reset())}get state(){return this.ctrl.state[this.key]}set state(e){this.ctrl.state[this.key]=e}get shared(){return this.ctrl.state.shared}get eventStore(){return this.ctrl.gestureEventStores[this.key]}get timeoutStore(){return this.ctrl.gestureTimeoutStores[this.key]}get config(){return this.ctrl.config[this.key]}get sharedConfig(){return this.ctrl.config.shared}get handler(){return this.ctrl.handlers[this.key]}reset(){const{state:e,shared:t,ingKey:n,args:r}=this;t[n]=e._active=e.active=e._blocked=e._force=!1,e._step=[!1,!1],e.intentional=!1,e._movement=[0,0],e._distance=[0,0],e._direction=[0,0],e._delta=[0,0],e._bounds=[[-1/0,1/0],[-1/0,1/0]],e.args=r,e.axis=void 0,e.memo=void 0,e.elapsedTime=e.timeDelta=0,e.direction=[0,0],e.distance=[0,0],e.overflow=[0,0],e._movementBound=[!1,!1],e.velocity=[0,0],e.movement=[0,0],e.delta=[0,0],e.timeStamp=0}start(e){const t=this.state,n=this.config;t._active||(this.reset(),this.computeInitial(),t._active=!0,t.target=e.target,t.currentTarget=e.currentTarget,t.lastOffset=n.from?_E(n.from,t):t.offset,t.offset=t.lastOffset,t.startTime=t.timeStamp=e.timeStamp)}computeValues(e){const t=this.state;t._values=e,t.values=this.config.transform(e)}computeInitial(){const e=this.state;e._initial=e._values,e.initial=e.values}compute(e){const{state:t,config:n,shared:r}=this;t.args=this.args;let i=0;if(e&&(t.event=e,n.preventDefault&&e.cancelable&&t.event.preventDefault(),t.type=e.type,r.touches=this.ctrl.pointerIds.size||this.ctrl.touchIds.size,r.locked=!!document.pointerLockElement,Object.assign(r,WHe(e)),r.down=r.pressed=r.buttons%2==1||r.touches>0,i=e.timeStamp-t.timeStamp,t.timeStamp=e.timeStamp,t.elapsedTime=t.timeStamp-t.startTime),t._active){const e=t._delta.map(Math.abs);Dr.addTo(t._distance,e)}this.axisIntent&&this.axisIntent(e);const[o,s]=t._movement,[a,l]=n.threshold,{_step:c,values:u}=t;if(n.hasCustomTransform?(!1===c[0]&&(c[0]=Math.abs(o)>=a&&u[0]),!1===c[1]&&(c[1]=Math.abs(s)>=l&&u[1])):(!1===c[0]&&(c[0]=Math.abs(o)>=a&&Math.sign(o)*a),!1===c[1]&&(c[1]=Math.abs(s)>=l&&Math.sign(s)*l)),t.intentional=!1!==c[0]||!1!==c[1],!t.intentional)return;const d=[0,0];if(n.hasCustomTransform){const[e,t]=u;d[0]=!1!==c[0]?e-c[0]:0,d[1]=!1!==c[1]?t-c[1]:0}else d[0]=!1!==c[0]?o-c[0]:0,d[1]=!1!==c[1]?s-c[1]:0;this.restrictToAxis&&!t._blocked&&this.restrictToAxis(d);const h=t.offset,p=t._active&&!t._blocked||t.active;p&&(t.first=t._active&&!t.active,t.last=!t._active&&t.active,t.active=r[this.ingKey]=t._active,e&&(t.first&&("bounds"in n&&(t._bounds=_E(n.bounds,t)),this.setup&&this.setup()),t.movement=d,this.computeOffset()));const[f,m]=t.offset,[[v,g],[y,b]]=t._bounds;t.overflow=[f<v?-1:f>g?1:0,m<y?-1:m>b?1:0],t._movementBound[0]=!!t.overflow[0]&&(!1===t._movementBound[0]?t._movement[0]:t._movementBound[0]),t._movementBound[1]=!!t.overflow[1]&&(!1===t._movementBound[1]?t._movement[1]:t._movementBound[1]);const _=t._active&&n.rubberband||[0,0];if(t.offset=AHe(t._bounds,t.offset,_),t.delta=Dr.sub(t.offset,h),this.computeMovement(),p&&(!t.last||i>32)){t.delta=Dr.sub(t.offset,h);const e=t.delta.map(Math.abs);Dr.addTo(t.distance,e),t.direction=t.delta.map(Math.sign),t._direction=t._delta.map(Math.sign),!t.first&&i>0&&(t.velocity=[e[0]/i,e[1]/i],t.timeDelta=i)}}emit(){const e=this.state,t=this.shared,n=this.config;if(e._active||this.clean(),(e._blocked||!e.intentional)&&!e._force&&!n.triggerAllEvents)return;const r=this.handler(An(An(An({},t),e),{},{[this.aliasKey]:e.values}));void 0!==r&&(e.memo=r)}clean(){this.eventStore.clean(),this.timeoutStore.clean()}}function ZHe([e,t],n){const r=Math.abs(e),i=Math.abs(t);return r>i&&r>n?"x":i>r&&i>n?"y":void 0}class _te extends XHe{constructor(...e){super(...e),vi(this,"aliasKey","xy")}reset(){super.reset(),this.state.axis=void 0}init(){this.state.offset=[0,0],this.state.lastOffset=[0,0]}computeOffset(){this.state.offset=Dr.add(this.state.lastOffset,this.state.movement)}computeMovement(){this.state.movement=Dr.sub(this.state.offset,this.state.lastOffset)}axisIntent(e){const t=this.state,n=this.config;if(!t.axis&&e){const r="object"==typeof n.axisThreshold?n.axisThreshold[vte(e)]:n.axisThreshold;t.axis=ZHe(t._movement,r)}t._blocked=(n.lockDirection||!!n.axis)&&!t.axis||!!n.axis&&n.axis!==t.axis}restrictToAxis(e){if(this.config.axis||this.config.lockDirection)switch(this.state.axis){case"x":e[1]=0;break;case"y":e[0]=0}}}const QHe=e=>e,mF=.15,bte={enabled:(e=!0)=>e,eventOptions:(e,t,n)=>An(An({},n.shared.eventOptions),e),preventDefault:(e=!1)=>e,triggerAllEvents:(e=!1)=>e,rubberband(e=0){switch(e){case!0:return[mF,mF];case!1:return[0,0];default:return Dr.toVector(e)}},from:e=>"function"==typeof e?e:null!=e?Dr.toVector(e):void 0,transform(e,t,n){const r=e||n.shared.transform;return this.hasCustomTransform=!!r,r||QHe},threshold:e=>Dr.toVector(e,0)},eBe=0,sm=An(An({},bte),{},{axis(e,t,{axis:n}){if(this.lockDirection="lock"===n,!this.lockDirection)return n},axisThreshold:(e=0)=>e,bounds(e={}){if("function"==typeof e)return t=>sm.bounds(e(t));if("current"in e)return()=>e.current;if("function"==typeof HTMLElement&&e instanceof HTMLElement)return e;const{left:t=-1/0,right:n=1/0,top:r=-1/0,bottom:i=1/0}=e;return[[t,n],[r,i]]}}),gF={ArrowRight:(e,t=1)=>[e*t,0],ArrowLeft:(e,t=1)=>[-1*e*t,0],ArrowUp:(e,t=1)=>[0,-1*e*t],ArrowDown:(e,t=1)=>[0,e*t]};class tBe extends _te{constructor(...e){super(...e),vi(this,"ingKey","dragging")}reset(){super.reset();const e=this.state;e._pointerId=void 0,e._pointerActive=!1,e._keyboardActive=!1,e._preventScroll=!1,e._delayed=!1,e.swipe=[0,0],e.tap=!1,e.canceled=!1,e.cancel=this.cancel.bind(this)}setup(){const e=this.state;if(e._bounds instanceof HTMLElement){const t=e._bounds.getBoundingClientRect(),n=e.currentTarget.getBoundingClientRect(),r={left:t.left-n.left+e.offset[0],right:t.right-n.right+e.offset[0],top:t.top-n.top+e.offset[1],bottom:t.bottom-n.bottom+e.offset[1]};e._bounds=sm.bounds(r)}}cancel(){const e=this.state;e.canceled||(e.canceled=!0,e._active=!1,setTimeout((()=>{this.compute(),this.emit()}),0))}setActive(){this.state._active=this.state._pointerActive||this.state._keyboardActive}clean(){this.pointerClean(),this.state._pointerActive=!1,this.state._keyboardActive=!1,super.clean()}pointerDown(e){const t=this.config,n=this.state;if(null!=e.buttons&&(Array.isArray(t.pointerButtons)?!t.pointerButtons.includes(e.buttons):-1!==t.pointerButtons&&t.pointerButtons!==e.buttons))return;const r=this.ctrl.setEventIds(e);t.pointerCapture&&e.target.setPointerCapture(e.pointerId),!(r&&r.size>1&&n._pointerActive)&&(this.start(e),this.setupPointer(e),n._pointerId=SI(e),n._pointerActive=!0,this.computeValues(hF(e)),this.computeInitial(),t.preventScrollAxis&&"mouse"!==vte(e)?(n._active=!1,this.setupScrollPrevention(e)):t.delay>0?(this.setupDelayTrigger(e),t.triggerAllEvents&&(this.compute(e),this.emit())):this.startPointerDrag(e))}startPointerDrag(e){const t=this.state;t._active=!0,t._preventScroll=!0,t._delayed=!1,this.compute(e),this.emit()}pointerMove(e){const t=this.state,n=this.config;if(!t._pointerActive)return;const r=SI(e);if(void 0!==t._pointerId&&r!==t._pointerId)return;const i=hF(e);return document.pointerLockElement===e.target?t._delta=[e.movementX,e.movementY]:(t._delta=Dr.sub(i,t._values),this.computeValues(i)),Dr.addTo(t._movement,t._delta),this.compute(e),t._delayed&&t.intentional?(this.timeoutStore.remove("dragDelay"),t.active=!1,void this.startPointerDrag(e)):n.preventScrollAxis&&!t._preventScroll?t.axis?t.axis===n.preventScrollAxis||"xy"===n.preventScrollAxis?(t._active=!1,void this.clean()):(this.timeoutStore.remove("startPointerDrag"),void this.startPointerDrag(e)):void 0:void this.emit()}pointerUp(e){this.ctrl.setEventIds(e);try{this.config.pointerCapture&&e.target.hasPointerCapture(e.pointerId)&&e.target.releasePointerCapture(e.pointerId)}catch{}const t=this.state,n=this.config;if(!t._active||!t._pointerActive)return;const r=SI(e);if(void 0!==t._pointerId&&r!==t._pointerId)return;this.state._pointerActive=!1,this.setActive(),this.compute(e);const[i,o]=t._distance;if(t.tap=i<=n.tapsThreshold&&o<=n.tapsThreshold,t.tap&&n.filterTaps)t._force=!0;else{const[e,r]=t._delta,[i,o]=t._movement,[s,a]=n.swipe.velocity,[l,c]=n.swipe.distance,u=n.swipe.duration;if(t.elapsedTime<u){const n=Math.abs(e/t.timeDelta),u=Math.abs(r/t.timeDelta);n>s&&Math.abs(i)>l&&(t.swipe[0]=Math.sign(e)),u>a&&Math.abs(o)>c&&(t.swipe[1]=Math.sign(r))}}this.emit()}pointerClick(e){!this.state.tap&&e.detail>0&&(e.preventDefault(),e.stopPropagation())}setupPointer(e){const t=this.config,n=t.device;t.pointerLock&&e.currentTarget.requestPointerLock(),t.pointerCapture||(this.eventStore.add(this.sharedConfig.window,n,"change",this.pointerMove.bind(this)),this.eventStore.add(this.sharedConfig.window,n,"end",this.pointerUp.bind(this)),this.eventStore.add(this.sharedConfig.window,n,"cancel",this.pointerUp.bind(this)))}pointerClean(){this.config.pointerLock&&document.pointerLockElement===this.state.currentTarget&&document.exitPointerLock()}preventScroll(e){this.state._preventScroll&&e.cancelable&&e.preventDefault()}setupScrollPrevention(e){this.state._preventScroll=!1,nBe(e);const t=this.eventStore.add(this.sharedConfig.window,"touch","change",this.preventScroll.bind(this),{passive:!1});this.eventStore.add(this.sharedConfig.window,"touch","end",t),this.eventStore.add(this.sharedConfig.window,"touch","cancel",t),this.timeoutStore.add("startPointerDrag",this.startPointerDrag.bind(this),this.config.preventScrollDelay,e)}setupDelayTrigger(e){this.state._delayed=!0,this.timeoutStore.add("dragDelay",(()=>{this.state._step=[0,0],this.startPointerDrag(e)}),this.config.delay)}keyDown(e){const t=gF[e.key];if(t){const n=this.state,r=e.shiftKey?10:e.altKey?.1:1;this.start(e),n._delta=t(this.config.keyboardDisplacement,r),n._keyboardActive=!0,Dr.addTo(n._movement,n._delta),this.compute(e),this.emit()}}keyUp(e){e.key in gF&&(this.state._keyboardActive=!1,this.setActive(),this.compute(e),this.emit())}bind(e){const t=this.config.device;e(t,"start",this.pointerDown.bind(this)),this.config.pointerCapture&&(e(t,"change",this.pointerMove.bind(this)),e(t,"end",this.pointerUp.bind(this)),e(t,"cancel",this.pointerUp.bind(this)),e("lostPointerCapture","",this.pointerUp.bind(this))),this.config.keys&&(e("key","down",this.keyDown.bind(this)),e("key","up",this.keyUp.bind(this))),this.config.filterTaps&&e("click","",this.pointerClick.bind(this),{capture:!0,passive:!1})}}function nBe(e){"persist"in e&&"function"==typeof e.persist&&e.persist()}const a0=typeof window<"u"&&window.document&&window.document.createElement;function Ste(){return a0&&"ontouchstart"in window}function rBe(){return Ste()||a0&&window.navigator.maxTouchPoints>1}function iBe(){return a0&&"onpointerdown"in window}function sBe(){return a0&&"exitPointerLock"in window.document}function oBe(){try{return"constructor"in GestureEvent}catch{return!1}}const Fs={isBrowser:a0,gesture:oBe(),touch:Ste(),touchscreen:rBe(),pointer:iBe(),pointerLock:sBe()},aBe=250,lBe=180,cBe=.5,uBe=50,dBe=250,fBe=10,vF={mouse:0,touch:0,pen:8},hBe=An(An({},sm),{},{device(e,t,{pointer:{touch:n=!1,lock:r=!1,mouse:i=!1}={}}){return this.pointerLock=r&&Fs.pointerLock,Fs.touch&&n?"touch":this.pointerLock?"mouse":Fs.pointer&&!i?"pointer":Fs.touch?"touch":"mouse"},preventScrollAxis(e,t,{preventScroll:n}){if(this.preventScrollDelay="number"==typeof n?n:n||void 0===n&&e?250:void 0,Fs.touchscreen&&!1!==n)return e||(void 0!==n?"y":void 0)},pointerCapture(e,t,{pointer:{capture:n=!0,buttons:r=1,keys:i=!0}={}}){return this.pointerButtons=r,this.keys=i,!this.pointerLock&&"pointer"===this.device&&n},threshold(e,t,{filterTaps:n=!1,tapsThreshold:r=3,axis:i}){const o=Dr.toVector(e,n?r:i?1:0);return this.filterTaps=n,this.tapsThreshold=r,o},swipe({velocity:e=.5,distance:t=50,duration:n=250}={}){return{velocity:this.transform(Dr.toVector(e)),distance:this.transform(Dr.toVector(t)),duration:n}},delay(e=0){switch(e){case!0:return 180;case!1:return 0;default:return e}},axisThreshold:e=>e?An(An({},vF),e):vF,keyboardDisplacement:(e=10)=>e});An(An({},bte),{},{device(e,t,{shared:n,pointer:{touch:r=!1}={}}){if(n.target&&!Fs.touch&&Fs.gesture)return"gesture";if(Fs.touch&&r)return"touch";if(Fs.touchscreen){if(Fs.pointer)return"pointer";if(Fs.touch)return"touch"}},bounds(e,t,{scaleBounds:n={},angleBounds:r={}}){const i=e=>{const t=pF(_E(n,e),{min:-1/0,max:1/0});return[t.min,t.max]},o=e=>{const t=pF(_E(r,e),{min:-1/0,max:1/0});return[t.min,t.max]};return"function"!=typeof n&&"function"!=typeof r?[i(),o()]:e=>[i(e),o(e)]},threshold(e,t,n){return this.lockDirection="lock"===n.axis,Dr.toVector(e,this.lockDirection?[.1,3]:0)},modifierKey:e=>void 0===e?"ctrlKey":e,pinchOnWheel:(e=!0)=>e}),An(An({},sm),{},{mouseOnly:(e=!0)=>e});class pBe extends _te{constructor(...e){super(...e),vi(this,"ingKey","scrolling")}scroll(e){this.state._active||this.start(e),this.scrollChange(e),this.timeoutStore.add("scrollEnd",this.scrollEnd.bind(this))}scrollChange(e){e.cancelable&&e.preventDefault();const t=this.state,n=GHe(e);t._delta=Dr.sub(n,t._values),Dr.addTo(t._movement,t._delta),this.computeValues(n),this.compute(e),this.emit()}scrollEnd(){this.state._active&&(this.state._active=!1,this.compute(),this.emit())}bind(e){e("scroll","",this.scroll.bind(this))}}const mBe=sm;An(An({},sm),{},{mouseOnly:(e=!0)=>e});const Ete=new Map,CP=new Map;function wte(e){Ete.set(e.key,e.engine),CP.set(e.key,e.resolver)}const gBe={key:"drag",engine:tBe,resolver:hBe},vBe={key:"scroll",engine:pBe,resolver:mBe};function yBe(e,t){if(null==e)return{};var n,r,i={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],!(t.indexOf(n)>=0)&&(i[n]=e[n]);return i}function _Be(e,t){if(null==e)return{};var n,r,i=yBe(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}const bBe={target(e){if(e)return()=>"current"in e?e.current:e},enabled:(e=!0)=>e,window:(e=(Fs.isBrowser?window:void 0))=>e,eventOptions:({passive:e=!0,capture:t=!1}={})=>({passive:e,capture:t}),transform:e=>e},SBe=["target","eventOptions","window","enabled","transform"];function Fb(e={},t){const n={};for(const[r,i]of Object.entries(t))switch(typeof i){case"function":n[r]=i.call(n,e[r],r,e);break;case"object":n[r]=Fb(e[r],i);break;case"boolean":i&&(n[r]=e[r])}return n}function EBe(e,t,n={}){const r=e,{target:i,eventOptions:o,window:s,enabled:a,transform:l}=r,c=_Be(r,SBe);if(n.shared=Fb({target:i,eventOptions:o,window:s,enabled:a,transform:l},bBe),t){const e=CP.get(t);n[t]=Fb(An({shared:n.shared},c),e)}else for(const e in c){const t=CP.get(e);t&&(n[e]=Fb(An({shared:n.shared},c[e]),t))}return n}class Cte{constructor(e,t){vi(this,"_listeners",new Set),this._ctrl=e,this._gestureKey=t}add(e,t,n,r,i){const o=this._listeners,s=BHe(t,n),a=An(An({},this._gestureKey?this._ctrl.config[this._gestureKey].eventOptions:{}),i);e.addEventListener(s,r,a);const l=()=>{e.removeEventListener(s,r,a),o.delete(l)};return o.add(l),l}clean(){this._listeners.forEach((e=>e())),this._listeners.clear()}}class wBe{constructor(){vi(this,"_timeouts",new Map)}add(e,t,n=140,...r){this.remove(e),this._timeouts.set(e,window.setTimeout(t,n,...r))}remove(e){const t=this._timeouts.get(e);t&&window.clearTimeout(t)}clean(){this._timeouts.forEach((e=>{window.clearTimeout(e)})),this._timeouts.clear()}}class CBe{constructor(e){vi(this,"gestures",new Set),vi(this,"_targetEventStore",new Cte(this)),vi(this,"gestureEventStores",{}),vi(this,"gestureTimeoutStores",{}),vi(this,"handlers",{}),vi(this,"config",{}),vi(this,"pointerIds",new Set),vi(this,"touchIds",new Set),vi(this,"state",{shared:{shiftKey:!1,metaKey:!1,ctrlKey:!1,altKey:!1}}),TBe(this,e)}setEventIds(e){return nC(e)?(this.touchIds=new Set(KHe(e)),this.touchIds):"pointerId"in e?("pointerup"===e.type||"pointercancel"===e.type?this.pointerIds.delete(e.pointerId):"pointerdown"===e.type&&this.pointerIds.add(e.pointerId),this.pointerIds):void 0}applyHandlers(e,t){this.handlers=e,this.nativeHandlers=t}applyConfig(e,t){this.config=EBe(e,t,this.config)}clean(){this._targetEventStore.clean();for(const e of this.gestures)this.gestureEventStores[e].clean(),this.gestureTimeoutStores[e].clean()}effect(){return this.config.shared.target&&this.bind(),()=>this._targetEventStore.clean()}bind(...e){const t=this.config.shared,n={};let r;if(!t.target||(r=t.target(),r)){if(t.enabled){for(const t of this.gestures){const i=this.config[t],o=yF(n,i.eventOptions,!!r);if(i.enabled){new(Ete.get(t))(this,e,t).bind(o)}}const i=yF(n,t.eventOptions,!!r);for(const t in this.nativeHandlers)i(t,"",(n=>this.nativeHandlers[t](An(An({},this.state.shared),{},{event:n,args:e}))),void 0,!0)}for(const e in n)n[e]=YHe(...n[e]);if(!r)return n;for(const e in n){const{device:t,capture:i,passive:o}=HHe(e);this._targetEventStore.add(r,t,"",n[e],{capture:i,passive:o})}}}}function ah(e,t){e.gestures.add(t),e.gestureEventStores[t]=new Cte(e,t),e.gestureTimeoutStores[t]=new wBe}function TBe(e,t){t.drag&&ah(e,"drag"),t.wheel&&ah(e,"wheel"),t.scroll&&ah(e,"scroll"),t.move&&ah(e,"move"),t.pinch&&ah(e,"pinch"),t.hover&&ah(e,"hover")}const yF=(e,t,n)=>(r,i,o,s={},a=!1)=>{var l,c;const u=null!==(l=s.capture)&&void 0!==l?l:t.capture,d=null!==(c=s.passive)&&void 0!==c?c:t.passive;let h=a?r:FHe(r,i,u);n&&d&&(h+="Passive"),e[h]=e[h]||[],e[h].push(o)};function Tte(e,t={},n,r){const i=we.useMemo((()=>new CBe(e)),[]);if(i.applyHandlers(e,r),i.applyConfig(t,n),we.useEffect(i.effect.bind(i)),we.useEffect((()=>i.clean.bind(i)),[]),void 0===t.target)return i.bind.bind(i)}function RBe(e,t){return wte(gBe),Tte({drag:e},t||{},"drag")}function IBe(e,t){return wte(vBe),Tte({scroll:e},t||{},"scroll")}const kBe="_grid_19qx5_8",xBe="_slot_19qx5_12",EI={grid:kBe,slot:xBe},PBe="_tile_lwkx2_8",LBe="_draggable_lwkx2_8",_F={tile:PBe,draggable:LBe},Rte=_.memo((({id:e,onDrag:t,targetWidth:n,targetHeight:r,model:i,Tile:o,opacity:s,scale:a,zIndex:l,x:c,y:u,width:d,height:h})=>{const p=_.useRef(null);return RBe((n=>null==t?void 0:t.current(e,n)),{target:p,filterTaps:!0,preventScroll:!0}),E.jsx(o,{ref:p,className:Ae(_F.tile,{[_F.draggable]:t}),style:{opacity:s,scale:a,zIndex:l,x:c,y:u,width:d,height:h},targetWidth:n,targetHeight:r,model:i})}));Rte.displayName="TileWrapper";const OBe=Rte,MBe=()=>ww("(prefers-reduced-motion)");function Ite(e,t){if(!(e.offsetParent instanceof HTMLElement)||e.offsetParent===t)return{x:e.offsetLeft,y:e.offsetTop};{const n=Ite(e.offsetParent,t);return n.x+=e.offsetLeft,n.y+=e.offsetTop,n}}const kte=_.createContext(null);function xte(){const e=_.useContext(kte);if(null===e)throw new Error("useUpdateLayout called outside a Grid layout context");return e}function xa(){const{setGeneration:e}=xte();_.useEffect((()=>e((e=>null===e?0:e+1))))}function sO(e){const{setVisibleTilesCallback:t}=xte();_.useEffect((()=>t((()=>e))),[e,t]),_.useEffect((()=>()=>t(null)),[t])}const ABe=Sa(window,"resize").pipe(un(null),Ne((()=>window.innerHeight)));function bF({model:e,Layout:t,Tile:n,className:r,style:i}){const[o,s]=pv(),[a,l]=_.useState(null),c=o0(o,l),u=tt(ABe),[d,h]=_.useState(null),[p,f]=_.useState(null),[m,v]=_.useState(null),g=Ip((()=>new Map)),y=MBe(),b=_.useMemo((()=>function({id:e,model:t,onDrag:n,style:r,className:i,...o}){const s=_.useRef(null);return _.useEffect((()=>(g.set(e,{id:e,model:t,onDrag:n}),()=>{g.delete(e)})),[e,t,n]),E.jsx("div",{ref:s,className:Ae(i,EI.slot),"data-id":e,style:r,...o})}),[g]),w=_.useMemo((()=>_.memo(_.forwardRef((function({Layout:e,...t},n){return E.jsx(e,{...t,ref:n})})))),[]),S=_.useMemo((()=>({setGeneration:f,setVisibleTilesCallback:v})),[v]),C=_.useMemo((()=>{const e=[];if(null!==a&&null!==d){const t=d.getElementsByClassName(EI.slot);for(const n of t){const t=n.getAttribute("data-id");n.offsetWidth>0&&n.offsetHeight>0&&e.push({...g.get(t),...Ite(n,a),width:n.offsetWidth,height:n.offsetHeight})}}return e}),[a,d,g,s,p]),k=_.useMemo((()=>Math.min(s.bottom,u)-s.top),[s,u]);_.useEffect((()=>{null==m||m(C.filter((e=>e.y+e.height<=k)).length)}),[C,m,k]);const T=_.useRef(null),[I,R]=e$e(C,(()=>({key:({id:e})=>e,from:({x:e,y:t,width:n,height:r})=>({opacity:0,scale:0,zIndex:1,x:e,y:t,width:n,height:r,immediate:y}),enter:{opacity:1,scale:1,immediate:y},update:({id:e,x:t,y:n,width:r,height:i})=>{var o;return e===(null==(o=T.current)?void 0:o.tileId)?null:{x:t,y:n,width:r,height:i,immediate:y}},leave:{opacity:0,scale:0,immediate:y},config:{mass:.7,tension:252,friction:25}})));_.useEffect((()=>{R.start().forEach((e=>{e.catch(A.error)}))}),[C,R]);const x=(e,t)=>{var n;const{tileId:r,tileX:i,tileY:o}=T.current,a=C.find((e=>e.id===r));null==(n=R.current.find((e=>e.item.id===r)))||n.start(e?{scale:1,zIndex:1,x:a.x,y:a.y,width:a.width,height:a.height,immediate:y||(e=>"zIndex"===e),delay:e=>"zIndex"===e?500:0}:{scale:1.1,zIndex:2,x:i,y:o,immediate:y||(e=>"zIndex"===e||"x"===e||"y"===e)}).catch(A.error),e&&t({x:i,y:o,xRatio:i/(s.width-a.width),yRatio:o/(s.height-a.height)})},L=(e,{tap:t,initial:[n,r],delta:[i,o],last:a})=>{if(!t){const t=R.current.find((t=>t.item.id===e)),l=g.get(t.item.id).onDrag;if(null!=l){if(null===T.current){const i=t.get();T.current={tileId:e,tileX:i.x,tileY:i.y,cursorX:n-s.x,cursorY:r-s.y+O.current}}T.current.tileX+=i,T.current.tileY+=o,T.current.cursorX+=i,T.current.cursorY+=o,x(a,l),a&&(T.current=null)}}},P=_.useRef(L);P.current=L;const O=_.useRef(0);return IBe((({xy:[,e],delta:[,t]})=>{O.current=e,null!==T.current&&(T.current.tileY+=t,T.current.cursorY+=t,x(!1,g.get(T.current.tileId).onDrag))}),{target:a??void 0}),E.jsxs("div",{ref:c,className:Ae(r,EI.grid),style:i,children:[E.jsx(kte.Provider,{value:S,children:E.jsx(w,{ref:h,Layout:t,model:e,Slot:b})}),I(((e,{id:t,model:r,onDrag:i,width:o,height:s})=>E.jsx(OBe,{id:t,onDrag:i?P:null,targetWidth:o,targetHeight:s,model:r,Tile:n,...e},t)))]})}const NBe="_contents_18jbt_8",DBe="_tile_18jbt_25",jBe="_maximised_18jbt_25",UBe="_item_18jbt_29",FBe="_snap_18jbt_36",$Be="_advance_18jbt_40",HBe="_back_18jbt_76",BBe="_next_18jbt_80",VBe="_expand_18jbt_84",qBe="_indicators_18jbt_128",KBe="_show_18jbt_140",hs={contents:NBe,tile:DBe,maximised:jBe,item:UBe,snap:FBe,advance:$Be,back:HBe,next:BBe,expand:VBe,indicators:qBe,show:KBe},Pte=(e,t)=>{const n=_.useRef(void 0);void 0===n.current&&(n.current=e());const r=_.useRef(void 0),[,i]=_.useState(0);return(void 0===r.current||t.length!==r.current.length||t.some(((e,t)=>!Object.is(e,r.current[t]))))&&(n.current=e(n.current)),r.current=t,[n.current,_.useCallback((e=>{n.current="function"==typeof e?e(n.current):e,i((e=>e+1))}),[i])]},Lte=_.forwardRef((({vm:e,...t},n)=>{const r=tt(e.mirror$);return E.jsx(s0,{ref:n,mirror:r,...t})}));Lte.displayName="SpotlightLocalUserMediaItem";const Ote=_.forwardRef((({vm:e,...t},n)=>{const r={ref:n,videoEnabled:tt(e.videoEnabled$),videoFit:tt(e.cropVideo$)?"cover":"contain",...t};return e instanceof kp?E.jsx(Lte,{vm:e,...r}):E.jsx(s0,{mirror:!1,...r})}));Ote.displayName="SpotlightUserMediaItem";const Mte=_.forwardRef((({vm:e,targetWidth:t,targetHeight:n,intersectionObserver$:r,snap:i,"aria-hidden":o},s)=>{const a=_.useRef(null),l=o0(a,s),c=tt(e.displayname$),u=tt(e.video$),d=tt(e.unencryptedWarning$),h=tt(e.encryptionStatus$);_.useEffect((()=>{const e=a.current;let t=null;const n=r.subscribe((n=>{null==t||t.unobserve(e),n.observe(e),t=n}));return()=>{n.unsubscribe(),null==t||t.unobserve(e)}}),[r]);const p={ref:l,"data-id":e.id,className:Ae(hs.item,{[hs.snap]:i}),targetWidth:t,targetHeight:n,video:u,member:e.member,unencryptedWarning:d,displayName:c,encryptionStatus:h,"aria-hidden":o,localParticipant:e.local};return e instanceof kh?E.jsx(s0,{videoEnabled:!0,videoFit:"contain",mirror:!1,...p}):E.jsx(Ote,{vm:e,...p})}));Mte.displayName="SpotlightItem";const TP=_.forwardRef((({vm:e,expanded:t,onToggleExpanded:n,targetWidth:r,targetHeight:i,showIndicators:o,className:s,style:a},l)=>{var c;const{t:u}=ze(),[d,h]=iNe(null),p=o0(d,l),f=tt(e.maximised$),m=tt(e.media$),[v,g]=_.useState(null==(c=m[0])?void 0:c.id),y=Ll(m),b=Ll(v),w=m.findIndex((e=>e.id===v)),S=w>0,C=-1!==w&&w<m.length-1,k=Ip((()=>h.pipe(Ne((e=>new IntersectionObserver((e=>{const t=e.find((e=>e.isIntersecting));void 0!==t&&g(t.target.getAttribute("data-id"))}),{root:e,threshold:.5})))))),[T,I]=Pte((e=>null==e||e===v||m.every((t=>t.id!==e))?null:e),[v]),R=_.useCallback((()=>{const e=y.current,t=e.findIndex((e=>e.id===b.current));t>0&&I(e[t-1].id)}),[b,y,I]),x=_.useCallback((()=>{const e=y.current,t=e.findIndex((e=>e.id===b.current));-1!==t&&t!==e.length-1&&I(e[t+1].id)}),[b,y,I]),L=t?V2e:nJ;return E.jsxs(ite.div,{ref:p,className:Ae(s,hs.tile,{[hs.maximised]:f}),style:a,children:[S&&E.jsx("button",{className:Ae(hs.advance,hs.back),"aria-label":u("common.back"),onClick:R,children:E.jsx(p2e,{"aria-hidden":!0,width:24,height:24})}),E.jsx("div",{className:hs.contents,children:m.map((e=>E.jsx(Mte,{vm:e,targetWidth:r,targetHeight:i,intersectionObserver$:k,snap:null===T||T===e.id,"aria-hidden":(T??v)!==e.id},e.id)))}),n&&E.jsx("button",{className:Ae(hs.expand),"aria-label":u(t?"video_tile.collapse":"video_tile.expand"),onClick:n,children:E.jsx(L,{"aria-hidden":!0,width:20,height:20})}),C&&E.jsx("button",{className:Ae(hs.advance,hs.next),"aria-label":u("common.next"),onClick:x,children:E.jsx(SY,{"aria-hidden":!0,width:24,height:24})}),!t&&E.jsx("div",{className:Ae(hs.indicators,{[hs.show]:o&&m.length>1}),children:m.map((e=>E.jsx("div",{className:hs.item,"data-visible":e.id===v},e.id)))})]})}));TP.displayName="SpotlightTile";const GBe="_fixed_r39jt_8",WBe="_scrolling_r39jt_9",zBe="_slot_r39jt_21",R_={fixed:GBe,scrolling:WBe,slot:zBe},YBe={inline:"end",block:"end"},JBe={inline:"end",block:"start"},SF=17/9,wI=4/3;function oO(e,t,n){const r=e<800?16:20,i=e*t,o=Math.pow(Math.sqrt(i)/8+125,2),s=Math.min(n,i/o);let a=Math.min(s,Math.round(Math.sqrt(e/t/wI*s))),l=s/a;s===n&&(l=Math.ceil(l),a=Math.ceil(n/l));let c=(e-(a+1)*r)/a,u=(t-(l-1)*r)/l;const d=c/u;return d>SF?c=u*SF:d<wI&&(u=c/wI),{tileWidth:c,tileHeight:u,gap:r,columns:a}}const XBe=({minBounds$:e,spotlightAlignment$:t})=>({scrollingOnTop:!1,fixed:_.forwardRef((function({model:e,Slot:n},r){xa();const i=tt(Ip((()=>t.pipe(va(((e,t)=>e.block===t.block&&e.inline===t.inline)))))),o=_.useCallback((({xRatio:e,yRatio:n})=>t.next({block:n<.5?"start":"end",inline:e<.5?"start":"end"})),[]);return E.jsx("div",{ref:r,className:R_.fixed,children:e.spotlight&&E.jsx(n,{className:R_.slot,id:"spotlight",model:e.spotlight,onDrag:o,"data-block-alignment":i.block,"data-inline-alignment":i.inline})})})),scrolling:_.forwardRef((function({model:t,Slot:n},r){xa(),sO(t.setVisibleTiles);const{width:i,height:o}=tt(e),{gap:s,tileWidth:a,tileHeight:l}=_.useMemo((()=>oO(i,o,t.grid.length)),[i,o,t.grid.length]);return E.jsx("div",{ref:r,className:R_.scrolling,style:{width:i,"--gap":`${s}px`,"--width":`${Math.floor(a)}px`,"--height":`${Math.floor(l)}px`},children:t.grid.map((e=>E.jsx(n,{className:R_.slot,id:e.id,model:e},e.id)))})}))}),ZBe="_layer_mc5gk_8",QBe="_container_mc5gk_14",eVe="_local_mc5gk_18",tVe="_slot_mc5gk_31",I_={layer:ZBe,container:QBe,local:eVe,slot:tVe},nVe=({minBounds$:e,pipAlignment$:t})=>({scrollingOnTop:!1,fixed:_.forwardRef((function(e,t){return xa(),E.jsx("div",{ref:t})})),scrolling:_.forwardRef((function({model:n,Slot:r},i){xa();const{width:o,height:s}=tt(e),a=tt(t),{tileWidth:l,tileHeight:c}=_.useMemo((()=>oO(o,s,1)),[o,s]),u=_.useCallback((({xRatio:e,yRatio:n})=>t.next({block:n<.5?"start":"end",inline:e<.5?"start":"end"})),[]);return E.jsx("div",{ref:i,className:I_.layer,children:E.jsx(r,{id:n.remote.id,model:n.remote,className:I_.container,style:{width:l,height:c},children:E.jsx(r,{className:Ae(I_.slot,I_.local),id:n.local.id,model:n.local,onDrag:u,"data-block-alignment":a.block,"data-inline-alignment":a.inline})})})}))}),rVe="_layer_1swii_8",iVe="_spotlight_1swii_12",sVe="_pip_1swii_17",k_={layer:rVe,spotlight:iVe,pip:sVe},oVe=({pipAlignment$:e})=>({scrollingOnTop:!0,fixed:_.forwardRef((function({model:e,Slot:t},n){return xa(),E.jsx("div",{ref:n,className:k_.layer,children:E.jsx(t,{className:k_.spotlight,id:"spotlight",model:e.spotlight})})})),scrolling:_.forwardRef((function({model:t,Slot:n},r){xa();const i=tt(e),o=_.useCallback((({xRatio:t,yRatio:n})=>e.next({block:n<.5?"start":"end",inline:t<.5?"start":"end"})),[]);return E.jsx("div",{ref:r,className:k_.layer,children:t.pip&&E.jsx(n,{className:k_.pip,id:t.pip.id,model:t.pip,onDrag:o,"data-block-alignment":i.block,"data-inline-alignment":i.inline})})}))}),aVe="_layer_jsvx2_8",lVe="_spotlight_jsvx2_19",cVe="_slot_jsvx2_28",uVe="_grid_jsvx2_34",Za={layer:aVe,spotlight:lVe,slot:cVe,grid:uVe},dVe=({minBounds$:e})=>({scrollingOnTop:!1,fixed:_.forwardRef((function({model:t,Slot:n},r){return xa(),tt(e),E.jsxs("div",{ref:r,className:Za.layer,children:[E.jsx("div",{className:Za.spotlight,children:E.jsx(n,{className:Za.slot,id:"spotlight",model:t.spotlight})}),E.jsx("div",{className:Za.grid})]})})),scrolling:_.forwardRef((function({model:t,Slot:n},r){xa(),sO(t.setVisibleTiles),tt(e);const i=tt(t.spotlight.media$).length>1;return E.jsxs("div",{ref:r,className:Za.layer,children:[E.jsx("div",{className:Ae(Za.spotlight,{[Za.withIndicators]:i})}),E.jsx("div",{className:Za.grid,children:t.grid.map((e=>E.jsx(n,{className:Za.slot,id:e.id,model:e},e.id)))})]})}))}),fVe="_layer_1q32d_8",hVe="_spotlight_1q32d_17",pVe="_withIndicators_1q32d_26",mVe="_slot_1q32d_30",gVe="_grid_1q32d_35",Cc={layer:fVe,spotlight:hVe,withIndicators:pVe,slot:mVe,grid:gVe},vVe=({minBounds$:e})=>({scrollingOnTop:!1,fixed:_.forwardRef((function({model:e,Slot:t},n){return xa(),E.jsx("div",{ref:n,className:Cc.layer,children:E.jsx("div",{className:Cc.spotlight,children:E.jsx(t,{className:Cc.slot,id:"spotlight",model:e.spotlight})})})})),scrolling:_.forwardRef((function({model:t,Slot:n},r){xa(),sO(t.setVisibleTiles);const{width:i}=tt(e),{gap:o,tileWidth:s,tileHeight:a}=oO(i,i,t.grid.length),l=tt(t.spotlight.media$).length>1;return E.jsxs("div",{ref:r,className:Cc.layer,style:{"--grid-gap":`${o}px`,"--grid-tile-width":`${Math.floor(s)}px`,"--grid-tile-height":`${Math.floor(a)}px`},children:[E.jsx("div",{className:Ae(Cc.spotlight,{[Cc.withIndicators]:l})}),E.jsx("div",{className:Cc.grid,children:t.grid.map((e=>E.jsx(n,{className:Cc.slot,id:e.id,model:e},e.id)))})]})}))});async function yVe(e,t,n){const r=e.createGain();r.gain.setValueAtTime(n,0);const i=e.createBufferSource();i.buffer=t,i.connect(r).connect(e.destination);const o=new Promise((e=>i.addEventListener("ended",(()=>e()))));return i.start(),o}function aO(e){const[t]=qn(YZ),n=uf(),[r,i]=_.useState(),[o,s]=_.useState();return _.useEffect((()=>{const t=e.sounds;if(!t)return;const n=new AudioContext({latencyHint:e.latencyHint});return(async()=>{const e={};for(const[r,i]of Object.entries(await t)){const t=await n.decodeAudioData(i.slice(0));e[r]=t}s(e)})().catch((e=>{A.debug("Failed to setup audio context",e)})),i(n),()=>{n.close().catch((e=>{A.debug("Failed to close audio engine",e)})),i(void 0)}}),[e.sounds,e.latencyHint]),_.useEffect((()=>{r&&"setSinkId"in r&&r.setSinkId(n.audioOutput.selectedId).catch((e=>{A.warn("Unable to change sink for audio context",e)}))}),[r,n]),r&&o?{playSound:async e=>{if(o[e])return yVe(r,o[e],t);A.debug(`Tried to play a sound that wasn't buffered (${e})`)}}:null}function _Ve(){return"maybe"===document.createElement("audio").canPlayType("audio/ogg")?"ogg":"mp3"}const bVe=_Ve();async function Ate(e){const t={};return await Promise.all(Object.entries(e).map((async([e,n])=>{const{mp3:r,ogg:i}=n,o=await fetch("ogg"===bVe?i:r??i);Y6(o)?A.warn(`Could not load sound ${e}, response was not okay`):t[e]=await o.arrayBuffer()}))),t}const EF=Object.fromEntries([...ry.filter((e=>void 0!==e.sound)).map((e=>[e.name,e.sound])),[Xx.name,Xx.sound]]);function SVe({vm:e}){const[t]=qn(w4),[n,r]=_.useState(null),i=Ll(aO({sounds:n,latencyHint:"interactive"}));return _.useEffect((()=>{!t||n||r(Ate(EF))}),[n,t]),_.useEffect((()=>{const t=e.audibleReactions$.subscribe((e=>{var t,n;for(const r of e)EF[r]?null==(t=i.current)||t.playSound(r):null==(n=i.current)||n.playSound("generic")}));return()=>{t.unsubscribe()}}),[e,i]),null}const EVe="_container_1ux8r_1",wVe="_reaction_1ux8r_12",wF={container:EVe,reaction:wVe};function CVe({vm:e}){const t=ay(e.visibleReactions$);return E.jsx("div",{className:wF.container,children:null==t?void 0:t.map((({sender:e,emoji:t,startX:n})=>E.jsx("span",{role:"presentation",style:{left:`${n}vw`},className:wF.reaction,children:t},e)))})}const TVe=""+new URL("join_call-dEJCP2wD.mp3",import.meta.url).href,RVe=""+new URL("join_call-DlMV9nHk.ogg",import.meta.url).href,IVe=""+new URL("left_call-BbqmRgnC.mp3",import.meta.url).href,kVe=""+new URL("left_call-C7NMl6WI.ogg",import.meta.url).href,xVe=""+new URL("raise_hand-CUbxEnt9.ogg",import.meta.url).href,PVe=""+new URL("raise_hand-Bzqn65WB.mp3",import.meta.url).href,LVe=""+new URL("screen_share_started-IZDL-kAw.ogg",import.meta.url).href,OVe=""+new URL("screen_share_started-DH3qxml5.mp3",import.meta.url).href,CF=8,TF=500,Nte=Ate({join:{mp3:TVe,ogg:RVe},left:{mp3:IVe,ogg:kVe},raiseHand:{mp3:PVe,ogg:xVe},screenshareStarted:{mp3:OVe,ogg:LVe}});function MVe({vm:e}){const t=Ll(aO({sounds:Nte,latencyHint:"interactive"}));return _.useEffect((()=>{const n=e.memberChanges$.pipe(Fo((({joined:e,ids:t})=>t.length<=8&&e.length>0)),tP((()=>Qx(TF)))).subscribe((()=>{var e;null==(e=t.current)||e.playSound("join")})),r=e.memberChanges$.pipe(Fo((({ids:e,left:t})=>e.length<=8&&t.length>0)),tP((()=>Qx(TF)))).subscribe((()=>{var e;null==(e=t.current)||e.playSound("left")})),i=e.newHandRaised$.subscribe((()=>{var e;null==(e=t.current)||e.playSound("raiseHand")})),o=e.newScreenShare$.subscribe((()=>{var e;null==(e=t.current)||e.playSound("screenshareStarted")}));return()=>{n.unsubscribe(),r.unsubscribe(),i.unsubscribe(),o.unsubscribe()}}),[t,e]),E.jsx(E.Fragment,{})}const RF=3e3;class AVe{constructor(e){this.rtcSession=e,this.raisedHandsSubject$=new ns({}),this.reactionsSubject$=new ns({}),this.raisedHands$=this.raisedHandsSubject$.asObservable(),this.reactions$=this.reactionsSubject$.asObservable(),this.onMembershipsChanged=e=>{for(const t of Object.keys(this.raisedHandsSubject$.value).filter((t=>e.find((e=>e.sender==t)))))this.removeRaisedHand(t);for(const e of this.rtcSession.memberships){if(!e.sender||!e.eventId)continue;const t=`${e.sender}:${e.deviceId}`;this.raisedHandsSubject$.value[t]&&this.raisedHandsSubject$.value[t].membershipEventId!==e.eventId&&this.removeRaisedHand(t);const n=this.getLastReactionEvent(e.eventId,e.sender);if(n){const t=null==n?void 0:n.getId();if(!t)continue;this.addRaisedHand(`${e.sender}:${e.deviceId}`,{membershipEventId:e.eventId,reactionEventId:t,time:new Date(n.localTimestamp)})}}},this.handleReactionEvent=e=>{var t,n,r;const i=this.rtcSession.room;if(e.getRoomId()!==i.roomId||e.isSending())return;const o=e.getSender(),s=e.getId();if(o&&s&&(i.client.decryptEventIfNeeded(e).catch((t=>A.warn(`Failed to decrypt ${e.getId()}`,t))),!e.isBeingDecrypted()&&!e.isDecryptionFailure()))if(e.getType()===h4){const r=e.getContent(),i=null==(t=null==r?void 0:r["m.relates_to"])?void 0:t.event_id,a=this.rtcSession.memberships.find((e=>e.eventId===i&&e.sender===o));if(!a)return void A.warn(`Reaction target was not a membership event for ${o}, ignoring`);const l=`${a.sender}:${a.deviceId}`;if(!r.emoji)return void A.warn(`Reaction had no emoji from ${s}`);const c=null==(n=new Intl.Segmenter(void 0,{granularity:"grapheme"}).segment(r.emoji)[Symbol.iterator]().next().value)?void 0:n.segment;if(null==c||!c.trim())return void A.warn(`Reaction had no emoji from ${s} after splitting`);const u={...Xx,emoji:c,...ry.find((e=>e.name===r.name))},d=this.reactionsSubject$.value;if(d[l])return void A.warn(`Got reaction from ${l} but one is still playing`);this.reactionsSubject$.next({...d,[l]:{reactionOption:u,expireAfter:new Date(Date.now()+RF)}})}else if(e.getType()===ee.Reaction){const t=e.getContent(),n=t["m.relates_to"].event_id,r=this.rtcSession.memberships.find((e=>e.eventId===n&&e.sender===o));if(!r)return void A.warn(`Reaction target was not a membership event for ${o}, ignoring`);"🖐️"===(null==t?void 0:t["m.relates_to"].key)&&this.addRaisedHand(`${r.sender}:${r.deviceId}`,{reactionEventId:s,membershipEventId:n,time:new Date(e.localTimestamp)})}else if(e.getType()===ee.RoomRedaction){const t=e.event.redacts,n=null==(r=Object.entries(this.raisedHandsSubject$.value).find((([e,n])=>n.reactionEventId===t)))?void 0:r[0];if(!n)return;this.removeRaisedHand(n)}},this.reactionsSub=this.reactionsSubject$.pipe(F5e(RF)).subscribe((e=>{const t=new Date,n=Object.fromEntries(Object.entries(e).filter((([e,n])=>n.expireAfter>t)));Object.keys(e).length!==Object.keys(n).length&&this.reactionsSubject$.next(n)})),this.rtcSession.room.on(ke.Timeline,this.handleReactionEvent),this.rtcSession.room.on(ke.Redaction,this.handleReactionEvent),this.rtcSession.room.client.on(Mt.Decrypted,this.handleReactionEvent),this.rtcSession.room.on(ke.LocalEchoUpdated,this.handleReactionEvent),e.on(ar.MembershipsChanged,this.onMembershipsChanged),this.onMembershipsChanged([])}getLastReactionEvent(e,t){const n=this.rtcSession.room.relations.getChildEventsForEvent(e,cn.Annotation,ee.Reaction);return((null==n?void 0:n.getRelations())??[]).find((e=>{var n,r;return e.event.sender===t&&e.getType()===ee.Reaction&&"🖐️"===(null==(r=null==(n=e.getContent())?void 0:n["m.relates_to"])?void 0:r.key)}))}addRaisedHand(e,t){this.raisedHandsSubject$.next({...this.raisedHandsSubject$.value,[e]:t})}removeRaisedHand(e){this.raisedHandsSubject$.next(Object.fromEntries(Object.entries(this.raisedHandsSubject$.value).filter((([t])=>t!==e))))}destroy(){this.rtcSession.off(ar.MembershipsChanged,this.onMembershipsChanged),this.rtcSession.room.off(ke.Timeline,this.handleReactionEvent),this.rtcSession.room.off(ke.Redaction,this.handleReactionEvent),this.rtcSession.room.client.off(Mt.Decrypted,this.handleReactionEvent),this.rtcSession.room.off(ke.LocalEchoUpdated,this.handleReactionEvent),this.reactionsSub.unsubscribe()}}const NVe="getDisplayMedia"in(navigator.mediaDevices??{}),DVe=400,jVe=e=>{const t=aHe(e.client,e.rtcSession),{livekitRoom:n,connState:r}=hHe(e.rtcSession,e.muteStates,t,e.e2eeSystem),i=oy((e=>e.pipe(Ne((([e])=>e)))),[r]),[o,s]=_.useState(null);return _.useEffect((()=>()=>{null==n||n.disconnect().catch((e=>{A.error("Failed to disconnect from livekit room",e)}))}),[]),_.useEffect((()=>{if(void 0!==n){const t=new AVe(e.rtcSession),r=new OHe(e.rtcSession,n,e.e2eeSystem,i,t.raisedHands$,t.reactions$);return s(r),()=>{r.destroy(),t.destroy()}}}),[e.rtcSession,n,e.e2eeSystem,i]),void 0===n||null===o?null:E.jsx(pee.Provider,{value:n,children:E.jsx(CNe,{vm:o,rtcSession:e.rtcSession,children:E.jsx(UVe,{...e,vm:o,livekitRoom:n,connState:r})})})},UVe=({client:e,vm:t,matrixInfo:n,rtcSession:r,livekitRoom:i,muteStates:o,participantCount:s,onLeave:a,hideHeader:l,connState:c,onShareClick:u})=>{const{supportsReactions:d,sendReaction:h,toggleRaisedHand:p}=R4();if(pHe(),c===St.Disconnected)throw new dte;const f=_.useRef(null),[m,v]=pv(),g=o0(f,m),{hideScreensharing:y,showControls:b}=Lu(),{isScreenShareEnabled:w,localParticipant:S}=aje({room:i}),[C,k]=_.useState(!1);Ew(r,AE.EnabledTransportsChanged,(e=>k(e.room)));const[T]=qn(C4),[I]=qn(S4),R=Jy(r.room.roomId),x=_.useMemo((()=>I&&T&&R.kind===Ut.PER_PARTICIPANT&&!C),[R.kind,C,T,I]),L=_.useCallback((()=>{var e,t;return null==(t=(e=o.audio).setEnabled)?void 0:t.call(e,(e=>!e))}),[o]),P=_.useCallback((()=>{var e,t;return null==(t=(e=o.video).setEnabled)?void 0:t.call(e,(e=>!e))}),[o]);UUe(f,L,P,(e=>{var t,n;return null==(n=(t=o.audio).setEnabled)?void 0:n.call(t,!e)}),(e=>{h(e)}),(()=>{p()}));const O=tt(t.windowMode$),M=tt(t.layout$),N=tt(t.tileStoreGeneration$),[D]=qn(E4),j=tt(t.gridMode$),U=tt(t.showHeader$),F=tt(t.showFooter$),H=bee(t.localVideo$),B=_.useRef(null),$=_.useCallback((()=>B.current=Date.now()),[]),V=_.useCallback((()=>{const e=B.current;null!==e&&Date.now()-e<=400&&t.tapScreen(),B.current=null}),[t]),q=_.useCallback((()=>B.current=null),[]),K=_.useCallback((e=>{F?(e.stopPropagation(),t.tapControls()):e.preventDefault()}),[t,F]),G=_.useCallback((e=>{"mouse"===e.pointerType&&t.hoverScreen()}),[t]),W=_.useCallback((()=>t.unhoverScreen()),[t]),[z,J]=_.useState(!1),[Y,Q]=_.useState(O4),Z=_.useCallback((()=>J(!0)),[J]),X=_.useCallback((()=>J(!1)),[J]),ee=_.useMemo((()=>null===Ge?()=>{Q("profile"),J(!0)}:null),[Q,J]),[te,ne]=pv(),[re,ie]=pv(),oe=_.useMemo((()=>({width:v.width,height:v.height-ne.height-("flat"===O?0:ie.height)})),[v.width,v.height,ne.height,ie.height,O]),se=oy((e=>e.pipe(Ne((([e])=>e)))),[oe]),ae=Ip((()=>new ns(YBe))),le=Ip((()=>new ns(JBe))),ce=_.useCallback((e=>t.setGridMode(e)),[t]);_.useEffect((()=>{null==Ge||Ge.api.transport.send("grid"===j?Ar.TileLayout:Ar.SpotlightLayout,{}).catch((e=>{A.error("Failed to send layout change to widget API",e)}))}),[j]),_.useEffect((()=>{if(Ge){const e=e=>{ce("grid"),Ge.api.transport.reply(e.detail,{})},t=e=>{ce("spotlight"),Ge.api.transport.reply(e.detail,{})};return Ge.lazyActions.on(Ar.TileLayout,e),Ge.lazyActions.on(Ar.SpotlightLayout,t),()=>{Ge.lazyActions.off(Ar.TileLayout,e),Ge.lazyActions.off(Ar.SpotlightLayout,t)}}}),[ce]);const ue=_.useMemo((()=>_.forwardRef((function({className:e,style:n,targetWidth:r,targetHeight:i,model:o},s){const a=tt(t.spotlightExpanded$),l=tt(t.toggleSpotlightExpanded$),c=tt(t.showSpeakingIndicators$),u=tt(t.showSpotlightIndicators$);return o instanceof pte?E.jsx(lte,{ref:s,vm:o,onOpenProfile:ee,targetWidth:r,targetHeight:i,className:Ae(e,On.tile),style:n,showSpeakingIndicators:c}):E.jsx(TP,{ref:s,vm:o,expanded:a,onToggleExpanded:l,targetWidth:r,targetHeight:i,showIndicators:u,className:Ae(e,On.tile),style:n})}))),[t,ee]),de=_.useMemo((()=>{const e={minBounds$:se,spotlightAlignment$:ae,pipAlignment$:le};return{grid:XBe(e),"spotlight-landscape":dVe(e),"spotlight-portrait":vVe(e),"spotlight-expanded":oVe(e),"one-on-one":nVe(e)}}),[se,ae,le]),he=mNe(r.room.roomId),pe=_.useCallback((()=>{S.setScreenShareEnabled(!w,{audio:!0,selfBrowserSurface:"include",surfaceSwitching:"include",systemAudio:"include"}).catch(A.error)}),[S,w]),fe=[];fe.push(E.jsx(ZZ,{muted:!o.audio.enabled,onClick:L,onTouchEnd:K,disabled:null===o.audio.setEnabled,"data-testid":"incall_mute"},"audio"),E.jsx(QZ,{muted:!o.video.enabled,onClick:P,onTouchEnd:K,disabled:null===o.video.setEnabled,"data-testid":"incall_videomute"},"video")),null!==H&&fe.push(E.jsx(eQ,{className:On.switchCamera,onClick:H,onTouchEnd:K},"switch_camera")),NVe&&!y&&fe.push(E.jsx(SNe,{className:On.shareScreen,enabled:w,onClick:pe,onTouchEnd:K,"data-testid":"incall_screenshare"},"share_screen")),d&&fe.push(E.jsx(t8e,{vm:t,className:On.raiseHand,identifier:`${e.getUserId()}:${e.getDeviceId()}`,onTouchEnd:K},"raise_hand")),"pip"!==M.type&&fe.push(E.jsx(nQ,{onClick:Z,onTouchEnd:K},"settings")),fe.push(E.jsx(tQ,{onClick:function(){a()},onTouchEnd:K,"data-testid":"incall_leave"},"end_call"));const me=E.jsxs("div",{ref:re,className:Ae(On.footer,{[On.overlay]:"flat"===O,[On.hidden]:!F||!b&&l}),children:[!l&&E.jsxs("div",{className:On.logo,children:[E.jsx(NUe,{width:24,height:24,"aria-hidden":!0}),E.jsx(jUe,{width:80,height:11,"aria-label":"Element Call"}),D?`Tiles generation: ${N}`:void 0]}),b&&E.jsx("div",{className:On.buttons,children:fe}),b&&E.jsx(vHe,{className:On.layout,layout:j,setLayout:ce,onTouchEnd:K})]});return E.jsxs("div",{className:On.inRoom,ref:g,onTouchStart:$,onTouchEnd:V,onTouchCancel:q,onPointerMove:G,onPointerOut:W,children:[U&&(l?E.jsx("div",{className:Ae(On.header,On.filler),ref:te}):E.jsxs(Pu,{className:On.header,ref:te,children:[E.jsx(sf,{children:E.jsx(NJ,{id:n.roomId,name:n.roomName,avatarUrl:n.roomAvatar,encrypted:n.e2eeSystem.kind!==Ut.NONE,participantCount:s})}),E.jsx(of,{children:b&&null!==u&&E.jsx(_ee,{className:On.invite,onClick:u})})]})),x&&E.jsx(Jt,{style:{height:0,zIndex:1,alignSelf:"center",margin:0},size:"sm",children:"using to Device key transport"}),E.jsx(Nje,{}),(()=>{if("pip"===M.type)return E.jsx(TP,{className:Ae(On.tile,On.maximised),vm:M.spotlight,expanded:!0,onToggleExpanded:null,targetWidth:oe.height,targetHeight:oe.width,showIndicators:!1});const e=de[M.type],t=E.jsx(bF,{className:On.fixedGrid,style:{insetBlockStart:ne.bottom,height:oe.height},model:M,Layout:e.fixed,Tile:ue},"fixed"),n=E.jsx(bF,{className:On.scrollingGrid,model:M,Layout:e.scrolling,Tile:ue},"scrolling");return"spotlight-expanded"===M.type?E.jsxs(E.Fragment,{children:[t,n]}):E.jsxs(E.Fragment,{children:[n,t]})})(),E.jsx(MVe,{vm:t}),E.jsx(SVe,{vm:t}),E.jsx(CVe,{vm:t}),me,"pip"!==M.type&&E.jsxs(E.Fragment,{children:[E.jsx(A$e,{...he}),E.jsx(M4,{client:e,roomId:r.room.roomId,open:z,onDismiss:X,tab:Y,onTabChange:Q,livekitRoom:i})]})]})},FVe=8,$Ve={enabled:!1,setEnabled:null};function IF(e,t){const[n,r]=Pte((n=>n??(e.available.size>0?t():void 0)),[e]);return _.useMemo((()=>0===e.available.size?$Ve:{enabled:n??!1,setEnabled:r}),[e,n,r])}function HVe(e){const t=uf(),{skipLobby:n}=Lu(),r=IF(t.audioInput,(()=>Bt.get().media_devices.enable_audio&&!n&&!e)),i=IF(t.videoInput,(()=>Bt.get().media_devices.enable_video&&!n&&!e));_.useEffect((()=>{null==Ge||Ge.api.transport.send(Ar.DeviceMute,{audio_enabled:r.enabled,video_enabled:i.enabled}).catch((e=>A.warn("Could not send DeviceMute action to widget",e)))}),[r,i]);const o=_.useCallback((e=>{var t,n;const o={audio_enabled:r.enabled,video_enabled:i.enabled};null!=e.detail.data.audio_enabled&&"boolean"==typeof e.detail.data.audio_enabled&&(null==(t=r.setEnabled)||t.call(r,e.detail.data.audio_enabled),o.audio_enabled=e.detail.data.audio_enabled),null!=e.detail.data.video_enabled&&"boolean"==typeof e.detail.data.video_enabled&&(null==(n=i.setEnabled)||n.call(i,e.detail.data.video_enabled),o.video_enabled=e.detail.data.video_enabled),Ge.api.transport.reply(e.detail,o)}),[r,i]);return _.useEffect((()=>{if(Ge)return Ge.lazyActions.on(Ar.DeviceMute,o),()=>{null==Ge||Ge.lazyActions.off(Ar.DeviceMute,o)}}),[o]),_.useMemo((()=>({audio:r,video:i})),[r,i])}const BVe="org.matrix.msc4143.rtc_foci";function VVe(){return{type:"livekit",focus_selection:"oldest_membership"}}async function qVe(e,t){var n,r;A.log("Start building foci_preferred list: ",e.room.roomId);const i=[],o=e.getFocusInUse();o&&xk(o)&&(A.log("Adding livekit focus from oldest member: ",o),i.push(o));const s=e.room.client.getDomain();if(s){const e=null==(n=await it.getRawClientConfig(s))?void 0:n[BVe];Array.isArray(e)&&i.push(...e.filter((e=>!!e)).filter(RH).map((e=>(A.log("Adding livekit focus from well known: ",e),{...e,livekit_alias:t}))))}const a=null==(r=Bt.get().livekit)?void 0:r.livekit_service_url;if(a){const e={type:"livekit",livekit_service_url:a,livekit_alias:t};A.log("Adding livekit focus from config: ",e),i.push(e)}if(0===i.length)throw new nHe(s??"");return Promise.resolve(i)}async function KVe(e,t,n=!0,r=!1){Et.instance.eventCallEnded.cacheStartCall(new Date),Et.instance.eventCallStarted.track(e.room.roomId);const i=e.room.roomId,{features:o,matrix_rtc_session:s}=Bt.get(),a=null==o?void 0:o.feature_use_device_session_member_events;if(e.joinRoomSession(await qVe(e,i),VVe(),{useNewMembershipManager:n,manageMediaKeys:t,...void 0!==a&&{useLegacyMemberEvents:!a},membershipServerSideExpiryTimeout:null==s?void 0:s.membership_server_side_expiry_timeout,membershipKeepAlivePeriod:null==s?void 0:s.membership_keep_alive_period,makeKeyDelay:null==s?void 0:s.key_rotation_on_leave_delay,useExperimentalToDeviceTransport:r}),Ge)try{await Ge.api.transport.send(Ar.JoinCall,{})}catch(e){A.error("Failed to send join action",e)}}const GVe=async(e,t,n)=>{try{await e.api.setAlwaysOnScreen(!1)}catch(e){A.error("Failed to set call widget `alwaysOnScreen` to false",e)}await n;try{await e.api.transport.send(Ar.HangupCall,{})}catch(e){A.error("Failed to send hangup action",e)}if("user"===t&&!Jr().returnToLobby){try{await e.api.transport.send(Ar.Close,{})}catch(e){A.error("Failed to send close action",e)}e.api.transport.stop()}};async function kF(e,t,n){await e.leaveRoomSession(),Ge?await GVe(Ge,t,n):await n}const Dte=(e,t)=>{const[n,r]=_.useState(0);return Ew(e,ut.Update,_.useCallback((()=>r((e=>e+1))),[r])),_.useMemo((()=>t(e.currentState)),[e,t,n])};function WVe(e){return Dte(e,_.useCallback((()=>e.getMxcAvatarUrl()),[e]))}function zVe(e){const[,t]=_.useState(0);return Ew(e,ke.Name,(()=>t((e=>e+1)))),e.name}function YVe(e){return Dte(e,_.useCallback((e=>e.getJoinRule()),[]))}var CI,xF,TI,PF;function JVe(){return xF||(xF=1,CI=function(){var e=document.getSelection();if(!e.rangeCount)return function(){};for(var t=document.activeElement,n=[],r=0;r<e.rangeCount;r++)n.push(e.getRangeAt(r));switch(t.tagName.toUpperCase()){case"INPUT":case"TEXTAREA":t.blur();break;default:t=null}return e.removeAllRanges(),function(){"Caret"===e.type&&e.removeAllRanges(),e.rangeCount||n.forEach((function(t){e.addRange(t)})),t&&t.focus()}}),CI}function XVe(){if(PF)return TI;PF=1;var e=JVe(),t={"text/plain":"Text","text/html":"Url",default:"Text"};return TI=function(n,r){var i,o,s,a,l,c,u=!1;r||(r={}),i=r.debug||!1;try{if(s=e(),a=document.createRange(),l=document.getSelection(),(c=document.createElement("span")).textContent=n,c.ariaHidden="true",c.style.all="unset",c.style.position="fixed",c.style.top=0,c.style.clip="rect(0, 0, 0, 0)",c.style.whiteSpace="pre",c.style.webkitUserSelect="text",c.style.MozUserSelect="text",c.style.msUserSelect="text",c.style.userSelect="text",c.addEventListener("copy",(function(e){if(e.stopPropagation(),r.format)if(e.preventDefault(),typeof e.clipboardData>"u"){i&&console.warn("unable to use e.clipboardData"),i&&console.warn("trying IE specific stuff"),window.clipboardData.clearData();var o=t[r.format]||t.default;window.clipboardData.setData(o,n)}else e.clipboardData.clearData(),e.clipboardData.setData(r.format,n);r.onCopy&&(e.preventDefault(),r.onCopy(e.clipboardData))})),document.body.appendChild(c),a.selectNodeContents(c),l.addRange(a),!document.execCommand("copy"))throw new Error("copy command was unsuccessful");u=!0}catch(e){i&&console.error("unable to copy using execCommand: ",e),i&&console.warn("trying IE specific stuff");try{window.clipboardData.setData(r.format||"text",n),r.onCopy&&r.onCopy(window.clipboardData),u=!0}catch(e){i&&console.error("unable to copy using clipboardData: ",e),i&&console.error("falling back to prompt"),o=function(e){var t=(/mac os x/i.test(navigator.userAgent)?"⌘":"Ctrl")+"+C";return e.replace(/#{\s*key\s*}/g,t)}("message"in r?r.message:"Copy to clipboard: #{key}, Enter"),window.prompt(o,n)}}finally{l&&("function"==typeof l.removeRange?l.removeRange(a):l.removeAllRanges()),c&&document.body.removeChild(c),s()}return u}}var ZVe=XVe();const QVe=Ko(ZVe);function eqe(e,t){var n=_.useState(!1),r=n[0],i=n[1],o=t;return _.useEffect((function(){}),[r,o]),[r,function(){var t=QVe(e);i(t)}]}const tqe="_url_1ibuh_8",nqe="_button_1ibuh_15",rqe="_qrCode_1ibuh_19",RI={url:tqe,button:nqe,qrCode:rqe},iqe="_toast_z5w27_8",sqe={toast:iqe},oqe=({open:e,onDismiss:t,autoDismiss:n,children:r,Icon:i})=>{const o=_.useCallback((e=>{e||t()}),[t]);return _.useEffect((()=>{if(e&&void 0!==n){const e=setTimeout(t,n);return()=>clearTimeout(e)}}),[e,n,t]),E.jsx(C6,{open:e,onOpenChange:o,children:E.jsxs(T6,{children:[E.jsx(R6,{className:Ae(ga.bg,ga.animate)}),E.jsx(I6,{"aria-describedby":void 0,asChild:!0,children:E.jsxs(Qz,{className:Ae(ga.overlay,ga.animate,sqe.toast),children:[E.jsx(k6,{asChild:!0,children:E.jsx(Jt,{as:"h3",size:"sm",weight:"semibold",children:r})}),i&&E.jsx(i,{width:20,height:20,"aria-hidden":!0})]})})]})})};var II,LF,lh={};function aqe(){return LF||(LF=1,II=function(){return"function"==typeof Promise&&Promise.prototype&&Promise.prototype.then}),II}var OF,kI={},Tc={};function df(){if(OF)return Tc;let e;OF=1;const t=[0,26,44,70,100,134,172,196,242,292,346,404,466,532,581,655,733,815,901,991,1085,1156,1258,1364,1474,1588,1706,1828,1921,2051,2185,2323,2465,2611,2761,2876,3034,3196,3362,3532,3706];return Tc.getSymbolSize=function(e){if(!e)throw new Error('"version" cannot be null or undefined');if(e<1||e>40)throw new Error('"version" should be in range from 1 to 40');return 4*e+17},Tc.getSymbolTotalCodewords=function(e){return t[e]},Tc.getBCHDigit=function(e){let t=0;for(;0!==e;)t++,e>>>=1;return t},Tc.setToSJISFunction=function(t){if("function"!=typeof t)throw new Error('"toSJISFunc" is not a valid function.');e=t},Tc.isKanjiModeEnabled=function(){return typeof e<"u"},Tc.toSJIS=function(t){return e(t)},Tc}var MF,PI,AF,LI,NF,xI={};function lO(){return MF||(MF=1,(e=xI).L={bit:1},e.M={bit:0},e.Q={bit:3},e.H={bit:2},e.isValid=function(e){return e&&typeof e.bit<"u"&&e.bit>=0&&e.bit<4},e.from=function(t,n){if(e.isValid(t))return t;try{return function(t){if("string"!=typeof t)throw new Error("Param is not a string");switch(t.toLowerCase()){case"l":case"low":return e.L;case"m":case"medium":return e.M;case"q":case"quartile":return e.Q;case"h":case"high":return e.H;default:throw new Error("Unknown EC Level: "+t)}}(t)}catch{return n}}),xI;var e}function lqe(){if(AF)return PI;function e(){this.buffer=[],this.length=0}return AF=1,e.prototype={get:function(e){const t=Math.floor(e/8);return 1==(this.buffer[t]>>>7-e%8&1)},put:function(e,t){for(let n=0;n<t;n++)this.putBit(1==(e>>>t-n-1&1))},getLengthInBits:function(){return this.length},putBit:function(e){const t=Math.floor(this.length/8);this.buffer.length<=t&&this.buffer.push(0),e&&(this.buffer[t]|=128>>>this.length%8),this.length++}},PI=e}function cqe(){if(NF)return LI;function e(e){if(!e||e<1)throw new Error("BitMatrix size must be defined and greater than 0");this.size=e,this.data=new Uint8Array(e*e),this.reservedBit=new Uint8Array(e*e)}return NF=1,e.prototype.set=function(e,t,n,r){const i=e*this.size+t;this.data[i]=n,r&&(this.reservedBit[i]=!0)},e.prototype.get=function(e,t){return this.data[e*this.size+t]},e.prototype.xor=function(e,t,n){this.data[e*this.size+t]^=n},e.prototype.isReserved=function(e,t){return this.reservedBit[e*this.size+t]},LI=e}var DF,OI={};function uqe(){return DF||(DF=1,function(e){const t=df().getSymbolSize;e.getRowColCoords=function(e){if(1===e)return[];const n=Math.floor(e/7)+2,r=t(e),i=145===r?26:2*Math.ceil((r-13)/(2*n-2)),o=[r-7];for(let e=1;e<n-1;e++)o[e]=o[e-1]-i;return o.push(6),o.reverse()},e.getPositions=function(t){const n=[],r=e.getRowColCoords(t),i=r.length;for(let e=0;e<i;e++)for(let t=0;t<i;t++)0===e&&0===t||0===e&&t===i-1||e===i-1&&0===t||n.push([r[e],r[t]]);return n}}(OI)),OI}var jF,MI={};function dqe(){if(jF)return MI;jF=1;const e=df().getSymbolSize;return MI.getPositions=function(t){const n=e(t);return[[0,0],[n-7,0],[0,n-7]]},MI}var UF,AI={};function fqe(){return UF||(UF=1,function(e){e.Patterns={PATTERN000:0,PATTERN001:1,PATTERN010:2,PATTERN011:3,PATTERN100:4,PATTERN101:5,PATTERN110:6,PATTERN111:7};const t=3,n=3,r=40,i=10;function o(t,n,r){switch(t){case e.Patterns.PATTERN000:return(n+r)%2==0;case e.Patterns.PATTERN001:return n%2==0;case e.Patterns.PATTERN010:return r%3==0;case e.Patterns.PATTERN011:return(n+r)%3==0;case e.Patterns.PATTERN100:return(Math.floor(n/2)+Math.floor(r/3))%2==0;case e.Patterns.PATTERN101:return n*r%2+n*r%3==0;case e.Patterns.PATTERN110:return(n*r%2+n*r%3)%2==0;case e.Patterns.PATTERN111:return(n*r%3+(n+r)%2)%2==0;default:throw new Error("bad maskPattern:"+t)}}e.isValid=function(e){return null!=e&&""!==e&&!isNaN(e)&&e>=0&&e<=7},e.from=function(t){return e.isValid(t)?parseInt(t,10):void 0},e.getPenaltyN1=function(e){const n=e.size;let r=0,i=0,o=0,s=null,a=null;for(let l=0;l<n;l++){i=o=0,s=a=null;for(let c=0;c<n;c++){let n=e.get(l,c);n===s?i++:(i>=5&&(r+=t+(i-5)),s=n,i=1),n=e.get(c,l),n===a?o++:(o>=5&&(r+=t+(o-5)),a=n,o=1)}i>=5&&(r+=t+(i-5)),o>=5&&(r+=t+(o-5))}return r},e.getPenaltyN2=function(e){const t=e.size;let r=0;for(let n=0;n<t-1;n++)for(let i=0;i<t-1;i++){const t=e.get(n,i)+e.get(n,i+1)+e.get(n+1,i)+e.get(n+1,i+1);(4===t||0===t)&&r++}return r*n},e.getPenaltyN3=function(e){const t=e.size;let n=0,i=0,o=0;for(let r=0;r<t;r++){i=o=0;for(let s=0;s<t;s++)i=i<<1&2047|e.get(r,s),s>=10&&(1488===i||93===i)&&n++,o=o<<1&2047|e.get(s,r),s>=10&&(1488===o||93===o)&&n++}return n*r},e.getPenaltyN4=function(e){let t=0;const n=e.data.length;for(let r=0;r<n;r++)t+=e.data[r];return Math.abs(Math.ceil(100*t/n/5)-10)*i},e.applyMask=function(e,t){const n=t.size;for(let r=0;r<n;r++)for(let i=0;i<n;i++)t.isReserved(i,r)||t.xor(i,r,o(e,i,r))},e.getBestMask=function(t,n){const r=Object.keys(e.Patterns).length;let i=0,o=1/0;for(let s=0;s<r;s++){n(s),e.applyMask(s,t);const r=e.getPenaltyN1(t)+e.getPenaltyN2(t)+e.getPenaltyN3(t)+e.getPenaltyN4(t);e.applyMask(s,t),r<o&&(o=r,i=s)}return i}}(AI)),AI}var FF,x_={};function jte(){if(FF)return x_;FF=1;const e=lO(),t=[1,1,1,1,1,1,1,1,1,1,2,2,1,2,2,4,1,2,4,4,2,4,4,4,2,4,6,5,2,4,6,6,2,5,8,8,4,5,8,8,4,5,8,11,4,8,10,11,4,9,12,16,4,9,16,16,6,10,12,18,6,10,17,16,6,11,16,19,6,13,18,21,7,14,21,25,8,16,20,25,8,17,23,25,9,17,23,34,9,18,25,30,10,20,27,32,12,21,29,35,12,23,34,37,12,25,34,40,13,26,35,42,14,28,38,45,15,29,40,48,16,31,43,51,17,33,45,54,18,35,48,57,19,37,51,60,19,38,53,63,20,40,56,66,21,43,59,70,22,45,62,74,24,47,65,77,25,49,68,81],n=[7,10,13,17,10,16,22,28,15,26,36,44,20,36,52,64,26,48,72,88,36,64,96,112,40,72,108,130,48,88,132,156,60,110,160,192,72,130,192,224,80,150,224,264,96,176,260,308,104,198,288,352,120,216,320,384,132,240,360,432,144,280,408,480,168,308,448,532,180,338,504,588,196,364,546,650,224,416,600,700,224,442,644,750,252,476,690,816,270,504,750,900,300,560,810,960,312,588,870,1050,336,644,952,1110,360,700,1020,1200,390,728,1050,1260,420,784,1140,1350,450,812,1200,1440,480,868,1290,1530,510,924,1350,1620,540,980,1440,1710,570,1036,1530,1800,570,1064,1590,1890,600,1120,1680,1980,630,1204,1770,2100,660,1260,1860,2220,720,1316,1950,2310,750,1372,2040,2430];return x_.getBlocksCount=function(n,r){switch(r){case e.L:return t[4*(n-1)+0];case e.M:return t[4*(n-1)+1];case e.Q:return t[4*(n-1)+2];case e.H:return t[4*(n-1)+3];default:return}},x_.getTotalCodewordsCount=function(t,r){switch(r){case e.L:return n[4*(t-1)+0];case e.M:return n[4*(t-1)+1];case e.Q:return n[4*(t-1)+2];case e.H:return n[4*(t-1)+3];default:return}},x_}var $F,HF,DI,BF,NI={},Lg={};function hqe(){if($F)return Lg;$F=1;const e=new Uint8Array(512),t=new Uint8Array(256);return function(){let n=1;for(let r=0;r<255;r++)e[r]=n,t[n]=r,n<<=1,256&n&&(n^=285);for(let t=255;t<512;t++)e[t]=e[t-255]}(),Lg.log=function(e){if(e<1)throw new Error("log("+e+")");return t[e]},Lg.exp=function(t){return e[t]},Lg.mul=function(n,r){return 0===n||0===r?0:e[t[n]+t[r]]},Lg}function pqe(){return HF||(HF=1,function(e){const t=hqe();e.mul=function(e,n){const r=new Uint8Array(e.length+n.length-1);for(let i=0;i<e.length;i++)for(let o=0;o<n.length;o++)r[i+o]^=t.mul(e[i],n[o]);return r},e.mod=function(e,n){let r=new Uint8Array(e);for(;r.length-n.length>=0;){const e=r[0];for(let i=0;i<n.length;i++)r[i]^=t.mul(n[i],e);let i=0;for(;i<r.length&&0===r[i];)i++;r=r.slice(i)}return r},e.generateECPolynomial=function(n){let r=new Uint8Array([1]);for(let i=0;i<n;i++)r=e.mul(r,new Uint8Array([1,t.exp(i)]));return r}}(NI)),NI}function mqe(){if(BF)return DI;BF=1;const e=pqe();function t(e){this.genPoly=void 0,this.degree=e,this.degree&&this.initialize(this.degree)}return t.prototype.initialize=function(t){this.degree=t,this.genPoly=e.generateECPolynomial(this.degree)},t.prototype.encode=function(t){if(!this.genPoly)throw new Error("Encoder not initialized");const n=new Uint8Array(t.length+this.degree);n.set(t);const r=e.mod(n,this.genPoly),i=this.degree-r.length;if(i>0){const e=new Uint8Array(this.degree);return e.set(r,i),e}return r},DI=t}var VF,jI={},UI={},FI={};function Ute(){return VF||(VF=1,FI.isValid=function(e){return!isNaN(e)&&e>=1&&e<=40}),FI}var qF,KF,GF,ta={};function Fte(){if(qF)return ta;qF=1;const e="[0-9]+";let t="(?:[u3000-u303F]|[u3040-u309F]|[u30A0-u30FF]|[uFF00-uFFEF]|[u4E00-u9FAF]|[u2605-u2606]|[u2190-u2195]|u203B|[u2010u2015u2018u2019u2025u2026u201Cu201Du2225u2260]|[u0391-u0451]|[u00A7u00A8u00B1u00B4u00D7u00F7])+";t=t.replace(/u/g,"\\u");const n="(?:(?![A-Z0-9 $%*+\\-./:]|"+t+")(?:.|[\r\n]))+";ta.KANJI=new RegExp(t,"g"),ta.BYTE_KANJI=new RegExp("[^A-Z0-9 $%*+\\-./:]+","g"),ta.BYTE=new RegExp(n,"g"),ta.NUMERIC=new RegExp(e,"g"),ta.ALPHANUMERIC=new RegExp("[A-Z $%*+\\-./:]+","g");const r=new RegExp("^"+t+"$"),i=new RegExp("^"+e+"$"),o=new RegExp("^[A-Z0-9 $%*+\\-./:]+$");return ta.testKanji=function(e){return r.test(e)},ta.testNumeric=function(e){return i.test(e)},ta.testAlphanumeric=function(e){return o.test(e)},ta}function ff(){return KF||(KF=1,function(e){const t=Ute(),n=Fte();e.NUMERIC={id:"Numeric",bit:1,ccBits:[10,12,14]},e.ALPHANUMERIC={id:"Alphanumeric",bit:2,ccBits:[9,11,13]},e.BYTE={id:"Byte",bit:4,ccBits:[8,16,16]},e.KANJI={id:"Kanji",bit:8,ccBits:[8,10,12]},e.MIXED={bit:-1},e.getCharCountIndicator=function(e,n){if(!e.ccBits)throw new Error("Invalid mode: "+e);if(!t.isValid(n))throw new Error("Invalid version: "+n);return n>=1&&n<10?e.ccBits[0]:n<27?e.ccBits[1]:e.ccBits[2]},e.getBestModeForData=function(t){return n.testNumeric(t)?e.NUMERIC:n.testAlphanumeric(t)?e.ALPHANUMERIC:n.testKanji(t)?e.KANJI:e.BYTE},e.toString=function(e){if(e&&e.id)return e.id;throw new Error("Invalid mode")},e.isValid=function(e){return e&&e.bit&&e.ccBits},e.from=function(t,n){if(e.isValid(t))return t;try{return function(t){if("string"!=typeof t)throw new Error("Param is not a string");switch(t.toLowerCase()){case"numeric":return e.NUMERIC;case"alphanumeric":return e.ALPHANUMERIC;case"kanji":return e.KANJI;case"byte":return e.BYTE;default:throw new Error("Unknown mode: "+t)}}(t)}catch{return n}}}(UI)),UI}function gqe(){return GF||(GF=1,function(e){const t=df(),n=jte(),r=lO(),i=ff(),o=Ute(),s=t.getBCHDigit(7973);function a(e,t){return i.getCharCountIndicator(e,t)+4}function l(e,t){let n=0;return e.forEach((function(e){const r=a(e.mode,t);n+=r+e.getBitsLength()})),n}e.from=function(e,t){return o.isValid(e)?parseInt(e,10):t},e.getCapacity=function(e,r,s){if(!o.isValid(e))throw new Error("Invalid QR Code version");typeof s>"u"&&(s=i.BYTE);const l=8*(t.getSymbolTotalCodewords(e)-n.getTotalCodewordsCount(e,r));if(s===i.MIXED)return l;const c=l-a(s,e);switch(s){case i.NUMERIC:return Math.floor(c/10*3);case i.ALPHANUMERIC:return Math.floor(c/11*2);case i.KANJI:return Math.floor(c/13);case i.BYTE:default:return Math.floor(c/8)}},e.getBestVersionForData=function(t,n){let o;const s=r.from(n,r.M);if(Array.isArray(t)){if(t.length>1)return function(t,n){for(let r=1;r<=40;r++)if(l(t,r)<=e.getCapacity(r,n,i.MIXED))return r}(t,s);if(0===t.length)return 1;o=t[0]}else o=t;return function(t,n,r){for(let i=1;i<=40;i++)if(n<=e.getCapacity(i,r,t))return i}(o.mode,o.getLength(),s)},e.getEncodedBits=function(e){if(!o.isValid(e)||e<7)throw new Error("Invalid QR Code version");let n=e<<12;for(;t.getBCHDigit(n)-s>=0;)n^=7973<<t.getBCHDigit(n)-s;return e<<12|n}}(jI)),jI}var WF,$I={};function vqe(){if(WF)return $I;WF=1;const e=df(),t=e.getBCHDigit(1335);return $I.getEncodedBits=function(n,r){const i=n.bit<<3|r;let o=i<<10;for(;e.getBCHDigit(o)-t>=0;)o^=1335<<e.getBCHDigit(o)-t;return 21522^(i<<10|o)},$I}var BI,zF,VI,YF,qI,JF,KI,XF,HI={};function yqe(){if(zF)return BI;zF=1;const e=ff();function t(t){this.mode=e.NUMERIC,this.data=t.toString()}return t.getBitsLength=function(e){return 10*Math.floor(e/3)+(e%3?e%3*3+1:0)},t.prototype.getLength=function(){return this.data.length},t.prototype.getBitsLength=function(){return t.getBitsLength(this.data.length)},t.prototype.write=function(e){let t,n,r;for(t=0;t+3<=this.data.length;t+=3)n=this.data.substr(t,3),r=parseInt(n,10),e.put(r,10);const i=this.data.length-t;i>0&&(n=this.data.substr(t),r=parseInt(n,10),e.put(r,3*i+1))},BI=t}function _qe(){if(YF)return VI;YF=1;const e=ff(),t=["0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"," ","$","%","*","+","-",".","/",":"];function n(t){this.mode=e.ALPHANUMERIC,this.data=t}return n.getBitsLength=function(e){return 11*Math.floor(e/2)+e%2*6},n.prototype.getLength=function(){return this.data.length},n.prototype.getBitsLength=function(){return n.getBitsLength(this.data.length)},n.prototype.write=function(e){let n;for(n=0;n+2<=this.data.length;n+=2){let r=45*t.indexOf(this.data[n]);r+=t.indexOf(this.data[n+1]),e.put(r,11)}this.data.length%2&&e.put(t.indexOf(this.data[n]),6)},VI=n}function bqe(){if(JF)return qI;JF=1;const e=ff();function t(t){this.mode=e.BYTE,this.data="string"==typeof t?(new TextEncoder).encode(t):new Uint8Array(t)}return t.getBitsLength=function(e){return 8*e},t.prototype.getLength=function(){return this.data.length},t.prototype.getBitsLength=function(){return t.getBitsLength(this.data.length)},t.prototype.write=function(e){for(let t=0,n=this.data.length;t<n;t++)e.put(this.data[t],8)},qI=t}function Sqe(){if(XF)return KI;XF=1;const e=ff(),t=df();function n(t){this.mode=e.KANJI,this.data=t}return n.getBitsLength=function(e){return 13*e},n.prototype.getLength=function(){return this.data.length},n.prototype.getBitsLength=function(){return n.getBitsLength(this.data.length)},n.prototype.write=function(e){let n;for(n=0;n<this.data.length;n++){let r=t.toSJIS(this.data[n]);if(r>=33088&&r<=40956)r-=33088;else{if(!(r>=57408&&r<=60351))throw new Error("Invalid SJIS character: "+this.data[n]+"\nMake sure your charset is UTF-8");r-=49472}r=192*(r>>>8&255)+(255&r),e.put(r,13)}},KI=n}var ZF,QF,e$,GI={exports:{}};function Eqe(){return ZF||(ZF=1,e={single_source_shortest_paths:function(t,n,r){var i={},o={};o[n]=0;var s,a,l,c,u,d,h,p=e.PriorityQueue.make();for(p.push(n,0);!p.empty();)for(l in a=(s=p.pop()).value,c=s.cost,u=t[a]||{})u.hasOwnProperty(l)&&(d=c+u[l],h=o[l],(typeof o[l]>"u"||h>d)&&(o[l]=d,p.push(l,d),i[l]=a));if(typeof r<"u"&&typeof o[r]>"u"){var f=["Could not find a path from ",n," to ",r,"."].join("");throw new Error(f)}return i},extract_shortest_path_from_predecessor_list:function(e,t){for(var n=[],r=t;r;)n.push(r),e[r],r=e[r];return n.reverse(),n},find_path:function(t,n,r){var i=e.single_source_shortest_paths(t,n,r);return e.extract_shortest_path_from_predecessor_list(i,r)},PriorityQueue:{make:function(t){var n,r=e.PriorityQueue,i={};for(n in t=t||{},r)r.hasOwnProperty(n)&&(i[n]=r[n]);return i.queue=[],i.sorter=t.sorter||r.default_sorter,i},default_sorter:function(e,t){return e.cost-t.cost},push:function(e,t){var n={value:e,cost:t};this.queue.push(n),this.queue.sort(this.sorter)},pop:function(){return this.queue.shift()},empty:function(){return 0===this.queue.length}}},GI.exports=e),GI.exports;var e}function wqe(){return QF||(QF=1,function(e){const t=ff(),n=yqe(),r=_qe(),i=bqe(),o=Sqe(),s=Fte(),a=df(),l=Eqe();function c(e){return unescape(encodeURIComponent(e)).length}function u(e,t,n){const r=[];let i;for(;null!==(i=e.exec(n));)r.push({data:i[0],index:i.index,mode:t,length:i[0].length});return r}function d(e){const n=u(s.NUMERIC,t.NUMERIC,e),r=u(s.ALPHANUMERIC,t.ALPHANUMERIC,e);let i,o;return a.isKanjiModeEnabled()?(i=u(s.BYTE,t.BYTE,e),o=u(s.KANJI,t.KANJI,e)):(i=u(s.BYTE_KANJI,t.BYTE,e),o=[]),n.concat(r,i,o).sort((function(e,t){return e.index-t.index})).map((function(e){return{data:e.data,mode:e.mode,length:e.length}}))}function h(e,s){switch(s){case t.NUMERIC:return n.getBitsLength(e);case t.ALPHANUMERIC:return r.getBitsLength(e);case t.KANJI:return o.getBitsLength(e);case t.BYTE:return i.getBitsLength(e)}}function p(e,s){let l;const c=t.getBestModeForData(e);if(l=t.from(s,c),l!==t.BYTE&&l.bit<c.bit)throw new Error('"'+e+'" cannot be encoded with mode '+t.toString(l)+".\n Suggested mode is: "+t.toString(c));switch(l===t.KANJI&&!a.isKanjiModeEnabled()&&(l=t.BYTE),l){case t.NUMERIC:return new n(e);case t.ALPHANUMERIC:return new r(e);case t.KANJI:return new o(e);case t.BYTE:return new i(e)}}e.fromArray=function(e){return e.reduce((function(e,t){return"string"==typeof t?e.push(p(t,null)):t.data&&e.push(p(t.data,t.mode)),e}),[])},e.fromString=function(n,r){const i=function(e){const n=[];for(let r=0;r<e.length;r++){const i=e[r];switch(i.mode){case t.NUMERIC:n.push([i,{data:i.data,mode:t.ALPHANUMERIC,length:i.length},{data:i.data,mode:t.BYTE,length:i.length}]);break;case t.ALPHANUMERIC:n.push([i,{data:i.data,mode:t.BYTE,length:i.length}]);break;case t.KANJI:n.push([i,{data:i.data,mode:t.BYTE,length:c(i.data)}]);break;case t.BYTE:n.push([{data:i.data,mode:t.BYTE,length:c(i.data)}])}}return n}(d(n,a.isKanjiModeEnabled())),o=function(e,n){const r={},i={start:{}};let o=["start"];for(let s=0;s<e.length;s++){const a=e[s],l=[];for(let e=0;e<a.length;e++){const c=a[e],u=""+s+e;l.push(u),r[u]={node:c,lastCount:0},i[u]={};for(let e=0;e<o.length;e++){const s=o[e];r[s]&&r[s].node.mode===c.mode?(i[s][u]=h(r[s].lastCount+c.length,c.mode)-h(r[s].lastCount,c.mode),r[s].lastCount+=c.length):(r[s]&&(r[s].lastCount=c.length),i[s][u]=h(c.length,c.mode)+4+t.getCharCountIndicator(c.mode,n))}}o=l}for(let e=0;e<o.length;e++)i[o[e]].end=0;return{map:i,table:r}}(i,r),s=l.find_path(o.map,"start","end"),u=[];for(let e=1;e<s.length-1;e++)u.push(o.table[s[e]].node);return e.fromArray(u.reduce((function(e,t){const n=e.length-1>=0?e[e.length-1]:null;return n&&n.mode===t.mode?(e[e.length-1].data+=t.data,e):(e.push(t),e)}),[]))},e.rawSplit=function(t){return e.fromArray(d(t,a.isKanjiModeEnabled()))}}(HI)),HI}function Cqe(){if(e$)return kI;e$=1;const e=df(),t=lO(),n=lqe(),r=cqe(),i=uqe(),o=dqe(),s=fqe(),a=jte(),l=mqe(),c=gqe(),u=vqe(),d=ff(),h=wqe();function p(e,t,n){const r=e.size,i=u.getEncodedBits(t,n);let o,s;for(o=0;o<15;o++)s=1==(i>>o&1),o<6?e.set(o,8,s,!0):o<8?e.set(o+1,8,s,!0):e.set(r-15+o,8,s,!0),o<8?e.set(8,r-o-1,s,!0):o<9?e.set(8,15-o-1+1,s,!0):e.set(8,15-o-1,s,!0);e.set(r-8,8,1,!0)}function f(t,r,i){const o=new n;i.forEach((function(e){o.put(e.mode.bit,4),o.put(e.getLength(),d.getCharCountIndicator(e.mode,t)),e.write(o)}));const s=8*(e.getSymbolTotalCodewords(t)-a.getTotalCodewordsCount(t,r));for(o.getLengthInBits()+4<=s&&o.put(0,4);o.getLengthInBits()%8!=0;)o.putBit(0);const c=(s-o.getLengthInBits())/8;for(let e=0;e<c;e++)o.put(e%2?17:236,8);return function(t,n,r){const i=e.getSymbolTotalCodewords(n),o=a.getTotalCodewordsCount(n,r),s=i-o,c=a.getBlocksCount(n,r),u=i%c,d=c-u,h=Math.floor(i/c),p=Math.floor(s/c),f=p+1,m=h-p,v=new l(m);let g=0;const y=new Array(c),b=new Array(c);let _=0;const w=new Uint8Array(t.buffer);for(let e=0;e<c;e++){const t=e<d?p:f;y[e]=w.slice(g,g+t),b[e]=v.encode(y[e]),g+=t,_=Math.max(_,t)}const E=new Uint8Array(i);let S,C,k=0;for(S=0;S<_;S++)for(C=0;C<c;C++)S<y[C].length&&(E[k++]=y[C][S]);for(S=0;S<m;S++)for(C=0;C<c;C++)E[k++]=b[C][S];return E}(o,t,r)}function m(t,n,a,l){let u;if(Array.isArray(t))u=h.fromArray(t);else{if("string"!=typeof t)throw new Error("Invalid data");{let e=n;if(!e){const n=h.rawSplit(t);e=c.getBestVersionForData(n,a)}u=h.fromString(t,e||40)}}const d=c.getBestVersionForData(u,a);if(!d)throw new Error("The amount of data is too big to be stored in a QR Code");if(n){if(n<d)throw new Error("\nThe chosen QR Code version cannot contain this amount of data.\nMinimum version required to store current data is: "+d+".\n")}else n=d;const m=f(n,a,u),v=e.getSymbolSize(n),g=new r(v);return function(e,t){const n=e.size,r=o.getPositions(t);for(let t=0;t<r.length;t++){const i=r[t][0],o=r[t][1];for(let t=-1;t<=7;t++)if(!(i+t<=-1||n<=i+t))for(let r=-1;r<=7;r++)o+r<=-1||n<=o+r||(t>=0&&t<=6&&(0===r||6===r)||r>=0&&r<=6&&(0===t||6===t)||t>=2&&t<=4&&r>=2&&r<=4?e.set(i+t,o+r,!0,!0):e.set(i+t,o+r,!1,!0))}}(g,n),function(e){const t=e.size;for(let n=8;n<t-8;n++){const t=n%2==0;e.set(n,6,t,!0),e.set(6,n,t,!0)}}(g),function(e,t){const n=i.getPositions(t);for(let t=0;t<n.length;t++){const r=n[t][0],i=n[t][1];for(let t=-2;t<=2;t++)for(let n=-2;n<=2;n++)-2===t||2===t||-2===n||2===n||0===t&&0===n?e.set(r+t,i+n,!0,!0):e.set(r+t,i+n,!1,!0)}}(g,n),p(g,a,0),n>=7&&function(e,t){const n=e.size,r=c.getEncodedBits(t);let i,o,s;for(let t=0;t<18;t++)i=Math.floor(t/3),o=t%3+n-8-3,s=1==(r>>t&1),e.set(i,o,s,!0),e.set(o,i,s,!0)}(g,n),function(e,t){const n=e.size;let r=-1,i=n-1,o=7,s=0;for(let a=n-1;a>0;a-=2)for(6===a&&a--;;){for(let n=0;n<2;n++)if(!e.isReserved(i,a-n)){let r=!1;s<t.length&&(r=1==(t[s]>>>o&1)),e.set(i,a-n,r),o--,-1===o&&(s++,o=7)}if(i+=r,i<0||n<=i){i-=r,r=-r;break}}}(g,m),isNaN(l)&&(l=s.getBestMask(g,p.bind(null,g,a))),s.applyMask(l,g),p(g,a,l),{modules:g,version:n,errorCorrectionLevel:a,maskPattern:l,segments:u}}return kI.create=function(n,r){if(typeof n>"u"||""===n)throw new Error("No input text");let i,o,a=t.M;return typeof r<"u"&&(a=t.from(r.errorCorrectionLevel,t.M),i=c.from(r.version),o=s.from(r.maskPattern),r.toSJISFunc&&e.setToSJISFunction(r.toSJISFunc)),m(n,i,a,o)},kI}var t$,n$,WI={},zI={};function $te(){return t$||(t$=1,function(e){function t(e){if("number"==typeof e&&(e=e.toString()),"string"!=typeof e)throw new Error("Color should be defined as hex string");let t=e.slice().replace("#","").split("");if(t.length<3||5===t.length||t.length>8)throw new Error("Invalid hex color: "+e);(3===t.length||4===t.length)&&(t=Array.prototype.concat.apply([],t.map((function(e){return[e,e]})))),6===t.length&&t.push("F","F");const n=parseInt(t.join(""),16);return{r:n>>24&255,g:n>>16&255,b:n>>8&255,a:255&n,hex:"#"+t.slice(0,6).join("")}}e.getOptions=function(e){e||(e={}),e.color||(e.color={});const n=typeof e.margin>"u"||null===e.margin||e.margin<0?4:e.margin,r=e.width&&e.width>=21?e.width:void 0,i=e.scale||4;return{width:r,scale:r?4:i,margin:n,color:{dark:t(e.color.dark||"#000000ff"),light:t(e.color.light||"#ffffffff")},type:e.type,rendererOpts:e.rendererOpts||{}}},e.getScale=function(e,t){return t.width&&t.width>=e+2*t.margin?t.width/(e+2*t.margin):t.scale},e.getImageWidth=function(t,n){const r=e.getScale(t,n);return Math.floor((t+2*n.margin)*r)},e.qrToImageData=function(t,n,r){const i=n.modules.size,o=n.modules.data,s=e.getScale(i,r),a=Math.floor((i+2*r.margin)*s),l=r.margin*s,c=[r.color.light,r.color.dark];for(let e=0;e<a;e++)for(let n=0;n<a;n++){let u=4*(e*a+n),d=r.color.light;if(e>=l&&n>=l&&e<a-l&&n<a-l){d=c[o[Math.floor((e-l)/s)*i+Math.floor((n-l)/s)]?1:0]}t[u++]=d.r,t[u++]=d.g,t[u++]=d.b,t[u]=d.a}}}(zI)),zI}function Tqe(){return n$||(n$=1,function(e){const t=$te();e.render=function(e,n,r){let i=r,o=n;typeof i>"u"&&(!n||!n.getContext)&&(i=n,n=void 0),n||(o=function(){try{return document.createElement("canvas")}catch{throw new Error("You need to specify a canvas element")}}()),i=t.getOptions(i);const s=t.getImageWidth(e.modules.size,i),a=o.getContext("2d"),l=a.createImageData(s,s);return t.qrToImageData(l.data,e,i),function(e,t,n){e.clearRect(0,0,t.width,t.height),t.style||(t.style={}),t.height=n,t.width=n,t.style.height=n+"px",t.style.width=n+"px"}(a,o,s),a.putImageData(l,0,0),o},e.renderToDataURL=function(t,n,r){let i=r;typeof i>"u"&&(!n||!n.getContext)&&(i=n,n=void 0),i||(i={});const o=e.render(t,n,i),s=i.type||"image/png",a=i.rendererOpts||{};return o.toDataURL(s,a.quality)}}(WI)),WI}var r$,i$,YI={};function Rqe(){if(r$)return YI;r$=1;const e=$te();function t(e,t){const n=e.a/255,r=t+'="'+e.hex+'"';return n<1?r+" "+t+'-opacity="'+n.toFixed(2).slice(1)+'"':r}function n(e,t,n){let r=e+t;return typeof n<"u"&&(r+=" "+n),r}return YI.render=function(r,i,o){const s=e.getOptions(i),a=r.modules.size,l=r.modules.data,c=a+2*s.margin,u=s.color.light.a?"<path "+t(s.color.light,"fill")+' d="M0 0h'+c+"v"+c+'H0z"/>':"",d="<path "+t(s.color.dark,"stroke")+' d="'+function(e,t,r){let i="",o=0,s=!1,a=0;for(let l=0;l<e.length;l++){const c=Math.floor(l%t),u=Math.floor(l/t);!c&&!s&&(s=!0),e[l]?(a++,l>0&&c>0&&e[l-1]||(i+=s?n("M",c+r,.5+u+r):n("m",o,0),o=0,s=!1),c+1<t&&e[l+1]||(i+=n("h",a),a=0)):o++}return i}(l,a,s.margin)+'"/>',h='viewBox="0 0 '+c+" "+c+'"',p='<svg xmlns="http://www.w3.org/2000/svg" '+(s.width?'width="'+s.width+'" height="'+s.width+'" ':"")+h+' shape-rendering="crispEdges">'+u+d+"</svg>\n";return"function"==typeof o&&o(null,p),p},YI}function Iqe(){if(i$)return lh;i$=1;const e=aqe(),t=Cqe(),n=Tqe(),r=Rqe();function i(n,r,i,o,s){const a=[].slice.call(arguments,1),l=a.length,c="function"==typeof a[l-1];if(!c&&!e())throw new Error("Callback required as last argument");if(!c){if(l<1)throw new Error("Too few arguments provided");return 1===l?(i=r,r=o=void 0):2===l&&!r.getContext&&(o=i,i=r,r=void 0),new Promise((function(e,s){try{const s=t.create(i,o);e(n(s,r,o))}catch(e){s(e)}}))}if(l<2)throw new Error("Too few arguments provided");2===l?(s=i,i=r,r=o=void 0):3===l&&(r.getContext&&typeof s>"u"?(s=o,o=void 0):(s=o,o=i,i=r,r=void 0));try{const e=t.create(i,o);s(null,n(e,r,o))}catch(e){s(e)}}return lh.create=t.create,lh.toCanvas=i.bind(null,n.render),lh.toDataURL=i.bind(null,n.renderToDataURL),lh.toString=i.bind(null,(function(e,t,n){return r.render(e,n)})),lh}var kqe=Iqe();const xqe="_qrCode_h54ia_8",Pqe={qrCode:xqe},Lqe=({data:e,className:t})=>{const[n,r]=_.useState(null);return _.useEffect((()=>{let t=!1;return kqe.toDataURL(e,{errorCorrectionLevel:"L"}).then((e=>{t||r(e)})).catch((e=>{t||r(null)})),()=>{t=!0}}),[e]),E.jsx("div",{className:Ae(Pqe.qrCode,t),children:n&&E.jsx("img",{src:n,alt:qo("qr_code")})})},Oqe=({room:e,open:t,onDismiss:n})=>{const{t:r}=ze(),i=Jy(e.roomId),o=_.useMemo((()=>NQ(e.roomId,i,e.name)),[i,e.name,e.roomId]),[,s]=eqe(o),[a,l]=_.useState(!1),c=_.useCallback((()=>l(!1)),[l]),u=_.useCallback((e=>{e.stopPropagation(),s(),n(),l(!0)}),[s,n]);return E.jsxs(E.Fragment,{children:[E.jsxs(lf,{title:r("invite_modal.title"),open:t,onDismiss:n,children:[E.jsx(Lqe,{className:RI.qrCode,data:o}),E.jsx(Jt,{className:RI.url,size:"sm",weight:"semibold",children:o}),E.jsx(At,{className:RI.button,Icon:W2e,onClick:u,"data-testid":"modal_inviteLink",children:r("action.copy_link")})]}),E.jsx(oqe,{open:a,onDismiss:c,autoDismiss:2e3,Icon:jY,children:r("invite_modal.link_copied_toast")})]})},Mqe=({error:e,recoveryActionHandler:t,widget:n})=>{const{t:r}=ze();let i;switch(e.category){case jb.CONFIGURATION_ISSUE:i=G2e;break;case jb.NETWORK_CONNECTIVITY:i=X2e;break;case jb.CLIENT_CONFIGURATION:i=dRe;break;default:i=aw}const o=[];return e instanceof dte&&o.push({label:r("call_ended_view.reconnect_button"),onClick:()=>t("reconnect")}),E.jsx(Qh,{children:E.jsxs(cy,{Icon:i,title:e.localisedTitle,rageshake:e.code==rO.UNKNOWN_ERROR,widget:n,children:[E.jsx("p",{children:e.localisedMessage??E.jsx(Zi,{i18nKey:"error.unexpected_ec_error",components:[E.jsx("b",{}),E.jsx("code",{})],values:{errorCode:e.code}})}),o&&o.map(((e,t)=>E.jsx("button",{onClick:e.onClick,children:e.label},`action${t}`)))]})})},Aqe=({recoveryActionHandler:e,onError:t,children:n,widget:r})=>{const i=_.useCallback((({error:t,resetError:n})=>{const i=t instanceof Fa?t:new iO(t instanceof Error?t:new Error);return E.jsx(Mqe,{widget:r??null,error:i,resetError:n,recoveryActionHandler:t=>{n(),e(t)}})}),[e,r]);return E.jsx(ow,{fallback:i,onError:e=>null==t?void 0:t(e),children:n})},Nqe=({client:e,isPasswordlessUser:t,confineToRoom:n,preload:r,skipLobby:i,hideHeader:o,rtcSession:s,isJoined:a,muteStates:l,widget:c})=>{const[u,d]=_.useState(null),h=iQ(s),p=Ll(aO({sounds:Nte,latencyHint:"interactive"}));_.useEffect((()=>{var e,t;h.length>=8&&(null==(t=(e=l.audio).setEnabled)||t.call(e,!1))}),[]),_.useEffect((()=>(window.rtcSession=s,()=>{delete window.rtcSession})),[s]),Ew(s,ar.MembershipManagerError,(e=>{d(new rHe(rO.MEMBERSHIP_MANAGER_UNRECOVERABLE,e.message??e))})),_.useEffect((()=>{e.getRoom(s.room.roomId)!==s.room&&A.warn(`We've ended up with multiple rooms for the same ID (${s.room.roomId}). This indicates a bug in the group call loading code, and may lead to incomplete room state.`)}),[e,s.room]);const f=s.room,{displayName:m,avatarUrl:v}=Yy(e),g=zVe(f),y=WVe(f),{perParticipantE2EE:b,returnToLobby:w}=Lu(),S=Jy(f.roomId),[C]=qn(JZ),[k]=qn(C4);Zy(g);const T=_.useMemo((()=>({userId:e.getUserId(),displayName:m,avatarUrl:v,roomId:f.roomId,roomName:g,roomAlias:f.getCanonicalAlias(),roomAvatar:y,e2eeSystem:S})),[e,m,v,g,f,y,S]),I=_.useMemo((()=>new Set(h.map((e=>e.sender))).size),[h]),R=Ll(uf()),x=Ll(l),L=_.useCallback((async e=>{try{await KVe(e,b,C,k)}catch(e){if(e instanceof Fa)d(e);else{A.error("Unknown Error while entering RTC session",e);const t=new iO(e instanceof Error?e:new Error("Unknown error",{cause:e}));d(t)}}}),[b,k,C]);_.useEffect((()=>{if(i)if(c){if(r){const e=e=>{(async()=>{await(async({audioInput:e,videoInput:t})=>{var n,r,i,o;const s=await Al.getLocalDevices(void 0,!0);if(e){const t=_U(e,"audioinput",s);t?(A.debug(`Found audio input ID ${t} for name ${e}`),R.current.audioInput.select(t)):(A.warn("Unknown audio input: "+e),null==(r=(n=x.current.audio).setEnabled)||r.call(n,!1))}if(t){const e=_U(t,"videoinput",s);e?(A.debug(`Found video input ID ${e} for name ${t}`),R.current.videoInput.select(e)):(A.warn("Unknown video input: "+t),null==(o=(i=x.current.video).setEnabled)||o.call(i,!1))}})(e.detail.data),await L(s),c.api.transport.reply(e.detail,{})})().catch((e=>{A.error("Error joining RTC session",e)}))};return c.lazyActions.on(Ar.JoinCall,e),()=>{c.lazyActions.off(Ar.JoinCall,e)}}(async()=>{await L(s)})().catch((e=>{A.error("Error joining RTC session",e)}))}else L(s)}),[c,s,r,i,b,R,x,L,C]);const[P,O]=_.useState(!1),M=Aa(),N=_.useCallback(((e="user")=>{var r;const i=null==(r=p.current)?void 0:r.playSound("left"),o=!!c;O(!0);const a=new Promise((e=>{Et.instance.eventCallEnded.track(f.roomId,s.memberships.length,o,s),window.setTimeout(e,10)}));kF(s,e,Promise.all([i,a])).then((async()=>{!t&&!n&&!Et.instance.isEnabled()&&await M("/")})).catch((e=>{A.error("Error leaving RTC session",e)}))}),[p,c,s,f.roomId,t,n,M]);_.useEffect((()=>{if(c&&a){c.api.setAlwaysOnScreen(!0).catch((e=>{A.error("Error calling setAlwaysOnScreen(true)",e)}));const e=e=>{c.api.transport.reply(e.detail,{}),kF(s,"user").catch((e=>{A.error("Failed to leave RTC session",e)}))};return c.lazyActions.once(Ar.HangupCall,e),()=>{c.lazyActions.off(Ar.HangupCall,e)}}}),[c,a,s]);const D=YVe(f),[j,U]=_.useState(!1),F=_.useCallback((()=>U(!1)),[U]),H=_.useCallback((()=>U(!0)),[U]),B=D===Jc.Public?H:null;if(!NV()&&S.kind!==Ut.NONE)throw new iHe;const $=E.jsx(Oqe,{room:f,open:j,onDismiss:F}),V=E.jsxs(E.Fragment,{children:[$,E.jsx(See,{client:e,matrixInfo:T,muteStates:l,onEnter:()=>{L(s)},confineToRoom:n,hideHeader:o,participantCount:I,onShareClick:B})]});let q;if(u){const e=()=>{throw u};q=E.jsx(e,{})}else q=a?E.jsxs(E.Fragment,{children:[$,E.jsx(jVe,{client:e,matrixInfo:T,rtcSession:s,participantCount:I,onLeave:N,hideHeader:o,muteStates:l,e2eeSystem:S,onShareClick:B})]}):P&&null===c?t||Et.instance.isEnabled()&&null===c?E.jsx(MUe,{endedCallId:s.room.roomId,client:e,isPasswordlessUser:t,confineToRoom:n}):null:P&&null!==c?w?V:null:r||i?null:V;return E.jsx(Aqe,{widget:c,recoveryActionHandler:e=>{"reconnect"==e&&(O(!1),L(s).catch((e=>{A.error("Error re-entering RTC session",e)})))},onError:()=>{s.isJoined()&&N("error")},children:q})},Dqe="_modal_1tnec_8",jqe={modal:Dqe},Uqe=({roomId:e})=>{const{t}=ze(),[n,r]=_.useState(!0),i=_.useCallback((e=>{e.preventDefault(),e.stopPropagation(),r(!1)}),[r]),o=Jy(e);o.kind===Ut.NONE&&A.error("Generating app redirect URL for encrypted room but don't have key available!");const s=_.useMemo((()=>{const t=new URL(null===e?window.location.href:NQ(e,o));t.hash=E3e(t.hash,(e=>(e.set("appPrompt","false"),e.set("confineToRoom","true"),e)));const n=new URL("io.element.call:/");return n.searchParams.set("url",t.toString()),n.toString()}),[o,e]);return E.jsxs(lf,{className:jqe.modal,title:t("app_selection_modal.title"),open:n,children:[E.jsx(Jt,{size:"md",weight:"semibold",children:t("app_selection_modal.text")}),E.jsx(At,{kind:"secondary",onClick:i,children:t("app_selection_modal.continue_in_browser")}),E.jsx(At,{as:"a",href:s,Icon:mJ,children:t("app_selection_modal.open_in_app")})]})},Fqe=3,$qe=3e3;async function Hte(e,t=0,...n){try{return await e.joinRoom(...n)}catch(r){if(r instanceof bn&&"M_FORBIDDEN"===r.errcode&&t<3)return await new Promise((e=>setTimeout(e,$qe))),Hte(e,t+1,...n);throw r}}class $b extends Error{constructor(e,t,n,r){super(t),this.icon=e,this.messageBody=n,this.reason=r}}const Hqe=(e,t,n)=>{const[r,i]=_.useState({kind:"loading"}),o=_.useRef(void 0),{t:s}=ze(),a=_.useCallback((()=>new $b(H2e,s("group_call_loader.banned_heading"),s("group_call_loader.banned_body"),u())),[s]),l=_.useCallback((()=>new $b(lw,s("group_call_loader.knock_reject_heading"),s("group_call_loader.knock_reject_body"),u())),[s]),c=_.useCallback((()=>new $b(eJ,s("group_call_loader.call_ended_heading"),s("group_call_loader.call_ended_body"),u())),[s]),u=()=>{var e,t,n;return null==(n=null==(t=o.current)?void 0:t.currentState.getStateEvents(ee.RoomMember,null==(e=o.current)?void 0:e.myUserId))?void 0:n.getContent().reason};return _.useEffect((()=>{if(!e||!t)return;const s=async()=>{let r=null;if("#"===t[0])r=await(async t=>{let n=null;const r=await e.getRoomIdForAlias(t.toLowerCase());return A.info(`${t} resolved to ${r.room_id}`),n=e.getRoom(r.room_id),n?A.info(`Already in room ${r.room_id}, not rejoining.`):(A.info(`Room ${r.room_id} not found, joining.`),n=await e.joinRoom(r.room_id,{viaServers:r.servers})),n})(t),o.current=r;else{const s=t;r=e.getRoom(s),o.current=r??void 0;const c=null==r?void 0:r.getMyMembership();if(c===Ke.Join)return r;if(Ge)throw new Error("Room not found. The widget-api did not pass over the relevant room events/information.");if(c===Ke.Ban)throw a();if(c===Ke.Invite)r=await e.joinRoom(s,{viaServers:n});else{let t;try{t=await e.getRoomSummary(s,n)}catch(e){A.warn("Could not load room summary to decide whether we want to join or knock.\n              EC will fallback to join as if this would be a public room.\n              Reach out to your homeserver admin to ask them about supporting the `/summary` endpoint (im.nheko.summary):",e)}if(void 0===t||t.join_rule===Jc.Public)r=await e.joinRoom(s,{viaServers:n});else{if(t.join_rule!==Jc.Knock)throw new Error(`Room ${t.room_id} is not joinable. This likely means, that the conference owner has changed the room settings to private.`);{const s=t;let c=()=>{};const u=new Promise((e=>{s.membership!==Ke.Knock?c=e:e()}));i({kind:"canKnock",roomSummary:s,knock:c}),await u,r=await(async(t,n,r)=>(await e.knockRoom(t,{viaServers:n}),r(),await new Promise(((r,i)=>{e.on(ke.MyMembership,((s,c,u)=>{t===s.roomId&&(o.current=s,c===Ke.Invite&&u===Ke.Knock&&Hte(e,0,s.roomId,{viaServers:n}).then((e=>{A.log("Auto-joined %s",e.roomId),r(e)}),i),c===Ke.Ban&&i(a()),c===Ke.Leave&&i(l()))}))}))))(t.room_id,n,(()=>i({kind:"waitForInvite",roomSummary:s})))}}}}return A.info(`Joined ${t}, waiting room to be ready for group calls`),await e.waitUntilRoomReadyForGroupCalls(r.roomId),A.info(`${t}, is ready for group calls`),r};"loading"===r.kind&&(A.log("Start loading group call"),(async()=>{e.getSyncState()!==Dt.Syncing&&(A.debug("useLoadGroupCall: waiting for client to start syncing..."),await new Promise((t=>{const n=()=>{if(e.getSyncState()===Dt.Syncing)return e.off(Oe.Sync,n),t()};e.on(Oe.Sync,n)})),A.debug("useLoadGroupCall: client is now syncing."))})().then((async()=>{const n=await s();return o.current=n,A.debug(`Fetched / joined room ${t}`),e.matrixRTC.getRoomSession(n)})).then((e=>i({kind:"loaded",rtcSession:e}))).then((async()=>{await new Promise(((t,n)=>{e.on(ke.MyMembership,((e,t)=>{t===Ke.Leave&&n(c()),t===Ke.Ban&&n(a())}))}))})).catch((e=>i({kind:"failed",error:e}))))}),[a,e,l,c,t,r,s,n]),r};function Bqe(e){const[,t]=_.useState(0);return _.useEffect((()=>{if(void 0!==e){const n=n=>{A.info(`Session in room ${e.room.roomId} changed to ${n?"joined":"left"}`),t((e=>e+1))};return e.on(ar.JoinStateChanged,n),()=>{e.off(ar.JoinStateChanged,n)}}}),[e]),(null==e?void 0:e.isJoined())??!1}const Vqe=()=>{const{confineToRoom:e,appPrompt:t,preload:n,hideHeader:r,displayName:i,skipLobby:o}=Lu(),{t:s}=ze(),{roomAlias:a,roomId:l,viaServers:c}=C3e(),u=l??a;u||A.error("No room specified");const{registerPasswordlessUser:d}=$Q(),[h,p]=_.useState(!1),{loading:f,authenticated:m,client:v,error:g,passwordlessUser:y}=k4(),{avatarUrl:b,displayName:w}=Yy(v),S=Hqe(v,u,c),C=Bqe("loaded"===S.kind?S.rtcSession:void 0),k=HVe(C);_.useEffect((()=>{!f&&!m&&i&&!Ge&&(p(!0),d(i).catch((e=>{A.error("Failed to register passwordless user",e)})).finally((()=>{p(!1)})))}),[f,m,i,p,d]);const[T,I]=Nw();_.useEffect((()=>{null===T&&I&&I(!0)}),[T,I]);const R=_.useRef(!1);_.useEffect((()=>{"loaded"===S.kind&&R.current&&A.log("Play join sound 'Not yet implemented'")}),[S.kind]);let x;return x=f||h?E.jsx(Fw,{}):g?E.jsx(uy,{widget:Ge,error:g}):v?u?(()=>{switch(S.kind){case"loaded":return E.jsx(Nqe,{widget:Ge,client:v,rtcSession:S.rtcSession,isJoined:C,isPasswordlessUser:y,confineToRoom:e,preload:n,skipLobby:o||R.current,hideHeader:r,muteStates:k});case"waitForInvite":case"canKnock":{R.current=R.current||"waitForInvite"===S.kind;const t="canKnock"===S.kind?S.knock:null,n="canKnock"===S.kind?s("lobby.ask_to_join"):E.jsxs(E.Fragment,{children:[s("lobby.waiting_for_invite"),E.jsx(jY,{})]});return E.jsx(See,{client:v,matrixInfo:{userId:v.getUserId()??"",displayName:w??"",avatarUrl:b??"",roomAlias:null,roomId:S.roomSummary.room_id,roomName:S.roomSummary.name??"",roomAvatar:S.roomSummary.avatar_url??null,e2eeSystem:{kind:S.roomSummary["im.nheko.summary.encryption"]?Ut.PER_PARTICIPANT:Ut.NONE}},onEnter:()=>null==t?void 0:t(),enterLabel:n,waitingForInvite:"waitForInvite"===S.kind,confineToRoom:e,hideHeader:r,participantCount:null,muteStates:k,onShareClick:null})}case"loading":return E.jsx(Qh,{children:E.jsx("h1",{children:s("common.loading")})});case"failed":return R.current=!1,"M_NOT_FOUND"===S.error.errcode?E.jsx(Qh,{children:E.jsx(cy,{Icon:sRe,title:s("error.call_not_found"),widget:Ge,children:E.jsx(Zi,{i18nKey:"error.call_not_found_description",children:E.jsxs("p",{children:["That link doesn't appear to belong to any existing call. Check that you have the right link, or"," ",E.jsx(Ia,{to:"/",children:"create a new one"}),"."]})})})}):S.error instanceof $b?E.jsx(Qh,{children:E.jsxs(cy,{Icon:S.error.icon,title:S.error.message,widget:Ge,children:[E.jsx("p",{children:S.error.messageBody}),S.error.reason&&E.jsx("p",{children:s("group_call_loader.reason",{reason:S.error.reason})})]})}):E.jsx(uy,{widget:Ge,error:S.error});default:return E.jsx(E.Fragment,{children:" "})}})():E.jsx(UQ,{}):E.jsx(Q7e,{}),E.jsxs(E.Fragment,{children:[x,t&&Bt.get().app_prompt&&("android"===Od||"ios"===Od)&&l&&E.jsx(Uqe,{roomId:l})]})},qqe="_banner_sye6n_8",Kqe={banner:qqe},Gqe=({children:e,className:t,...n})=>{const{t:r}=ze(),i=nm();let o=!1;return"valid"===(null==i?void 0:i.state)&&(o=i.disconnected),E.jsx(E.Fragment,{children:o&&E.jsxs("div",{className:Ae(Kqe.banner,t),...n,children:[e,r("disconnected_banner")]})})},Wqe="data:application/json;base64,ewogICJhMTF5IjogewogICAgInVzZXJfbWVudSI6ICLQn9C+0YLRgNC10LHQuNGC0LXQu9GB0LrQviDQvNC10L3RjiIKICB9LAogICJhY3Rpb24iOiB7CiAgICAiY2xvc2UiOiAi0JfQsNGC0LLQvtGA0LgiLAogICAgImNvcHlfbGluayI6ICLQmtC+0L/QuNGA0LDQvdC1INC90LAg0LLRgNGK0LfQutCw0YLQsCIsCiAgICAiZ28iOiAi0J3QsNC/0YDQtdC0IiwKICAgICJpbnZpdGUiOiAi0J/QvtC60LDQvdCwIiwKICAgICJubyI6ICLQndC1IiwKICAgICJyZWdpc3RlciI6ICLQoNC10LPQuNGB0YLRgNCw0YbQuNGPIiwKICAgICJyZW1vdmUiOiAi0J/RgNC10LzQsNGF0L3QuCIsCiAgICAic2lnbl9pbiI6ICLQktC70LXQtyIsCiAgICAic2lnbl9vdXQiOiAi0JjQt9C70LXQtyIKICB9LAogICJjYWxsX2VuZGVkX3ZpZXciOiB7CiAgICAiY3JlYXRlX2FjY291bnRfYnV0dG9uIjogItCh0YrQt9C00LDQuSDQsNC60LDRg9C90YIiLAogICAgImNyZWF0ZV9hY2NvdW50X3Byb21wdCI6ICI8MD7Ql9Cw0YnQviDQvdC1INC90LDRgdGC0YDQvtC50YLQtSDQv9Cw0YDQvtC70LAg0LfQsCDQtNCwINC30LDQv9Cw0LfQuNGC0LUg0LDQutCw0YPQvdGC0LAg0YHQuD88LzA+PDE+0KnQtSDQvNC+0LbQtdGC0LUg0LTQsCDQt9Cw0L/QsNC30LjRgtC1INC40LzQtdGC0L4g0Lgg0LDQstCw0YLQsNGA0LAg0YHQuCDQt9CwINCx0YrQtNC10YnQuCDRgNCw0LfQs9C+0LLQvtGA0Lg8LzE+IiwKICAgICJub3Rfbm93X2J1dHRvbiI6ICLQndC1INGB0LXQs9CwLCDQstGK0YDQvdC4INGB0LUg0L3QsCDQvdCw0YfQsNC70L3QuNGPINC10LrRgNCw0L0iCiAgfSwKICAiY29tbW9uIjogewogICAgImF1ZGlvIjogItCX0LLRg9C6IiwKICAgICJhdmF0YXIiOiAi0JDQstCw0YLQsNGAIiwKICAgICJkaXNwbGF5X25hbWUiOiAi0JjQvNC1L9C/0YHQtdCy0LTQvtC90LjQvCIsCiAgICAiaG9tZSI6ICLQndCw0YfQsNC70L4iLAogICAgImxvYWRpbmciOiAi0JfQsNGA0LXQttC00LDQvdC14oCmIiwKICAgICJwYXNzd29yZCI6ICLQn9Cw0YDQvtC70LAiLAogICAgInByb2ZpbGUiOiAi0J/RgNC+0YTQuNC7IiwKICAgICJzZXR0aW5ncyI6ICLQndCw0YHRgtGA0L7QudC60LgiLAogICAgInVzZXJuYW1lIjogItCf0L7RgtGA0LXQsdC40YLQtdC70YHQutC+INC40LzQtSIsCiAgICAidmlkZW8iOiAi0JLQuNC00LXQviIKICB9LAogICJqb2luX2V4aXN0aW5nX2NhbGxfbW9kYWwiOiB7CiAgICAiam9pbl9idXR0b24iOiAi0JTQsCwg0L/RgNC40YHRitC10LTQuNC90Lgg0YHQtSIsCiAgICAidGV4dCI6ICLQotC+0LfQuCDRgNCw0LfQs9C+0LLQvtGAINCy0LXRh9C1INGB0YrRidC10YHRgtCy0YPQstCwLCDQuNGB0LrQsNGC0LUg0LvQuCDQtNCwINGB0LUg0L/RgNC40YHRitC10LTQuNC90LjRgtC1PyIsCiAgICAidGl0bGUiOiAi0J/RgNC40YHRitC10LTQuNC90Y/QstCw0L3QtSDQutGK0Lwg0YHRitGJ0LXRgdGC0LLRg9Cy0LDRiSDRgNCw0LfQs9C+0LLQvtGAPyIKICB9LAogICJsYXlvdXRfc3BvdGxpZ2h0X2xhYmVsIjogItCf0YDQvtC20LXQutGC0L7RgCIsCiAgImxvYmJ5IjogewogICAgImpvaW5fYnV0dG9uIjogItCS0LvQtdC3INCyINGA0LDQt9Cz0L7QstC+0YDQsCIKICB9LAogICJsb2dnaW5nX2luIjogItCS0LvQuNC30LDQvdC14oCmIiwKICAibG9naW5fYXV0aF9saW5rcyI6ICI8MD7QodGK0LfQtNCw0LnRgtC1INCw0LrQsNGD0L3RgjwvMD4g0LjQu9C4IDwyPtCS0LvQtdC30YLQtSDQutCw0YLQviDQs9C+0YHRgjwvMj4iLAogICJsb2dpbl90aXRsZSI6ICLQktC70LXQtyIsCiAgInJhZ2VzaGFrZV9yZXF1ZXN0X21vZGFsIjogewogICAgImJvZHkiOiAi0JTRgNGD0LMg0L/QvtGC0YDQtdCx0LjRgtC10Lsg0LIg0YLQvtC30Lgg0YDQsNC30LPQvtCy0L7RgCDQuNC80LAg0L/RgNC+0LHQu9C10LwuINCX0LAg0LTQsCDQtNC40LDQs9C90L7RgdGC0LjRhtC40YDQsNC80LUg0YLQvtC30Lgg0L/RgNC+0LHQu9C10Lwg0L/Qvi3QtNC+0LHRgNC1INC90Lgg0YHQtSDQuNGB0LrQsCDQtNCwINGB0YrQsdC10YDQtdC8IGRlYnVnINC70L7Qs9C+0LLQtS4iLAogICAgInRpdGxlIjogItCX0LDRj9Cy0LrQsCDQt9CwIGRlYnVnINC70L7Qs9C+0LLQtSIKICB9LAogICJyYWdlc2hha2Vfc2VuZF9sb2dzIjogItCY0LfQv9GA0LDRgtC10YLQtSBkZWJ1ZyDQu9C+0LPQvtCy0LUiLAogICJyYWdlc2hha2Vfc2VuZGluZyI6ICLQmNC30L/RgNCw0YnQsNC90LXigKYiLAogICJyZWNhcHRjaGFfZGlzbWlzc2VkIjogIlJlY2FwdGNoYSDQvtGC0YXQstGK0YDQu9C10L3QsCIsCiAgInJlY2FwdGNoYV9ub3RfbG9hZGVkIjogIlJlY2FwdGNoYSDQvdC1INC1INC30LDRgNC10LTQtdC90LAiLAogICJyZWdpc3RlciI6IHsKICAgICJwYXNzd29yZHNfbXVzdF9tYXRjaCI6ICLQn9Cw0YDQvtC70LjRgtC1INC90LUg0YHRitCy0L/QsNC00LDRgiIsCiAgICAicmVnaXN0ZXJpbmciOiAi0KDQtdCz0LjRgdGC0YDQuNGA0LDQvdC14oCmIgogIH0sCiAgInJlZ2lzdGVyX2F1dGhfbGlua3MiOiAiPDA+0JLQtdGH0LUg0LjQvNCw0YLQtSDQsNC60LDRg9C90YI/PC8wPjwxPjwwPtCS0LvQtdC30YLQtSDRgSDQvdC10LPQvjwvMD4g0LjQu9C4IDwyPtCS0LvQtdC30YLQtSDQutCw0YLQviDQs9C+0YHRgjwvMj48LzE+IiwKICAicmVnaXN0ZXJfY29uZmlybV9wYXNzd29yZF9sYWJlbCI6ICLQn9C+0YLQstGK0YDQtNC4INC/0LDRgNC+0LvQsNGC0LAiLAogICJyZXR1cm5faG9tZV9idXR0b24iOiAi0JLRgNGK0YnQsNC90LUg0L3QsCDQvdCw0YfQsNC70L3QuNGPINC10LrRgNCw0L0iLAogICJzY3JlZW5zaGFyZV9idXR0b25fbGFiZWwiOiAi0KHQv9C+0LTQtdC70Lgg0LXQutGA0LDQvdCwIiwKICAic2V0dGluZ3MiOiB7CiAgICAiZGV2ZWxvcGVyX3RhYl90aXRsZSI6ICLQoNCw0LfRgNCw0LHQvtGC0YfQuNC6IiwKICAgICJmZWVkYmFja190YWJfaDQiOiAi0JjQt9C/0YDQsNGC0Lgg0L7QsdGA0LDRgtC90LAg0LLRgNGK0LfQutCwIiwKICAgICJmZWVkYmFja190YWJfc2VuZF9sb2dzX2xhYmVsIjogItCS0LrQu9GO0YfQuCBkZWJ1ZyDQu9C+0LPQvtCy0LUiCiAgfSwKICAidW5hdXRoZW50aWNhdGVkX3ZpZXdfYm9keSI6ICLQktGB0LUg0L7RidC1INC90LUg0YHRgtC1INGA0LXQs9C40YHRgtGA0LjRgNCw0L3QuD8gPDI+0KHRitC30LTQsNC50YLQtSDQsNC60LDRg9C90YI8LzI+IiwKICAidW5hdXRoZW50aWNhdGVkX3ZpZXdfbG9naW5fYnV0dG9uIjogItCS0LvQtdC30YLQtSDQsiDQsNC60LDRg9C90YLQsCDRgdC4IiwKICAidmVyc2lvbiI6ICLQktC10YDRgdC40Y86IHt7dmVyc2lvbn19Igp9Cg==",zqe=""+new URL("cs-app-BIDxiN50.json",import.meta.url).href,Yqe=""+new URL("de-app-Dn3BQmuZ.json",import.meta.url).href,Jqe=""+new URL("el-app-Bgiig2Nz.json",import.meta.url).href,Xqe=""+new URL("en-app-LL1Igtxp.json",import.meta.url).href,Zqe=""+new URL("es-app-Q3c7lmEj.json",import.meta.url).href,Qqe=""+new URL("et-app-DPt7J6kw.json",import.meta.url).href,eKe="data:application/json;base64,ewogICJhMTF5IjogewogICAgInVzZXJfbWVudSI6ICLZgdmH2LHYs9iqINqp2KfYsdio2LEiCiAgfSwKICAiYWN0aW9uIjogewogICAgImNsb3NlIjogItio2LPYqtmGIiwKICAgICJnbyI6ICLYsdmB2KrZhiIsCiAgICAibm8iOiAi2K7bjNixIiwKICAgICJyZWdpc3RlciI6ICLYq9io2KrigIzZhtin2YUiLAogICAgInJlbW92ZSI6ICLYrdiw2YEiLAogICAgInNpZ25faW4iOiAi2YjYsdmI2K8iLAogICAgInNpZ25fb3V0IjogItiu2LHZiNisIgogIH0sCiAgImNhbGxfZW5kZWRfdmlldyI6IHsKICAgICJjcmVhdGVfYWNjb3VudF9idXR0b24iOiAi2LPYp9iu2Kog2K3Ys9in2Kgg2qnYp9ix2KjYsduMIiwKICAgICJjcmVhdGVfYWNjb3VudF9wcm9tcHQiOiAiPDA+2obYsdinINuM2qkg2LHZhdiyINi52KjZiNixINio2LHYp9uMINit2LPYp9ioINqp2KfYsdio2LHbjCDYrtmI2K8g2KrZhti424zZhSDZhtmF24zigIzaqdmG24zYr9ifPC8wPjwxPti02YXYpyDZhduM4oCM2KrZiNin2YbbjNivINmG2KfZhSDYrtmI2K8g2LHYpyDYrdmB2Lgg2qnZhtuM2K8g2Ygg24zaqSDYotmI2KfYqtin2LEg2KjYsdin24wg2KrZhdin2LPigIzZh9in24wg2KLbjNmG2K/ZhyDYqNiz2KfYstuM2K88LzE+IiwKICAgICJub3Rfbm93X2J1dHRvbiI6ICLYp9mE2KfZhiDZhtmH2Iwg2KjZhyDYtdmB2K3ZhyDYp9i12YTbjCDYqNix2q/Ysdiv24zYryIKICB9LAogICJjb21tb24iOiB7CiAgICAiYXVkaW8iOiAi2LXYr9inIiwKICAgICJhdmF0YXIiOiAi2KLZiNin2KrYp9ixIiwKICAgICJkaXNwbGF5X25hbWUiOiAi2YbYp9mFINmG2YXYp9uM2LTbjCIsCiAgICAiaG9tZSI6ICLYrtin2YbZhyIsCiAgICAibG9hZGluZyI6ICLYqNin2LHar9iy2KfYsduM4oCmIiwKICAgICJwYXNzd29yZCI6ICLYsdmF2LIg2LnYqNmI2LEiLAogICAgInByb2ZpbGUiOiAi2b7YsdmI2YHYp9uM2YQiLAogICAgInNldHRpbmdzIjogItiq2YbYuNuM2YXYp9iqIiwKICAgICJ1c2VybmFtZSI6ICLZhtin2YUg2qnYp9ix2KjYsduMIiwKICAgICJ2aWRlbyI6ICLZiNuM2K/bjNmIIgogIH0sCiAgImhlYWRlcl9sYWJlbCI6ICLYrtin2YbZh9mUINiq2YXYp9izINin2YTZhdmG2KoiLAogICJqb2luX2V4aXN0aW5nX2NhbGxfbW9kYWwiOiB7CiAgICAiam9pbl9idXR0b24iOiAi2KjZhNmH2Iwg2KjZhyDYqtmF2KfYsyDYqNm+24zZiNmG2K/bjNivIiwKICAgICJ0ZXh0IjogItin24zZhiDYqtmF2KfYsyDYp9iyINmC2KjZhCDZiNis2YjYryDYr9in2LHYr9iMINmF24zigIzYrtmI2KfZh9uM2K8g2KjZvtuM2YjZhtiv24zYr9ifIiwKICAgICJ0aXRsZSI6ICLZvtuM2YjYs9iqINio2Ycg2KrZhdin2LPYnyIKICB9LAogICJsYXlvdXRfc3BvdGxpZ2h0X2xhYmVsIjogItmG2YjYsSDYp9mB2qnZhiIsCiAgImxvYmJ5IjogewogICAgImpvaW5fYnV0dG9uIjogItm+24zZiNiz2KrZhiDYqNmHINiq2YXYp9izIgogIH0sCiAgImxvZ2dpbmdfaW4iOiAi2YjYsdmI2K/igKYiLAogICJsb2dpbl9hdXRoX2xpbmtzIjogIjwwPtiz2KfYrtiqINit2LPYp9ioINqp2KfYsdio2LHbjDwvMD4gT3IgPDI+2K/Ys9iq2LHYs9uMINio2Ycg2LnZhtmI2KfZhiDZhduM2YfZhdin2YY8LzI+IiwKICAibG9naW5fdGl0bGUiOiAi2YjYsdmI2K8iLAogICJyYWdlc2hha2VfcmVxdWVzdF9tb2RhbCI6IHsKICAgICJib2R5IjogItqp2KfYsdio2LEg2K/bjNqv2LHbjCDYr9ixINin24zZhiDYqtmF2KfYsyDZhdi02qnZhNuMINiv2KfYsdivLiDYqNix2KfbjCDYqti02K7bjNi1INio2YfYqtixINmF2LTaqdmE2Iwg2KjZh9iq2LEg2KfYs9iqINmF2Kcg2YTYp9qvINi524zYqOKAjNuM2KfYqNuMINix2Kcg2KzZhdi54oCM2KLZiNix24wg2qnZhtuM2YUuIiwKICAgICJ0aXRsZSI6ICLYr9ix2K7ZiNin2LPYqiDZhNin2q8g2LnbjNio4oCM24zYp9io24wiCiAgfSwKICAicmFnZXNoYWtlX3NlbmRfbG9ncyI6ICLYp9ix2LPYp9mEINmE2Kfar+KAjNmH2KfbjCDYuduM2KjigIzbjNin2KjbjCIsCiAgInJhZ2VzaGFrZV9zZW5kaW5nIjogItiv2LEg2K3Yp9mEINin2LHYs9in2YTigKYiLAogICJyYWdlc2hha2Vfc2VuZGluZ19sb2dzIjogItiv2LEg2K3Yp9mEINin2LHYs9in2YQg2KjYp9qv4oCM2YfYp9uMINi524zYqOKAjNuM2KfYqNuM4oCmIiwKICAicmVjYXB0Y2hhX2Rpc21pc3NlZCI6ICLYsduM2qnZvtqG2Kcg2LHYryDYtNivIiwKICAicmVjYXB0Y2hhX25vdF9sb2FkZWQiOiAi2qnZvtqG2Kcg2KjYp9ix2q/bjNix24wg2YbYtNivIiwKICAicmVnaXN0ZXIiOiB7CiAgICAicGFzc3dvcmRzX211c3RfbWF0Y2giOiAi2LHZhdiyINi52KjZiNixINio2KfbjNivINmH2YXYrtmI2KfZhtuMINiv2KfYtNiq2Ycg2KjYp9i02K8iLAogICAgInJlZ2lzdGVyaW5nIjogItir2KjYquKAjNmG2KfZheKApiIKICB9LAogICJyZWdpc3Rlcl9hdXRoX2xpbmtzIjogIjwwPtin2LIg2YLYqNmEINit2LPYp9ioINqp2KfYsdio2LHbjCDYr9in2LHbjNiv2J88LzA+PDE+PDA+2YjYsdmI2K88LzA+IE9yIDwyPtio2Ycg2LnZhtmI2KfZhiDbjNqpINmF24zZh9mF2KfZhiDZiNin2LHYryDYtNmI24zYrzwvMj48LzE+IiwKICAicmVnaXN0ZXJfY29uZmlybV9wYXNzd29yZF9sYWJlbCI6ICLYqtin24zbjNivINix2YXYsti52KjZiNixIiwKICAicmV0dXJuX2hvbWVfYnV0dG9uIjogItio2LHar9i02Kog2KjZhyDYtdmB2K3ZhyDYp9i12YTbjCIsCiAgInNjcmVlbnNoYXJlX2J1dHRvbl9sYWJlbCI6ICLYp9i02KrYsdin2qkg2q/YsNin2LHbjCDYtdmB2K3ZhyDZhtmF2KfbjNi0IiwKICAic2V0dGluZ3MiOiB7CiAgICAiZGV2ZWxvcGVyX3RhYl90aXRsZSI6ICLYqtmI2LPYudmHINiv2YfZhtiv2YciLAogICAgImZlZWRiYWNrX3RhYl9oNCI6ICLYqNin2LLYrtmI2LHYryDYp9ix2KfYptmHINiv2YfbjNivIiwKICAgICJmZWVkYmFja190YWJfc2VuZF9sb2dzX2xhYmVsIjogIti02KfZhdmEINmE2Kfar+KAjNmH2KfbjCDYuduM2KjigIzbjNin2KjbjCIKICB9LAogICJ1bmF1dGhlbnRpY2F0ZWRfdmlld19ib2R5IjogItmH2YbZiNiyINir2KjYquKAjNmG2KfZhSDZhtqp2LHYr9mH4oCM2KfbjNiv2J8gPDI+2LPYp9iu2Kog2K3Ys9in2Kgg2qnYp9ix2KjYsduMPC8yPiIsCiAgInVuYXV0aGVudGljYXRlZF92aWV3X2xvZ2luX2J1dHRvbiI6ICLYqNmHINit2LPYp9ioINqp2KfYsdio2LHbjCDYrtmI2K8g2YjYp9ix2K8g2LTZiNuM2K8iLAogICJ2ZXJzaW9uIjogItmG2LPYrtmHOiB7e9mG2LPYrtmHfX0iCn0K",tKe=""+new URL("fr-app-BxTYbDfK.json",import.meta.url).href,nKe=""+new URL("id-app-B-8jUQf1.json",import.meta.url).href,rKe=""+new URL("it-app-Cik25Qgd.json",import.meta.url).href,iKe=""+new URL("ja-app-Cp_00ujI.json",import.meta.url).href,sKe=""+new URL("lv-app-J9DGb4uv.json",import.meta.url).href,oKe=""+new URL("pl-app-CUkXVSZk.json",import.meta.url).href,aKe=""+new URL("ro-app-KHxgbZz-.json",import.meta.url).href,lKe=""+new URL("ru-app-eoBdfBL5.json",import.meta.url).href,cKe=""+new URL("sk-app-oyZEXyo9.json",import.meta.url).href,uKe=""+new URL("sv-app-D3UhBwmo.json",import.meta.url).href,dKe=""+new URL("tr-app-Dk--6BpP.json",import.meta.url).href,fKe=""+new URL("uk-app-8w2P6iQj.json",import.meta.url).href,hKe="data:application/json;base64,ewogICJhY3Rpb24iOiB7CiAgICAiY2xvc2UiOiAixJDDs25nIiwKICAgICJubyI6ICJLaMO0bmciLAogICAgInJlZ2lzdGVyIjogIsSQxINuZyBrw70iLAogICAgInNpZ25faW4iOiAixJDEg25nIG5o4bqtcCIsCiAgICAic2lnbl9vdXQiOiAixJDEg25nIHh14bqldCIsCiAgICAic3VibWl0IjogIkfhu61pIgogIH0sCiAgImNhbGxfZW5kZWRfdmlldyI6IHsKICAgICJjcmVhdGVfYWNjb3VudF9idXR0b24iOiAiVOG6oW8gdMOgaSBraG/huqNuIiwKICAgICJjcmVhdGVfYWNjb3VudF9wcm9tcHQiOiAiPDA+VOG6oWkgc2FvIGzhuqFpIGtow7RuZyBob8OgbiB0aGnhu4duIGLhurFuZyBjw6FjaCDEkeG6t3QgbeG6rXQga2jhuql1IMSR4buDIGdp4buvIHTDoGkga2hv4bqjbiBj4bunYSBi4bqhbj88LzA+PDE+QuG6oW4gc+G6vSBjw7MgdGjhu4MgZ2nhu68gdMOqbiB2w6AgxJHhurd0IOG6o25oIMSR4bqhaSBkaeG7h24gY2hvIG5o4buvbmcgY3Xhu5ljIGfhu41pIHRp4bq/cCB0aGVvLjwvMT4iLAogICAgImZlZWRiYWNrX2RvbmUiOiAiPDA+Q+G6o20gaMahbiB2w6wgxJHDoyBwaOG6o24gaOG7k2khPC8wPiIsCiAgICAiZmVlZGJhY2tfcHJvbXB0IjogIjwwPkNow7puZyB0w7RpIG114buRbiBuZ2hlIHBo4bqjbiBo4buTaSBj4bunYSBi4bqhbiDEkeG7gyBjw7JuIGPhuqNpIHRoaeG7h24gdHLhuqNpIG5naGnhu4dtIGNobyBi4bqhbi48LzA+IiwKICAgICJoZWFkbGluZSI6ICJ7e2Rpc3BsYXlOYW1lfX0sIGN14buZYyBn4buNaSDEkcOjIGvhur90IHRow7pjLiIKICB9LAogICJjb21tb24iOiB7CiAgICAiYXVkaW8iOiAiw4JtIHRoYW5oIiwKICAgICJhdmF0YXIiOiAi4bqibmggxJHhuqFpIGRp4buHbiIsCiAgICAiZGlzcGxheV9uYW1lIjogIlTDqm4gaGnhu4NuIHRo4buLIiwKICAgICJsb2FkaW5nIjogIsSQYW5nIHThuqNp4oCmIiwKICAgICJwYXNzd29yZCI6ICJN4bqtdCBraOG6qXUiLAogICAgInByb2ZpbGUiOiAiSOG7kyBzxqEiLAogICAgInNldHRpbmdzIjogIkPDoGkgxJHhurd0IiwKICAgICJ1c2VybmFtZSI6ICJUw6puIG5nxrDhu51pIGTDuW5nIiwKICAgICJ2aWRlbyI6ICJUcnV54buBbiBow6xuaCIKICB9LAogICJqb2luX2V4aXN0aW5nX2NhbGxfbW9kYWwiOiB7CiAgICAiam9pbl9idXR0b24iOiAiVsOibmcsIHRoYW0gZ2lhIGN14buZYyBn4buNaSIsCiAgICAidGV4dCI6ICJDdeG7mWMgZ+G7jWkgxJHDoyB04buTbiB04bqhaSwgYuG6oW4gY8OzIG114buRbiB0aGFtIGdpYSBraMO0bmc/IiwKICAgICJ0aXRsZSI6ICJUaGFtIGdpYSBjdeG7mWMgZ+G7jWk/IgogIH0sCiAgImxheW91dF9zcG90bGlnaHRfbGFiZWwiOiAiVGnDqnUgxJFp4buDbSIsCiAgImxvYmJ5IjogewogICAgImpvaW5fYnV0dG9uIjogIlRoYW0gZ2lhIGN14buZYyBn4buNaSIKICB9LAogICJsb2dnaW5nX2luIjogIsSQYW5nIMSRxINuZyBuaOG6rXDigKYiLAogICJsb2dpbl9hdXRoX2xpbmtzIjogIjwwPlThuqFvIHTDoGkga2hv4bqjbjwvMD4gSGF5IDwyPlRoYW0gZ2lhIGTGsOG7m2kgdMOqbiBraMOhYzwvMj4iLAogICJsb2dpbl90aXRsZSI6ICLEkMSDbmcgbmjhuq1wIiwKICAicmFnZXNoYWtlX3JlcXVlc3RfbW9kYWwiOiB7CiAgICAiYm9keSI6ICJN4buZdCBuZ8aw4budaSBkw7luZyBraMOhYyB0cm9uZyBjdeG7mWMgZ+G7jWkgxJFhbmcgZ+G6t3AgduG6pW4gxJHhu4EuIMSQ4buDIGPDsyB0aOG7gyBjaOG6qW4gxJFvw6FuIHThu5F0IGjGoW4gY2jDum5nIHTDtGkgbXXhu5FuIHRodSB0aOG6rXAgbmjhuq10IGvDvSBn4buhIGzhu5dpLiIsCiAgICAidGl0bGUiOiAiWcOqdSBj4bqndSBuaOG6rXQga8O9IGfhu6EgbOG7l2kiCiAgfSwKICAicmFnZXNoYWtlX3NlbmRpbmciOiAixJBhbmcgZ+G7rWnigKYiLAogICJyZWNhcHRjaGFfbm90X2xvYWRlZCI6ICJDaMawYSB04bqjaSDEkcaw4bujYyBSZWNhcHRjaGEiLAogICJyZWdpc3RlciI6IHsKICAgICJwYXNzd29yZHNfbXVzdF9tYXRjaCI6ICJN4bqtdCBraOG6qXUgcGjhuqNpIGto4bubcCIsCiAgICAicmVnaXN0ZXJpbmciOiAixJBhbmcgxJHEg25nIGvDveKApiIKICB9LAogICJyZWdpc3Rlcl9hdXRoX2xpbmtzIjogIjwwPsSQw6MgY8OzIHTDoGkga2hv4bqjbj88LzA+PDE+PDA+xJDEg25nIG5o4bqtcDwvMD4gSGF5IDwyPlRoYW0gZ2lhIGTGsOG7m2kgdMOqbiBLaMOhY2g8LzI+PC8xPiIsCiAgInJlZ2lzdGVyX2NvbmZpcm1fcGFzc3dvcmRfbGFiZWwiOiAiWMOhYyBuaOG6rW4gbeG6rXQga2jhuql1IiwKICAic2NyZWVuc2hhcmVfYnV0dG9uX2xhYmVsIjogIkNoaWEgc+G6uyBtw6BuIGjDrG5oIiwKICAic2V0dGluZ3MiOiB7CiAgICAiZGV2ZWxvcGVyX3RhYl90aXRsZSI6ICJOaMOgIHBow6F0IHRyaeG7g24iLAogICAgImZlZWRiYWNrX3RhYl9kZXNjcmlwdGlvbl9sYWJlbCI6ICJQaOG6o24gaOG7k2kgY+G7p2EgYuG6oW4iLAogICAgImZlZWRiYWNrX3RhYl9oNCI6ICJH4butaSBwaOG6o24gaOG7k2kiLAogICAgImZlZWRiYWNrX3RhYl9zZW5kX2xvZ3NfbGFiZWwiOiAiS8OobSB0aGVvIG5o4bqtdCBrw70gZ+G7oSBs4buXaSIsCiAgICAiZmVlZGJhY2tfdGFiX3RoYW5rX3lvdSI6ICJD4bqjbSDGoW4sIGNow7puZyB0w7RpIMSRw6Mgbmjhuq1uIMSRxrDhu6NjIHBo4bqjbiBo4buTaSEiLAogICAgImZlZWRiYWNrX3RhYl90aXRsZSI6ICJQaOG6o24gaOG7k2kiCiAgfSwKICAic3VibWl0dGluZyI6ICLEkGFuZyBn4butaeKApiIsCiAgInVuYXV0aGVudGljYXRlZF92aWV3X2JvZHkiOiAiQ2jGsGEgxJHEg25nIGvDvT8gPDI+VOG6oW8gdMOgaSBraG/huqNuPC8yPiIsCiAgInVuYXV0aGVudGljYXRlZF92aWV3X2xvZ2luX2J1dHRvbiI6ICLEkMSDbmcgbmjhuq1wIHbDoG8gdMOgaSBraG/huqNuIGPhu6dhIGLhuqFuIiwKICAidmVyc2lvbiI6ICJQaGnDqm4gYuG6o246IHt7dmVyc2lvbn19Igp9Cg==",pKe=""+new URL("zh-Hans-app-8pDbXAOO.json",import.meta.url).href,mKe=""+new URL("zh-Hant-app-BV1LKS_j.json",import.meta.url).href,{slice:gKe,forEach:vKe}=[];function yKe(e){return vKe.call(gKe.call(arguments,1),(t=>{if(t)for(const n in t)void 0===e[n]&&(e[n]=t[n])})),e}const s$=/^[\u0009\u0020-\u007e\u0080-\u00ff]+$/,_Ke=function(e,t){const n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{path:"/"};let r=`${e}=${encodeURIComponent(t)}`;if(n.maxAge>0){const e=n.maxAge-0;if(Number.isNaN(e))throw new Error("maxAge should be a Number");r+=`; Max-Age=${Math.floor(e)}`}if(n.domain){if(!s$.test(n.domain))throw new TypeError("option domain is invalid");r+=`; Domain=${n.domain}`}if(n.path){if(!s$.test(n.path))throw new TypeError("option path is invalid");r+=`; Path=${n.path}`}if(n.expires){if("function"!=typeof n.expires.toUTCString)throw new TypeError("option expires is invalid");r+=`; Expires=${n.expires.toUTCString()}`}if(n.httpOnly&&(r+="; HttpOnly"),n.secure&&(r+="; Secure"),n.sameSite)switch("string"==typeof n.sameSite?n.sameSite.toLowerCase():n.sameSite){case!0:r+="; SameSite=Strict";break;case"lax":r+="; SameSite=Lax";break;case"strict":r+="; SameSite=Strict";break;case"none":r+="; SameSite=None";break;default:throw new TypeError("option sameSite is invalid")}return r},o$={create(e,t,n,r){let i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{path:"/",sameSite:"strict"};n&&(i.expires=new Date,i.expires.setTime(i.expires.getTime()+60*n*1e3)),r&&(i.domain=r),document.cookie=_Ke(e,encodeURIComponent(t),i)},read(e){const t=`${e}=`,n=document.cookie.split(";");for(let e=0;e<n.length;e++){let r=n[e];for(;" "===r.charAt(0);)r=r.substring(1,r.length);if(0===r.indexOf(t))return r.substring(t.length,r.length)}return null},remove(e){this.create(e,"",-1)}};var bKe={name:"cookie",lookup(e){let{lookupCookie:t}=e;if(t&&typeof document<"u")return o$.read(t)||void 0},cacheUserLanguage(e,t){let{lookupCookie:n,cookieMinutes:r,cookieDomain:i,cookieOptions:o}=t;n&&typeof document<"u"&&o$.create(n,e,r,i,o)}},SKe={name:"querystring",lookup(e){var t;let n,{lookupQuerystring:r}=e;if(typeof window<"u"){let{search:e}=window.location;!window.location.search&&(null==(t=window.location.hash)?void 0:t.indexOf("?"))>-1&&(e=window.location.hash.substring(window.location.hash.indexOf("?")));const i=e.substring(1).split("&");for(let e=0;e<i.length;e++){const t=i[e].indexOf("=");t>0&&i[e].substring(0,t)===r&&(n=i[e].substring(t+1))}}return n}};let ch=null;const a$=()=>{if(null!==ch)return ch;try{if(ch=typeof window<"u"&&null!==window.localStorage,!ch)return!1;const e="i18next.translate.boo";window.localStorage.setItem(e,"foo"),window.localStorage.removeItem(e)}catch{ch=!1}return ch};var EKe={name:"localStorage",lookup(e){let{lookupLocalStorage:t}=e;if(t&&a$())return window.localStorage.getItem(t)||void 0},cacheUserLanguage(e,t){let{lookupLocalStorage:n}=t;n&&a$()&&window.localStorage.setItem(n,e)}};let uh=null;const l$=()=>{if(null!==uh)return uh;try{if(uh=typeof window<"u"&&null!==window.sessionStorage,!uh)return!1;const e="i18next.translate.boo";window.sessionStorage.setItem(e,"foo"),window.sessionStorage.removeItem(e)}catch{uh=!1}return uh};var wKe={name:"sessionStorage",lookup(e){let{lookupSessionStorage:t}=e;if(t&&l$())return window.sessionStorage.getItem(t)||void 0},cacheUserLanguage(e,t){let{lookupSessionStorage:n}=t;n&&l$()&&window.sessionStorage.setItem(n,e)}},CKe={name:"navigator",lookup(e){const t=[];if(typeof navigator<"u"){const{languages:e,userLanguage:n,language:r}=navigator;if(e)for(let n=0;n<e.length;n++)t.push(e[n]);n&&t.push(n),r&&t.push(r)}return t.length>0?t:void 0}},TKe={name:"htmlTag",lookup(e){let t,{htmlTag:n}=e;const r=n||(typeof document<"u"?document.documentElement:null);return r&&"function"==typeof r.getAttribute&&(t=r.getAttribute("lang")),t}},RKe={name:"path",lookup(e){var t;let{lookupFromPathIndex:n}=e;if(typeof window>"u")return;const r=window.location.pathname.match(/\/([a-zA-Z-]*)/g);return Array.isArray(r)?null==(t=r["number"==typeof n?n:0])?void 0:t.replace("/",""):void 0}},IKe={name:"subdomain",lookup(e){var t,n;let{lookupFromSubdomainIndex:r}=e;const i="number"==typeof r?r+1:1,o=typeof window<"u"&&(null==(n=null==(t=window.location)?void 0:t.hostname)?void 0:n.match(/^(\w{2,5})\.(([a-z0-9-]{1,63}\.[a-z]{2,6})|localhost)/i));if(o)return o[i]}};let Bte=!1;try{document.cookie,Bte=!0}catch{}const Vte=["querystring","cookie","localStorage","sessionStorage","navigator","htmlTag"];Bte||Vte.splice(1,1);const kKe=()=>({order:Vte,lookupQuerystring:"lng",lookupCookie:"i18next",lookupLocalStorage:"i18nextLng",lookupSessionStorage:"i18nextLng",caches:["localStorage"],excludeCacheFor:["cimode"],convertDetectedLanguage:e=>e});class qte{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.type="languageDetector",this.detectors={},this.init(e,t)}init(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{languageUtils:{}},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};this.services=e,this.options=yKe(t,this.options||{},kKe()),"string"==typeof this.options.convertDetectedLanguage&&this.options.convertDetectedLanguage.indexOf("15897")>-1&&(this.options.convertDetectedLanguage=e=>e.replace("-","_")),this.options.lookupFromUrlIndex&&(this.options.lookupFromPathIndex=this.options.lookupFromUrlIndex),this.i18nOptions=n,this.addDetector(bKe),this.addDetector(SKe),this.addDetector(EKe),this.addDetector(wKe),this.addDetector(CKe),this.addDetector(TKe),this.addDetector(RKe),this.addDetector(IKe)}addDetector(e){return this.detectors[e.name]=e,this}detect(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.options.order,t=[];return e.forEach((e=>{if(this.detectors[e]){let n=this.detectors[e].lookup(this.options);n&&"string"==typeof n&&(n=[n]),n&&(t=t.concat(n))}})),t=t.map((e=>this.options.convertDetectedLanguage(e))),this.services&&this.services.languageUtils&&this.services.languageUtils.getBestMatchFromCodes?t:t.length>0?t[0]:null}cacheUserLanguage(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.options.caches;t&&(this.options.excludeCacheFor&&this.options.excludeCacheFor.indexOf(e)>-1||t.forEach((t=>{this.detectors[t]&&this.detectors[t].cacheUserLanguage(e,this.options)})))}}qte.type="languageDetector";var c$,P_={};function xKe(){if(c$)return P_;return c$=1,Object.defineProperty(P_,"__esModule",{value:!0}),P_.shouldPolyfill=function(){return!Intl.Segmenter},P_}var u$,PKe=xKe(),L_={};function LKe(){if(u$)return L_;return u$=1,Object.defineProperty(L_,"__esModule",{value:!0}),L_.shouldPolyfill=function(){return typeof Intl>"u"||!("DurationFormat"in Intl)},L_}var OKe=LKe();const Kte=Object.assign({"../locales/bg/app.json":Wqe,"../locales/cs/app.json":zqe,"../locales/de/app.json":Yqe,"../locales/el/app.json":Jqe,"../locales/en/app.json":Xqe,"../locales/es/app.json":Zqe,"../locales/et/app.json":Qqe,"../locales/fa/app.json":eKe,"../locales/fr/app.json":tKe,"../locales/id/app.json":nKe,"../locales/it/app.json":rKe,"../locales/ja/app.json":iKe,"../locales/lv/app.json":sKe,"../locales/pl/app.json":oKe,"../locales/ro/app.json":aKe,"../locales/ru/app.json":lKe,"../locales/sk/app.json":cKe,"../locales/sv/app.json":uKe,"../locales/tr/app.json":dKe,"../locales/uk/app.json":fKe,"../locales/vi/app.json":hKe,"../locales/zh-Hans/app.json":pKe,"../locales/zh-Hant/app.json":mKe}),MKe=(e,t)=>Kte[`../locales/${e}/${t}.json`],AKe=[...new Set(Object.keys(Kte).map((e=>{var t;const n=null==(t=e.match(/\/([^/]+)\/[^/]+\.json$/))?void 0:t[1];if(!n)throw new Error(`Could not parse locale URL ${e}`);return n})))],NKe={type:"backend",init(){},read(e,t,n){(async()=>{const n=MKe(e,t);if(!n)throw new Error(`Namespace ${t} for locale ${e} not found`);const r=await fetch(n,{credentials:"omit",headers:{Accept:"application/json"}});if(Y6(r))throw Error(`Failed to fetch ${n}`);return await r.json()})().then((e=>n(null,e)),(e=>n(e,null)))}};class DKe{constructor(){this.config=0,this.sentry=0,this.openTelemetry=0}allDepsAreLoaded(){return!Object.values(this).some((e=>2!==e))}}class ps{constructor(){this.isInitialized=!1,this.loadStates=new DKe}static isInitialized(){var e;return!(null==(e=ps.internalInstance)||!e.isInitialized)}static async initBeforeReact(){const e=[];PKe.shouldPolyfill()&&e.push(Cv((()=>import("./polyfill-force-DxJcBG4e.js").then((e=>e.p))),__vite__mapDeps([2,3]),import.meta.url)),OKe.shouldPolyfill()&&e.push(Cv((()=>import("./polyfill-force-DmQV3-w7.js").then((e=>e.p))),__vite__mapDeps([4,3]),import.meta.url)),await Promise.all(e);const t=new qte;t.addDetector({name:"urlFragment",lookup:()=>Jr().lang??void 0}),await hi.use(NKe).use(t).use(j2e).init({fallbackLng:"en",defaultNS:"app",keySeparator:".",nsSeparator:!1,pluralSeparator:"_",contextSeparator:"|",supportedLngs:AKe,interpolation:{escapeValue:!1},detection:{order:["urlFragment","navigator"],caches:[]}});const{fonts:n,fontScale:r}=Jr();null!==r&&document.documentElement.style.setProperty("--font-scale",r.toString()),n.length>0&&document.documentElement.style.setProperty("--font-family",n.map((e=>`"${e}"`)).join(", ")),document.body.setAttribute("data-platform",Od)}static init(){var e;return null!=(e=null==ps?void 0:ps.internalInstance)&&e.initPromise?null:(ps.internalInstance=new ps,ps.internalInstance.initPromise=new Promise((e=>{var t;null==(t=ps.internalInstance)||t.initStep(e)})),ps.internalInstance.initPromise)}static reset(){ps.internalInstance=void 0}initStep(e){if(0===this.loadStates.config&&(this.loadStates.config=1,Bt.init().then((()=>{this.loadStates.config=2,this.initStep(e)}),(e=>{A.error("Failed to load config",e)}))),0===this.loadStates.sentry&&2===this.loadStates.config){let e,t;e=Jr().sentryDsn??void 0,t=Jr().sentryEnvironment??void 0,e&&y0e({dsn:e,environment:t,integrations:[j0e({useEffect:we.useEffect,useLocation:di,useNavigationType:Rfe,createRoutesFromChildren:vS,matchRoutes:TL})],tracesSampleRate:1}),this.loadStates.sentry=2}0===this.loadStates.openTelemetry&&2===this.loadStates.config&&(jw.globalInit(),this.loadStates.openTelemetry=2),this.loadStates.allDepsAreLoaded()&&(e(),this.isInitialized=!0)}}const jKe=()=>{const[e,t]=_.useState((()=>Jr().theme)),n=_.useRef(document.body.classList.item(0));_.useEffect((()=>{if(Ge){const e=e=>{e.preventDefault(),"name"in e.detail.data&&"string"==typeof e.detail.data.name&&t(e.detail.data.name),Ge.api.transport.reply(e.detail,{})};return Ge.lazyActions.on(mr.ThemeChange,e),()=>{Ge.lazyActions.off(mr.ThemeChange,e)}}}),[]),_.useLayoutEffect((()=>{const t="cpd-theme-"+(null!=e&&e.includes("light")?"light":"dark")+(null!=e&&e.includes("high-contrast")?"-hc":"");t!==n.current&&(document.body.classList.remove("cpd-theme-light","cpd-theme-dark","cpd-theme-light-hc","cpd-theme-dark-hc"),document.body.classList.add(t),n.current=t),document.body.classList.remove("no-theme")}),[n,e])},O_=U0e(hq),UKe=({children:e})=>{const{pathname:t}=di();return _.useEffect((()=>{let e="";!["/login","/register"].includes(t)&&!Ge&&(e="var(--background-gradient)"),document.getElementsByTagName("body")[0].style.backgroundImage=e}),[t]),E.jsx(E.Fragment,{children:e})},FKe=({children:e})=>(jKe(),e),$Ke=()=>{const[e,t]=_.useState(!1);return _.useEffect((()=>{var n;null==(n=ps.init())||n.then((async()=>{e||(t(!0),await(null==Ge?void 0:Ge.api.sendContentLoaded()))})).catch(A.error)})),E.jsx(fhe,{children:E.jsx(UKe,{children:E.jsx(FKe,{children:E.jsx(xG,{children:e?E.jsx(_.Suspense,{fallback:null,children:E.jsx(i8e,{children:E.jsx(J8e,{children:E.jsxs(ow,{fallback:e=>E.jsx(uy,{error:e,widget:Ge}),children:[E.jsx(Gqe,{}),E.jsxs(Bfe,{children:[E.jsx(O_,{path:"/",element:E.jsx(UQ,{})}),E.jsx(O_,{path:"/login",element:E.jsx(G7e,{})}),E.jsx(O_,{path:"/register",element:E.jsx(W7e,{})}),E.jsx(O_,{path:"*",element:E.jsx(Vqe,{})})]})]})})})}):E.jsx(Fw,{})})})})})};window.setLKLogLevel=tV,O3e().catch((e=>{A.error("Failed to initialize rageshake",e)})),tV("warn"),Jce(((e,t,n)=>{global.mx_rage_logger.log(e,"livekit",t,n)})),A.info("Element Call embedded-v0.10.0");const RP=yle.createRoot(document.getElementById("root"));let bv=null;if(window.isSecureContext?navigator.mediaDevices||(bv=new Error("Your browser does not support WebRTC.")):bv=new Error("This app cannot run in an insecure context. To fix this, access the app via a local loopback address, or serve it over HTTPS.\nhttps://developer.mozilla.org/en-US/docs/Web/Security/Secure_Contexts"),null!==bv)throw RP.render(bv.message),bv;ps.initBeforeReact().then((()=>{RP.render(E.jsx(_.StrictMode,{children:E.jsx($Ke,{})}))})).catch((e=>{A.error("Failed to initialize app",e),RP.render(e.message)}));export{YKe as A,D_ as B,Bt as C,Noe as D,ee as E,XKe as F,QKe as G,WP as H,ZKe as I,_s as J,Ke as K,KKe as L,bn as M,Mt as N,Sl as O,MN as P,_N as Q,eGe as R,ld as S,En as T,JKe as U,tGe as V,Lt as W,sp as X,joe as Y,Qs as _,BKe as a,no as b,HKe as c,zKe as d,U as e,nU as f,Ko as g,L as h,OQ as i,qKe as j,Rr as k,A as l,ae as m,Oh as n,Ie as o,IE as p,$P as q,XH as r,su as s,oGe as t,Bae as u,Mp as v,Pa as w,ou as x,fr as y,Boe as z};